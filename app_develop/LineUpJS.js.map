{"version":3,"sources":["webpack://LineUpJS/webpack/universalModuleDefinition","webpack://LineUpJS/webpack/bootstrap","webpack://LineUpJS/./node_modules/fast-deep-equal/index.js","webpack://LineUpJS/./node_modules/lodash.get/index.js","webpack://LineUpJS/./node_modules/detect-browser/index.js","webpack://LineUpJS/./node_modules/reflect-metadata/Reflect.js","webpack://LineUpJS/./node_modules/tslib/tslib.es6.js","webpack://LineUpJS/./src/internal/interable.ts","webpack://LineUpJS/./src/internal/worker.ts","webpack://LineUpJS/./src/internal/math.ts","webpack://LineUpJS/./src/internal/utils.ts","webpack://LineUpJS/./node_modules/d3-dispatch/src/dispatch.js","webpack://LineUpJS/./src/internal/AEventDispatcher.ts","webpack://LineUpJS/./src/model/interfaces.ts","webpack://LineUpJS/./src/model/Column.ts","webpack://LineUpJS/./src/model/annotations.ts","webpack://LineUpJS/./src/model/INumberColumn.ts","webpack://LineUpJS/./src/model/ValueColumn.ts","webpack://LineUpJS/./src/model/CompositeColumn.ts","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/colors.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/category10.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Accent.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Dark2.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Pastel1.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Paired.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Pastel2.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Set1.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Set2.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Set3.js","webpack://LineUpJS/./node_modules/d3-color/src/define.js","webpack://LineUpJS/./node_modules/d3-color/src/color.js","webpack://LineUpJS/./node_modules/d3-color/src/math.js","webpack://LineUpJS/./node_modules/d3-color/src/lab.js","webpack://LineUpJS/./node_modules/d3-color/src/cubehelix.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/basis.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/constant.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/color.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/rgb.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/array.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/basisClosed.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/date.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/number.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/object.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/string.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/transform/parse.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/value.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/round.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/transform/decompose.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/transform/index.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/zoom.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/hsl.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/hcl.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/cubehelix.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/quantize.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/ramp.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/BrBG.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/PRGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/PiYG.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/PuOr.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdGy.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdYlBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdYlGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/Spectral.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/BuGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/BuPu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/GnBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/OrRd.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/PuBuGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/PuBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/PuRd.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/RdPu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlGnBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlOrBr.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlOrRd.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Blues.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Greens.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Greys.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Purples.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Reds.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Oranges.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/cubehelix.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/rainbow.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/sinebow.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/viridis.js","webpack://LineUpJS/./src/internal/OrderedSet.ts","webpack://LineUpJS/./src/model/internal.ts","webpack://LineUpJS/./src/model/Ranking.ts","webpack://LineUpJS/./src/internal/debounce.ts","webpack://LineUpJS/./src/model/RankColumn.ts","webpack://LineUpJS/./src/model/AggregateGroupColumn.ts","webpack://LineUpJS/./src/model/SelectionColumn.ts","webpack://LineUpJS/./src/model/ActionColumn.ts","webpack://LineUpJS/./src/model/missing.ts","webpack://LineUpJS/./src/model/StringColumn.ts","webpack://LineUpJS/./src/internal/mathInterfaces.ts","webpack://LineUpJS/./src/model/AnnotateColumn.ts","webpack://LineUpJS/./src/model/CategoricalColorMappingFunction.ts","webpack://LineUpJS/./src/model/internalCategorical.ts","webpack://LineUpJS/./src/model/CategoricalColumn.ts","webpack://LineUpJS/./src/model/BooleanColumn.ts","webpack://LineUpJS/./src/model/ArrayColumn.ts","webpack://LineUpJS/./src/model/BooleansColumn.ts","webpack://LineUpJS/./node_modules/d3-format/src/formatDecimal.js","webpack://LineUpJS/./node_modules/d3-format/src/exponent.js","webpack://LineUpJS/./node_modules/d3-format/src/formatSpecifier.js","webpack://LineUpJS/./node_modules/d3-format/src/formatTrim.js","webpack://LineUpJS/./node_modules/d3-format/src/formatPrefixAuto.js","webpack://LineUpJS/./node_modules/d3-format/src/defaultLocale.js","webpack://LineUpJS/./node_modules/d3-format/src/formatRounded.js","webpack://LineUpJS/./node_modules/d3-format/src/formatTypes.js","webpack://LineUpJS/./node_modules/d3-format/src/identity.js","webpack://LineUpJS/./node_modules/d3-format/src/locale.js","webpack://LineUpJS/./node_modules/d3-format/src/formatGroup.js","webpack://LineUpJS/./node_modules/d3-format/src/formatNumerals.js","webpack://LineUpJS/./node_modules/d3-format/src/precisionFixed.js","webpack://LineUpJS/./node_modules/d3-array/src/ascending.js","webpack://LineUpJS/./node_modules/d3-array/src/bisector.js","webpack://LineUpJS/./node_modules/d3-array/src/bisect.js","webpack://LineUpJS/./node_modules/d3-array/src/cross.js","webpack://LineUpJS/./node_modules/d3-array/src/array.js","webpack://LineUpJS/./node_modules/d3-array/src/ticks.js","webpack://LineUpJS/./node_modules/d3-scale/src/init.js","webpack://LineUpJS/./node_modules/d3-collection/src/map.js","webpack://LineUpJS/./node_modules/d3-collection/src/set.js","webpack://LineUpJS/./node_modules/d3-scale/src/array.js","webpack://LineUpJS/./node_modules/d3-scale/src/constant.js","webpack://LineUpJS/./node_modules/d3-scale/src/number.js","webpack://LineUpJS/./node_modules/d3-scale/src/continuous.js","webpack://LineUpJS/./node_modules/d3-scale/src/tickFormat.js","webpack://LineUpJS/./node_modules/d3-format/src/precisionPrefix.js","webpack://LineUpJS/./node_modules/d3-format/src/precisionRound.js","webpack://LineUpJS/./node_modules/d3-scale/src/linear.js","webpack://LineUpJS/./node_modules/d3-scale/src/nice.js","webpack://LineUpJS/./node_modules/d3-scale/src/log.js","webpack://LineUpJS/./node_modules/d3-scale/src/pow.js","webpack://LineUpJS/./node_modules/d3-time/src/interval.js","webpack://LineUpJS/./node_modules/d3-time/src/millisecond.js","webpack://LineUpJS/./node_modules/d3-time/src/second.js","webpack://LineUpJS/./node_modules/d3-time/src/duration.js","webpack://LineUpJS/./node_modules/d3-time/src/minute.js","webpack://LineUpJS/./node_modules/d3-time/src/hour.js","webpack://LineUpJS/./node_modules/d3-time/src/day.js","webpack://LineUpJS/./node_modules/d3-time/src/week.js","webpack://LineUpJS/./node_modules/d3-time/src/month.js","webpack://LineUpJS/./node_modules/d3-time/src/year.js","webpack://LineUpJS/./node_modules/d3-time/src/utcMinute.js","webpack://LineUpJS/./node_modules/d3-time/src/utcHour.js","webpack://LineUpJS/./node_modules/d3-time/src/utcDay.js","webpack://LineUpJS/./node_modules/d3-time/src/utcWeek.js","webpack://LineUpJS/./node_modules/d3-time/src/utcMonth.js","webpack://LineUpJS/./node_modules/d3-time/src/utcYear.js","webpack://LineUpJS/./node_modules/d3-time-format/src/locale.js","webpack://LineUpJS/./node_modules/d3-time-format/src/defaultLocale.js","webpack://LineUpJS/./node_modules/d3-time-format/src/isoFormat.js","webpack://LineUpJS/./node_modules/d3-time-format/src/isoParse.js","webpack://LineUpJS/./src/model/MappingFunction.ts","webpack://LineUpJS/./src/model/internalNumber.ts","webpack://LineUpJS/./src/model/NumberColumn.ts","webpack://LineUpJS/./src/model/BoxPlotColumn.ts","webpack://LineUpJS/./src/model/MapColumn.ts","webpack://LineUpJS/./src/model/CategoricalMapColumn.ts","webpack://LineUpJS/./src/model/CategoricalsColumn.ts","webpack://LineUpJS/./src/model/internalDate.ts","webpack://LineUpJS/./src/model/DateColumn.ts","webpack://LineUpJS/./src/model/DatesColumn.ts","webpack://LineUpJS/./src/model/DatesMapColumn.ts","webpack://LineUpJS/./src/model/GroupColumn.ts","webpack://LineUpJS/./src/model/HierarchyColumn.ts","webpack://LineUpJS/./src/model/ColorMappingFunction.ts","webpack://LineUpJS/./src/model/ImpositionCompositeColumn.ts","webpack://LineUpJS/./src/model/NumbersColumn.ts","webpack://LineUpJS/./src/model/ImpositionBoxPlotColumn.ts","webpack://LineUpJS/./src/model/ImpositionCompositesColumn.ts","webpack://LineUpJS/./src/model/CompositeNumberColumn.ts","webpack://LineUpJS/./src/model/ReduceColumn.ts","webpack://LineUpJS/./src/model/StackColumn.ts","webpack://LineUpJS/./src/model/MultiLevelCompositeColumn.ts","webpack://LineUpJS/./src/model/NestedColumn.ts","webpack://LineUpJS/./src/model/NumberMapColumn.ts","webpack://LineUpJS/./src/model/OrdinalColumn.ts","webpack://LineUpJS/./src/model/ScriptColumn.ts","webpack://LineUpJS/./src/model/SetColumn.ts","webpack://LineUpJS/./src/model/StringMapColumn.ts","webpack://LineUpJS/./src/model/StringsColumn.ts","webpack://LineUpJS/./src/model/LinkColumn.ts","webpack://LineUpJS/./src/model/LinkMapColumn.ts","webpack://LineUpJS/./src/model/LinksColumn.ts","webpack://LineUpJS/./node_modules/lineupengine/src/abortAble.js","webpack://LineUpJS/./src/provider/interfaces.ts","webpack://LineUpJS/./src/internal/accessor.ts","webpack://LineUpJS/./src/provider/utils.ts","webpack://LineUpJS/./src/provider/ADataProvider.ts","webpack://LineUpJS/./src/model/models.ts","webpack://LineUpJS/./src/provider/ACommonDataProvider.ts","webpack://LineUpJS/./src/provider/sort.ts","webpack://LineUpJS/./src/internal/scheduler.ts","webpack://LineUpJS/./src/provider/tasks.ts","webpack://LineUpJS/./src/provider/DirectRenderTasks.ts","webpack://LineUpJS/./src/model/IArrayColumn.ts","webpack://LineUpJS/./src/model/ICategoricalColumn.ts","webpack://LineUpJS/./src/model/IDateColumn.ts","webpack://LineUpJS/./src/provider/ScheduledTasks.ts","webpack://LineUpJS/./src/renderer/interfaces.ts","webpack://LineUpJS/./src/provider/LocalDataProvider.ts","webpack://LineUpJS/./src/constants.ts","webpack://LineUpJS/./src/styles/index.ts","webpack://LineUpJS/./src/renderer/utils.ts","webpack://LineUpJS/./src/renderer/ActionRenderer.ts","webpack://LineUpJS/./src/provider/internal.ts","webpack://LineUpJS/./src/renderer/AggregateGroupRenderer.ts","webpack://LineUpJS/./src/ui/missing.ts","webpack://LineUpJS/./src/renderer/missing.ts","webpack://LineUpJS/./src/renderer/StringCellRenderer.ts","webpack://LineUpJS/./src/renderer/AnnotationRenderer.ts","webpack://LineUpJS/./src/renderer/impose.ts","webpack://LineUpJS/./src/renderer/BarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DefaultCellRenderer.ts","webpack://LineUpJS/./src/renderer/BooleanCellRenderer.ts","webpack://LineUpJS/./src/renderer/BoxplotCellRenderer.ts","webpack://LineUpJS/./src/renderer/BrightnessCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalHeatmapCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalStackedDistributionlCellRenderer.ts","webpack://LineUpJS/./src/renderer/CircleCellRenderer.ts","webpack://LineUpJS/./src/renderer/DotCellRenderer.ts","webpack://LineUpJS/./src/renderer/GroupCellRenderer.ts","webpack://LineUpJS/./src/renderer/ANumbersCellRenderer.ts","webpack://LineUpJS/./node_modules/popper.js/dist/esm/popper.js","webpack://LineUpJS/./src/renderer/HeatmapCellRenderer.ts","webpack://LineUpJS/./src/internal/merge.ts","webpack://LineUpJS/./src/ui/dialogs/ADialog.ts","webpack://LineUpJS/./src/ui/dialogs/APopup.ts","webpack://LineUpJS/./src/ui/dialogs/InputNumberDialog.ts","webpack://LineUpJS/./src/internal/drag.ts","webpack://LineUpJS/./src/renderer/histogram.ts","webpack://LineUpJS/./src/renderer/HistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/ImageCellRenderer.ts","webpack://LineUpJS/./src/renderer/AAggregatedGroupRenderer.ts","webpack://LineUpJS/./src/renderer/MultiLevelCellRenderer.ts","webpack://LineUpJS/./src/renderer/InterleavingCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkCellRenderer.ts","webpack://LineUpJS/./src/renderer/TableCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkMapCellRenderer.ts","webpack://LineUpJS/./src/renderer/LoadingCellRenderer.ts","webpack://LineUpJS/./src/renderer/MapBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/RankCellRenderer.ts","webpack://LineUpJS/./src/renderer/SelectionRenderer.ts","webpack://LineUpJS/./src/renderer/SetCellRenderer.ts","webpack://LineUpJS/./src/renderer/SparklineCellRenderer.ts","webpack://LineUpJS/./src/renderer/UpSetCellRenderer.ts","webpack://LineUpJS/./src/renderer/VerticalBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DateCellRenderer.ts","webpack://LineUpJS/./src/ui/dialogs/InputDateDialog.ts","webpack://LineUpJS/./src/renderer/DateHistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/renderers.ts","webpack://LineUpJS/./src/ui/dialogs/BooleanFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalColorMappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalMappingFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ChangeRendererDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ColorMappingDialog.ts","webpack://LineUpJS/./src/internal/dnd.ts","webpack://LineUpJS/./src/ui/dialogs/MoreColumnOptionsDialog.ts","webpack://LineUpJS/./src/ui/header.ts","webpack://LineUpJS/./src/ui/dialogs/CompositeChildrenDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CutOffHierarchyDialog.ts","webpack://LineUpJS/./src/ui/dialogs/DateFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/EditPatternDialog.ts","webpack://LineUpJS/./src/ui/dialogs/GroupDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingLineDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/NumberFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/utils.ts","webpack://LineUpJS/./src/ui/dialogs/ReduceDialog.ts","webpack://LineUpJS/./src/ui/dialogs/RenameDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ScriptEditDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SearchDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ShowTopNDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SortDialog.ts","webpack://LineUpJS/./src/ui/dialogs/StringFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/WeightsEditDialog.ts","webpack://LineUpJS/./src/ui/toolbar.ts","webpack://LineUpJS/./src/ui/dialogs/groupNumber.ts","webpack://LineUpJS/./src/ui/dialogs/groupString.ts","webpack://LineUpJS/./src/ui/dialogs/groupDate.ts","webpack://LineUpJS/./src/config.ts","webpack://LineUpJS/./src/browser.ts","webpack://LineUpJS/./src/ui/dialogs/DialogManager.ts","webpack://LineUpJS/./node_modules/lineupengine/src/animation/index.js","webpack://LineUpJS/./src/ui/ALineUp.ts","webpack://LineUpJS/./node_modules/lineupengine/src/animation/KeyFinder.js","webpack://LineUpJS/./node_modules/lineupengine/src/internal/scroll.js","webpack://LineUpJS/./node_modules/lineupengine/src/internal/index.js","webpack://LineUpJS/./node_modules/lineupengine/src/logic.js","webpack://LineUpJS/./node_modules/lineupengine/src/mixin/IMixin.js","webpack://LineUpJS/./node_modules/lineupengine/src/styles/index.js","webpack://LineUpJS/./node_modules/lineupengine/src/ARowRenderer.js","webpack://LineUpJS/./node_modules/lineupengine/src/style/StyleManager.js","webpack://LineUpJS/./node_modules/lineupengine/src/style/GridStyleManager.js","webpack://LineUpJS/./node_modules/lineupengine/src/table/MultiTableRowRenderer.js","webpack://LineUpJS/./node_modules/lineupengine/src/mixin/PrefetchMixin.js","webpack://LineUpJS/./node_modules/lineupengine/src/table/internal/ACellAdapter.js","webpack://LineUpJS/./node_modules/lineupengine/src/table/ACellTableSection.js","webpack://LineUpJS/./src/ui/animation.ts","webpack://LineUpJS/./src/ui/RenderColumn.ts","webpack://LineUpJS/./src/ui/MultiLevelRenderColumn.ts","webpack://LineUpJS/./src/ui/interfaces.ts","webpack://LineUpJS/./src/ui/SelectionManager.ts","webpack://LineUpJS/./src/ui/EngineRanking.ts","webpack://LineUpJS/./src/ui/SlopeGraph.ts","webpack://LineUpJS/./src/ui/EngineRenderer.ts","webpack://LineUpJS/./src/ui/domElementCache.ts","webpack://LineUpJS/./src/ui/dialogs/ChooseRankingDialog.ts","webpack://LineUpJS/./src/ui/panel/SearchBox.ts","webpack://LineUpJS/./src/ui/dialogs/RenameRankingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MoreRankingOptionsDialog.ts","webpack://LineUpJS/./src/ui/dialogs/AddonDialog.ts","webpack://LineUpJS/./src/ui/panel/Hierarchy.ts","webpack://LineUpJS/./src/ui/panel/SidePanelEntryVis.ts","webpack://LineUpJS/./src/ui/panel/SidePanelRanking.ts","webpack://LineUpJS/./src/ui/panel/SidePanel.ts","webpack://LineUpJS/./src/ui/LineUp.ts","webpack://LineUpJS/./src/ui/taggle/rules.ts","webpack://LineUpJS/./src/ui/taggle/TaggleRenderer.ts","webpack://LineUpJS/./src/ui/taggle/Taggle.ts","webpack://LineUpJS/./src/builder/column/ColumnBuilder.ts","webpack://LineUpJS/./src/builder/LineUpBuilder.ts","webpack://LineUpJS/./src/builder/RankingBuilder.ts","webpack://LineUpJS/./src/builder/column/CategoricalColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/NumberColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/StringColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/DateColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/HierarchyColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/ActionsColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/BooleanColumnBuilder.ts","webpack://LineUpJS/./src/builder/DataBuilder.ts","webpack://LineUpJS/./src/builder/adapter/column.ts","webpack://LineUpJS/./src/builder/adapter/ranking.ts","webpack://LineUpJS/./src/builder/adapter/utils.ts","webpack://LineUpJS/./src/builder/adapter/lineup.ts","webpack://LineUpJS/./src/builder/adapter/builderAdapter.ts","webpack://LineUpJS/./src/model/index.ts","webpack://LineUpJS/./src/provider/RemoteDataProvider.ts","webpack://LineUpJS/./src/renderer/index.ts","webpack://LineUpJS/./src/index.ts","webpack://LineUpJS/./src/bundle.ts"],"names":["root","factory","exports","module","define","amd","window","enumerable","get","getter","value","key","bind","Object","prototype","hasOwnProperty","call","object","property","isArray","Array","keyList","keys","hasProp","equal","a","b","i","length","arrA","arrB","dateA","Date","dateB","getTime","regexpA","RegExp","regexpB","toString","reIsDeepProp","reIsPlainProp","reLeadingDot","rePropName","reEscapeChar","reIsHostCtor","freeGlobal","global","freeSelf","self","Function","uid","arrayProto","funcProto","objectProto","coreJsData","maskSrcKey","exec","IE_PROTO","funcToString","objectToString","reIsNative","replace","Symbol","splice","Map","getNative","nativeCreate","symbolProto","undefined","symbolToString","Hash","entries","index","this","clear","entry","set","ListCache","MapCache","assocIndexOf","array","other","baseGet","path","type","isSymbol","test","isKey","stringToPath","toKey","baseIsNative","isObject","func","tag","isFunction","result","e","isHostObject","toSource","getMapData","map","data","__data__","getValue","has","pop","push","memoize","string","baseToString","match","number","quote","resolver","TypeError","memoized","args","arguments","apply","cache","Cache","isObjectLike","defaultValue","defineProperty","BrowserInfo","name","version","os","NodeInfo","process","platform","BotInfo","bot","userAgentRules","operatingSystemRules","parseUserAgent","ua","matchedRule","reduce","matched","_a","browser","regex","uaMatch","versionParts","split","slice","concat","count","output","ii","createVersionParts","join","detectOS","getNodeVersion","detect","navigator","userAgent","Reflect","exporter","makeExporter","target","previous","configurable","writable","hasOwn","supportsSymbol","toPrimitiveSymbol","toPrimitive","iteratorSymbol","iterator","supportsCreate","create","supportsProto","__proto__","downLevel","HashMap","MakeDictionary","functionPrototype","getPrototypeOf","usePolyfill","env","_Map","cacheSentinel","arraySentinel","MapIterator","values","selector","_index","_keys","_values","_selector","next","done","throw","error","return","_cacheKey","_cacheIndex","_find","delete","size","getKey","getEntry","insert","indexOf","_","CreateMapPolyfill","_Set","Set","_map","add","Metadata","WeakMap","rootKey","CreateUniqueKey","_key","table","GetOrCreateWeakMapTable","CreateUUID","FillRandomBytes","buffer","Math","random","Uint8Array","crypto","getRandomValues","msCrypto","offset","byte","toLowerCase","CreateWeakMapPolyfill","GetOrCreateMetadataMap","O","P","Create","targetMetadata","IsUndefined","metadataMap","OrdinaryHasOwnMetadata","MetadataKey","OrdinaryGetOwnMetadata","OrdinaryDefineOwnMetadata","MetadataValue","OrdinaryOwnMetadataKeys","obj","method","GetMethod","IsCallable","IsObject","GetIterator","k","IteratorStep","nextValue","IteratorClose","Type","x","IsNull","ToPrimitive","input","PreferredType","hint","exoticToPrim","toString_1","valueOf","toString_2","OrdinaryToPrimitive","ToPropertyKey","argument","ToString","IsArray","IsConstructor","V","f","OrdinaryGetPrototypeOf","proto","prototypeProto","constructor","__","decorators","propertyKey","attributes","decorated","decorator","DecorateConstructor","descriptor","DecorateProperty","metadataKey","metadataValue","IsPropertyKey","OrdinaryHasMetadata","parent","OrdinaryGetMetadata","OrdinaryMetadataKeys","ownKeys","parentKeys","_i","ownKeys_1","parentKeys_1","extendStatics","d","setPrototypeOf","p","__extends","__assign","assign","t","s","n","__decorate","desc","c","r","getOwnPropertyDescriptor","decorate","isSeqEmpty","seq","every","isIndicesAble","it","Uint16Array","Uint32Array","Float32Array","Int8Array","Int16Array","Int32Array","Float64Array","filters","_length","l","forEach","filter","callback","LazyFilter","outer","valid","v","some","initial","acc","j","mapV","map12","ALazyMap","map23","map34","iterable","_arr","from","arr","lazySeq","LazySeq","seqs","shift","MAX_WORKER_THREADS","max","hardwareConcurrency","blob","workers","cleanUpWorkerTimer","workerTaskCounter","cleanUpWorker","toFree","findIndex","tasks","worker","terminate","finshedTask","w","Worker","refs","checkOutWorker","clearTimeout","emptyWorker","find","setTimeout","pushStats","refData","refIndices","indices","Promise","resolve","receiver","msg","removeEventListener","stats","addEventListener","postMessage","transferAbles","toResult","setRef","ref","broadCast","deleteRef","startsWith","deleteRefs","getNumberOfBins","ceil","log","LN2","min","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","extent","fill","quantile","NaN","floor","sort","pushAll","vs","boxplotBuilder","fixedLength","sum","missing","isNaN","pushAndSave","invalid","mean","whiskerHigh","whiskerLow","outlier","median","q1","q3","buildImpl","iqr","left","right","reversedOutliers","reverse","build","buildArr","normalizedStatsBuilder","numberOfBins","hist","x0","binWidth","x1","bin1","binN","low","high","center","toBin","maxBin","computeGranularity","histGranularity","getFullYear","minYear","maxYear","getMonth","getDay","setDate","getDate","setMonth","pushDateHist","dateStatsBuilder","template","byDay","templateHist","h","categoricalStatsBuilder","categories","m","cat","precision","round","scale","pow","similar","delta","abs","isPromiseLike","then","createIndexArray","dataSize","toIndexArray","maxDataIndex","joinIndexArrays","groups","total","createLike","g","sortComplex","comparators","asc","lookup","dateValueCache2Value","categoricalValueCache2Value","sortWorkerMain","wself","resolveRefs","msgHandlers","sortOrders","order","dateStats","categoricalStats","cats","numberStats","boxplotStats","evt","createWorkerBlob","fs","source","lastIndexOf","sources","Blob","URL","createObjectURL","equalArrays","ai","fixCSS","id","node","lastChild","removeChild","arrs","getSortLabel","String","noop","dispatch","Error","Dispatch","parseTypenames","typenames","types","trim","on","typename","T","copy","that","suffix","prefix","ECompareValueType","events","createEventList","listenerEvents","listeners","forwarder","fireImpl","primaryType","origin","listener","listenersChanged","Boolean","_type","_active","fire","context","forward","unforward","defaultGroup","color","othersGroup","item","group","isMultiLevelColumn","col","width","renderer","groupRenderer","summaryRenderer","visible","metadata","label","summary","description","fixed","frozen","assignNewId","idGenerator","fqid","fqpath","Column","EVENT_WIDTH_CHANGED","EVENT_LABEL_CHANGED","EVENT_METADATA_CHANGED","EVENT_VISIBILITY_CHANGED","EVENT_SUMMARY_RENDERER_TYPE_CHANGED","EVENT_RENDERER_TYPE_CHANGED","EVENT_GROUP_RENDERER_TYPE_CHANGED","EVENT_DIRTY","EVENT_DIRTY_HEADER","EVENT_DIRTY_VALUES","EVENT_DIRTY_CACHES","getWidth","hide","setVisible","show","isVisible","getVisible","flatten","_levelsToGo","_padding","setWidth","setWidthImpl","setMetaData","bak","getMetaData","sortByMe","ascending","priority","isSortingAscByDefault","findMyRanker","sortBy","groupByMe","toggleGrouping","isGroupedBy","getGroupCriteria","toggleMySorting","toggleSorting","isSortedByMeImpl","ranker","criterias","isSortedByMe","getSortCriteria","groupSortByMe","groupSortBy","toggleMyGroupSorting","toggleGroupSorting","isGroupSortedByMe","getGroupSortCriteria","removeMe","remove","attach","detach","insertAfterMe","insertAfter","dump","toDescRef","getRenderer","getGroupRenderer","getSummaryRenderer","restore","_factory","rendererType","getLabel","row","_row","getExportValue","format","getColor","toCompareValue","_valueCache","toCompareValueType","UINT8","toCompareGroupValue","_rows","toCompareGroupValueType","STRING","isFiltered","clearFilter","setRenderer","setGroupRenderer","setSummaryRenderer","markDirty","FLAT_ALL_COLUMNS","supportType","for","category","SupportType","SortByDefault","clazz","hasMetadata","ESortMethod","EAdvancedSortMethod","featureLevel","categorical","date","composite","support","Categories","Category","getSortType","categoryOf","dialogAddons","isSupportType","getMetadata","categoryOfDesc","models","isMapAbleColumn","getMapping","isNumberColumn","getNumber","isBoxPlotColumn","getBoxPlotData","isNumbersColumn","getNumbers","accessor","loaded","lazyLoaded","ValueColumn","EVENT_DATA_LOADED","isLoaded","getRaw","setLoaded","RENDERER_LOADING","_children","CompositeColumn","EVENT_FILTER_CHANGED","EVENT_ADD_COLUMN","EVENT_MOVE_COLUMN","EVENT_REMOVE_COLUMN","levelsToGo","padding","children","child","canJustAddNumbers","insertImpl","move","old","moveImpl","oldIndex","at","moveAfter","removeImpl","specifier","colors","extend","definition","Color","reI","reN","reP","reHex3","reHex6","reRgbInteger","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","Rgb","parseInt","rgbn","rgba","hsla","rgbConvert","o","rgb","opacity","hex","Hsl","hslConvert","hsl","hsl2rgb","m1","m2","displayable","brighter","darker","deg2rad","PI","rad2deg","labConvert","Lab","Hcl","cos","sin","z","rgb2lrgb","y","xyz2lab","lab","lab2xyz","lrgb2rgb","hclConvert","atan2","sqrt","hcl","A","B","C","D","E","ED","EB","BC_DA","cubehelixConvert","Cubehelix","bl","basis","t1","v0","v1","v2","v3","t2","t3","cosh","sinh","linear","constant","gamma","nogamma","exponential","start","end","rgbGamma","rgbSpline","spline","rgbBasis","nb","na","setTime","reA","reB","cssNode","cssRoot","cssView","svgNode","am","bm","bs","bi","lastIndex","q","degrees","identity","translateX","translateY","rotate","skewX","scaleX","scaleY","atan","interpolateTransform","parse","pxComma","pxParen","degParen","xa","ya","xb","yb","translate","document","createElement","documentElement","defaultView","style","transform","getComputedStyle","appendChild","getPropertyValue","decompose","createElementNS","setAttribute","baseVal","consolidate","matrix","SQRT2","hue","cubehelixGamma","cubehelix","cubehelixLong","scheme","ramp","warm","cool","ts","range","magma","inferno","plasma","toStringTag","list","addAll","console","assert","deleteAll","act","callbackfn","thisArg","integrateDefaults","defaults","typed","patternFunction","pattern","joinGroups","parents","gparents","unshift","subGroups","duplicateGroup","clone","isGroupParent","toGroupID","groupRoots","roots","EDirtyReason","MAX_COLORS","colorPool","mapIndices","everyIndices","forEachIndices","chooseUIntByDataLength","dataLength","UINT32","UINT16","sortCriteria","groupColumns","groupSortCriteria","columns","dirtyOrder","reason","Ranking","EVENT_DIRTY_ORDER","dirtyOrderSortDirty","SORT_CRITERIA_DIRTY","dirtyOrderGroupDirty","GROUP_CRITERIA_DIRTY","dirtyOrderGroupSortDirty","GROUP_SORT_CRITERIA_DIRTY","dirtyOrderFiltering","FILTER_CHANGED","index2pos","EVENT_GROUPS_CHANGED","EVENT_GROUP_CRITERIA_CHANGED","EVENT_GROUP_SORT_CRITERIA_CHANGED","EVENT_COLUMN_VISIBILITY_CHANGED","EVENT_SORT_CRITERIA_CHANGED","EVENT_ORDER_CHANGED","setLabel","setGroups","dirtyReason","oldGroups","unifyGroups","offsets","subarray","subs","gi","getRank","dataIndex","getOrder","getOrderLength","getGroups","sortColumn","help","setGroupCriteria","restoreSortCriteria","dumped","setSortCriteria","setGroupSortCriteria","getPrimarySortCriteria","toggleSortingLogic","newSort","current","defaultAsc","newGroupings","hierarchyLogic","groupBy","equalCriteria","COLUMN_SORT_DIRTY","triggerResort","column","cols","groupColumn","COLUMN_GROUP_DIRTY","COLUMN_GROUP_SORT_DIRTY","triggerGroupResort","sortCriterias","bakMulti","FORWARD_COLUMN_EVENTS","oldValue","newValue","reference","findByPath","isSortCriteria","sortCriteriaChanged","isGroupSortCriteria","groupSortCriteriaChanged","newGrouping","isGroupColumn","removed","idOrFilter","flatColumns","clearFilters","debounce","timeToDelay","choose","tm","ctx","createRankDesc","EAggregationState","ranking","RankColumn","createAggregateDesc","AggregateGroupColumn","EVENT_AGGREGATE","isAggregated","setAggregated","EXPAND","COLLAPSE","createSelectionDesc","SelectionColumn","EVENT_SELECT","setValue","setImpl","setValues","rows","setterAll","setter","toggleValue","BINARY","isSelected","SELECTED_GROUP","NOT_SELECTED_GROUP","createActionDesc","actions","groupActions","compare","ActionColumn","isMissingValue","isUnknown","EAlignment","EStringGroupCriteriaType","missingGroup","currentFilter","currentGroupCriteria","alignment","escape","StringColumn","EVENT_GROUPING_CHANGED","groupCriteria","filterMissing","FILTER_MISSING","ff","includes","getFilter","setFilter","was","groupValue","_group","valueCache","annotations","AnnotateColumn","EVENT_VALUE_CHANGED","DEFAULT_CATEGORICAL_COLOR_FUNCTION","toJSON","eq","ReplacmentColorMappingFunction","restoreCategoricalColorMapping","toCategory","nextColor","COMPARE_CATEGORY_VALUE_TYPES","FLOAT_ASC","toGroupCompareCategoryValue","mostFrequent","topCat","topCount","findMostFrequent","getCategory","COMPARE_GROUP_CATEGORY_VALUE_TYPES","FLOAT","compareCategory","aNull","bNull","localeCompare","toCategories","isEmptyFilter","isEqualCategoricalFilter","al","arrayEquals","isCategoryIncluded","filterObj","colorMapping","CategoricalColumn","EVENT_COLOR_MAPPING_CHANGED","getCategories","getValues","getLabels","getMap","getMapLabel","getSet","iterCategory","categoricalColorMappingFunction","getColorMapping","setColorMapping","mapping","trueMarker","GROUP_TRUE","GROUP_FALSE","BooleanColumn","enabled","_dataLength","originalLabels","labels","_d","ArrayColumn","BooleansColumn","getColors","toExponential","coefficient","formatDecimal","re","formatSpecifier","FormatSpecifier","align","sign","symbol","zero","comma","prefixExponent","exponent","toFixed","toPrecision","formatRounded","toUpperCase","prefixes","locale","grouping","thousands","substring","currency","decimal","numerals","formatNumerals","percent","newFormat","formatTypes","formatType","maybeSuffix","valuePrefix","valueSuffix","valueNegative","out","i1","i0","formatTrim","charCodeAt","Infinity","formatPrefix","lo","hi","mid","ascendingBisect","bisector","bisectRight","bisect","e10","e5","e2","ticks","step","stop","tickIncrement","isFinite","power","LN10","tickStep","step0","step1","initRange","domain","each","empty","normalize","clamper","bimap","interpolate","d0","d1","r0","r1","polymap","clamp","unknown","transformer","untransform","piecewise","rescale","invert","rangeRound","u","continuous","precisionPrefix","precisionRound","precisionFixed","linearish","tickFormat","nice","interval","transformLog","transformExp","exp","transformLogn","transformExpn","pow10","reflect","loggish","logs","pows","base","log10","log2","logp","powp","transformPow","transformSqrt","transformSquare","powish","newInterval","floori","offseti","field","getMilliseconds","getUTCSeconds","getSeconds","getMinutes","getHours","setHours","getTimezoneOffset","weekday","sunday","monday","tuesday","wednesday","thursday","friday","saturday","setFullYear","utcMinute","setUTCSeconds","getUTCMinutes","utcHour","setUTCMinutes","getUTCHours","utcDay","setUTCHours","setUTCDate","getUTCDate","utcWeekday","getUTCDay","utcSunday","utcMonday","utcTuesday","utcWednesday","utcThursday","utcFriday","utcSaturday","utcMonth","setUTCMonth","getUTCMonth","getUTCFullYear","utcYear","setUTCFullYear","localDate","H","M","S","L","utcDate","UTC","newYear","timeFormat","timeParse","utcFormat","utcParse","pads","numberRe","percentRe","requoteRe","requote","formatRe","names","formatLookup","parseWeekdayNumberSunday","parseWeekdayNumberMonday","parseWeekNumberSunday","U","parseWeekNumberISO","parseWeekNumberMonday","W","parseFullYear","parseYear","parseZone","Z","parseMonthNumber","parseDayOfMonth","parseDayOfYear","parseHour24","parseMinutes","parseSeconds","parseMilliseconds","parseMicroseconds","parseLiteralPercent","parseUnixTimestamp","Q","parseUnixTimestampSeconds","formatDayOfMonth","formatHour24","formatHour12","formatDayOfYear","formatMilliseconds","formatMicroseconds","formatMonthNumber","formatMinutes","formatSeconds","formatWeekdayNumberMonday","day","formatWeekNumberSunday","formatWeekNumberISO","formatWeekdayNumberSunday","formatWeekNumberMonday","formatFullYear","formatZone","formatUTCDayOfMonth","formatUTCHour24","formatUTCHour12","formatUTCDayOfYear","formatUTCMilliseconds","getUTCMilliseconds","formatUTCMicroseconds","formatUTCMonthNumber","formatUTCMinutes","formatUTCSeconds","formatUTCWeekdayNumberMonday","dow","formatUTCWeekNumberSunday","formatUTCWeekNumberISO","formatUTCWeekdayNumberSunday","formatUTCWeekNumberMonday","formatUTCYear","formatUTCFullYear","formatUTCZone","formatLiteralPercent","formatUnixTimestamp","formatUnixTimestampSeconds","locale_dateTime","dateTime","locale_date","locale_time","time","locale_periods","periods","locale_weekdays","days","locale_shortWeekdays","shortDays","locale_months","months","locale_shortMonths","shortMonths","periodRe","periodLookup","weekdayRe","weekdayLookup","shortWeekdayRe","shortWeekdayLookup","monthRe","monthLookup","shortMonthRe","shortMonthLookup","formats","utcFormats","parses","parseSpecifier","pad","charAt","newParse","newDate","week","X","formatLocale","toISOString","toScale","fixDomain","getRange","ScaleMappingFunction","code","value_min","value_max","value_range","value_domain","mi","ma","ScriptMappingFunction","restoreMapping","mappingFunction","mappingFunctions","script","pow2","pow3","DEFAULT_FORMATTER","toCompareBoxPlotValue","getSortMethod","getBoxPlotNumber","mode","getRawBoxPlotData","numberCompare","aMissing","bMissing","FIRST_IS_NAN","isEqualNumberFilter","isNumberIncluded","isDummyNumberFilter","restoreNumberFilter","numberFormat","currentGroupThresholds","groupSortMethod","original","colorMappingFunction","NumberColumn","getNumberFormat","stratifyThreshholds","stratifyThresholds","EVENT_MAPPING_CHANGED","EVENT_SORTMETHOD_CHANGED","raw","getRawValue","iterNumber","iterRawNumber","getRawNumber","sortMethod","getOriginalMapping","setMapping","getGroupThresholds","setGroupThresholds","threshold","treshholdIndex","setSortMethod","BoxPlotColumn","byKey","toKeyValue","MapColumn","CategoricalMapColumn","parseValue","getCategoryMap","CategoricalsColumn","shiftFilterDateDay","setMinutes","setSeconds","setMilliseconds","toDateGroup","grouper","granularity","centuryP","circular","century","decadeP","decade","year","chooseAggregatedDate","dates","trueMedian","EDateSort","currentGrouper","dateFormat","DEFAULT_DATE_FORMAT","dateParse","DateColumn","getFormatter","iterDate","DOUBLE_ASC","getDateGrouper","setDateGrouper","DatesColumn","getDates","av","EGroupSortMethod","DatesMapColumn","getDateMap","createGroupDesc","GroupColumn","COUNT","currentMaxDepth","currentLeaves","currentLeavesNameCache","currentLeavesPathCache","hierarchySeparator","hierarchy","initHierarchy","currentNode","computeLeaves","updateCaches","HierarchyColumn","EVENT_CUTOFF_CHANGED","maxDepth","cutOffNode","getCutOff","setCutOff","leaves","visit","depth","resolveInnerNodes","queue","isHierarchical","deriveHierarchy","SequentialColorFunction","FUNCTIONS","interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds","interpolateCool","interpolateCubehelixDefault","interpolateWarm","interpolatePlasma","interpolateMagma","interpolateViridis","interpolateInferno","interpolateYlOrRd","interpolateYlOrBr","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateRainbow","DivergentColorFunction","interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral","UnknownColorFunction","SolidColorFunction","steps","perStep","QuantizedColorFunction","CustomColorMappingFunction","DEFAULT_COLOR_FUNCTION","createImpositionDesc","ImpositionCompositeColumn","wrapper","rest","NumbersColumn","getRawNumbers","CENTER","createImpositionBoxPlotDesc","ImpositionBoxPlotColumn","createImpositionsDesc","ImpositionCompositesColumn","compute","CompositeNumberColumn","createReduceDesc","ReduceColumn","selected","EVENT_REDUCE_CHANGED","getReduce","setReduce","createStackDesc","collapsed","adaptChange","adaptWidthChange","StackColumn","weights","getWeights","EVENT_COLLAPSE_CHANGED","EVENT_WEIGHTS_CHANGED","EVENT_MULTI_LEVEL_CHANGED","setCollapsed","getCollapsed","weight","full","oldWeight","factor","widths","guess","setWeights","COLLAPSED_RENDERER","MultiLevelCompositeColumn","createNestedDesc","NestedColumn","NumberMapColumn","OrdinalColumn","DEFAULT_SCRIPT","createScriptDesc","allFactory","_all","byName","byID","byIndex","ScriptColumn","EVENT_SCRIPT_CHANGED","setScript","getScript","clean","raws","ColumnContext","ColumnWrapper","separator","SetColumn","getSortedSet","sv","cardinality","getMapValue","StringMapColumn","StringsColumn","patternTemplates","LinkColumn","setPattern","EVENT_PATTERN_CHANGED","getPattern","getLink","href","transformValue","alt","getLinkMap","LinkMapColumn","LinksColumn","getLinks","ABORTED","thenFactory","loader","isAborted","abort","onfulfilled","_onrejected","loadedOrAborted","res","aborted","aborter","race","abortAbleAll","all","values_1","isAbortAble","abortAble","isAsyncUpdate","update","ready","SCHEMA_REF","isComplexAccessor","resolveValue","rowComplexGetter","rowGetter","rowGuessGetter","cleanCategories","isEmpty","deriveBaseType","options","warn","datePattern","treatAsCategorical","categoricalThreshold","deriveType","primitive","vi","first","mapAll","vii","sameLength","hasDifferentSizes","deriveColumnDescriptions","config","existing","exclude","selectColumns","foundRow","toLabel","deriveColors","exportRanking","opts","newline","header","quoteChar","verboseColumnHeaders","rangeSelection","provider","rankingId","relIndex","ctrlKey","getRankings","selection","getSelection","nearest","distance","setSelection","toDirtyReason","UNKNOWN","SORT_CRITERIA_CHANGED","GROUP_CRITERIA_CHANGED","GROUP_SORT_CRITERIA_CHANGED","mergeDirtyOrderContext","currentReason","nextReason","combined","rankings","aggregations","columnTypes","colorMappingFunctionTypes","mappingFunctionTypes","singleSelection","showTopN","aggregationStrategy","aggregate","annotate","boolean","booleans","boxplot","categoricalMap","categoricals","dateMap","imposition","impositionBoxPlot","impositions","nested","numbers","numberMap","ordinal","rank","stack","stringMap","strings","link","linkMap","links","quantized","custom","colorMappingFunctions","typeFactory","createTypeFactory","fromDescRef","fixDesc","instantiateColumn","typeName","createColorMappingFunction","getTypeFactory","ADataProvider","EVENT_DATA_CHANGED","EVENT_BUSY","EVENT_SHOWTOPN_CHANGED","EVENT_ADD_RANKING","EVENT_REMOVE_RANKING","EVENT_SELECTION_CHANGED","EVENT_ADD_DESC","EVENT_CLEAR_DESC","EVENT_JUMP_TO_NEAREST","EVENT_GROUP_AGGREGATION_CHANGED","pushRanking","cloneRanking","insertRanking","fireBusy","busy","takeSnapshot","hasString","hasColumn","toClone","FORWARD_RANKING_EVENTS","triggerReorder","paths","removeDuplicates","level","real","unifyParents","initAggregateState","removeRanking","cleanUpRanking","clearRankings","getFirstRanking","getLastRanking","ensureOneRanking","destroy","_ranking","nextId","select","deselect","selectAll","deselectAll","getAggregationState","setAggregationState","cleanDesc","dumpColumn","restoreColumn","descRef","restoreRanking","object2Map","deriveDefault","addSupportType","getColumns","getTopNAggregated","EXPAND_TOP_N","setTopNAggregated","unaggregateParents","getAggregationStrategy","aggregateAllOf","aggregateAll","getShowTopN","setShowTopN","jumpToNearest","selectAllOf","clearSelection","toggleSelection","additional","selectedRows","view","exportTable","injectAccessor","rankingIndex","nextRankingId","pushDesc","clearColumns","findDesc","missingFloat","missingFloatAsc","toCompareLookUp","rawLength","INT8","INT16","INT32","DOUBLE","createSetter","missingCount","isSorting","valueCaches","criteria","chooseMissingByLength","ri","pushValues","free","ANOTHER_ROUND","oneShotIterator","calc","wrappee","onrejected","taskId","runTasks","deadline","task","didTimeout","timeRemaining","requestAnimationFrame","reSchedule","ww","requestIdleCallback","pushMulti","abortOrDummy","isAbortedOrDummy","abortAll","clearIdleCallback","onfullfilled","taskNow","TaskNow","taskLater","TaskLater","tasksAll","_joined","valueCacheData","byOrder","byOrderAcc","builder","orders","currentChunkSize","chunkCounter","actOrder","builderForEach","numberStatsBuilder","dacc","setValueCacheData","dateValueCacheBuilder","name2index","categoricalValueCacheBuilder","dirtyColumn","sortDirect","lookups","setData","dirtyRanking","preCompute","preComputeData","preComputeCol","copyData2Summary","copyCache","fromPrefix","tkey","_singleCall","groupCompare","rg","groupRows","_col","groupExampleRows","groupBoxPlotStats","groupNumberStats","groupCategoricalStats","groupDateStats","summaryBoxPlotStats","summaryBoxPlotStatsD","summaryNumberStats","summaryNumberStatsD","summaryCategoricalStats","summaryCategoricalStatsD","summaryDateStats","summaryDateStatsD","cached","dataNumberStats","dataBoxPlotStats","dataCategoricalStats","dataDateStats","creator","dontCache","isMapColumn","endsWith","isArrayColumn","isCategoricalLikeColumn","isSetColumn","isCategoricalColumn","isCategoricalsColumn","isCategory","isDateColumn","isDatesColumn","ERenderMode","WorkerTaskScheduler","checker","ogroups","multi","chainCopy","chain","joined","canAbort","isValidCacheEntry","subTask","created","valueCacheKey","singleCall","indexArray","toTransfer","_data","ooptions","filterGlobally","jumpToSearchResult","taskExecutor","mapToDataRow","_dataRows","toRows","reorderAll","getTotalNumberOfRows","getTaskExecutor","dataChanged","clearData","appendData","trackRanking","addKey","removeKey","removeCol","addCol","resolveFilter","noSorting","createSorter","needsFiltering","needsGrouping","needsSorting","groupOrder","pushGroup","groupKey","groupCaches","filterCaches","toGroup","fc","before","sortGroup","groupLookup","singleGroup","sortTask","groupSortTask","groupC","sortGroups","enforceSorting","groupIndices","reasons","needsGroupSorting","isSortedBy","isGroupedSortedBy","sortedGroups","viewRaw","viewRawRows","getRow","mappingSample","searchAndJump","search","styles","getStyle","COLUMN_PADDING","FILTERED_OPACITY","parseFloat","DASH","height","UPSET","inactive","DOT","BOX_PLOT","box","stroke","AGGREGATE","strokeWidth","levelOffset","levelWidth","SLOPEGRAPH_WIDTH","CSS_PREFIX","RESIZE_SPACE","RESIZE_ANIMATION_DURATION","cssClass","engineCssClass","ENGINE_CSS_PREFIX","aria","text","noRenderer","setText","textContent","querySelectorAll","forEachChild","matchColumns","childElementCount","dataset","columnId","rendererId","idsAndRenderer","idAndRenderer","cnode","querySelector","asElement","classList","innerHTML","wideEnough","wideEnoughCat","adaptColorCache","adaptTextColorToBgColor","bgColor","adaptDynamicColorToBgColor","title","adapt","innerText","span","ownerDocument","uniqueId","idCounter","exampleText","examples","multiLevelGridCSSClass","idPrefix","canRender","SUMMARY","className","icon","ni","onclick","event","preventDefault","stopPropagation","action","createGroup","createSummary","isAlwaysShowingGroupStrategy","strategy","toItemMeta","relativeIndex","topN","groupParents","meta","prev","prevMeta","groupEndLevel","topNGetter","last","isSummaryGroup","matchNodes","addTopN","doc","renderGroups","isRow","isLeafGroup","alwaysShowGroup","isSummary","hasTopN","hasTopNStrategy","lastParent","state","isLastGroup","toggle","isCollapsed","isFirst","isShowAll","childTopN","nextState","isDummyGroup","render","fillStyle","fillRect","filterMissingMarkup","bakMissing","filterMissingNumberMarkup","findFilterMissing","getElementsByClassName","previousElementSibling","updateFilterMissingNumberMarkup","element","getElementsByTagName","disabled","lastElementChild","renderMissingValue","dashX","dashY","renderMissingDOM","renderMissingCanvas","interactiveSummary","form","isRegex","checked","onchange","oninput","onsubmit","actCol","_context","interactive","StringCellRenderer","firstElementChild","imposer","valueHint","renderValue","CELL","colWidth","bar","backgroundColor","groupTitle","summaryTitle","_mode","BOXPLOT","MAPPED_BOXPLOT","sortedByMe","renderDOMBoxPlot","topPadding","strokeStyle","beginPath","rect","bottomPos","middlePos","moveTo","lineTo","renderBoxPlot","isMissing","_interactive","mappedSummary","rawSummary","hasRange","computeLabel","whiskers","nextElementSibling","leftWhisker","rightWhisker","display","outliers","numOutliers","insertAdjacentElement","toHeatMapColor","valueColor","filterUpdate","interactiveHist","staticSummary","showLabels","bins","gHist","inner","gCount","relY","background","setCategoricalFilter","markFilter","bin","included","contained","parentElement","createContext","cellDimension","mover","offsetX","getContext","canvas","clearRect","onmousemove","onmouseleave","maps","toMostFrequentCategoricals","templateRows","selectedCol","stackedBar","gBins","flexGrow","getCanvasRenderer","pi2","radius","save","globalAlpha","arc","getDOMRenderer","dots","tmp","top","formatter","seq1","seq2","ConcatSequence","concatSeq","_ctx","normalized","templateRow","ANumbersCellRenderer","_hist","isBrowser","longerTimeoutBrowsers","timeoutDuration","fn","called","scheduled","functionToCheck","getStyleComputedProperty","nodeType","css","getParentNode","nodeName","parentNode","host","getScrollParent","body","_getStyleComputedProp","overflow","overflowX","overflowY","isIE11","MSInputMethodContext","documentMode","isIE10","isIE","getOffsetParent","noOffsetParent","offsetParent","getRoot","findCommonOffsetParent","element1","element2","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","createRange","setStart","setEnd","commonAncestorContainer","contains","element1root","getScroll","side","upperSide","html","scrollingElement","includeScroll","subtract","scrollTop","scrollLeft","modifier","bottom","getBordersSize","axis","sideA","sideB","getSize","computedStyle","getWindowSizes","classCallCheck","instance","Constructor","createClass","defineProperties","props","protoProps","staticProps","_extends","getClientRect","getBoundingClientRect","sizes","clientWidth","clientHeight","horizScrollbar","offsetWidth","vertScrollbar","offsetHeight","getOffsetRectRelativeToArbitraryNode","fixedPosition","isHTML","childrenRect","parentRect","scrollParent","borderTopWidth","borderLeftWidth","marginTop","marginLeft","getViewportOffsetRectRelativeToArtbitraryNode","excludeScroll","relativeOffset","innerWidth","innerHeight","isFixed","getFixedPositionOffsetParent","el","getBoundaries","popper","boundariesElement","boundaries","boundariesNode","_getWindowSizes","isPaddingNumber","getArea","_ref","computeAutoPlacement","placement","refRect","rects","sortedAreas","area","filteredAreas","_ref2","computedPlacement","variation","getReferenceOffsets","commonOffsetParent","getOuterSizes","marginBottom","marginRight","getOppositePlacement","hash","getPopperOffsets","referenceOffsets","popperRect","popperOffsets","isHoriz","mainSide","secondarySide","measurement","secondaryMeasurement","check","runModifiers","modifiers","ends","prop","cur","isDestroyed","arrowStyles","flipped","positionFixed","flip","originalPlacement","position","isCreated","onUpdate","onCreate","isModifierEnabled","modifierName","getSupportedPropertyName","upperProp","toCheck","removeAttribute","willChange","disableEventListeners","removeOnDestroy","getWindow","setupEventListeners","updateBound","passive","scrollElement","attachToScrollParents","scrollParents","isBody","eventsEnabled","enableEventListeners","scheduleUpdate","cancelAnimationFrame","isNumeric","setStyles","unit","isFirefox","isModifierRequired","requestingName","requestedName","requesting","isRequired","_requesting","requested","placements","validPlacements","clockwise","counter","BEHAVIORS","parseOffset","basePlacement","useHeight","fragments","frag","divider","splitRegex","ops","op","mergeWithPrevious","str","toValue","index2","Defaults","shiftvariation","_data$offsets","isVertical","shiftOffsets","preventOverflow","transformProp","popperStyles","primary","escapeWithReference","secondary","keepTogether","opSide","arrow","_data$offsets$arrow","arrowElement","len","sideCapitalized","altSide","arrowElementSize","popperMarginSide","popperBorderSide","sideValue","placementOpposite","flipOrder","behavior","refOffsets","overlapsRef","overflowsLeft","overflowsRight","overflowsTop","overflowsBottom","overflowsBoundaries","flippedVariationByRef","flipVariations","flippedVariationByContent","flipVariationsByContent","flippedVariation","getOppositeVariation","subtractLength","bound","computeStyle","legacyGpuAccelerationOption","gpuAcceleration","offsetParentRect","shouldRound","noRound","referenceWidth","popperWidth","isVariation","horizontalToInteger","verticalToInteger","getRoundedOffsets","devicePixelRatio","prefixedProperty","invertTop","invertLeft","applyStyle","onLoad","modifierOptions","Popper","_this","jquery","Utils","PopperUtils","bKeys","dialogContext","attachment","currentTarget","manager","dialogManager","dialog","livePreview","popup","toggleDialog","cancelSubDialogs","autoClose","showLivePreviews","livePreviews","enableLivePreviews","submitter","submit","equals","appendDialogButtons","insertAdjacentHTML","open","removeLike","closest","auto","focus","reset","triggerSubmit","cancel","removeAboveLevel","checkValidity","findInput","cleanUp","triggerDialogClosed","ioptions","valueAsNumber","dragHandle","handle","container","onStart","onDrag","onEnd","minDelta","ueberElement","toContainerRelative","elem","clientLeft","handleShift","mouseMove","clientX","mouseUp","onmousedown","filteredColor","histogramTemplate","guessedBins","histogramUpdate","unfiltered","colorOf","nodes","matchBins","mappingHintTemplate","mappingHintUpdate","filteredHistTemplate","filterMin","filterMax","formatRaw","initFilter","minHint","maxHint","minValue","parseRaw","maxValue","minImpl","edit","shiftKey","ondblclick","maxImpl","button","px","unpercent","getHistDOMRenderer","updateFilter","fContext","createFilterContext","createFilterInfo","dialogCtx","maxLevel","backgroundImage","src","image","Image","onload","single","aggregatedIndex","createData","stacked","GROUP","toWait","missingWeight","ci","gridColumnStart","stackShift","cr","callbacks","sorted","medianIndex","rr","summaries","grouped","sample","dummyBin","groupedHist","LinkCellRenderer","createFixed","TableCellRenderer","example","createFixedGroup","groupByKey","LinkMapCellRenderer","fromTSpan","toTSpan","unselected","unchecked","createDOMContext","posx","moveNext","yPos","repeat","matchRows","calculateSetPath","catindexes","line","hasTrueValues","CANVAS_HEIGHT","tooltipPrefix","one","xpos","chosen","valueAsDate","dummyDomain","now","createDateFilter","applyFilter","summaryNode","rerender","defaultCellRenderer","brightness","catdistributionbar","circle","default","dot","heatmap","catheatmap","histogram","datehistogram","interleaving","loading","mapbars","sparkline","upset","verticalbar","isTrue","isFalse","sets","schemeCategory10","schemeAccent","schemeDark2","schemePastel1","schemePastel2","schemeSet1","schemeSet2","schemeSet3","someMode","noFilter","joint","items","currentGroup","currentSummary","createTemplate","wrapped","gradient","isCustom","applyColor","s0","s1","dm1","toColor","content","toggles","customs","updateColor","updateSelectedColor","continuouos","continuouos2","quantized2","steps2","updateGradients","steppedGradient","di","stepSize","half","hasDnDType","available","dataTransfer","typesToCheck","dndTransferStorage","isEdgeDnD","updateDropEffect","dT","effectAllowed","copyDnD","dropEffect","dropAble","mimeTypes","onDrop","onDragOver","canDrop","effect","getData","mime","colId","addIcon","addIconDOM","getToolbar","isActionMode","createToolbarMenuItems","updateIconState","createHeader","dragAble","mergeDropAble","rearrangeAble","resizeable","extraPrefix","extra","createShortcutMenuItems","toggleToolbarIcons","dragAbleColumn","resolveDrop","MIMETYPE_PREFIX","alternative","JSON","pushChild","mergeImpl","mergeWith","numberish","draginfo","toInsertParent","rearrangeDropAble","sizeHelper","currentFooterTransformation","originalWidth","dragWidth","updateHeader","minWidth","sublabel","typeCat","updateMoreDialogIcons","groupedBy","active","actionCSSClass","showLabel","featureCategory","setHighlightColumn","onClick","willAutoHide","toolbar","shortcuts","hybrids","moreEntries","defaultVisibleClientWidth","rotated","scrollWidth","toggleRotatedHeader","availableWidth","shortCuts","moreIcon","needMore","onDragStart","draggable","payload","over","stringify","substr","createChildren","innerNodes","innerNodePaths","setCustomValidity","newNode","newNodeIndex","maxDepthText","handler","templates","handlers","getToolbarDialogAddons","addon","append","updateDisabled","disable","elems","sortOrder","adapter","unnormalizeRaw","normalizeRaw","common","updated","openDialog","handled","destroyed","trigger","mappingLines","mappingAdapter","updateLines","computeScale","rawDomain","scaleType","others","bb","copyMapping","createMappings","selectedIndex","patchedDomain","getAttribute","createNumberFilter","sortMethods","methods","checkbox","toInput","inputs","updateBar","distributeWeights","missingIndices","validWeights","buttons","reportValidity","ui","uiDialog","dialogClass","extraArgs","uiSortMethod","isAscByDefault","sortGroupBy","rename","vis","_evt","removeAll","toggleCompressExpand","mcol","compress","expand","toolbarDialogAddons","sortNumber","sortNumbers","sortBoxPlot","sortDates","groupNumber","isThreshold","thresholds","groupString","valueRadioButton","startsWithRadioButton","regexRadioButton","showOrHideTextarea","newType","groupDate","toolbarActions","filterNumber","filterDate","filterString","filterCategorical","filterOrdinal","filterBoolean","colorMapped","colorMappedCategorical","cutoff","editMapping","editPattern","editWeights","compositeContained","splitCombined","invertSelection","ss","sortActions","getFullToolbar","caches","toolbarIcon","getOwnMetadata","getAllToolbarActions","possible","getPossibleRenderer","resolveToolbarActions","flags","advancedModelFeatures","advancedRankingFeatures","advancedUIFeatures","cacheKey","cacheAddon","toolbarAddons","getAllToolbarDialogAddons","resolveToolbarDialogAddons","defaultOptions","renderers","labelRotation","summaryHeader","animated","expandLineOnHover","sidePanel","sidePanelCollapsed","hierarchyIndicator","defaultSlopeGraphMode","overviewMode","groupSort","onDialogBackgroundClick","rowHeight","groupHeight","groupPadding","rowPadding","levelOfDetail","customRowUpdate","dynamicHeight","disableFrozenColumns","ignoreUnsupportedBrowser","getUnsupportedBrowserError","info","fVersion","EAnimationMode","escKeyListener","which","removeLast","openDialogs","DialogManager","EVENT_DIALOG_CLOSED","EVENT_DIALOG_OPENED","setHighlight","mask","clipPath","webkitClipPath","clearHighlight","takeDown","setUp","ignoreIncompatibleBrowser","highlightListeners","isBrowserSupported","ALineUp","EVENT_HIGHLIGHT_CHANGED","setDataProvider","dataIndices","enableHighlightListening","_enable","defaultPhases","delay","nodeY","animation","SHOW","HIDE","UPDATE_REMOVE","KeyFinder","lastFilled","key2index","exceptions","findValidStart","posByKey","pos","fillCacheTillKey","defaultRowHeight","fillCache","heightOf","exceptionsLookup","exceptionHeightOf","returnDefault","numberOfRows","positions","ScrollHandler","sync","timer","handleAnimationImpl","handleAnimation","handleTimeouts","asInfo","isWaiting","addScroll","scroller","__le_scroller__","isScrollEventWaiting","EScrollResult","RowHeightException","nonUniformContext","rowHeights","mostFrequentValue","totalHeight","between","heightExceptions","firstRowPos","endPos","y2","offset2","indexShift","offsetShift","isGuess","shifted2","lastPos","heightExceptions_1","firstException","lastException","updateFrozen","oldLast","added","PREFIX","CSS_CLASS_LOADING","CSS_CLASS_FROZEN","CSS_CLASS_HIDDEN","CSS_CLASS_MULTI","CSS_CLASS_EVEN","CSS_CLASS_SHIFTED","CSS_CLASS_SCROLLBAR_TESTER","CSS_CLASS_HEADER","CSS_CLASS_BODY","CSS_CLASS_FOOTER","CSS_CLASS_THEAD","CSS_CLASS_TBODY","CSS_CLASS_TR","CSS_CLASS_TH","CSS_CLASS_TD","CSS_CLASS_SCROLLING","CSS_CLASS_ROW_ANIMATION","isLoadingCell","ARowRenderer","pool","loadingPool","forcedFirst","forcedLast","visibleFirstRowPos","scrollListener","lastScrollInfo","abortAnimation","async","minScrollDelta","mixins","scrollingHint","batchSize","striped","viewportOversize","createAdapter","mixinClass","fragment","createDocumentFragment","addMixin","addAtBeginning","addAtBottom","removeFromBeginning","removeFromBottom","updateOffset","bodyScroller","scrollOffset","scrollTotal","sizer","tagName","insertBefore","firstChild","init","isGoingDown","onScrolledVertically","recreate","updateRow","createRow","selectProxy","proxy","recycle","replaceChild","_b","ex","perform","torecycle","forEachRow","inplace","to","fromBeginning","nextSibling","previousSibling","updateSizer","setTransform","bodySizer","recreateAnimated","recreatePure","clearPool","previousKey","currentKey","rows_1","UPDATE","UPDATE_CREATE","nodeYCurrentHeight","nextPos","prevHeight","animate","phases","previousFinder","currentFinder","currentTimer","actPhase","executePhase","phase","anim","run","offsetTop","dummyAnimation","previousHeight","currentHeight","curr","revalidate","shiftTop","scrollResult","onScrolledImpl","onScrolled","shiftLast","currentDelta","shiftFirst","currentFirstRow","NONE","toadd","SOME","toaddBottom","ALL","SOME_TOP","SOME_BOTTOM","manipulate","toRecycle","toAdd","toRecycle_1","anyelem","__transform__","assignStyles","plain","hyphen","setProperty","tableIds","tableId","thead","tbody","tr","th","td","tableCSSClasses","ids","_super","GridStyleManager","cssClasses","headerScroller","measureScrollbar","updateRule","borderRight","frozenShift","selectors","updateColumns","deleteRule","rules","ruleNames","cssSelectors","thStyles","tdStyles","StyleManager","testVerifyTimeout","createTextNode","verifySheet","sheet","cssRules","selectorText","rule","insertRule","cssRule","getSheetRule","addRule","stored","MultiTableRowRenderer","htmlId","sections","columnPadding","main","isGoingRight","onScrolledHorizontally","scrollEnd","headerFooter","bodyFooter","maxHeight","pushTable","extras","pushSeparator","section","widthChanged","PrefetchMixin","prefetchTimeout","cleanupTimeout","prefetchRows","cleanUpRows","prefetchDown","nextLast","prefetchUp","syncFrozen","triggerPrefetch","prefetchDownPossible","prefetchUpPossible","isLast","cleanUpTop","newFirst","cleanUpBottom","newLast","triggerCleanUp","ACellAdapter","mixinClasses","cellPool","visibleColumns","visibleFirstColumnPos","horizontallyShifted","columnAdapter","createColumnAdapter","columnMixins","columnFragment","leftShift","addColumnMixin","addColumnAtStart","addColumnAtEnd","removeColumnFromStart","removeColumnFromEnd","updateColumnOffset","onScrolledHorizontallyImpl","removeCellFromStart","recycleCell","removeCellFromEnd","removeFrozenCells","columnIndices","columnIndices_1","columnIndex","removeFrozenColumns","removeAllColumns","includingFrozen","removeAllCells","frozen_1","frozen_2","selectProxyCell","columnObj","pooled","updateCell","createCell","updateShiftedState","handleCellReady","selectCell","rowIndex","addCellAtStart","cell","insertFrozenCells","columnIndices_2","insertFrozenColumns","addCellAtEnd","verifyRows","verifyRow","updateHeaders","fragment_1","document_1","ids_1","firstColumnPos","changed","id_1","mergeColumns","updateImpl","cell_1","byId","updateShiftedStates","shifted","headers","bodies","headers_1","bodies_1","headers_2","_c","bodies_2","shiftingChanged","colObjs","ACellTableSection","LocalCell","hidden","onVisibilityChanged","updateShifts","_left","_visible","wasHidden","updateColumnWidths","oldLeft","toGroupLookup","item2groupIndex","group2firstItemIndex","lineupAnimation","previousData","currentData","prevHelper","currHelper","currentRowIndex","referenceIndex","appearPosition","_previousFinder","previousRowIndex","removePosition","singleRenderer","singleTemplate","cloneNode","singleId","groupTemplate","groupId","summaryTemplate","summaryId","hasSummaryLine","isGroup","oldRenderer","currentRenderer","oldGroup","getGroup","chainAbortAble","renderCell","mapper","mapped","EMode","mc","updateNested","matchChildren","cc","updateWidthRule","gridTemplateColumns","sub","hr","showHint","startNode","elementFromPoint","clientY","endNode","xShift","yShift","SelectionManager","EVENT_SELECT_RANGE","startIndex","endIndex","sy","ey","MIN_DISTANCE","selectRange","updateState","selectedDataIndices","RankingEvents","EVENT_UPDATE_DATA","EVENT_RECREATE","PASSIVE","roptions","loadingCanvas","highlight","canvasPool","currentCanvasShift","currentCanvasWidth","canvasMouseHandler","hoveredRows","unhover","enter","leave","updateHoveredRow","EngineRanking","isCanvasRenderedRow","highlightHandler","delayedUpdate","updateBody","delayedUpdateAll","updateAll","delayedUpdateColumnWidths","createCol","reindex","disableListener","_oldValue","renderCtx","createRenderer","visibility","updateCanvasRule","updateColumnSummaryFlag","_document","createCellHandled","initCellClasses","selectCanvas","rowFlags","rowany","__lu__","visibleRenderedWidth","pushLazyRedraw","renderRow","imageSmoothingEnabled","domColumns","renderCellImpl","visibleElements","firstDOM","updateCellImpl","updateCanvasCell","me","needDOM","updateHeaderOf","toRowMeta","agg","hoverLod","computedLod","wasLow","wasGroup","recycleCanvas","canvas2","updateCanvasBody","enable","hover","updateSelection","updateColumn","after","groupData","pushItem","ordered","gparent","rowContext","findNearest","lookFor","firstBeforePos","firstAfterPos","nearestPos","scrollIntoView","regular","posOf","scrollHeight","found","getHighlight","debounceUpdate","replacement","leftSlopes","rightSlopes","chosenSelectionOnly","ITEM","BAND","initHeader","scroll","icons","rebuild","leftRanking","leftContext","rightRanking","rightContext","prepareRightSlopes","computeSlopes","fakeGroups","padded","slopes","gr","heightPerRow","fakeGroup","createFakeGroup","intersection","filterIndices","chooseSelection","leftVisibleFirst","leftVisibleLast","rightVisibleFirst","rightVisibleLast","alreadyVisible","selectionLookup","updatePath","selectionSlopes","ownerSVGElement","matchLength","addPath","openDataIndices","slopeGraphs","updateAbles","zoomFactor","enabledHighlightListening","helper","EngineRenderer","chooseRenderer","chooseGroupRenderer","chooseSummaryRenderer","footer","toDisable","initProvider","zoomOut","updateZoomFactor","zoomIn","fontSize","pushUpdateAble","updateAble","takeDownProvider","addRanking","setHighlightToNearest","updateHist","updateUpdateAbles","updateRotatedHeaderState","slope","round2","defaultHeight","updateSlopeGraphs","formatItem","placeholder","onfocus","onblur","blur","onkeydown","handleKey","itemTemplate","buildDialog","li","isItem","onmouseenter","highlighted","KEYS","click","highlightPrevious","highlightNext","SearchBox","filterResults","ul","allChildrenHidden","addons","groupAdder","groupSortAdder","sortAdder","renderSorting","renderGroupSorting","toColumn","addonKey","onChange","prevent","customize","addGroupAdder","addSortAdder","addGroupSortAdder","addAdder","adder","onSelect","used","summaryUpdater","recreateSummary","appendSummary","updateSummary","dropdown","updateHierarchy","updateList","isWrapper","additionalDescs","chooser","collapseable","descs","initChooser","changeDataStorage","panel","wrapDesc","updateChooser","updateStats","createEntry","makeActive","updateRanking","resetButton","groupByType","SidePanel","spaceFillingRule","availableHeight","visibleHeight","groupSeparators","violation","isDynamicLeafHeight","resizeListener","violationChanged","TaggleRenderer","switchRule","_rule","setViolation","spaceFilling","updateLodRules","_color","asArray","asMap","buildColumn","ColumnBuilder","rotation","registerRenderer","registerToolbarAction","registerToolbarDialogAddon","groupRowHeight","disableAdvancedRankingFeatures","disableAdvancedModelFeatures","disableAdvancedUIFeatures","supportTypes","allColumns","impose","colorColumn","scripted","weightedSum","numberColumn","numberColumn1","weight1","numberColumn2","weight2","numberColumnAndWeights","post","operation","numberColumns","RankingBuilder","ALL_MAGIC_FLAG","addColumn","col2","buildRanking","asOrdinal","asSet","derive","isSet","val","buildCategoricalColumn","asBoxPlot","ext","buildNumberColumn","editable","buildStringColumn","buildDateColumn","buildHierarchicalColumn","groupAction","buildActionsColumn","marker","falseMarker","buildBooleanColumn","providerOptions","rankBuilders","_deriveColors","scheduledTaskExecutor","deriveColumns","registerColumnType","defaultRanking","addSupportTypes","buildData","oldPos","buildTaggle","asTaggle","asLineUp","si","pick","lineupOptions","prevRankings","prevColumns","prevHighlight","onSelectionChanged","onHighlightChanged","componentDidMount","buildProvider","createInstance","resolveColumnDescs","columnDescs","deriveColumnNames","resolveRankings","builders","rankingBuilders","buildColumns","buildRankings","updateLineUp","changeDetector","providerChanged","changedLineUpOptions","updateProvider","columnsChanged","componentDidUpdate","componentWillUnmount","builderAdapter","buildString","buildNumber","buildHierarchy","buildDate","buildCategorical","missingCategory","buildActions","buildGeneric","buildWeightedSumRanking","buildSupportRanking","buildScriptRanking","buildReduceRanking","buildNestedRanking","buildImposeRanking","buildAllColumnsRanking","isSame","isTypeInstance","superClass","Adapter","defineColumn","functions","CustomColumn","createIndex2Pos","server","maxCacheSize","loadFromServer","fetch","computeMissing","union","unionAdd","_v","loadInCache","_m","toLoad","rendererClasses","AAggregatedGroupRenderer","ActionRenderer","AggregateGroupRenderer","AnnotationRenderer","BarCellRenderer","BooleanCellRenderer","BoxplotCellRenderer","BrightnessCellRenderer","CategoricalCellRenderer","CategoricalHeatmapCellRenderer","CategoricalStackedDistributionlCellRenderer","CircleCellRenderer","DateCellRenderer","DateHistogramCellRenderer","DefaultCellRenderer","DotCellRenderer","GroupCellRenderer","HeatmapCellRenderer","HistogramCellRenderer","ImageCellRenderer","InterleavingCellRenderer","LoadingCellRenderer","MapBarCellRenderer","MultiLevelCellRenderer","RankCellRenderer","SelectionRenderer","SetCellRenderer","SparklineCellRenderer","UpSetCellRenderer","VerticalBarCellRenderer","rendererUtils","createLocalDataProvider","createLineUp","createTaggle","buildId","license"],"mappings":"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64B,GAZK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA/C,IAAI,KCES,GAAA64B,GAZK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA/C,IAAI,KCES,GAAA64B,GAZK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA/C,IAAI,KCES,GAAA64B,GAZK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA/C,IAAI,KCES,GAAA64B,GAZK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA/C,IAAI,KCAS,GAAA64B,GAVK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA/C,IAAI,KCES,GAAA64B,GAVK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA/C,IAAI,KCES,GAAA64B,GAVK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA/C,IAAI,KCES,GAAA64B,GAVK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA/C,IAAI,KCES,GAAA64B,GAVK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA/C,IAAI,KCES,GAAA64B,GAVK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA/C,IAAI,KCES,GAAA64B,GAVK,IAAI79B,MAAM,GAAG+H,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA/C,IAAI,KCES,GAAA64B,GAVK,IAAI79B,MAAM,GA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","file":"LineUpJS.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LineUpJS\"] = factory();\n\telse\n\t\troot[\"LineUpJS\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","'use strict';\n\nvar isArray = Array.isArray;\nvar keyList = Object.keys;\nvar hasProp = Object.prototype.hasOwnProperty;\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    var arrA = isArray(a)\n      , arrB = isArray(b)\n      , i\n      , length\n      , key;\n\n    if (arrA && arrB) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n    if (arrA != arrB) return false;\n\n    var dateA = a instanceof Date\n      , dateB = b instanceof Date;\n    if (dateA != dateB) return false;\n    if (dateA && dateB) return a.getTime() == b.getTime();\n\n    var regexpA = a instanceof RegExp\n      , regexpB = b instanceof RegExp;\n    if (regexpA != regexpB) return false;\n    if (regexpA && regexpB) return a.toString() == b.toString();\n\n    var keys = keyList(a);\n    length = keys.length;\n\n    if (length !== keyList(b).length)\n      return false;\n\n    for (i = length; i-- !== 0;)\n      if (!hasProp.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      key = keys[i];\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  return a!==a && b!==b;\n};\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** `Object#toString` result references. */\nvar funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    symbolTag = '[object Symbol]';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/,\n    reLeadingDot = /^\\./,\n    rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    splice = arrayProto.splice;\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value) {\n  return isArray(value) ? value : stringToPath(value);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoize(function(string) {\n  string = toString(string);\n\n  var result = [];\n  if (reLeadingDot.test(string)) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, string) {\n    result.push(quote ? string.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result);\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Assign cache to `_.memoize`.\nmemoize.Cache = MapCache;\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nmodule.exports = get;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n    }\n    return BrowserInfo;\n}());\nexports.BrowserInfo = BrowserInfo;\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nexports.NodeInfo = NodeInfo;\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nexports.BotInfo = BotInfo;\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\\/Teoma)|(ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['vivaldi', /Vivaldi\\/([0-9\\.]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /Edg\\/([0-9\\.]+)/],\n    ['chromium-webview', /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FBAV\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n    ['Search Bot', SEARCHBOT_OS_REGEX],\n];\nfunction detect() {\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nexports.detect = detect;\nfunction parseUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    var matchedRule = ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    var versionParts = match[1] && match[1].split(/[._]/).slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = versionParts.concat(createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length));\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    return new BrowserInfo(name, versionParts.join('.'), detectOS(ua));\n}\nexports.parseUserAgent = parseUserAgent;\nfunction detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.test(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nexports.detectOS = detectOS;\nfunction getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nexports.getNodeVersion = getNodeVersion;\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n","/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof global === \"object\" ? global :\n            typeof self === \"object\" ? self :\n                typeof this === \"object\" ? this :\n                    Function(\"return this;\")();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        else {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter);\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                if (typeof target[key] !== \"function\") {\n                    Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                }\n                if (previous)\n                    previous(key, value);\n            };\n        }\n    })(function (exporter) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var usePolyfill = typeof process === \"object\" && process.env && process.env[\"REFLECT_METADATA_USE_MAP_POLYFILL\"] === \"true\";\n        var _Map = !usePolyfill && typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = !usePolyfill && typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = !usePolyfill && typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        // [[Metadata]] internal slot\n        // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n        var Metadata = new _WeakMap();\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var metadataMap = GetOrCreateMetadataMap(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            if (!metadataMap.delete(metadataKey))\n                return false;\n            if (metadataMap.size > 0)\n                return true;\n            var targetMetadata = Metadata.get(target);\n            targetMetadata.delete(propertyKey);\n            if (targetMetadata.size > 0)\n                return true;\n            Metadata.delete(target);\n            return true;\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        function GetOrCreateMetadataMap(O, P, Create) {\n            var targetMetadata = Metadata.get(O);\n            if (IsUndefined(targetMetadata)) {\n                if (!Create)\n                    return undefined;\n                targetMetadata = new _Map();\n                Metadata.set(O, targetMetadata);\n            }\n            var metadataMap = targetMetadata.get(P);\n            if (IsUndefined(metadataMap)) {\n                if (!Create)\n                    return undefined;\n                metadataMap = new _Map();\n                targetMetadata.set(P, metadataMap);\n            }\n            return metadataMap;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            return ToBoolean(metadataMap.has(MetadataKey));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return undefined;\n            return metadataMap.get(MetadataKey);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n            metadataMap.set(MetadataKey, MetadataValue);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var keys = [];\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return keys;\n            var keysObj = metadataMap.keys();\n            var iterator = GetIterator(keysObj);\n            var k = 0;\n            while (true) {\n                var next = IteratorStep(iterator);\n                if (!next) {\n                    keys.length = k;\n                    return keys;\n                }\n                var nextValue = IteratorValue(next);\n                try {\n                    keys[k] = nextValue;\n                }\n                catch (e) {\n                    try {\n                        IteratorClose(iterator);\n                    }\n                    finally {\n                        throw e;\n                    }\n                }\n                k++;\n            }\n        }\n        // 6 ECMAScript Data Typ0es and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            return /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (key === this._cacheKey) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (this._cacheKey !== key) {\n                        this._cacheIndex = this._keys.indexOf(this._cacheKey = key);\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            return /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.values(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    if (typeof crypto !== \"undefined\")\n                        return crypto.getRandomValues(new Uint8Array(size));\n                    if (typeof msCrypto !== \"undefined\")\n                        return msCrypto.getRandomValues(new Uint8Array(size));\n                    return FillRandomBytes(new Uint8Array(size), size);\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122  4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","\r\nexport interface IForEachAble<T> extends Iterable<T> {\r\n  forEach(callback: (v: T, i: number) => void): void;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function isForEachAble<T>(v: IForEachAble<T> | any): v is IForEachAble<T> {\r\n  return typeof v.forEach === 'function';\r\n}\r\n\r\n/**\r\n * generalized version of Array function similar to Scala ISeq\r\n */\r\nexport interface ISequence<T> extends IForEachAble<T> {\r\n  readonly length: number;\r\n  filter(callback: (v: T, i: number) => boolean): ISequence<T>;\r\n  map<U>(callback: (v: T, i: number) => U): ISequence<U>;\r\n\r\n  some(callback: (v: T, i: number) => boolean): boolean;\r\n  every(callback: (v: T, i: number) => boolean): boolean;\r\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U): U;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function isSeqEmpty(seq: ISequence<any>) {\r\n  return seq.every(() => false); // more efficent than counting length\r\n}\r\n\r\n/**\r\n * helper function for faster access to avoid function calls\r\n * @internal\r\n */\r\nexport function isIndicesAble<T>(it: Iterable<T>): it is ArrayLike<T> & Iterable<T> {\r\n  return Array.isArray(it) || it instanceof Uint8Array || it instanceof Uint16Array || it instanceof Uint32Array || it instanceof Float32Array || it instanceof Int8Array || it instanceof Int16Array || it instanceof Int32Array || it instanceof Float64Array;\r\n}\r\n\r\ndeclare type ISequenceBase<T> = ISequence<T> | (ArrayLike<T> & Iterable<T>);\r\n\r\n/**\r\n * sequence implementation that does the operation lazily on the fly\r\n */\r\nclass LazyFilter<T> implements ISequence<T> {\r\n  private _length = -1;\r\n\r\n  constructor(private readonly it: ISequenceBase<T>, private readonly filters: ((v: T, i: number) => boolean)[]) {\r\n\r\n  }\r\n\r\n  get length() {\r\n    // cached\r\n    if (this._length >= 0) {\r\n      return this._length;\r\n    }\r\n    let l = 0;\r\n    this.forEach(() => l++);\r\n    this._length = l;\r\n    return l;\r\n  }\r\n\r\n  filter(callback: (v: T, i: number) => boolean): ISequence<T> {\r\n    // propagate filter\r\n    return new LazyFilter(this.it, this.filters.concat(callback));\r\n  }\r\n\r\n  map<U>(callback: (v: T, i: number) => U): ISequence<U> {\r\n    // create lazy map out of myself\r\n    return new LazyMap1(this, callback);\r\n  }\r\n\r\n  forEach(callback: (v: T, i: number) => void) {\r\n    if (isIndicesAble(this.it)) {\r\n      // fast array version\r\n      outer: for (let i = 0; i < this.it.length; ++i) {\r\n        const v = this.it[i];\r\n        for (const f of this.filters) {\r\n          if (!f(v, i)) {\r\n            continue outer;\r\n          }\r\n        }\r\n        callback(v, i);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // iterator version\r\n    let valid = 0;\r\n    const it = this.it[Symbol.iterator]();\r\n    let v = it.next();\r\n    let i = 0;\r\n    outer: while (!v.done) {\r\n      for (const f of this.filters) {\r\n        if (f(v.value, i)) {\r\n          continue;\r\n        }\r\n        v = it.next();\r\n        i++;\r\n        continue outer;\r\n      }\r\n      callback(v.value, valid++);\r\n      v = it.next();\r\n      i++;\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    const it = this.it[Symbol.iterator]();\r\n    const next = () => {\r\n      let v = it.next();\r\n      let i = -1;\r\n      outer: while (!v.done) {\r\n        i++;\r\n        for (const f of this.filters) {\r\n          if (f(v.value, i)) {\r\n            continue;\r\n          }\r\n          // invalid go to next\r\n          v = it.next();\r\n          continue outer;\r\n        }\r\n        return v;\r\n      }\r\n      return v;\r\n    };\r\n    return {next};\r\n  }\r\n\r\n  some(callback: (v: T, i: number) => boolean) {\r\n    if (isIndicesAble(this.it)) {\r\n      // fast array version\r\n      outer: for (let i = 0; i < this.it.length; ++i) {\r\n        const v = this.it[i];\r\n        for (const f of this.filters) {\r\n          if (!f(v, i)) {\r\n            continue outer;\r\n          }\r\n        }\r\n        if (callback(v, i)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n\r\n    let valid = 0;\r\n    const it = this.it[Symbol.iterator]();\r\n    let v = it.next();\r\n    let i = 0;\r\n    outer: while (!v.done) {\r\n      for (const f of this.filters) {\r\n        if (f(v.value, i)) {\r\n          continue;\r\n        }\r\n        v = it.next();\r\n        i++;\r\n        continue outer;\r\n      }\r\n      if (callback(v.value, valid++)) {\r\n        return true;\r\n      }\r\n      v = it.next();\r\n      i++;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  every(callback: (v: T, i: number) => boolean) {\r\n    if (isIndicesAble(this.it)) {\r\n      // fast array version\r\n      outer: for (let i = 0; i < this.it.length; ++i) {\r\n        const v = this.it[i];\r\n        for (const f of this.filters) {\r\n          if (!f(v, i)) {\r\n            continue outer;\r\n          }\r\n        }\r\n        if (!callback(v, i)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n\r\n    let valid = 0;\r\n    const it = this.it[Symbol.iterator]();\r\n    let v = it.next();\r\n    let i = 0;\r\n    outer: while (!v.done) {\r\n      for (const f of this.filters) {\r\n        if (f(v.value, i)) {\r\n          continue;\r\n        }\r\n        v = it.next();\r\n        i++;\r\n        continue outer;\r\n      }\r\n      if (!callback(v.value, valid++)) {\r\n        return false;\r\n      }\r\n      v = it.next();\r\n      i++;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\r\n    if (isIndicesAble(this.it)) {\r\n      // fast array version\r\n      let acc = initial;\r\n      let j = 0;\r\n      outer: for (let i = 0; i < this.it.length; ++i) {\r\n        const v = this.it[i];\r\n        for (const f of this.filters) {\r\n          if (!f(v, i)) {\r\n            continue outer;\r\n          }\r\n        }\r\n        acc = callback(acc, v, j++);\r\n      }\r\n      return acc;\r\n    }\r\n\r\n    let valid = 0;\r\n    const it = this.it[Symbol.iterator]();\r\n    let v = it.next();\r\n    let i = 0;\r\n    let r = initial;\r\n    outer: while (!v.done) {\r\n      for (const f of this.filters) {\r\n        if (f(v.value, i)) {\r\n          continue;\r\n        }\r\n        v = it.next();\r\n        i++;\r\n        continue outer;\r\n      }\r\n      r = callback(r, v.value, valid++);\r\n      v = it.next();\r\n      i++;\r\n    }\r\n    return r;\r\n  }\r\n}\r\n\r\n/**\r\n * lazy mapping operation\r\n */\r\nabstract class ALazyMap<T, T2> implements ISequence<T2> {\r\n  constructor(protected readonly it: ISequenceBase<T>) {\r\n\r\n  }\r\n\r\n  get length() {\r\n    return this.it.length;\r\n  }\r\n\r\n  filter(callback: (v: T2, i: number) => boolean): ISequence<T2> {\r\n    return new LazyFilter(this, [callback]);\r\n  }\r\n\r\n  abstract map<U>(callback: (v: T2, i: number) => U): ISequence<U>;\r\n  protected abstract mapV(v: T, i: number): T2;\r\n\r\n\r\n  forEach(callback: (v: T2, i: number) => void) {\r\n    if (isIndicesAble(this.it)) {\r\n      for (let i = 0; i < this.it.length; ++i) {\r\n        callback(this.mapV(this.it[i], i), i);\r\n      }\r\n      return;\r\n    }\r\n    const it = this.it[Symbol.iterator]();\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      callback(this.mapV(v.value, i), i);\r\n    }\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    const it = this.it[Symbol.iterator]();\r\n    let i = 0;\r\n    const next = () => {\r\n      const v = it.next();\r\n      if (v.done) {\r\n        return {\r\n          value: <T2><any>undefined,\r\n          done: true\r\n        };\r\n      }\r\n      const value = this.mapV(v.value, i);\r\n      i++;\r\n      return {\r\n        value,\r\n        done: false\r\n      };\r\n    };\r\n    return {next};\r\n  }\r\n\r\n  some(callback: (v: T2, i: number) => boolean) {\r\n    if (isIndicesAble(this.it)) {\r\n      for (let i = 0; i < this.it.length; ++i) {\r\n        if (callback(this.mapV(this.it[i], i), i)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n\r\n    const it = this.it[Symbol.iterator]();\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      if (callback(this.mapV(v.value, i), i)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  every(callback: (v: T2, i: number) => boolean) {\r\n    if (isIndicesAble(this.it)) {\r\n      for (let i = 0; i < this.it.length; ++i) {\r\n        if (!callback(this.mapV(this.it[i], i), i)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n\r\n    const it = this.it[Symbol.iterator]();\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      if (!callback(this.mapV(v.value, i), i)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  reduce<U>(callback: (acc: U, v: T2, i: number) => U, initial: U) {\r\n    if (isIndicesAble(this.it)) {\r\n      let acc = initial;\r\n      for (let i = 0; i < this.it.length; ++i) {\r\n        acc = callback(acc, this.mapV(this.it[i], i), i);\r\n      }\r\n      return acc;\r\n    }\r\n\r\n    const it = this.it[Symbol.iterator]();\r\n    let acc = initial;\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      acc = callback(acc, this.mapV(v.value, i), i);\r\n    }\r\n    return acc;\r\n  }\r\n}\r\n\r\nclass LazyMap1<T1, T2> extends ALazyMap<T1, T2> implements ISequence<T2> {\r\n  constructor(it: ISequenceBase<T1>, protected readonly map12: (v: T1, i: number) => T2) {\r\n    super(it);\r\n  }\r\n\r\n  protected mapV(v: T1, i: number) {\r\n    return this.map12(v, i);\r\n  }\r\n\r\n  map<U>(callback: (v: T2, i: number) => U): ISequence<U> {\r\n    return new LazyMap2(this.it, this.map12, callback);\r\n  }\r\n}\r\n\r\nclass LazyMap2<T1, T2, T3> extends ALazyMap<T1, T3> implements ISequence<T3> {\r\n  constructor(it: ISequenceBase<T1>, private readonly map12: (v: T1, i: number) => T2, private readonly map23: (v: T2, i: number) => T3) {\r\n    super(it);\r\n  }\r\n\r\n  map<U>(callback: (v: T3, i: number) => U): ISequence<U> {\r\n    return new LazyMap3(this.it, this.map12, this.map23, callback);\r\n  }\r\n\r\n  protected mapV(v: T1, i: number) {\r\n    return this.map23(this.map12(v, i), i);\r\n  }\r\n}\r\n\r\n\r\nclass LazyMap3<T1, T2, T3, T4> extends ALazyMap<T1, T4> implements ISequence<T4> {\r\n  constructor(it: ISequenceBase<T1>, private readonly map12: (v: T1, i: number) => T2, private readonly map23: (v: T2, i: number) => T3, private readonly map34: (v: T3, i: number) => T4) {\r\n    super(it);\r\n  }\r\n\r\n  map<U>(callback: (v: T4, i: number) => U): ISequence<U> {\r\n    const map1U = (v: T1, i: number) => callback(this.map34(this.map23(this.map12(v, i), i), i), i);\r\n    return new LazyMap1(this.it, map1U);\r\n  }\r\n\r\n  protected mapV(v: T1, i: number) {\r\n    return this.map34(this.map23(this.map12(v, i), i), i);\r\n  }\r\n}\r\n\r\nclass LazySeq<T> implements ISequence<T> {\r\n  private _arr: ISequenceBase<T> | null = null;\r\n\r\n  constructor(private readonly iterable: Iterable<T>) {\r\n\r\n  }\r\n\r\n  get arr() {\r\n    if (this._arr) {\r\n      return this._arr;\r\n    }\r\n    if (isIndicesAble(this.iterable)) {\r\n      this._arr = this.iterable;\r\n    } else {\r\n      this._arr = Array.from(this.iterable);\r\n    }\r\n    return this._arr!;\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.iterable[Symbol.iterator]();\r\n  }\r\n\r\n  filter(callback: (v: T, i: number) => boolean) {\r\n    return new LazyFilter(this.arr, [callback]);\r\n  }\r\n\r\n  map<U>(callback: (v: T, i: number) => U) {\r\n    return new LazyMap1(this.arr, callback);\r\n  }\r\n\r\n  forEach(callback: (v: T, i: number) => void) {\r\n    if (isIndicesAble(this.iterable)) {\r\n      for (let i = 0; i < this.iterable.length; ++i) {\r\n        callback(this.iterable[i], i);\r\n      }\r\n      return;\r\n    }\r\n    const it = this[Symbol.iterator]();\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      callback(v.value, i);\r\n    }\r\n  }\r\n\r\n  some(callback: (v: T, i: number) => boolean) {\r\n    if (isIndicesAble(this.iterable)) {\r\n      for (let i = 0; i < this.iterable.length; ++i) {\r\n        if (callback(this.iterable[i], i)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n\r\n    const it = this[Symbol.iterator]();\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      if (callback(v.value, i)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  every(callback: (v: T, i: number) => boolean) {\r\n    if (isIndicesAble(this.iterable)) {\r\n      for (let i = 0; i < this.iterable.length; ++i) {\r\n        if (!callback(this.iterable[i], i)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n\r\n    const it = this[Symbol.iterator]();\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      if (!callback(v.value, i)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\r\n    if (isIndicesAble(this.iterable)) {\r\n      let acc = initial;\r\n      for (let i = 0; i < this.iterable.length; ++i) {\r\n        acc = callback(acc, this.iterable[i], i);\r\n      }\r\n      return acc;\r\n    }\r\n\r\n    const it = this[Symbol.iterator]();\r\n    let acc = initial;\r\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\r\n      acc = callback(acc, v.value, i);\r\n    }\r\n    return acc;\r\n  }\r\n\r\n  get length() {\r\n    const it = this.iterable;\r\n    if (isIndicesAble(it)) {\r\n      return it.length;\r\n    }\r\n    if (it instanceof Set || it instanceof Map) {\r\n      return it.size;\r\n    }\r\n    return this.arr.length;\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function lazySeq<T>(iterable: Iterable<T>): ISequence<T> {\r\n  return new LazySeq(iterable);\r\n}\r\n\r\n\r\nclass ConcatSequence<T> implements ISequence<T> {\r\n  constructor(private readonly seqs: ISequence<ISequence<T>>) {\r\n    //\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    const seqs = Array.from(this.seqs);\r\n    let it = seqs.shift()![Symbol.iterator]();\r\n    const next = (): {value: T, done: boolean} => {\r\n      const v = it.next();\r\n      if (!v.done) {\r\n        return v;\r\n      }\r\n      if (seqs.length === 0) {\r\n        // last last\r\n        return v;\r\n      }\r\n      // next iterator and compute next element\r\n      it = seqs.shift()![Symbol.iterator]();\r\n      return next();\r\n    };\r\n    return {next};\r\n  }\r\n\r\n  filter(callback: (v: T, i: number) => boolean): ISequence<T> {\r\n    return new LazyFilter(this, [callback]);\r\n  }\r\n\r\n  map<U>(callback: (v: T, i: number) => U): ISequence<U> {\r\n    return new LazyMap1(this, callback);\r\n  }\r\n\r\n  forEach(callback: (v: T, i: number) => void) {\r\n    this.seqs.forEach((s) => s.forEach(callback));\r\n  }\r\n\r\n  some(callback: (v: T, i: number) => boolean) {\r\n    return this.seqs.some((s) => s.some(callback));\r\n  }\r\n\r\n  every(callback: (v: T, i: number) => boolean) {\r\n    return this.seqs.every((s) => s.every(callback));\r\n  }\r\n\r\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\r\n    return this.seqs.reduce((acc, s) => s.reduce(callback, acc), initial);\r\n  }\r\n\r\n  get length() {\r\n    return this.seqs.reduce((a, b) => a + b.length, 0);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function concatSeq<T>(seqs: ISequence<ISequence<T>>): ISequence<T>;\r\nexport function concatSeq<T>(seq1: ISequence<T>, seq2: ISequence<T>, ...seqs: ISequence<T>[]): ISequence<T>;\r\nexport function concatSeq<T>(seq1: ISequence<T>[] | ISequence<T>, seq2?: ISequence<T>, ...seqs: ISequence<T>[]): ISequence<T> {\r\n  if (seq2) {\r\n    return new ConcatSequence([<ISequence<T>>seq1, seq2].concat(seqs));\r\n  }\r\n  return new ConcatSequence(<ISequence<T>[]>seq1);\r\n}\r\n","import {IWorkerMessage, INumberStatsMessageRequest, IAdvancedBoxPlotData, ICategoricalStatistics, IDateStatistics, IStatistics, ICategoricalStatsMessageRequest, IDateStatsMessageRequest, IBoxPlotStatsMessageRequest} from './';\r\nimport {UIntTypedArray, IndicesArray} from '../model';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IPoorManWorkerScopeEventMap {\r\n  message: MessageEvent;\r\n  error: ErrorEvent;\r\n}\r\n\r\ndeclare type IPoorManTransferAble = ArrayBuffer | MessagePort | ImageBitmap;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IPoorManWorkerScope {\r\n  onmessage: ((this: IPoorManWorkerScope, ev: MessageEvent) => any) | null;\r\n  onerror: ((this: IPoorManWorkerScope, ev: ErrorEvent) => any) | null;\r\n  close(): void;\r\n  postMessage(message: any, transfer?: IPoorManTransferAble[]): void;\r\n  addEventListener<K extends keyof IPoorManWorkerScopeEventMap>(type: K, listener: (this: IPoorManWorkerScope, ev: IPoorManWorkerScopeEventMap[K]) => any, options?: boolean | AddEventListenerOptions): void;\r\n  removeEventListener<K extends keyof IPoorManWorkerScopeEventMap>(type: K, listener: (this: IPoorManWorkerScope, ev: IPoorManWorkerScopeEventMap[K]) => any, options?: boolean | AddEventListenerOptions): void;\r\n}\r\n\r\n// function workerMain(self: IPoorManWorkerScope) {\r\n//   self.addEventListener('message', (evt) => {\r\n//     self.postMessage(`Worker: ${evt.data} - Polo`);\r\n//   });\r\n// }\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function toFunctionBody(f: Function) {\r\n  const source = f.toString();\r\n  return source.slice(source.indexOf('{') + 1, source.lastIndexOf('}'));\r\n}\r\n\r\n/**\r\n * create a blob out of the given function or string\r\n * @internal\r\n */\r\nexport function createWorkerCodeBlob(fs: (string | Function)[]) {\r\n  const sources = fs.map((d) => d.toString()).join('\\n\\n');\r\n\r\n  const blob = new Blob([sources], {type: 'application/javascript'});\r\n  return URL.createObjectURL(blob);\r\n}\r\n\r\nconst MIN_WORKER_THREADS = 1;\r\nconst MAX_WORKER_THREADS = Math.max(navigator.hardwareConcurrency - 1, 1); // keep one for the ui\r\n\r\nconst THREAD_CLEANUP_TIME = 10000; // 10s\r\n\r\ninterface ITaskWorker {\r\n  /**\r\n   * worker index\r\n   */\r\n  index: number;\r\n  /**\r\n   * worker itself\r\n   */\r\n  worker: Worker;\r\n  /**\r\n   * set of active task numbers\r\n   */\r\n  tasks: Set<number>;\r\n  /**\r\n   * list of references that are stored on this worker\r\n   */\r\n  refs: Set<string>;\r\n}\r\n\r\n/**\r\n * task scheduler based on web worker\r\n * @internal\r\n */\r\nexport class WorkerTaskScheduler {\r\n  private readonly workers: ITaskWorker[] = [];\r\n  private cleanUpWorkerTimer: number = -1;\r\n  /**\r\n   * worker task id\r\n   */\r\n  private workerTaskCounter = 0;\r\n\r\n  constructor(private readonly blob: string) {\r\n    for (let i = 0; i < MIN_WORKER_THREADS; ++i) {\r\n      const w = new Worker(blob);\r\n      this.workers.push({worker: w, tasks: new Set(), refs: new Set(), index: i});\r\n    }\r\n  }\r\n\r\n  terminate() {\r\n    this.workers.splice(0, this.workers.length).forEach((w) => w.worker.terminate());\r\n  }\r\n\r\n  private readonly cleanUpWorker = () => {\r\n    // delete workers when they are not needed anymore and empty\r\n    while(this.workers.length > MIN_WORKER_THREADS) {\r\n      const toFree = this.workers.findIndex((d) => d.tasks.size === 0);\r\n      if (toFree < 0) {\r\n        break;\r\n      }\r\n      const w = this.workers.splice(toFree, 1)[0]!;\r\n      w.worker.terminate();\r\n    }\r\n    // maybe reschedule\r\n    this.finshedTask();\r\n  }\r\n\r\n  private checkOutWorker() {\r\n    if (this.cleanUpWorkerTimer >= 0) {\r\n      clearTimeout(this.cleanUpWorkerTimer);\r\n      this.cleanUpWorkerTimer = -1;\r\n    }\r\n\r\n    const emptyWorker = this.workers.find((d) => d.tasks.size === 0);\r\n\r\n    if (emptyWorker) {\r\n      return emptyWorker;\r\n    }\r\n\r\n    if (this.workers.length >= MAX_WORKER_THREADS) {\r\n      // find the one with the fewest tasks\r\n      return this.workers.reduce((a, b) => a == null || a.tasks.size > b.tasks.size ? b : a, <ITaskWorker | null>null)!;\r\n    }\r\n\r\n    // create new one\r\n    const r: ITaskWorker = {\r\n      worker: new Worker(this.blob),\r\n      tasks: new Set<number>(),\r\n      refs: new Set(),\r\n      index: this.workers.length,\r\n    };\r\n    this.workers.push(r);\r\n    return r;\r\n  }\r\n\r\n  private finshedTask() {\r\n    if (this.cleanUpWorkerTimer === -1 && this.workers.length > MIN_WORKER_THREADS) {\r\n      this.cleanUpWorkerTimer = self.setTimeout(this.cleanUpWorker, THREAD_CLEANUP_TIME);\r\n    }\r\n  }\r\n\r\n  pushStats(type: 'numberStats', args: Partial<INumberStatsMessageRequest>, refData: string, data: Float32Array, refIndices?: string, indices?: IndicesArray): Promise<IStatistics>;\r\n  pushStats(type: 'boxplotStats', args: Partial<IBoxPlotStatsMessageRequest>, refData: string, data: Float32Array, refIndices?: string, indices?: IndicesArray): Promise<IAdvancedBoxPlotData>;\r\n  pushStats(type: 'categoricalStats', args: Partial<ICategoricalStatsMessageRequest>, refData: string, data: UIntTypedArray, refIndices?: string, indices?: IndicesArray): Promise<ICategoricalStatistics>;\r\n  pushStats(type: 'dateStats', args: Partial<IDateStatsMessageRequest>, refData: string, data: Float64Array, refIndices?: string, indices?: IndicesArray): Promise<IDateStatistics>;\r\n  pushStats(type: 'numberStats' | 'boxplotStats' | 'categoricalStats' | 'dateStats', args: any, refData: string, data: Float32Array | UIntTypedArray | Float64Array, refIndices?: string, indices?: IndicesArray) {\r\n    return new Promise((resolve) => {\r\n      const uid = this.workerTaskCounter++;\r\n      const {worker, tasks, refs} = this.checkOutWorker();\r\n\r\n      const receiver = (msg: MessageEvent) => {\r\n        const r = <IWorkerMessage>msg.data;\r\n        if (r.uid !== uid || r.type !== type) {\r\n          return;\r\n        }\r\n        // console.log('worker', index, uid, 'finish', r);\r\n        worker.removeEventListener('message', receiver);\r\n        tasks.delete(uid);\r\n        this.finshedTask();\r\n        resolve((<any>r).stats);\r\n      };\r\n\r\n      worker.addEventListener('message', receiver);\r\n\r\n      tasks.add(uid);\r\n\r\n      const msg: any = Object.assign({\r\n        type,\r\n        uid,\r\n        refData,\r\n        refIndices: refIndices || null\r\n      }, args);\r\n\r\n      if (!refData || !refs.has(refData)) {\r\n        // need to transfer to worker\r\n        msg.data = data;\r\n        if (refData) { // save that this worker has this ref\r\n          refs.add(refData);\r\n        }\r\n        // console.log(index, 'set ref (i)', refData);\r\n      }\r\n      if (indices && (!refIndices || !refs.has(refIndices))) {\r\n        // need to transfer\r\n        msg.indices = indices!;\r\n        if (refIndices) {\r\n          refs.add(refIndices);\r\n        }\r\n        // console.log(index, 'set ref (i)', refIndices);\r\n      }\r\n      // console.log('worker', index, uid, msg);\r\n\r\n      worker.postMessage(msg);\r\n    });\r\n  }\r\n\r\n  push<M, R>(type: string, args: M, transferAbles: ArrayBuffer[]): Promise<R>;\r\n  push<M, R, T>(type: string, args: M, transferAbles: ArrayBuffer[], toResult: (r: R) => T): Promise<T>;\r\n  push<M, R, T>(type: string, args: M, transferAbles: ArrayBuffer[], toResult?: (r: R) => T): Promise<T> {\r\n    return new Promise<T>((resolve) => {\r\n      const uid = this.workerTaskCounter++;\r\n      const {worker, tasks} = this.checkOutWorker();\r\n\r\n      const receiver = (msg: MessageEvent) => {\r\n        const r = <IWorkerMessage>msg.data;\r\n        if (r.uid !== uid || r.type !== type) {\r\n          return;\r\n        }\r\n        // console.log('worker', index, uid, 'finish', r);\r\n        worker.removeEventListener('message', receiver);\r\n        tasks.delete(uid);\r\n        this.finshedTask();\r\n        resolve(toResult ? toResult(<any>r) : <any>r);\r\n      };\r\n\r\n      worker.addEventListener('message', receiver);\r\n      tasks.add(uid);\r\n      const msg = Object.assign({\r\n        type,\r\n        uid\r\n      }, args);\r\n      // console.log('worker', index, uid, msg);\r\n\r\n      worker.postMessage(msg, transferAbles);\r\n    });\r\n  }\r\n\r\n  setRef(ref: string, data: Float32Array | UIntTypedArray | Int32Array | Float64Array | IndicesArray) {\r\n    for (const w of this.workers) {\r\n      w.refs.add(ref);\r\n    }\r\n    this.broadCast('setRef', {\r\n      ref,\r\n      data\r\n    });\r\n  }\r\n\r\n  deleteRef(ref: string, startsWith = false) {\r\n    const uid = this.workerTaskCounter++;\r\n    const msg = {\r\n      type: 'deleteRef',\r\n      uid,\r\n      ref,\r\n      startsWith\r\n    };\r\n    for (const w of this.workers) {\r\n      // console.log(w.index, 'delete ref', ref, startsWith);\r\n      w.worker.postMessage(msg);\r\n      if (!startsWith) {\r\n        w.refs.delete(ref);\r\n        continue;\r\n      }\r\n      for (const r of Array.from(w.refs)) {\r\n        if (r.startsWith(ref)) {\r\n          w.refs.delete(r);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  deleteRefs() {\r\n    const uid = this.workerTaskCounter++;\r\n    const msg = {\r\n      type: 'deleteRef',\r\n      uid,\r\n      ref: '',\r\n      startsWith: true\r\n    };\r\n    for (const w of this.workers) {\r\n      // console.log(w.index, 'delete refs');\r\n      w.worker.postMessage(msg);\r\n      w.refs.clear();\r\n    }\r\n  }\r\n\r\n  broadCast<T>(type: string, args: T) {\r\n    const uid = this.workerTaskCounter++;\r\n    // don't store in tasks queue since there is no response\r\n    const msg = Object.assign({\r\n      type,\r\n      uid\r\n    }, args);\r\n    // console.log('broadcast', msg);\r\n    for (const w of this.workers) {\r\n      w.worker.postMessage(msg);\r\n    }\r\n  }\r\n\r\n}\r\n","import {ICategory, IndicesArray, UIntTypedArray} from '../model';\r\nimport {IForEachAble, ISequence, isIndicesAble} from './interable';\r\nimport {createWorkerCodeBlob, IPoorManWorkerScope, toFunctionBody} from './worker';\r\nimport {IAdvancedBoxPlotData, IStatistics, INumberBin, IDateBin, IDateStatistics, ICategoricalStatistics, ICategoricalBin, IDateHistGranularity} from './mathInterfaces';\r\n\r\n\r\n/**\r\n * computes the optimal number of bins for a given array length\r\n * @internal\r\n * @param {number} length\r\n * @returns {number}\r\n */\r\nexport function getNumberOfBins(length: number) {\r\n  if (length === 0) {\r\n    return 1;\r\n  }\r\n  // as by default used in d3 the Sturges' formula\r\n  return Math.ceil(Math.log(length) / Math.LN2) + 1;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function min(values: number[]): number;\r\nexport function min<T>(values: T[], acc: (v: T) => number): number;\r\nexport function min<T>(values: T[], acc?: (v: T) => number) {\r\n  let min = Number.POSITIVE_INFINITY;\r\n  for (const d of values) {\r\n    const v = acc ? acc(d) : <number><any>d;\r\n    if (v < min) {\r\n      min = v;\r\n    }\r\n  }\r\n  return min;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function max(values: number[]): number;\r\nexport function max<T>(values: T[], acc: (v: T) => number): number;\r\nexport function max<T>(values: T[], acc?: (v: T) => number) {\r\n  let max = Number.NEGATIVE_INFINITY;\r\n  for (const d of values) {\r\n    const v = acc ? acc(d) : <number><any>d;\r\n    if (v > max) {\r\n      max = v;\r\n    }\r\n  }\r\n  return max;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function extent(values: number[]): [number, number];\r\nexport function extent<T>(values: T[], acc: (v: T) => number): [number, number];\r\nexport function extent<T>(values: T[], acc?: (v: T) => number) {\r\n  let max = Number.NEGATIVE_INFINITY;\r\n  let min = Number.POSITIVE_INFINITY;\r\n  for (const d of values) {\r\n    const v = acc ? acc(d) : <number><any>d;\r\n    if (v < min) {\r\n      min = v;\r\n    }\r\n    if (v > max) {\r\n      max = v;\r\n    }\r\n  }\r\n  return [min, max];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function range(length: number) {\r\n  const r: number[] = new Array(length);\r\n  for (let i = 0; i < length; ++i) {\r\n    r[i] = i;\r\n  }\r\n  return r;\r\n}\r\n\r\n/**\r\n * an empty range\r\n * @internal\r\n */\r\nexport function empty(length: number) {\r\n  const r: null[] = new Array(length);\r\n  r.fill(null);\r\n  return r;\r\n}\r\n\r\n/**\r\n * computes the X quantile assumes the values are sorted\r\n * @internal\r\n */\r\nexport function quantile(values: ArrayLike<number>, quantile: number, length = values.length) {\r\n  if (length === 0) {\r\n    return NaN;\r\n  }\r\n  const target = (length - 1) * quantile;\r\n  const index = Math.floor(target);\r\n  if (index === target) {\r\n    return values[index];\r\n  }\r\n  const v = values[index];\r\n  const vAfter = values[index + 1];\r\n  return v + (vAfter - v) * (target - index); // shift by change\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function median(values: number[]): number;\r\nexport function median<T>(values: T[], acc: (v: T) => number): number;\r\nexport function median<T>(values: T[], acc?: (v: T) => number) {\r\n  const arr = acc ? values.map(acc) : (<number[]><any>values).slice();\r\n  arr.sort((a, b) => (a < b ? -1 : (a > b ? 1 : 0)));\r\n  return quantile(arr, 0.5);\r\n}\r\n\r\nfunction pushAll<T>(push: (v: T) => void) {\r\n  return (vs: IForEachAble<T>) => {\r\n    if (!isIndicesAble(vs)) {\r\n      vs.forEach(push);\r\n      return;\r\n    }\r\n    // tslint:disable-next-line:prefer-for-of\r\n    for (let j = 0; j < vs.length; ++j) {\r\n      push(vs[j]);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * common interface for a bulider pattern\r\n * @internal\r\n */\r\nexport interface IBuilder<T, R> {\r\n  /**\r\n   * push an entry\r\n   */\r\n  push(v: T): void;\r\n  /**\r\n   * push multiple values at once\r\n   */\r\n  pushAll(vs: IForEachAble<T>): void;\r\n\r\n  /**\r\n   * build the result\r\n   */\r\n  build(): R;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function boxplotBuilder(fixedLength?: number): IBuilder<number, IAdvancedBoxPlotData> & {buildArr: (s: Float32Array) => IAdvancedBoxPlotData} {\r\n  let min = Number.POSITIVE_INFINITY;\r\n  let max = Number.NEGATIVE_INFINITY;\r\n  let sum = 0;\r\n  let length = 0;\r\n  let missing = 0;\r\n\r\n  // if fixed size use the typed array else a regular array\r\n  const values: number[] = [];\r\n  const vs: Float32Array | null = fixedLength != null ? new Float32Array(fixedLength) : null;\r\n\r\n  const push = (v: number) => {\r\n    length += 1;\r\n    if (v == null || isNaN(v)) {\r\n      missing += 1;\r\n      return;\r\n    }\r\n    if (v < min) {\r\n      min = v;\r\n    }\r\n    if (v > max) {\r\n      max = v;\r\n    }\r\n    sum += v;\r\n  };\r\n\r\n  const pushAndSave = (v: number) => {\r\n    push(v);\r\n    if (vs) {\r\n      vs[length] = v;\r\n    } else {\r\n      values.push(v);\r\n    }\r\n  };\r\n\r\n\r\n  const invalid = {\r\n    min: NaN,\r\n    max: NaN,\r\n    mean: NaN,\r\n    missing,\r\n    count: length,\r\n    whiskerHigh: NaN,\r\n    whiskerLow: NaN,\r\n    outlier: [],\r\n    median: NaN,\r\n    q1: NaN,\r\n    q3: NaN\r\n  };\r\n\r\n  const buildImpl = (s: ArrayLike<number>) => {\r\n    const valid = length - missing;\r\n    const median = quantile(s, 0.5, valid)!;\r\n    const q1 = quantile(s, 0.25, valid)!;\r\n    const q3 = quantile(s, 0.75, valid)!;\r\n\r\n    const iqr = q3 - q1;\r\n    const left = q1 - 1.5 * iqr;\r\n    const right = q3 + 1.5 * iqr;\r\n\r\n    let outlier: number[] = [];\r\n    // look for the closests value which is bigger than the computed left\r\n    let whiskerLow = left;\r\n    // tslint:disable-next-line:prefer-for-of\r\n    for (let i = 0; i < valid; ++i) {\r\n      const v = s[i];\r\n      if (left < v) {\r\n        whiskerLow = v;\r\n        break;\r\n      }\r\n      // outlier\r\n      outlier.push(v);\r\n    }\r\n    // look for the closests value which is smaller than the computed right\r\n    let whiskerHigh = right;\r\n    const reversedOutliers: number[] = [];\r\n    for (let i = valid - 1; i >= 0; --i) {\r\n      const v = s[i];\r\n      if (v < right) {\r\n        whiskerHigh = v;\r\n        break;\r\n      }\r\n      // outlier\r\n      reversedOutliers.push(v);\r\n    }\r\n\r\n    outlier = outlier.concat(reversedOutliers.reverse());\r\n\r\n    return {\r\n      min,\r\n      max,\r\n      count: length,\r\n      missing,\r\n      mean: sum / valid,\r\n      whiskerHigh,\r\n      whiskerLow,\r\n      outlier,\r\n      median,\r\n      q1,\r\n      q3\r\n    };\r\n  };\r\n\r\n  const build = () => {\r\n    const valid = length - missing;\r\n\r\n    if (valid === 0) {\r\n      return invalid;\r\n    }\r\n\r\n    const s = vs ? vs.sort() : Float32Array.from(values).sort();\r\n    return buildImpl(s);\r\n  };\r\n\r\n  const buildArr = (vs: Float32Array) => {\r\n    const s = vs.slice().sort();\r\n    // tslint:disable-next-line:prefer-for-of\r\n    for (let j = 0; j < vs.length; ++j) {\r\n      push(vs[j]);\r\n    }\r\n    // missing are the last\r\n    return buildImpl(s);\r\n  };\r\n\r\n  return {\r\n    push: pushAndSave,\r\n    build,\r\n    buildArr,\r\n    pushAll: pushAll(pushAndSave)\r\n  };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function normalizedStatsBuilder(numberOfBins: number): IBuilder<number, IStatistics> {\r\n\r\n  const hist: INumberBin[] = [];\r\n\r\n  let x0 = 0;\r\n  const binWidth = 1. / numberOfBins;\r\n  for (let i = 0; i < numberOfBins; ++i, x0 += binWidth) {\r\n    hist.push({\r\n      x0,\r\n      x1: x0 + binWidth,\r\n      count: 0\r\n    });\r\n  }\r\n\r\n  const bin1 = 0 + binWidth;\r\n  const binN = 1 - binWidth;\r\n\r\n  const toBin = (v: number) => {\r\n    if (v < bin1) {\r\n      return 0;\r\n    }\r\n    if (v >= binN) {\r\n      return numberOfBins - 1;\r\n    }\r\n    if (numberOfBins === 3) {\r\n      return 1;\r\n    }\r\n    let low = 1;\r\n    let high = numberOfBins - 1;\r\n    // binary search\r\n    while (low < high) {\r\n      const center = Math.floor((high + low) / 2);\r\n      if (v < hist[center].x1) {\r\n        high = center;\r\n      } else {\r\n        low = center + 1;\r\n      }\r\n    }\r\n    return low;\r\n  };\r\n\r\n  // filter out NaN\r\n  let min = Number.POSITIVE_INFINITY;\r\n  let max = Number.NEGATIVE_INFINITY;\r\n  let sum = 0;\r\n  let length = 0;\r\n  let missing = 0;\r\n\r\n  const push = (v: number) => {\r\n    length += 1;\r\n    if (v == null || isNaN(v)) {\r\n      missing += 1;\r\n      return;\r\n    }\r\n    if (v < min) {\r\n      min = v;\r\n    }\r\n    if (v > max) {\r\n      max = v;\r\n    }\r\n    sum += v;\r\n\r\n    hist[toBin(v)].count++;\r\n  };\r\n\r\n  const build = () => {\r\n    const valid = length - missing;\r\n    if (valid === 0) {\r\n      return {\r\n        count: missing,\r\n        missing,\r\n        min: NaN,\r\n        max: NaN,\r\n        mean: NaN,\r\n        hist,\r\n        maxBin: 0\r\n      };\r\n    }\r\n    return {\r\n      count: length,\r\n      min,\r\n      max,\r\n      mean: sum / valid,\r\n      missing,\r\n      hist,\r\n      maxBin: hist.reduce((a, b) => Math.max(a, b.count), 0)\r\n    };\r\n  };\r\n\r\n  return {push, build, pushAll: pushAll(push)};\r\n}\r\n\r\n/**\r\n * guesses the histogram granularity to use based on min and max date\r\n */\r\nfunction computeGranularity(min: Date | null, max: Date | null): {histGranularity: IDateHistGranularity, hist: IDateBin[]} {\r\n  if (min == null || max == null) {\r\n    return {histGranularity: 'year', hist: []};\r\n  }\r\n  const hist: IDateBin[] = [];\r\n\r\n  if (max.getFullYear() - min.getFullYear() >= 2) {\r\n    // more than two years difference\r\n    const minYear = min.getFullYear();\r\n    const maxYear = max.getFullYear();\r\n    for (let i = minYear; i <= maxYear; ++i) {\r\n      hist.push({\r\n        x0: new Date(i, 0, 1),\r\n        x1: new Date(i + 1, 0, 1),\r\n        count: 0\r\n      });\r\n    }\r\n    return {hist, histGranularity: 'year'};\r\n  }\r\n\r\n  if ((max.getTime() - min.getTime()) <= 1000 * 60 * 60 * 24 * 31) {\r\n    // less than a month use day\r\n    let x0 = new Date(min.getFullYear(), min.getMonth(), min.getDay());\r\n    while (x0 <= max) {\r\n      const x1 = new Date(x0);\r\n      x1.setDate(x1.getDate() + 1);\r\n      hist.push({\r\n        x0,\r\n        x1,\r\n        count: 0\r\n      });\r\n      x0 = x1;\r\n    }\r\n    return {hist, histGranularity: 'day'};\r\n  }\r\n\r\n  // by month\r\n  let x0 = new Date(min.getFullYear(), min.getMonth(), 1);\r\n  while (x0 <= max) {\r\n    const x1 = new Date(x0);\r\n    x1.setMonth(x1.getMonth() + 1);\r\n    hist.push({\r\n      x0,\r\n      x1,\r\n      count: 0\r\n    });\r\n    x0 = x1;\r\n  }\r\n  return {hist, histGranularity: 'month'};\r\n}\r\n\r\nfunction pushDateHist(hist: IDateBin[], v: Date, count: number = 1) {\r\n  if (v < hist[0].x1) {\r\n    hist[0].count += count;\r\n    return;\r\n  }\r\n  const l = hist.length - 1;\r\n  if (v > hist[l].x0) {\r\n    hist[l].count += count;\r\n    return;\r\n  }\r\n  if (l === 2) {\r\n    hist[1].count += count;\r\n    return;\r\n  }\r\n\r\n  let low = 1;\r\n  let high = l;\r\n  // binary search\r\n  while (low < high) {\r\n    const center = Math.floor((high + low) / 2);\r\n    if (v < hist[center].x1) {\r\n      high = center;\r\n    } else {\r\n      low = center + 1;\r\n    }\r\n  }\r\n  hist[low].count += count;\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport function dateStatsBuilder(template?: IDateStatistics): IBuilder<Date | null, IDateStatistics> {\r\n  let min: Date | null = null;\r\n  let max: Date | null = null;\r\n  let count = 0;\r\n  let missing = 0;\r\n\r\n  // yyyymmdd, count\r\n  const byDay = new Map<number, {x: Date, count: number}>();\r\n  const templateHist = template ? template.hist.map((d) => ({x0: d.x0, x1: d.x1, count: 0})) : null;\r\n\r\n  const push = (v: Date | null) => {\r\n    count += 1;\r\n    if (!v || v == null) {\r\n      missing += 1;\r\n      return;\r\n    }\r\n    if (min == null || v < min) {\r\n      min = v;\r\n    }\r\n    if (max == null || v > max) {\r\n      max = v;\r\n    }\r\n    if (templateHist) {\r\n      pushDateHist(templateHist, v, 1);\r\n      return;\r\n    }\r\n    const key = v.getFullYear() * 10000 + v.getMonth() * 100 + v.getDate();\r\n    if (byDay.has(key)) {\r\n      byDay.get(key)!.count++;\r\n    } else {\r\n      byDay.set(key, {count: 1, x: v});\r\n    }\r\n  };\r\n\r\n  const build = () => {\r\n    if (templateHist) {\r\n      return {\r\n        min,\r\n        max,\r\n        missing,\r\n        count,\r\n        maxBin: templateHist.reduce((acc, h) => Math.max(acc, h.count), 0),\r\n        hist: templateHist,\r\n        histGranularity: template!.histGranularity\r\n      };\r\n    }\r\n    // copy template else derive\r\n    const {histGranularity, hist} = computeGranularity(min, max);\r\n\r\n    byDay.forEach((v) => pushDateHist(hist, v.x, v.count));\r\n\r\n    return {\r\n      min,\r\n      max,\r\n      missing,\r\n      count,\r\n      maxBin: hist.reduce((acc, h) => Math.max(acc, h.count), 0),\r\n      hist,\r\n      histGranularity\r\n    };\r\n  };\r\n\r\n  return {push, build, pushAll: pushAll(push)};\r\n}\r\n\r\n/**\r\n * computes a categorical histogram\r\n * @param arr the data array\r\n * @param categories the list of known categories\r\n * @returns {{hist: {cat: string, y: number}[]}}\r\n * @internal\r\n */\r\nexport function categoricalStatsBuilder(categories: {name: string}[]): IBuilder<{name: string} | null, ICategoricalStatistics> {\r\n  const m = new Map<string, number>();\r\n  categories.forEach((cat) => m.set(cat.name, 0));\r\n\r\n  let missing = 0;\r\n  let count = 0;\r\n\r\n  const push = (v: ICategory | null) => {\r\n    count += 1;\r\n    if (v == null) {\r\n      missing += 1;\r\n    } else {\r\n      m.set(v.name, (m.get(v.name) || 0) + 1);\r\n    }\r\n  };\r\n\r\n  const build = () => {\r\n    const entries: ICategoricalBin[] = categories.map((d) => ({cat: d.name, count: m.get(d.name)!}));\r\n    const maxBin = entries.reduce((a, b) => Math.max(a, b.count), Number.NEGATIVE_INFINITY);\r\n\r\n    return {\r\n      maxBin,\r\n      hist: entries,\r\n      count,\r\n      missing\r\n    };\r\n  };\r\n\r\n  return {push, build, pushAll: pushAll(push)};\r\n}\r\n\r\n/**\r\n * round to the given commas similar to d3.round\r\n * @param {number} v\r\n * @param {number} precision\r\n * @returns {number}\r\n * @internal\r\n */\r\nexport function round(v: number, precision: number = 0) {\r\n  if (precision === 0) {\r\n    return Math.round(v);\r\n  }\r\n  const scale = Math.pow(10, precision);\r\n  return Math.round(v * scale) / scale;\r\n}\r\n\r\n/**\r\n * compares two number whether they are similar up to delta\r\n * @param {number} a first numbre\r\n * @param {number} b second number\r\n * @param {number} delta\r\n * @returns {boolean} a and b are similar\r\n * @internal\r\n */\r\nexport function similar(a: number, b: number, delta = 0.5) {\r\n  if (a === b) {\r\n    return true;\r\n  }\r\n  return Math.abs(a - b) < delta;\r\n}\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function isPromiseLike<T>(value: any): value is PromiseLike<T> {\r\n  return value instanceof Promise || typeof value.then === 'function';\r\n}\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function createIndexArray(length: number, dataSize = length) {\r\n  if (dataSize <= 255) {\r\n    return new Uint8Array(length);\r\n  }\r\n  if (dataSize <= 65535) {\r\n    return new Uint16Array(length);\r\n  }\r\n  return new Uint32Array(length);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function toIndexArray(arr: ISequence<number> | IndicesArray, maxDataIndex?: number): UIntTypedArray {\r\n  if (arr instanceof Uint8Array || arr instanceof Uint16Array || arr instanceof Uint32Array) {\r\n    return arr.slice();\r\n  }\r\n  const l = maxDataIndex != null ? maxDataIndex : arr.length;\r\n  if (l <= 255) {\r\n    return Uint8Array.from(arr);\r\n  }\r\n  if (l <= 65535) {\r\n    return Uint16Array.from(arr);\r\n  }\r\n  return Uint32Array.from(arr);\r\n}\r\n\r\nfunction createLike(template: IndicesArray, total: number, maxDataIndex?: number) {\r\n  if (template instanceof Uint8Array) {\r\n    return new Uint8Array(total);\r\n  }\r\n  if (template instanceof Uint16Array) {\r\n    return new Uint16Array(total);\r\n  }\r\n  if (template instanceof Uint32Array) {\r\n    return new Uint32Array(total);\r\n  }\r\n  return createIndexArray(total, maxDataIndex);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function joinIndexArrays(groups: IndicesArray[], maxDataIndex?: number) {\r\n  switch (groups.length) {\r\n    case 0:\r\n      return [];\r\n    case 1:\r\n      return groups[0];\r\n    default:\r\n      const total = groups.reduce((a, b) => a + b.length, 0);\r\n      const r = createLike(groups[0], total, maxDataIndex);\r\n      let shift = 0;\r\n      for (const g of groups) {\r\n        r.set(g, shift);\r\n        shift += g.length;\r\n      }\r\n      return r;\r\n  }\r\n}\r\n\r\n\r\nfunction asc(a: any, b: any) {\r\n  return a < b ? -1 : ((a > b) ? 1 : 0);\r\n}\r\n\r\nfunction desc(a: any, b: any) {\r\n  return a < b ? 1 : ((a > b) ? -1 : 0);\r\n}\r\n\r\n\r\nexport declare type ILookUpArray = Uint8Array | Uint16Array | Uint32Array | Int8Array | Int16Array | Int32Array | string[] | Float32Array | Float64Array;\r\n\r\n/**\r\n * sort the given index array based on the lookup array\r\n * @internal\r\n */\r\nexport function sortComplex(indices: UIntTypedArray | number[], comparators: {asc: boolean, lookup: ILookUpArray}[]) {\r\n  if (indices.length < 2) {\r\n    return indices;\r\n  }\r\n\r\n  switch (comparators.length) {\r\n    case 0:\r\n      // sort by indices\r\n      return indices.sort();\r\n    case 1:\r\n      const c = comparators[0]!.asc ? asc : desc;\r\n      const cLookup = comparators[0]!.lookup;\r\n      return indices.sort((a, b) => {\r\n        const r = c(cLookup[a]!, cLookup[b]!);\r\n        return r !== 0 ? r : a - b;\r\n      });\r\n    case 2:\r\n      const c1 = comparators[0]!.asc ? asc : desc;\r\n      const c1Lookup = comparators[0]!.lookup;\r\n      const c2 = comparators[1]!.asc ? asc : desc;\r\n      const c2Lookup = comparators[1]!.lookup;\r\n      return indices.sort((a, b) => {\r\n        let r = c1(c1Lookup[a], c1Lookup[b]);\r\n        r = r !== 0 ? r : c2(c2Lookup[a], c2Lookup[b]);\r\n        return r !== 0 ? r : a - b;\r\n      });\r\n    default:\r\n      const l = comparators.length;\r\n      const fs = comparators.map((d) => d.asc ? asc : desc);\r\n      return indices.sort((a, b) => {\r\n        for (let i = 0; i < l; ++i) {\r\n          const l = comparators[i].lookup;\r\n          const r = fs[i](l[a], l[b]);\r\n          if (r !== 0) {\r\n            return r;\r\n          }\r\n        }\r\n        return a - b;\r\n      });\r\n  }\r\n}\r\n\r\n// note the whole worker thing is in this one file to be able to copy the code\r\n\r\n/**\r\n * base worker message\r\n * @internal\r\n */\r\nexport interface IWorkerMessage {\r\n  type: string;\r\n  uid: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IStatsWorkerMessage extends IWorkerMessage {\r\n  /**\r\n   * reference key for the indices array\r\n   */\r\n  refIndices: string | null;\r\n  indices?: UIntTypedArray;\r\n\r\n  /**\r\n   * reference key for the data indices\r\n   */\r\n  refData: string;\r\n  data?: UIntTypedArray | Float32Array | Int32Array | Float64Array;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ISortMessageRequest {\r\n  type: 'sort';\r\n  uid: number;\r\n\r\n  ref: string;\r\n  indices: UIntTypedArray;\r\n  sortOrders?: {asc: boolean, lookup: ILookUpArray}[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ISortMessageResponse {\r\n  type: 'sort';\r\n\r\n  ref: string;\r\n  order: IndicesArray;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IDeleteRefMessageRequest {\r\n  type: 'deleteRef';\r\n\r\n  ref: string;\r\n  startsWith?: boolean;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ISetRefMessageRequest {\r\n  type: 'setRef';\r\n  uid: number;\r\n\r\n  ref: string;\r\n  data: UIntTypedArray | Float32Array | Int32Array | Float64Array | null;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IDateStatsMessageRequest {\r\n  type: 'dateStats';\r\n  uid: number;\r\n\r\n  refIndices: string | null;\r\n  indices?: UIntTypedArray;\r\n\r\n  refData: string;\r\n  data?: UIntTypedArray;\r\n\r\n  template?: IDateStatistics;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IDateStatsMessageResponse {\r\n  type: 'dateStats';\r\n  uid: number;\r\n\r\n  stats: IDateStatistics;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface INumberStatsMessageRequest {\r\n  type: 'numberStats';\r\n  uid: number;\r\n\r\n  refIndices: string | null;\r\n  indices?: UIntTypedArray;\r\n\r\n  refData: string;\r\n  data?: Float32Array;\r\n\r\n  numberOfBins: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface INumberStatsMessageResponse {\r\n  type: 'numberStats';\r\n  uid: number;\r\n\r\n  stats: IStatistics;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IBoxPlotStatsMessageRequest {\r\n  type: 'boxplotStats';\r\n  uid: number;\r\n\r\n  refIndices: string | null;\r\n  indices?: UIntTypedArray;\r\n\r\n  refData: string;\r\n  data?: Float32Array;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IBoxPlotStatsMessageResponse {\r\n  type: 'boxplotStats';\r\n  uid: number;\r\n\r\n  stats: IAdvancedBoxPlotData;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ICategoricalStatsMessageRequest {\r\n  type: 'categoricalStats';\r\n  uid: number;\r\n\r\n  refIndices: string | null;\r\n  indices?: UIntTypedArray;\r\n\r\n  refData: string;\r\n  data?: UIntTypedArray;\r\n\r\n  categories: string[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ICategoricalStatsMessageResponse {\r\n  type: 'categoricalStats';\r\n  uid: number;\r\n\r\n  stats: ICategoricalStatistics;\r\n}\r\n\r\n/**\r\n * helper to build a value cache for dates, use dateValueCache2Value to convert back\r\n * @internal\r\n */\r\nexport function dateValueCacheBuilder(length: number) {\r\n  const vs = new Float64Array(length);\r\n  let i = 0;\r\n  return {\r\n    push: (d: Date | null) => vs[i++] = d == null ? NaN : d.getTime(),\r\n    cache: vs\r\n  };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function dateValueCache2Value(v: number) {\r\n  return isNaN(v) ? null : new Date(v);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function categoricalValueCacheBuilder(length: number, categories: {name: string}[]) {\r\n  const vs = createIndexArray(length, categories.length + 1);\r\n  const name2index = new Map<string, number>();\r\n  for (let i = 0; i < categories.length; ++i) {\r\n    name2index.set(categories[i].name, i + 1); // shift by one for missing = 0\r\n  }\r\n  let i = 0;\r\n  return {\r\n    push: (d: {name: string} | null) => vs[i++] = d == null ? 0 : name2index.get(d.name) || 0,\r\n    cache: vs\r\n  };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function categoricalValueCache2Value<T extends {name: string}>(v: number, categories: T[]) {\r\n  return v === 0 ? null : categories[v - 1];\r\n}\r\n\r\n\r\nfunction sortWorkerMain() {\r\n  const wself = <IPoorManWorkerScope><any>self;\r\n\r\n  // stored refs to avoid duplicate copy\r\n  const refs = new Map<string, UIntTypedArray | Float32Array | Int32Array | Float64Array>();\r\n\r\n  const sort = (r: ISortMessageRequest) => {\r\n    if (r.sortOrders) {\r\n      sortComplex(r.indices, r.sortOrders);\r\n    }\r\n    const order = r.indices;\r\n\r\n    wself.postMessage(<ISortMessageResponse>{\r\n      type: r.type,\r\n      uid: r.uid,\r\n      ref: r.ref,\r\n      order\r\n    }, [r.indices.buffer]);\r\n  };\r\n\r\n  const setRef = (r: ISetRefMessageRequest) => {\r\n    if (r.data) {\r\n      refs.set(r.ref, r.data);\r\n    } else {\r\n      refs.delete(r.ref);\r\n    }\r\n  };\r\n\r\n  const deleteRef = (r: IDeleteRefMessageRequest) => {\r\n    if (!r.startsWith) {\r\n      refs.delete(r.ref);\r\n      return;\r\n    }\r\n\r\n    for (const key of Array.from(refs.keys())) {\r\n      if (key.startsWith(r.ref)) {\r\n        refs.delete(key);\r\n      }\r\n    }\r\n  };\r\n\r\n  const resolveRefs = <T extends UIntTypedArray | Float32Array | Int32Array>(r: IStatsWorkerMessage) => {\r\n    // resolve refs or save the new data\r\n\r\n    const data: T = r.data ? <T><any>r.data : <T><any>refs.get(r.refData)!;\r\n    const indices = r.indices ? r.indices : (r.refIndices ? <UIntTypedArray>refs.get(r.refIndices)! : undefined);\r\n    if (r.refData) {\r\n      refs.set(r.refData, data);\r\n    }\r\n    if (r.refIndices) {\r\n      refs.set(r.refIndices, indices!);\r\n    }\r\n    return {data, indices};\r\n  };\r\n\r\n  const dateStats = (r: IDateStatsMessageRequest) => {\r\n    const {data, indices} = resolveRefs<Int32Array>(r);\r\n\r\n    const b = dateStatsBuilder(r.template);\r\n    if (indices) {\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let ii = 0; ii < indices.length; ++ii) {\r\n        const v = data[indices[ii]];\r\n        b.push(dateValueCache2Value(v));\r\n      }\r\n    } else {\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let i = 0; i < data.length; ++i) {\r\n        b.push(dateValueCache2Value(data[i]));\r\n      }\r\n    }\r\n    wself.postMessage(<IDateStatsMessageResponse>{\r\n      type: r.type,\r\n      uid: r.uid,\r\n      stats: b.build()\r\n    });\r\n  };\r\n\r\n  const categoricalStats = (r: ICategoricalStatsMessageRequest) => {\r\n    const {data, indices} = resolveRefs<UIntTypedArray>(r);\r\n\r\n    const cats = r.categories.map((name) => ({name}));\r\n    const b = categoricalStatsBuilder(cats);\r\n    if (indices) {\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let ii = 0; ii < indices.length; ++ii) {\r\n        b.push(categoricalValueCache2Value(data[indices[ii]], cats));\r\n      }\r\n    } else {\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let i = 0; i < data.length; ++i) {\r\n        b.push(categoricalValueCache2Value(data[i], cats));\r\n      }\r\n    }\r\n\r\n    wself.postMessage(<ICategoricalStatsMessageResponse>{\r\n      type: r.type,\r\n      uid: r.uid,\r\n      stats: b.build()\r\n    });\r\n  };\r\n\r\n  const numberStats = (r: INumberStatsMessageRequest) => {\r\n    const {data, indices} = resolveRefs<Float32Array>(r);\r\n\r\n    const b = normalizedStatsBuilder(r.numberOfBins);\r\n\r\n    if (indices) {\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let ii = 0; ii < indices.length; ++ii) {\r\n        b.push(data[indices[ii]]);\r\n      }\r\n    } else {\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let i = 0; i < data.length; ++i) {\r\n        b.push(data[i]);\r\n      }\r\n    }\r\n\r\n    wself.postMessage(<INumberStatsMessageResponse>{\r\n      type: r.type,\r\n      uid: r.uid,\r\n      stats: b.build()\r\n    });\r\n  };\r\n\r\n  const boxplotStats = (r: IBoxPlotStatsMessageRequest) => {\r\n    const {data, indices} = resolveRefs<Float32Array>(r);\r\n\r\n    const b = boxplotBuilder(indices ? indices.length : undefined);\r\n\r\n    let stats: IAdvancedBoxPlotData;\r\n    if (!indices) {\r\n      stats = b.buildArr(data);\r\n    } else {\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let ii = 0; ii < indices.length; ++ii) {\r\n        b.push(data[indices[ii]]);\r\n      }\r\n      stats = b.build();\r\n    }\r\n\r\n    wself.postMessage(<IBoxPlotStatsMessageResponse>{\r\n      type: r.type,\r\n      uid: r.uid,\r\n      stats\r\n    });\r\n  };\r\n\r\n  // message type to handler function\r\n  const msgHandlers: {[key: string]: (r: any) => void} = {\r\n    sort,\r\n    setRef,\r\n    deleteRef,\r\n    dateStats,\r\n    categoricalStats,\r\n    numberStats,\r\n    boxplotStats\r\n  };\r\n\r\n  wself.addEventListener('message', (evt) => {\r\n    const r = evt.data;\r\n    if (typeof r.uid !== 'number' || typeof r.type !== 'string') {\r\n      return;\r\n    }\r\n    const h = msgHandlers[r.type];\r\n    if (h) {\r\n      h(r);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * copy source code of a worker and create a blob out of it\r\n * to avoid webpack imports all the code functions need to be in this file\r\n * @internal\r\n */\r\nexport function createWorkerBlob() {\r\n  return createWorkerCodeBlob([\r\n    pushAll.toString(),\r\n    quantile.toString(),\r\n    normalizedStatsBuilder.toString(),\r\n    boxplotBuilder.toString(),\r\n    computeGranularity.toString(),\r\n    pushDateHist.toString(),\r\n    dateStatsBuilder.toString(),\r\n    categoricalStatsBuilder.toString(),\r\n    createIndexArray.toString(),\r\n    asc.toString(),\r\n    desc.toString(),\r\n    sortComplex.toString(),\r\n    dateValueCache2Value.toString(),\r\n    categoricalValueCache2Value.toString(),\r\n    toFunctionBody(sortWorkerMain)\r\n  ]);\r\n}\r\n","\r\n/** @internal */\r\nexport function equalArrays<T>(a: T[], b: T[]) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  return a.every((ai, i) => ai === b[i]);\r\n}\r\n\r\n\r\n/**\r\n * converts a given id to css compatible one\r\n * @param id\r\n * @return {string|void}\r\n * @internal\r\n */\r\nexport function fixCSS(id: string) {\r\n  return id.replace(/[\\s!#$%&'()*+,.\\/:;<=>?@\\[\\\\\\]^`{|}~]+/g, '_'); //replace non css stuff to _\r\n}\r\n\r\n/**\r\n * clear node clearing\r\n * @param node\r\n * @internal\r\n */\r\nexport function clear<T extends Node>(node: T) {\r\n  while (node.lastChild) {\r\n    node.removeChild(node.lastChild);\r\n  }\r\n  return node;\r\n}\r\n\r\n/**\r\n * @internal\r\n * to avoid [].concat(...) which doesn't work for large arrays\r\n * @param arrs\r\n */\r\nexport function concat<T>(arrs: (T[] | T)[]): T[] {\r\n  const r: T[] = [];\r\n  for (const a of arrs) {\r\n    if (!Array.isArray(a)) {\r\n      r.push(a);\r\n      continue;\r\n    }\r\n    for (const ai of a) {\r\n      r.push(ai);\r\n    }\r\n  }\r\n  return r;\r\n}\r\n\r\n\r\n/**\r\n * generates a label for the given sort method\r\n * @internal\r\n * @param method sort method\r\n */\r\nexport function getSortLabel(method: string) {\r\n  switch (method) {\r\n    case 'min':\r\n      return 'Mininum';\r\n    case 'max':\r\n      return 'Maximum';\r\n    case 'median':\r\n      return 'Median';\r\n    case 'mean':\r\n      return 'Mean';\r\n    case 'q1':\r\n      return '25% Quantile';\r\n    case 'q3':\r\n      return '75% Quantile';\r\n    default:\r\n      return String(method);\r\n  }\r\n}\r\n","var noop = {value: function() {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _)) throw new Error(\"illegal type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) args[i] = arguments[i + 2];\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","import {dispatch, Dispatch} from 'd3-dispatch';\r\n\r\n/**\r\n * helper function to suffix the given event types\r\n * @internal\r\n */\r\nexport function suffix(suffix: string, ...prefix: string[]) {\r\n  return prefix.map((p) => `${p}${suffix}`);\r\n}\r\n\r\nexport interface IEventContext {\r\n  /**\r\n   * who is sending this event\r\n   */\r\n  readonly source: AEventDispatcher;\r\n\r\n  /**\r\n   * who was sending this event in case of forwarding\r\n   */\r\n  readonly origin: AEventDispatcher;\r\n  /**\r\n   * the event type\r\n   */\r\n  readonly type: string;\r\n  /**\r\n   * in case of multi propagation the 'main' event type, aka the first one\r\n   */\r\n  readonly primaryType: string;\r\n  /**\r\n   * the arguments to the listener\r\n   */\r\n  readonly args: any[];\r\n}\r\n\r\nexport interface IEventListener {\r\n  (this: IEventContext, ...args: any[]): any;\r\n}\r\n\r\nexport interface IEventHandler {\r\n  on(type: string | string[], listener: IEventListener | null): this;\r\n}\r\n\r\nconst __DEBUG = false;\r\n\r\n/**\r\n * base class for event dispatching using d3 event mechanism, thus .suffix is supported for multiple registrations\r\n */\r\nexport default class AEventDispatcher implements IEventHandler {\r\n  private readonly listeners: Dispatch<any>;\r\n  private readonly listenerEvents: Set<string>;\r\n  private readonly forwarder: (...args: any[]) => void;\r\n\r\n  constructor() {\r\n    const events = this.createEventList();\r\n    this.listenerEvents = new Set(events);\r\n    this.listeners = dispatch(...events);\r\n\r\n    const that = this;\r\n    this.forwarder = function (this: IEventContext, ...args: any[]) {\r\n      that.fireImpl(this.type, this.primaryType, this.origin, ...args);\r\n    };\r\n  }\r\n\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    if (Array.isArray(type)) {\r\n      type.forEach((d) => {\r\n        if (this.listenerEvents.has(d.split('.')[0])) {\r\n          this.listenersChanged(d, Boolean(listener!));\r\n          this.listeners.on(d, listener!);\r\n        } else if (__DEBUG && !d.includes('.')) {\r\n          console.warn(this, 'invalid event type', d);\r\n        }\r\n      });\r\n    } else if (this.listenerEvents.has((<string>type).split('.')[0])) {\r\n      this.listenersChanged(<string>type, Boolean(listener!));\r\n      this.listeners.on(<string>type, listener!);\r\n    } else if (__DEBUG && !type.includes('.')) {\r\n      console.warn(this, 'invalid event type', type);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * helper function that will be called upon a listener has changed\r\n   * @param _type event type\r\n   * @param _active registered or deregistered\r\n   */\r\n  protected listenersChanged(_type: string, _active: boolean) {\r\n    // hook\r\n  }\r\n\r\n  /**\r\n   * return the list of events to be able to dispatch\r\n   * @return {Array} by default no events\r\n   */\r\n  protected createEventList(): string[] {\r\n    return [];\r\n  }\r\n\r\n  protected fire(type: string | string[], ...args: any[]) {\r\n    const primaryType = Array.isArray(type) ? type[0] : type;\r\n    this.fireImpl(type, primaryType, this, ...args);\r\n  }\r\n\r\n  private fireImpl(type: string | string[], primaryType: string, origin: AEventDispatcher, ...args: any[]) {\r\n    const fireImpl = (t: string) => {\r\n      if (!this.listenerEvents.has(t)) {\r\n        if (__DEBUG) {\r\n          console.warn(this, 'invalid event type', t);\r\n        }\r\n        return;\r\n      }\r\n      //local context per event, set a this argument\r\n      const context: IEventContext = {\r\n        source: this, //who is sending this event,\r\n        origin,\r\n        type: t, //the event type\r\n        primaryType, //in case of multi propagation the 'main' event type\r\n        args //the arguments to the listener\r\n      };\r\n      this.listeners.apply(t, context, args);\r\n    };\r\n    if (Array.isArray(type)) {\r\n      type.forEach(fireImpl);\r\n    } else {\r\n      fireImpl(<string>type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * forwards one or more events from a given dispatcher to the current one\r\n   * i.e. when one of the given events is fired in 'from' it will be forwarded to all my listeners\r\n   * @param {IEventHandler} from the event dispatcher to forward from\r\n   * @param {string[]} types the event types to forward\r\n   */\r\n  protected forward(from: IEventHandler, ...types: string[]) {\r\n    from.on(types, this.forwarder);\r\n  }\r\n\r\n  /**\r\n   * removes the forwarding declarations\r\n   * @param {IEventHandler} from the originated dispatcher\r\n   * @param {string[]} types event types to forward\r\n   */\r\n  protected unforward(from: IEventHandler, ...types: string[]) {\r\n    from.on(types, null);\r\n  }\r\n}\r\n","import Column from './Column';\r\nimport Ranking from './Ranking';\r\nimport CompositeColumn from './CompositeColumn';\r\nimport {IColorMappingFunction, IMappingFunction} from './INumberColumn';\r\nimport {ICategoricalColorMappingFunction, ICategory} from './ICategoricalColumn';\r\nimport {IScriptMappingFunctionType} from './MappingFunction';\r\n\r\n\r\nexport interface IColumnConstructor {\r\n  new(id: string, desc: Readonly<IColumnDesc> & any, factory: ITypeFactory): Column;\r\n}\r\n\r\nexport interface IStyleColumn {\r\n  /**\r\n   * column description\r\n   */\r\n  description: string;\r\n\r\n  /**\r\n   * column summary line (subtitle)\r\n   */\r\n  summary: string;\r\n\r\n  /**\r\n   * color of this column\r\n   * @deprecated not used anymore\r\n   */\r\n  color: string;\r\n\r\n  /**\r\n   * frozen column\r\n   * @default isSupportType\r\n   */\r\n  frozen: boolean;\r\n\r\n  /**\r\n   * whether the column can be removed or not\r\n   * @default false\r\n   */\r\n  fixed: boolean;\r\n\r\n  /**\r\n   * default renderer to use\r\n   */\r\n  renderer: string;\r\n\r\n  /**\r\n   * default group renderer to use\r\n   */\r\n  groupRenderer: string;\r\n\r\n  /**\r\n   * default summary renderer to use\r\n   */\r\n  summaryRenderer: string;\r\n\r\n  /**\r\n   * initial width of the column\r\n   * @default 100 or 200 for strings\r\n   */\r\n  width: number;\r\n\r\n  /**\r\n   * is this column visible by default\r\n   * @default true\r\n   */\r\n  visible: boolean;\r\n}\r\n\r\n/**\r\n * default color that should be used\r\n * @type {string}\r\n */\r\nexport const DEFAULT_COLOR = '#C1C1C1';\r\n\r\n\r\nexport interface IColumnDesc extends Partial<IStyleColumn> {\r\n  /**\r\n   * label of the column\r\n   */\r\n  label: string;\r\n  /**\r\n   * the column type\r\n   */\r\n  type: string;\r\n}\r\n\r\nexport interface IValueColumnDesc<T> extends IColumnDesc {\r\n  /**\r\n   * is the data lazy loaded and not yet available\r\n   * @default false\r\n   */\r\n  lazyLoaded?: boolean;\r\n\r\n  /**\r\n   * value accessor of this column\r\n   * @param row the current row\r\n   * @param desc the description of this column\r\n   */\r\n  accessor?(row: IDataRow, desc: Readonly<IValueColumnDesc<T>>): T;\r\n}\r\n\r\nexport interface IFlatColumn {\r\n  readonly col: Column;\r\n  readonly offset: number;\r\n  readonly width: number;\r\n}\r\n\r\nexport interface IColumnParent {\r\n  remove(col: Column): boolean;\r\n\r\n  insert(col: Column, index?: number): Column | null;\r\n\r\n  insertAfter(col: Column, reference: Column): Column | null;\r\n\r\n  move(col: Column, index?: number): Column | null;\r\n\r\n  moveAfter(col: Column, reference: Column): Column | null;\r\n\r\n  findMyRanker(): Ranking | null;\r\n\r\n  readonly fqid: string;\r\n\r\n  indexOf(col: Column): number;\r\n\r\n  at(index: number): Column;\r\n\r\n  readonly fqpath: string;\r\n\r\n}\r\n\r\n\r\nexport interface IColumnMetaData {\r\n  label: string;\r\n  summary: string;\r\n  description: string;\r\n}\r\n\r\nexport declare type ICompareValue = string | number | null;\r\n\r\n\r\n/**\r\n * a data row for rendering\r\n */\r\nexport interface IDataRow {\r\n  /**\r\n   * the value\r\n   */\r\n  readonly v: any;\r\n  /**\r\n   * the underlying data index\r\n   */\r\n  readonly i: number;\r\n}\r\n\r\n\r\nexport interface IGroup {\r\n  name: string;\r\n  color: string;\r\n  parent?: Readonly<IGroupParent> | null;\r\n}\r\n\r\nexport declare type IndicesArray = (ReadonlyArray<number> | UIntTypedArray) & ArrayLike<number>;\r\n\r\nexport interface IOrderedGroup extends IGroup {\r\n  order: IndicesArray;\r\n}\r\n\r\nexport const defaultGroup: IGroup = {\r\n  name: 'Default',\r\n  color: 'gray'\r\n};\r\n\r\nexport const othersGroup: IGroup = {\r\n  name: 'Others',\r\n  color: 'gray'\r\n};\r\n\r\n\r\nexport interface IGroupParent extends IGroup {\r\n  subGroups: (Readonly<IGroupParent> | Readonly<IGroup>)[];\r\n}\r\n\r\nexport interface IGroupItem {\r\n  readonly dataIndex: number;\r\n  readonly group: Readonly<IOrderedGroup>;\r\n  readonly relativeIndex: number;\r\n}\r\n\r\nexport declare type IGroupData = Readonly<IOrderedGroup>;\r\n\r\nexport function isGroup(item: IGroupData | IGroupItem): item is IGroupData {\r\n  return item && (<IGroupItem>item).group == null; // use .group as separator\r\n}\r\n\r\nexport declare type UIntTypedArray = Uint8Array | Uint16Array | Uint32Array;\r\n\r\nexport enum ECompareValueType {\r\n  BINARY,\r\n  COUNT, // count max to the number of rows\r\n  UINT8,\r\n  UINT16,\r\n  UINT32,\r\n  INT8,\r\n  INT16,\r\n  INT32,\r\n  FLOAT,\r\n  FLOAT_ASC,\r\n  DOUBLE,\r\n  DOUBLE_ASC,\r\n  STRING\r\n}\r\n\r\n\r\nexport interface ITypedDump {\r\n  readonly type: string;\r\n  [key: string]: any;\r\n}\r\n\r\n\r\nexport interface IColumnDump {\r\n  id: string;\r\n  width?: number;\r\n  desc: any;\r\n  label?: string;\r\n  summary?: string;\r\n  renderer?: string;\r\n  /**\r\n   * @deprecated\r\n   */\r\n  rendererType?: string;\r\n  groupRenderer?: string;\r\n  summaryRenderer?: string;\r\n\r\n  // type specific\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface IRankingDump {\r\n  /**\r\n   * columsn of this ranking\r\n   */\r\n  columns?: IColumnDump[];\r\n\r\n  /**\r\n   * sort criteria\r\n   */\r\n  sortCriteria?: {asc: boolean, sortBy: string}[];\r\n\r\n  /**\r\n   * group sort criteria\r\n   */\r\n  groupSortCriteria?: {asc: boolean, sortBy: string}[];\r\n\r\n  /**\r\n   * uids of group columns\r\n   */\r\n  groupColumns?: string[];\r\n\r\n  /**\r\n   * compatability\r\n   * @deprecated\r\n   */\r\n  sortColumn?: {sortBy: string, asc: boolean};\r\n}\r\n\r\nexport interface ITypeFactory {\r\n  (dump: IColumnDump): Column;\r\n\r\n  colorMappingFunction(dump?: ITypedDump | string | ((v: number) => string)): IColorMappingFunction;\r\n  mappingFunction(dump?: ITypedDump | IScriptMappingFunctionType): IMappingFunction;\r\n  categoricalColorMappingFunction(dump: ITypedDump | undefined, categories: ICategory[]): ICategoricalColorMappingFunction;\r\n}\r\n\r\nexport interface IMultiLevelColumn extends CompositeColumn {\r\n  getCollapsed(): boolean;\r\n\r\n  setCollapsed(value: boolean): void;\r\n}\r\n\r\nexport function isMultiLevelColumn(col: Column): col is IMultiLevelColumn {\r\n  return typeof ((<IMultiLevelColumn>col).getCollapsed) === 'function';\r\n}\r\n\r\nexport interface ISortCriteria {\r\n  readonly col: Column;\r\n  readonly asc: boolean;\r\n}\r\n","import {AEventDispatcher, ISequence, similar, fixCSS, IEventListener} from '../internal';\r\nimport {isSortingAscByDefault} from './annotations';\r\nimport {IColumnDump, ISortCriteria, defaultGroup, ECompareValueType, IColumnDesc, IDataRow, IGroup, IColumnParent, IColumnMetaData, IFlatColumn, ICompareValue, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport Ranking from './Ranking';\r\n\r\n/**\r\n * emitted when the width property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function widthChanged(previous: number, current: number): void;\r\n\r\n/**\r\n * emitted when the label property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function labelChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the meta data property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function metaDataChanged(previous: IColumnMetaData, current: IColumnMetaData): void;\r\n\r\n/**\r\n * emitted when state of the column is dirty\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function dirty(): void;\r\n\r\n/**\r\n * emitted when state of the column related to its header is dirty\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function dirtyHeader(): void;\r\n\r\n/**\r\n * emitted when state of the column related to its values is dirty\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function dirtyValues(): void;\r\n\r\n/**\r\n * emitted when state of the column related to cached values (hist, compare, ...) is dirty\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function dirtyCaches(): void;\r\n\r\n/**\r\n * emitted when the renderer type property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function rendererTypeChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the group renderer property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function groupRendererChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the pattern property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function summaryRendererChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the visibility of this column changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function visibilityChanged(previous: boolean, current: boolean): void;\r\n\r\n/**\r\n * a column in LineUp\r\n */\r\nexport default class Column extends AEventDispatcher {\r\n  /**\r\n   * magic variable for showing all columns\r\n   * @type {number}\r\n   */\r\n  static readonly FLAT_ALL_COLUMNS = -1;\r\n\r\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\r\n  static readonly EVENT_LABEL_CHANGED = 'labelChanged';\r\n  static readonly EVENT_METADATA_CHANGED = 'metaDataChanged';\r\n  static readonly EVENT_DIRTY = 'dirty';\r\n  static readonly EVENT_DIRTY_HEADER = 'dirtyHeader';\r\n  static readonly EVENT_DIRTY_VALUES = 'dirtyValues';\r\n  static readonly EVENT_DIRTY_CACHES = 'dirtyCaches';\r\n  static readonly EVENT_RENDERER_TYPE_CHANGED = 'rendererTypeChanged';\r\n  static readonly EVENT_GROUP_RENDERER_TYPE_CHANGED = 'groupRendererChanged';\r\n  static readonly EVENT_SUMMARY_RENDERER_TYPE_CHANGED = 'summaryRendererChanged';\r\n  static readonly EVENT_VISIBILITY_CHANGED = 'visibilityChanged';\r\n\r\n  /**\r\n   * the id of this column\r\n   */\r\n  private uid: string;\r\n\r\n  /**\r\n   * width of the column\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  private width: number = 100;\r\n\r\n  /**\r\n   * parent column of this column, set when added to a ranking or combined column\r\n   */\r\n  parent: Readonly<IColumnParent> | null = null;\r\n\r\n  private metadata: Readonly<IColumnMetaData>;\r\n  private renderer: string;\r\n  private groupRenderer: string;\r\n  private summaryRenderer: string;\r\n  private visible: boolean;\r\n\r\n  constructor(id: string, public readonly desc: Readonly<IColumnDesc>) {\r\n    super();\r\n    this.uid = fixCSS(id);\r\n    this.renderer = this.desc.renderer || this.desc.type;\r\n    this.groupRenderer = this.desc.groupRenderer || this.desc.type;\r\n    this.summaryRenderer = this.desc.summaryRenderer || this.desc.type;\r\n    this.width = this.desc.width != null && this.desc.width > 0 ? this.desc.width : 100;\r\n    this.visible = this.desc.visible !== false;\r\n\r\n    this.metadata = {\r\n      label: desc.label || this.id,\r\n      summary: desc.summary || '',\r\n      description: desc.description || ''\r\n    };\r\n  }\r\n\r\n  get fixed() {\r\n    return Boolean(this.desc.fixed);\r\n  }\r\n\r\n  get frozen() {\r\n    return Boolean(this.desc.frozen);\r\n  }\r\n\r\n  get id() {\r\n    return this.uid;\r\n  }\r\n\r\n  assignNewId(idGenerator: () => string) {\r\n    this.uid = fixCSS(idGenerator());\r\n  }\r\n\r\n  get label() {\r\n    return this.metadata.label;\r\n  }\r\n\r\n  get description() {\r\n    return this.metadata.description;\r\n  }\r\n\r\n  /**\r\n   * returns the fully qualified id i.e. path the parent\r\n   * @returns {string}\r\n   */\r\n  get fqid() {\r\n    return this.parent ? `${this.parent.fqid}_${this.id}` : this.id;\r\n  }\r\n\r\n  get fqpath() {\r\n    return this.parent ? `${this.parent.fqpath}@${this.parent.indexOf(this)}` : '';\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([Column.EVENT_WIDTH_CHANGED,\r\n    Column.EVENT_LABEL_CHANGED, Column.EVENT_METADATA_CHANGED, Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\r\n    Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\r\n    Column.EVENT_DIRTY, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES]);\r\n  }\r\n\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getWidth() {\r\n    return this.width;\r\n  }\r\n\r\n  hide() {\r\n    this.setVisible(false);\r\n  }\r\n\r\n  show() {\r\n    this.setVisible(true);\r\n  }\r\n\r\n  isVisible() {\r\n    return this.visible;\r\n  }\r\n\r\n  getVisible() {\r\n    return this.isVisible();\r\n  }\r\n\r\n  setVisible(value: boolean) {\r\n    if (this.visible === value) {\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.visible, this.visible = value);\r\n  }\r\n\r\n  /**\r\n   * visitor pattern for flattening the columns\r\n   * @param {IFlatColumn} r the result array\r\n   * @param {number} offset left offset\r\n   * @param {number} _levelsToGo how many levels down\r\n   * @param {number} _padding padding between columns\r\n   * @returns {number} the used width by this column\r\n   */\r\n  flatten(r: IFlatColumn[], offset: number, _levelsToGo = 0, _padding = 0): number {\r\n    const w = this.getWidth();\r\n    r.push({col: this, offset, width: w});\r\n    return w;\r\n  }\r\n\r\n  setWidth(value: number) {\r\n    if (similar(this.width, value, 0.5)) {\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_WIDTH_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.width, this.width = value);\r\n  }\r\n\r\n  setWidthImpl(value: number) {\r\n    this.width = value;\r\n  }\r\n\r\n  setMetaData(value: Readonly<IColumnMetaData>) {\r\n    if (value.label === this.label && this.description === value.description && this.metadata.summary === value.summary) {\r\n      return;\r\n    }\r\n    const bak = this.getMetaData();\r\n    //copy to avoid reference\r\n    this.metadata = {\r\n      label: value.label,\r\n      summary: value.summary,\r\n      description: value.description\r\n    };\r\n\r\n    this.fire([Column.EVENT_LABEL_CHANGED, Column.EVENT_METADATA_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], bak, this.getMetaData());\r\n  }\r\n\r\n  getMetaData(): Readonly<IColumnMetaData> {\r\n    return Object.assign({}, this.metadata);\r\n  }\r\n\r\n  /**\r\n   * triggers that the ranking is sorted by this column\r\n   * @param ascending ascending order?\r\n   * @param priority sorting priority\r\n   * @returns {boolean} was successful\r\n   */\r\n  sortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.sortBy(this, ascending, priority);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  groupByMe(): boolean {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.toggleGrouping(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {number}\r\n   */\r\n  isGroupedBy(): number {\r\n    const r = this.findMyRanker();\r\n    if (!r) {\r\n      return -1;\r\n    }\r\n    return r.getGroupCriteria().indexOf(this);\r\n  }\r\n\r\n  /**\r\n   * toggles the sorting order of this column in the ranking\r\n   * @returns {boolean} was successful\r\n   */\r\n  toggleMySorting() {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.toggleSorting(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private isSortedByMeImpl(selector: ((r: Ranking) => ISortCriteria[])): {asc: 'asc' | 'desc' | undefined, priority: number | undefined} {\r\n    const ranker = this.findMyRanker();\r\n    if (!ranker) {\r\n      return {asc: undefined, priority: undefined};\r\n    }\r\n    const criterias = selector(ranker);\r\n    const index = criterias.findIndex((c) => c.col === this);\r\n    if (index < 0) {\r\n      return {asc: undefined, priority: undefined};\r\n    }\r\n    return {\r\n      asc: criterias[index].asc ? 'asc' : 'desc',\r\n      priority: index\r\n    };\r\n  }\r\n\r\n  isSortedByMe() {\r\n    return this.isSortedByMeImpl((r) => r.getSortCriteria());\r\n  }\r\n\r\n  groupSortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.groupSortBy(this, ascending, priority);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  toggleMyGroupSorting() {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.toggleGroupSorting(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  isGroupSortedByMe() {\r\n    return this.isSortedByMeImpl((r) => r.getGroupSortCriteria());\r\n  }\r\n\r\n  /**\r\n   * removes the column from the ranking\r\n   * @returns {boolean} was successful\r\n   */\r\n  removeMe() {\r\n    if (this.fixed) {\r\n      return false;\r\n    }\r\n    if (this.parent) {\r\n      return this.parent.remove(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * called when the columns added to a ranking\r\n   */\r\n  attach(parent: IColumnParent) {\r\n    this.parent = parent;\r\n  }\r\n\r\n  /**\r\n   * called when the column is removed from the ranking\r\n   */\r\n  detach() {\r\n    this.parent = null;\r\n  }\r\n\r\n  /**\r\n   * inserts the given column after itself\r\n   * @param col the column to insert\r\n   * @returns {boolean} was successful\r\n   */\r\n  insertAfterMe(col: Column) {\r\n    if (this.parent) {\r\n      return this.parent.insertAfter(col, this) != null;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * finds the underlying ranking column\r\n   * @returns {Ranking|null} my current ranking\r\n   */\r\n  findMyRanker(): Ranking | null {\r\n    if (this.parent) {\r\n      return this.parent.findMyRanker();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * dumps this column to JSON compatible format\r\n   * @param toDescRef helper mapping function\r\n   * @returns {any} dump of this column\r\n   */\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r: IColumnDump = {\r\n      id: this.id,\r\n      desc: toDescRef(this.desc),\r\n      width: this.width\r\n    };\r\n    if (this.label !== (this.desc.label || this.id)) {\r\n      r.label = this.label;\r\n    }\r\n    if (this.metadata.summary) {\r\n      r.summary = this.metadata.summary;\r\n    }\r\n    if (this.getRenderer() !== this.desc.type) {\r\n      r.renderer = this.getRenderer();\r\n    }\r\n    if (this.getGroupRenderer() !== this.desc.type) {\r\n      r.groupRenderer = this.getGroupRenderer();\r\n    }\r\n    if (this.getSummaryRenderer() !== this.desc.type) {\r\n      r.summaryRenderer = this.getSummaryRenderer();\r\n    }\r\n    return r;\r\n  }\r\n\r\n  /**\r\n   * restore the column content from a dump\r\n   * @param dump column dump\r\n   * @param _factory helper for creating columns\r\n   */\r\n  restore(dump: IColumnDump, _factory: ITypeFactory) {\r\n    this.width = dump.width || this.width;\r\n    this.metadata = {\r\n      label: dump.label || this.label,\r\n      summary: dump.summary || '',\r\n      description: this.description\r\n    };\r\n    if (dump.renderer || dump.rendererType) {\r\n      this.renderer = dump.renderer || dump.rendererType || this.renderer;\r\n    }\r\n    if (dump.groupRenderer) {\r\n      this.groupRenderer = dump.groupRenderer;\r\n    }\r\n    if (dump.summaryRenderer) {\r\n      this.summaryRenderer = dump.summaryRenderer;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * return the label of a given row for the current column\r\n   * @param row the current row\r\n   * @return {string} the label of this column at the specified row\r\n   */\r\n  getLabel(row: IDataRow): string {\r\n    const v = this.getValue(row);\r\n    return v == null ? '' : String(v);\r\n  }\r\n\r\n  /**\r\n   * return the value of a given row for the current column\r\n   * @param _row the current row\r\n   * @return the value of this column at the specified row\r\n   */\r\n  getValue(_row: IDataRow): any | null {\r\n    return ''; //no value\r\n  }\r\n\r\n  /**\r\n   * returns the value to be used when exporting\r\n   * @param format format hint\r\n   */\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'text' ? this.getLabel(row) : this.getValue(row);\r\n  }\r\n\r\n  getColor(_row: IDataRow) {\r\n    return DEFAULT_COLOR;\r\n  }\r\n\r\n  toCompareValue(_row: IDataRow, _valueCache?: any): ICompareValue | ICompareValue[] {\r\n    return 0;\r\n  }\r\n\r\n  toCompareValueType(): ECompareValueType | ECompareValueType[] {\r\n    return ECompareValueType.UINT8;\r\n  }\r\n\r\n  /**\r\n   * group the given row into a bin/group\r\n   * @param _row\r\n   * @return {IGroup}\r\n   */\r\n  group(_row: IDataRow, _valueCache?: any): IGroup {\r\n    return Object.assign({}, defaultGroup);\r\n  }\r\n\r\n  toCompareGroupValue(_rows: ISequence<IDataRow>, group: IGroup, _valueCache?: ISequence<any>): ICompareValue | ICompareValue[] {\r\n    return group.name.toLowerCase();\r\n  }\r\n\r\n  toCompareGroupValueType(): ECompareValueType | ECompareValueType[] {\r\n    return ECompareValueType.STRING;\r\n  }\r\n\r\n  /**\r\n   * flag whether any filter is applied\r\n   * @return {boolean}\r\n   */\r\n  isFiltered() {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * clear the filter\r\n   * @return {boolean} whether the filtered needed to be reseted\r\n   */\r\n  clearFilter() {\r\n    // hook to clear the filter\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * predicate whether the current row should be included\r\n   * @param row\r\n   * @return {boolean}\r\n   */\r\n  filter(row: IDataRow, _valueCache?: any) {\r\n    return row != null;\r\n  }\r\n\r\n  /**\r\n   * determines the renderer type that should be used to render this column. By default the same type as the column itself\r\n   * @return {string}\r\n   */\r\n  getRenderer(): string {\r\n    return this.renderer;\r\n  }\r\n\r\n  getGroupRenderer(): string {\r\n    return this.groupRenderer;\r\n  }\r\n\r\n  getSummaryRenderer(): string {\r\n    return this.summaryRenderer;\r\n  }\r\n\r\n  setRenderer(renderer: string) {\r\n    if (renderer === this.renderer) {\r\n      // nothing changes\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.renderer, this.renderer = renderer);\r\n  }\r\n\r\n  setGroupRenderer(renderer: string) {\r\n    if (renderer === this.groupRenderer) {\r\n      // nothing changes\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.groupRenderer, this.groupRenderer = renderer);\r\n  }\r\n\r\n  setSummaryRenderer(renderer: string) {\r\n    if (renderer === this.summaryRenderer) {\r\n      // nothing changes\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.summaryRenderer, this.summaryRenderer = renderer);\r\n  }\r\n\r\n  /**\r\n   * marks the header, values, or both as dirty such that the values are reevaluated\r\n   * @param type specify in more detail what is dirty, by default whole column\r\n   */\r\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\r\n    switch (type) {\r\n      case 'header':\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\r\n      case 'values':\r\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY]);\r\n      default:\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY]);\r\n    }\r\n  }\r\n}\r\n","import 'reflect-metadata';\r\nimport Column from './Column';\r\nimport {IColumnDesc, IColumnConstructor} from './interfaces';\r\n\r\nconst supportType = Symbol.for('SupportType');\r\nconst category = Symbol.for('Category');\r\n\r\nexport function SupportType() {\r\n  return Reflect.metadata(supportType, true);\r\n}\r\n\r\nexport function SortByDefault(order: 'ascending'|'descending' = 'ascending') {\r\n  if (order === 'descending') {\r\n    return Reflect.metadata(Symbol.for('sortDescendingByDefault'), true);\r\n  }\r\n  return (d: any) => d;\r\n}\r\n\r\nexport function isSortingAscByDefault(col: Column) {\r\n  const clazz = (<any>col).constructor;\r\n  return !Reflect.hasMetadata(Symbol.for('sortDescendingByDefault'), clazz);\r\n}\r\n\r\nexport class Categories {\r\n  readonly string = {label: 'label', order: 1, name: 'string', featureLevel: 'basic'};\r\n  readonly categorical = {label: 'categorical', order: 2, name: 'categorical', featureLevel: 'basic'};\r\n  readonly number = {label: 'numerical', order: 3, name: 'number', featureLevel: 'basic'};\r\n  readonly date = {label: 'date', order: 4, name: 'date', featureLevel: 'basic'};\r\n  readonly array = {label: 'matrix', order: 5, name: 'array', featureLevel: 'advanced'};\r\n  readonly map = {label: 'map', order: 6, name: 'map', featureLevel: 'advanced'};\r\n  readonly composite = {label: 'combined', order: 7, name: 'composite', featureLevel: 'advanced'};\r\n  readonly support = {label: 'support', order: 8, name: 'support', featureLevel: 'advanced'};\r\n  readonly other = {label: 'others', order: 9, name: 'other', featureLevel: 'advanced'};\r\n}\r\n\r\nexport const categories = new Categories();\r\n\r\nexport function Category(cat: keyof Categories) {\r\n  return Reflect.metadata(category, cat);\r\n}\r\n\r\nexport function getSortType(col: Column): 'abc'|'num'|undefined {\r\n  const cat = categoryOf(col);\r\n  const type = col.desc.type;\r\n  if (cat === categories.string || cat === categories.categorical) {\r\n    return 'abc';\r\n  }\r\n  if (cat === categories.number || type === 'rank' || isSortingAscByDefault(col)) {\r\n    return 'num';\r\n  }\r\n  const numbers = new Set(['rank', 'number', 'numbers', 'ordinal', 'boxplot', 'script', 'reduce', 'stack']);\r\n  return numbers.has(type) ? 'num' : undefined;\r\n}\r\n\r\nexport function toolbar(...keys: string[]) {\r\n  return Reflect.metadata(Symbol.for('toolbarIcon'), keys);\r\n}\r\n\r\nexport function dialogAddons(key: string, ...keys: string[]) {\r\n  return Reflect.metadata(Symbol.for(`toolbarDialogAddon${key}`), keys);\r\n}\r\n\r\nexport function isSupportType(col: Column) {\r\n  const clazz = (<any>col).constructor;\r\n  return Reflect.hasMetadata(supportType, clazz);\r\n}\r\n\r\nexport interface IColumnCategory {\r\n  label: string;\r\n  name: string;\r\n  order: number;\r\n  featureLevel: 'basic' | 'advanced';\r\n}\r\n\r\nexport function categoryOf(col: IColumnConstructor | Column): IColumnCategory {\r\n  const cat = <keyof Categories>Reflect.getMetadata(category, col instanceof Column ? Object.getPrototypeOf(col).constructor : col) || 'other';\r\n  return <IColumnCategory>categories[cat] || categories.other;\r\n}\r\n\r\nexport function categoryOfDesc(col: IColumnDesc | string, models: { [key: string]: IColumnConstructor }): IColumnCategory {\r\n  const type = typeof col === 'string' ? col : col.type;\r\n  const clazz = models[type];\r\n  return clazz ? categoryOf(clazz) : <IColumnCategory>categories.other;\r\n}\r\n","import {IAdvancedBoxPlotData, IBoxPlotData, IForEachAble} from '../internal';\r\nimport Column from './Column';\r\nimport {IArrayColumn} from './IArrayColumn';\r\nimport {IColumnDesc, IDataRow, ITypedDump, ITypeFactory} from './interfaces';\r\n\r\n\r\nexport interface IColorMappingFunction {\r\n  apply(v: number): string;\r\n\r\n  toJSON(): ITypedDump | string;\r\n\r\n  clone(): IColorMappingFunction;\r\n\r\n  eq(other: IColorMappingFunction): boolean;\r\n}\r\n\r\nexport interface IColorMappingFunctionConstructor {\r\n  new(dump: ITypedDump | string, factory: ITypeFactory): IColorMappingFunction;\r\n}\r\n\r\nexport interface IMappingFunction {\r\n  //new(domain: number[]);\r\n\r\n  apply(v: number): number;\r\n\r\n  toJSON(): ITypedDump;\r\n\r\n  domain: number[];\r\n\r\n  clone(): IMappingFunction;\r\n\r\n  eq(other: IMappingFunction): boolean;\r\n\r\n  getRange(formatter: (v: number) => string): [string, string];\r\n}\r\n\r\nexport interface IMappingFunctionConstructor {\r\n  new(dump: ITypedDump): IMappingFunction;\r\n}\r\n\r\n\r\nexport interface IMapAbleDesc {\r\n  /**\r\n   * dump of mapping function\r\n   */\r\n  map?: ITypedDump;\r\n  /**\r\n   * either map or domain should be available\r\n   */\r\n  domain?: [number, number];\r\n  /**\r\n   * @default [0,1]\r\n   */\r\n  range?: [number, number];\r\n\r\n  /**\r\n   * @deprecated use colorMapping instead\r\n   */\r\n  color?: string;\r\n\r\n  /**\r\n   * color mapping\r\n   */\r\n  colorMapping?: string | ((v: number) => string) | ITypedDump;\r\n}\r\n\r\n\r\nexport interface IMapAbleColumn extends INumberColumn {\r\n  getOriginalMapping(): IMappingFunction;\r\n\r\n  getMapping(): IMappingFunction;\r\n\r\n  setMapping(mapping: IMappingFunction): void;\r\n\r\n  getColorMapping(): IColorMappingFunction;\r\n\r\n  setColorMapping(mapping: IColorMappingFunction): void;\r\n\r\n  getFilter(): INumberFilter;\r\n\r\n  setFilter(value: INumberFilter | null): void;\r\n\r\n  getRange(): [string, string];\r\n}\r\n\r\nexport function isMapAbleColumn(col: Column): col is IMapAbleColumn;\r\nexport function isMapAbleColumn(col: IColumnDesc): col is IMapAbleDesc & IColumnDesc;\r\nexport function isMapAbleColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<IMapAbleColumn>col).getMapping === 'function' || (!(col instanceof Column) && isNumberColumn(col) && ((<IColumnDesc>col).type.startsWith('number') || (<IColumnDesc>col).type.startsWith('boxplot'))));\r\n}\r\n\r\n\r\nexport interface INumberColumn extends Column {\r\n  getNumber(row: IDataRow): number;\r\n\r\n  getRawNumber(row: IDataRow): number;\r\n\r\n  iterNumber(row: IDataRow): IForEachAble<number>;\r\n  iterRawNumber(row: IDataRow): IForEachAble<number>;\r\n\r\n  getNumberFormat(): (v: number) => string;\r\n}\r\n\r\nexport interface INumberDesc extends IMapAbleDesc {\r\n  /**\r\n   * d3 formatting option\r\n   * @default .3n\r\n   */\r\n  numberFormat?: string;\r\n}\r\n\r\n/**\r\n * checks whether the given column or description is a number column, i.e. the value is a number\r\n * @param col\r\n * @returns {boolean}\r\n */\r\nexport function isNumberColumn(col: Column): col is INumberColumn;\r\nexport function isNumberColumn(col: IColumnDesc): col is INumberDesc & IColumnDesc;\r\nexport function isNumberColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<INumberColumn>col).getNumber === 'function' || (!(col instanceof Column) && (<IColumnDesc>col).type.match(/(number|stack|ordinal)/) != null));\r\n}\r\n\r\n\r\nexport enum ESortMethod {\r\n  min = 'min',\r\n  max = 'max',\r\n  median = 'median',\r\n  q1 = 'q1',\r\n  q3 = 'q3'\r\n}\r\n\r\nexport interface IBoxPlotColumn extends INumberColumn, IMapAbleColumn {\r\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null;\r\n\r\n  getMapping(): IMappingFunction;\r\n\r\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null;\r\n\r\n  getSortMethod(): string;\r\n\r\n  setSortMethod(sortMethod: string): void;\r\n}\r\n\r\nexport function isBoxPlotColumn(col: Column): col is IBoxPlotColumn {\r\n  return typeof (<IBoxPlotColumn>col).getBoxPlotData === 'function';\r\n}\r\n\r\nexport enum EAdvancedSortMethod {\r\n  min = 'min',\r\n  max = 'max',\r\n  median = 'median',\r\n  q1 = 'q1',\r\n  q3 = 'q3',\r\n  mean = 'mean'\r\n}\r\n\r\nexport interface IAdvancedBoxPlotColumn extends IBoxPlotColumn {\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\r\n}\r\n\r\nexport interface INumbersColumn extends IAdvancedBoxPlotColumn, IArrayColumn<number> {\r\n  getNumbers(row: IDataRow): number[];\r\n\r\n  getRawNumbers(row: IDataRow): number[];\r\n}\r\n\r\nexport function isNumbersColumn(col: Column): col is INumbersColumn {\r\n  return isBoxPlotColumn(col) && typeof (<INumbersColumn>col).getNumbers === 'function';\r\n}\r\n\r\n\r\nexport interface INumberFilter {\r\n  min: number;\r\n  max: number;\r\n  filterMissing: boolean;\r\n}\r\n","import Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, dirtyCaches, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IValueColumnDesc, IDataRow, ITypeFactory} from './interfaces';\r\nimport {IEventListener} from '../internal';\r\n\r\n/**\r\n * emitted when the data of this column has been loaded\r\n * @asMemberOf ValueColumn\r\n * @event\r\n */\r\nexport declare function dataLoaded(previous: boolean, current: boolean): void;\r\n\r\n/**\r\n * a column having an accessor to get the cell value\r\n */\r\nexport default class ValueColumn<T> extends Column {\r\n  static readonly EVENT_DATA_LOADED = 'dataLoaded';\r\n\r\n  static readonly RENDERER_LOADING = 'loading';\r\n\r\n  private readonly accessor: (row: IDataRow, desc: Readonly<IValueColumnDesc<T>>) => T;\r\n\r\n  /**\r\n   * is the data available\r\n   * @type {boolean}\r\n   */\r\n  private loaded: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<IValueColumnDesc<T>>) {\r\n    super(id, desc);\r\n    //find accessor\r\n    this.accessor = desc.accessor! || (() => null);\r\n    this.loaded = desc.lazyLoaded !== true;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ValueColumn.EVENT_DATA_LOADED]);\r\n  }\r\n\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n\r\n  getLabel(row: IDataRow) {\r\n    if (!this.isLoaded()) {\r\n      return '';\r\n    }\r\n    const v = this.getValue(row);\r\n    return v == null ? '' : String(v);\r\n  }\r\n\r\n  getRaw(row: IDataRow): T | null {\r\n    if (!this.isLoaded()) {\r\n      return null;\r\n    }\r\n    return this.accessor(row, this.desc);\r\n  }\r\n\r\n  getValue(row: IDataRow): T | null {\r\n    return this.getRaw(row);\r\n  }\r\n\r\n  isLoaded() {\r\n    return this.loaded;\r\n  }\r\n\r\n  setLoaded(loaded: boolean) {\r\n    if (this.loaded === loaded) {\r\n      return;\r\n    }\r\n    this.fire([ValueColumn.EVENT_DATA_LOADED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.loaded, this.loaded = loaded);\r\n  }\r\n\r\n  getRenderer(): string {\r\n    if (!this.isLoaded()) {\r\n      return ValueColumn.RENDERER_LOADING;\r\n    }\r\n    return super.getRenderer();\r\n  }\r\n\r\n  /**\r\n   * patch the dump such that the loaded attribute is defined (for lazy loading columns)\r\n   * @param toDescRef\r\n   * @returns {any}\r\n   */\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.loaded = this.loaded;\r\n\r\n    if (!this.loaded && r.renderer === ValueColumn.RENDERER_LOADING) {\r\n      delete r.renderer;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    if (dump.loaded !== undefined) {\r\n      this.loaded = dump.loaded;\r\n    }\r\n    super.restore(dump, factory);\r\n  }\r\n}\r\n","import {suffix, IEventListener} from '../internal';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport {Category, toolbar} from './annotations';\r\nimport {IDataRow, IColumnParent, IFlatColumn, ITypeFactory} from './interfaces';\r\nimport {isNumberColumn} from './INumberColumn';\r\nimport ValueColumn from './ValueColumn';\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: any | null, current: any | null): void;\r\n\r\n/**\r\n * emitted when a column has been added\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function addColumn(col: Column, index: number): void;\r\n\r\n/**\r\n * emitted when a column has been moved within this composite columm\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\r\n\r\n/**\r\n * emitted when a column has been removed\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function removeColumn(col: Column, index: number): void;\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('compositeContained', 'splitCombined')\r\n@Category('composite')\r\nexport default class CompositeColumn extends Column implements IColumnParent {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_ADD_COLUMN = 'addColumn';\r\n  static readonly EVENT_MOVE_COLUMN = 'moveColumn';\r\n  static readonly EVENT_REMOVE_COLUMN = 'removeColumn';\r\n\r\n  protected readonly _children: Column[] = [];\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([CompositeColumn.EVENT_FILTER_CHANGED, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_MOVE_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN]);\r\n  }\r\n\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  assignNewId(idGenerator: () => string) {\r\n    super.assignNewId(idGenerator);\r\n    this._children.forEach((c) => c.assignNewId(idGenerator));\r\n  }\r\n\r\n  get children() {\r\n    return this._children.slice();\r\n  }\r\n\r\n  get length() {\r\n    return this._children.length;\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    let w = 0;\r\n    //no more levels or just this one\r\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n      w = this.getWidth();\r\n      r.push({col: this, offset, width: w});\r\n      if (levelsToGo === 0) {\r\n        return w;\r\n      }\r\n    }\r\n    //push children\r\n    this._children.forEach((c) => {\r\n      if (c.isVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n        c.flatten(r, offset, levelsToGo - 1, padding);\r\n      }\r\n    });\r\n    return w;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.children = this._children.map((d) => d.dump(toDescRef));\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    dump.children.map((child: any) => {\r\n      const c = factory(child);\r\n      if (c) {\r\n        this.push(c);\r\n      }\r\n    });\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  /**\r\n   * inserts a column at a the given position\r\n   * @param col\r\n   * @param index\r\n   * @returns {any}\r\n   */\r\n  insert(col: Column, index: number): Column | null {\r\n    if (!isNumberColumn(col) && this.canJustAddNumbers) { //indicator it is a number type\r\n      return null;\r\n    }\r\n    this._children.splice(index, 0, col);\r\n    //listen and propagate events\r\n    return this.insertImpl(col, index);\r\n  }\r\n\r\n  move(col: Column, index: number): Column | null {\r\n    if (col.parent !== this) { //not moving\r\n      return null;\r\n    }\r\n    const old = this._children.indexOf(col);\r\n    if (index === old) {\r\n      // no move needed\r\n      return col;\r\n    }\r\n    //delete first\r\n    this._children.splice(old, 1);\r\n    // adapt target index based on previous index, i.e shift by one\r\n    this._children.splice(old < index ? index - 1 : index, 0, col);\r\n    //listen and propagate events\r\n    return this.moveImpl(col, index, old);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    col.attach(this);\r\n    this.forward(col, ...suffix('.combine', Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY, CompositeColumn.EVENT_FILTER_CHANGED, Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_GROUP_RENDERER_TYPE_CHANGED));\r\n    this.fire([CompositeColumn.EVENT_ADD_COLUMN, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], col, index);\r\n    return col;\r\n  }\r\n\r\n  protected moveImpl(col: Column, index: number, oldIndex: number) {\r\n    this.fire([CompositeColumn.EVENT_MOVE_COLUMN, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY, Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_GROUP_RENDERER_TYPE_CHANGED], col, index, oldIndex);\r\n    return col;\r\n  }\r\n\r\n  push(col: Column) {\r\n    return this.insert(col, this._children.length);\r\n  }\r\n\r\n  at(index: number) {\r\n    return this._children[index];\r\n  }\r\n\r\n  indexOf(col: Column) {\r\n    return this._children.indexOf(col);\r\n  }\r\n\r\n  insertAfter(col: Column, ref: Column) {\r\n    const i = this.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.insert(col, i + 1);\r\n  }\r\n\r\n  moveAfter(col: Column, ref: Column) {\r\n    const i = this.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.move(col, i + 1);\r\n  }\r\n\r\n\r\n  remove(col: Column) {\r\n    const i = this._children.indexOf(col);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n    this._children.splice(i, 1); //remove and deregister listeners\r\n    return this.removeImpl(col, i);\r\n  }\r\n\r\n  protected removeImpl(col: Column, index: number) {\r\n    col.detach();\r\n    this.unforward(col, ...suffix('.combine', Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY, CompositeColumn.EVENT_FILTER_CHANGED));\r\n    this.fire([CompositeColumn.EVENT_REMOVE_COLUMN, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], col, index);\r\n    return true;\r\n  }\r\n\r\n  isFiltered() {\r\n    return this._children.some((d) => d.isFiltered());\r\n  }\r\n\r\n  clearFilter() {\r\n    return this._children.map((d) => d.clearFilter()).some((d) => d);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return this._children.every((d) => d.filter(row));\r\n  }\r\n\r\n  isLoaded(): boolean {\r\n    return this._children.every((c) => !(c instanceof ValueColumn || c instanceof CompositeColumn) || (<ValueColumn<any> | CompositeColumn>c).isLoaded());\r\n  }\r\n\r\n  get canJustAddNumbers() {\r\n    return false;\r\n  }\r\n}\r\n","export default function(specifier) {\n  var n = specifier.length / 6 | 0, colors = new Array(n), i = 0;\n  while (i < n) colors[i] = \"#\" + specifier.slice(i * 6, ++i * 6);\n  return colors;\n}\n","import colors from \"../colors\";\n\nexport default colors(\"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf\");\n","import colors from \"../colors\";\n\nexport default colors(\"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666\");\n","import colors from \"../colors\";\n\nexport default colors(\"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666\");\n","import colors from \"../colors\";\n\nexport default colors(\"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2\");\n","import colors from \"../colors\";\n\nexport default colors(\"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928\");\n","import colors from \"../colors\";\n\nexport default colors(\"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc\");\n","import colors from \"../colors\";\n\nexport default colors(\"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999\");\n","import colors from \"../colors\";\n\nexport default colors(\"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3\");\n","import colors from \"../colors\";\n\nexport default colors(\"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f\");\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex3 = /^#([0-9a-f]{3})$/,\n    reHex6 = /^#([0-9a-f]{6})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  hex: function() {\n    return this.rgb().hex();\n  },\n  toString: function() {\n    return this.rgb() + \"\";\n  }\n});\n\nexport default function color(format) {\n  var m;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex3.exec(format)) ? (m = parseInt(m[1], 16), new Rgb((m >> 8 & 0xf) | (m >> 4 & 0x0f0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1)) // #f00\n      : (m = reHex6.exec(format)) ? rgbn(parseInt(m[1], 16)) // #ff0000\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format])\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (0 <= this.r && this.r <= 255)\n        && (0 <= this.g && this.g <= 255)\n        && (0 <= this.b && this.b <= 255)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: function() {\n    return \"#\" + hex(this.r) + hex(this.g) + hex(this.b);\n  },\n  toString: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"rgb(\" : \"rgba(\")\n        + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n        + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n        + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\nfunction hex(value) {\n  value = Math.max(0, Math.min(255, Math.round(value) || 0));\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export var deg2rad = Math.PI / 180;\nexport var rad2deg = 180 / Math.PI;\n","import define, {extend} from \"./define\";\nimport {Color, rgbConvert, Rgb} from \"./color\";\nimport {deg2rad, rad2deg} from \"./math\";\n\n// https://beta.observablehq.com/@mbostock/lab-and-rgb\nvar K = 18,\n    Xn = 0.96422,\n    Yn = 1,\n    Zn = 0.82521,\n    t0 = 4 / 29,\n    t1 = 6 / 29,\n    t2 = 3 * t1 * t1,\n    t3 = t1 * t1 * t1;\n\nfunction labConvert(o) {\n  if (o instanceof Lab) return new Lab(o.l, o.a, o.b, o.opacity);\n  if (o instanceof Hcl) {\n    if (isNaN(o.h)) return new Lab(o.l, 0, 0, o.opacity);\n    var h = o.h * deg2rad;\n    return new Lab(o.l, Math.cos(h) * o.c, Math.sin(h) * o.c, o.opacity);\n  }\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = rgb2lrgb(o.r),\n      g = rgb2lrgb(o.g),\n      b = rgb2lrgb(o.b),\n      y = xyz2lab((0.2225045 * r + 0.7168786 * g + 0.0606169 * b) / Yn), x, z;\n  if (r === g && g === b) x = z = y; else {\n    x = xyz2lab((0.4360747 * r + 0.3850649 * g + 0.1430804 * b) / Xn);\n    z = xyz2lab((0.0139322 * r + 0.0971045 * g + 0.7141733 * b) / Zn);\n  }\n  return new Lab(116 * y - 16, 500 * (x - y), 200 * (y - z), o.opacity);\n}\n\nexport function gray(l, opacity) {\n  return new Lab(l, 0, 0, opacity == null ? 1 : opacity);\n}\n\nexport default function lab(l, a, b, opacity) {\n  return arguments.length === 1 ? labConvert(l) : new Lab(l, a, b, opacity == null ? 1 : opacity);\n}\n\nexport function Lab(l, a, b, opacity) {\n  this.l = +l;\n  this.a = +a;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Lab, lab, extend(Color, {\n  brighter: function(k) {\n    return new Lab(this.l + K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  darker: function(k) {\n    return new Lab(this.l - K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  rgb: function() {\n    var y = (this.l + 16) / 116,\n        x = isNaN(this.a) ? y : y + this.a / 500,\n        z = isNaN(this.b) ? y : y - this.b / 200;\n    x = Xn * lab2xyz(x);\n    y = Yn * lab2xyz(y);\n    z = Zn * lab2xyz(z);\n    return new Rgb(\n      lrgb2rgb( 3.1338561 * x - 1.6168667 * y - 0.4906146 * z),\n      lrgb2rgb(-0.9787684 * x + 1.9161415 * y + 0.0334540 * z),\n      lrgb2rgb( 0.0719453 * x - 0.2289914 * y + 1.4052427 * z),\n      this.opacity\n    );\n  }\n}));\n\nfunction xyz2lab(t) {\n  return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\n}\n\nfunction lab2xyz(t) {\n  return t > t1 ? t * t * t : t2 * (t - t0);\n}\n\nfunction lrgb2rgb(x) {\n  return 255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055);\n}\n\nfunction rgb2lrgb(x) {\n  return (x /= 255) <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\n}\n\nfunction hclConvert(o) {\n  if (o instanceof Hcl) return new Hcl(o.h, o.c, o.l, o.opacity);\n  if (!(o instanceof Lab)) o = labConvert(o);\n  if (o.a === 0 && o.b === 0) return new Hcl(NaN, 0, o.l, o.opacity);\n  var h = Math.atan2(o.b, o.a) * rad2deg;\n  return new Hcl(h < 0 ? h + 360 : h, Math.sqrt(o.a * o.a + o.b * o.b), o.l, o.opacity);\n}\n\nexport function lch(l, c, h, opacity) {\n  return arguments.length === 1 ? hclConvert(l) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function hcl(h, c, l, opacity) {\n  return arguments.length === 1 ? hclConvert(h) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function Hcl(h, c, l, opacity) {\n  this.h = +h;\n  this.c = +c;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hcl, hcl, extend(Color, {\n  brighter: function(k) {\n    return new Hcl(this.h, this.c, this.l + K * (k == null ? 1 : k), this.opacity);\n  },\n  darker: function(k) {\n    return new Hcl(this.h, this.c, this.l - K * (k == null ? 1 : k), this.opacity);\n  },\n  rgb: function() {\n    return labConvert(this).rgb();\n  }\n}));\n","import define, {extend} from \"./define\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color\";\nimport {deg2rad, rad2deg} from \"./math\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * rad2deg - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * deg2rad,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","export function basis(t1, v0, v1, v2, v3) {\n  var t2 = t1 * t1, t3 = t2 * t1;\n  return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n      + (4 - 6 * t2 + 3 * t3) * v1\n      + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n      + t3 * v3) / 6;\n}\n\nexport default function(values) {\n  var n = values.length - 1;\n  return function(t) {\n    var i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n),\n        v1 = values[i],\n        v2 = values[i + 1],\n        v0 = i > 0 ? values[i - 1] : 2 * v1 - v2,\n        v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import constant from \"./constant\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis\";\nimport basisClosed from \"./basisClosed\";\nimport nogamma, {gamma} from \"./color\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","import value from \"./value\";\n\nexport default function(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","import {basis} from \"./basis\";\n\nexport default function(values) {\n  var n = values.length;\n  return function(t) {\n    var i = Math.floor(((t %= 1) < 0 ? ++t : t) * n),\n        v0 = values[(i + n - 1) % n],\n        v1 = values[i % n],\n        v2 = values[(i + 1) % n],\n        v3 = values[(i + 2) % n];\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b -= a, function(t) {\n    return d.setTime(a + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b -= a, function(t) {\n    return a + b * t;\n  };\n}\n","import value from \"./value\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import number from \"./number\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","import decompose, {identity} from \"./decompose\";\n\nvar cssNode,\n    cssRoot,\n    cssView,\n    svgNode;\n\nexport function parseCss(value) {\n  if (value === \"none\") return identity;\n  if (!cssNode) cssNode = document.createElement(\"DIV\"), cssRoot = document.documentElement, cssView = document.defaultView;\n  cssNode.style.transform = value;\n  value = cssView.getComputedStyle(cssRoot.appendChild(cssNode), null).getPropertyValue(\"transform\");\n  cssRoot.removeChild(cssNode);\n  value = value.slice(7, -1).split(\",\");\n  return decompose(+value[0], +value[1], +value[2], +value[3], +value[4], +value[5]);\n}\n\nexport function parseSvg(value) {\n  if (value == null) return identity;\n  if (!svgNode) svgNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n  svgNode.setAttribute(\"transform\", value);\n  if (!(value = svgNode.transform.baseVal.consolidate())) return identity;\n  value = value.matrix;\n  return decompose(value.a, value.b, value.c, value.d, value.e, value.f);\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb\";\nimport array from \"./array\";\nimport date from \"./date\";\nimport number from \"./number\";\nimport object from \"./object\";\nimport string from \"./string\";\nimport constant from \"./constant\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : Array.isArray(b) ? array\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","export default function(a, b) {\n  return a = +a, b -= a, function(t) {\n    return Math.round(a + b * t);\n  };\n}\n","var degrees = 180 / Math.PI;\n\nexport var identity = {\n  translateX: 0,\n  translateY: 0,\n  rotate: 0,\n  skewX: 0,\n  scaleX: 1,\n  scaleY: 1\n};\n\nexport default function(a, b, c, d, e, f) {\n  var scaleX, scaleY, skewX;\n  if (scaleX = Math.sqrt(a * a + b * b)) a /= scaleX, b /= scaleX;\n  if (skewX = a * c + b * d) c -= a * skewX, d -= b * skewX;\n  if (scaleY = Math.sqrt(c * c + d * d)) c /= scaleY, d /= scaleY, skewX /= scaleY;\n  if (a * d < b * c) a = -a, b = -b, skewX = -skewX, scaleX = -scaleX;\n  return {\n    translateX: e,\n    translateY: f,\n    rotate: Math.atan2(b, a) * degrees,\n    skewX: Math.atan(skewX) * degrees,\n    scaleX: scaleX,\n    scaleY: scaleY\n  };\n}\n","import number from \"../number\";\nimport {parseCss, parseSvg} from \"./parse\";\n\nfunction interpolateTransform(parse, pxComma, pxParen, degParen) {\n\n  function pop(s) {\n    return s.length ? s.pop() + \" \" : \"\";\n  }\n\n  function translate(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(\"translate(\", null, pxComma, null, pxParen);\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb || yb) {\n      s.push(\"translate(\" + xb + pxComma + yb + pxParen);\n    }\n  }\n\n  function rotate(a, b, s, q) {\n    if (a !== b) {\n      if (a - b > 180) b += 360; else if (b - a > 180) a += 360; // shortest path\n      q.push({i: s.push(pop(s) + \"rotate(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"rotate(\" + b + degParen);\n    }\n  }\n\n  function skewX(a, b, s, q) {\n    if (a !== b) {\n      q.push({i: s.push(pop(s) + \"skewX(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"skewX(\" + b + degParen);\n    }\n  }\n\n  function scale(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(pop(s) + \"scale(\", null, \",\", null, \")\");\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb !== 1 || yb !== 1) {\n      s.push(pop(s) + \"scale(\" + xb + \",\" + yb + \")\");\n    }\n  }\n\n  return function(a, b) {\n    var s = [], // string constants and placeholders\n        q = []; // number interpolators\n    a = parse(a), b = parse(b);\n    translate(a.translateX, a.translateY, b.translateX, b.translateY, s, q);\n    rotate(a.rotate, b.rotate, s, q);\n    skewX(a.skewX, b.skewX, s, q);\n    scale(a.scaleX, a.scaleY, b.scaleX, b.scaleY, s, q);\n    a = b = null; // gc\n    return function(t) {\n      var i = -1, n = q.length, o;\n      while (++i < n) s[(o = q[i]).i] = o.x(t);\n      return s.join(\"\");\n    };\n  };\n}\n\nexport var interpolateTransformCss = interpolateTransform(parseCss, \"px, \", \"px)\", \"deg)\");\nexport var interpolateTransformSvg = interpolateTransform(parseSvg, \", \", \")\", \")\");\n","var rho = Math.SQRT2,\n    rho2 = 2,\n    rho4 = 4,\n    epsilon2 = 1e-12;\n\nfunction cosh(x) {\n  return ((x = Math.exp(x)) + 1 / x) / 2;\n}\n\nfunction sinh(x) {\n  return ((x = Math.exp(x)) - 1 / x) / 2;\n}\n\nfunction tanh(x) {\n  return ((x = Math.exp(2 * x)) - 1) / (x + 1);\n}\n\n// p0 = [ux0, uy0, w0]\n// p1 = [ux1, uy1, w1]\nexport default function(p0, p1) {\n  var ux0 = p0[0], uy0 = p0[1], w0 = p0[2],\n      ux1 = p1[0], uy1 = p1[1], w1 = p1[2],\n      dx = ux1 - ux0,\n      dy = uy1 - uy0,\n      d2 = dx * dx + dy * dy,\n      i,\n      S;\n\n  // Special case for u0  u1.\n  if (d2 < epsilon2) {\n    S = Math.log(w1 / w0) / rho;\n    i = function(t) {\n      return [\n        ux0 + t * dx,\n        uy0 + t * dy,\n        w0 * Math.exp(rho * t * S)\n      ];\n    }\n  }\n\n  // General case.\n  else {\n    var d1 = Math.sqrt(d2),\n        b0 = (w1 * w1 - w0 * w0 + rho4 * d2) / (2 * w0 * rho2 * d1),\n        b1 = (w1 * w1 - w0 * w0 - rho4 * d2) / (2 * w1 * rho2 * d1),\n        r0 = Math.log(Math.sqrt(b0 * b0 + 1) - b0),\n        r1 = Math.log(Math.sqrt(b1 * b1 + 1) - b1);\n    S = (r1 - r0) / rho;\n    i = function(t) {\n      var s = t * S,\n          coshr0 = cosh(r0),\n          u = w0 / (rho2 * d1) * (coshr0 * tanh(rho * s + r0) - sinh(r0));\n      return [\n        ux0 + u * dx,\n        uy0 + u * dy,\n        w0 * coshr0 / cosh(rho * s + r0)\n      ];\n    }\n  }\n\n  i.duration = S * 1000;\n\n  return i;\n}\n","import {hsl as colorHsl} from \"d3-color\";\nimport color, {hue} from \"./color\";\n\nfunction hsl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHsl(start)).h, (end = colorHsl(end)).h),\n        s = color(start.s, end.s),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.s = s(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hsl(hue);\nexport var hslLong = hsl(color);\n","import {hcl as colorHcl} from \"d3-color\";\nimport color, {hue} from \"./color\";\n\nfunction hcl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHcl(start)).h, (end = colorHcl(end)).h),\n        c = color(start.c, end.c),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.c = c(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hcl(hue);\nexport var hclLong = hcl(color);\n","import {cubehelix as colorCubehelix} from \"d3-color\";\nimport color, {hue} from \"./color\";\n\nfunction cubehelix(hue) {\n  return (function cubehelixGamma(y) {\n    y = +y;\n\n    function cubehelix(start, end) {\n      var h = hue((start = colorCubehelix(start)).h, (end = colorCubehelix(end)).h),\n          s = color(start.s, end.s),\n          l = color(start.l, end.l),\n          opacity = color(start.opacity, end.opacity);\n      return function(t) {\n        start.h = h(t);\n        start.s = s(t);\n        start.l = l(Math.pow(t, y));\n        start.opacity = opacity(t);\n        return start + \"\";\n      };\n    }\n\n    cubehelix.gamma = cubehelixGamma;\n\n    return cubehelix;\n  })(1);\n}\n\nexport default cubehelix(hue);\nexport var cubehelixLong = cubehelix(color);\n","export default function(interpolator, n) {\n  var samples = new Array(n);\n  for (var i = 0; i < n; ++i) samples[i] = interpolator(i / (n - 1));\n  return samples;\n}\n","import {interpolateRgbBasis} from \"d3-interpolate\";\n\nexport default function(scheme) {\n  return interpolateRgbBasis(scheme[scheme.length - 1]);\n}\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"d8b365f5f5f55ab4ac\",\n  \"a6611adfc27d80cdc1018571\",\n  \"a6611adfc27df5f5f580cdc1018571\",\n  \"8c510ad8b365f6e8c3c7eae55ab4ac01665e\",\n  \"8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e\",\n  \"8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e\",\n  \"8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e\",\n  \"5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30\",\n  \"5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"af8dc3f7f7f77fbf7b\",\n  \"7b3294c2a5cfa6dba0008837\",\n  \"7b3294c2a5cff7f7f7a6dba0008837\",\n  \"762a83af8dc3e7d4e8d9f0d37fbf7b1b7837\",\n  \"762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837\",\n  \"762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837\",\n  \"762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837\",\n  \"40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b\",\n  \"40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"e9a3c9f7f7f7a1d76a\",\n  \"d01c8bf1b6dab8e1864dac26\",\n  \"d01c8bf1b6daf7f7f7b8e1864dac26\",\n  \"c51b7de9a3c9fde0efe6f5d0a1d76a4d9221\",\n  \"c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221\",\n  \"c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221\",\n  \"c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221\",\n  \"8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419\",\n  \"8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"998ec3f7f7f7f1a340\",\n  \"5e3c99b2abd2fdb863e66101\",\n  \"5e3c99b2abd2f7f7f7fdb863e66101\",\n  \"542788998ec3d8daebfee0b6f1a340b35806\",\n  \"542788998ec3d8daebf7f7f7fee0b6f1a340b35806\",\n  \"5427888073acb2abd2d8daebfee0b6fdb863e08214b35806\",\n  \"5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806\",\n  \"2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08\",\n  \"2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62f7f7f767a9cf\",\n  \"ca0020f4a58292c5de0571b0\",\n  \"ca0020f4a582f7f7f792c5de0571b0\",\n  \"b2182bef8a62fddbc7d1e5f067a9cf2166ac\",\n  \"b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac\",\n  \"b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac\",\n  \"b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac\",\n  \"67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061\",\n  \"67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62ffffff999999\",\n  \"ca0020f4a582bababa404040\",\n  \"ca0020f4a582ffffffbababa404040\",\n  \"b2182bef8a62fddbc7e0e0e09999994d4d4d\",\n  \"b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d\",\n  \"b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d\",\n  \"b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d\",\n  \"67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a\",\n  \"67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91bfdb\",\n  \"d7191cfdae61abd9e92c7bb6\",\n  \"d7191cfdae61ffffbfabd9e92c7bb6\",\n  \"d73027fc8d59fee090e0f3f891bfdb4575b4\",\n  \"d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4\",\n  \"d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4\",\n  \"d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4\",\n  \"a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695\",\n  \"a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91cf60\",\n  \"d7191cfdae61a6d96a1a9641\",\n  \"d7191cfdae61ffffbfa6d96a1a9641\",\n  \"d73027fc8d59fee08bd9ef8b91cf601a9850\",\n  \"d73027fc8d59fee08bffffbfd9ef8b91cf601a9850\",\n  \"d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850\",\n  \"d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850\",\n  \"a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837\",\n  \"a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf99d594\",\n  \"d7191cfdae61abdda42b83ba\",\n  \"d7191cfdae61ffffbfabdda42b83ba\",\n  \"d53e4ffc8d59fee08be6f59899d5943288bd\",\n  \"d53e4ffc8d59fee08bffffbfe6f59899d5943288bd\",\n  \"d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd\",\n  \"d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd\",\n  \"9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2\",\n  \"9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5f999d8c92ca25f\",\n  \"edf8fbb2e2e266c2a4238b45\",\n  \"edf8fbb2e2e266c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"e0ecf49ebcda8856a7\",\n  \"edf8fbb3cde38c96c688419d\",\n  \"edf8fbb3cde38c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"e0f3dba8ddb543a2ca\",\n  \"f0f9e8bae4bc7bccc42b8cbe\",\n  \"f0f9e8bae4bc7bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fee8c8fdbb84e34a33\",\n  \"fef0d9fdcc8afc8d59d7301f\",\n  \"fef0d9fdcc8afc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"ece2f0a6bddb1c9099\",\n  \"f6eff7bdc9e167a9cf02818a\",\n  \"f6eff7bdc9e167a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"ece7f2a6bddb2b8cbe\",\n  \"f1eef6bdc9e174a9cf0570b0\",\n  \"f1eef6bdc9e174a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"e7e1efc994c7dd1c77\",\n  \"f1eef6d7b5d8df65b0ce1256\",\n  \"f1eef6d7b5d8df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fde0ddfa9fb5c51b8a\",\n  \"feebe2fbb4b9f768a1ae017e\",\n  \"feebe2fbb4b9f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"edf8b17fcdbb2c7fb8\",\n  \"ffffcca1dab441b6c4225ea8\",\n  \"ffffcca1dab441b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"f7fcb9addd8e31a354\",\n  \"ffffccc2e69978c679238443\",\n  \"ffffccc2e69978c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fff7bcfec44fd95f0e\",\n  \"ffffd4fed98efe9929cc4c02\",\n  \"ffffd4fed98efe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"ffeda0feb24cf03b20\",\n  \"ffffb2fecc5cfd8d3ce31a1c\",\n  \"ffffb2fecc5cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"deebf79ecae13182bd\",\n  \"eff3ffbdd7e76baed62171b5\",\n  \"eff3ffbdd7e76baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5e0a1d99b31a354\",\n  \"edf8e9bae4b374c476238b45\",\n  \"edf8e9bae4b374c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"f0f0f0bdbdbd636363\",\n  \"f7f7f7cccccc969696525252\",\n  \"f7f7f7cccccc969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"efedf5bcbddc756bb1\",\n  \"f2f0f7cbc9e29e9ac86a51a3\",\n  \"f2f0f7cbc9e29e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fee0d2fc9272de2d26\",\n  \"fee5d9fcae91fb6a4acb181d\",\n  \"fee5d9fcae91fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors\";\nimport ramp from \"../ramp\";\n\nexport var scheme = new Array(3).concat(\n  \"fee6cefdae6be6550d\",\n  \"feeddefdbe85fd8d3cd94701\",\n  \"feeddefdbe85fd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704\"\n).map(colors);\n\nexport default ramp(scheme);\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport default interpolateCubehelixLong(cubehelix(300, 0.5, 0.0), cubehelix(-240, 0.5, 1.0));\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport var warm = interpolateCubehelixLong(cubehelix(-100, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nexport var cool = interpolateCubehelixLong(cubehelix(260, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nvar c = cubehelix();\n\nexport default function(t) {\n  if (t < 0 || t > 1) t -= Math.floor(t);\n  var ts = Math.abs(t - 0.5);\n  c.h = 360 * t - 100;\n  c.s = 1.5 - 1.5 * ts;\n  c.l = 0.8 - 0.9 * ts;\n  return c + \"\";\n}\n","import {rgb} from \"d3-color\";\n\nvar c = rgb(),\n    pi_1_3 = Math.PI / 3,\n    pi_2_3 = Math.PI * 2 / 3;\n\nexport default function(t) {\n  var x;\n  t = (0.5 - t) * Math.PI;\n  c.r = 255 * (x = Math.sin(t)) * x;\n  c.g = 255 * (x = Math.sin(t + pi_1_3)) * x;\n  c.b = 255 * (x = Math.sin(t + pi_2_3)) * x;\n  return c + \"\";\n}\n","import colors from \"../colors\";\n\nfunction ramp(range) {\n  var n = range.length;\n  return function(t) {\n    return range[Math.max(0, Math.min(n - 1, Math.floor(t * n)))];\n  };\n}\n\nexport default ramp(colors(\"44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725\"));\n\nexport var magma = ramp(colors(\"00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf\"));\n\nexport var inferno = ramp(colors(\"00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4\"));\n\nexport var plasma = ramp(colors(\"0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921\"));\n","/**\r\n * a set that preserves the insertion order\r\n * @internal\r\n */\r\nexport default class OrderedSet<T> implements Iterable<T> {\r\n  readonly [Symbol.toStringTag] = Symbol('OrderedSet');\r\n  private readonly set = new Set<T>();\r\n  private readonly list = <T[]>[];\r\n\r\n  constructor(values: Iterable<T> = []) {\r\n    this.addAll(Array.isArray(values) ? values : Array.from(values));\r\n  }\r\n\r\n  get size() {\r\n    return this.set.size;\r\n  }\r\n\r\n  clear() {\r\n    this.set.clear();\r\n    this.list.splice(0, this.list.length);\r\n  }\r\n\r\n  addAll(values: T[]) {\r\n    values.forEach((v) => this.add(v));\r\n    return this;\r\n  }\r\n\r\n  add(value: T) {\r\n    if (this.set.has(value)) {\r\n      return this;\r\n    }\r\n    this.set.add(value);\r\n    this.list.push(value);\r\n    return this;\r\n  }\r\n\r\n  has(value: T) {\r\n    return this.set.has(value);\r\n  }\r\n\r\n  delete(value: T) {\r\n    const r = this.set.delete(value);\r\n    if (!r) {\r\n      return false;\r\n    }\r\n    const index = this.list.indexOf(value);\r\n    console.assert(index >= 0);\r\n    this.list.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  deleteAll(values: T[]) {\r\n    return values.reduce((acc, act) => this.delete(act) && acc, true);\r\n  }\r\n\r\n  forEach(callbackfn: (value: T, value2: T, set: Set<T>) => void, thisArg?: any) {\r\n    this.list.forEach(function (this: any, v: T) {\r\n      callbackfn.call(this, v, v, <any>this);\r\n    }, thisArg);\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.list[Symbol.iterator]();\r\n  }\r\n}\r\n","import {schemeCategory10, schemeSet3} from 'd3-scale-chromatic';\r\nimport Column, {defaultGroup, IGroup, IGroupParent, IndicesArray, IOrderedGroup, ECompareValueType} from '.';\r\nimport {OrderedSet} from '../internal';\r\nimport {DEFAULT_COLOR} from './interfaces';\r\n\r\n\r\n/** @internal */\r\nexport function integrateDefaults<T>(desc: T, defaults: Partial<T> = {}) {\r\n  Object.keys(defaults).forEach((key) => {\r\n    const typed = <keyof T>key;\r\n    if (typeof desc[typed] === 'undefined') {\r\n      (<any>desc)[typed] = defaults[typed];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\n/** @internal */\r\nexport function patternFunction(pattern: string, ...args: string[]) {\r\n  return new Function('value', ...args, `\r\n  const escapedValue = encodeURIComponent(String(value));\r\n  return \\`${pattern}\\`;\r\n `);\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function joinGroups(groups: IGroup[]): IGroup {\r\n  if (groups.length === 0) {\r\n    return {...defaultGroup}; //copy\r\n  }\r\n  if (groups.length === 1 && !groups[0].parent) {\r\n    return {...groups[0]}; //copy\r\n  }\r\n  // create a chain\r\n  const parents: IGroupParent[] = [];\r\n  for (const group of groups) {\r\n    const gparents: IGroupParent[] = [];\r\n    let g = group;\r\n    while (g.parent) {\r\n      // add all parents of this groups\r\n      gparents.unshift(g.parent);\r\n      g = g.parent;\r\n    }\r\n    parents.push(...gparents);\r\n    parents.push(Object.assign({subGroups: []}, group));\r\n  }\r\n  parents.slice(1).forEach((g, i) => {\r\n    g.parent = parents[i];\r\n    g.name = `${parents[i].name}  ${g.name}`;\r\n    g.color = g.color !== DEFAULT_COLOR ? g.color : g.parent.color;\r\n    parents[i].subGroups = [g];\r\n  });\r\n\r\n  return parents[parents.length - 1];\r\n}\r\n\r\nexport function duplicateGroup<T extends IOrderedGroup | IGroupParent>(group: T) {\r\n  const clone = <T>Object.assign({}, group);\r\n  delete (<IOrderedGroup>clone).order;\r\n  if (isGroupParent(<any>clone)) {\r\n    (<any>clone).subGroups = [];\r\n  }\r\n  if (clone.parent) {\r\n    clone.parent = duplicateGroup(clone.parent);\r\n    clone.parent!.subGroups.push(clone);\r\n  }\r\n  return clone;\r\n}\r\n\r\n/** @internal */\r\nexport function toGroupID(group: IGroup) {\r\n  return group.name;\r\n}\r\n\r\n/** @internal */\r\nexport function isOrderedGroup(g: IOrderedGroup | Readonly<IGroupParent>): g is IOrderedGroup {\r\n  return (<IOrderedGroup>g).order != null;\r\n}\r\n\r\n\r\n/** @internal */\r\nfunction isGroupParent(g: IOrderedGroup | Readonly<IGroupParent>): g is IGroupParent {\r\n  return (<IGroupParent>g).subGroups != null;\r\n}\r\n\r\n/**\r\n * unify the parents of the given groups by reusing the same group parent if possible\r\n * @param groups\r\n */\r\nexport function unifyParents<T extends IOrderedGroup>(groups: T[]) {\r\n  if (groups.length <= 1) {\r\n    return groups;\r\n  }\r\n\r\n  const toPath = (group: T) => {\r\n    const path: (IGroupParent | T)[] = [group];\r\n    let p = group.parent;\r\n    while (p) {\r\n      path.unshift(p);\r\n      p = p.parent;\r\n    }\r\n    return path;\r\n  };\r\n  const paths = groups.map(toPath);\r\n\r\n  const isSame = (a: IGroupParent, b: (IGroupParent | T)) => {\r\n    return (b.name === a.name && b.parent === a.parent && isGroupParent(b) && b.subGroups.length > 0);\r\n  };\r\n\r\n  const removeDuplicates = (level: (IGroupParent | T)[], i: number) => {\r\n    const real: (IGroupParent | T)[] = [];\r\n    while (level.length > 0) {\r\n      const node = level.shift()!;\r\n      if (!isGroupParent(node) || node.subGroups.length === 0) { // cannot share leaves\r\n        real.push(node);\r\n        continue;\r\n      }\r\n      const root = {...node};\r\n      real.push(root);\r\n      // remove duplicates that directly follow\r\n      while (level.length > 0 && isSame(root, level[0]!)) {\r\n        root.subGroups.push(...(<IGroupParent>level.shift()!).subGroups);\r\n      }\r\n      for (const child of root.subGroups) {\r\n        (<(IGroupParent | T)>child).parent = root;\r\n      }\r\n      // cleanup children duplicates\r\n      root.subGroups = removeDuplicates(<(IGroupParent | T)[]>root.subGroups, i + 1);\r\n    }\r\n    return real;\r\n  };\r\n\r\n  removeDuplicates(paths.map((p) => p[0]), 0);\r\n\r\n  return groups;\r\n}\r\n\r\n/** @internal */\r\nexport function groupRoots(groups: IOrderedGroup[]) {\r\n  const roots = new OrderedSet<IOrderedGroup | Readonly<IGroupParent>>();\r\n  for (const group of groups) {\r\n    let root: IOrderedGroup | Readonly<IGroupParent> = group;\r\n    while (root.parent) {\r\n      root = root.parent;\r\n    }\r\n    roots.add(root);\r\n  }\r\n  return Array.from(roots);\r\n}\r\n\r\n\r\n// based on https://github.com/d3/d3-scale-chromatic#d3-scale-chromatic\r\nconst colors = schemeCategory10.concat(schemeSet3);\r\n\r\n/** @internal */\r\nexport const MAX_COLORS = colors.length;\r\n\r\n/** @internal */\r\nexport function colorPool() {\r\n  let act = 0;\r\n  return () => colors[(act++) % colors.length];\r\n}\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function mapIndices<T>(arr: IndicesArray, callback: (value: number, i: number) => T): T[] {\r\n  const r: T[] = [];\r\n  for (let i = 0; i < arr.length; ++i) {\r\n    r.push(callback(arr[i], i));\r\n  }\r\n  return r;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function everyIndices(arr: IndicesArray, callback: (value: number, i: number) => boolean): boolean {\r\n  for (let i = 0; i < arr.length; ++i) {\r\n    if (!callback(arr[i], i)) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function filterIndices(arr: IndicesArray, callback: (value: number, i: number) => boolean): number[] {\r\n  const r: number[] = [];\r\n  for (let i = 0; i < arr.length; ++i) {\r\n    if (callback(arr[i], i)) {\r\n      r.push(arr[i]);\r\n    }\r\n  }\r\n  return r;\r\n}\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function forEachIndices(arr: IndicesArray, callback: (value: number, i: number) => void) {\r\n  for (let i = 0; i < arr.length; ++i) {\r\n    callback(arr[i], i);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function chooseUIntByDataLength(dataLength?: number | null) {\r\n  if (dataLength == null || typeof dataLength !== 'number' && !isNaN(dataLength)) {\r\n    return ECompareValueType.UINT32; // worst case\r\n  }\r\n  if (length <= 255) {\r\n    return ECompareValueType.UINT8;\r\n  }\r\n  if (length <= 65535) {\r\n    return ECompareValueType.UINT16;\r\n  }\r\n  return ECompareValueType.UINT32;\r\n}\r\n\r\nexport function getAllToolbarActions(col: Column) {\r\n  const actions = new OrderedSet<string>();\r\n\r\n  // walk up the prototype chain\r\n  let obj = <any>col;\r\n  const toolbarIcon = Symbol.for('toolbarIcon');\r\n  do {\r\n    const m = <string[]>Reflect.getOwnMetadata(toolbarIcon, obj.constructor);\r\n    if (m) {\r\n      for (const mi of m) {\r\n        actions.add(mi);\r\n      }\r\n    }\r\n    obj = Object.getPrototypeOf(obj);\r\n  } while (obj);\r\n  return Array.from(actions);\r\n}\r\n\r\n\r\nexport function getAllToolbarDialogAddons(col: Column, key: string) {\r\n  const actions = new OrderedSet<string>();\r\n\r\n  // walk up the prototype chain\r\n  let obj = <any>col;\r\n  const symbol = Symbol.for(`toolbarDialogAddon${key}`);\r\n  do {\r\n    const m = <string[]>Reflect.getOwnMetadata(symbol, obj.constructor);\r\n    if (m) {\r\n      for (const mi of m) {\r\n        actions.add(mi);\r\n      }\r\n    }\r\n    obj = Object.getPrototypeOf(obj);\r\n  } while (obj);\r\n  return Array.from(actions);\r\n}\r\n","import {equalArrays, fixCSS, IEventListener, suffix, joinIndexArrays, AEventDispatcher} from '../internal';\r\nimport {isSortingAscByDefault} from './annotations';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, labelChanged, visibilityChanged, widthChanged} from './Column';\r\nimport CompositeColumn from './CompositeColumn';\r\nimport {IRankingDump, defaultGroup, IndicesArray, IOrderedGroup, IDataRow, IColumnParent, IFlatColumn, ISortCriteria, UIntTypedArray, IGroupParent, ITypeFactory} from './interfaces';\r\nimport {groupRoots} from './internal';\r\n\r\nexport enum EDirtyReason {\r\n  UNKNOWN = 'unknown',\r\n  FILTER_CHANGED = 'filter',\r\n  SORT_CRITERIA_CHANGED = 'sort_changed',\r\n  SORT_CRITERIA_DIRTY = 'sort_dirty',\r\n  GROUP_CRITERIA_CHANGED = 'group_changed',\r\n  GROUP_CRITERIA_DIRTY = 'group_dirty',\r\n  GROUP_SORT_CRITERIA_CHANGED = 'group_sort_changed',\r\n  GROUP_SORT_CRITERIA_DIRTY = 'group_sort_dirty'\r\n}\r\n\r\n\r\n/**\r\n * emitted when a column has been added\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function addColumn(col: Column, index: number): void;\r\n\r\n/**\r\n * emitted when a column has been moved within this composite columm\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\r\n\r\n/**\r\n * emitted when a column has been removed\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function removeColumn(col: Column, index: number): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function sortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function groupCriteriaChanged(previous: Column[], current: Column[]): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function groupSortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function dirtyOrder(reason?: EDirtyReason[]): void;\r\n/**\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function orderChanged(previous: number[], current: number[], previousGroups: IOrderedGroup[], currentGroups: IOrderedGroup[], dirtyReason: EDirtyReason[]): void;\r\n/**\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function groupsChanged(previous: number[], current: number[], previousGroups: IOrderedGroup[], currentGroups: IOrderedGroup[]): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: any | null, current: any | null): void;\r\n/**\r\n * a ranking\r\n */\r\nexport default class Ranking extends AEventDispatcher implements IColumnParent {\r\n  static readonly EVENT_WIDTH_CHANGED = Column.EVENT_WIDTH_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_LABEL_CHANGED = Column.EVENT_LABEL_CHANGED;\r\n  static readonly EVENT_ADD_COLUMN = CompositeColumn.EVENT_ADD_COLUMN;\r\n  static readonly EVENT_MOVE_COLUMN = CompositeColumn.EVENT_MOVE_COLUMN;\r\n  static readonly EVENT_REMOVE_COLUMN = CompositeColumn.EVENT_REMOVE_COLUMN;\r\n  static readonly EVENT_DIRTY = Column.EVENT_DIRTY;\r\n  static readonly EVENT_DIRTY_HEADER = Column.EVENT_DIRTY_HEADER;\r\n  static readonly EVENT_DIRTY_VALUES = Column.EVENT_DIRTY_VALUES;\r\n  static readonly EVENT_DIRTY_CACHES = Column.EVENT_DIRTY_CACHES;\r\n  static readonly EVENT_COLUMN_VISIBILITY_CHANGED = Column.EVENT_VISIBILITY_CHANGED;\r\n  static readonly EVENT_SORT_CRITERIA_CHANGED = 'sortCriteriaChanged';\r\n  static readonly EVENT_GROUP_CRITERIA_CHANGED = 'groupCriteriaChanged';\r\n  static readonly EVENT_GROUP_SORT_CRITERIA_CHANGED = 'groupSortCriteriaChanged';\r\n  static readonly EVENT_DIRTY_ORDER = 'dirtyOrder';\r\n  static readonly EVENT_ORDER_CHANGED = 'orderChanged';\r\n  static readonly EVENT_GROUPS_CHANGED = 'groupsChanged';\r\n\r\n  private static readonly FORWARD_COLUMN_EVENTS = suffix('.ranking', Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY, Column.EVENT_VISIBILITY_CHANGED, Ranking.EVENT_FILTER_CHANGED);\r\n  private static readonly COLUMN_GROUP_SORT_DIRTY = suffix('.groupOrder', Column.EVENT_DIRTY_CACHES, 'sortMethodChanged');\r\n  private static readonly COLUMN_SORT_DIRTY = suffix('.order', Column.EVENT_DIRTY_CACHES);\r\n  private static readonly COLUMN_GROUP_DIRTY = suffix('.group', Column.EVENT_DIRTY_CACHES, 'groupingChanged');\r\n\r\n\r\n  private label: string;\r\n\r\n  private readonly sortCriteria: ISortCriteria[] = [];\r\n  private readonly groupColumns: Column[] = [];\r\n  private readonly groupSortCriteria: ISortCriteria[] = [];\r\n\r\n  /**\r\n   * columns of this ranking\r\n   * @type {Array}\r\n   * @private\r\n   */\r\n  private readonly columns: Column[] = [];\r\n\r\n  readonly dirtyOrder = (reason?: EDirtyReason[]) => {\r\n    this.fire([Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], reason);\r\n  };\r\n  private readonly dirtyOrderSortDirty = () => this.dirtyOrder([EDirtyReason.SORT_CRITERIA_DIRTY]);\r\n  private readonly dirtyOrderGroupDirty = () => this.dirtyOrder([EDirtyReason.GROUP_CRITERIA_DIRTY]);\r\n  private readonly dirtyOrderGroupSortDirty = () => this.dirtyOrder([EDirtyReason.GROUP_SORT_CRITERIA_DIRTY]);\r\n  private readonly dirtyOrderFiltering = () => this.dirtyOrder([EDirtyReason.FILTER_CHANGED]);\r\n\r\n  /**\r\n   * the current ordering as an sorted array of indices\r\n   * @type {Array}\r\n   */\r\n  private groups: IOrderedGroup[] = [Object.assign({order: <number[]>[]}, defaultGroup)];\r\n  private order: IndicesArray = [];\r\n  private index2pos: IndicesArray = [];\r\n\r\n  constructor(public id: string) {\r\n    super();\r\n    this.id = fixCSS(id);\r\n    this.label = `Ranking ${id.startsWith('rank') ? id.slice(4) : id}`;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([\r\n      Ranking.EVENT_WIDTH_CHANGED, Ranking.EVENT_FILTER_CHANGED,\r\n      Ranking.EVENT_LABEL_CHANGED, Ranking.EVENT_GROUPS_CHANGED,\r\n      Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_MOVE_COLUMN,\r\n      Ranking.EVENT_DIRTY, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY_CACHES,\r\n      Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, Ranking.EVENT_COLUMN_VISIBILITY_CHANGED,\r\n      Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_ORDER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof Ranking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof Ranking.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof Ranking.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Ranking.EVENT_COLUMN_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_SORT_CRITERIA_CHANGED, listener: typeof sortCriteriaChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_GROUP_CRITERIA_CHANGED, listener: typeof groupCriteriaChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, listener: typeof groupSortCriteriaChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY_ORDER, listener: typeof dirtyOrder | null): this;\r\n  on(type: typeof Ranking.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_GROUPS_CHANGED, listener: typeof groupsChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  assignNewId(idGenerator: () => string) {\r\n    this.id = fixCSS(idGenerator());\r\n    this.columns.forEach((c) => c.assignNewId(idGenerator));\r\n  }\r\n\r\n  getLabel() {\r\n    return this.label;\r\n  }\r\n\r\n  setLabel(value: string) {\r\n    if (value === this.label) {\r\n      return;\r\n    }\r\n    this.fire(Ranking.EVENT_LABEL_CHANGED, this.label, this.label = value);\r\n  }\r\n\r\n  setGroups(groups: IOrderedGroup[], index2pos: IndicesArray, dirtyReason: EDirtyReason[]) {\r\n    const old = this.order;\r\n    const oldGroups = this.groups;\r\n    this.groups = groups;\r\n    this.index2pos = index2pos;\r\n    this.order = joinIndexArrays(groups.map((d) => d.order));\r\n    // replace with subarrays to save memory\r\n    if (groups.length > 1) {\r\n      this.unifyGroups(groups);\r\n    } else if (groups.length === 1) {\r\n      // propagate to the top\r\n      let p = groups[0].parent;\r\n      while (p) {\r\n        (<IOrderedGroup><any>p).order = this.order;\r\n        p = p.parent;\r\n      }\r\n    }\r\n    this.fire([Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_GROUPS_CHANGED, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], old, this.order, oldGroups, groups, dirtyReason);\r\n  }\r\n\r\n  private unifyGroups(groups: IOrderedGroup[]) {\r\n    let offset = 0;\r\n    const order = <UIntTypedArray>this.order;\r\n    const offsets = new Map<Readonly<IGroupParent> | IOrderedGroup, {\r\n      offset: number;\r\n      size: number;\r\n    }>();\r\n    for (const group of groups) {\r\n      const size = group.order.length;\r\n      group.order = order.subarray(offset, offset + size);\r\n      offsets.set(group, {offset, size});\r\n      offset += size;\r\n    }\r\n    // propgate also to the top with views\r\n    const roots = groupRoots(groups);\r\n    const resolve = (g: Readonly<IGroupParent> | IOrderedGroup): {\r\n      offset: number;\r\n      size: number;\r\n    } => {\r\n      if (offsets.has(g)) { // leaf\r\n        return offsets.get(g)!;\r\n      }\r\n      const subs = (<IGroupParent>g).subGroups.map((gi) => resolve(<Readonly<IGroupParent> | IOrderedGroup>gi));\r\n      const offset = subs.length > 0 ? subs[0].offset : 0;\r\n      const size = subs.reduce((a, b) => a + b.size, 0);\r\n      const r = {offset, size};\r\n      offsets.set(g, r);\r\n      (<IOrderedGroup><any>g).order = order.subarray(offset, offset + size);\r\n      return r;\r\n    };\r\n    for (const root of roots) {\r\n      resolve(root);\r\n    }\r\n  }\r\n\r\n  getRank(dataIndex: number) {\r\n    if (dataIndex < 0 || dataIndex > this.index2pos.length) {\r\n      return -1;\r\n    }\r\n    const v = this.index2pos[dataIndex];\r\n    return v != null && !isNaN(v) && v > 0 ? v : -1;\r\n  }\r\n\r\n  getOrder() {\r\n    return this.order;\r\n  }\r\n\r\n  getOrderLength() {\r\n    return this.order.length;\r\n  }\r\n\r\n  getGroups() {\r\n    return this.groups.slice();\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): IRankingDump {\r\n    const r: IRankingDump = {};\r\n    r.columns = this.columns.map((d) => d.dump(toDescRef));\r\n    r.sortCriteria = this.sortCriteria.map((s) => ({asc: s.asc, sortBy: s.col!.id}));\r\n    r.groupSortCriteria = this.groupSortCriteria.map((s) => ({asc: s.asc, sortBy: s.col!.id}));\r\n    r.groupColumns = this.groupColumns.map((d) => d.id);\r\n    return r;\r\n  }\r\n\r\n  restore(dump: IRankingDump, factory: ITypeFactory) {\r\n    this.clear();\r\n    (dump.columns || []).map((child: any) => {\r\n      const c = factory(child);\r\n      if (c) {\r\n        this.push(c);\r\n      }\r\n    });\r\n    // compatibility case\r\n    if (dump.sortColumn && dump.sortColumn.sortBy) {\r\n      const help = this.columns.find((d) => d.id === dump.sortColumn!.sortBy);\r\n      if (help) {\r\n        this.sortBy(help, dump.sortColumn.asc);\r\n      }\r\n    }\r\n    if (dump.groupColumns) {\r\n      const groupColumns = <Column[]>dump.groupColumns.map((id: string) => this.columns.find((d) => d.id === id)).filter((d) => d != null);\r\n      this.setGroupCriteria(groupColumns);\r\n    }\r\n\r\n    const restoreSortCriteria = (dumped: any) => {\r\n      return dumped.map((s: {asc: boolean, sortBy: string}) => {\r\n        return {\r\n          asc: s.asc,\r\n          col: this.columns.find((d) => d.id === s.sortBy) || null\r\n        };\r\n      }).filter((s: any) => s.col);\r\n    };\r\n\r\n    if (dump.sortCriteria) {\r\n      this.setSortCriteria(restoreSortCriteria(dump.sortCriteria));\r\n    }\r\n\r\n    if (dump.groupSortCriteria) {\r\n      this.setGroupSortCriteria(restoreSortCriteria(dump.groupSortCriteria));\r\n    }\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    let acc = offset; // + this.getWidth() + padding;\r\n    if (levelsToGo > 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n      this.columns.forEach((c) => {\r\n        if (c.getVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n          acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\r\n        }\r\n      });\r\n    }\r\n    return acc - offset;\r\n  }\r\n\r\n  getPrimarySortCriteria(): ISortCriteria | null {\r\n    if (this.sortCriteria.length === 0) {\r\n      return null;\r\n    }\r\n    return this.sortCriteria[0];\r\n  }\r\n\r\n  getSortCriteria(): ISortCriteria[] {\r\n    return this.sortCriteria.map((d) => Object.assign({}, d));\r\n  }\r\n\r\n  getGroupSortCriteria(): ISortCriteria[] {\r\n    return this.groupSortCriteria.map((d) => Object.assign({}, d));\r\n  }\r\n\r\n  toggleSorting(col: Column) {\r\n    return this.setSortCriteria(this.toggleSortingLogic(col, this.sortCriteria));\r\n  }\r\n\r\n  private toggleSortingLogic(col: Column, sortCriteria: ISortCriteria[]) {\r\n    const newSort = sortCriteria.slice();\r\n    const current = newSort.findIndex((d) => d.col === col);\r\n    const defaultAsc = isSortingAscByDefault(col);\r\n\r\n    if (current < 0) {\r\n      newSort.splice(0, newSort.length, {col, asc: defaultAsc});\r\n    } else if (newSort[current].asc === defaultAsc) {\r\n      // asc -> desc, or desc -> asc\r\n      newSort.splice(current, 1, {col, asc: !defaultAsc});\r\n    } else {\r\n      // remove\r\n      newSort.splice(current, 1);\r\n    }\r\n    return newSort;\r\n  }\r\n\r\n  toggleGrouping(col: Column) {\r\n    const old = this.groupColumns.indexOf(col);\r\n    if (old >= 0) {\r\n      const newGroupings = this.groupColumns.slice();\r\n      newGroupings.splice(old, 1);\r\n      return this.setGroupCriteria(newGroupings);\r\n    }\r\n    return this.setGroupCriteria([col]);\r\n  }\r\n\r\n  getGroupCriteria() {\r\n    return this.groupColumns.slice();\r\n  }\r\n\r\n  /**\r\n   * replaces, moves, or remove the given column in the sorting hierarchy\r\n   * @param col {Column}\r\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\r\n   */\r\n  sortBy(col: Column, ascending: boolean = false, priority: number = 0) {\r\n    if (col.findMyRanker() !== this) {\r\n      return false; //not one of mine\r\n    }\r\n    return this.setSortCriteria(this.hierarchyLogic(this.sortCriteria, this.sortCriteria.findIndex((d) => d.col === col), {col, asc: ascending}, priority));\r\n  }\r\n\r\n  /**\r\n   * replaces, moves, or remove the given column in the group sorting hierarchy\r\n   * @param col {Column}\r\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\r\n   */\r\n  groupSortBy(col: Column, ascending: boolean = false, priority: number = 0) {\r\n    if (col.findMyRanker() !== this) {\r\n      return false; //not one of mine\r\n    }\r\n    return this.setGroupSortCriteria(this.hierarchyLogic(this.groupSortCriteria, this.groupSortCriteria.findIndex((d) => d.col === col), {col, asc: ascending}, priority));\r\n  }\r\n\r\n  private hierarchyLogic<T>(entries: T[], index: number, entry: T, priority: number) {\r\n    entries = entries.slice();\r\n    if (index >= 0) {\r\n      // move at the other position\r\n      entries.splice(index, 1);\r\n      if (priority >= 0) {\r\n        entries.splice(Math.min(priority, entries.length), 0, entry);\r\n      }\r\n    } else if (priority >= 0) {\r\n      entries[Math.min(priority, entries.length)] = entry;\r\n    }\r\n    return entries;\r\n  }\r\n\r\n  /**\r\n   * replaces, moves, or remove the given column in the grouping hierarchy\r\n   * @param col {Column}\r\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\r\n   */\r\n  groupBy(col: Column, priority: number = 0): boolean {\r\n    if (col.findMyRanker() !== this) {\r\n      return false; //not one of mine\r\n    }\r\n    return this.setGroupCriteria(this.hierarchyLogic(this.groupColumns, this.groupColumns.indexOf(col), col, priority));\r\n  }\r\n\r\n  setSortCriteria(value: ISortCriteria | ISortCriteria[]) {\r\n    const values = Array.isArray(value) ? value.slice() : [value];\r\n    const bak = this.sortCriteria.slice();\r\n\r\n    if (equalCriteria(values, bak)) {\r\n      return false;\r\n    }\r\n\r\n    // update listener\r\n    bak.forEach((d) => {\r\n      d.col.on(Ranking.COLUMN_SORT_DIRTY, null!);\r\n    });\r\n\r\n    values.forEach((d) => {\r\n      d.col.on(Ranking.COLUMN_SORT_DIRTY, this.dirtyOrderSortDirty);\r\n    });\r\n    this.sortCriteria.splice(0, this.sortCriteria.length, ...values.slice());\r\n    this.triggerResort(bak);\r\n    return true;\r\n  }\r\n\r\n  setGroupCriteria(column: Column[] | Column) {\r\n    const cols = Array.isArray(column) ? column : [column];\r\n\r\n    if (equalArrays(this.groupColumns, cols)) {\r\n      return true; //same\r\n    }\r\n    this.groupColumns.forEach((groupColumn) => {\r\n      groupColumn.on(Ranking.COLUMN_GROUP_DIRTY, null);\r\n    });\r\n\r\n    const bak = this.groupColumns.slice();\r\n    this.groupColumns.splice(0, this.groupColumns.length, ...cols);\r\n\r\n    this.groupColumns.forEach((groupColumn) => {\r\n      groupColumn.on(Ranking.COLUMN_GROUP_DIRTY, this.dirtyOrderGroupDirty);\r\n    });\r\n\r\n    this.fire([Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_HEADER,\r\n    Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY_CACHES, Ranking.EVENT_DIRTY], bak, this.getGroupCriteria());\r\n    return true;\r\n  }\r\n\r\n  toggleGroupSorting(col: Column) {\r\n    return this.setGroupSortCriteria(this.toggleSortingLogic(col, this.groupSortCriteria));\r\n  }\r\n\r\n  setGroupSortCriteria(value: ISortCriteria | ISortCriteria[]) {\r\n    const values = Array.isArray(value) ? value.slice() : [value];\r\n    const bak = this.groupSortCriteria.slice();\r\n\r\n    if (equalCriteria(values, bak)) {\r\n      return false;\r\n    }\r\n\r\n    bak.forEach((d) => {\r\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, null!);\r\n    });\r\n\r\n    values.forEach((d) => {\r\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, this.dirtyOrderGroupSortDirty);\r\n    });\r\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length, ...values.slice());\r\n    this.triggerGroupResort(bak);\r\n    return true;\r\n  }\r\n\r\n  private triggerGroupResort(bak: ISortCriteria | ISortCriteria[] | null) {\r\n    const sortCriterias = this.getGroupSortCriteria();\r\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\r\n    this.fire([Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_HEADER,\r\n    Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], bakMulti, sortCriterias);\r\n  }\r\n\r\n  private triggerResort(bak: ISortCriteria | ISortCriteria[] | null) {\r\n    const sortCriterias = this.getSortCriteria();\r\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\r\n    this.fire([Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_HEADER,\r\n    Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], bakMulti, sortCriterias);\r\n  }\r\n\r\n  get children() {\r\n    return this.columns.slice();\r\n  }\r\n\r\n  get length() {\r\n    return this.columns.length;\r\n  }\r\n\r\n  insert(col: Column, index: number = this.columns.length) {\r\n    this.columns.splice(index, 0, col);\r\n    col.attach(this);\r\n    this.forward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\r\n    col.on(`${Ranking.EVENT_FILTER_CHANGED}.order`, this.dirtyOrderFiltering);\r\n    col.on(`${Column.EVENT_VISIBILITY_CHANGED}.ranking`, (oldValue, newValue) => this.fire([Ranking.EVENT_COLUMN_VISIBILITY_CHANGED, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, oldValue, newValue));\r\n\r\n    this.fire([Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, index);\r\n\r\n    if (col.isFiltered()) {\r\n      this.dirtyOrderFiltering();\r\n    }\r\n    return col;\r\n  }\r\n\r\n  move(col: Column, index: number = this.columns.length) {\r\n    if (col.parent !== this) {\r\n      // not a move operation!\r\n      console.error('invalid move operation: ', col);\r\n      return null;\r\n    }\r\n    const old = this.columns.indexOf(col);\r\n    if (index === old) {\r\n      // no move needed\r\n      return col;\r\n    }\r\n    //delete first\r\n    this.columns.splice(old, 1);\r\n    // adapt target index based on previous index, i.e shift by one\r\n    this.columns.splice(old < index ? index - 1 : index, 0, col);\r\n\r\n    this.fire([Ranking.EVENT_MOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, index, old);\r\n    return col;\r\n  }\r\n\r\n  moveAfter(col: Column, reference: Column) {\r\n    const i = this.columns.indexOf(reference);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.move(col, i + 1);\r\n  }\r\n\r\n  get fqpath() {\r\n    return '';\r\n  }\r\n\r\n  findByPath(fqpath: string): Column {\r\n    let p: IColumnParent | Column = <any>this;\r\n    const indices = fqpath.split('@').map(Number).slice(1); //ignore the first entry = ranking\r\n    while (indices.length > 0) {\r\n      const i = indices.shift()!;\r\n      p = (<IColumnParent>p).at(i);\r\n    }\r\n    return <Column>p;\r\n  }\r\n\r\n  indexOf(col: Column) {\r\n    return this.columns.indexOf(col);\r\n  }\r\n\r\n  at(index: number) {\r\n    return this.columns[index];\r\n  }\r\n\r\n  insertAfter(col: Column, ref: Column) {\r\n    const i = this.columns.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.insert(col, i + 1);\r\n  }\r\n\r\n  push(col: Column) {\r\n    return this.insert(col);\r\n  }\r\n\r\n  remove(col: Column) {\r\n    const i = this.columns.indexOf(col);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n\r\n    this.unforward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\r\n\r\n    const isSortCriteria = this.sortCriteria.findIndex((d) => d.col === col);\r\n    const sortCriteriaChanged = isSortCriteria >= 0;\r\n    if (sortCriteriaChanged) {\r\n      this.sortCriteria.splice(isSortCriteria, 1);\r\n    }\r\n\r\n    const isGroupSortCriteria = this.groupSortCriteria.findIndex((d) => d.col === col);\r\n    const groupSortCriteriaChanged = isGroupSortCriteria >= 0;\r\n    if (groupSortCriteriaChanged) {\r\n      this.groupSortCriteria.splice(isGroupSortCriteria, 1);\r\n    }\r\n\r\n    let newGrouping: Column[] | null = null;\r\n    const isGroupColumn = this.groupColumns.indexOf(col);\r\n    if (isGroupColumn >= 0) { // was my grouping criteria\r\n      newGrouping = this.groupColumns.slice();\r\n      newGrouping.splice(isGroupColumn, 1);\r\n    }\r\n\r\n    col.detach();\r\n    this.columns.splice(i, 1);\r\n\r\n    this.fire([Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, i);\r\n\r\n    if (newGrouping) {\r\n      this.setGroupCriteria(newGrouping);\r\n    } else if (sortCriteriaChanged) {\r\n      this.triggerResort(null);\r\n    } else if (groupSortCriteriaChanged) {\r\n      this.triggerGroupResort(null);\r\n    } else if (col.isFiltered()) {\r\n      this.dirtyOrderFiltering();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    if (this.columns.length === 0) {\r\n      return;\r\n    }\r\n    this.sortCriteria.forEach((d) => {\r\n      d.col.on(`${Column.EVENT_DIRTY_CACHES}.order`, null!);\r\n    });\r\n    this.sortCriteria.splice(0, this.sortCriteria.length);\r\n    this.groupSortCriteria.forEach((d) => {\r\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, null!);\r\n    });\r\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length);\r\n\r\n    this.groupColumns.forEach((d) => {\r\n      d.on(Ranking.COLUMN_GROUP_DIRTY, null!);\r\n    });\r\n    this.groupColumns.splice(0, this.groupColumns.length);\r\n\r\n    this.columns.forEach((col) => {\r\n      this.unforward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\r\n      col.detach();\r\n    });\r\n    const removed = this.columns.splice(0, this.columns.length);\r\n    this.fire([Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], removed);\r\n  }\r\n\r\n  get flatColumns(): Column[] {\r\n    const r: IFlatColumn[] = [];\r\n    this.flatten(r, 0, Column.FLAT_ALL_COLUMNS);\r\n    return r.map((d) => d.col);\r\n  }\r\n\r\n  find(idOrFilter: string | ((col: Column) => boolean)) {\r\n    const filter = typeof (idOrFilter) === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\r\n    const r = this.flatColumns;\r\n    for (const v of r) {\r\n      if (filter(v)) {\r\n        return v;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.columns.some((d) => d.isFiltered());\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return this.columns.every((d) => d.filter(row));\r\n  }\r\n\r\n  clearFilters() {\r\n    return this.columns.map((d) => d.clearFilter()).some((d) => d);\r\n  }\r\n\r\n  findMyRanker() {\r\n    return this;\r\n  }\r\n\r\n  get fqid() {\r\n    return this.id;\r\n  }\r\n\r\n  /**\r\n   * marks the header, values, or both as dirty such that the values are reevaluated\r\n   * @param type specify in more detail what is dirty, by default whole column\r\n   */\r\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\r\n    switch (type) {\r\n      case 'header':\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\r\n      case 'values':\r\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY]);\r\n      default:\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY]);\r\n    }\r\n  }\r\n}\r\n\r\nfunction equalCriteria(a: ISortCriteria[], b: ISortCriteria[]) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  return a.every((ai, i) => {\r\n    const bi = b[i];\r\n    return ai.col === bi.col && ai.asc === bi.asc;\r\n  });\r\n}\r\n","/**\r\n * @internal\r\n */\r\nexport interface IDebounceContext {\r\n  /**\r\n   * aka this\r\n   */\r\n  self: any;\r\n  args: any[];\r\n}\r\n\r\n/**\r\n * create a delayed call, can be called multiple times but only the last one at most delayed by timeToDelay will be executed\r\n * @param {(...args: any[]) => void} callback the callback to call\r\n * @param {number} timeToDelay delay the call in milliseconds\r\n * @param choose optional function to merge call context\r\n * @return {(...args: any[]) => any} a function that can be called with the same interface as the callback but delayed\r\n * @internal\r\n */\r\nexport default function debounce(callback: (...args: any[]) => void, timeToDelay = 100, choose?: (current: IDebounceContext, next: IDebounceContext) => IDebounceContext) {\r\n  let tm = -1;\r\n  let ctx: IDebounceContext | null = null;\r\n\r\n  return function (this: any, ...args: any[]) {\r\n    if (tm >= 0) {\r\n      clearTimeout(tm);\r\n      tm = -1;\r\n    }\r\n\r\n    const next = {self: this, args};\r\n    // compute current context\r\n    ctx = ctx && choose ? choose(ctx, next) : next;\r\n\r\n    tm = self.setTimeout(() => {\r\n      console.assert(ctx != null);\r\n      callback.apply(ctx!.self, ctx!.args);\r\n      ctx = null;\r\n    }, timeToDelay);\r\n  };\r\n}\r\n","import {Category, SupportType} from './annotations';\r\nimport Column from './Column';\r\nimport {IDataRow, IColumnDesc} from './interfaces';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\n/**\r\n * factory for creating a description creating a rank column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createRankDesc(label: string = 'Rank') {\r\n  return {type: 'rank', label};\r\n}\r\n\r\n/**\r\n * a rank column\r\n */\r\n@SupportType()\r\n@Category('support')\r\nexport default class RankColumn extends Column {\r\n\r\n  constructor(id: string, desc: IColumnDesc) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 50\r\n    }));\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return String(this.getValue(row));\r\n  }\r\n\r\n  getRaw(row: IDataRow) {\r\n    const ranking = this.findMyRanker();\r\n    if (!ranking) {\r\n      return -1;\r\n    }\r\n    return ranking.getRank(row.i);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const r = this.getRaw(row);\r\n    return r === -1 ? null : r;\r\n  }\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n}\r\n","import {Category, SupportType, toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport {IGroup, IColumnDesc} from './interfaces';\r\nimport Ranking from './Ranking';\r\nimport {IEventListener} from '../internal';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\nexport enum EAggregationState {\r\n  COLLAPSE = 'collapse',\r\n  EXPAND = 'expand',\r\n  EXPAND_TOP_N = 'expand_top'\r\n}\r\n\r\n/**\r\n * factory for creating a description creating a rank column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createAggregateDesc(label: string = 'Aggregate Groups') {\r\n  return {type: 'aggregate', label, fixed: true};\r\n}\r\n\r\nexport interface IAggregateGroupColumnDesc extends IColumnDesc {\r\n  isAggregated(ranking: Ranking, group: IGroup): EAggregationState;\r\n\r\n  setAggregated(ranking: Ranking, group: IGroup, value: EAggregationState): void;\r\n}\r\n\r\n/**\r\n * emitted upon changing of the aggregate attribute\r\n * @aparam value -1 = no, 0 = fully aggregated, N = show top N\r\n * @asMemberOf AggregateGroupColumn\r\n * @event\r\n */\r\nexport declare function aggregate(ranking: Ranking, group: IGroup, value: boolean, state: EAggregationState): void;\r\n\r\n/**\r\n * a checkbox column for selections\r\n */\r\n@toolbar('setShowTopN', 'rename')\r\n@SupportType()\r\n@Category('support')\r\nexport default class AggregateGroupColumn extends Column {\r\n  static readonly EVENT_AGGREGATE = 'aggregate';\r\n\r\n  constructor(id: string, desc: Readonly<IAggregateGroupColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 40\r\n    }));\r\n  }\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([AggregateGroupColumn.EVENT_AGGREGATE]);\r\n  }\r\n\r\n  on(type: typeof AggregateGroupColumn.EVENT_AGGREGATE, listener: typeof aggregate | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  isAggregated(group: IGroup) {\r\n    const ranking = this.findMyRanker()!;\r\n    if ((<IAggregateGroupColumnDesc>this.desc).isAggregated) {\r\n      return (<IAggregateGroupColumnDesc>this.desc).isAggregated(ranking, group);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  setAggregated(group: IGroup, value: boolean | EAggregationState) {\r\n    const n: EAggregationState = typeof value === 'boolean' ? (value ? EAggregationState.EXPAND : EAggregationState.COLLAPSE): value;\r\n    const ranking = this.findMyRanker()!;\r\n    const current = ((<IAggregateGroupColumnDesc>this.desc).isAggregated) && (<IAggregateGroupColumnDesc>this.desc).isAggregated(ranking, group);\r\n    if (current === n) {\r\n      return true;\r\n    }\r\n\r\n    if ((<IAggregateGroupColumnDesc>this.desc).setAggregated) {\r\n      (<IAggregateGroupColumnDesc>this.desc).setAggregated(ranking, group, n);\r\n    }\r\n    this.fire(AggregateGroupColumn.EVENT_AGGREGATE, ranking, group, n !== EAggregationState.COLLAPSE, n);\r\n    return false;\r\n  }\r\n}\r\n","import {Category, SupportType, toolbar} from './annotations';\r\nimport {IndicesArray, IDataRow, IGroup, ECompareValueType, IValueColumnDesc} from './interfaces';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal';\r\nimport {integrateDefaults} from './internal';\r\n\r\n/**\r\n * factory for creating a description creating a rank column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createSelectionDesc(label: string = 'Selection Checkboxes') {\r\n  return {type: 'selection', label, fixed: true};\r\n}\r\n\r\nexport interface ISelectionColumnDesc extends IValueColumnDesc<boolean> {\r\n  /**\r\n   * setter for selecting/deselecting the given row\r\n   */\r\n  setter(index: number, value: boolean): void;\r\n\r\n  /**\r\n   * setter for selecting/deselecting the given row\r\n   */\r\n  setterAll(indices: IndicesArray, value: boolean): void;\r\n}\r\n\r\n\r\n/**\r\n * emitted when rows are selected\r\n * @asMemberOf SelectionColumn\r\n * @param dataIndex the (de)seleced row\r\n * @param value true if selected else false\r\n * @param dataIndices in case of multiple rows are selected\r\n * @event\r\n */\r\nexport declare function select_SC(dataIndex: number, value: boolean, dataIndices?: IndicesArray): void;\r\n\r\n/**\r\n * a checkbox column for selections\r\n */\r\n@SupportType()\r\n@toolbar('sort', 'sortBy', 'group', 'groupBy', 'invertSelection')\r\n@Category('support')\r\nexport default class SelectionColumn extends ValueColumn<boolean> {\r\n  private static SELECTED_GROUP: IGroup = {\r\n    name: 'Selected',\r\n    color: 'orange'\r\n  };\r\n  private static NOT_SELECTED_GROUP: IGroup = {\r\n    name: 'Unselected',\r\n    color: 'gray'\r\n  };\r\n  static readonly EVENT_SELECT = 'select';\r\n\r\n  constructor(id: string, desc: Readonly<ISelectionColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 20\r\n    }));\r\n  }\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SelectionColumn.EVENT_SELECT]);\r\n  }\r\n\r\n  on(type: typeof SelectionColumn.EVENT_SELECT, listener: typeof select_SC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  setValue(row: IDataRow, value: boolean) {\r\n    const old = this.getValue(row);\r\n    if (old === value) {\r\n      return true;\r\n    }\r\n    return this.setImpl(row, value);\r\n  }\r\n\r\n  setValues(rows: IndicesArray, value: boolean) {\r\n    if (rows.length === 0) {\r\n      return;\r\n    }\r\n    if ((<ISelectionColumnDesc>this.desc).setterAll) {\r\n      (<ISelectionColumnDesc>this.desc).setterAll(rows, value);\r\n    }\r\n    this.fire(SelectionColumn.EVENT_SELECT, rows[0], value, rows);\r\n    return true;\r\n  }\r\n\r\n  private setImpl(row: IDataRow, value: boolean) {\r\n    if ((<ISelectionColumnDesc>this.desc).setter) {\r\n      (<ISelectionColumnDesc>this.desc).setter(row.i, value);\r\n    }\r\n    this.fire(SelectionColumn.EVENT_SELECT, row.i, value);\r\n    return true;\r\n  }\r\n\r\n  toggleValue(row: IDataRow) {\r\n    const old = this.getValue(row);\r\n    this.setImpl(row, !old);\r\n    return !old;\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    const v = this.getValue(row) === true;\r\n    return v ? 1 : 0;\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return ECompareValueType.BINARY;\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    const isSelected = this.getValue(row);\r\n    return Object.assign({}, isSelected ? SelectionColumn.SELECTED_GROUP : SelectionColumn.NOT_SELECTED_GROUP);\r\n  }\r\n}\r\n","import {Category, SupportType} from './annotations';\r\nimport {IDataRow, IColumnDesc, IGroup} from './interfaces';\r\nimport Column from './Column';\r\n\r\nexport interface IAction {\r\n  name: string;\r\n  icon?: string;\r\n  className?: string;\r\n\r\n  action(row: IDataRow): void;\r\n}\r\n\r\nexport interface IGroupAction {\r\n  name: string;\r\n  icon?: string;\r\n  className?: string;\r\n\r\n  action(group: IGroup, rows: IDataRow[]): void;\r\n}\r\n\r\n/**\r\n * utility for creating an action description with optional label\r\n * @param label\r\n * @param actions\r\n * @param groupActions\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createActionDesc(label = 'actions', actions: Readonly<IAction>[] = [], groupActions: Readonly<IGroupAction>[] = []) {\r\n  return {type: 'actions', label, actions, groupActions, fixed: true};\r\n}\r\n\r\nexport interface IActionDesc {\r\n  actions?: Readonly<IAction>[];\r\n  groupActions?: Readonly<IGroupAction>[];\r\n}\r\n\r\nexport declare type IActionColumnDesc = IColumnDesc & IActionDesc;\r\n\r\n/**\r\n * a default column with no values\r\n */\r\n@SupportType()\r\n@Category('support')\r\nexport default class ActionColumn extends Column {\r\n\r\n  readonly actions: IAction[];\r\n  readonly groupActions: IGroupAction[];\r\n\r\n  constructor(id: string, desc: Readonly<IActionColumnDesc>) {\r\n    super(id, desc);\r\n\r\n    this.actions = desc.actions || [];\r\n    this.groupActions = desc.groupActions || [];\r\n  }\r\n\r\n  getLabel() {\r\n    return '';\r\n  }\r\n\r\n  getValue() {\r\n    return '';\r\n  }\r\n\r\n  compare() {\r\n    return 0; //can't compare\r\n  }\r\n}\r\n","import {IGroup} from './interfaces';\r\n\r\n\r\nexport function isMissingValue(v: any): boolean {\r\n  if(v == null || v === undefined || v === '' || v === 'NA' || v === 'na' || v === 'Na' || v === 'nA' || v === 'NaN' || (typeof v === 'number' && isNaN(v))) {\r\n    return true;\r\n  }\r\n  if (!Array.isArray(v)) {\r\n    return false;\r\n  }\r\n  for (const vi of v) {\r\n    if (!isMissingValue(vi)) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isUnknown(v?: number | null) {\r\n  return v == null || v === undefined || isNaN(v);\r\n}\r\n\r\nexport const FIRST_IS_NAN = -1;\r\nexport const FIRST_IS_MISSING = 1;\r\n\r\n\r\nexport const missingGroup: IGroup = {\r\n  name: 'Missing values',\r\n  color: 'gray'\r\n};\r\n","import {Category, toolbar, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport {defaultGroup, IDataRow, IGroup, ECompareValueType, IValueColumnDesc, othersGroup, ITypeFactory} from './interfaces';\r\nimport {missingGroup, isMissingValue} from './missing';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {equal, IEventListener, ISequence, isSeqEmpty} from '../internal';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport enum EAlignment {\r\n  left = 'left',\r\n  center = 'center',\r\n  right = 'right'\r\n}\r\n\r\nexport enum EStringGroupCriteriaType {\r\n  value = 'value',\r\n  startsWith = 'startsWith',\r\n  regex = 'regex'\r\n}\r\n\r\nexport interface IStringGroupCriteria {\r\n  type: EStringGroupCriteriaType;\r\n  values: (string | RegExp)[];\r\n}\r\n\r\nexport interface IStringDesc {\r\n  /**\r\n   * column alignment: left, center, right\r\n   * @default left\r\n   */\r\n  alignment?: EAlignment;\r\n\r\n  /**\r\n   * escape html tags\r\n   */\r\n  escape?: boolean;\r\n}\r\n\r\n\r\nexport declare type IStringColumnDesc = IStringDesc & IValueColumnDesc<string>;\r\n\r\nexport interface IStringFilter {\r\n  filter: string | RegExp | null;\r\n  filterMissing: boolean;\r\n}\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf StringColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_SC(previous: string | RegExp | null, current: string | RegExp | null): void;\r\n\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf StringColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged_SC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'search', 'groupBy', 'sortGroupBy', 'filterString')\r\n@dialogAddons('group', 'groupString')\r\n@Category('string')\r\nexport default class StringColumn extends ValueColumn<string> {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\r\n\r\n  //magic key for filtering missing ones\r\n  private static readonly FILTER_MISSING = '__FILTER_MISSING';\r\n  private currentFilter: IStringFilter | null = null;\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  private currentGroupCriteria: IStringGroupCriteria = {\r\n    type: EStringGroupCriteriaType.startsWith,\r\n    values: []\r\n  };\r\n\r\n  constructor(id: string, desc: Readonly<IStringColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 200\r\n    }));\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n  }\r\n\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([StringColumn.EVENT_GROUPING_CHANGED, StringColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_SC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_SC | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow): string | null {\r\n    const v: any = super.getValue(row);\r\n    return isMissingValue(v) ? null : String(v);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return this.getValue(row) || '';\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    if (this.currentFilter instanceof RegExp) {\r\n      r.filter = `REGEX:${(<RegExp>this.currentFilter).source}`;\r\n    } else {\r\n      r.filter = this.currentFilter;\r\n    }\r\n    if (this.currentGroupCriteria) {\r\n      const {type, values} = this.currentGroupCriteria;\r\n      r.groupCriteria = {\r\n        type,\r\n        values: values.map((value) => `${type}:${value instanceof RegExp && type === EStringGroupCriteriaType.regex ? value.source : value}`)\r\n      };\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.filter) {\r\n      const filter = dump.filter;\r\n      if (typeof filter === 'string') {\r\n        // compatibility case\r\n        if ((<string>filter).startsWith('REGEX:')) {\r\n          this.currentFilter = {\r\n            filter: new RegExp(filter.slice(6), 'gm'),\r\n            filterMissing: false\r\n          };\r\n        } else if (filter === StringColumn.FILTER_MISSING) {\r\n          this.currentFilter = {\r\n            filter: null,\r\n            filterMissing: true\r\n          };\r\n        } else {\r\n          this.currentFilter = {\r\n            filter,\r\n            filterMissing: false\r\n          };\r\n        }\r\n      } else {\r\n        this.currentFilter = {\r\n          filter: filter.filter && (<string>filter.filter).startsWith('REGEX:') ? new RegExp(filter.slice(6), 'gm') : filter.filter || '',\r\n          filterMissing: filter.filterMissing === true\r\n        };\r\n      }\r\n    } else {\r\n      this.currentFilter = null;\r\n    }\r\n\r\n    // tslint:disable-next-line: early-exit\r\n    if (dump.groupCriteria) {\r\n      const {type, values} = <IStringGroupCriteria>dump.groupCriteria;\r\n      this.currentGroupCriteria = {\r\n        type,\r\n        values: values.map((value) => type === EStringGroupCriteriaType.regex ? new RegExp(<string>value, 'gm') : value)\r\n      };\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    if (!this.isFiltered()) {\r\n      return true;\r\n    }\r\n    const r = this.getLabel(row);\r\n    const filter = this.currentFilter!;\r\n    const ff = filter.filter;\r\n\r\n    if (r == null || r.trim() === '') {\r\n      return !filter.filterMissing;\r\n    }\r\n    if (!ff) {\r\n      return true;\r\n    }\r\n    if (ff instanceof RegExp) {\r\n      return r !== '' && r.match(ff) != null; // You can not use RegExp.test(), because of https://stackoverflow.com/a/6891667\r\n    }\r\n    return r !== '' && r.toLowerCase().includes(ff.toLowerCase());\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: IStringFilter | null) {\r\n    if (filter === this.currentFilter) {\r\n      return;\r\n    }\r\n    const current = this.currentFilter || {filter: null, filterMissing: false};\r\n    const target = filter || {filter: null, filterMissing: false};\r\n    if (current.filterMissing === target.filterMissing && (current.filter === target.filter ||\r\n      (current.filter instanceof RegExp && target.filter instanceof RegExp && current.filter.source === target.filter.source))) {\r\n      return;\r\n    }\r\n    this.fire([StringColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.currentFilter, this.currentFilter = filter);\r\n  }\r\n\r\n  clearFilter() {\r\n    const was = this.isFiltered();\r\n    this.setFilter(null);\r\n    return was;\r\n  }\r\n\r\n  getGroupCriteria(): IStringGroupCriteria {\r\n    return this.currentGroupCriteria;\r\n  }\r\n\r\n  setGroupCriteria(value: IStringGroupCriteria) {\r\n    if (equal(this.currentGroupCriteria, value) || value == null) {\r\n      return;\r\n    }\r\n    const bak = this.getGroupCriteria();\r\n    this.currentGroupCriteria = value;\r\n    this.fire([StringColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    if (this.getValue(row) == null) {\r\n      return Object.assign({}, missingGroup);\r\n    }\r\n\r\n    if (!this.currentGroupCriteria) {\r\n      return Object.assign({}, othersGroup);\r\n    }\r\n    const value = this.getLabel(row);\r\n\r\n    if (!value) {\r\n      return Object.assign({}, missingGroup);\r\n    }\r\n\r\n    const {type, values} = this.currentGroupCriteria;\r\n    if (type === EStringGroupCriteriaType.value) {\r\n      return {\r\n        name: value,\r\n        color: defaultGroup.color\r\n      };\r\n    }\r\n    for (const groupValue of values) {\r\n      if (type === EStringGroupCriteriaType.startsWith && typeof groupValue === 'string' && value.startsWith(groupValue)) {\r\n        return {\r\n          name: groupValue,\r\n          color: defaultGroup.color\r\n        };\r\n      }\r\n      // tslint:disable-next-line: early-exit\r\n      if (type === EStringGroupCriteriaType.regex && groupValue instanceof RegExp && groupValue.test(value)) {\r\n        return {\r\n          name: groupValue.source,\r\n          color: defaultGroup.color\r\n        };\r\n      }\r\n    }\r\n    return Object.assign({}, othersGroup);\r\n  }\r\n\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    return v === '' || v == null ? null : v.toLowerCase();\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return ECompareValueType.STRING;\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>) {\r\n    if (isSeqEmpty(rows)) {\r\n      return null;\r\n    }\r\n    // take the smallest one\r\n    if (valueCache) {\r\n      return valueCache.reduce((acc, v) => acc == null || v < acc ? v : acc, <null |string>null);\r\n    }\r\n    return rows.reduce((acc, d) => {\r\n      const v = this.getValue(d);\r\n      return acc == null || (v != null && v < acc) ? v : acc;\r\n    }, <null | string>null);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return ECompareValueType.STRING;\r\n  }\r\n}\r\n\r\n","import * as equalImpl from 'fast-deep-equal';\r\n\r\n// keep here to have a \"real\" export for webpack not just interfaces\r\n\r\n/**\r\n * deep equal comparison\r\n */\r\nexport const equal: (a: any, b: any) => boolean = (typeof equalImpl === 'function' ? equalImpl : (<any>equalImpl).default);\r\n\r\nexport interface IBin<T> {\r\n  /**\r\n   * bin start\r\n   */\r\n  x0: T;\r\n  /**\r\n   * bin end\r\n   */\r\n  x1: T;\r\n  /**\r\n   * bin count\r\n   */\r\n  count: number;\r\n}\r\n\r\nexport declare type INumberBin = IBin<number>;\r\n\r\nexport interface IBoxPlotData {\r\n  readonly min: number;\r\n  readonly max: number;\r\n  readonly median: number;\r\n  readonly q1: number;\r\n  readonly q3: number;\r\n  readonly outlier?: number[];\r\n  readonly whiskerLow?: number;\r\n  readonly whiskerHigh?: number;\r\n}\r\n\r\nexport interface IAdvancedBoxPlotData extends IBoxPlotData {\r\n  readonly mean: number;\r\n\r\n  readonly missing: number;\r\n  readonly count: number;\r\n}\r\n\r\nexport interface IHistogramStats<T> {\r\n  readonly min: T | null;\r\n  readonly max: T | null;\r\n\r\n  readonly missing: number;\r\n  readonly count: number;\r\n\r\n  readonly maxBin: number;\r\n  readonly hist: ReadonlyArray<IBin<T>>;\r\n}\r\n\r\nexport interface IStatistics extends IHistogramStats<number> {\r\n  readonly mean: number;\r\n}\r\n\r\nexport interface ICategoricalBin {\r\n  cat: string;\r\n  count: number;\r\n}\r\n\r\nexport declare type IDateBin = IBin<Date>;\r\n\r\nexport interface ICategoricalStatistics {\r\n  readonly missing: number;\r\n  readonly count: number;\r\n\r\n  readonly maxBin: number;\r\n  readonly hist: ReadonlyArray<ICategoricalBin>;\r\n}\r\n\r\nexport declare type IDateHistGranularity = 'year' | 'month' | 'day';\r\n\r\nexport interface IDateStatistics extends IHistogramStats<Date> {\r\n  readonly histGranularity: IDateHistGranularity;\r\n}\r\n","import Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport {IDataRow, ITypeFactory} from './interfaces';\r\nimport StringColumn from './StringColumn';\r\nimport {IEventListener} from '../internal';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\n\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf AnnotateColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_AC(previous: string | RegExp | null, current: string | RegExp | null): void;\r\n\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf AnnotateColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged_AC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\r\n\r\n/**\r\n * emitted when the value of a row changes\r\n * @asMemberOf AnnotateColumn\r\n * @event\r\n */\r\nexport declare function valueChanged(dataIndex: number, previous: string, current: string): void;\r\n\r\n/**\r\n * a string column in which the values can be edited locally\r\n */\r\nexport default class AnnotateColumn extends StringColumn {\r\n  static readonly EVENT_VALUE_CHANGED = 'valueChanged';\r\n\r\n  private readonly annotations = new Map<number, string>();\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([AnnotateColumn.EVENT_VALUE_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof AnnotateColumn.EVENT_VALUE_CHANGED, listener: typeof valueChanged | null): this;\r\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_AC | null): this;\r\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_AC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    if (this.annotations.has(row.i)) {\r\n      return this.annotations.get(row.i)!;\r\n    }\r\n    return super.getValue(row);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.annotations = {};\r\n    this.annotations.forEach((v, k) => {\r\n      r.annotations[k] = v;\r\n    });\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (!dump.annotations) {\r\n      return;\r\n    }\r\n    Object.keys(dump.annotations).forEach((k) => {\r\n      this.annotations.set(Number(k), dump.annotations[k]);\r\n    });\r\n  }\r\n\r\n  setValue(row: IDataRow, value: string) {\r\n    const old = this.getValue(row);\r\n    if (old === value) {\r\n      return true;\r\n    }\r\n    if (value === '' || value == null) {\r\n      this.annotations.delete(row.i);\r\n    } else {\r\n      this.annotations.set(row.i, value);\r\n    }\r\n    this.fire([AnnotateColumn.EVENT_VALUE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], row.i, old, value);\r\n    return true;\r\n  }\r\n}\r\n","import {ICategory, ICategoricalColorMappingFunction} from '.';\r\nimport {DEFAULT_COLOR, ITypedDump} from './interfaces';\r\n\r\n\r\nexport const DEFAULT_CATEGORICAL_COLOR_FUNCTION: ICategoricalColorMappingFunction = {\r\n  apply: (v) => v ? v.color : DEFAULT_COLOR,\r\n  toJSON: () => null,\r\n  clone: () => DEFAULT_CATEGORICAL_COLOR_FUNCTION,\r\n  eq: (other) => other === DEFAULT_CATEGORICAL_COLOR_FUNCTION\r\n};\r\n\r\nexport class ReplacmentColorMappingFunction implements ICategoricalColorMappingFunction {\r\n  public readonly map: ReadonlyMap<string, string>;\r\n  constructor(map: Map<ICategory | string, string>) {\r\n    this.map = new Map(Array.from(map.entries()).map(([k, v]) => <[string, string]>[typeof k === 'string' ? k : k.name, v]));\r\n  }\r\n\r\n  apply(v: ICategory) {\r\n    return this.map.has(v.name) ? this.map.get(v.name)! : DEFAULT_CATEGORICAL_COLOR_FUNCTION.apply(v);\r\n  }\r\n\r\n  toJSON() {\r\n    const r: any = {};\r\n    this.map.forEach((v, k) => r[k] = v);\r\n    return {\r\n      type: 'replace',\r\n      map: r\r\n    };\r\n  }\r\n\r\n  clone() {\r\n    return new ReplacmentColorMappingFunction(new Map(this.map.entries()));\r\n  }\r\n\r\n  eq(other: ICategoricalColorMappingFunction): boolean {\r\n    if (!(other instanceof ReplacmentColorMappingFunction)) {\r\n      return false;\r\n    }\r\n    if (other.map.size !== this.map.size) {\r\n      return false;\r\n    }\r\n    return Array.from(this.map.keys()).every((k) => this.map.get(k) === other.map.get(k));\r\n  }\r\n\r\n  static restore(dump: any, categories: ICategory[]) {\r\n    if (dump.type === 'replace') { // new dump format\r\n      dump = dump.map;\r\n    }\r\n    const lookup = new Map(categories.map((d) => <[string, ICategory]>[d.name, d]));\r\n    const r = new Map<ICategory, string>();\r\n    for (const key of Object.keys(dump)) {\r\n      if (lookup.has(key)) {\r\n        r.set(lookup.get(key)!, dump[key]);\r\n      }\r\n    }\r\n    return new ReplacmentColorMappingFunction(r);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function restoreCategoricalColorMapping(dump: ITypedDump | null | undefined, categories: ICategory[]): ICategoricalColorMappingFunction {\r\n  if (!dump) {\r\n    return DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n  return ReplacmentColorMappingFunction.restore(dump, categories);\r\n}\r\n","import {ISequence, isSeqEmpty, empty} from '../internal';\r\nimport {FIRST_IS_MISSING, IDataRow, ECompareValueType, ICompareValue, ICategory, ICategoricalColumn, ICategoricalDesc, ICategoricalFilter} from '.';\r\nimport {colorPool} from './internal';\r\nimport {DEFAULT_COLOR} from './interfaces';\r\nimport {ICategoricalsColumn, ISetCategoricalFilter} from './ICategoricalColumn';\r\n\r\n/** @internal */\r\nexport function toCategory(cat: (string | Partial<ICategory>), value: number, nextColor: () => string = () => DEFAULT_COLOR) {\r\n  if (typeof cat === 'string') {\r\n    //just the category value\r\n    return {name: cat, label: cat, color: nextColor(), value};\r\n  }\r\n  const name = cat.name == null ? String(cat.value) : cat.name;\r\n  return {\r\n    name,\r\n    label: cat.label || name,\r\n    color: cat.color || nextColor(),\r\n    value: cat.value != null ? cat.value : value\r\n  };\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function toCompareCategoryValue(v: ICategory | null) {\r\n  if (v == null) {\r\n    return NaN;\r\n  }\r\n  return v.value;\r\n}\r\n\r\nexport const COMPARE_CATEGORY_VALUE_TYPES = ECompareValueType.FLOAT_ASC;\r\n\r\nfunction findMostFrequent(rows: ISequence<ICategory | null>, valueCache?: ISequence<ICategory | null>): {cat: ICategory | null, count: number} {\r\n  const hist = new Map<ICategory | null, number>();\r\n\r\n  if (valueCache) {\r\n    valueCache.forEach((cat) => {\r\n      hist.set(cat, (hist.get(cat) || 0) + 1);\r\n    });\r\n  } else {\r\n    rows.forEach((cat) => {\r\n      hist.set(cat, (hist.get(cat) || 0) + 1);\r\n    });\r\n  }\r\n\r\n  if (hist.size === 0) {\r\n    return {\r\n      cat: null,\r\n      count: 0\r\n    };\r\n  }\r\n  let topCat: ICategory | null = null;\r\n  let topCount = 0;\r\n  hist.forEach((count, cat) => {\r\n    if (count > topCount) {\r\n      topCat = cat;\r\n      topCount = count;\r\n    }\r\n  });\r\n  return {\r\n    cat: topCat,\r\n    count: topCount\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport function toMostFrequentCategoricals(rows: ISequence<IDataRow>, col: ICategoricalsColumn): (ICategory | null)[] {\r\n  if (isSeqEmpty(rows)) {\r\n    return empty(col.dataLength!);\r\n  }\r\n  const maps = empty(col.dataLength!).map(() => new Map<ICategory | null, number>());\r\n  rows.forEach((row) => {\r\n    const vs = col.getCategories(row);\r\n    if (!vs) {\r\n      return;\r\n    }\r\n    for (let i = 0; i < maps.length; ++i) {\r\n      const hist = maps[i];\r\n      const cat = vs[i] || null;\r\n      hist.set(cat, (hist.get(cat) || 0) + 1);\r\n    }\r\n  });\r\n\r\n  return maps.map((hist) => {\r\n    if (hist.size === 0) {\r\n      return null;\r\n    }\r\n    let topCat: ICategory | null = null;\r\n    let topCount = 0;\r\n    hist.forEach((count, cat) => {\r\n      if (count > topCount) {\r\n        topCat = cat;\r\n        topCount = count;\r\n      }\r\n    });\r\n    return topCat;\r\n  });\r\n}\r\n\r\n/** @internal */\r\nexport function toGroupCompareCategoryValue(rows: ISequence<IDataRow>, col: ICategoricalColumn, valueCache?: ISequence<ICategory | null>): ICompareValue[] {\r\n  if (isSeqEmpty(rows)) {\r\n    return [NaN, null];\r\n  }\r\n  const mostFrequent = findMostFrequent(rows.map((d) => col.getCategory(d)), valueCache);\r\n  if (mostFrequent.cat == null) {\r\n    return [NaN, null];\r\n  }\r\n  return [mostFrequent.cat.value, mostFrequent.cat.name.toLowerCase()];\r\n}\r\n\r\nexport const COMPARE_GROUP_CATEGORY_VALUE_TYPES = [ECompareValueType.FLOAT, ECompareValueType.STRING];\r\n\r\n/** @internal */\r\nfunction compareCategory(a: ICategory | null, b: ICategory | null) {\r\n  const aNull = a == null || isNaN(a.value);\r\n  const bNull = b == null || isNaN(b.value);\r\n  if (aNull || a == null) {\r\n    return bNull ? 0 : FIRST_IS_MISSING;\r\n  }\r\n  if (bNull || b == null) {\r\n    return -FIRST_IS_MISSING;\r\n  }\r\n  if (a.value === b.value) {\r\n    return a.label.toLowerCase().localeCompare(b.label.toLowerCase());\r\n  }\r\n  return a.value - b.value;\r\n}\r\n\r\nexport function toCategories(desc: ICategoricalDesc) {\r\n  if (!desc.categories) {\r\n    return [];\r\n  }\r\n  const nextColor = colorPool();\r\n  const l = desc.categories.length - 1;\r\n  const cats = desc.categories.map((cat, i) => toCategory(cat, i / l, nextColor));\r\n  return cats.sort(compareCategory);\r\n}\r\n\r\n/** @internal */\r\nfunction isEmptyFilter(f: ICategoricalFilter | null) {\r\n  return f == null || (!f.filterMissing && (f.filter == null || f.filter === ''));\r\n}\r\n\r\n/** @internal */\r\nexport function isEqualCategoricalFilter(a: ICategoricalFilter | null, b: ICategoricalFilter | null) {\r\n  if (a === b) {\r\n    return true;\r\n  }\r\n  if (a == null || b == null) {\r\n    return isEmptyFilter(a) === isEmptyFilter(b);\r\n  }\r\n  if (a.filterMissing !== b.filterMissing || (typeof a.filter !== typeof b.filter)) {\r\n    return false;\r\n  }\r\n  if (Array.isArray(a.filter)) {\r\n    return arrayEquals(<string[]>a.filter, <string[]>b.filter);\r\n  }\r\n  return String(a.filter) === String(b.filter);\r\n}\r\n\r\n/** @internal */\r\nexport function isEqualSetCategoricalFilter(a: ISetCategoricalFilter | null, b: ISetCategoricalFilter | null) {\r\n  if (!isEqualCategoricalFilter(a, b)) {\r\n    return false;\r\n  }\r\n  const am = a && a.mode ? a.mode : 'every';\r\n  const bm = b && b.mode ? b.mode : 'every';\r\n  return am === bm;\r\n}\r\n\r\nfunction arrayEquals<T>(a: T[], b: T[]) {\r\n  const al = a != null ? a.length : 0;\r\n  const bl = b != null ? b.length : 0;\r\n  if (al !== bl) {\r\n    return false;\r\n  }\r\n  if (al === 0) {\r\n    return true;\r\n  }\r\n  return a.every((ai, i) => ai === b[i]);\r\n}\r\n\r\n/** @internal */\r\nexport function isCategoryIncluded(filter: ICategoricalFilter | null, category: ICategory | null) {\r\n  if (filter == null) {\r\n    return true;\r\n  }\r\n  if (category == null || isNaN(category.value)) {\r\n    return !filter.filterMissing;\r\n  }\r\n  const filterObj = filter.filter;\r\n  if (Array.isArray(filterObj)) { //array mode\r\n    return filterObj.includes(category.name);\r\n  }\r\n  if (typeof filterObj === 'string' && filterObj.length > 0) { //search mode\r\n    return category.name.toLowerCase().includes(filterObj.toLowerCase());\r\n  }\r\n  if (filterObj instanceof RegExp) { //regex match mode\r\n    return filterObj.test(category.name);\r\n  }\r\n  return true;\r\n}\r\n","import {IEventListener, ISequence} from '../internal';\r\nimport {Category, toolbar} from './annotations';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, groupRendererChanged, labelChanged, metaDataChanged, rendererTypeChanged, summaryRendererChanged, visibilityChanged, widthChanged} from './Column';\r\nimport {ICategoricalColumn, ICategoricalColumnDesc, ICategoricalFilter, ICategory, ICategoricalColorMappingFunction} from './ICategoricalColumn';\r\nimport {IDataRow, IGroup, ICompareValue, DEFAULT_COLOR, ITypeFactory, ECompareValueType} from './interfaces';\r\nimport {missingGroup} from './missing';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {toCategories, isCategoryIncluded, isEqualCategoricalFilter, toCompareCategoryValue, COMPARE_CATEGORY_VALUE_TYPES, toGroupCompareCategoryValue, COMPARE_GROUP_CATEGORY_VALUE_TYPES} from './internalCategorical';\r\n\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf CategoricalColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_CC(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf CategoricalColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_CC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\r\n\r\n/**\r\n * column for categorical values\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'groupBy', 'sortGroupBy', 'filterCategorical', 'colorMappedCategorical')\r\n@Category('categorical')\r\nexport default class CategoricalColumn extends ValueColumn<string> implements ICategoricalColumn {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n  /**\r\n   * set of categories to show\r\n   * @type {null}\r\n   * @private\r\n   */\r\n  private currentFilter: ICategoricalFilter | null = null;\r\n\r\n  constructor(id: string, desc: Readonly<ICategoricalColumnDesc>) {\r\n    super(id, desc);\r\n    this.categories = toCategories(desc);\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([CategoricalColumn.EVENT_FILTER_CHANGED, CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof CategoricalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_CC | null): this;\r\n  on(type: typeof CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_CC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.name : null;\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    const v = super.getValue(row);\r\n    if (!v) {\r\n      return null;\r\n    }\r\n    const vs = String(v);\r\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.label : '';\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return [v];\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return this.categories.map((d) => d === v);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValues(row).map(String);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    const cats = this.categories;\r\n    return this.getValues(row).map((value, i) => ({key: cats[i].label, value}));\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    const cats = this.categories;\r\n    return this.getLabels(row).map((value, i) => ({key: cats[i].label, value}));\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const cat = this.getCategory(row);\r\n    const r = new Set<ICategory>();\r\n    if (cat) {\r\n      r.add(cat);\r\n    }\r\n    return r;\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    return [this.getCategory(row)];\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.filter = this.currentFilter;\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n\r\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\r\n\r\n    if ('filter' in dump) {\r\n      this.currentFilter = null;\r\n      return;\r\n    }\r\n    const bak = dump.filter;\r\n    if (typeof bak === 'string' || Array.isArray(bak)) {\r\n      this.currentFilter = {filter: bak, filterMissing: false};\r\n    } else {\r\n      this.currentFilter = bak;\r\n    }\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? this.colorMapping.apply(v) : DEFAULT_COLOR;\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow, valueCache?: any): boolean {\r\n    return isCategoryIncluded(this.currentFilter, valueCache !== undefined ? valueCache : this.getCategory(row));\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\r\n  }\r\n\r\n  setFilter(filter: ICategoricalFilter | null) {\r\n    if (isEqualCategoricalFilter(this.currentFilter, filter)) {\r\n      return;\r\n    }\r\n    this.fire([CategoricalColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.currentFilter, this.currentFilter = filter);\r\n  }\r\n\r\n  clearFilter() {\r\n    const was = this.isFiltered();\r\n    this.setFilter(null);\r\n    return was;\r\n  }\r\n\r\n  toCompareValue(row: IDataRow, valueCache?: any) {\r\n    return toCompareCategoryValue(valueCache !== undefined ? valueCache : this.getCategory(row));\r\n  }\r\n\r\n  toCompareValueType(): ECompareValueType {\r\n    return COMPARE_CATEGORY_VALUE_TYPES;\r\n  }\r\n\r\n  group(row: IDataRow, valueCache?: any): IGroup {\r\n    const cat = valueCache !== undefined ? valueCache : this.getCategory(row);\r\n    if (!cat) {\r\n      return Object.assign({}, missingGroup);\r\n    }\r\n    return {name: cat.label, color: cat.color};\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): ICompareValue[] {\r\n    return toGroupCompareCategoryValue(rows, this, valueCache);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return COMPARE_GROUP_CATEGORY_VALUE_TYPES;\r\n  }\r\n\r\n  getGroupRenderer() {\r\n    const current = super.getGroupRenderer();\r\n    if (current === this.desc.type && this.isGroupedBy() >= 0) {\r\n      // still the default and the stratification criteria\r\n      return 'catdistributionbar';\r\n    }\r\n    return current;\r\n  }\r\n}\r\n","import {Category, toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {ICategoricalColumn, ICategory, ICategoricalColorMappingFunction} from './ICategoricalColumn';\r\nimport {IDataRow, ECompareValueType, IValueColumnDesc, ITypeFactory} from './interfaces';\r\nimport {IEventListener} from '../internal';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport interface IBooleanDesc {\r\n  /**\r\n   * string to show for true\r\n   * @default \r\n   */\r\n  trueMarker?: string;\r\n  /**\r\n   * strint to show for false\r\n   * @default (empty)\r\n   */\r\n  falseMarker?: string;\r\n}\r\n\r\nexport declare type IBooleanColumnDesc = IValueColumnDesc<boolean> & IBooleanDesc;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf BooleanColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_BC(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf BooleanColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_BC(previous: boolean | null, current: boolean | null): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'groupBy', 'filterBoolean', 'colorMappedCategorical')\r\n@Category('categorical')\r\nexport default class BooleanColumn extends ValueColumn<boolean> implements ICategoricalColumn {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\r\n\r\n  static readonly GROUP_TRUE = {name: 'True', color: 'black'};\r\n  static readonly GROUP_FALSE = {name: 'False', color: 'white'};\r\n\r\n  private currentFilter: boolean | null = null;\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n  readonly categories: ICategory[];\r\n\r\n  constructor(id: string, desc: Readonly<IBooleanColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 30\r\n    }));\r\n    this.categories = [\r\n      {\r\n        name: desc.trueMarker || '',\r\n        color: BooleanColumn.GROUP_TRUE.color,\r\n        label: BooleanColumn.GROUP_TRUE.name,\r\n        value: 0\r\n      },\r\n      {\r\n        name: desc.trueMarker || '',\r\n        color: BooleanColumn.GROUP_FALSE.color,\r\n        label: BooleanColumn.GROUP_FALSE.name,\r\n        value: 1\r\n      }\r\n    ];\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([BooleanColumn.EVENT_COLOR_MAPPING_CHANGED, BooleanColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof BooleanColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_BC | null): this;\r\n  on(type: typeof BooleanColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v: any = super.getValue(row);\r\n    if (typeof (v) === 'undefined' || v == null) {\r\n      return false;\r\n    }\r\n    return v === true || v === 'true' || v === 'yes' || v === 'x';\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    return this.categories[v ? 0 : 1];\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return [this.getCategory(row)];\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    return [this.getCategory(row)];\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabel.call(this, row);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabels.call(this, row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getValues.call(this, row);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMap.call(this, row);\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    const r = new Set<ICategory>();\r\n    r.add(this.categories[v ? 0 : 1]);\r\n    return r;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    if (this.currentFilter != null) {\r\n      r.filter = this.currentFilter;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\r\n    if (typeof dump.filter !== 'undefined') {\r\n      this.currentFilter = dump.filter;\r\n    }\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    if (!this.isFiltered()) {\r\n      return true;\r\n    }\r\n    const r = this.getValue(row);\r\n    return r === this.currentFilter;\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: boolean | null) {\r\n    if (this.currentFilter === filter) {\r\n      return;\r\n    }\r\n    this.fire([BooleanColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.currentFilter, this.currentFilter = filter);\r\n  }\r\n\r\n  clearFilter() {\r\n    const was = this.isFiltered();\r\n    this.setFilter(null);\r\n    return was;\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    if (v == null) {\r\n      return NaN;\r\n    }\r\n    return v ? 1 : 0;\r\n  }\r\n\r\n  toCompareValueType(): ECompareValueType {\r\n    return ECompareValueType.BINARY;\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    const enabled = this.getValue(row);\r\n    return Object.assign({}, enabled ? BooleanColumn.GROUP_TRUE : BooleanColumn.GROUP_FALSE);\r\n  }\r\n}\r\n","import {Category} from './annotations';\r\nimport ValueColumn from './ValueColumn';\r\nimport {empty} from '../internal';\r\nimport {IArrayColumn, IArrayDesc} from './IArrayColumn';\r\nimport {IDataRow, IValueColumnDesc} from './interfaces';\r\n\r\n\r\nexport interface IArrayColumnDesc<T> extends IArrayDesc, IValueColumnDesc<T[]> {\r\n  // dummy\r\n}\r\n\r\n\r\n@Category('array')\r\nexport default class ArrayColumn<T> extends ValueColumn<T[]> implements IArrayColumn<T> {\r\n  private readonly _dataLength: number | null;\r\n\r\n  private readonly originalLabels: string[];\r\n\r\n  constructor(id: string, desc: Readonly<IArrayColumnDesc<T>>) {\r\n    super(id, desc);\r\n    this._dataLength = desc.dataLength == null || isNaN(desc.dataLength) ? null : desc.dataLength;\r\n    this.originalLabels = desc.labels || (empty(this._dataLength == null ? 0 : this._dataLength).map((_d, i) => `Column ${i}`));\r\n  }\r\n\r\n\r\n  get labels() {\r\n    return this.originalLabels;\r\n  }\r\n\r\n  get dataLength() {\r\n    return this._dataLength;\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const r = this.getValues(row);\r\n    return r.every((d) => d === null) ? null : r;\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    const r = super.getValue(row);\r\n    return r == null ? [] : r;\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValues(row).map(String);\r\n  }\r\n\r\n  getLabel(row: IDataRow): string {\r\n    const v = this.getLabels(row);\r\n    if (v.length === 0) {\r\n      return '';\r\n    }\r\n    return v.toString();\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    const labels = this.labels;\r\n    return this.getValues(row).map((value, i) => ({key: labels[i], value}));\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    const labels = this.labels;\r\n    return this.getLabels(row).map((value, i) => ({key: labels[i], value}));\r\n  }\r\n}\r\n\r\n","import ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport {ISetColumn, ICategoricalColorMappingFunction} from './ICategoricalColumn';\r\nimport {IDataRow, DEFAULT_COLOR, ITypeFactory, ECompareValueType} from './interfaces';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport Column, {labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, widthChanged, dirtyCaches} from './Column';\r\nimport {IEventListener} from '../internal';\r\nimport {chooseUIntByDataLength, integrateDefaults} from './internal';\r\nimport {toCategory} from './internalCategorical';\r\nimport {toolbar} from './annotations';\r\n\r\n\r\nexport declare type IBooleansColumnDesc = IArrayColumnDesc<boolean>;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf BooleansColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_BCS(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n@toolbar('rename', 'clone', 'sort', 'sortBy')\r\nexport default class BooleansColumn extends ArrayColumn<boolean> implements ISetColumn {\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n\r\n  constructor(id: string, desc: Readonly<IBooleansColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'upset'\r\n    }));\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n\r\n  get categories() {\r\n    return this.labels.map((d, i) => toCategory(d, i));\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const vs = this.getValues(row);\r\n    return new Set(this.categories.filter((_, i) => vs[i]));\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    if (v == null) {\r\n      return NaN;\r\n    }\r\n    return v.reduce((a, b) => a + (b ? 1 : 0), 0);\r\n  }\r\n\r\n  toCompareValueType(): ECompareValueType {\r\n    return chooseUIntByDataLength(this.dataLength);\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    const categories = this.categories;\r\n    return super.getValues(row).map((v, i) => {\r\n      return v ? categories[i]! : null;\r\n    });\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    return this.getCategories(row);\r\n  }\r\n\r\n  getColors(row: IDataRow) {\r\n    return this.getCategories(row).map((d) => d ? this.colorMapping.apply(d) : DEFAULT_COLOR);\r\n  }\r\n\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([BooleansColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof BooleansColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BCS | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\r\n  }\r\n}\r\n","// Computes the decimal coefficient and exponent of the specified number x with\n// significant digits p, where x is positive and p is in [1, 21] or undefined.\n// For example, formatDecimal(1.23) returns [\"123\", 0].\nexport default function(x, p) {\n  if ((i = (x = p ? x.toExponential(p - 1) : x.toExponential()).indexOf(\"e\")) < 0) return null; // NaN, Infinity\n  var i, coefficient = x.slice(0, i);\n\n  // The string returned by toExponential either has the form \\d\\.\\d+e[-+]\\d+\n  // (e.g., 1.2e+3) or the form \\de[-+]\\d+ (e.g., 1e+3).\n  return [\n    coefficient.length > 1 ? coefficient[0] + coefficient.slice(2) : coefficient,\n    +x.slice(i + 1)\n  ];\n}\n","import formatDecimal from \"./formatDecimal\";\n\nexport default function(x) {\n  return x = formatDecimal(Math.abs(x)), x ? x[1] : NaN;\n}\n","// [[fill]align][sign][symbol][0][width][,][.precision][~][type]\nvar re = /^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;\n\nexport default function formatSpecifier(specifier) {\n  return new FormatSpecifier(specifier);\n}\n\nformatSpecifier.prototype = FormatSpecifier.prototype; // instanceof\n\nfunction FormatSpecifier(specifier) {\n  if (!(match = re.exec(specifier))) throw new Error(\"invalid format: \" + specifier);\n  var match;\n  this.fill = match[1] || \" \";\n  this.align = match[2] || \">\";\n  this.sign = match[3] || \"-\";\n  this.symbol = match[4] || \"\";\n  this.zero = !!match[5];\n  this.width = match[6] && +match[6];\n  this.comma = !!match[7];\n  this.precision = match[8] && +match[8].slice(1);\n  this.trim = !!match[9];\n  this.type = match[10] || \"\";\n}\n\nFormatSpecifier.prototype.toString = function() {\n  return this.fill\n      + this.align\n      + this.sign\n      + this.symbol\n      + (this.zero ? \"0\" : \"\")\n      + (this.width == null ? \"\" : Math.max(1, this.width | 0))\n      + (this.comma ? \",\" : \"\")\n      + (this.precision == null ? \"\" : \".\" + Math.max(0, this.precision | 0))\n      + (this.trim ? \"~\" : \"\")\n      + this.type;\n};\n","// Trims insignificant zeros, e.g., replaces 1.2000k with 1.2k.\nexport default function(s) {\n  out: for (var n = s.length, i = 1, i0 = -1, i1; i < n; ++i) {\n    switch (s[i]) {\n      case \".\": i0 = i1 = i; break;\n      case \"0\": if (i0 === 0) i0 = i; i1 = i; break;\n      default: if (i0 > 0) { if (!+s[i]) break out; i0 = 0; } break;\n    }\n  }\n  return i0 > 0 ? s.slice(0, i0) + s.slice(i1 + 1) : s;\n}\n","import formatDecimal from \"./formatDecimal\";\n\nexport var prefixExponent;\n\nexport default function(x, p) {\n  var d = formatDecimal(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1],\n      i = exponent - (prefixExponent = Math.max(-8, Math.min(8, Math.floor(exponent / 3))) * 3) + 1,\n      n = coefficient.length;\n  return i === n ? coefficient\n      : i > n ? coefficient + new Array(i - n + 1).join(\"0\")\n      : i > 0 ? coefficient.slice(0, i) + \".\" + coefficient.slice(i)\n      : \"0.\" + new Array(1 - i).join(\"0\") + formatDecimal(x, Math.max(0, p + i - 1))[0]; // less than 1y!\n}\n","import formatLocale from \"./locale\";\n\nvar locale;\nexport var format;\nexport var formatPrefix;\n\ndefaultLocale({\n  decimal: \".\",\n  thousands: \",\",\n  grouping: [3],\n  currency: [\"$\", \"\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  format = locale.format;\n  formatPrefix = locale.formatPrefix;\n  return locale;\n}\n","import formatDecimal from \"./formatDecimal\";\n\nexport default function(x, p) {\n  var d = formatDecimal(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1];\n  return exponent < 0 ? \"0.\" + new Array(-exponent).join(\"0\") + coefficient\n      : coefficient.length > exponent + 1 ? coefficient.slice(0, exponent + 1) + \".\" + coefficient.slice(exponent + 1)\n      : coefficient + new Array(exponent - coefficient.length + 2).join(\"0\");\n}\n","import formatPrefixAuto from \"./formatPrefixAuto\";\nimport formatRounded from \"./formatRounded\";\n\nexport default {\n  \"%\": function(x, p) { return (x * 100).toFixed(p); },\n  \"b\": function(x) { return Math.round(x).toString(2); },\n  \"c\": function(x) { return x + \"\"; },\n  \"d\": function(x) { return Math.round(x).toString(10); },\n  \"e\": function(x, p) { return x.toExponential(p); },\n  \"f\": function(x, p) { return x.toFixed(p); },\n  \"g\": function(x, p) { return x.toPrecision(p); },\n  \"o\": function(x) { return Math.round(x).toString(8); },\n  \"p\": function(x, p) { return formatRounded(x * 100, p); },\n  \"r\": formatRounded,\n  \"s\": formatPrefixAuto,\n  \"X\": function(x) { return Math.round(x).toString(16).toUpperCase(); },\n  \"x\": function(x) { return Math.round(x).toString(16); }\n};\n","export default function(x) {\n  return x;\n}\n","import exponent from \"./exponent\";\nimport formatGroup from \"./formatGroup\";\nimport formatNumerals from \"./formatNumerals\";\nimport formatSpecifier from \"./formatSpecifier\";\nimport formatTrim from \"./formatTrim\";\nimport formatTypes from \"./formatTypes\";\nimport {prefixExponent} from \"./formatPrefixAuto\";\nimport identity from \"./identity\";\n\nvar prefixes = [\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"];\n\nexport default function(locale) {\n  var group = locale.grouping && locale.thousands ? formatGroup(locale.grouping, locale.thousands) : identity,\n      currency = locale.currency,\n      decimal = locale.decimal,\n      numerals = locale.numerals ? formatNumerals(locale.numerals) : identity,\n      percent = locale.percent || \"%\";\n\n  function newFormat(specifier) {\n    specifier = formatSpecifier(specifier);\n\n    var fill = specifier.fill,\n        align = specifier.align,\n        sign = specifier.sign,\n        symbol = specifier.symbol,\n        zero = specifier.zero,\n        width = specifier.width,\n        comma = specifier.comma,\n        precision = specifier.precision,\n        trim = specifier.trim,\n        type = specifier.type;\n\n    // The \"n\" type is an alias for \",g\".\n    if (type === \"n\") comma = true, type = \"g\";\n\n    // The \"\" type, and any invalid type, is an alias for \".12~g\".\n    else if (!formatTypes[type]) precision == null && (precision = 12), trim = true, type = \"g\";\n\n    // If zero fill is specified, padding goes after sign and before digits.\n    if (zero || (fill === \"0\" && align === \"=\")) zero = true, fill = \"0\", align = \"=\";\n\n    // Compute the prefix and suffix.\n    // For SI-prefix, the suffix is lazily computed.\n    var prefix = symbol === \"$\" ? currency[0] : symbol === \"#\" && /[boxX]/.test(type) ? \"0\" + type.toLowerCase() : \"\",\n        suffix = symbol === \"$\" ? currency[1] : /[%p]/.test(type) ? percent : \"\";\n\n    // What format function should we use?\n    // Is this an integer type?\n    // Can this type generate exponential notation?\n    var formatType = formatTypes[type],\n        maybeSuffix = /[defgprs%]/.test(type);\n\n    // Set the default precision if not specified,\n    // or clamp the specified precision to the supported range.\n    // For significant precision, it must be in [1, 21].\n    // For fixed precision, it must be in [0, 20].\n    precision = precision == null ? 6\n        : /[gprs]/.test(type) ? Math.max(1, Math.min(21, precision))\n        : Math.max(0, Math.min(20, precision));\n\n    function format(value) {\n      var valuePrefix = prefix,\n          valueSuffix = suffix,\n          i, n, c;\n\n      if (type === \"c\") {\n        valueSuffix = formatType(value) + valueSuffix;\n        value = \"\";\n      } else {\n        value = +value;\n\n        // Perform the initial formatting.\n        var valueNegative = value < 0;\n        value = formatType(Math.abs(value), precision);\n\n        // Trim insignificant zeros.\n        if (trim) value = formatTrim(value);\n\n        // If a negative value rounds to zero during formatting, treat as positive.\n        if (valueNegative && +value === 0) valueNegative = false;\n\n        // Compute the prefix and suffix.\n        valuePrefix = (valueNegative ? (sign === \"(\" ? sign : \"-\") : sign === \"-\" || sign === \"(\" ? \"\" : sign) + valuePrefix;\n        valueSuffix = (type === \"s\" ? prefixes[8 + prefixExponent / 3] : \"\") + valueSuffix + (valueNegative && sign === \"(\" ? \")\" : \"\");\n\n        // Break the formatted value into the integer value part that can be\n        // grouped, and fractional or exponential suffix part that is not.\n        if (maybeSuffix) {\n          i = -1, n = value.length;\n          while (++i < n) {\n            if (c = value.charCodeAt(i), 48 > c || c > 57) {\n              valueSuffix = (c === 46 ? decimal + value.slice(i + 1) : value.slice(i)) + valueSuffix;\n              value = value.slice(0, i);\n              break;\n            }\n          }\n        }\n      }\n\n      // If the fill character is not \"0\", grouping is applied before padding.\n      if (comma && !zero) value = group(value, Infinity);\n\n      // Compute the padding.\n      var length = valuePrefix.length + value.length + valueSuffix.length,\n          padding = length < width ? new Array(width - length + 1).join(fill) : \"\";\n\n      // If the fill character is \"0\", grouping is applied after padding.\n      if (comma && zero) value = group(padding + value, padding.length ? width - valueSuffix.length : Infinity), padding = \"\";\n\n      // Reconstruct the final output based on the desired alignment.\n      switch (align) {\n        case \"<\": value = valuePrefix + value + valueSuffix + padding; break;\n        case \"=\": value = valuePrefix + padding + value + valueSuffix; break;\n        case \"^\": value = padding.slice(0, length = padding.length >> 1) + valuePrefix + value + valueSuffix + padding.slice(length); break;\n        default: value = padding + valuePrefix + value + valueSuffix; break;\n      }\n\n      return numerals(value);\n    }\n\n    format.toString = function() {\n      return specifier + \"\";\n    };\n\n    return format;\n  }\n\n  function formatPrefix(specifier, value) {\n    var f = newFormat((specifier = formatSpecifier(specifier), specifier.type = \"f\", specifier)),\n        e = Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3,\n        k = Math.pow(10, -e),\n        prefix = prefixes[8 + e / 3];\n    return function(value) {\n      return f(k * value) + prefix;\n    };\n  }\n\n  return {\n    format: newFormat,\n    formatPrefix: formatPrefix\n  };\n}\n","export default function(grouping, thousands) {\n  return function(value, width) {\n    var i = value.length,\n        t = [],\n        j = 0,\n        g = grouping[0],\n        length = 0;\n\n    while (i > 0 && g > 0) {\n      if (length + g + 1 > width) g = Math.max(1, width - length);\n      t.push(value.substring(i -= g, i + g));\n      if ((length += g + 1) > width) break;\n      g = grouping[j = (j + 1) % grouping.length];\n    }\n\n    return t.reverse().join(thousands);\n  };\n}\n","export default function(numerals) {\n  return function(value) {\n    return value.replace(/[0-9]/g, function(i) {\n      return numerals[+i];\n    });\n  };\n}\n","import exponent from \"./exponent\";\n\nexport default function(step) {\n  return Math.max(0, -exponent(Math.abs(step)));\n}\n","export default function(a, b) {\n  return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","import ascending from \"./ascending\";\n\nexport default function(compare) {\n  if (compare.length === 1) compare = ascendingComparator(compare);\n  return {\n    left: function(a, x, lo, hi) {\n      if (lo == null) lo = 0;\n      if (hi == null) hi = a.length;\n      while (lo < hi) {\n        var mid = lo + hi >>> 1;\n        if (compare(a[mid], x) < 0) lo = mid + 1;\n        else hi = mid;\n      }\n      return lo;\n    },\n    right: function(a, x, lo, hi) {\n      if (lo == null) lo = 0;\n      if (hi == null) hi = a.length;\n      while (lo < hi) {\n        var mid = lo + hi >>> 1;\n        if (compare(a[mid], x) > 0) hi = mid;\n        else lo = mid + 1;\n      }\n      return lo;\n    }\n  };\n}\n\nfunction ascendingComparator(f) {\n  return function(d, x) {\n    return ascending(f(d), x);\n  };\n}\n","import ascending from \"./ascending\";\nimport bisector from \"./bisector\";\n\nvar ascendingBisect = bisector(ascending);\nexport var bisectRight = ascendingBisect.right;\nexport var bisectLeft = ascendingBisect.left;\nexport default bisectRight;\n","import {pair} from \"./pairs\";\n\nexport default function(values0, values1, reduce) {\n  var n0 = values0.length,\n      n1 = values1.length,\n      values = new Array(n0 * n1),\n      i0,\n      i1,\n      i,\n      value0;\n\n  if (reduce == null) reduce = pair;\n\n  for (i0 = i = 0; i0 < n0; ++i0) {\n    for (value0 = values0[i0], i1 = 0; i1 < n1; ++i1, ++i) {\n      values[i] = reduce(value0, values1[i1]);\n    }\n  }\n\n  return values;\n}\n","var array = Array.prototype;\n\nexport var slice = array.slice;\nexport var map = array.map;\n","var e10 = Math.sqrt(50),\n    e5 = Math.sqrt(10),\n    e2 = Math.sqrt(2);\n\nexport default function(start, stop, count) {\n  var reverse,\n      i = -1,\n      n,\n      ticks,\n      step;\n\n  stop = +stop, start = +start, count = +count;\n  if (start === stop && count > 0) return [start];\n  if (reverse = stop < start) n = start, start = stop, stop = n;\n  if ((step = tickIncrement(start, stop, count)) === 0 || !isFinite(step)) return [];\n\n  if (step > 0) {\n    start = Math.ceil(start / step);\n    stop = Math.floor(stop / step);\n    ticks = new Array(n = Math.ceil(stop - start + 1));\n    while (++i < n) ticks[i] = (start + i) * step;\n  } else {\n    start = Math.floor(start * step);\n    stop = Math.ceil(stop * step);\n    ticks = new Array(n = Math.ceil(start - stop + 1));\n    while (++i < n) ticks[i] = (start - i) / step;\n  }\n\n  if (reverse) ticks.reverse();\n\n  return ticks;\n}\n\nexport function tickIncrement(start, stop, count) {\n  var step = (stop - start) / Math.max(0, count),\n      power = Math.floor(Math.log(step) / Math.LN10),\n      error = step / Math.pow(10, power);\n  return power >= 0\n      ? (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1) * Math.pow(10, power)\n      : -Math.pow(10, -power) / (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1);\n}\n\nexport function tickStep(start, stop, count) {\n  var step0 = Math.abs(stop - start) / Math.max(0, count),\n      step1 = Math.pow(10, Math.floor(Math.log(step0) / Math.LN10)),\n      error = step0 / step1;\n  if (error >= e10) step1 *= 10;\n  else if (error >= e5) step1 *= 5;\n  else if (error >= e2) step1 *= 2;\n  return stop < start ? -step1 : step1;\n}\n","export function initRange(domain, range) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.range(domain); break;\n    default: this.range(range).domain(domain); break;\n  }\n  return this;\n}\n\nexport function initInterpolator(domain, interpolator) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.interpolator(domain); break;\n    default: this.interpolator(interpolator).domain(domain); break;\n  }\n  return this;\n}\n","export var prefix = \"$\";\n\nfunction Map() {}\n\nMap.prototype = map.prototype = {\n  constructor: Map,\n  has: function(key) {\n    return (prefix + key) in this;\n  },\n  get: function(key) {\n    return this[prefix + key];\n  },\n  set: function(key, value) {\n    this[prefix + key] = value;\n    return this;\n  },\n  remove: function(key) {\n    var property = prefix + key;\n    return property in this && delete this[property];\n  },\n  clear: function() {\n    for (var property in this) if (property[0] === prefix) delete this[property];\n  },\n  keys: function() {\n    var keys = [];\n    for (var property in this) if (property[0] === prefix) keys.push(property.slice(1));\n    return keys;\n  },\n  values: function() {\n    var values = [];\n    for (var property in this) if (property[0] === prefix) values.push(this[property]);\n    return values;\n  },\n  entries: function() {\n    var entries = [];\n    for (var property in this) if (property[0] === prefix) entries.push({key: property.slice(1), value: this[property]});\n    return entries;\n  },\n  size: function() {\n    var size = 0;\n    for (var property in this) if (property[0] === prefix) ++size;\n    return size;\n  },\n  empty: function() {\n    for (var property in this) if (property[0] === prefix) return false;\n    return true;\n  },\n  each: function(f) {\n    for (var property in this) if (property[0] === prefix) f(this[property], property.slice(1), this);\n  }\n};\n\nfunction map(object, f) {\n  var map = new Map;\n\n  // Copy constructor.\n  if (object instanceof Map) object.each(function(value, key) { map.set(key, value); });\n\n  // Index array by numeric index or specified key function.\n  else if (Array.isArray(object)) {\n    var i = -1,\n        n = object.length,\n        o;\n\n    if (f == null) while (++i < n) map.set(i, object[i]);\n    else while (++i < n) map.set(f(o = object[i], i, object), o);\n  }\n\n  // Convert object to map.\n  else if (object) for (var key in object) map.set(key, object[key]);\n\n  return map;\n}\n\nexport default map;\n","import {default as map, prefix} from \"./map\";\n\nfunction Set() {}\n\nvar proto = map.prototype;\n\nSet.prototype = set.prototype = {\n  constructor: Set,\n  has: proto.has,\n  add: function(value) {\n    value += \"\";\n    this[prefix + value] = value;\n    return this;\n  },\n  remove: proto.remove,\n  clear: proto.clear,\n  values: proto.keys,\n  size: proto.size,\n  empty: proto.empty,\n  each: proto.each\n};\n\nfunction set(object, f) {\n  var set = new Set;\n\n  // Copy constructor.\n  if (object instanceof Set) object.each(function(value) { set.add(value); });\n\n  // Otherwise, assume its an array.\n  else if (object) {\n    var i = -1, n = object.length;\n    if (f == null) while (++i < n) set.add(object[i]);\n    else while (++i < n) set.add(f(object[i], i, object));\n  }\n\n  return set;\n}\n\nexport default set;\n","var array = Array.prototype;\n\nexport var map = array.map;\nexport var slice = array.slice;\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","export default function(x) {\n  return +x;\n}\n","import {bisect} from \"d3-array\";\nimport {interpolate as interpolateValue, interpolateNumber, interpolateRound} from \"d3-interpolate\";\nimport {map, slice} from \"./array\";\nimport constant from \"./constant\";\nimport number from \"./number\";\n\nvar unit = [0, 1];\n\nexport function identity(x) {\n  return x;\n}\n\nfunction normalize(a, b) {\n  return (b -= (a = +a))\n      ? function(x) { return (x - a) / b; }\n      : constant(isNaN(b) ? NaN : 0.5);\n}\n\nfunction clamper(domain) {\n  var a = domain[0], b = domain[domain.length - 1], t;\n  if (a > b) t = a, a = b, b = t;\n  return function(x) { return Math.max(a, Math.min(b, x)); };\n}\n\n// normalize(a, b)(x) takes a domain value x in [a,b] and returns the corresponding parameter t in [0,1].\n// interpolate(a, b)(t) takes a parameter t in [0,1] and returns the corresponding range value x in [a,b].\nfunction bimap(domain, range, interpolate) {\n  var d0 = domain[0], d1 = domain[1], r0 = range[0], r1 = range[1];\n  if (d1 < d0) d0 = normalize(d1, d0), r0 = interpolate(r1, r0);\n  else d0 = normalize(d0, d1), r0 = interpolate(r0, r1);\n  return function(x) { return r0(d0(x)); };\n}\n\nfunction polymap(domain, range, interpolate) {\n  var j = Math.min(domain.length, range.length) - 1,\n      d = new Array(j),\n      r = new Array(j),\n      i = -1;\n\n  // Reverse descending domains.\n  if (domain[j] < domain[0]) {\n    domain = domain.slice().reverse();\n    range = range.slice().reverse();\n  }\n\n  while (++i < j) {\n    d[i] = normalize(domain[i], domain[i + 1]);\n    r[i] = interpolate(range[i], range[i + 1]);\n  }\n\n  return function(x) {\n    var i = bisect(domain, x, 1, j) - 1;\n    return r[i](d[i](x));\n  };\n}\n\nexport function copy(source, target) {\n  return target\n      .domain(source.domain())\n      .range(source.range())\n      .interpolate(source.interpolate())\n      .clamp(source.clamp())\n      .unknown(source.unknown());\n}\n\nexport function transformer() {\n  var domain = unit,\n      range = unit,\n      interpolate = interpolateValue,\n      transform,\n      untransform,\n      unknown,\n      clamp = identity,\n      piecewise,\n      output,\n      input;\n\n  function rescale() {\n    piecewise = Math.min(domain.length, range.length) > 2 ? polymap : bimap;\n    output = input = null;\n    return scale;\n  }\n\n  function scale(x) {\n    return isNaN(x = +x) ? unknown : (output || (output = piecewise(domain.map(transform), range, interpolate)))(transform(clamp(x)));\n  }\n\n  scale.invert = function(y) {\n    return clamp(untransform((input || (input = piecewise(range, domain.map(transform), interpolateNumber)))(y)));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain = map.call(_, number), clamp === identity || (clamp = clamper(domain)), rescale()) : domain.slice();\n  };\n\n  scale.range = function(_) {\n    return arguments.length ? (range = slice.call(_), rescale()) : range.slice();\n  };\n\n  scale.rangeRound = function(_) {\n    return range = slice.call(_), interpolate = interpolateRound, rescale();\n  };\n\n  scale.clamp = function(_) {\n    return arguments.length ? (clamp = _ ? clamper(domain) : identity, scale) : clamp !== identity;\n  };\n\n  scale.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, rescale()) : interpolate;\n  };\n\n  scale.unknown = function(_) {\n    return arguments.length ? (unknown = _, scale) : unknown;\n  };\n\n  return function(t, u) {\n    transform = t, untransform = u;\n    return rescale();\n  };\n}\n\nexport default function continuous(transform, untransform) {\n  return transformer()(transform, untransform);\n}\n","import {tickStep} from \"d3-array\";\nimport {format, formatPrefix, formatSpecifier, precisionFixed, precisionPrefix, precisionRound} from \"d3-format\";\n\nexport default function(start, stop, count, specifier) {\n  var step = tickStep(start, stop, count),\n      precision;\n  specifier = formatSpecifier(specifier == null ? \",f\" : specifier);\n  switch (specifier.type) {\n    case \"s\": {\n      var value = Math.max(Math.abs(start), Math.abs(stop));\n      if (specifier.precision == null && !isNaN(precision = precisionPrefix(step, value))) specifier.precision = precision;\n      return formatPrefix(specifier, value);\n    }\n    case \"\":\n    case \"e\":\n    case \"g\":\n    case \"p\":\n    case \"r\": {\n      if (specifier.precision == null && !isNaN(precision = precisionRound(step, Math.max(Math.abs(start), Math.abs(stop))))) specifier.precision = precision - (specifier.type === \"e\");\n      break;\n    }\n    case \"f\":\n    case \"%\": {\n      if (specifier.precision == null && !isNaN(precision = precisionFixed(step))) specifier.precision = precision - (specifier.type === \"%\") * 2;\n      break;\n    }\n  }\n  return format(specifier);\n}\n","import exponent from \"./exponent\";\n\nexport default function(step, value) {\n  return Math.max(0, Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3 - exponent(Math.abs(step)));\n}\n","import exponent from \"./exponent\";\n\nexport default function(step, max) {\n  step = Math.abs(step), max = Math.abs(max) - step;\n  return Math.max(0, exponent(max) - exponent(step)) + 1;\n}\n","import {ticks, tickIncrement} from \"d3-array\";\nimport continuous, {copy, identity} from \"./continuous\";\nimport {initRange} from \"./init\";\nimport tickFormat from \"./tickFormat\";\n\nexport function linearish(scale) {\n  var domain = scale.domain;\n\n  scale.ticks = function(count) {\n    var d = domain();\n    return ticks(d[0], d[d.length - 1], count == null ? 10 : count);\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    var d = domain();\n    return tickFormat(d[0], d[d.length - 1], count == null ? 10 : count, specifier);\n  };\n\n  scale.nice = function(count) {\n    if (count == null) count = 10;\n\n    var d = domain(),\n        i0 = 0,\n        i1 = d.length - 1,\n        start = d[i0],\n        stop = d[i1],\n        step;\n\n    if (stop < start) {\n      step = start, start = stop, stop = step;\n      step = i0, i0 = i1, i1 = step;\n    }\n\n    step = tickIncrement(start, stop, count);\n\n    if (step > 0) {\n      start = Math.floor(start / step) * step;\n      stop = Math.ceil(stop / step) * step;\n      step = tickIncrement(start, stop, count);\n    } else if (step < 0) {\n      start = Math.ceil(start * step) / step;\n      stop = Math.floor(stop * step) / step;\n      step = tickIncrement(start, stop, count);\n    }\n\n    if (step > 0) {\n      d[i0] = Math.floor(start / step) * step;\n      d[i1] = Math.ceil(stop / step) * step;\n      domain(d);\n    } else if (step < 0) {\n      d[i0] = Math.ceil(start * step) / step;\n      d[i1] = Math.floor(stop * step) / step;\n      domain(d);\n    }\n\n    return scale;\n  };\n\n  return scale;\n}\n\nexport default function linear() {\n  var scale = continuous(identity, identity);\n\n  scale.copy = function() {\n    return copy(scale, linear());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return linearish(scale);\n}\n","export default function(domain, interval) {\n  domain = domain.slice();\n\n  var i0 = 0,\n      i1 = domain.length - 1,\n      x0 = domain[i0],\n      x1 = domain[i1],\n      t;\n\n  if (x1 < x0) {\n    t = i0, i0 = i1, i1 = t;\n    t = x0, x0 = x1, x1 = t;\n  }\n\n  domain[i0] = interval.floor(x0);\n  domain[i1] = interval.ceil(x1);\n  return domain;\n}\n","import {ticks} from \"d3-array\";\nimport {format} from \"d3-format\";\nimport nice from \"./nice\";\nimport {copy, transformer} from \"./continuous\";\nimport {initRange} from \"./init\";\n\nfunction transformLog(x) {\n  return Math.log(x);\n}\n\nfunction transformExp(x) {\n  return Math.exp(x);\n}\n\nfunction transformLogn(x) {\n  return -Math.log(-x);\n}\n\nfunction transformExpn(x) {\n  return -Math.exp(-x);\n}\n\nfunction pow10(x) {\n  return isFinite(x) ? +(\"1e\" + x) : x < 0 ? 0 : x;\n}\n\nfunction powp(base) {\n  return base === 10 ? pow10\n      : base === Math.E ? Math.exp\n      : function(x) { return Math.pow(base, x); };\n}\n\nfunction logp(base) {\n  return base === Math.E ? Math.log\n      : base === 10 && Math.log10\n      || base === 2 && Math.log2\n      || (base = Math.log(base), function(x) { return Math.log(x) / base; });\n}\n\nfunction reflect(f) {\n  return function(x) {\n    return -f(-x);\n  };\n}\n\nexport function loggish(transform) {\n  var scale = transform(transformLog, transformExp),\n      domain = scale.domain,\n      base = 10,\n      logs,\n      pows;\n\n  function rescale() {\n    logs = logp(base), pows = powp(base);\n    if (domain()[0] < 0) {\n      logs = reflect(logs), pows = reflect(pows);\n      transform(transformLogn, transformExpn);\n    } else {\n      transform(transformLog, transformExp);\n    }\n    return scale;\n  }\n\n  scale.base = function(_) {\n    return arguments.length ? (base = +_, rescale()) : base;\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain(_), rescale()) : domain();\n  };\n\n  scale.ticks = function(count) {\n    var d = domain(),\n        u = d[0],\n        v = d[d.length - 1],\n        r;\n\n    if (r = v < u) i = u, u = v, v = i;\n\n    var i = logs(u),\n        j = logs(v),\n        p,\n        k,\n        t,\n        n = count == null ? 10 : +count,\n        z = [];\n\n    if (!(base % 1) && j - i < n) {\n      i = Math.round(i) - 1, j = Math.round(j) + 1;\n      if (u > 0) for (; i < j; ++i) {\n        for (k = 1, p = pows(i); k < base; ++k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      } else for (; i < j; ++i) {\n        for (k = base - 1, p = pows(i); k >= 1; --k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      }\n    } else {\n      z = ticks(i, j, Math.min(j - i, n)).map(pows);\n    }\n\n    return r ? z.reverse() : z;\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    if (specifier == null) specifier = base === 10 ? \".0e\" : \",\";\n    if (typeof specifier !== \"function\") specifier = format(specifier);\n    if (count === Infinity) return specifier;\n    if (count == null) count = 10;\n    var k = Math.max(1, base * count / scale.ticks().length); // TODO fast estimate?\n    return function(d) {\n      var i = d / pows(Math.round(logs(d)));\n      if (i * base < base - 0.5) i *= base;\n      return i <= k ? specifier(d) : \"\";\n    };\n  };\n\n  scale.nice = function() {\n    return domain(nice(domain(), {\n      floor: function(x) { return pows(Math.floor(logs(x))); },\n      ceil: function(x) { return pows(Math.ceil(logs(x))); }\n    }));\n  };\n\n  return scale;\n}\n\nexport default function log() {\n  var scale = loggish(transformer()).domain([1, 10]);\n\n  scale.copy = function() {\n    return copy(scale, log()).base(scale.base());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n","import {linearish} from \"./linear\";\nimport {copy, identity, transformer} from \"./continuous\";\nimport {initRange} from \"./init\";\n\nfunction transformPow(exponent) {\n  return function(x) {\n    return x < 0 ? -Math.pow(-x, exponent) : Math.pow(x, exponent);\n  };\n}\n\nfunction transformSqrt(x) {\n  return x < 0 ? -Math.sqrt(-x) : Math.sqrt(x);\n}\n\nfunction transformSquare(x) {\n  return x < 0 ? -x * x : x * x;\n}\n\nexport function powish(transform) {\n  var scale = transform(identity, identity),\n      exponent = 1;\n\n  function rescale() {\n    return exponent === 1 ? transform(identity, identity)\n        : exponent === 0.5 ? transform(transformSqrt, transformSquare)\n        : transform(transformPow(exponent), transformPow(1 / exponent));\n  }\n\n  scale.exponent = function(_) {\n    return arguments.length ? (exponent = +_, rescale()) : exponent;\n  };\n\n  return linearish(scale);\n}\n\nexport default function pow() {\n  var scale = powish(transformer());\n\n  scale.copy = function() {\n    return copy(scale, pow()).exponent(scale.exponent());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n\nexport function sqrt() {\n  return pow.apply(null, arguments).exponent(0.5);\n}\n","var t0 = new Date,\n    t1 = new Date;\n\nexport default function newInterval(floori, offseti, count, field) {\n\n  function interval(date) {\n    return floori(date = new Date(+date)), date;\n  }\n\n  interval.floor = interval;\n\n  interval.ceil = function(date) {\n    return floori(date = new Date(date - 1)), offseti(date, 1), floori(date), date;\n  };\n\n  interval.round = function(date) {\n    var d0 = interval(date),\n        d1 = interval.ceil(date);\n    return date - d0 < d1 - date ? d0 : d1;\n  };\n\n  interval.offset = function(date, step) {\n    return offseti(date = new Date(+date), step == null ? 1 : Math.floor(step)), date;\n  };\n\n  interval.range = function(start, stop, step) {\n    var range = [], previous;\n    start = interval.ceil(start);\n    step = step == null ? 1 : Math.floor(step);\n    if (!(start < stop) || !(step > 0)) return range; // also handles Invalid Date\n    do range.push(previous = new Date(+start)), offseti(start, step), floori(start);\n    while (previous < start && start < stop);\n    return range;\n  };\n\n  interval.filter = function(test) {\n    return newInterval(function(date) {\n      if (date >= date) while (floori(date), !test(date)) date.setTime(date - 1);\n    }, function(date, step) {\n      if (date >= date) {\n        if (step < 0) while (++step <= 0) {\n          while (offseti(date, -1), !test(date)) {} // eslint-disable-line no-empty\n        } else while (--step >= 0) {\n          while (offseti(date, +1), !test(date)) {} // eslint-disable-line no-empty\n        }\n      }\n    });\n  };\n\n  if (count) {\n    interval.count = function(start, end) {\n      t0.setTime(+start), t1.setTime(+end);\n      floori(t0), floori(t1);\n      return Math.floor(count(t0, t1));\n    };\n\n    interval.every = function(step) {\n      step = Math.floor(step);\n      return !isFinite(step) || !(step > 0) ? null\n          : !(step > 1) ? interval\n          : interval.filter(field\n              ? function(d) { return field(d) % step === 0; }\n              : function(d) { return interval.count(0, d) % step === 0; });\n    };\n  }\n\n  return interval;\n}\n","import interval from \"./interval\";\n\nvar millisecond = interval(function() {\n  // noop\n}, function(date, step) {\n  date.setTime(+date + step);\n}, function(start, end) {\n  return end - start;\n});\n\n// An optimized implementation for this simple case.\nmillisecond.every = function(k) {\n  k = Math.floor(k);\n  if (!isFinite(k) || !(k > 0)) return null;\n  if (!(k > 1)) return millisecond;\n  return interval(function(date) {\n    date.setTime(Math.floor(date / k) * k);\n  }, function(date, step) {\n    date.setTime(+date + step * k);\n  }, function(start, end) {\n    return (end - start) / k;\n  });\n};\n\nexport default millisecond;\nexport var milliseconds = millisecond.range;\n","import interval from \"./interval\";\nimport {durationSecond} from \"./duration\";\n\nvar second = interval(function(date) {\n  date.setTime(date - date.getMilliseconds());\n}, function(date, step) {\n  date.setTime(+date + step * durationSecond);\n}, function(start, end) {\n  return (end - start) / durationSecond;\n}, function(date) {\n  return date.getUTCSeconds();\n});\n\nexport default second;\nexport var seconds = second.range;\n","export var durationSecond = 1e3;\nexport var durationMinute = 6e4;\nexport var durationHour = 36e5;\nexport var durationDay = 864e5;\nexport var durationWeek = 6048e5;\n","import interval from \"./interval\";\nimport {durationMinute, durationSecond} from \"./duration\";\n\nvar minute = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond);\n}, function(date, step) {\n  date.setTime(+date + step * durationMinute);\n}, function(start, end) {\n  return (end - start) / durationMinute;\n}, function(date) {\n  return date.getMinutes();\n});\n\nexport default minute;\nexport var minutes = minute.range;\n","import interval from \"./interval\";\nimport {durationHour, durationMinute, durationSecond} from \"./duration\";\n\nvar hour = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond - date.getMinutes() * durationMinute);\n}, function(date, step) {\n  date.setTime(+date + step * durationHour);\n}, function(start, end) {\n  return (end - start) / durationHour;\n}, function(date) {\n  return date.getHours();\n});\n\nexport default hour;\nexport var hours = hour.range;\n","import interval from \"./interval\";\nimport {durationDay, durationMinute} from \"./duration\";\n\nvar day = interval(function(date) {\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setDate(date.getDate() + step);\n}, function(start, end) {\n  return (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationDay;\n}, function(date) {\n  return date.getDate() - 1;\n});\n\nexport default day;\nexport var days = day.range;\n","import interval from \"./interval\";\nimport {durationMinute, durationWeek} from \"./duration\";\n\nfunction weekday(i) {\n  return interval(function(date) {\n    date.setDate(date.getDate() - (date.getDay() + 7 - i) % 7);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setDate(date.getDate() + step * 7);\n  }, function(start, end) {\n    return (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationWeek;\n  });\n}\n\nexport var sunday = weekday(0);\nexport var monday = weekday(1);\nexport var tuesday = weekday(2);\nexport var wednesday = weekday(3);\nexport var thursday = weekday(4);\nexport var friday = weekday(5);\nexport var saturday = weekday(6);\n\nexport var sundays = sunday.range;\nexport var mondays = monday.range;\nexport var tuesdays = tuesday.range;\nexport var wednesdays = wednesday.range;\nexport var thursdays = thursday.range;\nexport var fridays = friday.range;\nexport var saturdays = saturday.range;\n","import interval from \"./interval\";\n\nvar month = interval(function(date) {\n  date.setDate(1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setMonth(date.getMonth() + step);\n}, function(start, end) {\n  return end.getMonth() - start.getMonth() + (end.getFullYear() - start.getFullYear()) * 12;\n}, function(date) {\n  return date.getMonth();\n});\n\nexport default month;\nexport var months = month.range;\n","import interval from \"./interval\";\n\nvar year = interval(function(date) {\n  date.setMonth(0, 1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setFullYear(date.getFullYear() + step);\n}, function(start, end) {\n  return end.getFullYear() - start.getFullYear();\n}, function(date) {\n  return date.getFullYear();\n});\n\n// An optimized implementation for this simple case.\nyear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setFullYear(Math.floor(date.getFullYear() / k) * k);\n    date.setMonth(0, 1);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setFullYear(date.getFullYear() + step * k);\n  });\n};\n\nexport default year;\nexport var years = year.range;\n","import interval from \"./interval\";\nimport {durationMinute} from \"./duration\";\n\nvar utcMinute = interval(function(date) {\n  date.setUTCSeconds(0, 0);\n}, function(date, step) {\n  date.setTime(+date + step * durationMinute);\n}, function(start, end) {\n  return (end - start) / durationMinute;\n}, function(date) {\n  return date.getUTCMinutes();\n});\n\nexport default utcMinute;\nexport var utcMinutes = utcMinute.range;\n","import interval from \"./interval\";\nimport {durationHour} from \"./duration\";\n\nvar utcHour = interval(function(date) {\n  date.setUTCMinutes(0, 0, 0);\n}, function(date, step) {\n  date.setTime(+date + step * durationHour);\n}, function(start, end) {\n  return (end - start) / durationHour;\n}, function(date) {\n  return date.getUTCHours();\n});\n\nexport default utcHour;\nexport var utcHours = utcHour.range;\n","import interval from \"./interval\";\nimport {durationDay} from \"./duration\";\n\nvar utcDay = interval(function(date) {\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCDate(date.getUTCDate() + step);\n}, function(start, end) {\n  return (end - start) / durationDay;\n}, function(date) {\n  return date.getUTCDate() - 1;\n});\n\nexport default utcDay;\nexport var utcDays = utcDay.range;\n","import interval from \"./interval\";\nimport {durationWeek} from \"./duration\";\n\nfunction utcWeekday(i) {\n  return interval(function(date) {\n    date.setUTCDate(date.getUTCDate() - (date.getUTCDay() + 7 - i) % 7);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCDate(date.getUTCDate() + step * 7);\n  }, function(start, end) {\n    return (end - start) / durationWeek;\n  });\n}\n\nexport var utcSunday = utcWeekday(0);\nexport var utcMonday = utcWeekday(1);\nexport var utcTuesday = utcWeekday(2);\nexport var utcWednesday = utcWeekday(3);\nexport var utcThursday = utcWeekday(4);\nexport var utcFriday = utcWeekday(5);\nexport var utcSaturday = utcWeekday(6);\n\nexport var utcSundays = utcSunday.range;\nexport var utcMondays = utcMonday.range;\nexport var utcTuesdays = utcTuesday.range;\nexport var utcWednesdays = utcWednesday.range;\nexport var utcThursdays = utcThursday.range;\nexport var utcFridays = utcFriday.range;\nexport var utcSaturdays = utcSaturday.range;\n","import interval from \"./interval\";\n\nvar utcMonth = interval(function(date) {\n  date.setUTCDate(1);\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCMonth(date.getUTCMonth() + step);\n}, function(start, end) {\n  return end.getUTCMonth() - start.getUTCMonth() + (end.getUTCFullYear() - start.getUTCFullYear()) * 12;\n}, function(date) {\n  return date.getUTCMonth();\n});\n\nexport default utcMonth;\nexport var utcMonths = utcMonth.range;\n","import interval from \"./interval\";\n\nvar utcYear = interval(function(date) {\n  date.setUTCMonth(0, 1);\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCFullYear(date.getUTCFullYear() + step);\n}, function(start, end) {\n  return end.getUTCFullYear() - start.getUTCFullYear();\n}, function(date) {\n  return date.getUTCFullYear();\n});\n\n// An optimized implementation for this simple case.\nutcYear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setUTCFullYear(Math.floor(date.getUTCFullYear() / k) * k);\n    date.setUTCMonth(0, 1);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCFullYear(date.getUTCFullYear() + step * k);\n  });\n};\n\nexport default utcYear;\nexport var utcYears = utcYear.range;\n","import {\n  timeDay,\n  timeSunday,\n  timeMonday,\n  timeThursday,\n  timeYear,\n  utcDay,\n  utcSunday,\n  utcMonday,\n  utcThursday,\n  utcYear\n} from \"d3-time\";\n\nfunction localDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(-1, d.m, d.d, d.H, d.M, d.S, d.L);\n    date.setFullYear(d.y);\n    return date;\n  }\n  return new Date(d.y, d.m, d.d, d.H, d.M, d.S, d.L);\n}\n\nfunction utcDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(Date.UTC(-1, d.m, d.d, d.H, d.M, d.S, d.L));\n    date.setUTCFullYear(d.y);\n    return date;\n  }\n  return new Date(Date.UTC(d.y, d.m, d.d, d.H, d.M, d.S, d.L));\n}\n\nfunction newYear(y) {\n  return {y: y, m: 0, d: 1, H: 0, M: 0, S: 0, L: 0};\n}\n\nexport default function formatLocale(locale) {\n  var locale_dateTime = locale.dateTime,\n      locale_date = locale.date,\n      locale_time = locale.time,\n      locale_periods = locale.periods,\n      locale_weekdays = locale.days,\n      locale_shortWeekdays = locale.shortDays,\n      locale_months = locale.months,\n      locale_shortMonths = locale.shortMonths;\n\n  var periodRe = formatRe(locale_periods),\n      periodLookup = formatLookup(locale_periods),\n      weekdayRe = formatRe(locale_weekdays),\n      weekdayLookup = formatLookup(locale_weekdays),\n      shortWeekdayRe = formatRe(locale_shortWeekdays),\n      shortWeekdayLookup = formatLookup(locale_shortWeekdays),\n      monthRe = formatRe(locale_months),\n      monthLookup = formatLookup(locale_months),\n      shortMonthRe = formatRe(locale_shortMonths),\n      shortMonthLookup = formatLookup(locale_shortMonths);\n\n  var formats = {\n    \"a\": formatShortWeekday,\n    \"A\": formatWeekday,\n    \"b\": formatShortMonth,\n    \"B\": formatMonth,\n    \"c\": null,\n    \"d\": formatDayOfMonth,\n    \"e\": formatDayOfMonth,\n    \"f\": formatMicroseconds,\n    \"H\": formatHour24,\n    \"I\": formatHour12,\n    \"j\": formatDayOfYear,\n    \"L\": formatMilliseconds,\n    \"m\": formatMonthNumber,\n    \"M\": formatMinutes,\n    \"p\": formatPeriod,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatSeconds,\n    \"u\": formatWeekdayNumberMonday,\n    \"U\": formatWeekNumberSunday,\n    \"V\": formatWeekNumberISO,\n    \"w\": formatWeekdayNumberSunday,\n    \"W\": formatWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatYear,\n    \"Y\": formatFullYear,\n    \"Z\": formatZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var utcFormats = {\n    \"a\": formatUTCShortWeekday,\n    \"A\": formatUTCWeekday,\n    \"b\": formatUTCShortMonth,\n    \"B\": formatUTCMonth,\n    \"c\": null,\n    \"d\": formatUTCDayOfMonth,\n    \"e\": formatUTCDayOfMonth,\n    \"f\": formatUTCMicroseconds,\n    \"H\": formatUTCHour24,\n    \"I\": formatUTCHour12,\n    \"j\": formatUTCDayOfYear,\n    \"L\": formatUTCMilliseconds,\n    \"m\": formatUTCMonthNumber,\n    \"M\": formatUTCMinutes,\n    \"p\": formatUTCPeriod,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatUTCSeconds,\n    \"u\": formatUTCWeekdayNumberMonday,\n    \"U\": formatUTCWeekNumberSunday,\n    \"V\": formatUTCWeekNumberISO,\n    \"w\": formatUTCWeekdayNumberSunday,\n    \"W\": formatUTCWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatUTCYear,\n    \"Y\": formatUTCFullYear,\n    \"Z\": formatUTCZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var parses = {\n    \"a\": parseShortWeekday,\n    \"A\": parseWeekday,\n    \"b\": parseShortMonth,\n    \"B\": parseMonth,\n    \"c\": parseLocaleDateTime,\n    \"d\": parseDayOfMonth,\n    \"e\": parseDayOfMonth,\n    \"f\": parseMicroseconds,\n    \"H\": parseHour24,\n    \"I\": parseHour24,\n    \"j\": parseDayOfYear,\n    \"L\": parseMilliseconds,\n    \"m\": parseMonthNumber,\n    \"M\": parseMinutes,\n    \"p\": parsePeriod,\n    \"Q\": parseUnixTimestamp,\n    \"s\": parseUnixTimestampSeconds,\n    \"S\": parseSeconds,\n    \"u\": parseWeekdayNumberMonday,\n    \"U\": parseWeekNumberSunday,\n    \"V\": parseWeekNumberISO,\n    \"w\": parseWeekdayNumberSunday,\n    \"W\": parseWeekNumberMonday,\n    \"x\": parseLocaleDate,\n    \"X\": parseLocaleTime,\n    \"y\": parseYear,\n    \"Y\": parseFullYear,\n    \"Z\": parseZone,\n    \"%\": parseLiteralPercent\n  };\n\n  // These recursive directive definitions must be deferred.\n  formats.x = newFormat(locale_date, formats);\n  formats.X = newFormat(locale_time, formats);\n  formats.c = newFormat(locale_dateTime, formats);\n  utcFormats.x = newFormat(locale_date, utcFormats);\n  utcFormats.X = newFormat(locale_time, utcFormats);\n  utcFormats.c = newFormat(locale_dateTime, utcFormats);\n\n  function newFormat(specifier, formats) {\n    return function(date) {\n      var string = [],\n          i = -1,\n          j = 0,\n          n = specifier.length,\n          c,\n          pad,\n          format;\n\n      if (!(date instanceof Date)) date = new Date(+date);\n\n      while (++i < n) {\n        if (specifier.charCodeAt(i) === 37) {\n          string.push(specifier.slice(j, i));\n          if ((pad = pads[c = specifier.charAt(++i)]) != null) c = specifier.charAt(++i);\n          else pad = c === \"e\" ? \" \" : \"0\";\n          if (format = formats[c]) c = format(date, pad);\n          string.push(c);\n          j = i + 1;\n        }\n      }\n\n      string.push(specifier.slice(j, i));\n      return string.join(\"\");\n    };\n  }\n\n  function newParse(specifier, newDate) {\n    return function(string) {\n      var d = newYear(1900),\n          i = parseSpecifier(d, specifier, string += \"\", 0),\n          week, day;\n      if (i != string.length) return null;\n\n      // If a UNIX timestamp is specified, return it.\n      if (\"Q\" in d) return new Date(d.Q);\n\n      // The am-pm flag is 0 for AM, and 1 for PM.\n      if (\"p\" in d) d.H = d.H % 12 + d.p * 12;\n\n      // Convert day-of-week and week-of-year to day-of-year.\n      if (\"V\" in d) {\n        if (d.V < 1 || d.V > 53) return null;\n        if (!(\"w\" in d)) d.w = 1;\n        if (\"Z\" in d) {\n          week = utcDate(newYear(d.y)), day = week.getUTCDay();\n          week = day > 4 || day === 0 ? utcMonday.ceil(week) : utcMonday(week);\n          week = utcDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getUTCFullYear();\n          d.m = week.getUTCMonth();\n          d.d = week.getUTCDate() + (d.w + 6) % 7;\n        } else {\n          week = newDate(newYear(d.y)), day = week.getDay();\n          week = day > 4 || day === 0 ? timeMonday.ceil(week) : timeMonday(week);\n          week = timeDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getFullYear();\n          d.m = week.getMonth();\n          d.d = week.getDate() + (d.w + 6) % 7;\n        }\n      } else if (\"W\" in d || \"U\" in d) {\n        if (!(\"w\" in d)) d.w = \"u\" in d ? d.u % 7 : \"W\" in d ? 1 : 0;\n        day = \"Z\" in d ? utcDate(newYear(d.y)).getUTCDay() : newDate(newYear(d.y)).getDay();\n        d.m = 0;\n        d.d = \"W\" in d ? (d.w + 6) % 7 + d.W * 7 - (day + 5) % 7 : d.w + d.U * 7 - (day + 6) % 7;\n      }\n\n      // If a time zone is specified, all fields are interpreted as UTC and then\n      // offset according to the specified time zone.\n      if (\"Z\" in d) {\n        d.H += d.Z / 100 | 0;\n        d.M += d.Z % 100;\n        return utcDate(d);\n      }\n\n      // Otherwise, all fields are in local time.\n      return newDate(d);\n    };\n  }\n\n  function parseSpecifier(d, specifier, string, j) {\n    var i = 0,\n        n = specifier.length,\n        m = string.length,\n        c,\n        parse;\n\n    while (i < n) {\n      if (j >= m) return -1;\n      c = specifier.charCodeAt(i++);\n      if (c === 37) {\n        c = specifier.charAt(i++);\n        parse = parses[c in pads ? specifier.charAt(i++) : c];\n        if (!parse || ((j = parse(d, string, j)) < 0)) return -1;\n      } else if (c != string.charCodeAt(j++)) {\n        return -1;\n      }\n    }\n\n    return j;\n  }\n\n  function parsePeriod(d, string, i) {\n    var n = periodRe.exec(string.slice(i));\n    return n ? (d.p = periodLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseShortWeekday(d, string, i) {\n    var n = shortWeekdayRe.exec(string.slice(i));\n    return n ? (d.w = shortWeekdayLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseWeekday(d, string, i) {\n    var n = weekdayRe.exec(string.slice(i));\n    return n ? (d.w = weekdayLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseShortMonth(d, string, i) {\n    var n = shortMonthRe.exec(string.slice(i));\n    return n ? (d.m = shortMonthLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseMonth(d, string, i) {\n    var n = monthRe.exec(string.slice(i));\n    return n ? (d.m = monthLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseLocaleDateTime(d, string, i) {\n    return parseSpecifier(d, locale_dateTime, string, i);\n  }\n\n  function parseLocaleDate(d, string, i) {\n    return parseSpecifier(d, locale_date, string, i);\n  }\n\n  function parseLocaleTime(d, string, i) {\n    return parseSpecifier(d, locale_time, string, i);\n  }\n\n  function formatShortWeekday(d) {\n    return locale_shortWeekdays[d.getDay()];\n  }\n\n  function formatWeekday(d) {\n    return locale_weekdays[d.getDay()];\n  }\n\n  function formatShortMonth(d) {\n    return locale_shortMonths[d.getMonth()];\n  }\n\n  function formatMonth(d) {\n    return locale_months[d.getMonth()];\n  }\n\n  function formatPeriod(d) {\n    return locale_periods[+(d.getHours() >= 12)];\n  }\n\n  function formatUTCShortWeekday(d) {\n    return locale_shortWeekdays[d.getUTCDay()];\n  }\n\n  function formatUTCWeekday(d) {\n    return locale_weekdays[d.getUTCDay()];\n  }\n\n  function formatUTCShortMonth(d) {\n    return locale_shortMonths[d.getUTCMonth()];\n  }\n\n  function formatUTCMonth(d) {\n    return locale_months[d.getUTCMonth()];\n  }\n\n  function formatUTCPeriod(d) {\n    return locale_periods[+(d.getUTCHours() >= 12)];\n  }\n\n  return {\n    format: function(specifier) {\n      var f = newFormat(specifier += \"\", formats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    parse: function(specifier) {\n      var p = newParse(specifier += \"\", localDate);\n      p.toString = function() { return specifier; };\n      return p;\n    },\n    utcFormat: function(specifier) {\n      var f = newFormat(specifier += \"\", utcFormats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    utcParse: function(specifier) {\n      var p = newParse(specifier, utcDate);\n      p.toString = function() { return specifier; };\n      return p;\n    }\n  };\n}\n\nvar pads = {\"-\": \"\", \"_\": \" \", \"0\": \"0\"},\n    numberRe = /^\\s*\\d+/, // note: ignores next directive\n    percentRe = /^%/,\n    requoteRe = /[\\\\^$*+?|[\\]().{}]/g;\n\nfunction pad(value, fill, width) {\n  var sign = value < 0 ? \"-\" : \"\",\n      string = (sign ? -value : value) + \"\",\n      length = string.length;\n  return sign + (length < width ? new Array(width - length + 1).join(fill) + string : string);\n}\n\nfunction requote(s) {\n  return s.replace(requoteRe, \"\\\\$&\");\n}\n\nfunction formatRe(names) {\n  return new RegExp(\"^(?:\" + names.map(requote).join(\"|\") + \")\", \"i\");\n}\n\nfunction formatLookup(names) {\n  var map = {}, i = -1, n = names.length;\n  while (++i < n) map[names[i].toLowerCase()] = i;\n  return map;\n}\n\nfunction parseWeekdayNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.w = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekdayNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.u = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.U = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberISO(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.V = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.W = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseFullYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 4));\n  return n ? (d.y = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.y = +n[0] + (+n[0] > 68 ? 1900 : 2000), i + n[0].length) : -1;\n}\n\nfunction parseZone(d, string, i) {\n  var n = /^(Z)|([+-]\\d\\d)(?::?(\\d\\d))?/.exec(string.slice(i, i + 6));\n  return n ? (d.Z = n[1] ? 0 : -(n[2] + (n[3] || \"00\")), i + n[0].length) : -1;\n}\n\nfunction parseMonthNumber(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.m = n[0] - 1, i + n[0].length) : -1;\n}\n\nfunction parseDayOfMonth(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseDayOfYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.m = 0, d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseHour24(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.H = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMinutes(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.M = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.S = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMilliseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.L = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMicroseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 6));\n  return n ? (d.L = Math.floor(n[0] / 1000), i + n[0].length) : -1;\n}\n\nfunction parseLiteralPercent(d, string, i) {\n  var n = percentRe.exec(string.slice(i, i + 1));\n  return n ? i + n[0].length : -1;\n}\n\nfunction parseUnixTimestamp(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.Q = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseUnixTimestampSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.Q = (+n[0]) * 1000, i + n[0].length) : -1;\n}\n\nfunction formatDayOfMonth(d, p) {\n  return pad(d.getDate(), p, 2);\n}\n\nfunction formatHour24(d, p) {\n  return pad(d.getHours(), p, 2);\n}\n\nfunction formatHour12(d, p) {\n  return pad(d.getHours() % 12 || 12, p, 2);\n}\n\nfunction formatDayOfYear(d, p) {\n  return pad(1 + timeDay.count(timeYear(d), d), p, 3);\n}\n\nfunction formatMilliseconds(d, p) {\n  return pad(d.getMilliseconds(), p, 3);\n}\n\nfunction formatMicroseconds(d, p) {\n  return formatMilliseconds(d, p) + \"000\";\n}\n\nfunction formatMonthNumber(d, p) {\n  return pad(d.getMonth() + 1, p, 2);\n}\n\nfunction formatMinutes(d, p) {\n  return pad(d.getMinutes(), p, 2);\n}\n\nfunction formatSeconds(d, p) {\n  return pad(d.getSeconds(), p, 2);\n}\n\nfunction formatWeekdayNumberMonday(d) {\n  var day = d.getDay();\n  return day === 0 ? 7 : day;\n}\n\nfunction formatWeekNumberSunday(d, p) {\n  return pad(timeSunday.count(timeYear(d), d), p, 2);\n}\n\nfunction formatWeekNumberISO(d, p) {\n  var day = d.getDay();\n  d = (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n  return pad(timeThursday.count(timeYear(d), d) + (timeYear(d).getDay() === 4), p, 2);\n}\n\nfunction formatWeekdayNumberSunday(d) {\n  return d.getDay();\n}\n\nfunction formatWeekNumberMonday(d, p) {\n  return pad(timeMonday.count(timeYear(d), d), p, 2);\n}\n\nfunction formatYear(d, p) {\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatFullYear(d, p) {\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatZone(d) {\n  var z = d.getTimezoneOffset();\n  return (z > 0 ? \"-\" : (z *= -1, \"+\"))\n      + pad(z / 60 | 0, \"0\", 2)\n      + pad(z % 60, \"0\", 2);\n}\n\nfunction formatUTCDayOfMonth(d, p) {\n  return pad(d.getUTCDate(), p, 2);\n}\n\nfunction formatUTCHour24(d, p) {\n  return pad(d.getUTCHours(), p, 2);\n}\n\nfunction formatUTCHour12(d, p) {\n  return pad(d.getUTCHours() % 12 || 12, p, 2);\n}\n\nfunction formatUTCDayOfYear(d, p) {\n  return pad(1 + utcDay.count(utcYear(d), d), p, 3);\n}\n\nfunction formatUTCMilliseconds(d, p) {\n  return pad(d.getUTCMilliseconds(), p, 3);\n}\n\nfunction formatUTCMicroseconds(d, p) {\n  return formatUTCMilliseconds(d, p) + \"000\";\n}\n\nfunction formatUTCMonthNumber(d, p) {\n  return pad(d.getUTCMonth() + 1, p, 2);\n}\n\nfunction formatUTCMinutes(d, p) {\n  return pad(d.getUTCMinutes(), p, 2);\n}\n\nfunction formatUTCSeconds(d, p) {\n  return pad(d.getUTCSeconds(), p, 2);\n}\n\nfunction formatUTCWeekdayNumberMonday(d) {\n  var dow = d.getUTCDay();\n  return dow === 0 ? 7 : dow;\n}\n\nfunction formatUTCWeekNumberSunday(d, p) {\n  return pad(utcSunday.count(utcYear(d), d), p, 2);\n}\n\nfunction formatUTCWeekNumberISO(d, p) {\n  var day = d.getUTCDay();\n  d = (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n  return pad(utcThursday.count(utcYear(d), d) + (utcYear(d).getUTCDay() === 4), p, 2);\n}\n\nfunction formatUTCWeekdayNumberSunday(d) {\n  return d.getUTCDay();\n}\n\nfunction formatUTCWeekNumberMonday(d, p) {\n  return pad(utcMonday.count(utcYear(d), d), p, 2);\n}\n\nfunction formatUTCYear(d, p) {\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCFullYear(d, p) {\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCZone() {\n  return \"+0000\";\n}\n\nfunction formatLiteralPercent() {\n  return \"%\";\n}\n\nfunction formatUnixTimestamp(d) {\n  return +d;\n}\n\nfunction formatUnixTimestampSeconds(d) {\n  return Math.floor(+d / 1000);\n}\n","import formatLocale from \"./locale\";\n\nvar locale;\nexport var timeFormat;\nexport var timeParse;\nexport var utcFormat;\nexport var utcParse;\n\ndefaultLocale({\n  dateTime: \"%x, %X\",\n  date: \"%-m/%-d/%Y\",\n  time: \"%-I:%M:%S %p\",\n  periods: [\"AM\", \"PM\"],\n  days: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n  shortDays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n  months: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n  shortMonths: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  timeFormat = locale.format;\n  timeParse = locale.parse;\n  utcFormat = locale.utcFormat;\n  utcParse = locale.utcParse;\n  return locale;\n}\n","import {utcFormat} from \"./defaultLocale\";\n\nexport var isoSpecifier = \"%Y-%m-%dT%H:%M:%S.%LZ\";\n\nfunction formatIsoNative(date) {\n  return date.toISOString();\n}\n\nvar formatIso = Date.prototype.toISOString\n    ? formatIsoNative\n    : utcFormat(isoSpecifier);\n\nexport default formatIso;\n","import {isoSpecifier} from \"./isoFormat\";\nimport {utcParse} from \"./defaultLocale\";\n\nfunction parseIsoNative(string) {\n  var date = new Date(string);\n  return isNaN(date) ? null : date;\n}\n\nvar parseIso = +new Date(\"2000-01-01T00:00:00.000Z\")\n    ? parseIsoNative\n    : utcParse(isoSpecifier);\n\nexport default parseIso;\n","import {scaleLinear, scaleLog, scalePow, scaleSqrt} from 'd3-scale';\r\nimport {similar} from '../internal';\r\nimport {IMappingFunction, IMapAbleDesc} from '.';\r\nimport {ITypeFactory, ITypedDump} from './interfaces';\r\nimport {IMappingFunctionConstructor} from './INumberColumn';\r\n\r\n/**\r\n * interface of a d3 scale\r\n */\r\nexport interface IScale {\r\n  (v: number): number;\r\n\r\n  invert(r: number): number;\r\n\r\n  domain(): number[];\r\n\r\n  domain(domain: number[]): this;\r\n\r\n  range(): number[];\r\n\r\n  range(range: number[]): this;\r\n}\r\n\r\nfunction toScale(type = 'linear'): IScale {\r\n  switch (type) {\r\n    case 'log':\r\n      return scaleLog().clamp(true);\r\n    case 'sqrt':\r\n      return scaleSqrt().clamp(true);\r\n    case 'pow1.1':\r\n      return scalePow().exponent(1.1).clamp(true);\r\n    case 'pow2':\r\n      return scalePow().exponent(2).clamp(true);\r\n    case 'pow3':\r\n      return scalePow().exponent(3).clamp(true);\r\n    default:\r\n      return scaleLinear().clamp(true);\r\n  }\r\n}\r\n\r\nfunction isSame(a: number[], b: number[]) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  return a.every((ai, i) => similar(ai, b[i], 0.0001));\r\n}\r\n\r\n\r\nfunction fixDomain(domain: number[], type: string) {\r\n  if (type === 'log' && domain[0] === 0) {\r\n    domain[0] = 0.0000001; //0 is bad\r\n  }\r\n  return domain;\r\n}\r\n\r\n/**\r\n * a mapping function based on a d3 scale (linear, sqrt, log)\r\n */\r\nexport class ScaleMappingFunction implements IMappingFunction {\r\n  private s: IScale;\r\n  private readonly type: string;\r\n\r\n  constructor();\r\n  constructor(dump: ITypedDump);\r\n  constructor(domain: number[], type: string, range: number[]);\r\n  constructor(domain: ITypedDump|number[] = [0, 1], type = 'linear', range: number[] = [0, 1]) {\r\n    if (!domain || Array.isArray(domain)) {\r\n      this.type = type;\r\n      this.s = toScale(type).domain(fixDomain(domain || [0, 1], this.type)).range(range);\r\n    } else {\r\n      const dump = domain;\r\n      this.type = dump.type;\r\n      this.s = toScale(dump.type).domain(dump.domain).range(dump.range);\r\n    }\r\n  }\r\n\r\n  get domain() {\r\n    return this.s.domain();\r\n  }\r\n\r\n  set domain(domain: number[]) {\r\n    this.s.domain(fixDomain(domain, this.type));\r\n  }\r\n\r\n  get range() {\r\n    return this.s.range();\r\n  }\r\n\r\n  set range(range: number[]) {\r\n    this.s.range(range);\r\n  }\r\n\r\n  getRange(format: (v: number) => string): [string, string] {\r\n    return [format(this.invert(0)), format(this.invert(1))];\r\n  }\r\n\r\n  apply(v: number): number {\r\n    return this.s(v);\r\n  }\r\n\r\n  invert(r: number) {\r\n    return this.s.invert(r);\r\n  }\r\n\r\n  get scaleType() {\r\n    return this.type;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: this.type,\r\n      domain: this.domain,\r\n      range: this.range\r\n    };\r\n  }\r\n\r\n  eq(other: IMappingFunction): boolean {\r\n    if (!(other instanceof ScaleMappingFunction)) {\r\n      return false;\r\n    }\r\n    const that = <ScaleMappingFunction>other;\r\n    return that.type === this.type && isSame(this.domain, that.domain) && isSame(this.range, that.range);\r\n  }\r\n\r\n  clone() {\r\n    return new ScaleMappingFunction(this.domain, this.type, this.range);\r\n  }\r\n}\r\n\r\nexport interface IScriptMappingFunctionContext {\r\n  value_min: number;\r\n  value_max: number;\r\n  value_range: number;\r\n  value_domain: number[];\r\n  linear(v: number, min: number, max: number): number;\r\n}\r\n\r\nexport interface IScriptMappingFunctionType {\r\n  (this: IScriptMappingFunctionContext, value: number): number;\r\n}\r\n\r\n/**\r\n * a mapping function based on a custom user function using 'value' as the current value\r\n */\r\nexport class ScriptMappingFunction implements IMappingFunction {\r\n  private readonly f: IScriptMappingFunctionType;\r\n  public domain: number[];\r\n  public readonly code: string;\r\n\r\n  constructor();\r\n  constructor(dump: ITypedDump);\r\n  constructor(domain: number[], code?: string | IScriptMappingFunctionType);\r\n  constructor(domain: ITypedDump | number[] = [0, 1], code: string | IScriptMappingFunctionType = 'return this.linear(value,this.value_min,this.value_max);') {\r\n    if (!domain || Array.isArray(domain)) {\r\n      this.domain = domain || [0, 1];\r\n    } else {\r\n      const dump = domain;\r\n      this.domain = dump.domain;\r\n      code = dump.code;\r\n    }\r\n    this.code = typeof code === 'string' ? code : code.toString();\r\n    this.f = typeof code === 'function' ? code : <any>(new Function('value', code));\r\n  }\r\n\r\n  getRange(): [string, string] {\r\n    return ['?', '?'];\r\n  }\r\n\r\n  apply(v: number): number {\r\n    const min = this.domain[0],\r\n      max = this.domain[this.domain.length - 1];\r\n    const r = this.f.call({\r\n      value_min: min,\r\n      value_max: max,\r\n      value_range: max - min,\r\n      value_domain: this.domain.slice(),\r\n      linear: (v: number, mi: number, ma: number) => (v - mi) / (ma - mi)\r\n    }, v);\r\n\r\n    if (typeof r === 'number') {\r\n      return Math.max(Math.min(r, 1), 0);\r\n    }\r\n    return NaN;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: 'script',\r\n      code: this.code,\r\n      domain: this.domain\r\n    };\r\n  }\r\n\r\n  eq(other: IMappingFunction): boolean {\r\n    if (!(other instanceof ScriptMappingFunction)) {\r\n      return false;\r\n    }\r\n    const that = <ScriptMappingFunction>other;\r\n    return that.code === this.code || that.f === this.f;\r\n  }\r\n\r\n  clone() {\r\n    return new ScriptMappingFunction(this.domain, this.f);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function createMappingFunction(types: {[key: string]: IMappingFunctionConstructor}) {\r\n  return (dump: ITypedDump | IScriptMappingFunctionType): IMappingFunction => {\r\n    if (typeof dump === 'function') {\r\n      return new ScriptMappingFunction([0, 1], dump);\r\n    }\r\n    if (!dump || !dump.type) {\r\n      return new ScaleMappingFunction();\r\n    }\r\n    const type = types[dump.type];\r\n    if (!type) {\r\n      console.warn('invalid mapping type dump', dump);\r\n      return new ScaleMappingFunction(dump.domain || [0, 1], 'linear', dump.range || [0, 1]);\r\n    }\r\n    return new type(dump);\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport function restoreMapping(desc: IMapAbleDesc, factory: ITypeFactory): IMappingFunction {\r\n  if (desc.map) {\r\n    return factory.mappingFunction(desc.map);\r\n  }\r\n  return new ScaleMappingFunction(desc.domain || [0, 1], 'linear', desc.range || [0, 1]);\r\n}\r\n\r\n\r\nexport function mappingFunctions() {\r\n  return {\r\n    script: ScriptMappingFunction,\r\n    linear: ScaleMappingFunction,\r\n    log: ScaleMappingFunction,\r\n    'pow1.1': ScaleMappingFunction,\r\n    pow2: ScaleMappingFunction,\r\n    pow3: ScaleMappingFunction\r\n  };\r\n}\r\n","import {format} from 'd3-format';\r\nimport {IBoxPlotData, similar, ISequence, IAdvancedBoxPlotData, boxplotBuilder} from '../internal';\r\nimport {FIRST_IS_NAN, IDataRow, IBoxPlotColumn, INumberFilter, INumberColumn} from '.';\r\n\r\n\r\n/** @internal */\r\nexport const DEFAULT_FORMATTER = format('.3n');\r\n\r\n/** @internal */\r\nexport function compareBoxPlot(col: IBoxPlotColumn, a: IDataRow, b: IDataRow) {\r\n  const aVal = col.getBoxPlotData(a);\r\n  const bVal = col.getBoxPlotData(b);\r\n  const method = <keyof IBoxPlotData>col.getSortMethod();\r\n  if (aVal == null) {\r\n    return bVal == null ? 0 : FIRST_IS_NAN;\r\n  }\r\n  if (bVal == null) {\r\n    return FIRST_IS_NAN * -1;\r\n  }\r\n  return numberCompare(<number>aVal[method], <number>bVal[method]);\r\n}\r\n\r\nexport function toCompareBoxPlotValue(col: IBoxPlotColumn, row: IDataRow) {\r\n  const v = col.getBoxPlotData(row);\r\n  const method = <keyof IBoxPlotData>col.getSortMethod();\r\n  return v == null ? NaN : <number>v[method];\r\n}\r\n\r\nexport function getBoxPlotNumber(col: IBoxPlotColumn, row: IDataRow, mode: 'raw' | 'normalized'): number {\r\n  const data = mode === 'normalized' ? col.getBoxPlotData(row) : col.getRawBoxPlotData(row);\r\n  if (data == null) {\r\n    return NaN;\r\n  }\r\n  return <number>data[<keyof IBoxPlotData>col.getSortMethod()];\r\n}\r\n/**\r\n * save number comparison\r\n * @param a\r\n * @param b\r\n * @param aMissing\r\n * @param bMissing\r\n * @return {number}\r\n * @internal\r\n */\r\nexport function numberCompare(a: number | null, b: number | null, aMissing = false, bMissing = false) {\r\n  aMissing = aMissing || a == null || isNaN(a);\r\n  bMissing = bMissing || b == null || isNaN(b);\r\n  if (aMissing) { //NaN are smaller\r\n    return bMissing ? 0 : FIRST_IS_NAN;\r\n  }\r\n  if (bMissing) {\r\n    return FIRST_IS_NAN * -1;\r\n  }\r\n  return a! - b!;\r\n}\r\n\r\n/** @internal */\r\nexport function noNumberFilter() {\r\n  return ({min: -Infinity, max: Infinity, filterMissing: false});\r\n}\r\n\r\n/** @internal */\r\nexport function isEqualNumberFilter(a: INumberFilter, b: INumberFilter) {\r\n  return similar(a.min, b.min, 0.001) && similar(a.max, b.max, 0.001) && a.filterMissing === b.filterMissing;\r\n}\r\n\r\n/** @internal */\r\nexport function isNumberIncluded(filter: INumberFilter | null, value: number) {\r\n  if (!filter) {\r\n    return true;\r\n  }\r\n  if (isNaN(value)) {\r\n    return !filter.filterMissing;\r\n  }\r\n  return !((isFinite(filter.min) && value < filter.min) || (isFinite(filter.max) && value > filter.max));\r\n}\r\n\r\n/** @internal */\r\nexport function isDummyNumberFilter(filter: INumberFilter) {\r\n  return !filter.filterMissing && !isFinite(filter.min) && !isFinite(filter.max);\r\n}\r\n\r\n/** @internal */\r\nexport function restoreNumberFilter(v: INumberFilter): INumberFilter {\r\n  return {\r\n    min: v.min != null && isFinite(v.min) ? v.min : -Infinity,\r\n    max: v.max != null && isFinite(v.max) ? v.max : +Infinity,\r\n    filterMissing: v.filterMissing\r\n  };\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function medianIndex(rows: ISequence<IDataRow>, col: INumberColumn) {\r\n  //return the median row\r\n  const data = rows.map((r, i) => ({r, i, v: col.getNumber(r)}));\r\n  const sorted = Array.from(data.filter((r) => !isNaN(r.v))).sort((a, b) => numberCompare(a.v, b.v));\r\n  const index = sorted[Math.floor(sorted.length / 2.0)];\r\n  if (index === undefined) {\r\n    return {index: 0, row: sorted[0]!.r}; //error case\r\n  }\r\n  return {index: index.i, row: index.r};\r\n}\r\n\r\n/** @internal */\r\nexport function toCompareGroupValue(rows: ISequence<IDataRow>, col: INumberColumn, sortMethod: keyof IAdvancedBoxPlotData, valueCache?: ISequence<number>) {\r\n  const b = boxplotBuilder();\r\n  if (valueCache) {\r\n    b.pushAll(valueCache);\r\n  } else {\r\n    b.pushAll(rows.map((d) => col.getNumber(d)));\r\n  }\r\n  const vs = b.build();\r\n  return <number>vs[sortMethod];\r\n}\r\n","import {format} from 'd3-format';\r\nimport {equalArrays, IEventListener, ISequence} from '../internal';\r\nimport {Category, dialogAddons, SortByDefault, toolbar} from './annotations';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, groupRendererChanged, labelChanged, metaDataChanged, rendererTypeChanged, summaryRendererChanged, visibilityChanged, widthChanged} from './Column';\r\nimport {IDataRow, IGroup, ECompareValueType, IValueColumnDesc, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport {INumberColumn, EAdvancedSortMethod, INumberDesc, INumberFilter, IMappingFunction, IColorMappingFunction, IMapAbleColumn} from './INumberColumn';\r\nimport {restoreMapping, ScaleMappingFunction} from './MappingFunction';\r\nimport {isMissingValue, isUnknown, missingGroup} from './missing';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {noNumberFilter, isDummyNumberFilter, restoreNumberFilter, toCompareGroupValue, isEqualNumberFilter, isNumberIncluded} from './internalNumber';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport declare type INumberColumnDesc = INumberDesc & IValueColumnDesc<number>;\r\n\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_NC(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_NC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_NC(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged_NC(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged_NC(previous: number[], current: number[]): void;\r\n\r\n/**\r\n * a number column mapped from an original input scale to an output range\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'groupBy', 'sortGroupBy', 'filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sortGroup', 'sortNumber')\r\n@dialogAddons('group', 'groupNumber')\r\n@Category('number')\r\n@SortByDefault('descending')\r\nexport default class NumberColumn extends ValueColumn<number> implements INumberColumn, IMapAbleColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = 'mappingChanged';\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\r\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\r\n\r\n  private mapping: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n  private original: IMappingFunction;\r\n\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n  private readonly numberFormat: (n: number) => string = format('.2f');\r\n\r\n  private currentGroupThresholds: number[] = [];\r\n  private groupSortMethod: EAdvancedSortMethod = EAdvancedSortMethod.median;\r\n\r\n  constructor(id: string, desc: INumberColumnDesc, factory: ITypeFactory) {\r\n    super(id, integrateDefaults(desc, {\r\n      groupRenderer: 'boxplot',\r\n      summaryRenderer: 'histogram'\r\n    }));\r\n\r\n    this.mapping = restoreMapping(desc, factory);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\r\n\r\n    if (desc.numberFormat) {\r\n      this.numberFormat = format(desc.numberFormat);\r\n    }\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return this.numberFormat;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.map = this.mapping.toJSON();\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    r.filter = isDummyNumberFilter(this.currentFilter) ? null : this.currentFilter;\r\n    r.groupSortMethod = this.groupSortMethod;\r\n    if (this.currentGroupThresholds) {\r\n      r.stratifyThreshholds = this.currentGroupThresholds;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.map) {\r\n      this.mapping = factory.mappingFunction(dump.map);\r\n    } else if (dump.domain) {\r\n      this.mapping = new ScaleMappingFunction(dump.domain, 'linear', dump.range || [0, 1]);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\r\n    }\r\n    if (dump.groupSortMethod) {\r\n      this.groupSortMethod = dump.groupSortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.stratifyThreshholds) {\r\n      this.currentGroupThresholds = dump.stratifyThresholds;\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([NumberColumn.EVENT_MAPPING_CHANGED, NumberColumn.EVENT_COLOR_MAPPING_CHANGED, NumberColumn.EVENT_FILTER_CHANGED, NumberColumn.EVENT_SORTMETHOD_CHANGED, NumberColumn.EVENT_GROUPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof NumberColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NC | null): this;\r\n  on(type: typeof NumberColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NC | null): this;\r\n  on(type: typeof NumberColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NC | null): this;\r\n  on(type: typeof NumberColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NC | null): this;\r\n  on(type: typeof NumberColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_NC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    if ((<any>this.desc).numberFormat) {\r\n      const raw = this.getRawValue(row);\r\n      //if a dedicated format and a number use the formatter in any case\r\n      if (isNaN(raw)) {\r\n        return 'NaN';\r\n      }\r\n      if (!isFinite(raw)) {\r\n        return raw.toString();\r\n      }\r\n      return this.numberFormat(raw);\r\n    }\r\n    const v = super.getValue(row);\r\n    //keep non number if it is not a number else convert using formatter\r\n    if (typeof v === 'number') {\r\n      return this.numberFormat(+v);\r\n    }\r\n    return String(v);\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(this.numberFormat);\r\n  }\r\n\r\n  getRawValue(row: IDataRow) {\r\n    const v: any = super.getValue(row);\r\n    if (isMissingValue(v)) {\r\n      return NaN;\r\n    }\r\n    return +v;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getNumber(row);\r\n    if (isNaN(v)) {\r\n      return null;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const v = this.getRawValue(row);\r\n    if (isNaN(v)) {\r\n      return NaN;\r\n    }\r\n    return this.mapping.apply(v);\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    return [this.getNumber(row)];\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    return [this.getRawNumber(row)];\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    return this.getRawValue(row);\r\n  }\r\n\r\n  toCompareValue(row: IDataRow, valueCache?: any) {\r\n    return valueCache != null ? valueCache : this.getNumber(row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return ECompareValueType.FLOAT;\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): number {\r\n    return toCompareGroupValue(rows, this, <any>this.groupSortMethod, valueCache);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return ECompareValueType.FLOAT;\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const v = this.getNumber(row);\r\n    if (isNaN(v)) {\r\n      return DEFAULT_COLOR;\r\n    }\r\n    return this.colorMapping.apply(v);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return !isDummyNumberFilter(this.currentFilter);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return Object.assign({}, this.currentFilter);\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null) {\r\n    value = value || {min: -Infinity, max: +Infinity, filterMissing: false};\r\n    if (isEqualNumberFilter(value, this.currentFilter)) {\r\n      return;\r\n    }\r\n    const bak = this.getFilter();\r\n    this.currentFilter.min = isUnknown(value.min) ? -Infinity : value.min;\r\n    this.currentFilter.max = isUnknown(value.max) ? Infinity : value.max;\r\n    this.currentFilter.filterMissing = value.filterMissing;\r\n    this.fire([NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getFilter());\r\n  }\r\n\r\n  /**\r\n   * filter the current row if any filter is set\r\n   * @param row\r\n   * @returns {boolean}\r\n   */\r\n  filter(row: IDataRow) {\r\n    return isNumberIncluded(this.currentFilter, this.getRawNumber(row));\r\n  }\r\n\r\n  clearFilter() {\r\n    const was = this.isFiltered();\r\n    this.setFilter(null);\r\n    return was;\r\n  }\r\n\r\n  getGroupThresholds() {\r\n    return this.currentGroupThresholds.slice();\r\n  }\r\n\r\n  setGroupThresholds(value: number[]) {\r\n    if (equalArrays(this.currentGroupThresholds, value)) {\r\n      return;\r\n    }\r\n    const bak = this.getGroupThresholds();\r\n    this.currentGroupThresholds = value.slice();\r\n    this.fire([NumberColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\r\n  }\r\n\r\n\r\n  group(row: IDataRow): IGroup {\r\n    const value = this.getRawNumber(row);\r\n    if (isNaN(value)) {\r\n      return Object.assign({}, missingGroup);\r\n    }\r\n\r\n    let threshold = this.currentGroupThresholds;\r\n    if (threshold.length === 0) {\r\n      // default threshold\r\n      const d = this.mapping.domain;\r\n      threshold = [(d[1] - d[0]) / 2];\r\n    }\r\n\r\n    const treshholdIndex = threshold.findIndex((t) => value <= t);\r\n    // group by thresholds / bins\r\n    switch (treshholdIndex) {\r\n      case -1:\r\n        //bigger than the last threshold\r\n        return {\r\n          name: `${this.label} > ${this.numberFormat(threshold[threshold.length - 1])}`,\r\n          color: this.colorMapping.apply(1)\r\n        };\r\n      case 0:\r\n        //smallest\r\n        return {\r\n          name: `${this.label} <= ${this.numberFormat(threshold[0])}`,\r\n          color: this.colorMapping.apply(0)\r\n        };\r\n      default:\r\n        return {\r\n          name: `${this.numberFormat(threshold[treshholdIndex - 1])} <= ${this.label} <= ${this.numberFormat(threshold[treshholdIndex])}`,\r\n          color: this.colorMapping.apply(this.mapping.apply((threshold[treshholdIndex - 1] + threshold[treshholdIndex]) / 2))\r\n        };\r\n    }\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.groupSortMethod;\r\n  }\r\n\r\n  setSortMethod(sortMethod: EAdvancedSortMethod) {\r\n    if (this.groupSortMethod === sortMethod) {\r\n      return;\r\n    }\r\n    this.fire([NumberColumn.EVENT_SORTMETHOD_CHANGED], this.groupSortMethod, this.groupSortMethod = sortMethod);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isGroupSortedByMe().asc) {\r\n      this.toggleMyGroupSorting();\r\n    }\r\n  }\r\n}\r\n","import {format} from 'd3-format';\r\nimport {IBoxPlotData, IEventListener} from '../internal';\r\nimport {Category, dialogAddons, SortByDefault, toolbar} from './annotations';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, groupRendererChanged, labelChanged, metaDataChanged, rendererTypeChanged, summaryRendererChanged, visibilityChanged, widthChanged} from './Column';\r\nimport {IDataRow, ECompareValueType, IValueColumnDesc, ITypeFactory} from './interfaces';\r\nimport {ESortMethod, IBoxPlotColumn, INumberDesc, INumberFilter, IColorMappingFunction, IMappingFunction} from './INumberColumn';\r\nimport {restoreMapping} from './MappingFunction';\r\nimport NumberColumn from './NumberColumn';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {DEFAULT_FORMATTER, noNumberFilter, toCompareBoxPlotValue, getBoxPlotNumber, isDummyNumberFilter, restoreNumberFilter} from './internalNumber';\r\n\r\n\r\nexport interface IBoxPlotDesc extends INumberDesc {\r\n  sort?: ESortMethod;\r\n}\r\n\r\nexport declare type IBoxPlotColumnDesc = IBoxPlotDesc & IValueColumnDesc<IBoxPlotData>;\r\n\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf BoxPlotColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged_BPC(previous: ESortMethod, current: ESortMethod): void;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf BoxPlotColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_BPC(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf BoxPlotColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_BPC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf BoxPlotColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_BPC(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortBoxPlot')\r\n@Category('array')\r\n@SortByDefault('descending')\r\nexport default class BoxPlotColumn extends ValueColumn<IBoxPlotData> implements IBoxPlotColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\r\n\r\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\r\n\r\n  private sort: ESortMethod;\r\n\r\n  private mapping: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n\r\n  private original: Readonly<IMappingFunction>;\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n\r\n  constructor(id: string, desc: Readonly<IBoxPlotColumnDesc>, factory: ITypeFactory) {\r\n    super(id, desc);\r\n    this.mapping = restoreMapping(desc, factory);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping);\r\n\r\n    if (desc.numberFormat) {\r\n      this.numberFormat = format(desc.numberFormat);\r\n    }\r\n\r\n    this.sort = desc.sort || ESortMethod.min;\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return this.numberFormat;\r\n  }\r\n\r\n  toCompareValue(row: IDataRow): number {\r\n    return toCompareBoxPlotValue(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return ECompareValueType.FLOAT;\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    return this.getValue(row);\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(this.numberFormat);\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    return this.getRawValue(row);\r\n  }\r\n\r\n  getRawValue(row: IDataRow) {\r\n    return super.getValue(row);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getRawValue(row);\r\n    if (v == null) {\r\n      return null;\r\n    }\r\n    const r: IBoxPlotData = {\r\n      min: this.mapping.apply(v.min),\r\n      max: this.mapping.apply(v.max),\r\n      median: this.mapping.apply(v.median),\r\n      q1: this.mapping.apply(v.q1),\r\n      q3: this.mapping.apply(v.q3)\r\n    };\r\n    if (v.outlier) {\r\n      Object.assign(r, {\r\n        outlier: v.outlier.map((d) => this.mapping.apply(d))\r\n      });\r\n    }\r\n    if (v.whiskerLow != null) {\r\n      Object.assign(r, {\r\n        whiskerLow: this.mapping.apply(v.whiskerLow)\r\n      });\r\n    }\r\n    if (v.whiskerHigh != null) {\r\n      Object.assign(r, {\r\n        whiskerHigh: this.mapping.apply(v.whiskerHigh)\r\n      });\r\n    }\r\n    return r;\r\n  }\r\n\r\n  getNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'normalized');\r\n  }\r\n\r\n  getRawNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'raw');\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    return [this.getNumber(row)];\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    return [this.getRawNumber(row)];\r\n  }\r\n\r\n  getLabel(row: IDataRow): string {\r\n    const v = this.getRawValue(row);\r\n    if (v == null) {\r\n      return '';\r\n    }\r\n    const f = this.numberFormat;\r\n    return `BoxPlot(min = ${f(v.min)}, q1 = ${f(v.q1)}, median = ${f(v.median)}, q3 = ${f(v.q3)}, max = ${f(v.max)})`;\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: ESortMethod) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire(BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\r\n    r.map = this.mapping.toJSON();\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.map || dump.domain) {\r\n      this.mapping = restoreMapping(dump, factory);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BPC | null): this;\r\n  on(type: typeof BoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_BPC | null): this;\r\n  on(type: typeof BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_BPC | null): this;\r\n  on(type: typeof BoxPlotColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_BPC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([BoxPlotColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return NumberColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return NumberColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return NumberColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null) {\r\n    NumberColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return NumberColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  clearFilter() {\r\n    return NumberColumn.prototype.clearFilter.call(this);\r\n  }\r\n}\r\n\r\n","import {Category} from './annotations';\r\nimport {IKeyValue, IMapColumn} from './IArrayColumn';\r\nimport {IDataRow, IValueColumnDesc} from './interfaces';\r\nimport ValueColumn from './ValueColumn';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport interface IMapColumnDesc<T> extends IValueColumnDesc<IKeyValue<T>[]> {\r\n  // dummy\r\n}\r\n\r\n@Category('map')\r\nexport default class MapColumn<T> extends ValueColumn<IKeyValue<T>[]> implements IMapColumn<T> {\r\n\r\n  constructor(id: string, desc: Readonly<IMapColumnDesc<T>>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 200\r\n    }));\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const r = this.getMap(row);\r\n    return r.length === 0 ? null : r;\r\n  }\r\n\r\n  getLabels(row: IDataRow): IKeyValue<string>[] {\r\n    const v = this.getMap(row);\r\n    return v.map(({key, value}) => ({key, value: String(value)}));\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return toKeyValue<T>(<any>super.getValue(row));\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return this.getLabels(row);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const v = this.getLabels(row);\r\n    return `{${v.map(({key, value}) => `${key}: ${value}`).join(', ')}}`;\r\n  }\r\n}\r\n\r\nfunction byKey(a: IKeyValue<any>, b: IKeyValue<any>) {\r\n  if (a === b) {\r\n    return 0;\r\n  }\r\n  return a.key.localeCompare(b.key);\r\n}\r\n\r\nfunction toKeyValue<T>(v?: Map<string, T> | { [key: string]: T } | IKeyValue<T>[]): IKeyValue<T>[] {\r\n  if (!v) {\r\n    return [];\r\n  }\r\n  if (v instanceof Map) {\r\n    return Array.from(v.entries()).map(([key, value]) => ({key, value})).sort(byKey);\r\n  }\r\n  if (Array.isArray(v)) {\r\n    return v; // keep original order\r\n  }\r\n  // object\r\n  return Object.keys(v).map((key) => ({key, value: v[key]})).sort(byKey);\r\n}\r\n","import {ICategoricalDesc, ICategory, ICategoricalLikeColumn, ICategoricalColorMappingFunction} from './ICategoricalColumn';\r\nimport {IDataRow, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport Column, {labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, widthChanged, dirtyCaches} from './Column';\r\nimport {IEventListener} from '../internal';\r\nimport {toolbar} from './annotations';\r\nimport {toCategories} from './internalCategorical';\r\n\r\n\r\nexport declare type ICategoricalMapColumnDesc = ICategoricalDesc & IMapColumnDesc<string | null>;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf CategoricalMapColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_CMC(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n@toolbar('rename', 'colorMappedCategorical')\r\nexport default class CategoricalMapColumn extends MapColumn<string | null> implements ICategoricalLikeColumn {\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n\r\n  constructor(id: string, desc: Readonly<ICategoricalMapColumnDesc>) {\r\n    super(id, desc);\r\n    this.categories = toCategories(desc);\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n  protected createEventList() {\r\n    return super.createEventList().concat([CategoricalMapColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof CategoricalMapColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_CMC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n\r\n  private parseValue(v: any) {\r\n    if (!v) {\r\n      return null;\r\n    }\r\n    const vs = String(v);\r\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\r\n  }\r\n\r\n  getCategoryMap(row: IDataRow) {\r\n    return super.getMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: this.parseValue(value)\r\n    }));\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return this.getCategoryMap(row).map((d) => d.value);\r\n  }\r\n\r\n  getColors(row: IDataRow) {\r\n    return this.getCategoryMap(row).map(({key, value}) => ({key, value: value ? this.colorMapping.apply(value) : DEFAULT_COLOR}));\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const r = this.getCategoryMap(row);\r\n    return r.length === 0 ? null : r.map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.name : null\r\n    }));\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getCategoryMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.label : ''\r\n    }));\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    return this.getCategories(row);\r\n  }\r\n}\r\n","import ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport {ICategoricalDesc, ICategory, ICategoricalColorMappingFunction, ICategoricalsColumn} from './ICategoricalColumn';\r\nimport {IDataRow, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport {toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport Column, {labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, widthChanged, dirtyCaches} from './Column';\r\nimport {IEventListener} from '../internal';\r\nimport {toCategories} from './internalCategorical';\r\n\r\nexport declare type ICategoricalsColumnDesc = ICategoricalDesc & IArrayColumnDesc<string | null>;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf CategoricalsColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_CCS(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'colorMappedCategorical')\r\nexport default class CategoricalsColumn extends ArrayColumn<string | null> implements ICategoricalsColumn {\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n\r\n  constructor(id: string, desc: Readonly<ICategoricalsColumnDesc>) {\r\n    super(id, desc);\r\n    this.categories = toCategories(desc);\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([CategoricalsColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof CategoricalsColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_CCS | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return super.getValues(row).map((v) => {\r\n      if (!v) {\r\n        return null;\r\n      }\r\n      const vs = String(v);\r\n      return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\r\n    });\r\n  }\r\n\r\n  getColors(row: IDataRow) {\r\n    return this.getCategories(row).map((d) => d ? this.colorMapping.apply(d) : DEFAULT_COLOR);\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    return this.getCategories(row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return this.getCategories(row).map((v) => v ? v.name : null);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getCategories(row).map((v) => v ? v.label : '');\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\r\n  }\r\n}\r\n","import {timeDay, timeHour, timeMinute, timeMonth, timeSecond, timeWeek} from 'd3-time';\r\nimport {timeFormat} from 'd3-time-format';\r\nimport {equal, ISequence, isSeqEmpty} from '../internal';\r\nimport {INumberFilter, IDateGrouper, IDataRow, IDateColumn} from '.';\r\nimport {isNumberIncluded} from './internalNumber';\r\n\r\n/** @internal */\r\nexport {isDummyNumberFilter as isDummyDateFilter, isEqualNumberFilter as isEqualDateFilter, noNumberFilter as noDateFilter, restoreNumberFilter as restoreDateFilter} from './internalNumber';\r\n\r\n\r\n/** @internal */\r\nexport function isDateIncluded(filter: INumberFilter | null, value: Date | null) {\r\n  if (!filter) {\r\n    return true;\r\n  }\r\n  if (value == null || !(value instanceof Date)) {\r\n    return !filter.filterMissing;\r\n  }\r\n  return isNumberIncluded(filter, value!.getTime());\r\n}\r\n\r\n/**\r\n * shifts the given date such that it is on 23:59:59, or 00:00:00\r\n * @internal\r\n */\r\nexport function shiftFilterDateDay(date: number, type: 'min' | 'max') {\r\n  const d = new Date(date);\r\n  if (type === 'max') {\r\n    d.setHours(23);\r\n    d.setMinutes(59);\r\n    d.setSeconds(59);\r\n    d.setMilliseconds(999);\r\n  } else {\r\n    d.setHours(0);\r\n    d.setMinutes(0);\r\n    d.setSeconds(0);\r\n    d.setMilliseconds(0);\r\n  }\r\n  return d.getTime();\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function defaultDateGrouper(): IDateGrouper {\r\n  return {granularity: 'month', circular: false};\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function isDefaultDateGrouper(grouper: IDateGrouper) {\r\n  return equal(defaultDateGrouper(), grouper);\r\n}\r\n\r\n/**\r\n * convert the given date to the desired grouper\r\n * @internal\r\n */\r\nexport function toDateGroup(grouper: IDateGrouper, value: Date): {value: number, name: string} {\r\n  switch (grouper.granularity) {\r\n    case 'century':\r\n      const centuryP = Math.floor(value.getFullYear() / 100);\r\n      if (grouper.circular) {\r\n        const century = centuryP % 10;\r\n        return {\r\n          value: century,\r\n          name: `*${century}00`\r\n        };\r\n      }\r\n      return {\r\n        value: centuryP,\r\n        name: `${centuryP}00`\r\n      };\r\n    case 'decade':\r\n      const decadeP = Math.floor(value.getFullYear() / 10);\r\n      if (grouper.circular) {\r\n        const decade = decadeP % 10;\r\n        return {\r\n          value: decade,\r\n          name: `**${decade}0`\r\n        };\r\n      }\r\n      return {\r\n        value: decadeP,\r\n        name: `${decadeP}0`\r\n      };\r\n    case 'year':\r\n      if (grouper.circular) {\r\n        const year = value.getFullYear() % 10;\r\n        return {\r\n          value: year,\r\n          name: `***${year}`\r\n        };\r\n      }\r\n      return {\r\n        value: value.getFullYear(),\r\n        name: String(value.getFullYear())\r\n      };\r\n    case 'month':\r\n      if (grouper.circular) {\r\n        return {\r\n          value: value.getMonth(),\r\n          name: timeFormat('%B')(value)\r\n        };\r\n      }\r\n      return {\r\n        value: timeMonth(value).getTime(),\r\n        name: timeFormat('%B %Y')(value)\r\n      };\r\n    case 'week':\r\n      if (grouper.circular) {\r\n        return {\r\n          value: value.getMonth(),\r\n          name: timeFormat('%W')(value)\r\n        };\r\n      }\r\n      return {\r\n        value: timeWeek(value).getTime(),\r\n        name: timeFormat('%W %Y')(value)\r\n      };\r\n    case 'day_of_week':\r\n      if (grouper.circular) {\r\n        return {\r\n          value: value.getDay(),\r\n          name: timeFormat('%A')(value)\r\n        };\r\n      }\r\n      return {\r\n        value: timeDay(value).getTime(),\r\n        name: timeFormat('%x')(value)\r\n      };\r\n    case 'day_of_month':\r\n      if (grouper.circular) {\r\n        return {\r\n          value: value.getDate(),\r\n          name: timeFormat('%d')(value)\r\n        };\r\n      }\r\n      return {\r\n        value: timeDay(value).getTime(),\r\n        name: timeFormat('%x')(value)\r\n      };\r\n    case 'day_of_year':\r\n      if (grouper.circular) {\r\n        // %j = day of year\r\n        const v = timeFormat('%j')(value);\r\n        return {\r\n          value: parseInt(v, 10),\r\n          name: v\r\n        };\r\n      }\r\n      return {\r\n        value: timeDay(value).getTime(),\r\n        name: timeFormat('%x')(value)\r\n      };\r\n    case 'hour':\r\n      if (grouper.circular) {\r\n        return {\r\n          value: value.getHours(),\r\n          name: timeFormat('%A')(value)\r\n        };\r\n      }\r\n      return {\r\n        value: timeHour(value).getTime(),\r\n        name: timeFormat('%x')(value)\r\n      };\r\n    case 'minute':\r\n      if (grouper.circular) {\r\n        return {\r\n          value: value.getMinutes(),\r\n          name: timeFormat('%A')(value)\r\n        };\r\n      }\r\n      return {\r\n        value: timeMinute(value).getTime(),\r\n        name: timeFormat('%x')(value)\r\n      };\r\n    case 'second':\r\n      if (grouper.circular) {\r\n        return {\r\n          value: value.getSeconds(),\r\n          name: timeFormat('%A')(value)\r\n        };\r\n      }\r\n      return {\r\n        value: timeSecond(value).getTime(),\r\n        name: timeFormat('%x')(value)\r\n      };\r\n  }\r\n\r\n  return {\r\n    value: value.getTime(),\r\n    name: value.toString()\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function chooseAggregatedDate(rows: ISequence<IDataRow>, grouper: IDateGrouper | null, col: IDateColumn, valueCache?: ISequence<Date | null>): {value: number | null, name: string} {\r\n  const vs = <ISequence<Date>>(valueCache ? valueCache : rows.map((d) => col.getDate(d))).filter((d) => d instanceof Date);\r\n  if (isSeqEmpty(vs)) {\r\n    return {value: null, name: ''};\r\n  }\r\n  const median = trueMedian(vs.map((d) => d.getTime()))!;\r\n  if (!grouper) {\r\n    return {value: median, name: (new Date(median)).toString()};\r\n  }\r\n  return toDateGroup(grouper, new Date(median));\r\n}\r\n\r\nfunction trueMedian(dates: ISequence<number>) {\r\n  // to avoid interpolating between the centers do it manually\r\n  const s = Float64Array.from(dates);\r\n  if (s.length === 1) {\r\n    return s[0];\r\n  }\r\n\r\n  s.sort();\r\n  return s[Math.floor(s.length / 2)];\r\n}\r\n","import {timeFormat, timeParse} from 'd3-time-format';\r\nimport {ISequence, equal, IEventListener} from '../internal';\r\nimport {Category, dialogAddons, toolbar} from './annotations';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, groupRendererChanged, labelChanged, metaDataChanged, rendererTypeChanged, summaryRendererChanged, visibilityChanged, widthChanged} from './Column';\r\nimport {IDateColumn, IDateDesc, IDateFilter, IDateGrouper} from './IDateColumn';\r\nimport {defaultGroup, IDataRow, IGroup, ECompareValueType, IValueColumnDesc, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport {isMissingValue, isUnknown, missingGroup} from './missing';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {noDateFilter, defaultDateGrouper, isDummyDateFilter, isDefaultDateGrouper, restoreDateFilter, isEqualDateFilter, isDateIncluded, toDateGroup, chooseAggregatedDate} from './internalDate';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\nexport declare type IDateColumnDesc = IValueColumnDesc<Date> & IDateDesc;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf DateColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_DC(previous: IDateFilter | null, current: IDateFilter | null): void;\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf DateColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged_DC(previous: IDateGrouper | null, current: IDateGrouper | null): void;\r\n\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'groupBy', 'sortGroupBy', 'filterDate')\r\n@dialogAddons('group', 'groupDate')\r\n@Category('date')\r\nexport default class DateColumn extends ValueColumn<Date> implements IDateColumn {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\r\n\r\n  static readonly DEFAULT_DATE_FORMAT = '%x';\r\n\r\n  private readonly format: (date: Date | null) => string;\r\n  private readonly parse: (date: string) => Date | null;\r\n\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: IDateFilter = noDateFilter();\r\n  private currentGrouper: IDateGrouper = defaultDateGrouper();\r\n\r\n  constructor(id: string, desc: Readonly<IDateColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      groupRenderer: 'datehistogram',\r\n      summaryRenderer: 'datehistogram'\r\n    }));\r\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\r\n    this.format = (v) => (v instanceof Date) ? f(v) : '';\r\n    this.parse = desc.dateParse ? timeParse(desc.dateParse) : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\r\n  }\r\n\r\n  getFormatter() {\r\n    return this.format;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.filter = isDummyDateFilter(this.currentFilter) ? null : this.currentFilter;\r\n    if (this.currentGrouper && !isDefaultDateGrouper(this.currentGrouper)) {\r\n      r.grouper = this.currentGrouper;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreDateFilter(dump.filter);\r\n    }\r\n    if (dump.grouper) {\r\n      this.currentGrouper = dump.grouper;\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([DateColumn.EVENT_FILTER_CHANGED, DateColumn.EVENT_GROUPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof DateColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DC | null): this;\r\n  on(type: typeof DateColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_DC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow): Date | null {\r\n    return this.getDate(row);\r\n  }\r\n\r\n  getDate(row: IDataRow) {\r\n    const v = super.getValue(row);\r\n    if (isMissingValue(v)) {\r\n      return null;\r\n    }\r\n    if (v instanceof Date) {\r\n      return v;\r\n    }\r\n    return this.parse(String(v));\r\n  }\r\n\r\n  iterDate(row: IDataRow) {\r\n    return [this.getDate(row)];\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    return this.format(v);\r\n  }\r\n\r\n  isFiltered() {\r\n    return !isDummyDateFilter(this.currentFilter);\r\n  }\r\n\r\n  clearFilter() {\r\n    const was = this.isFiltered();\r\n    this.setFilter(null);\r\n    return was;\r\n  }\r\n\r\n  getFilter(): IDateFilter {\r\n    return Object.assign({}, this.currentFilter);\r\n  }\r\n\r\n  setFilter(value: IDateFilter | null) {\r\n    value = value || {min: -Infinity, max: +Infinity, filterMissing: false};\r\n    if (isEqualDateFilter(value, this.currentFilter)) {\r\n      return;\r\n    }\r\n    const bak = this.getFilter();\r\n    this.currentFilter.min = isUnknown(value.min) ? -Infinity : value.min;\r\n    this.currentFilter.max = isUnknown(value.max) ? Infinity : value.max;\r\n    this.currentFilter.filterMissing = value.filterMissing;\r\n    this.fire([DateColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getFilter());\r\n  }\r\n\r\n  /**\r\n   * filter the current row if any filter is set\r\n   * @param row\r\n   * @returns {boolean}\r\n   */\r\n  filter(row: IDataRow, valueCache?: any) {\r\n    return isDateIncluded(this.currentFilter, valueCache !== undefined ? valueCache : this.getDate(row));\r\n  }\r\n\r\n  toCompareValue(row: IDataRow, valueCache?: any) {\r\n    const v = valueCache !== undefined ? valueCache : this.getValue(row);\r\n    if (!(v instanceof Date)) {\r\n      return NaN;\r\n    }\r\n    return v.getTime();\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return ECompareValueType.DOUBLE_ASC;\r\n  }\r\n\r\n  getDateGrouper() {\r\n    return Object.assign({}, this.currentGrouper);\r\n  }\r\n\r\n  setDateGrouper(value: IDateGrouper) {\r\n    if (equal(this.currentGrouper, value)) {\r\n      return;\r\n    }\r\n    const bak = this.getDateGrouper();\r\n    this.currentGrouper = Object.assign({}, value);\r\n    this.fire([DateColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\r\n  }\r\n\r\n  group(row: IDataRow, valueCache?: any): IGroup {\r\n    const v = valueCache !== undefined ? valueCache : this.getDate(row);\r\n    if (!v || !(v instanceof Date)) {\r\n      return Object.assign({}, missingGroup);\r\n    }\r\n    if (!this.currentGrouper) {\r\n      return Object.assign({}, defaultGroup);\r\n    }\r\n    const g = toDateGroup(this.currentGrouper, v);\r\n    return {\r\n      name: g.name,\r\n      color: DEFAULT_COLOR\r\n    };\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): number {\r\n    const v = chooseAggregatedDate(rows, this.currentGrouper, this, valueCache).value;\r\n    return v == null ? NaN : v;\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return ECompareValueType.DOUBLE_ASC;\r\n  }\r\n}\r\n","import {timeFormat, timeParse} from 'd3-time-format';\r\nimport {median, min, max, IEventListener} from '../internal';\r\nimport {dialogAddons, toolbar} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDateDesc, IDatesColumn, IDateFilter} from './IDateColumn';\r\nimport {IDataRow, ECompareValueType, ITypeFactory} from './interfaces';\r\nimport {isMissingValue} from './missing';\r\nimport DateColumn from './DateColumn';\r\nimport {noDateFilter, isDummyDateFilter, restoreDateFilter} from './internalDate';\r\nimport {chooseUIntByDataLength, integrateDefaults} from './internal';\r\n\r\nexport enum EDateSort {\r\n  min = 'min',\r\n  max = 'max',\r\n  median = 'median'\r\n}\r\n\r\nexport interface IDatesDesc extends IDateDesc {\r\n  sort?: EDateSort;\r\n}\r\n\r\nexport declare type IDatesColumnDesc = IDatesDesc & IArrayColumnDesc<Date>;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf DatesColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged_DCS(previous: EDateSort, current: EDateSort): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf DatesColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_DCS(previous: IDateFilter | null, current: IDateFilter | null): void;\r\n\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterDate')\r\n@dialogAddons('sort', 'sortDates')\r\nexport default class DatesColumn extends ArrayColumn<Date | null> implements IDatesColumn {\r\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\r\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\r\n\r\n  private readonly format: (date: Date | null) => string;\r\n  private readonly parse: (date: string) => Date | null;\r\n  private sort: EDateSort;\r\n  private currentFilter: IDateFilter = noDateFilter();\r\n\r\n  constructor(id: string, desc: Readonly<IDatesColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'datehistogram',\r\n      groupRenderer: 'datehistogram',\r\n      summaryRenderer: 'datehistogram'\r\n    }));\r\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\r\n    this.format = (v) => (v instanceof Date) ? f(v) : '';\r\n    this.parse = desc.dateParse ? timeParse(desc.dateParse) : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\r\n    this.sort = desc.sort || EDateSort.median;\r\n  }\r\n\r\n  getFormatter() {\r\n    return this.format;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([DatesColumn.EVENT_SORTMETHOD_CHANGED, DatesColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof DatesColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_DCS | null): this;\r\n  on(type: typeof DatesColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DCS | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow): (Date | null)[] | null {\r\n    const r = this.getDates(row);\r\n    return r.every((d) => d == null) ? null : r;\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getDates(row).map((v) => (v instanceof Date) ? this.format(v) : '');\r\n  }\r\n\r\n  getDates(row: IDataRow): (Date | null)[] {\r\n    return super.getValues(row).map((v) => {\r\n      if (isMissingValue(v)) {\r\n        return null;\r\n      }\r\n      if (v instanceof Date) {\r\n        return v;\r\n      }\r\n      return this.parse(String(v));\r\n    });\r\n  }\r\n\r\n  getDate(row: IDataRow) {\r\n    const av = <Date[]>this.getDates(row).filter(Boolean);\r\n    if (av.length === 0) {\r\n      return null;\r\n    }\r\n    return new Date(compute(av, this.sort));\r\n  }\r\n\r\n  iterDate(row: IDataRow) {\r\n    return this.getDates(row);\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EDateSort) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire([DatesColumn.EVENT_SORTMETHOD_CHANGED], this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreDateFilter(dump.filter);\r\n    }\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    const vs = <Date[]>this.getDates(row).filter(Boolean);\r\n    if (!vs) {\r\n      return [0, 0];\r\n    }\r\n    return [vs.length, compute(vs, this.sort)];\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return [chooseUIntByDataLength(this.dataLength), ECompareValueType.DOUBLE_ASC];\r\n  }\r\n\r\n  isFiltered() {\r\n    return DateColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): IDateFilter {\r\n    return DateColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: IDateFilter | null) {\r\n    DateColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return DateColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  clearFilter() {\r\n    return DateColumn.prototype.clearFilter.call(this);\r\n  }\r\n}\r\n\r\nfunction compute(arr: Date[], sort: EDateSort) {\r\n  switch (sort) {\r\n    case EDateSort.min:\r\n      return min(arr, (d) => d.getTime())!;\r\n    case EDateSort.max:\r\n      return max(arr, (d) => d.getTime())!;\r\n    case EDateSort.median:\r\n      return median(arr, (d) => d.getTime())!;\r\n  }\r\n}\r\n","import {timeFormat, timeParse} from 'd3-time-format';\r\nimport {IDateColumn, IDateFilter} from './IDateColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {IDataRow, ITypeFactory} from './interfaces';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport {isMissingValue} from './missing';\r\nimport DatesColumn, {EDateSort, IDatesDesc} from './DatesColumn';\r\nimport DateColumn from './DateColumn';\r\nimport {dialogAddons, toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal';\r\nimport {noDateFilter, isDummyDateFilter, restoreDateFilter} from './internalDate';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport declare type IDateMapColumnDesc = IDatesDesc & IMapColumnDesc<Date | null>;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf DatesMapColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged_DMC(previous: EDateSort, current: EDateSort): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf DatesMapColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_DMC(previous: IDateFilter | null, current: IDateFilter | null): void;\r\n\r\n\r\n@toolbar('rename', 'filterDate')\r\n@dialogAddons('sort', 'sortDates')\r\nexport default class DatesMapColumn extends MapColumn<Date | null> implements IDateColumn {\r\n  static readonly EVENT_SORTMETHOD_CHANGED = DatesColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\r\n\r\n  private readonly format: (date: Date | null) => string;\r\n  private readonly parse: (date: string) => Date | null;\r\n  private sort: EDateSort;\r\n  private currentFilter: IDateFilter = noDateFilter();\r\n\r\n  constructor(id: string, desc: Readonly<IDateMapColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'default'\r\n    }));\r\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\r\n    this.format = (v) => (v instanceof Date) ? f(v) : '';\r\n    this.parse = desc.dateParse ? timeParse(desc.dateParse) : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\r\n    this.sort = desc.sort || EDateSort.median;\r\n  }\r\n\r\n  getFormatter() {\r\n    return this.format;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([DatesMapColumn.EVENT_SORTMETHOD_CHANGED, DatesMapColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof DatesMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_DMC | null): this;\r\n  on(type: typeof DatesMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DMC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  private parseValue(v: any) {\r\n    if (isMissingValue(v)) {\r\n      return null;\r\n    }\r\n    if (v instanceof Date) {\r\n      return v;\r\n    }\r\n    return this.parse(String(v));\r\n  }\r\n\r\n  getDateMap(row: IDataRow) {\r\n    return super.getMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: this.parseValue(value)\r\n    }));\r\n  }\r\n\r\n  iterDate(row: IDataRow) {\r\n    return this.getDates(row);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const r = this.getDateMap(row);\r\n\r\n    return r.every((d) => d == null) ? null : r;\r\n  }\r\n\r\n  getLabels(row: IDataRow): IKeyValue<string>[] {\r\n    return this.getDateMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: (value instanceof Date) ? this.format(value) : ''\r\n    }));\r\n  }\r\n\r\n  getDates(row: IDataRow): (Date | null)[] {\r\n    return this.getDateMap(row).map((v) => v.value);\r\n  }\r\n\r\n  getDate(row: IDataRow) {\r\n    return DatesColumn.prototype.getDate.call(this, row);\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EDateSort) {\r\n    return DatesColumn.prototype.setSortMethod.call(this, sort);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreDateFilter(dump.filter);\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return DateColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): IDateFilter {\r\n    return DateColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: IDateFilter | null) {\r\n    DateColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return DateColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  clearFilter() {\r\n    return DateColumn.prototype.clearFilter.call(this);\r\n  }\r\n}\r\n","import {Category, SupportType, toolbar, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport {IDataRow, IGroup, ECompareValueType} from './interfaces';\r\nimport {missingGroup} from './missing';\r\nimport {IEventListener, ISequence} from '../internal';\r\n\r\nexport function createGroupDesc(label = 'Group Name') {\r\n  return {type: 'group', label};\r\n}\r\n\r\nexport enum EGroupSortMethod {\r\n  name = 'name',\r\n  count = 'count'\r\n}\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf GroupColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: EGroupSortMethod, current: EGroupSortMethod): void;\r\n\r\n\r\n@SupportType()\r\n@toolbar('rename', 'sortGroupBy')\r\n@dialogAddons('sortGroup', 'sortGroups')\r\n@Category('support')\r\nexport default class GroupColumn extends Column {\r\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\r\n\r\n  private groupSortMethod: EGroupSortMethod = EGroupSortMethod.name;\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([GroupColumn.EVENT_SORTMETHOD_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof GroupColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getLabel() {\r\n    return '';\r\n  }\r\n\r\n  getValue() {\r\n    return '';\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.groupSortMethod;\r\n  }\r\n\r\n  setSortMethod(sortMethod: EGroupSortMethod) {\r\n    if (this.groupSortMethod === sortMethod) {\r\n      return;\r\n    }\r\n    this.fire(GroupColumn.EVENT_SORTMETHOD_CHANGED, this.groupSortMethod, this.groupSortMethod = sortMethod);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isGroupSortedByMe().asc) {\r\n      this.toggleMyGroupSorting();\r\n    }\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\r\n    if (this.groupSortMethod === 'count') {\r\n      return rows.length;\r\n    }\r\n    return group.name === missingGroup.name ? null : group.name.toLowerCase();\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return this.groupSortMethod === 'count' ? ECompareValueType.COUNT : ECompareValueType.STRING;\r\n  }\r\n}\r\n","import {Category, toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, dirtyCaches, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {ICategoricalColumn, ICategory, ICategoricalColorMappingFunction} from './ICategoricalColumn';\r\nimport {IDataRow, IGroup, IValueColumnDesc, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport {colorPool, integrateDefaults} from './internal';\r\nimport {missingGroup} from './missing';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\n\r\nexport interface ICategoryNode extends ICategory {\r\n  children: Readonly<ICategoryNode>[];\r\n}\r\n\r\nexport interface IPartialCategoryNode extends Partial<ICategory> {\r\n  children: IPartialCategoryNode[];\r\n}\r\n\r\nexport interface IHierarchyDesc {\r\n  hierarchy: IPartialCategoryNode;\r\n  hierarchySeparator?: string;\r\n}\r\n\r\nexport declare type IHierarchyColumnDesc = IHierarchyDesc & IValueColumnDesc<string>;\r\n\r\nexport interface ICategoryInternalNode extends ICategory {\r\n  path: string;\r\n  children: Readonly<ICategoryInternalNode>[];\r\n}\r\n\r\nexport interface ICutOffNode {\r\n  node: Readonly<ICategoryInternalNode>;\r\n  maxDepth: number;\r\n}\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf HierarchyColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_HC(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n\r\n/**\r\n * emitted when the cut off property changes\r\n * @asMemberOf HierarchyColumn\r\n * @event\r\n */\r\nexport declare function cutOffChanged(previous: ICutOffNode, current: ICutOffNode): void;\r\n\r\n/**\r\n * column for hierarchical categorical values\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'cutoff', 'group', 'groupBy', 'colorMappedCategorical')\r\n@Category('categorical')\r\nexport default class HierarchyColumn extends ValueColumn<string> implements ICategoricalColumn {\r\n  static readonly EVENT_CUTOFF_CHANGED = 'cutOffChanged';\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\r\n\r\n  private readonly hierarchySeparator: string;\r\n  readonly hierarchy: Readonly<ICategoryInternalNode>;\r\n\r\n  private currentNode: Readonly<ICategoryInternalNode>;\r\n  private currentMaxDepth: number = Infinity;\r\n  private currentLeaves: Readonly<ICategoryInternalNode>[] = [];\r\n  private readonly currentLeavesNameCache = new Map<string, Readonly<ICategoryInternalNode>>();\r\n  private readonly currentLeavesPathCache = new Map<string, Readonly<ICategoryInternalNode>>();\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n\r\n  constructor(id: string, desc: Readonly<IHierarchyColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'categorical'\r\n    }));\r\n    this.hierarchySeparator = desc.hierarchySeparator || '.';\r\n    this.hierarchy = this.initHierarchy(desc.hierarchy);\r\n    this.currentNode = this.hierarchy;\r\n    this.currentLeaves = computeLeaves(this.currentNode, this.currentMaxDepth);\r\n    this.updateCaches();\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n\r\n  private initHierarchy(root: IPartialCategoryNode) {\r\n    const colors = colorPool();\r\n    const s = this.hierarchySeparator;\r\n    const add = (prefix: string, node: IPartialCategoryNode): ICategoryInternalNode => {\r\n      const name = node.name == null ? String(node.value) : node.name;\r\n      const children = (node.children || []).map((child: IPartialCategoryNode | string): ICategoryInternalNode => {\r\n        if (typeof child === 'string') {\r\n          const path = prefix + child;\r\n          return {\r\n            path,\r\n            name: child,\r\n            label: path,\r\n            color: colors(),\r\n            value: 0,\r\n            children: []\r\n          };\r\n        }\r\n        const r = add(`${prefix}${name}${s}`, child);\r\n        if (!r.color) {\r\n          //hack to inject the next color\r\n          (<any>r).color = colors();\r\n        }\r\n        return r;\r\n      });\r\n      const path = prefix + name;\r\n      const label = node.label ? node.label : path;\r\n      return {path, name, children, label, color: node.color!, value: 0};\r\n    };\r\n    return add('', root);\r\n  }\r\n\r\n  get categories() {\r\n    return this.currentLeaves;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([HierarchyColumn.EVENT_COLOR_MAPPING_CHANGED, HierarchyColumn.EVENT_CUTOFF_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof HierarchyColumn.EVENT_CUTOFF_CHANGED, listener: typeof cutOffChanged | null): this;\r\n  on(type: typeof HierarchyColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_HC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    if (isFinite(this.currentMaxDepth)) {\r\n      r.maxDepth = this.currentMaxDepth;\r\n    }\r\n    if (this.currentNode !== this.hierarchy) {\r\n      r.cutOffNode = this.currentNode.path;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\r\n    if (typeof dump.maxDepth !== 'undefined') {\r\n      this.currentMaxDepth = dump.maxDepth;\r\n    }\r\n    if (typeof dump.cutOffNode !== 'undefined') {\r\n      const path = dump.cutOffNode.split(this.hierarchySeparator);\r\n      let node: Readonly<ICategoryInternalNode> | null = this.hierarchy;\r\n\r\n      let act = path.shift();\r\n      while (act && node) {\r\n        if (node.name !== act) {\r\n          node = null;\r\n          break;\r\n        }\r\n        const next = path.shift();\r\n        if (!next) {\r\n          break;\r\n        }\r\n        act = next;\r\n        node = node.children.find((d) => d.name === act) || null;\r\n      }\r\n      this.currentNode = node || this.hierarchy;\r\n    }\r\n\r\n    if (typeof dump.maxDepth !== 'undefined' || typeof dump.cutOffNode !== 'undefined') {\r\n      this.currentLeaves = computeLeaves(this.currentNode, this.currentMaxDepth);\r\n      this.updateCaches();\r\n    }\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  getCutOff(): ICutOffNode {\r\n    return {\r\n      node: this.currentNode,\r\n      maxDepth: this.currentMaxDepth\r\n    };\r\n  }\r\n\r\n  setCutOff(value: ICutOffNode) {\r\n    const maxDepth = value.maxDepth == null ? Infinity : value.maxDepth;\r\n    if (this.currentNode === value.node && this.currentMaxDepth === maxDepth) {\r\n      return;\r\n    }\r\n    const bak = this.getCutOff();\r\n    this.currentNode = value.node;\r\n    this.currentMaxDepth = maxDepth;\r\n    this.currentLeaves = computeLeaves(value.node, maxDepth);\r\n    this.updateCaches();\r\n    this.fire([HierarchyColumn.EVENT_CUTOFF_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getCutOff());\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    let v = super.getValue(row);\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    v = v.trim();\r\n    if (this.currentLeavesNameCache.has(v)) {\r\n      return this.currentLeavesNameCache.get(v)!;\r\n    }\r\n    if (this.currentLeavesPathCache.has(v)) {\r\n      return this.currentLeavesPathCache.get(v)!;\r\n    }\r\n    return this.currentLeaves.find((n) => {\r\n      //direct hit or is a child of it\r\n      return n.path === v || n.name === v || v!.startsWith(n.path + this.hierarchySeparator);\r\n    }) || null;\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.currentLeaves.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.currentLeaves.map((d) => d.label);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.name : null;\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return [this.getCategory(row)];\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    return [this.getCategory(row)];\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabel.call(this, row);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabels.call(this, row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getValues.call(this, row);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMap.call(this, row);\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getSet.call(this, row);\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    return CategoricalColumn.prototype.toCompareValue.call(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return CategoricalColumn.prototype.toCompareValueType.call(this);\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    const base = this.getCategory(row);\r\n    if (!base) {\r\n      return Object.assign({}, missingGroup);\r\n    }\r\n    return {name: base.label, color: base.color};\r\n  }\r\n\r\n  private updateCaches() {\r\n    this.currentLeavesPathCache.clear();\r\n    this.currentLeavesNameCache.clear();\r\n\r\n    this.currentLeaves.forEach((n) => {\r\n      this.currentLeavesPathCache.set(n.path, n);\r\n      this.currentLeavesNameCache.set(n.name, n);\r\n    });\r\n  }\r\n}\r\n\r\nfunction computeLeaves(node: ICategoryInternalNode, maxDepth: number = Infinity) {\r\n  const leaves: ICategoryInternalNode[] = [];\r\n  //depth first\r\n  const visit = (node: ICategoryInternalNode, depth: number) => {\r\n    //hit or end\r\n    if (depth >= maxDepth || node.children.length === 0) {\r\n      leaves.push(node);\r\n    } else {\r\n      // go down\r\n      node.children.forEach((c) => visit(c, depth + 1));\r\n    }\r\n  };\r\n  visit(node, 0);\r\n  return leaves;\r\n}\r\n\r\nexport function resolveInnerNodes(node: ICategoryInternalNode) {\r\n  //breath first\r\n  const queue: ICategoryInternalNode[] = [node];\r\n  let index = 0;\r\n  while (index < queue.length) {\r\n    const next = queue[index++];\r\n    for (const n of next.children) {\r\n      queue.push(n);\r\n    }\r\n  }\r\n  return queue;\r\n}\r\n\r\nexport function isHierarchical(categories: (string | Partial<ICategory>)[]) {\r\n  if (categories.length === 0 || typeof categories[0] === 'string') {\r\n    return false;\r\n  }\r\n  // check if any has a given parent name\r\n  return categories.some((c) => (<any>c).parent != null);\r\n}\r\n\r\nexport function deriveHierarchy(categories: (Partial<ICategory> & {parent: string | null})[]) {\r\n  const lookup = new Map<string, ICategoryNode>();\r\n  categories.forEach((c) => {\r\n    const p = c.parent || '';\r\n    // set and fill up proxy\r\n    const item = Object.assign(<ICategoryNode>{\r\n      children: [],\r\n      label: c.name!,\r\n      name: c.name!,\r\n      color: DEFAULT_COLOR,\r\n      value: 0\r\n    }, lookup.get(c.name!) || {}, c);\r\n    lookup.set(c.name!, item);\r\n\r\n    if (!lookup.has(p)) {\r\n      // create proxy\r\n      lookup.set(p, {name: p, children: [], label: p, value: 0, color: DEFAULT_COLOR});\r\n    }\r\n    lookup.get(p)!.children.push(item);\r\n  });\r\n  const root = lookup.get('')!;\r\n  console.assert(root !== undefined, 'hierarchy with no root');\r\n  if (root.children.length === 1) {\r\n    return root.children[0];\r\n  }\r\n  return root;\r\n}\r\n","import {interpolateBlues, interpolateGreens, interpolateGreys, interpolateOranges, interpolatePurples, interpolateReds, interpolateCool, interpolateCubehelixDefault, interpolateWarm, interpolatePlasma, interpolateMagma, interpolateViridis, interpolateInferno, interpolateYlOrRd, interpolateYlOrBr, interpolateBuGn, interpolateBuPu, interpolateGnBu, interpolateOrRd, interpolatePuBuGn, interpolatePuBu, interpolatePuRd, interpolateRdPu, interpolateYlGnBu, interpolateYlGn, interpolateRainbow, interpolateBrBG, interpolatePRGn, interpolatePiYG, interpolatePuOr, interpolateRdBu, interpolateRdGy, interpolateRdYlBu, interpolateRdYlGn, interpolateSpectral} from 'd3-scale-chromatic';\r\nimport {equal} from '../internal';\r\nimport {scaleLinear} from 'd3-scale';\r\nimport {IColorMappingFunction} from '.';\r\nimport {DEFAULT_COLOR, ITypedDump, ITypeFactory} from './interfaces';\r\nimport {IColorMappingFunctionConstructor} from './INumberColumn';\r\n\r\nexport class SequentialColorFunction implements IColorMappingFunction {\r\n  public static readonly FUNCTIONS: {[key: string]: (v: number) => string} = {\r\n    interpolateBlues,\r\n    interpolateGreens,\r\n    interpolateGreys,\r\n    interpolateOranges,\r\n    interpolatePurples,\r\n    interpolateReds,\r\n    interpolateCool,\r\n    interpolateCubehelixDefault,\r\n    interpolateWarm,\r\n    interpolatePlasma,\r\n    interpolateMagma,\r\n    interpolateViridis,\r\n    interpolateInferno,\r\n    interpolateYlOrRd,\r\n    interpolateYlOrBr,\r\n    interpolateBuGn,\r\n    interpolateBuPu,\r\n    interpolateGnBu,\r\n    interpolateOrRd,\r\n    interpolatePuBuGn,\r\n    interpolatePuBu,\r\n    interpolatePuRd,\r\n    interpolateRdPu,\r\n    interpolateYlGnBu,\r\n    interpolateYlGn,\r\n    interpolateRainbow\r\n  };\r\n\r\n  public readonly apply: (v: number) => string;\r\n\r\n  constructor(public readonly name: string) {\r\n    this.apply = SequentialColorFunction.FUNCTIONS[name] || interpolateBlues;\r\n  }\r\n\r\n  toJSON() {\r\n    return this.name;\r\n  }\r\n\r\n  clone() {\r\n    return this; // no clone needed since not parameterized\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof SequentialColorFunction && other.name === this.name;\r\n  }\r\n}\r\n\r\nexport class DivergentColorFunction implements IColorMappingFunction {\r\n  public static readonly FUNCTIONS: {[key: string]: (v: number) => string} = {\r\n    interpolateBrBG,\r\n    interpolatePRGn,\r\n    interpolatePiYG,\r\n    interpolatePuOr,\r\n    interpolateRdBu,\r\n    interpolateRdGy,\r\n    interpolateRdYlBu,\r\n    interpolateRdYlGn,\r\n    interpolateSpectral\r\n  };\r\n\r\n  public readonly apply: (v: number) => string;\r\n\r\n  constructor(public readonly name: string) {\r\n    this.apply = DivergentColorFunction.FUNCTIONS[name] || interpolateBlues;\r\n  }\r\n\r\n  toJSON() {\r\n    return this.name;\r\n  }\r\n\r\n  clone() {\r\n    return this; // no clone needed since not parameterized\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof DivergentColorFunction && other.name === this.name;\r\n  }\r\n}\r\n\r\n\r\nexport class UnknownColorFunction implements IColorMappingFunction {\r\n  constructor(public readonly apply: (v: number) => string) {\r\n  }\r\n\r\n  toJSON() {\r\n    return this.apply.toString();\r\n  }\r\n\r\n  clone() {\r\n    return this; // no clone needed since not parameterized\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof UnknownColorFunction && other.apply === this.apply;\r\n  }\r\n}\r\n\r\nexport class SolidColorFunction implements IColorMappingFunction {\r\n  constructor(public readonly color: string) {\r\n\r\n  }\r\n\r\n  apply() {\r\n    return this.color;\r\n  }\r\n\r\n  toJSON() {\r\n    return this.color;\r\n  }\r\n\r\n  clone() {\r\n    return this; // no clone needed since not parameterized\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof SolidColorFunction && other.color === this.color;\r\n  }\r\n}\r\n\r\nexport class QuantizedColorFunction implements IColorMappingFunction {\r\n  public readonly base: IColorMappingFunction;\r\n  public readonly steps: number;\r\n\r\n  constructor(dump: ITypedDump, factory: ITypeFactory);\r\n  constructor(base: IColorMappingFunction, steps: number)\r\n  constructor(base: IColorMappingFunction | ITypedDump, steps: number | ITypeFactory) {\r\n    if (typeof (<any>base).apply === 'function') {\r\n      this.base = <IColorMappingFunction>base;\r\n      this.steps = steps == null ? 5 : <number>steps;\r\n    } else {\r\n      const dump = <ITypedDump>base;\r\n      this.base = (<ITypeFactory>steps).colorMappingFunction(dump.base);\r\n      this.steps = dump.steps;\r\n    }\r\n  }\r\n\r\n  apply(v: number) {\r\n    return this.base.apply(quantize(v, this.steps));\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: 'quantized',\r\n      base: this.base.toJSON(),\r\n      steps: this.steps\r\n    };\r\n  }\r\n\r\n  clone(): QuantizedColorFunction {\r\n    return new QuantizedColorFunction(this.base.clone(), this.steps);\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof QuantizedColorFunction && other.base.eq(this.base) && other.steps === this.steps;\r\n  }\r\n}\r\n\r\nexport class CustomColorMappingFunction implements IColorMappingFunction {\r\n  private readonly scale = scaleLinear<string>();\r\n  public readonly entries: {value: number, color: string}[];\r\n\r\n  constructor(dump: ITypedDump);\r\n  constructor(entries: {value: number, color: string}[]);\r\n  constructor(entries: ITypedDump | {value: number, color: string}[]) {\r\n    this.entries = Array.isArray(entries) ? entries : entries.entries;\r\n    this.scale\r\n      .domain(this.entries.map((d) => d.value))\r\n      .range(this.entries.map((d) => d.color))\r\n      .clamp(true);\r\n  }\r\n\r\n  apply(v: number) {\r\n    return this.scale(v);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: 'custom',\r\n      entries: this.entries\r\n    };\r\n  }\r\n\r\n  clone() {\r\n    return new CustomColorMappingFunction(this.entries.slice());\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof CustomColorMappingFunction && equal(this.entries, other.entries);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function quantize(v: number, steps: number) {\r\n  const perStep = 1 / steps;\r\n  if (v <= perStep) {\r\n    return 0;\r\n  }\r\n  if (v >= (1 - perStep)) {\r\n    return 1;\r\n  }\r\n  for (let acc = 0; acc < 1; acc += perStep) {\r\n    if (v < acc) {\r\n      return acc - perStep / 2; // center\r\n    }\r\n  }\r\n  return v;\r\n}\r\n\r\nexport function colorMappingFunctions() {\r\n  const types: any = {\r\n    [DEFAULT_COLOR]: SolidColorFunction,\r\n    quantized: QuantizedColorFunction,\r\n    custom: CustomColorMappingFunction\r\n  };\r\n  for (const key of Object.keys(SequentialColorFunction.FUNCTIONS)) {\r\n    types[key] = SequentialColorFunction;\r\n  }\r\n  for (const key of Object.keys(DivergentColorFunction.FUNCTIONS)) {\r\n    types[key] = DivergentColorFunction;\r\n  }\r\n  return types;\r\n}\r\n\r\nexport const DEFAULT_COLOR_FUNCTION = new SolidColorFunction(DEFAULT_COLOR);\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function createColorMappingFunction(types: {[type: string]: IColorMappingFunctionConstructor}, factory: ITypeFactory) {\r\n  return (dump: ITypedDump | string | ((v: number) => string)): IColorMappingFunction => {\r\n    if (!dump) {\r\n      return DEFAULT_COLOR_FUNCTION;\r\n    }\r\n    if (typeof dump === 'function') {\r\n      return new UnknownColorFunction(dump);\r\n    }\r\n    const typeName = typeof dump === 'string' ? dump : dump.type;\r\n    const type = types[typeName];\r\n    if (type) {\r\n      return new type(dump, factory);\r\n    }\r\n    if (Array.isArray(dump)) {\r\n      return new CustomColorMappingFunction(dump);\r\n    }\r\n    return new SolidColorFunction(dump.toString());\r\n  };\r\n}\r\n","import {suffix, IEventListener, ISequence} from '../internal';\r\nimport {toolbar, SortByDefault} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IDataRow, IGroup, IColumnDesc, DEFAULT_COLOR} from './interfaces';\r\nimport {isNumberColumn, INumberColumn, isMapAbleColumn, IColorMappingFunction, IMappingFunction, IMapAbleColumn, INumberFilter} from './INumberColumn';\r\nimport NumberColumn from './NumberColumn';\r\nimport {DEFAULT_FORMATTER, noNumberFilter} from './internalNumber';\r\nimport {ScaleMappingFunction} from './MappingFunction';\r\nimport {DEFAULT_COLOR_FUNCTION} from './ColorMappingFunction';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createImpositionDesc(label: string = 'Imposition') {\r\n  return {type: 'imposition', label};\r\n}\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf ImpositionCompositeColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_ICC(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf ImpositionCompositeColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_ICC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\r\n@SortByDefault('descending')\r\nexport default class ImpositionCompositeColumn extends CompositeColumn implements INumberColumn, IMapAbleColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'number',\r\n      groupRenderer: 'boxplot',\r\n      summaryRenderer: 'histogram'\r\n    }));\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Imposition' || c.length === 0) {\r\n      return l;\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].label;\r\n    }\r\n    const w = this.wrapper;\r\n    const rest = this.rest;\r\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\r\n  }\r\n\r\n  private get wrapper(): INumberColumn | null {\r\n    return <INumberColumn>this._children.find(isNumberColumn) || null;\r\n  }\r\n\r\n  private get rest() {\r\n    const w = this.wrapper;\r\n    return this._children.filter((d) => d !== w);\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_ICC | null): this;\r\n  on(type: typeof ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_ICC | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const c = this._children;\r\n    if (c.length === 0) {\r\n      return '';\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].getLabel(row);\r\n    }\r\n    const w = this.wrapper;\r\n    const rest = this.rest;\r\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`).join(', ')})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const c = this._children;\r\n    switch (c.length) {\r\n      case 0:\r\n        return DEFAULT_COLOR;\r\n      case 1:\r\n        return c[0].getColor(row);\r\n      default:\r\n        return this.rest[0].getColor(row);\r\n    }\r\n  }\r\n\r\n  getNumberFormat() {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValue(row) : NaN;\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumber(row) : NaN;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumber(row) : NaN;\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    return [this.getNumber(row)];\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    return [this.getRawNumber(row)];\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      const value = this.getRawNumber(row);\r\n      if (isNaN(value)) {\r\n        return null;\r\n      }\r\n      return {\r\n        label: this.getLabel(row),\r\n        color: this.getColor(row),\r\n        value\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  getMapping() {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.getMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.getOriginalMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction): void {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.setMapping(mapping) : undefined;\r\n  }\r\n\r\n  getColorMapping() {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.setColorMapping(mapping) : undefined;\r\n  }\r\n\r\n  getFilter() {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.getFilter() : noNumberFilter();\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null): void {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.setFilter(value) : undefined;\r\n  }\r\n\r\n  getRange(): [string, string] {\r\n    const w = this.wrapper;\r\n    return w && isMapAbleColumn(w) ? w.getRange() : ['0', '1'];\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    return NumberColumn.prototype.toCompareValue.call(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return NumberColumn.prototype.toCompareValueType.call(this);\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\r\n    return NumberColumn.prototype.toCompareGroupValue.call(this, rows, group);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return NumberColumn.prototype.toCompareGroupValueType.call(this);\r\n  }\r\n\r\n  insert(col: Column, index: number): Column | null {\r\n    if (this._children.length === 1 && !this.wrapper && !isNumberColumn(col)) {\r\n      // at least one has to be a number column\r\n      return null;\r\n    }\r\n    if (this._children.length >= 2) {\r\n      // limit to two\r\n      return null;\r\n    }\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    if (isNumberColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.insertImpl(col, index);\r\n  }\r\n\r\n  protected removeImpl(child: Column, index: number) {\r\n    if (isNumberColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.removeImpl(child, index);\r\n  }\r\n}\r\n","import {format} from 'd3-format';\r\nimport {boxplotBuilder, IAdvancedBoxPlotData, IEventListener} from '../internal';\r\nimport {dialogAddons, SortByDefault, toolbar} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, groupRendererChanged, labelChanged, metaDataChanged, rendererTypeChanged, summaryRendererChanged, visibilityChanged, widthChanged} from './Column';\r\nimport {IArrayDesc} from './IArrayColumn';\r\nimport {IDataRow, ECompareValueType, ITypeFactory} from './interfaces';\r\nimport {DEFAULT_FORMATTER, getBoxPlotNumber, isDummyNumberFilter, noNumberFilter, restoreNumberFilter, toCompareBoxPlotValue} from './internalNumber';\r\nimport {EAdvancedSortMethod, IColorMappingFunction, IMappingFunction, INumberDesc, INumberFilter, INumbersColumn} from './INumberColumn';\r\nimport {restoreMapping} from './MappingFunction';\r\nimport {isMissingValue} from './missing';\r\nimport NumberColumn from './NumberColumn';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\nexport interface INumbersDesc extends IArrayDesc, INumberDesc {\r\n  readonly sort?: EAdvancedSortMethod;\r\n}\r\n\r\nexport declare type INumbersColumnDesc = INumbersDesc & IArrayColumnDesc<number>;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf NumbersColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_NCS(previous: IMappingFunction, current: IMappingFunction): void;\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf NumbersColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_NCS(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf NumbersColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged_NCS(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf NumbersColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_NCS(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortNumbers')\r\n@SortByDefault('descending')\r\nexport default class NumbersColumn extends ArrayColumn<number> implements INumbersColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\r\n\r\n  static readonly CENTER = 0;\r\n\r\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\r\n\r\n  private sort: EAdvancedSortMethod;\r\n  private mapping: IMappingFunction;\r\n  private original: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n  constructor(id: string, desc: Readonly<INumbersColumnDesc>, factory: ITypeFactory) {\r\n    super(id, integrateDefaults(desc, Object.assign({\r\n      renderer: 'heatmap',\r\n      groupRenderer: 'heatmap',\r\n      summaryRenderer: 'histogram'\r\n    }, desc.dataLength != null && !Number.isNaN(desc.dataLength) ? {\r\n      // better initialize the default with based on the data length\r\n      width: Math.min(Math.max(100, desc.dataLength! * 10), 500)\r\n    } : {})));\r\n    this.mapping = restoreMapping(desc, factory);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\r\n\r\n    if (desc.numberFormat) {\r\n      this.numberFormat = format(desc.numberFormat);\r\n    }\r\n\r\n    this.sort = desc.sort || EAdvancedSortMethod.median;\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return this.numberFormat;\r\n  }\r\n\r\n  toCompareValue(row: IDataRow): number {\r\n    return toCompareBoxPlotValue(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return ECompareValueType.FLOAT;\r\n  }\r\n\r\n  getRawNumbers(row: IDataRow) {\r\n    return this.getRawValue(row);\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n    const b = boxplotBuilder();\r\n    for (const d of data) {\r\n      b.push(isMissingValue(d) ? NaN : this.mapping.apply(d));\r\n    }\r\n    return b.build();\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(this.numberFormat);\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n    const b = boxplotBuilder();\r\n    for (const d of data) {\r\n      b.push(isMissingValue(d) ? NaN : d);\r\n    }\r\n    return b.build();\r\n  }\r\n\r\n  getNumbers(row: IDataRow) {\r\n    return this.getValues(row);\r\n  }\r\n\r\n  getNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'normalized');\r\n  }\r\n\r\n  getRawNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'raw');\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getValues(row);\r\n    return v.every(isNaN) ? null : v;\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return this.getRawValue(row).map((d) => isNaN(d) ? NaN : this.mapping.apply(d));\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    const v = this.getNumbers(row);\r\n    if (v.every(isNaN)) {\r\n      // missing row\r\n      return [NaN];\r\n    }\r\n    return v;\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    const v = this.getRawNumbers(row);\r\n    if (v.every(isNaN)) {\r\n      // missing row\r\n      return [NaN];\r\n    }\r\n    return v;\r\n  }\r\n\r\n  getRawValue(row: IDataRow) {\r\n    const r = super.getRaw(row);\r\n    return r == null ? [] : r.map((d) => isMissingValue(d) ? NaN : +d);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getRawValue(row).map(this.numberFormat);\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EAdvancedSortMethod) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire([NumbersColumn.EVENT_SORTMETHOD_CHANGED, NumberColumn.EVENT_DIRTY_HEADER, NumberColumn.EVENT_DIRTY_VALUES, NumbersColumn.EVENT_DIRTY_CACHES, NumberColumn.EVENT_DIRTY], this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\r\n    r.map = this.mapping.toJSON();\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.map || dump.domain) {\r\n      this.mapping = restoreMapping(dump, factory);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, NumbersColumn.EVENT_MAPPING_CHANGED, NumbersColumn.EVENT_SORTMETHOD_CHANGED, NumbersColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NCS | null): this;\r\n  on(type: typeof NumbersColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NCS | null): this;\r\n  on(type: typeof NumbersColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NCS | null): this;\r\n  on(type: typeof NumbersColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NCS | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumbersColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return NumberColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return NumberColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return NumberColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null) {\r\n    NumberColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return NumberColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  clearFilter() {\r\n    return NumberColumn.prototype.clearFilter.call(this);\r\n  }\r\n}\r\n\r\n","import {IBoxPlotData} from '../internal';\r\nimport {suffix, ISequence, IEventListener} from '../internal';\r\nimport {toolbar, SortByDefault, dialogAddons} from './annotations';\r\nimport BoxPlotColumn from './BoxPlotColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IDataRow, IGroup, IColumnDesc, DEFAULT_COLOR} from './interfaces';\r\nimport {ESortMethod, IBoxPlotColumn, INumberFilter, isBoxPlotColumn, IMappingFunction, IColorMappingFunction, isMapAbleColumn} from './INumberColumn';\r\nimport {ScaleMappingFunction} from './MappingFunction';\r\nimport NumbersColumn from './NumbersColumn';\r\nimport {DEFAULT_COLOR_FUNCTION} from './ColorMappingFunction';\r\nimport {DEFAULT_FORMATTER, noNumberFilter} from './internalNumber';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createImpositionBoxPlotDesc(label: string = 'Imposition') {\r\n  return {type: 'impositions', label};\r\n}\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf ImpositionBoxPlotColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_IPBC(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf ImpositionBoxPlotColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_IPBC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortBoxPlot')\r\n@SortByDefault('descending')\r\nexport default class ImpositionBoxPlotColumn extends CompositeColumn implements IBoxPlotColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'boxplot',\r\n      groupRenderer: 'boxplot',\r\n      summaryRenderer: 'boxplot'\r\n    }));\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Imposition' || c.length === 0) {\r\n      return l;\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].label;\r\n    }\r\n    const w = this.wrapper;\r\n    const rest = this.rest;\r\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\r\n  }\r\n\r\n  private get wrapper(): IBoxPlotColumn | null {\r\n    return <IBoxPlotColumn>this._children.find(isBoxPlotColumn) || null;\r\n  }\r\n\r\n  private get rest() {\r\n    const w = this.wrapper;\r\n    return this._children.filter((d) => d !== w);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const c = this._children;\r\n    if (c.length === 0) {\r\n      return '';\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].getLabel(row);\r\n    }\r\n    const w = this.wrapper;\r\n    const rest = this.rest;\r\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const c = this._children;\r\n    switch (c.length) {\r\n      case 0:\r\n        return DEFAULT_COLOR;\r\n      case 1:\r\n        return c[0].getColor(row);\r\n      default:\r\n        return this.rest[0].getColor(row);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_IPBC | null): this;\r\n  on(type: typeof ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_IPBC | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getNumberFormat() {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValue(row) : null;\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumber(row) : NaN;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumber(row) : NaN;\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    return [this.getNumber(row)];\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    return [this.getRawNumber(row)];\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      const value = this.getRawNumber(row);\r\n      if (isNaN(value)) {\r\n        return null;\r\n      }\r\n      return {\r\n        label: this.getLabel(row),\r\n        color: this.getColor(row),\r\n        value\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getBoxPlotData(row) : null;\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawBoxPlotData(row) : null;\r\n  }\r\n\r\n  getMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getSortMethod() {\r\n    const w = this.wrapper;\r\n    return w ? w.getSortMethod() : ESortMethod.min;\r\n  }\r\n\r\n  setSortMethod(value: ESortMethod) {\r\n    const w = this.wrapper;\r\n    return w ? w.setSortMethod(value) : undefined;\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setMapping(mapping) : undefined;\r\n  }\r\n\r\n  getColorMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    const w = this.wrapper;\r\n    return w ? w.setColorMapping(mapping) : undefined;\r\n  }\r\n\r\n  getFilter() {\r\n    const w = this.wrapper;\r\n    return w ? w.getFilter() : noNumberFilter();\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setFilter(value) : undefined;\r\n  }\r\n\r\n  getRange(): [string, string] {\r\n    const w = this.wrapper;\r\n    return w ? w.getRange() : ['0', '1'];\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    return BoxPlotColumn.prototype.toCompareValue.call(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return BoxPlotColumn.prototype.toCompareValueType.call(this);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    return BoxPlotColumn.prototype.group.call(this, row);\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\r\n    return BoxPlotColumn.prototype.toCompareGroupValue.call(this, rows, group);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return BoxPlotColumn.prototype.toCompareGroupValueType.call(this);\r\n  }\r\n\r\n  insert(col: Column, index: number): Column | null {\r\n    if (this._children.length === 1 && !this.wrapper && !isBoxPlotColumn(col)) {\r\n      // at least one has to be a number column\r\n      return null;\r\n    }\r\n    if (this._children.length >= 2) {\r\n      // limit to two\r\n      return null;\r\n    }\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    if (isBoxPlotColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    } else if (isMapAbleColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.insertImpl(col, index);\r\n  }\r\n\r\n  protected removeImpl(child: Column, index: number) {\r\n    if (isBoxPlotColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    } else if (isMapAbleColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.removeImpl(child, index);\r\n  }\r\n}\r\n","import {suffix, IEventListener, IAdvancedBoxPlotData} from '../internal';\r\nimport {toolbar, dialogAddons, SortByDefault} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {IDataRow, IGroup, IColumnDesc, DEFAULT_COLOR} from './interfaces';\r\nimport {EAdvancedSortMethod, INumberFilter, INumbersColumn, isNumbersColumn, IMappingFunction, IColorMappingFunction, isMapAbleColumn} from './INumberColumn';\r\nimport {ScaleMappingFunction} from './MappingFunction';\r\nimport NumbersColumn from './NumbersColumn';\r\nimport {DEFAULT_COLOR_FUNCTION} from './ColorMappingFunction';\r\nimport {DEFAULT_FORMATTER, noNumberFilter} from './internalNumber';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createImpositionsDesc(label: string = 'Imposition') {\r\n  return {type: 'impositions', label};\r\n}\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf ImpositionCompositesColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_ICCS(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf ImpositionCompositesColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_ICCS(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortNumbers')\r\n@SortByDefault('descending')\r\nexport default class ImpositionCompositesColumn extends CompositeColumn implements INumbersColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'numbers',\r\n      groupRenderer: 'numbers',\r\n      summaryRenderer: 'histogram'\r\n    }));\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Imposition' || c.length === 0) {\r\n      return l;\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].label;\r\n    }\r\n    const w = this.wrapper;\r\n    const rest = this.rest;\r\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\r\n  }\r\n\r\n  private get wrapper(): INumbersColumn | null {\r\n    return <INumbersColumn>this._children.find(isNumbersColumn) || null;\r\n  }\r\n\r\n  private get rest() {\r\n    const w = this.wrapper;\r\n    return this._children.filter((d) => d !== w);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const c = this._children;\r\n    if (c.length === 0) {\r\n      return '';\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].getLabel(row);\r\n    }\r\n    const w = this.wrapper;\r\n    const rest = this.rest;\r\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const c = this._children;\r\n    switch (c.length) {\r\n      case 0:\r\n        return DEFAULT_COLOR;\r\n      case 1:\r\n        return c[0].getColor(row);\r\n      default:\r\n        return this.rest[0].getColor(row);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ImpositionCompositesColumn.EVENT_MAPPING_CHANGED, ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_ICCS | null): this;\r\n  on(type: typeof ImpositionCompositesColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_ICCS | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  get labels() {\r\n    const w = this.wrapper;\r\n    return w ? w.labels : [];\r\n  }\r\n\r\n  get dataLength() {\r\n    const w = this.wrapper;\r\n    return w ? w.dataLength : null;\r\n  }\r\n\r\n  getNumberFormat() {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValue(row) : [];\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumber(row) : NaN;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumber(row) : NaN;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      const value = this.getRawNumber(row);\r\n      if (isNaN(value)) {\r\n        return null;\r\n      }\r\n      return {\r\n        label: this.getLabels(row),\r\n        color: this.getColor(row)\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  getNumbers(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumbers(row) : [];\r\n  }\r\n\r\n  getRawNumbers(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumbers(row) : [];\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    return this.getNumbers(row);\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    return this.getRawNumbers(row);\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getBoxPlotData(row) : null;\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawBoxPlotData(row) : null;\r\n  }\r\n\r\n  getMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getSortMethod() {\r\n    const w = this.wrapper;\r\n    return w ? w.getSortMethod() : EAdvancedSortMethod.min;\r\n  }\r\n\r\n  setSortMethod(value: EAdvancedSortMethod) {\r\n    const w = this.wrapper;\r\n    return w ? w.setSortMethod(value) : undefined;\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setMapping(mapping) : undefined;\r\n  }\r\n\r\n  getColorMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    const w = this.wrapper;\r\n    return w ? w.setColorMapping(mapping) : undefined;\r\n  }\r\n\r\n  getFilter() {\r\n    const w = this.wrapper;\r\n    return w ? w.getFilter() : noNumberFilter();\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setFilter(value) : undefined;\r\n  }\r\n\r\n  getRange(): [string, string] {\r\n    const w = this.wrapper;\r\n    return w ? w.getRange() : ['0', '1'];\r\n  }\r\n\r\n  getMap(row: IDataRow): IKeyValue<number>[] {\r\n    const w = this.wrapper;\r\n    return w ? w.getMap(row) : [];\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getMapLabel(row) : [];\r\n  }\r\n\r\n  getLabels(row: IDataRow): string[] {\r\n    const w = this.wrapper;\r\n    return w ? w.getLabels(row) : [];\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValues(row) : [];\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    return NumbersColumn.prototype.toCompareValue.call(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return NumbersColumn.prototype.toCompareValueType.call(this);\r\n  }\r\n\r\n  toCompareGroupValue(rows: IDataRow[], group: IGroup) {\r\n    return NumbersColumn.prototype.toCompareGroupValue.call(this, rows, group);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return NumbersColumn.prototype.toCompareGroupValueType.call(this);\r\n  }\r\n\r\n  insert(col: Column, index: number): Column | null {\r\n    if (this._children.length === 1 && !this.wrapper && !isNumbersColumn(col)) {\r\n      // at least one has to be a number column\r\n      return null;\r\n    }\r\n    if (this._children.length >= 2) {\r\n      // limit to two\r\n      return null;\r\n    }\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    if (isNumbersColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.insertImpl(col, index);\r\n  }\r\n\r\n  protected removeImpl(child: Column, index: number) {\r\n    if (isNumbersColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.removeImpl(child, index);\r\n  }\r\n}\r\n","import {format} from 'd3-format';\r\nimport CompositeColumn from './CompositeColumn';\r\nimport {IDataRow, IGroup, IColumnDesc} from './interfaces';\r\nimport {isMissingValue} from './missing';\r\nimport NumberColumn from './NumberColumn';\r\nimport {SortByDefault, toolbar} from './annotations';\r\nimport {ISequence} from '../internal';\r\nimport {INumberColumn} from './INumberColumn';\r\n\r\nexport interface ICompositeNumberDesc extends IColumnDesc {\r\n  /**\r\n   * d3 format number Format\r\n   * @default 0.3n\r\n   */\r\n  numberFormat?: string;\r\n}\r\n\r\nexport declare type ICompositeNumberColumnDesc = ICompositeNumberDesc & IColumnDesc;\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'groupBy')\r\n@SortByDefault('descending')\r\nexport default class CompositeNumberColumn extends CompositeColumn implements INumberColumn {\r\n  private readonly numberFormat: (n: number) => string = format('.3n');\r\n\r\n  constructor(id: string, desc: Readonly<ICompositeNumberColumnDesc>) {\r\n    super(id, desc);\r\n\r\n    if (desc.numberFormat) {\r\n      this.numberFormat = format(desc.numberFormat);\r\n    }\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return this.numberFormat;\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    if (!this.isLoaded()) {\r\n      return '';\r\n    }\r\n    const v = this.getValue(row);\r\n    //keep non number if it is not a number else convert using formatter\r\n    return String(typeof v === 'number' && !isNaN(v) && isFinite(v) ? this.numberFormat(v) : v);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    if (!this.isLoaded()) {\r\n      return null;\r\n    }\r\n    //weighted sum\r\n    const v = this.compute(row);\r\n    if (isMissingValue(v)) {\r\n      return null;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  protected compute(_row: IDataRow) {\r\n    return NaN;\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const r = this.getValue(row);\r\n    return r == null ? NaN : r;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    return this.getNumber(row);\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    return [this.getNumber(row)];\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    return [this.getRawNumber(row)];\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    return NumberColumn.prototype.toCompareValue.call(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return NumberColumn.prototype.toCompareValueType.call(this);\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\r\n    return NumberColumn.prototype.toCompareGroupValue.call(this, rows, group);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return NumberColumn.prototype.toCompareGroupValueType.call(this);\r\n  }\r\n\r\n  getRenderer(): string {\r\n    return NumberColumn.prototype.getRenderer.call(this);\r\n  }\r\n}\r\n","import {median, quantile, IEventListener} from '../internal';\r\nimport {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport CompositeNumberColumn, {ICompositeNumberColumnDesc} from './CompositeNumberColumn';\r\nimport {IDataRow, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport {EAdvancedSortMethod} from './INumberColumn';\r\nimport {integrateDefaults} from './internal';\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createReduceDesc(label: string = 'Reduce') {\r\n  return {type: 'reduce', label};\r\n}\r\n\r\nexport interface IReduceDesc {\r\n  readonly reduce?: EAdvancedSortMethod;\r\n}\r\n\r\n\r\nexport declare type IReduceColumnDesc = IReduceDesc & ICompositeNumberColumnDesc;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf ReduceColumn\r\n * @event\r\n */\r\nexport declare function reduceChanged(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * combines multiple columns by using the maximal value\r\n */\r\n@toolbar('reduce')\r\nexport default class ReduceColumn extends CompositeNumberColumn {\r\n  static readonly EVENT_REDUCE_CHANGED = 'reduceChanged';\r\n\r\n  private reduce: EAdvancedSortMethod;\r\n\r\n  constructor(id: string, desc: Readonly<IReduceColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'interleaving',\r\n      groupRenderer: 'interleaving',\r\n      summaryRenderer: 'interleaving'\r\n    }));\r\n    this.reduce = desc.reduce || EAdvancedSortMethod.max;\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    if (l !== 'Reduce') {\r\n      return l;\r\n    }\r\n    return `${this.reduce[0].toUpperCase()}${this.reduce.slice(1)}(${this.children.map((d) => d.label).join(', ')})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    //compute the index of the maximal one\r\n    const c = this._children;\r\n    if (c.length === 0 || this.reduce === EAdvancedSortMethod.q1 || this.reduce === EAdvancedSortMethod.q3 || this.reduce === EAdvancedSortMethod.mean) {\r\n      return DEFAULT_COLOR;\r\n    }\r\n    const v = this.compute(row);\r\n    const selected = c.find((c) => c.getValue(row) === v);\r\n    return selected ? selected.getColor(row) : DEFAULT_COLOR;\r\n  }\r\n\r\n  protected compute(row: IDataRow) {\r\n    const vs = this._children.map((d) => d.getValue(row)).filter((d) => !isNaN(d));\r\n    if (vs.length === 0) {\r\n      return NaN;\r\n    }\r\n    switch (this.reduce) {\r\n      case EAdvancedSortMethod.mean:\r\n        return vs.reduce((a, b) => a + b, 0) / vs.length;\r\n      case EAdvancedSortMethod.max:\r\n        return vs.reduce((a, b) => Math.max(a, b), Number.NEGATIVE_INFINITY);\r\n      case EAdvancedSortMethod.min:\r\n        return vs.reduce((a, b) => Math.min(a, b), Number.POSITIVE_INFINITY);\r\n      case EAdvancedSortMethod.median:\r\n        return median(vs)!;\r\n      case EAdvancedSortMethod.q1:\r\n        return quantile(vs.sort((a, b) => a - b), 0.25)!;\r\n      case EAdvancedSortMethod.q3:\r\n        return quantile(vs.sort((a, b) => a - b), 0.75)!;\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ReduceColumn.EVENT_REDUCE_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ReduceColumn.EVENT_REDUCE_CHANGED, listener: typeof reduceChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getReduce() {\r\n    return this.reduce;\r\n  }\r\n\r\n  setReduce(reduce: EAdvancedSortMethod) {\r\n    if (this.reduce === reduce) {\r\n      return;\r\n    }\r\n    this.fire([ReduceColumn.EVENT_REDUCE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.reduce, this.reduce = reduce);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.reduce = this.reduce;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    this.reduce = dump.reduce || this.reduce;\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  get canJustAddNumbers() {\r\n    return true;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n}\r\n","import {round, IEventListener, similar} from '../internal';\r\nimport {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport CompositeNumberColumn, {ICompositeNumberDesc} from './CompositeNumberColumn';\r\nimport {IDataRow, IFlatColumn, IMultiLevelColumn, ITypeFactory} from './interfaces';\r\nimport {integrateDefaults} from './internal';\r\n\r\n/**\r\n * factory for creating a description creating a stacked column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createStackDesc(label: string = 'Weighted Sum') {\r\n  return {type: 'stack', label};\r\n}\r\n\r\n\r\n/**\r\n * emitted when the collapse property changes\r\n * @asMemberOf StackColumn\r\n * @event\r\n */\r\nexport declare function collapseChanged(previous: boolean, current: boolean): void;\r\n\r\n\r\n/**\r\n * emitted when the weights change\r\n * @asMemberOf StackColumn\r\n * @event\r\n */\r\nexport declare function weightsChanged(previous: number[], current: number[]): void;\r\n\r\n\r\n/**\r\n * emitted when the ratios between the children changes\r\n * @asMemberOf StackColumn\r\n * @event\r\n */\r\nexport declare function nestedChildRatio(previous: number[], current: number[]): void;\r\n\r\n/**\r\n * implementation of the stacked column\r\n */\r\n@toolbar('editWeights', 'compress', 'expand')\r\nexport default class StackColumn extends CompositeNumberColumn implements IMultiLevelColumn {\r\n  static readonly EVENT_COLLAPSE_CHANGED = 'collapseChanged';\r\n  static readonly EVENT_WEIGHTS_CHANGED = 'weightsChanged';\r\n  static readonly EVENT_MULTI_LEVEL_CHANGED = 'nestedChildRatio';\r\n\r\n  static readonly COLLAPSED_RENDERER = 'number';\r\n\r\n  private readonly adaptChange: (old: number, newValue: number) => void;\r\n\r\n  /**\r\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  private collapsed = false;\r\n\r\n  constructor(id: string, desc: ICompositeNumberDesc) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'stack',\r\n      groupRenderer: 'stack',\r\n      summaryRenderer: 'default'\r\n    }));\r\n\r\n    const that = this;\r\n    this.adaptChange = function (this: {source: Column}, oldValue, newValue) {\r\n      that.adaptWidthChange(this.source, oldValue, newValue);\r\n    };\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Weighted Sum' || c.length === 0) {\r\n      return l;\r\n    }\r\n    const weights = this.getWeights();\r\n    return c.map((c, i) => `${c.label} (${round(100 * weights[i], 1)}%)`).join(' + ');\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([StackColumn.EVENT_COLLAPSE_CHANGED, StackColumn.EVENT_WEIGHTS_CHANGED, StackColumn.EVENT_MULTI_LEVEL_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof StackColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged | null): this;\r\n  on(type: typeof StackColumn.EVENT_WEIGHTS_CHANGED, listener: typeof weightsChanged | null): this;\r\n  on(type: typeof StackColumn.EVENT_MULTI_LEVEL_CHANGED, listener: typeof nestedChildRatio | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  setCollapsed(value: boolean) {\r\n    if (this.collapsed === value) {\r\n      return;\r\n    }\r\n    this.fire([StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.collapsed, this.collapsed = value);\r\n  }\r\n\r\n  getCollapsed() {\r\n    return this.collapsed;\r\n  }\r\n\r\n  get canJustAddNumbers() {\r\n    return true;\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    let self = null;\r\n    const children = levelsToGo <= Column.FLAT_ALL_COLUMNS ? this._children : this._children.filter((c) => c.isVisible());\r\n    //no more levels or just this one\r\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n      let w = this.getWidth();\r\n      if (!this.collapsed) {\r\n        w += (children.length - 1) * padding;\r\n      }\r\n      r.push(self = {col: this, offset, width: w});\r\n      if (levelsToGo === 0) {\r\n        return w;\r\n      }\r\n    }\r\n    //push children\r\n    let acc = offset;\r\n    children.forEach((c) => {\r\n      acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\r\n    });\r\n    if (self) { //nesting my even increase my width\r\n      self.width = acc - offset - padding;\r\n    }\r\n    return acc - offset - padding;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.collapsed = this.collapsed;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    this.collapsed = dump.collapsed === true;\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  /**\r\n   * inserts a column at a the given position\r\n   */\r\n  insert(col: Column, index: number, weight = NaN) {\r\n    if (!isNaN(weight)) {\r\n      col.setWidth((weight / (1 - weight) * this.getWidth()));\r\n    }\r\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\r\n    //increase my width\r\n    super.setWidth(this.length === 0 ? col.getWidth() : (this.getWidth() + col.getWidth()));\r\n\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  push(col: Column, weight = NaN) {\r\n    return this.insert(col, this.length, weight);\r\n  }\r\n\r\n  insertAfter(col: Column, ref: Column, weight = NaN) {\r\n    const i = this.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.insert(col, i + 1, weight);\r\n  }\r\n\r\n  /**\r\n   * adapts weights according to an own width change\r\n   * @param col\r\n   * @param oldValue\r\n   * @param newValue\r\n   */\r\n  private adaptWidthChange(col: Column, oldValue: number, newValue: number) {\r\n    if (similar(oldValue, newValue, 0.5)) {\r\n      return;\r\n    }\r\n    const bak = this.getWeights();\r\n    const full = this.getWidth(),\r\n      change = (newValue - oldValue) / full;\r\n    const oldWeight = oldValue / full;\r\n    const factor = (1 - oldWeight - change) / (1 - oldWeight);\r\n    const widths = this._children.map((c) => {\r\n      if (c === col) {\r\n        //c.weight += change;\r\n        return newValue;\r\n      }\r\n      const guess = c.getWidth() * factor;\r\n      const w = isNaN(guess) || guess < 1 ? 0 : guess;\r\n      c.setWidthImpl(w);\r\n      return w;\r\n    });\r\n    //adapt width if needed\r\n    super.setWidth(widths.reduce((a, b) => a + b, 0));\r\n\r\n    this.fire([StackColumn.EVENT_WEIGHTS_CHANGED, StackColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], bak, this.getWeights());\r\n  }\r\n\r\n  getWeights() {\r\n    const w = this.getWidth();\r\n    return this._children.map((d) => d.getWidth() / w);\r\n  }\r\n\r\n  setWeights(weights: number[]) {\r\n    const bak = this.getWeights();\r\n    const delta = weights.length - this.length;\r\n    let s: number;\r\n    if (delta < 0) {\r\n      s = weights.reduce((p, a) => p + a, 0);\r\n      if (s <= 1) {\r\n        for (let i = 0; i < -delta; ++i) {\r\n          weights.push((1 - s) * (1 / -delta));\r\n        }\r\n      } else if (s <= 100) {\r\n        for (let i = 0; i < -delta; ++i) {\r\n          weights.push((100 - s) * (1 / -delta));\r\n        }\r\n      }\r\n    }\r\n    weights = weights.slice(0, this.length);\r\n    s = weights.reduce((p, a) => p + a, 0) / this.getWidth();\r\n    weights = weights.map((d) => d / s);\r\n\r\n    this._children.forEach((c, i) => {\r\n      c.setWidthImpl(weights[i]);\r\n    });\r\n    this.fire([StackColumn.EVENT_WEIGHTS_CHANGED, StackColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], bak, weights);\r\n\r\n  }\r\n\r\n  removeImpl(child: Column, index: number) {\r\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\r\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\r\n    return super.removeImpl(child, index);\r\n  }\r\n\r\n  setWidth(value: number) {\r\n    const factor = value / this.getWidth();\r\n    this._children.forEach((child) => {\r\n      //disable since we change it\r\n      child.setWidthImpl(child.getWidth() * factor);\r\n    });\r\n    super.setWidth(value);\r\n  }\r\n\r\n  protected compute(row: IDataRow) {\r\n    const w = this.getWidth();\r\n    return this._children.reduce((acc, d) => acc + d.getValue(row) * (d.getWidth() / w), 0);\r\n  }\r\n\r\n  getRenderer() {\r\n    if (this.getCollapsed() && this.isLoaded()) {\r\n      return StackColumn.COLLAPSED_RENDERER;\r\n    }\r\n    return super.getRenderer();\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n}\r\n","import {similar, IEventListener} from '../internal';\r\nimport {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IDataRow, IColumnDesc, IFlatColumn, IMultiLevelColumn, ITypeFactory} from './interfaces';\r\nimport StackColumn from './StackColumn';\r\n\r\n\r\n/**\r\n * emitted when the collapse property changes\r\n * @asMemberOf MultiLevelCompositeColumn\r\n * @event\r\n */\r\nexport declare function collapseChanged_MC(previous: boolean, current: boolean): void;\r\n\r\n/**\r\n * emitted when the ratios between the children changes\r\n * @asMemberOf MultiLevelCompositeColumn\r\n * @event\r\n */\r\nexport declare function nestedChildRatio_MC(previous: number, current: number): void;\r\n\r\n\r\n@toolbar('compress', 'expand')\r\nexport default class MultiLevelCompositeColumn extends CompositeColumn implements IMultiLevelColumn {\r\n  static readonly EVENT_COLLAPSE_CHANGED = StackColumn.EVENT_COLLAPSE_CHANGED;\r\n  static readonly EVENT_MULTI_LEVEL_CHANGED = StackColumn.EVENT_MULTI_LEVEL_CHANGED;\r\n\r\n  private readonly adaptChange: (old: number, newValue: number) => void;\r\n\r\n  /**\r\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  private collapsed = false;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, desc);\r\n    const that = this;\r\n    this.adaptChange = function (old, newValue) {\r\n      that.adaptWidthChange(old, newValue);\r\n    };\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged_MC | null): this;\r\n  on(type: typeof MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, listener: typeof nestedChildRatio_MC | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  setCollapsed(value: boolean) {\r\n    if (this.collapsed === value) {\r\n      return;\r\n    }\r\n    this.fire([StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.collapsed, this.collapsed = value);\r\n  }\r\n\r\n  getCollapsed() {\r\n    return this.collapsed;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.collapsed = this.collapsed;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    this.collapsed = dump.collapsed === true;\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    return StackColumn.prototype.flatten.call(this, r, offset, levelsToGo, padding);\r\n  }\r\n\r\n  /**\r\n   * inserts a column at a the given position\r\n   * @param col\r\n   * @param index\r\n   */\r\n  insert(col: Column, index: number) {\r\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\r\n    //increase my width\r\n    super.setWidth(this.length === 0 ? col.getWidth() : (this.getWidth() + col.getWidth()));\r\n\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  /**\r\n   * adapts weights according to an own width change\r\n   * @param oldValue\r\n   * @param newValue\r\n   */\r\n  private adaptWidthChange(oldValue: number, newValue: number) {\r\n    if (similar(oldValue, newValue, 0.5)) {\r\n      return;\r\n    }\r\n    const act = this.getWidth();\r\n    const next = act + (newValue - oldValue);\r\n    this.fire([MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], act, next);\r\n    super.setWidth(next);\r\n  }\r\n\r\n  removeImpl(child: Column, index: number) {\r\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\r\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\r\n    return super.removeImpl(child, index);\r\n  }\r\n\r\n  setWidth(value: number) {\r\n    const act = this.getWidth();\r\n    const factor = value / act;\r\n    this._children.forEach((child) => {\r\n      //disable since we change it\r\n      child.setWidthImpl(child.getWidth() * factor);\r\n    });\r\n    if (!similar(act, value, 0.5)) {\r\n      this.fire([MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], act, value);\r\n    }\r\n    super.setWidth(value);\r\n  }\r\n\r\n  getRenderer() {\r\n    if (this.getCollapsed()) {\r\n      return MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED;\r\n    }\r\n    return super.getRenderer();\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n}\r\n","import {IDataRow, ECompareValueType} from './interfaces';\r\nimport MultiLevelCompositeColumn from './MultiLevelCompositeColumn';\r\nimport {concat} from '../internal';\r\nimport {toolbar} from './annotations';\r\n\r\n/**\r\n * factory for creating a description creating a mean column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createNestedDesc(label: string = 'Nested') {\r\n  return {type: 'nested', label};\r\n}\r\n\r\n/**\r\n * a nested column is a composite column where the sorting order is determined by the nested ordering of the children\r\n * i.e., sort by the first child if equal sort by the second child,...\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy')\r\nexport default class NestedColumn extends MultiLevelCompositeColumn {\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    return concat(this.children.map((d) => d.toCompareValue(row)));\r\n  }\r\n\r\n  toCompareValueType(): ECompareValueType[] {\r\n    return concat(this.children.map((d) => d.toCompareValueType()));\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return this.children.map((d) => d.getLabel(row)).join(';');\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return this.children.map((d) => d.getValue(row)).join(';');\r\n  }\r\n}\r\n","import {toolbar, SortByDefault, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {IDataRow, ECompareValueType, ITypeFactory} from './interfaces';\r\nimport {\r\n  EAdvancedSortMethod, IAdvancedBoxPlotColumn, INumberDesc,\r\n  INumberFilter,\r\n  IMappingFunction,\r\n  IColorMappingFunction} from './INumberColumn';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport {restoreMapping} from './MappingFunction';\r\nimport {isMissingValue} from './missing';\r\nimport NumberColumn from './NumberColumn';\r\nimport {IEventListener, IAdvancedBoxPlotData, boxplotBuilder} from '../internal';\r\nimport {format} from 'd3-format';\r\nimport {DEFAULT_FORMATTER, noNumberFilter, toCompareBoxPlotValue, getBoxPlotNumber, isDummyNumberFilter, restoreNumberFilter} from './internalNumber';\r\nimport {integrateDefaults} from './internal';\r\n\r\n\r\nexport interface INumberMapDesc extends INumberDesc {\r\n  readonly sort?: EAdvancedSortMethod;\r\n}\r\n\r\nexport declare type INumberMapColumnDesc = INumberMapDesc & IMapColumnDesc<number>;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf NumberMapColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_NMC(previous: IMappingFunction, current: IMappingFunction): void;\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf NumberMapColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_NMC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf NumberMapColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged_NMC(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf NumberMapColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_NMC(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n@toolbar('rename', 'filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortNumbers')\r\n@SortByDefault('descending')\r\nexport default class NumberMapColumn extends MapColumn<number> implements IAdvancedBoxPlotColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\r\n\r\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\r\n\r\n  private sort: EAdvancedSortMethod;\r\n  private mapping: IMappingFunction;\r\n  private original: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n  constructor(id: string, desc: Readonly<INumberMapColumnDesc>, factory: ITypeFactory) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'mapbars'\r\n    }));\r\n    this.mapping = restoreMapping(desc, factory);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\r\n    this.sort = desc.sort || EAdvancedSortMethod.median;\r\n\r\n    if (desc.numberFormat) {\r\n      this.numberFormat = format(desc.numberFormat);\r\n    }\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return this.numberFormat;\r\n  }\r\n\r\n  toCompareValue(row: IDataRow): number {\r\n    return toCompareBoxPlotValue(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return ECompareValueType.FLOAT;\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n    const b = boxplotBuilder();\r\n    for (const d of data) {\r\n      b.push(isMissingValue(d.value) ? NaN : this.mapping.apply(d.value));\r\n    }\r\n    return b.build();\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(this.numberFormat);\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n\r\n    const b = boxplotBuilder();\r\n    for (const d of data) {\r\n      b.push(isMissingValue(d.value) ? NaN : d.value);\r\n    }\r\n    return b.build();\r\n  }\r\n\r\n  getNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'normalized');\r\n  }\r\n\r\n  getRawNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'raw');\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    const r = this.getValue(row);\r\n    return r ? r.map((d) => d.value) : [NaN];\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    const r = this.getRawValue(row);\r\n    return r ? r.map((d) => d.value) : [NaN];\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const values = this.getRawValue(row);\r\n    return values.length === 0 ? null : values.map(({key, value}) => ({key, value: isMissingValue(value) ? NaN : this.mapping.apply(value)}));\r\n  }\r\n\r\n  getRawValue(row: IDataRow): IKeyValue<number>[] {\r\n    const r = super.getValue(row);\r\n    return r == null ? [] : r;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    const v = this.getRawValue(row);\r\n    return v.map(({key, value}) => ({key, value: this.numberFormat(value)}));\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EAdvancedSortMethod) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire([NumberMapColumn.EVENT_SORTMETHOD_CHANGED], this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\r\n    r.map = this.mapping.toJSON();\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.map || dump.domain) {\r\n      this.mapping = restoreMapping(dump, factory);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, NumberMapColumn.EVENT_MAPPING_CHANGED, NumberMapColumn.EVENT_SORTMETHOD_CHANGED, NumberMapColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NMC | null): this;\r\n  on(type: typeof NumberMapColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NMC | null): this;\r\n  on(type: typeof NumberMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NMC | null): this;\r\n  on(type: typeof NumberMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NMC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberMapColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return NumberColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return NumberColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return NumberColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null) {\r\n    NumberColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return NumberColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  clearFilter() {\r\n    return NumberColumn.prototype.clearFilter.call(this);\r\n  }\r\n}\r\n\r\n","import {equalArrays, extent, IEventListener} from '../internal';\r\nimport {Category, toolbar} from './annotations';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, groupRendererChanged, labelChanged, metaDataChanged, rendererTypeChanged, summaryRendererChanged, visibilityChanged, widthChanged} from './Column';\r\nimport {ICategoricalColumn, ICategoricalDesc, ICategoricalFilter, ICategory, ICategoricalColorMappingFunction} from './ICategoricalColumn';\r\nimport {IDataRow, IValueColumnDesc, ITypeFactory} from './interfaces';\r\nimport NumberColumn from './NumberColumn';\r\nimport {INumberColumn} from './INumberColumn';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {toCategories} from './internalCategorical';\r\nimport {DEFAULT_FORMATTER} from './internalNumber';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport declare type IOrdinalColumnDesc = ICategoricalDesc & IValueColumnDesc<number>;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf OrdinalColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged_OC(previous: number[], current: number[]): void;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf OrdinalColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_OC(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf OrdinalColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_OC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\r\n\r\n/**\r\n * similar to a categorical column but the categories are mapped to numbers\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'filterOrdinal', 'colorMappedCategorical')\r\n@Category('categorical')\r\nexport default class OrdinalColumn extends ValueColumn<number> implements INumberColumn, ICategoricalColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n\r\n  private currentFilter: ICategoricalFilter | null = null;\r\n\r\n\r\n  constructor(id: string, desc: Readonly<IOrdinalColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'number',\r\n      groupRenderer: 'boxplot'\r\n    }));\r\n    this.categories = toCategories(desc);\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([OrdinalColumn.EVENT_COLOR_MAPPING_CHANGED, OrdinalColumn.EVENT_MAPPING_CHANGED, OrdinalColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof OrdinalColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_OC | null): this;\r\n  on(type: typeof OrdinalColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_OC | null): this;\r\n  on(type: typeof OrdinalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_OC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return DEFAULT_FORMATTER;\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getNumber(row);\r\n    return isNaN(v) ? null : v;\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    const v = super.getValue(row);\r\n    if (!v) {\r\n      return null;\r\n    }\r\n    const vs = String(v);\r\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return [this.getCategory(row)];\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    return [this.getCategory(row)];\r\n  }\r\n\r\n  iterNumber(row: IDataRow) {\r\n    return [this.getNumber(row)];\r\n  }\r\n\r\n  iterRawNumber(row: IDataRow) {\r\n    return [this.getRawNumber(row)];\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabel.call(this, row);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabels.call(this, row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getValues.call(this, row);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMap.call(this, row);\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getSet.call(this, row);\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.value : NaN;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    return this.getNumber(row);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      const value = this.getNumber(row);\r\n      if (isNaN(value)) {\r\n        return null;\r\n      }\r\n      return {\r\n        name: this.getLabel(row),\r\n        value\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = CategoricalColumn.prototype.dump.call(this, toDescRef);\r\n    r.mapping = this.getMapping();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    CategoricalColumn.prototype.restore.call(this, dump, factory);\r\n    if (dump.mapping) {\r\n      this.setMapping(dump.mapping);\r\n    }\r\n  }\r\n\r\n  getMapping() {\r\n    return this.categories.map((d) => d.value);\r\n  }\r\n\r\n  setMapping(mapping: number[]) {\r\n    const r = extent(mapping);\r\n    mapping = mapping.map((d) => (d - r[0]!) / (r[1]! - r[0]!));\r\n    const bak = this.getMapping();\r\n    if (equalArrays(bak, mapping)) {\r\n      return;\r\n    }\r\n    this.categories.forEach((d, i) => d.value = mapping[i] || 0);\r\n    this.fire([OrdinalColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], bak, this.getMapping());\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow): boolean {\r\n    return CategoricalColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    return CategoricalColumn.prototype.group.call(this, row);\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: ICategoricalFilter | null) {\r\n    return CategoricalColumn.prototype.setFilter.call(this, filter);\r\n  }\r\n\r\n  clearFilter() {\r\n    return CategoricalColumn.prototype.clearFilter.call(this);\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    return CategoricalColumn.prototype.toCompareValue.call(this, row);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return CategoricalColumn.prototype.toCompareValueType.call(this);\r\n  }\r\n\r\n  getRenderer(): string {\r\n    return NumberColumn.prototype.getRenderer.call(this);\r\n  }\r\n}\r\n","import {NumberColumn} from '.';\r\nimport {IEventListener} from '../internal';\r\nimport {SortByDefault, toolbar} from './annotations';\r\nimport Column, {dirty, dirtyCaches, dirtyHeader, dirtyValues, groupRendererChanged, labelChanged, metaDataChanged, rendererTypeChanged, summaryRendererChanged, visibilityChanged, widthChanged} from './Column';\r\nimport CompositeColumn, {addColumn, moveColumn, removeColumn} from './CompositeColumn';\r\nimport CompositeNumberColumn, {ICompositeNumberDesc} from './CompositeNumberColumn';\r\nimport {IDataRow, ITypeFactory} from './interfaces';\r\nimport {isDummyNumberFilter, noNumberFilter, restoreNumberFilter} from './internalNumber';\r\nimport {IColorMappingFunction, IMapAbleColumn, IMapAbleDesc, IMappingFunction, INumberFilter, isNumberColumn} from './INumberColumn';\r\nimport {restoreMapping} from './MappingFunction';\r\nimport {integrateDefaults} from './internal';\r\n\r\nconst DEFAULT_SCRIPT = `let s = 0;\r\ncol.forEach((c) => s += c.v);\r\nreturn s / col.length`;\r\n\r\n/**\r\n * factory for creating a description creating a mean column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createScriptDesc(label: string = 'script') {\r\n  return {type: 'script', label, script: DEFAULT_SCRIPT};\r\n}\r\n\r\n\r\nfunction wrapWithContext(code: string) {\r\n  let clean = code.trim();\r\n  if (!clean.includes('return')) {\r\n    clean = `return (${clean});`;\r\n  }\r\n  return `\r\n  const max = function(arr) { return Math.max.apply(Math, arr); };\r\n  const min = function(arr) { return Math.min.apply(Math, arr); };\r\n  const extent = function(arr) { return [min(arr), max(arr)]; };\r\n  const clamp = function(v, minValue, maxValue) { return v < minValue ? minValue : (v > maxValue ? maxValue : v); };\r\n  const normalize = function(v, minMax, max) {\r\n    if (Array.isArray(minMax)) {\r\n      minMax = minMax[0];\r\n      max = minMax[1];\r\n    }\r\n    return (v - minMax) / (max - minMax);\r\n  };\r\n  const denormalize = function(v, minMax, max) {\r\n    if (Array.isArray(minMax)) {\r\n      minMax = minMax[0];\r\n      max = minMax[1];\r\n    }\r\n    return v * (max - minMax) + minMax;\r\n  };\r\n  const linear = function(v, source, target) {\r\n    target = target || [0, 1];\r\n    return denormalize(normalize(v, source), target);\r\n  };\r\n  const v = (function custom() {\r\n    ${clean}\r\n  })();\r\n\r\n  return typeof v === 'number' ? v : NaN`;\r\n}\r\n\r\ninterface IColumnWrapper {\r\n  v: any;\r\n  raw: number | null;\r\n  type: string;\r\n  name: string;\r\n  id: string;\r\n}\r\n\r\n/**\r\n * wrapper class for simpler column accessing\r\n */\r\nclass ColumnWrapper implements IColumnWrapper {\r\n  constructor(private readonly c: Column, public readonly v: any, public readonly raw: number | null) {\r\n\r\n  }\r\n\r\n  get type() {\r\n    return this.c.desc.type;\r\n  }\r\n\r\n  get name() {\r\n    return this.c.getMetaData().label;\r\n  }\r\n\r\n  get id() {\r\n    return this.c.id;\r\n  }\r\n}\r\n\r\nclass LazyColumnWrapper implements IColumnWrapper {\r\n  constructor(private readonly c: Column, private readonly row: IDataRow) {\r\n\r\n  }\r\n\r\n  get type() {\r\n    return this.c.desc.type;\r\n  }\r\n\r\n  get name() {\r\n    return this.c.getMetaData().label;\r\n  }\r\n\r\n  get id() {\r\n    return this.c.id;\r\n  }\r\n\r\n  get v() {\r\n    return this.c.getValue(this.row);\r\n  }\r\n\r\n  get raw() {\r\n    return isNumberColumn(this.c) ? this.c.getRawNumber(this.row) : null;\r\n  }\r\n}\r\n\r\n/**\r\n * helper context for accessing columns within a scripted columns\r\n */\r\nclass ColumnContext {\r\n  private readonly lookup = new Map<string, IColumnWrapper>();\r\n  private _all: ColumnContext | null = null;\r\n\r\n  constructor(private readonly children: IColumnWrapper[], private readonly allFactory?: () => ColumnContext) {\r\n    children.forEach((c) => {\r\n      this.lookup.set(`ID@${c.id}`, c);\r\n      this.lookup.set(`ID@${c.id.toLowerCase()}`, c);\r\n      this.lookup.set(`NAME@${c.name}`, c);\r\n      this.lookup.set(`NAME@${c.name.toLowerCase()}`, c);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * get a column by name\r\n   * @param {string} name\r\n   * @return {IColumnWrapper}\r\n   */\r\n  byName(name: string) {\r\n    return this.lookup.get(`NAME@${name}`);\r\n  }\r\n\r\n  /**\r\n   * get a column by id\r\n   * @param {string} id\r\n   * @return {IColumnWrapper}\r\n   */\r\n  byID(id: string) {\r\n    return this.lookup.get(`ID@${id}`);\r\n  }\r\n\r\n  /**\r\n   * get a column by index\r\n   * @param {number} index\r\n   * @return {IColumnWrapper}\r\n   */\r\n  byIndex(index: number) {\r\n    return this.children[index];\r\n  }\r\n\r\n  forEach(callback: ((c: IColumnWrapper, index: number) => void)) {\r\n    return this.children.forEach(callback);\r\n  }\r\n\r\n  /**\r\n   * number of columns\r\n   * @return {number}\r\n   */\r\n  get length() {\r\n    return this.children.length;\r\n  }\r\n\r\n  /**\r\n   * get the all context, i.e one with all columns of this ranking\r\n   * @return {ColumnContext}\r\n   */\r\n  get all() {\r\n    if (this._all == null) {\r\n      this._all = this.allFactory ? this.allFactory() : null;\r\n    }\r\n    return this._all!;\r\n  }\r\n}\r\n\r\n\r\nexport interface IScriptDesc extends ICompositeNumberDesc, IMapAbleDesc {\r\n  /**\r\n   * the function to use, it has two parameters: children (current children) and values (their row values)\r\n   * @default 'return Math.max.apply(Math,values)'\r\n   */\r\n  script?: string;\r\n}\r\n\r\nexport declare type IScriptColumnDesc = IScriptDesc;\r\n\r\n/**\r\n * emitted when the script property changes\r\n * @asMemberOf ScriptColumn\r\n * @event\r\n */\r\nexport declare function scriptChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf ScriptColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged(previous: IMappingFunction, current: IMappingFunction): void;\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf ScriptColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf ScriptColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n\r\n\r\n/**\r\n * column combiner which uses a custom JavaScript function to combined the values\r\n * The script iteslf can be any valid JavaScript code. It will be embedded in a function.\r\n * Therefore the last statement has to return a value.\r\n *\r\n * In case of a single line statement the code piece statement <code>return</code> will be automatically prefixed.\r\n *\r\n * The function signature is: <br><code>(row: any, index: number, children: Column[], values: any[], raws: (number|null)[]) => number</code>\r\n *  <dl>\r\n *    <dt>param: <code>row</code></dt>\r\n *    <dd>the row in the dataset to compute the value for</dd>\r\n *    <dt>param: <code>index</code></dt>\r\n *    <dd>the index of the row</dd>\r\n *    <dt>param: <code>children</code></dt>\r\n *    <dd>the list of LineUp columns that are part of this ScriptColumn</dd>\r\n *    <dt>param: <code>values</code></dt>\r\n *    <dd>the computed value of each column (see <code>children</code>) for the current row</dd>\r\n *    <dt>param: <code>raws</code></dt>\r\n *    <dd>similar to <code>values</code>. Numeric columns return by default the normalized value, this array gives access to the original \"raw\" values before mapping is applied</dd>\r\n *    <dt>returns:</dt>\r\n *    <dd>the computed number <strong>in the range [0, 1] or NaN</strong></dd>\r\n *  </dl>\r\n *\r\n * In addition to the standard JavaScript functions and objects (Math, ...) a couple of utility functions are available: </p>\r\n * <dl>\r\n *    <dt><code>max(arr: number[]) => number</code></dt>\r\n *    <dd>computes the maximum of the given array of numbers</dd>\r\n *    <dt><code>min(arr: number[]) => number</code></dt>\r\n *    <dd>computes the minimum of the given array of numbers</dd>\r\n *    <dt><code>extent(arr: number[]) => [number, number]</code></dt>\r\n *    <dd>computes both minimum and maximum and returning an array with the first element the minimum and the second the maximum</dd>\r\n *    <dt><code>clamp(v: number, min: number, max: number) => number</code></dt>\r\n *    <dd>ensures that the given value is within the given min/max value</dd>\r\n *    <dt><code>normalize(v: number, min: number, max: number) => number</code></dt>\r\n *    <dd>normalizes the given value <code>(v - min) / (max - min)</code></dd>\r\n *    <dt><code>denormalize(v: number, min: number, max: number) => number</code></dt>\r\n *    <dd>inverts a normalized value <code>v * (max - min) + min</code></dd>\r\n *    <dt><code>linear(v: number, input: [number, number], output: [number, number]) => number</code></dt>\r\n *    <dd>performs a linear mapping from input domain to output domain both given as an array of [min, max] values. <code>denormalize(normalize(v, input[0], input[1]), output[0], output[1])</code></dd>\r\n *  </dl>\r\n */\r\n@toolbar('script', 'filterNumber', 'colorMapped', 'editMapping')\r\n@SortByDefault('descending')\r\nexport default class ScriptColumn extends CompositeNumberColumn implements IMapAbleColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n  static readonly EVENT_SCRIPT_CHANGED = 'scriptChanged';\r\n  static readonly DEFAULT_SCRIPT = DEFAULT_SCRIPT;\r\n\r\n  private script = ScriptColumn.DEFAULT_SCRIPT;\r\n  private f: Function | null = null;\r\n  private mapping: IMappingFunction;\r\n  private original: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n\r\n  constructor(id: string, desc: Readonly<IScriptColumnDesc>, factory: ITypeFactory) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'number',\r\n      groupRenderer: 'boxplot',\r\n      summaryRenderer: 'histogram'\r\n    }));\r\n    this.script = desc.script || this.script;\r\n    this.mapping = restoreMapping(desc, factory);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ScriptColumn.EVENT_SCRIPT_CHANGED, ScriptColumn.EVENT_COLOR_MAPPING_CHANGED, ScriptColumn.EVENT_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ScriptColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof ScriptColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof ScriptColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ScriptColumn.EVENT_SCRIPT_CHANGED, listener: typeof scriptChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  setScript(script: string) {\r\n    if (this.script === script) {\r\n      return;\r\n    }\r\n    this.f = null;\r\n    this.fire([ScriptColumn.EVENT_SCRIPT_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.script, this.script = script);\r\n  }\r\n\r\n  getScript() {\r\n    return this.script;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.script = this.script;\r\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\r\n    r.map = this.mapping.toJSON();\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n\r\n    this.script = dump.script || this.script;\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.map || dump.domain) {\r\n      this.mapping = restoreMapping(dump.map, factory);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\r\n    }\r\n  }\r\n\r\n  protected compute(row: IDataRow) {\r\n    if (this.f == null) {\r\n      this.f = new Function('children', 'values', 'raws', 'col', 'row', 'index', wrapWithContext(this.script));\r\n    }\r\n    const children = this._children;\r\n    const values = this._children.map((d) => d.getValue(row));\r\n    const raws = <number[]>this._children.map((d) => isNumberColumn(d) ? d.getRawNumber(row) : null);\r\n    const col = new ColumnContext(children.map((c, i) => new ColumnWrapper(c, values[i], raws[i])), () => {\r\n      const cols = this.findMyRanker()!.flatColumns; // all except myself\r\n      return new ColumnContext(cols.map((c) => new LazyColumnWrapper(c, row)));\r\n    });\r\n    return this.f.call(this, children, values, raws, col, row.v, row.i);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(this.getNumberFormat());\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([ScriptColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return NumberColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([ScriptColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return NumberColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return NumberColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: INumberFilter | null) {\r\n    NumberColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return NumberColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  clearFilter() {\r\n    return NumberColumn.prototype.clearFilter.call(this);\r\n  }\r\n}\r\n","import {Category, toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {labelChanged, metaDataChanged, dirty, widthChanged, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport {IArrayColumn} from './IArrayColumn';\r\nimport {ICategoricalDesc, ISetCategoricalFilter, ICategory, ISetColumn, ICategoricalColorMappingFunction} from './ICategoricalColumn';\r\nimport {IDataRow, ECompareValueType, IValueColumnDesc, IGroup, DEFAULT_COLOR, ITypeFactory} from './interfaces';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION} from './CategoricalColorMappingFunction';\r\nimport {toCategories, isCategoryIncluded, isEqualSetCategoricalFilter} from './internalCategorical';\r\nimport {chooseUIntByDataLength, integrateDefaults} from './internal';\r\n\r\nexport interface ISetDesc extends ICategoricalDesc {\r\n  separator?: string;\r\n}\r\n\r\nexport declare type ISetColumnDesc = ISetDesc & IValueColumnDesc<string[]>;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf SetColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged_SSC(previous: ICategoricalColorMappingFunction, current: ICategoricalColorMappingFunction): void;\r\n\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf SetColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_SSC(previous: ISetCategoricalFilter | null, current: ISetCategoricalFilter | null): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterCategorical', 'colorMappedCategorical', 'group', 'groupBy')\r\n@Category('categorical')\r\nexport default class SetColumn extends ValueColumn<string[]> implements IArrayColumn<boolean>, ISetColumn {\r\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private readonly separator: RegExp;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n\r\n  private colorMapping: ICategoricalColorMappingFunction;\r\n  /**\r\n   * set of categories to show\r\n   * @type {null}\r\n   * @private\r\n   */\r\n  private currentFilter: ISetCategoricalFilter | null = null;\r\n\r\n  constructor(id: string, desc: Readonly<ISetColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      renderer: 'upset',\r\n      groupRenderer: 'upset',\r\n      summaryRenderer: 'categorical'\r\n    }));\r\n    this.separator = new RegExp(desc.separator || ';');\r\n    this.categories = toCategories(desc);\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SetColumn.EVENT_COLOR_MAPPING_CHANGED, SetColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof SetColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_SSC | null): this;\r\n  on(type: typeof SetColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_SSC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  getValue(row: IDataRow): string[] | null {\r\n    const v = this.getSortedSet(row);\r\n    if (v.length === 0) {\r\n      return null;\r\n    }\r\n    return v.map((d) => d.name);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return `(${this.getSortedSet(row).map((d) => d.label).join(',')})`;\r\n  }\r\n\r\n  private normalize(v: any) {\r\n    if (typeof v === 'string') {\r\n      return v.split(this.separator).map((s) => s.trim());\r\n    }\r\n    if (Array.isArray(v)) {\r\n      return v.map((v) => String(v).trim());\r\n    }\r\n    if (v instanceof Set) {\r\n      return Array.from(v).map(String);\r\n    }\r\n    return [];\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const sv = this.normalize(super.getValue(row));\r\n    const r = new Set<ICategory>();\r\n    sv.forEach((n) => {\r\n      const cat = this.lookup.get(n);\r\n      if (cat) {\r\n        r.add(cat);\r\n      }\r\n    });\r\n    return r;\r\n  }\r\n\r\n  getSortedSet(row: IDataRow) {\r\n    return Array.from(this.getSet(row)).sort((a, b) => a.value === b.value ? a.label.localeCompare(b.label) : a.value - b.value);\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return this.getSortedSet(row);\r\n  }\r\n\r\n  getColors(row: IDataRow) {\r\n    return this.getSortedSet(row).map((d) => this.colorMapping.apply(d));\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\r\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\r\n  }\r\n\r\n\r\n  getValues(row: IDataRow) {\r\n    const s = this.getSet(row);\r\n    return this.categories.map((d) => s.has(d));\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValues(row).map(String);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return this.getSortedSet(row).map((d) => ({key: d.label, value: true}));\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return this.getSortedSet(row).map((d) => ({key: d.label, value: 'true'}));\r\n  }\r\n\r\n  iterCategory(row: IDataRow) {\r\n    const r = this.getSet(row);\r\n    if (r.size > 0) {\r\n      return Array.from(r);\r\n    }\r\n    return [null];\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.filter = this.currentFilter;\r\n    r.colorMapping = this.colorMapping.toJSON();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    super.restore(dump, factory);\r\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\r\n    if (!('filter' in dump)) {\r\n      this.currentFilter = null;\r\n      return;\r\n    }\r\n    const bak = dump.filter;\r\n    if (typeof bak === 'string' || Array.isArray(bak)) {\r\n      this.currentFilter = {filter: bak, filterMissing: false, mode: 'some'};\r\n    } else {\r\n      this.currentFilter = bak;\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow): boolean {\r\n    if (!this.currentFilter) {\r\n      return true;\r\n    }\r\n    const v = Array.from(this.getSet(row));\r\n    if (v.length === 0) {\r\n      return isCategoryIncluded(this.currentFilter, null);\r\n    }\r\n    if (this.currentFilter.mode === 'every') {\r\n      return v.every((s) => isCategoryIncluded(this.currentFilter, s));\r\n    }\r\n    return v.some((s) => isCategoryIncluded(this.currentFilter, s));\r\n  }\r\n\r\n  getFilter(): ISetCategoricalFilter | null {\r\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\r\n  }\r\n\r\n  setFilter(filter: ISetCategoricalFilter | null) {\r\n    if (isEqualSetCategoricalFilter(this.currentFilter, filter)) {\r\n      return;\r\n    }\r\n    this.fire([CategoricalColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.currentFilter, this.currentFilter = filter);\r\n  }\r\n\r\n  clearFilter() {\r\n    return CategoricalColumn.prototype.clearFilter.call(this);\r\n  }\r\n\r\n  toCompareValue(row: IDataRow) {\r\n    const v = this.getSet(row);\r\n\r\n    const vs = [v.size];\r\n    for (const cat of this.categories) {\r\n      vs.push(v.has(cat) ? 1 : 0);\r\n    }\r\n    return vs;\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return [chooseUIntByDataLength(this.categories.length)].concat(this.categories.map(() => ECompareValueType.BINARY));\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    const v = this.getSet(row);\r\n    const cardinality = v.size;\r\n    const categories = this.categories.filter((c) => v.has(c));\r\n\r\n    // by cardinality and then by intersection\r\n\r\n    const g: IGroup = {\r\n      name: categories.length === 0 ? 'None' : categories.map((d) => d.name).join(', '),\r\n      color: categories.length === 1 ? categories[0].color : DEFAULT_COLOR\r\n    };\r\n\r\n    g.parent = {\r\n      name: `#${cardinality}`,\r\n      color: DEFAULT_COLOR,\r\n      subGroups: [g]\r\n    };\r\n\r\n    return g;\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport {EAlignment, IStringDesc} from './StringColumn';\r\nimport {IEventListener} from '../internal';\r\nimport {isMissingValue} from './missing';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport declare type IStringMapColumnDesc = IStringDesc & IMapColumnDesc<string>;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'search')\r\nexport default class StringMapColumn extends MapColumn<string> {\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<IStringMapColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 200,\r\n      renderer: 'map'\r\n    }));\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n  }\r\n\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const r = this.getMapValue(row);\r\n    return r.every((d) => d.value === '') ? null : r;\r\n  }\r\n\r\n  getMapValue(row: IDataRow) {\r\n    return super.getMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: isMissingValue(value) ? '' : String(value)\r\n    }));\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {EAlignment, IStringDesc} from './StringColumn';\r\nimport {isMissingValue} from './missing';\r\nimport {integrateDefaults} from './internal';\r\n\r\nexport declare type IStringsColumnDesc = IStringDesc & IArrayColumnDesc<string>;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'search')\r\nexport default class StringsColumn extends ArrayColumn<string> {\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<IStringsColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 200\r\n    }));\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return super.getValues(row).map((v) => {\r\n      return isMissingValue(v) ? '' : String(v);\r\n    });\r\n  }\r\n}\r\n","import {Category, toolbar, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport {IDataRow, IGroup, IValueColumnDesc, ITypeFactory} from './interfaces';\r\nimport {patternFunction, integrateDefaults} from './internal';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IEventListener, ISequence} from '../internal';\r\nimport {IStringDesc, EAlignment, IStringGroupCriteria, EStringGroupCriteriaType, IStringFilter} from './StringColumn';\r\nimport StringColumn from './StringColumn';\r\n\r\nexport interface ILinkDesc extends IStringDesc {\r\n  /**\r\n   * replacement pattern, use use <code>${value}</code> for the current value, <code>${escapedValue}</code> for an url safe value and <code>${item}</code> for the whole item\r\n   */\r\n  pattern?: string;\r\n\r\n  /**\r\n   * optional list of pattern templates\r\n   */\r\n  patternTemplates?: string[];\r\n}\r\n\r\nexport interface ILink {\r\n  alt: string;\r\n  href: string;\r\n}\r\n\r\nexport declare type ILinkColumnDesc = ILinkDesc & IValueColumnDesc<string | ILink>;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf LinkColumn\r\n * @event\r\n */\r\nexport declare function filterChanged_LC(previous: string | RegExp | null, current: string | RegExp | null): void;\r\n\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf LinkColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged_LC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\r\n\r\n/**\r\n * emitted when the pattern property changes\r\n * @asMemberOf LinkColumn\r\n * @event\r\n */\r\nexport declare function patternChanged_LC(previous: string, current: string): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'search', 'groupBy', 'filterString', 'editPattern')\r\n@dialogAddons('group', 'groupString')\r\n@Category('string')\r\nexport default class LinkColumn extends ValueColumn<string | ILink> {\r\n  static readonly EVENT_FILTER_CHANGED = StringColumn.EVENT_FILTER_CHANGED;\r\n  static readonly EVENT_GROUPING_CHANGED = StringColumn.EVENT_GROUPING_CHANGED;\r\n  static readonly EVENT_PATTERN_CHANGED = 'patternChanged';\r\n\r\n  private pattern: string;\r\n  private patternFunction: Function | null = null;\r\n  readonly patternTemplates: string[];\r\n\r\n  private currentFilter: string | RegExp | null = null;\r\n  private currentGroupCriteria: IStringGroupCriteria = {\r\n    type: EStringGroupCriteriaType.startsWith,\r\n    values: []\r\n  };\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<ILinkColumnDesc>) {\r\n    super(id, integrateDefaults(desc, Object.assign({\r\n      width: 200\r\n    }, desc.pattern ? {\r\n        renderer: 'link',\r\n        groupRenderer: 'link'\r\n      } : {})));\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n\r\n    this.pattern = desc.pattern || '';\r\n    this.patternTemplates = desc.patternTemplates || [];\r\n  }\r\n\r\n  setPattern(pattern: string) {\r\n    if (pattern === this.pattern) {\r\n      return;\r\n    }\r\n    this.patternFunction = null; // reset cache\r\n    this.fire([LinkColumn.EVENT_PATTERN_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY], this.pattern, this.pattern = pattern);\r\n  }\r\n\r\n  getPattern() {\r\n    return this.pattern;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([LinkColumn.EVENT_PATTERN_CHANGED, LinkColumn.EVENT_GROUPING_CHANGED, LinkColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LC | null): this;\r\n  on(type: typeof LinkColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_LC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof LinkColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_LC | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const l = this.getLink(row);\r\n    return l == null ? null : l.href;\r\n  }\r\n\r\n  getLink(row: IDataRow): ILink | null {\r\n    const v: string | null | ILink = super.getValue(row);\r\n    return this.transformValue(v, row);\r\n  }\r\n\r\n  private transformValue(v: any, row: IDataRow) {\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    if (typeof v === 'string') {\r\n      if (!this.pattern) {\r\n        return {\r\n          alt: v,\r\n          href: v\r\n        };\r\n      }\r\n      if (!this.patternFunction) {\r\n        this.patternFunction = patternFunction(this.pattern, 'item');\r\n      }\r\n      return {\r\n        alt: v,\r\n        href: this.patternFunction.call(this, v, row.v)\r\n      };\r\n    }\r\n    return v;\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const l = this.getLink(row);\r\n    return l == null ? '' : l.alt;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = StringColumn.prototype.dump.call(this, toDescRef);\r\n    if (this.pattern !== (<any>this.desc).pattern) {\r\n      r.pattern = this.pattern;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    StringColumn.prototype.restore.call(this, dump, factory);\r\n    if (dump.pattern) {\r\n      this.pattern = dump.pattern;\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return StringColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: IStringFilter) {\r\n    return StringColumn.prototype.setFilter.call(this, filter);\r\n  }\r\n\r\n  clearFilter() {\r\n    return StringColumn.prototype.clearFilter.call(this);\r\n  }\r\n\r\n  getGroupCriteria() {\r\n    return this.currentGroupCriteria;\r\n  }\r\n\r\n  setGroupCriteria(value: IStringGroupCriteria) {\r\n    return StringColumn.prototype.setGroupCriteria.call(this, value);\r\n  }\r\n\r\n  toCompareValue(a: IDataRow) {\r\n    return StringColumn.prototype.toCompareValue.call(this, a);\r\n  }\r\n\r\n  toCompareValueType() {\r\n    return StringColumn.prototype.toCompareValueType.call(this);\r\n  }\r\n\r\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\r\n    return StringColumn.prototype.toCompareGroupValue.call(this, rows, group);\r\n  }\r\n\r\n  toCompareGroupValueType() {\r\n    return StringColumn.prototype.toCompareGroupValueType.call(this);\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    return StringColumn.prototype.group.call(this, row);\r\n  }\r\n}\r\n\r\n","import {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow, ITypeFactory} from './interfaces';\r\nimport {patternFunction, integrateDefaults} from './internal';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport LinkColumn, {ILinkDesc} from './LinkColumn';\r\nimport {IEventListener} from '../internal';\r\nimport {EAlignment} from './StringColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {ILink} from './LinkColumn';\r\n\r\nexport declare type ILinkMapColumnDesc = ILinkDesc & IMapColumnDesc<string>;\r\n\r\n/**\r\n * emitted when the pattern property changes\r\n * @asMemberOf LinkMapColumn\r\n * @event\r\n */\r\nexport declare function patternChanged_LMC(previous: string, current: string): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('rename', 'search', 'editPattern')\r\nexport default class LinkMapColumn extends MapColumn<string> {\r\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n  private pattern: string;\r\n  private patternFunction: Function | null = null;\r\n  readonly patternTemplates: string[];\r\n\r\n  constructor(id: string, desc: Readonly<ILinkMapColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 200,\r\n      renderer: 'map'\r\n    }));\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n    this.pattern = desc.pattern || '';\r\n    this.patternTemplates = desc.patternTemplates || [];\r\n  }\r\n\r\n  setPattern(pattern: string) {\r\n    LinkColumn.prototype.setPattern.call(this, pattern);\r\n  }\r\n\r\n  getPattern() {\r\n    return this.pattern;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([LinkColumn.EVENT_PATTERN_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LMC | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const r = this.getLinkMap(row);\r\n    return r.every((d) => d.value == null) ? null : r.map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.href : ''\r\n    }));\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getLinkMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.alt : ''\r\n    }));\r\n  }\r\n\r\n  getLinkMap(row: IDataRow): IKeyValue<ILink>[] {\r\n    return super.getMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: this.transformValue(value, row, key)\r\n    }));\r\n  }\r\n\r\n  private transformValue(v: any, row: IDataRow, key: string) {\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    if (typeof v === 'string') {\r\n      if (!this.pattern) {\r\n        return {\r\n          alt: v,\r\n          href: v\r\n        };\r\n      }\r\n      if (!this.patternFunction) {\r\n        this.patternFunction = patternFunction(this.pattern, 'item', 'key');\r\n      }\r\n      return {\r\n        alt: v,\r\n        href: this.patternFunction.call(this, v, row.v, key)\r\n      };\r\n    }\r\n    return v;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    if (this.pattern !== (<any>this.desc).pattern) {\r\n      r.pattern = this.pattern;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    if (dump.pattern) {\r\n      this.pattern = dump.pattern;\r\n    }\r\n    super.restore(dump, factory);\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged, dirtyCaches} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow, ITypeFactory} from './interfaces';\r\nimport {patternFunction, integrateDefaults} from './internal';\r\nimport {EAlignment} from './StringColumn';\r\nimport {IEventListener} from '../internal';\r\nimport LinkColumn, {ILink, ILinkDesc} from './LinkColumn';\r\n\r\nexport declare type ILinksColumnDesc = ILinkDesc & IArrayColumnDesc<string | ILink>;\r\n\r\n/**\r\n * emitted when the pattern property changes\r\n * @asMemberOf LinksColumn\r\n * @event\r\n */\r\nexport declare function patternChanged_LCS(previous: string, current: string): void;\r\n\r\n@toolbar('rename', 'search', 'editPattern')\r\nexport default class LinksColumn extends ArrayColumn<string | ILink> {\r\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n  private pattern: string;\r\n  private patternFunction: Function | null = null;\r\n  readonly patternTemplates: string[];\r\n\r\n  constructor(id: string, desc: Readonly<ILinksColumnDesc>) {\r\n    super(id, integrateDefaults(desc, {\r\n      width: 200\r\n    }));\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n    this.pattern = desc.pattern || '';\r\n    this.patternTemplates = desc.patternTemplates || [];\r\n  }\r\n\r\n  setPattern(pattern: string) {\r\n    return LinkColumn.prototype.setPattern.call(this, pattern);\r\n  }\r\n\r\n  getPattern() {\r\n    return this.pattern;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([LinksColumn.EVENT_PATTERN_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof LinksColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LCS | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return this.getLinks(row).map((d) => d ? d.href : '');\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getLinks(row).map((d) => d ? d.alt : '');\r\n  }\r\n\r\n  private transformValue(v: any, row: IDataRow, i: number) {\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    if (typeof v === 'string') {\r\n      if (!this.pattern) {\r\n        return {\r\n          alt: v,\r\n          href: v\r\n        };\r\n      }\r\n      if (!this.patternFunction) {\r\n        this.patternFunction = patternFunction(this.pattern, 'item', 'index');\r\n      }\r\n      return {\r\n        alt: v,\r\n        href: this.patternFunction.call(this, v, row.v, i)\r\n      };\r\n    }\r\n    return v;\r\n  }\r\n\r\n  getLinks(row: IDataRow): ILink[] {\r\n    return super.getValues(row).map((v, i) => {\r\n      return this.transformValue(v, row, i);\r\n    });\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    if (this.pattern !== (<any>this.desc).pattern) {\r\n      r.pattern = this.pattern;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: ITypeFactory) {\r\n    if (dump.pattern) {\r\n      this.pattern = dump.pattern;\r\n    }\r\n    super.restore(dump, factory);\r\n  }\r\n}\r\n","export function isPromiseLike(p) {\r\n    return p != null && p && typeof p.then === 'function';\r\n}\r\n/**\r\n * the symbol returned when the promise was aborted\r\n */\r\nexport var ABORTED = Symbol('aborted');\r\nfunction thenFactory(loader, isAborted, abort) {\r\n    function then(onfulfilled, _onrejected) {\r\n        var fullfiller = loader.then(function (loaded) {\r\n            var loadedOrAborted = isAborted() ? ABORTED : loaded;\r\n            var res = onfulfilled ? onfulfilled(loadedOrAborted) : loadedOrAborted;\r\n            if (isPromiseLike(res)) {\r\n                return res.then(function (r) {\r\n                    return isAborted() ? ABORTED : r;\r\n                });\r\n            }\r\n            return isAborted() ? ABORTED : res;\r\n        });\r\n        return {\r\n            then: thenFactory(fullfiller, isAborted, abort),\r\n            abort: abort,\r\n            isAborted: isAborted\r\n        };\r\n    }\r\n    return then;\r\n}\r\n/**\r\n * abort able Promise wrapper, returns a promise which can be aborted, and trying to avoid executing therefore the wrapped promise\r\n * @param {Promise<T>} loader\r\n * @returns {any}\r\n */\r\nexport default function abortAble(loader) {\r\n    var aborted = null;\r\n    var isAborted = function () { return aborted === null; };\r\n    var aborter = new Promise(function (resolve) { return aborted = resolve; });\r\n    var abort = function () {\r\n        if (aborted == null) {\r\n            return;\r\n        }\r\n        aborted(ABORTED);\r\n        aborted = null;\r\n    };\r\n    var race = Promise.race([aborter, loader]);\r\n    return {\r\n        then: thenFactory(race, isAborted, abort),\r\n        abort: abort,\r\n        isAborted: isAborted\r\n    };\r\n}\r\nexport function abortAbleFetch(input, init) {\r\n    var controller = new AbortController();\r\n    var race = new Promise(function (resolve, reject) {\r\n        var r = fetch(input, Object.assign({ signal: controller.signal }, init || {}));\r\n        r.then(resolve);\r\n        r.catch(function (error) {\r\n            if (error instanceof DOMException) {\r\n                resolve(ABORTED);\r\n            }\r\n            else {\r\n                reject(error);\r\n            }\r\n        });\r\n    });\r\n    var abort = controller.abort.bind(controller);\r\n    var isAborted = function () { return controller.signal.aborted; };\r\n    return {\r\n        then: thenFactory(race, isAborted, abort),\r\n        abort: abort,\r\n        isAborted: isAborted\r\n    };\r\n}\r\n/**\r\n * similar to Promise.all but for abortAble\r\n */\r\nexport function abortAbleAll(values) {\r\n    var loader = Promise.all(values);\r\n    var aborted = null;\r\n    var isAborted = function () { return aborted === null; };\r\n    var aborter = new Promise(function (resolve) { return aborted = resolve; });\r\n    var abort = function () {\r\n        if (aborted == null) {\r\n            return;\r\n        }\r\n        aborted(ABORTED);\r\n        for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\r\n            var v = values_1[_i];\r\n            if (isAbortAble(v)) {\r\n                v.abort();\r\n            }\r\n        }\r\n        aborted = null;\r\n    };\r\n    var race = Promise.race([aborter, loader]);\r\n    return {\r\n        then: thenFactory(race, isAborted, abort),\r\n        abort: abort,\r\n        isAborted: isAborted\r\n    };\r\n}\r\n/**\r\n * checked whether the given argument is an abortable Promise\r\n * @param {IAbortAblePromise<any> | any} abortAble\r\n * @returns {boolean}\r\n */\r\nexport function isAbortAble(abortAble) {\r\n    return abortAble != null && abortAble && typeof abortAble.then === 'function' && typeof abortAble.abort === 'function';\r\n}\r\nexport function isAsyncUpdate(update) {\r\n    return update !== undefined && update !== null && update && isAbortAble(update.ready);\r\n}\r\n/**\r\n * similar to Promise.resolve\r\n */\r\nexport function abortAbleResolveNow(value) {\r\n    function then(onfulfilled, _onrejected) {\r\n        var res = onfulfilled ? onfulfilled(value) : value;\r\n        if (isAbortAble(res)) {\r\n            return res;\r\n        }\r\n        if (isPromiseLike(res)) {\r\n            return abortAble(res);\r\n        }\r\n        return {\r\n            then: abortAbleResolveNow(res),\r\n            abort: function () { return undefined; },\r\n            isAborted: function () { return false; }\r\n        };\r\n    }\r\n    return {\r\n        then: then,\r\n        abort: function () { return undefined; },\r\n        isAborted: function () { return false; }\r\n    };\r\n}\r\n//# sourceMappingURL=abortAble.js.map","import {Column, Ranking, IColumnConstructor, IColumnDesc, IGroup, IndicesArray, IDataRow, IRankingDump, EAggregationState, IColorMappingFunctionConstructor, IMappingFunctionConstructor, ITypeFactory} from '../model';\r\nimport {AEventDispatcher, ISequence} from '../internal';\r\nimport {IRenderTasks} from '../renderer';\r\nimport {IAbortAblePromise as IAbortAblePromiseImpl} from 'lineupengine';\r\n\r\nexport {ABORTED} from 'lineupengine';\r\nexport declare type IAbortAblePromise<T> = IAbortAblePromiseImpl<T>;\r\n\r\nexport declare type IAggregationStrategy = 'group' | 'item' | 'group+item' | 'group+top+item' | 'group+item+top';\r\n\r\nexport interface IDataProviderOptions {\r\n  columnTypes: {[columnType: string]: IColumnConstructor};\r\n  colorMappingFunctionTypes: {[colorMappingFunctionType: string]: IColorMappingFunctionConstructor};\r\n  mappingFunctionTypes: {[mappingFunctionType: string]: IMappingFunctionConstructor};\r\n\r\n  /**\r\n   * allow just single selected rows\r\n   * @default: false\r\n   */\r\n  singleSelection: boolean;\r\n\r\n  /**\r\n   * show top N rows as sample rows\r\n   * @default 10\r\n   */\r\n  showTopN: number;\r\n\r\n  /**\r\n   * aggregation strategy to show upon grouping, see also showTopN\r\n   * @default 'item'\r\n   */\r\n  aggregationStrategy: IAggregationStrategy;\r\n}\r\n\r\nexport interface IDataProvider extends AEventDispatcher {\r\n  readonly columnTypes: {[columnType: string]: IColumnConstructor};\r\n\r\n  getTotalNumberOfRows(): number;\r\n\r\n  getTaskExecutor(): IRenderTasks;\r\n\r\n  getTypeFactory(): ITypeFactory;\r\n\r\n  takeSnapshot(col: Column): void;\r\n\r\n  selectAllOf(ranking: Ranking): void;\r\n\r\n  getSelection(): number[];\r\n\r\n  setSelection(dataIndices: IndicesArray): void;\r\n\r\n  toggleSelection(i: number, additional?: boolean): boolean;\r\n\r\n  isSelected(i: number): boolean;\r\n\r\n  removeRanking(ranking: Ranking): void;\r\n\r\n  ensureOneRanking(): void;\r\n\r\n  find(id: string): Column | null;\r\n\r\n  clone(col: Column): Column;\r\n\r\n  create(desc: IColumnDesc): Column | null;\r\n\r\n  toDescRef(desc: IColumnDesc): any;\r\n\r\n  fromDescRef(ref: any): IColumnDesc;\r\n\r\n  mappingSample(col: Column): Promise<ISequence<number>> | ISequence<number>;\r\n\r\n  searchAndJump(search: string | RegExp, col: Column): void;\r\n\r\n  getRankings(): Ranking[];\r\n\r\n  getFirstRanking(): Ranking | null;\r\n  getLastRanking(): Ranking;\r\n\r\n  getColumns(): IColumnDesc[];\r\n\r\n  getAggregationStrategy(): IAggregationStrategy;\r\n\r\n  isAggregated(ranking: Ranking, group: IGroup): boolean;\r\n\r\n  setAggregationState(ranking: Ranking, group: IGroup, state: EAggregationState): void;\r\n\r\n  getAggregationState(ranking: Ranking, group: IGroup): EAggregationState;\r\n\r\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean | number | EAggregationState, groups?: IGroup[]): void;\r\n\r\n  getTopNAggregated(ranking: Ranking, group: IGroup): number;\r\n\r\n  setTopNAggregated(ranking: Ranking, group: IGroup, value: number): void;\r\n\r\n  setShowTopN(value: number): void;\r\n  getShowTopN(): number;\r\n\r\n  getRow(dataIndex: number): Promise<IDataRow> | IDataRow;\r\n\r\n  clearFilters(): void;\r\n}\r\n\r\n\r\n\r\nexport const SCHEMA_REF = `https://lineup.js.org/develop/schema.4.0.0.json`;\r\n\r\nexport interface IDataProviderDump {\r\n  '$schema'?: string;\r\n  /**\r\n   * base for generating new uids\r\n   */\r\n  uid?: number;\r\n\r\n  /**\r\n   * current selection\r\n   */\r\n  selection?: number[];\r\n\r\n  /**\r\n   * list of aggregated group paths\r\n   */\r\n  aggregations?: string[] | {[key: string]: number};\r\n  /**\r\n   * ranking dumps\r\n   */\r\n  rankings?: IRankingDump[];\r\n\r\n  /**\r\n   * custom show top N setting\r\n   */\r\n  showTopN?: number;\r\n}\r\n\r\n\r\n\r\nexport interface IDeriveOptions {\r\n  /**\r\n   * maximal percentage of unique values to be treated as a categorical column\r\n   */\r\n  categoricalThreshold: number | ((unique: number, total: number) => boolean);\r\n\r\n  columns: string[];\r\n\r\n  /**\r\n   * date pattern to check for string matching them\r\n   * @default %x\r\n   */\r\n  datePattern: string | string[];\r\n}\r\n\r\n\r\nexport interface IExportOptions {\r\n  /**\r\n   * export separator, default: '\\t'\r\n   */\r\n  separator: string;\r\n  /**\r\n   * new line character, default: '\\n'\r\n   */\r\n  newline: string;\r\n  /**\r\n   * should a header be generated, default: true\r\n   */\r\n  header: boolean;\r\n  /**\r\n   * quote strings, default: false\r\n   */\r\n  quote: boolean;\r\n  /**\r\n   * quote string to use, default: '\"'\r\n   */\r\n  quoteChar: string;\r\n  /**\r\n   * filter specific column types, default: exclude all support types (selection, action, rank)\r\n   * @param col the column description to filter\r\n   */\r\n  filter: (col: Column) => boolean; //!isSupportType\r\n\r\n  /**\r\n   * whether the description should be part of the column header\r\n   */\r\n  verboseColumnHeaders: boolean;\r\n}\r\n","import {IDataRow} from '../model';\r\nimport get from 'lodash.get';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function isComplexAccessor(column: any) {\r\n  // something like a.b or a[4]\r\n  return typeof column === 'string' && (column.includes('.') || column.includes('['));\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function resolveValue(value: any, column: string | number) {\r\n  if (value != null && value.hasOwnProperty(column)) { // well complex but a direct hit\r\n    return value[column];\r\n  }\r\n  return get(value, column);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function rowComplexGetter(row: IDataRow, desc: any) {\r\n  return resolveValue(row.v, desc.column);\r\n}\r\n\r\n\r\n/**\r\n * simple row getter\r\n * @internal\r\n */\r\nexport function rowGetter(row: IDataRow, desc: any) {\r\n  return row.v[desc.column];\r\n}\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function rowGuessGetter(row: IDataRow, desc: any) {\r\n  const column = desc.column;\r\n  if (isComplexAccessor(column)) {\r\n    return rowComplexGetter(row, desc);\r\n  }\r\n  return rowGetter(row, desc);\r\n}\r\n\r\n","import {Ranking, isNumberColumn, Column, IColumnDesc, isSupportType, isMapAbleColumn, DEFAULT_COLOR} from '../model';\r\nimport {colorPool, MAX_COLORS} from '../model/internal';\r\nimport {concat, equal, extent, range, resolveValue} from '../internal';\r\nimport {timeParse} from 'd3-time-format';\r\nimport {IDataProvider, IDeriveOptions, IExportOptions} from './interfaces';\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function cleanCategories(categories: Set<string>) {\r\n  // remove missing values\r\n  categories.delete(<any>null);\r\n  categories.delete(<any>undefined);\r\n  categories.delete('');\r\n  categories.delete('NA');\r\n  categories.delete('NaN');\r\n  categories.delete('na');\r\n\r\n  return Array.from(categories).map(String).sort();\r\n}\r\n\r\nfunction hasDifferentSizes(data: any[][]) {\r\n  if (data.length === 0) {\r\n    return false;\r\n  }\r\n  const base = data[0].length;\r\n\r\n  return data.some((d) => d != null && base !== (Array.isArray(d) ? d.length : -1));\r\n}\r\n\r\nfunction isEmpty(v: any) {\r\n  return v == null || (Array.isArray(v) && v.length === 0) || (v instanceof Set && v.size === 0) || (v instanceof Map && v.size === 0) || equal({}, v);\r\n}\r\n\r\nfunction deriveBaseType(value: any, all: () => any[], column: number | string, options: IDeriveOptions) {\r\n  if (value == null) {\r\n    console.warn('cannot derive from null value for column: ', column);\r\n    return null;\r\n  }\r\n  // primitive\r\n  if (typeof value === 'number') {\r\n    return {\r\n      type: 'number',\r\n      domain: extent(all())\r\n    };\r\n  }\r\n  if (typeof value === 'boolean') {\r\n    return {\r\n      type: 'boolean'\r\n    };\r\n  }\r\n\r\n  if (value instanceof Date) {\r\n    return {\r\n      type: 'date'\r\n    };\r\n  }\r\n  const formats = Array.isArray(options.datePattern) ? options.datePattern : [options.datePattern];\r\n  for (const format of formats) {\r\n    const dateParse = timeParse(format);\r\n    if (dateParse(value) == null) {\r\n      continue;\r\n    }\r\n    return {\r\n      type: 'date',\r\n      dateParse: format\r\n    };\r\n  }\r\n  const treatAsCategorical = typeof options.categoricalThreshold === 'function' ? options.categoricalThreshold : (u: number, t: number) => u < t * (<number>options.categoricalThreshold);\r\n\r\n  if (typeof value === 'string') {\r\n    //maybe a categorical\r\n    const values = all();\r\n    const categories = new Set(values);\r\n    if (treatAsCategorical(categories.size, values.length)) {\r\n      return {\r\n        type: 'categorical',\r\n        categories: cleanCategories(categories)\r\n      };\r\n    }\r\n    return {\r\n      type: 'string'\r\n    };\r\n  }\r\n\r\n  if (typeof value === 'object' && value.alt != null && value.href != null) {\r\n    return {\r\n      type: 'link'\r\n    };\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction deriveType(label: string, value: any, column: number | string, all: () => any[], options: IDeriveOptions): IColumnDesc {\r\n  const base: any = {\r\n    type: 'string',\r\n    label,\r\n    column\r\n  };\r\n\r\n  const primitive = deriveBaseType(value, all, column, options);\r\n  if (primitive != null) {\r\n    return Object.assign(base, primitive);\r\n  }\r\n\r\n  // set\r\n  if (value instanceof Set) {\r\n    const cats = new Set<string>();\r\n    for (const value of all()) {\r\n      if (!(value instanceof Set)) {\r\n        continue;\r\n      }\r\n      value.forEach((vi) =>  {\r\n        cats.add(String(vi));\r\n      });\r\n    }\r\n    return Object.assign(base, {\r\n      type: 'set',\r\n      categories: cleanCategories(cats)\r\n    });\r\n  }\r\n\r\n  // map\r\n  if (value instanceof Map) {\r\n    const first = Array.from(value.values()).find((d) => !isEmpty(d));\r\n    const mapAll = () => {\r\n      const r: any[] = [];\r\n      for (const vi of all()) {\r\n        if (!(vi instanceof Map)) {\r\n          continue;\r\n        }\r\n        vi.forEach((vii) => {\r\n          if (!isEmpty(vii)) {\r\n            r.push(vii);\r\n          }\r\n        });\r\n      }\r\n      return r;\r\n    };\r\n    const p = deriveBaseType(first, mapAll, column, options);\r\n    return Object.assign(base, p || {}, {\r\n      type: p ? `${p.type}Map` : 'stringMap'\r\n    });\r\n  }\r\n\r\n  // array\r\n  if (Array.isArray(value)) {\r\n    const values = all();\r\n    const sameLength = !hasDifferentSizes(values);\r\n    if (sameLength) {\r\n      base.dataLength = value.length;\r\n    }\r\n    const first = value.find((v) => !isEmpty(v));\r\n    const p = deriveBaseType(first, () => concat(values).filter((d) => !isEmpty(d)), column, options);\r\n    if (p && p.type === 'categorical' && !sameLength) {\r\n      return Object.assign(base, p, {\r\n        type : 'set'\r\n      });\r\n    }\r\n    if (p || isEmpty(first)) {\r\n      return Object.assign(base, p || {}, {\r\n        type: p ? `${p.type}s` : 'strings'\r\n      });\r\n    }\r\n\r\n    if (typeof first === 'object' && first.key != null && first.value != null) {\r\n      // key,value pair map\r\n      const mapAll = () => {\r\n        const r: any[] = [];\r\n        for (const vi of values) {\r\n          if (!Array.isArray(vi)) {\r\n            continue;\r\n          }\r\n          for (const vii of vi) {\r\n            if (!isEmpty(vii)) {\r\n              r.push(vii);\r\n            }\r\n          }\r\n        }\r\n        return r;\r\n      };\r\n      const p = deriveBaseType(first.value, mapAll, column, options);\r\n      return Object.assign(base, p || {}, {\r\n        type: p ? `${p.type}Map` : 'stringMap'\r\n      });\r\n    }\r\n  }\r\n\r\n  // check boxplot\r\n  const bs = ['min', 'max', 'median', 'q1', 'q3'];\r\n  if (typeof value === 'object' && bs.every((b) => typeof value[b] === 'number')) {\r\n    //  boxplot\r\n    const vs = all();\r\n    return Object.assign(base, {\r\n      type: 'boxplot',\r\n      domain: [\r\n        vs.reduce((a, b) => Math.min(a, b.min), Number.POSITIVE_INFINITY),\r\n        vs.reduce((a, b) => Math.max(a, b.max), Number.NEGATIVE_INFINITY)\r\n      ]\r\n    });\r\n  }\r\n\r\n  if (typeof value === 'object') {\r\n    // object map\r\n    const first = Object.keys(value).map((k) => value[k]).filter((d) => !isEmpty(d));\r\n    const mapAll = () => {\r\n      const r: any[] = [];\r\n      for (const vi of all()) {\r\n        if (vi == null) {\r\n          continue;\r\n        }\r\n        Object.keys(vi).forEach((k) => {\r\n          const vii = vi[k];\r\n          if (!isEmpty(vii)) {\r\n            r.push(vii);\r\n          }\r\n        });\r\n      }\r\n      return r;\r\n    };\r\n    const p = deriveBaseType(first, mapAll, column, options);\r\n    return Object.assign(base, p || {}, {\r\n      type: p ? `${p.type}Map` : 'stringMap'\r\n    });\r\n  }\r\n\r\n  console.log('cannot infer type of column:', column);\r\n  //unknown type\r\n  return base;\r\n}\r\n\r\nfunction selectColumns(existing: string[], columns: string[]) {\r\n  const allNots = columns.every((d) => d.startsWith('-'));\r\n  if (!allNots) {\r\n    return columns;\r\n  }\r\n  // negate case, exclude columns that are given using -notation\r\n  const exclude = new Set(columns);\r\n  return existing.filter((d) => !exclude.has(`-${d}`));\r\n}\r\n\r\nfunction toLabel(key: string | number) {\r\n  if (typeof(key) === 'number') {\r\n    return `Col ${key + 1}`;\r\n  }\r\n  key = key.trim();\r\n  if (key.length === 0) {\r\n    return 'Unknown';\r\n  }\r\n  return key.split(/[\\s]+/gm).map((k) => k.length === 0 ? k : `${k[0]!.toUpperCase()}${k.slice(1)}`).join(' ');\r\n}\r\n\r\nexport function deriveColumnDescriptions(data: any[], options: Partial<IDeriveOptions> = {}) {\r\n  const config = Object.assign({\r\n    categoricalThreshold: (u: number, n: number) => u <= MAX_COLORS && u < n * 0.7, //70% unique and less equal to 22 categories\r\n    columns: [],\r\n    datePattern: ['%x', '%Y-%m-%d', '%Y-%m-%dT%H:%M:%S.%LZ']\r\n  }, options);\r\n\r\n  const r: IColumnDesc[] = [];\r\n  if (data.length === 0) {\r\n    // no data to derive something from\r\n    return r;\r\n  }\r\n\r\n  const first = data[0];\r\n  const columns: (number|string)[] = Array.isArray(first) ? range(first.length) : (config.columns.length > 0 ? selectColumns(Object.keys(first), config.columns) : Object.keys(first));\r\n\r\n  return columns.map((key) => {\r\n    let v = resolveValue(first, key);\r\n    if (isEmpty(v)) {\r\n      // cannot derive something from null try other rows\r\n      const foundRow = data.find((row) => !isEmpty(resolveValue(row, key)));\r\n      v = foundRow ? foundRow[key] : null;\r\n    }\r\n    return deriveType(toLabel(key), v, key, () => data.map((d) => resolveValue(d, key)).filter((d) => !isEmpty(d)), config);\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * assigns colors to columns if they are numbers and not yet defined\r\n * @param columns\r\n * @returns {IColumnDesc[]}\r\n */\r\nexport function deriveColors(columns: IColumnDesc[]) {\r\n  const colors = colorPool();\r\n  columns.forEach((col: IColumnDesc) => {\r\n    if (isMapAbleColumn(col)) {\r\n      col.colorMapping = col.colorMapping || col.color || colors() || DEFAULT_COLOR;\r\n    }\r\n  });\r\n  return columns;\r\n}\r\n\r\n\r\n/**\r\n * utility to export a ranking to a table with the given separator\r\n * @param ranking\r\n * @param data\r\n * @param options\r\n * @returns {Promise<string>}\r\n */\r\nexport function exportRanking(ranking: Ranking, data: any[], options: Partial<IExportOptions> = {}) {\r\n  const opts = <IExportOptions>Object.assign({\r\n    separator: '\\t',\r\n    newline: '\\n',\r\n    header: true,\r\n    quote: false,\r\n    quoteChar: '\"',\r\n    filter: (c: Column) => !isSupportType(c),\r\n    verboseColumnHeaders: false\r\n  }, options);\r\n\r\n  //optionally quote not numbers\r\n  const escape = new RegExp(`[${opts.quoteChar}]`, 'g');\r\n\r\n  function quote(v: any, c?: Column) {\r\n    const l = String(v);\r\n    if ((opts.quote || l.indexOf('\\n') >= 0) && (!c || !isNumberColumn(c))) {\r\n      return `${opts.quoteChar}${l.replace(escape, opts.quoteChar + opts.quoteChar)}${opts.quoteChar}`;\r\n    }\r\n    return l;\r\n  }\r\n\r\n  const columns = ranking.flatColumns.filter((c) => opts.filter(c));\r\n  const order = ranking.getOrder();\r\n\r\n  const r: string[] = [];\r\n  if (opts.header) {\r\n    r.push(columns.map((d) => quote(`${d.label}${opts.verboseColumnHeaders && d.description ? `\\n${d.description}` : ''}`)).join(opts.separator));\r\n  }\r\n  data.forEach((row, i) => {\r\n    r.push(columns.map((c) => quote(c.getExportValue({v: row, i: order[i]}, 'text'), c)).join(opts.separator));\r\n  });\r\n  return r.join(opts.newline);\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function map2Object<T>(map: Map<string, T>) {\r\n  const r : { [key: string]: T} = {};\r\n  map.forEach((v, k) => r[k] = v);\r\n  return r;\r\n}\r\n\r\n/** @internal */\r\nexport function object2Map<T>(obj: { [key: string]: T}) {\r\n  const r = new Map<string, T>();\r\n  for (const k of Object.keys(obj)) {\r\n    r.set(k, obj[k]);\r\n  }\r\n  return r;\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function rangeSelection(provider: IDataProvider, rankingId: string, dataIndex: number, relIndex: number, ctrlKey: boolean) {\r\n  const ranking = provider.getRankings().find((d) => d.id === rankingId);\r\n  if (!ranking) { // no known reference\r\n    return false;\r\n  }\r\n  const selection = provider.getSelection();\r\n  if (selection.length === 0 || selection.includes(dataIndex)) {\r\n    return false; // no other or deselect\r\n  }\r\n  const order = ranking.getOrder();\r\n  const lookup = new Map(Array.from(order).map((d, i) => <[number, number]>[d, i]));\r\n  const distances = selection.map((d) => {\r\n    const index = (lookup.has(d) ? lookup.get(d)! : Infinity);\r\n    return {s: d, index, distance: Math.abs(relIndex - index)};\r\n  });\r\n  const nearest = distances.sort((a, b) => a.distance - b.distance)[0]!;\r\n  if (!isFinite(nearest.distance)) {\r\n    return false; // all outside\r\n  }\r\n  if (!ctrlKey) {\r\n    selection.splice(0, selection.length);\r\n    selection.push(nearest.s);\r\n  }\r\n  if (nearest.index < relIndex) {\r\n    for (let i = nearest.index + 1; i <= relIndex; ++i) {\r\n      selection.push(order[i]);\r\n    }\r\n  } else {\r\n    for (let i = relIndex; i <= nearest.index; ++i) {\r\n      selection.push(order[i]);\r\n    }\r\n  }\r\n  provider.setSelection(selection);\r\n  return true;\r\n}\r\n","import {AEventDispatcher, debounce, ISequence, OrderedSet, IDebounceContext, IEventListener, suffix, IEventContext} from '../internal';\r\nimport {Column, IColumnConstructor, Ranking, AggregateGroupColumn, createAggregateDesc, IAggregateGroupColumnDesc, isSupportType, EDirtyReason, RankColumn, createRankDesc, createSelectionDesc, IColumnDesc, IDataRow, IGroup, IndicesArray, IOrderedGroup, ISelectionColumnDesc, EAggregationState, IColumnDump, IRankingDump, IColorMappingFunctionConstructor, IMappingFunctionConstructor, ITypeFactory} from '../model';\r\nimport {models} from '../model/models';\r\nimport {forEachIndices, everyIndices, toGroupID, unifyParents} from '../model/internal';\r\nimport {IDataProvider, IDataProviderDump, IDataProviderOptions, SCHEMA_REF, IExportOptions} from './interfaces';\r\nimport {exportRanking, map2Object, object2Map} from './utils';\r\nimport {IRenderTasks} from '../renderer';\r\nimport {restoreCategoricalColorMapping} from '../model/CategoricalColorMappingFunction';\r\nimport {createColorMappingFunction, colorMappingFunctions} from '../model/ColorMappingFunction';\r\nimport {createMappingFunction, mappingFunctions} from '../model/MappingFunction';\r\n\r\n\r\n\r\n/**\r\n * emitted when a column has been added\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function addColumn(col: Column, index: number): void;\r\n\r\n/**\r\n * emitted when a column has been moved within this composite columm\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\r\n\r\n/**\r\n * emitted when a column has been removed\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function removeColumn(col: Column, index: number): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function orderChanged(previous: number[], current: number[], previousGroups: IOrderedGroup[], currentGroups: IOrderedGroup[], dirtyReason: EDirtyReason[]): void;\r\n\r\n\r\n/**\r\n * emitted when state of the column is dirty\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function dirty(): void;\r\n\r\n/**\r\n * emitted when state of the column related to its header is dirty\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function dirtyHeader(): void;\r\n\r\n/**\r\n * emitted when state of the column related to its values is dirty\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function dirtyValues(): void;\r\n\r\n/**\r\n * emitted when state of the column related to cached values (hist, compare, ...) is dirty\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function dirtyCaches(): void;\r\n\r\n\r\n/**\r\n * emitted when the data changes\r\n * @asMemberOf ADataProvider\r\n * @param rows the new data rows\r\n * @event\r\n */\r\nexport declare function dataChanged(rows: IDataRow[]): void;\r\n\r\n/**\r\n * emitted when the selection changes\r\n * @asMemberOf ADataProvider\r\n * @param dataIndices the selected data indices\r\n * @event\r\n */\r\nexport declare function selectionChanged(dataIndices: number[]): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function addRanking(ranking: Ranking, index: number): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @param ranking if null all rankings are removed else just the specific one\r\n * @event\r\n */\r\nexport declare function removeRanking(ranking: Ranking | null, index: number): void;\r\n\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function addDesc(desc: IColumnDesc): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function clearDesc(): void;\r\n\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function showTopNChanged(previous: number, current: number): void;\r\n\r\n/**\r\n * emitted when the selection changes\r\n * @asMemberOf ADataProvider\r\n * @param dataIndices the selected data indices\r\n * @event\r\n */\r\nexport declare function jumpToNearest(dataIndices: number[]): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function aggregate(ranking: Ranking, group: IGroup | IGroup[], value: boolean, state: EAggregationState): void;\r\n\r\n\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function busy(busy: boolean): void;\r\n\r\nfunction toDirtyReason(ctx: IEventContext) {\r\n  const primary = ctx.primaryType;\r\n  switch (primary || '') {\r\n    case Ranking.EVENT_DIRTY_ORDER:\r\n      return ctx.args[0] || [EDirtyReason.UNKNOWN];\r\n    case Ranking.EVENT_SORT_CRITERIA_CHANGED:\r\n      return [EDirtyReason.SORT_CRITERIA_CHANGED];\r\n    case Ranking.EVENT_GROUP_CRITERIA_CHANGED:\r\n      return [EDirtyReason.GROUP_CRITERIA_CHANGED];\r\n    case Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED:\r\n      return [EDirtyReason.GROUP_SORT_CRITERIA_CHANGED];\r\n    default:\r\n      return [EDirtyReason.UNKNOWN];\r\n  }\r\n}\r\n\r\nfunction mergeDirtyOrderContext(current: IDebounceContext, next: IDebounceContext) {\r\n  const currentReason = toDirtyReason(current.self);\r\n  const nextReason = toDirtyReason(next.self);\r\n  const combined = new Set(currentReason);\r\n  for (const r of nextReason) {\r\n    combined.add(r);\r\n  }\r\n  const args = [Array.from(combined)];\r\n  return {\r\n    self: {\r\n      primaryType: Ranking.EVENT_DIRTY_ORDER,\r\n      args\r\n    },\r\n    args\r\n  };\r\n}\r\n\r\n/**\r\n * a basic data provider holding the data and rankings\r\n */\r\nabstract class ADataProvider extends AEventDispatcher implements IDataProvider {\r\n  static readonly EVENT_SELECTION_CHANGED = 'selectionChanged';\r\n  static readonly EVENT_DATA_CHANGED = 'dataChanged';\r\n  static readonly EVENT_ADD_COLUMN = Ranking.EVENT_ADD_COLUMN;\r\n  static readonly EVENT_MOVE_COLUMN = Ranking.EVENT_MOVE_COLUMN;\r\n  static readonly EVENT_REMOVE_COLUMN = Ranking.EVENT_REMOVE_COLUMN;\r\n  static readonly EVENT_ADD_RANKING = 'addRanking';\r\n  static readonly EVENT_REMOVE_RANKING = 'removeRanking';\r\n  static readonly EVENT_DIRTY = Ranking.EVENT_DIRTY;\r\n  static readonly EVENT_DIRTY_HEADER = Ranking.EVENT_DIRTY_HEADER;\r\n  static readonly EVENT_DIRTY_VALUES = Ranking.EVENT_DIRTY_VALUES;\r\n  static readonly EVENT_DIRTY_CACHES = Ranking.EVENT_DIRTY_CACHES;\r\n  static readonly EVENT_ORDER_CHANGED = Ranking.EVENT_ORDER_CHANGED;\r\n  static readonly EVENT_SHOWTOPN_CHANGED = 'showTopNChanged';\r\n  static readonly EVENT_ADD_DESC = 'addDesc';\r\n  static readonly EVENT_CLEAR_DESC = 'clearDesc';\r\n  static readonly EVENT_JUMP_TO_NEAREST = 'jumpToNearest';\r\n  static readonly EVENT_GROUP_AGGREGATION_CHANGED = AggregateGroupColumn.EVENT_AGGREGATE;\r\n  static readonly EVENT_BUSY = 'busy';\r\n\r\n  private static readonly FORWARD_RANKING_EVENTS = suffix('.provider', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN,\r\n    Ranking.EVENT_DIRTY, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_MOVE_COLUMN,\r\n    Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY_CACHES);\r\n\r\n  /**\r\n   * all rankings\r\n   * @type {Array}\r\n   * @private\r\n   */\r\n  private readonly rankings: Ranking[] = [];\r\n\r\n  /**\r\n   * the current selected indices\r\n   * @type {OrderedSet}\r\n   */\r\n  private readonly selection = new OrderedSet<number>();\r\n\r\n  //Map<ranking.id@group.name, -1=expand,0=collapse,N=topN>\r\n  private readonly aggregations = new Map<string, number>(); // not part of = show all\r\n\r\n  private uid = 0;\r\n  private readonly typeFactory: ITypeFactory;\r\n\r\n  private readonly options: Readonly<IDataProviderOptions> = {\r\n    columnTypes: {},\r\n    colorMappingFunctionTypes: {},\r\n    mappingFunctionTypes: {},\r\n    singleSelection: false,\r\n    showTopN: 10,\r\n    aggregationStrategy: 'item'\r\n  };\r\n\r\n  /**\r\n   * lookup map of a column type to its column implementation\r\n   */\r\n  readonly columnTypes: {[columnType: string]: IColumnConstructor};\r\n  readonly colorMappingFunctionTypes: {[colorMappingFunctionType: string]: IColorMappingFunctionConstructor};\r\n  readonly mappingFunctionTypes: {[mappingFunctionType: string]: IMappingFunctionConstructor};\r\n\r\n  private showTopN: number;\r\n\r\n  constructor(options: Partial<IDataProviderOptions> = {}) {\r\n    super();\r\n    Object.assign(this.options, options);\r\n    this.columnTypes = Object.assign(models(), this.options.columnTypes);\r\n    this.colorMappingFunctionTypes = Object.assign(colorMappingFunctions(), this.options.colorMappingFunctionTypes);\r\n    this.mappingFunctionTypes = Object.assign(mappingFunctions(), this.options.mappingFunctionTypes);\r\n    this.showTopN = this.options.showTopN;\r\n\r\n    this.typeFactory = this.createTypeFactory();\r\n  }\r\n\r\n  private createTypeFactory() {\r\n    const factory = <ITypeFactory><any>((d: IColumnDump) => {\r\n      const desc = this.fromDescRef(d.desc);\r\n      if (!desc || !desc.type) {\r\n        console.warn('cannot restore column dump', d);\r\n        return new Column(d.id || '', d.desc || {});\r\n      }\r\n      this.fixDesc(desc);\r\n      const type = this.columnTypes[desc.type];\r\n      if (type == null) {\r\n        console.warn('invalid column type in column dump using column', d);\r\n        return new Column(d.id || '', desc);\r\n      }\r\n      const c = this.instantiateColumn(type, '', desc, this.typeFactory);\r\n      c.restore(d, factory);\r\n      return c;\r\n    });\r\n    factory.colorMappingFunction = createColorMappingFunction(this.colorMappingFunctionTypes, factory);\r\n    factory.mappingFunction = createMappingFunction(this.mappingFunctionTypes);\r\n    factory.categoricalColorMappingFunction = restoreCategoricalColorMapping;\r\n    return factory;\r\n  }\r\n\r\n  getTypeFactory() {\r\n    return this.typeFactory;\r\n  }\r\n\r\n  /**\r\n   * events:\r\n   *  * column changes: addColumn, removeColumn\r\n   *  * ranking changes: addRanking, removeRanking\r\n   *  * dirty: dirty, dirtyHeder, dirtyValues\r\n   *  * selectionChanged\r\n   * @returns {string[]}\r\n   */\r\n  protected createEventList() {\r\n    return super.createEventList().concat([\r\n      ADataProvider.EVENT_DATA_CHANGED, ADataProvider.EVENT_BUSY,\r\n      ADataProvider.EVENT_SHOWTOPN_CHANGED,\r\n      ADataProvider.EVENT_ADD_COLUMN, ADataProvider.EVENT_REMOVE_COLUMN, ADataProvider.EVENT_MOVE_COLUMN,\r\n      ADataProvider.EVENT_ADD_RANKING, ADataProvider.EVENT_REMOVE_RANKING,\r\n      ADataProvider.EVENT_DIRTY, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY_CACHES,\r\n      ADataProvider.EVENT_ORDER_CHANGED, ADataProvider.EVENT_SELECTION_CHANGED,\r\n      ADataProvider.EVENT_ADD_DESC, ADataProvider.EVENT_CLEAR_DESC,\r\n      ADataProvider.EVENT_JUMP_TO_NEAREST, ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ADataProvider.EVENT_BUSY, listener: typeof busy | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DATA_CHANGED, listener: typeof dataChanged | null): this;\r\n  on(type: typeof ADataProvider.EVENT_SHOWTOPN_CHANGED, listener: typeof showTopNChanged | null): this;\r\n  on(type: typeof ADataProvider.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof ADataProvider.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof ADataProvider.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof ADataProvider.EVENT_ADD_RANKING, listener: typeof addRanking | null): this;\r\n  on(type: typeof ADataProvider.EVENT_REMOVE_RANKING, listener: typeof removeRanking | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\r\n  on(type: typeof ADataProvider.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\r\n  on(type: typeof ADataProvider.EVENT_ADD_DESC, listener: typeof addDesc | null): this;\r\n  on(type: typeof ADataProvider.EVENT_CLEAR_DESC, listener: typeof clearDesc | null): this;\r\n  on(type: typeof ADataProvider.EVENT_JUMP_TO_NEAREST, listener: typeof jumpToNearest | null): this;\r\n  on(type: typeof ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, listener: typeof aggregate | null): this;\r\n  on(type: typeof ADataProvider.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  abstract getTotalNumberOfRows(): number;\r\n\r\n  /**\r\n   * returns a list of all known column descriptions\r\n   * @returns {Array}\r\n   */\r\n  abstract getColumns(): IColumnDesc[];\r\n\r\n  abstract getTaskExecutor(): IRenderTasks;\r\n\r\n  /**\r\n   * adds a new ranking\r\n   * @param existing an optional existing ranking to clone\r\n   * @return the new ranking\r\n   */\r\n  pushRanking(existing?: Ranking): Ranking {\r\n    const r = this.cloneRanking(existing);\r\n\r\n    this.insertRanking(r);\r\n    return r;\r\n  }\r\n\r\n  protected fireBusy(busy: boolean) {\r\n    this.fire(ADataProvider.EVENT_BUSY, busy);\r\n  }\r\n\r\n  takeSnapshot(col: Column): Ranking {\r\n    this.fireBusy(true);\r\n    const r = this.cloneRanking();\r\n    const ranking = col.findMyRanker();\r\n    // by convention copy all support types and the first string column\r\n    let hasString = col.desc.type === 'string';\r\n    let hasColumn = false;\r\n    const toClone = !ranking ? [col] : ranking.children.filter((c) => {\r\n      if (c === col) {\r\n        hasColumn = true;\r\n        return true;\r\n      }\r\n      if (!hasString && c.desc.type === 'string') {\r\n        hasString = true;\r\n        return true;\r\n      }\r\n      return isSupportType(c);\r\n    });\r\n\r\n    if (!hasColumn) {\r\n      // maybe a nested one thus not in the top level\r\n      toClone.push(col);\r\n    }\r\n\r\n    toClone.forEach((c) => {\r\n      const clone = this.clone(c);\r\n      r.push(clone);\r\n      if (c === col) {\r\n        clone.sortByMe();\r\n      }\r\n    });\r\n    this.insertRanking(r);\r\n    this.fireBusy(false);\r\n    return r;\r\n  }\r\n\r\n  insertRanking(r: Ranking, index = this.rankings.length) {\r\n    this.rankings.splice(index, 0, r);\r\n    this.forward(r, ...ADataProvider.FORWARD_RANKING_EVENTS);\r\n    //delayed reordering per ranking\r\n    const that = this;\r\n    r.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, debounce(function(this: IEventContext) {\r\n      that.triggerReorder(r, toDirtyReason(this));\r\n    }, 100, mergeDirtyOrderContext));\r\n    this.fire([ADataProvider.EVENT_ADD_RANKING, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], r, index);\r\n    this.triggerReorder(r);\r\n  }\r\n\r\n  private triggerReorder(ranking: Ranking, dirtyReason?: EDirtyReason[]) {\r\n    this.fireBusy(true);\r\n    const reason = dirtyReason || [EDirtyReason.UNKNOWN];\r\n    Promise.resolve(this.sort(ranking, reason)).then(({groups, index2pos}) => {\r\n      groups = unifyParents(groups);\r\n      this.initAggregateState(ranking, groups);\r\n      ranking.setGroups(groups, index2pos, reason);\r\n      this.fireBusy(false);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * removes a ranking from this data provider\r\n   * @param ranking\r\n   * @returns {boolean}\r\n   */\r\n  removeRanking(ranking: Ranking) {\r\n    const i = this.rankings.indexOf(ranking);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n    this.unforward(ranking, ...ADataProvider.FORWARD_RANKING_EVENTS);\r\n    this.rankings.splice(i, 1);\r\n    ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\r\n    this.cleanUpRanking(ranking);\r\n    this.fire([ADataProvider.EVENT_REMOVE_RANKING, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], ranking, i);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * removes all rankings\r\n   */\r\n  clearRankings() {\r\n    this.rankings.forEach((ranking) => {\r\n      this.unforward(ranking, ...ADataProvider.FORWARD_RANKING_EVENTS);\r\n      ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\r\n      this.cleanUpRanking(ranking);\r\n    });\r\n    // clear\r\n    this.rankings.splice(0, this.rankings.length);\r\n    this.fire([ADataProvider.EVENT_REMOVE_RANKING, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], null, -1);\r\n  }\r\n\r\n  clearFilters() {\r\n    this.rankings.forEach((ranking) => ranking.clearFilters());\r\n  }\r\n\r\n  /**\r\n   * returns a list of all current rankings\r\n   * @returns {Ranking[]}\r\n   */\r\n  getRankings() {\r\n    return this.rankings.slice();\r\n  }\r\n\r\n  /**\r\n   * returns the last ranking for quicker access\r\n   * @returns {Ranking}\r\n   */\r\n  getFirstRanking() {\r\n    return this.rankings[0] || null;\r\n  }\r\n\r\n  /**\r\n   * returns the last ranking for quicker access\r\n   * @returns {Ranking}\r\n   */\r\n  getLastRanking() {\r\n    return this.rankings[this.rankings.length - 1];\r\n  }\r\n\r\n  ensureOneRanking() {\r\n    if (this.rankings.length === 0) {\r\n      const r = this.pushRanking();\r\n      this.push(r, createRankDesc());\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    // dummy\r\n  }\r\n\r\n  /**\r\n   * hook method for cleaning up a ranking\r\n   * @param _ranking\r\n   */\r\n  cleanUpRanking(_ranking: Ranking) {\r\n    // dummy\r\n  }\r\n\r\n  /**\r\n   * abstract method for cloning a ranking\r\n   * @param existing\r\n   * @returns {null}\r\n   */\r\n  abstract cloneRanking(existing?: Ranking): Ranking;\r\n\r\n  /**\r\n   * adds a column to a ranking described by its column description\r\n   * @param ranking the ranking to add the column to\r\n   * @param desc the description of the column\r\n   * @return {Column} the newly created column or null\r\n   */\r\n  push(ranking: Ranking, desc: IColumnDesc): Column | null {\r\n    const r = this.create(desc);\r\n    if (r) {\r\n      ranking.push(r);\r\n      return r;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * adds a column to a ranking described by its column description\r\n   * @param ranking the ranking to add the column to\r\n   * @param index the position to insert the column\r\n   * @param desc the description of the column\r\n   * @return {Column} the newly created column or null\r\n   */\r\n  insert(ranking: Ranking, index: number, desc: IColumnDesc) {\r\n    const r = this.create(desc);\r\n    if (r) {\r\n      ranking.insert(r, index);\r\n      return r;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * creates a new unique id for a column\r\n   * @returns {string}\r\n   */\r\n  private nextId() {\r\n    return `col${this.uid++}`;\r\n  }\r\n\r\n  private fixDesc(desc: IColumnDesc) {\r\n    //hacks for provider dependent descriptors\r\n    if (desc.type === 'selection') {\r\n      (<ISelectionColumnDesc>desc).accessor = (row: IDataRow) => this.isSelected(row.i);\r\n      (<ISelectionColumnDesc>desc).setter = (index: number, value: boolean) => value ? this.select(index) : this.deselect(index);\r\n      (<ISelectionColumnDesc>desc).setterAll = (indices: IndicesArray, value: boolean) => value ? this.selectAll(indices) : this.deselectAll(indices);\r\n    } else if (desc.type === 'aggregate') {\r\n      (<IAggregateGroupColumnDesc>desc).isAggregated = (ranking: Ranking, group: IGroup) => this.getAggregationState(ranking, group);\r\n      (<IAggregateGroupColumnDesc>desc).setAggregated = (ranking: Ranking, group: IGroup, value: EAggregationState) => this.setAggregationState(ranking, group, value);\r\n    }\r\n    return desc;\r\n  }\r\n\r\n  protected cleanDesc(desc: IColumnDesc) {\r\n    //hacks for provider dependent descriptors\r\n    if (desc.type === 'selection') {\r\n      delete (<ISelectionColumnDesc>desc).accessor;\r\n      delete (<ISelectionColumnDesc>desc).setter;\r\n      delete (<ISelectionColumnDesc>desc).setterAll;\r\n    } else if (desc.type === 'aggregate') {\r\n      delete (<IAggregateGroupColumnDesc>desc).isAggregated;\r\n      delete (<IAggregateGroupColumnDesc>desc).setAggregated;\r\n    }\r\n    return desc;\r\n  }\r\n\r\n  /**\r\n   * creates an internal column model out of the given column description\r\n   * @param desc\r\n   * @returns {Column} the new column or null if it can't be created\r\n   */\r\n  create(desc: IColumnDesc): Column | null {\r\n    this.fixDesc(desc);\r\n    //find by type and instantiate\r\n    const type = this.columnTypes[desc.type];\r\n    if (type) {\r\n      return this.instantiateColumn(type, this.nextId(), desc, this.typeFactory);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  protected instantiateColumn(type: IColumnConstructor, id: string, desc: IColumnDesc, typeFactory: ITypeFactory) {\r\n    return new type(id, desc, typeFactory);\r\n  }\r\n\r\n  /**\r\n   * clones a column by dumping and restoring\r\n   * @param col\r\n   * @returns {Column}\r\n   */\r\n  clone(col: Column) {\r\n    const dump = this.dumpColumn(col);\r\n    return this.restoreColumn(dump);\r\n  }\r\n\r\n  /**\r\n   * restores a column from a dump\r\n   * @param dump\r\n   * @returns {Column}\r\n   */\r\n  restoreColumn(dump: any): Column {\r\n    const c = this.typeFactory(dump);\r\n    c.assignNewId(this.nextId.bind(this));\r\n    return c;\r\n  }\r\n\r\n  /**\r\n   * finds a column in all rankings returning the first match\r\n   * @param idOrFilter by id or by a filter function\r\n   * @returns {Column}\r\n   */\r\n  find(idOrFilter: string | ((col: Column) => boolean)): Column | null {\r\n    //convert to function\r\n    const filter = typeof (idOrFilter) === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\r\n\r\n    for (const ranking of this.rankings) {\r\n      const r = ranking.find(filter);\r\n      if (r) {\r\n        return r;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n\r\n  /**\r\n   * dumps this whole provider including selection and the rankings\r\n   * @returns {{uid: number, selection: number[], rankings: *[]}}\r\n   */\r\n  dump(): IDataProviderDump {\r\n    return {\r\n      '$schema': SCHEMA_REF,\r\n      uid: this.uid,\r\n      selection: this.getSelection(),\r\n      aggregations: map2Object(this.aggregations),\r\n      rankings: this.rankings.map((r) => r.dump(this.toDescRef.bind(this))),\r\n      showTopN: this.showTopN\r\n    };\r\n  }\r\n\r\n  /**\r\n   * dumps a specific column\r\n   */\r\n  dumpColumn(col: Column): IColumnDump {\r\n    return col.dump(this.toDescRef.bind(this));\r\n  }\r\n\r\n  /**\r\n   * for better dumping describe reference, by default just return the description\r\n   */\r\n  toDescRef(desc: any): any {\r\n    return desc;\r\n  }\r\n\r\n  /**\r\n   * inverse operation of toDescRef\r\n   */\r\n  fromDescRef(descRef: any): any {\r\n    return descRef;\r\n  }\r\n\r\n  restoreRanking(dump: IRankingDump) {\r\n    const ranking = this.cloneRanking();\r\n    ranking.restore(dump, this.typeFactory);\r\n    const idGenerator = this.nextId.bind(this);\r\n    ranking.children.forEach((c) => c.assignNewId(idGenerator));\r\n    return ranking;\r\n  }\r\n\r\n  restore(dump: IDataProviderDump) {\r\n    //clean old\r\n    this.clearRankings();\r\n\r\n    //restore selection\r\n    this.uid = dump.uid || 0;\r\n    if (dump.selection) {\r\n      dump.selection.forEach((s: number) => this.selection.add(s));\r\n    }\r\n    if (dump.showTopN != null) {\r\n      this.showTopN = dump.showTopN;\r\n    }\r\n    if (dump.aggregations) {\r\n      this.aggregations.clear();\r\n      if (Array.isArray(dump.aggregations)) {\r\n        dump.aggregations.forEach((a: string) => this.aggregations.set(a, 0));\r\n      } else {\r\n        object2Map(dump.aggregations).forEach((v, k) => this.aggregations.set(k, v));\r\n      }\r\n    }\r\n\r\n\r\n    //restore rankings\r\n    if (dump.rankings) {\r\n      dump.rankings.forEach((r: any) => {\r\n        const ranking = this.cloneRanking();\r\n        ranking.restore(r, this.typeFactory);\r\n        //if no rank column add one\r\n        if (!ranking.children.some((d) => d instanceof RankColumn)) {\r\n          ranking.insert(this.create(createRankDesc())!, 0);\r\n        }\r\n        this.insertRanking(ranking);\r\n      });\r\n    }\r\n\r\n    //assign new ids\r\n    const idGenerator = this.nextId.bind(this);\r\n    this.rankings.forEach((r) => {\r\n      r.children.forEach((c) => c.assignNewId(idGenerator));\r\n    });\r\n  }\r\n\r\n  abstract findDesc(ref: string): IColumnDesc | null;\r\n\r\n  /**\r\n   * generates a default ranking by using all column descriptions ones\r\n   */\r\n  deriveDefault(addSupportType: boolean = true) {\r\n    const r = this.pushRanking();\r\n    if (addSupportType) {\r\n      r.push(this.create(createAggregateDesc())!);\r\n      r.push(this.create(createRankDesc())!);\r\n      if (this.options.singleSelection !== false) {\r\n        r.push(this.create(createSelectionDesc())!);\r\n      }\r\n    }\r\n    this.getColumns().forEach((col) => {\r\n      const c = this.create(col);\r\n      if (!c || isSupportType(c)) {\r\n        return;\r\n      }\r\n      r.push(c);\r\n    });\r\n    return r;\r\n  }\r\n\r\n  isAggregated(ranking: Ranking, group: IGroup) {\r\n    return this.getTopNAggregated(ranking, group) >= 0;\r\n  }\r\n\r\n  getAggregationState(ranking: Ranking, group: IGroup) {\r\n    const n = this.getTopNAggregated(ranking, group);\r\n    return n < 0 ? EAggregationState.EXPAND : (n === 0 ? EAggregationState.COLLAPSE : EAggregationState.EXPAND_TOP_N);\r\n  }\r\n\r\n  setAggregated(ranking: Ranking, group: IGroup, value: boolean) {\r\n    return this.setAggregationState(ranking, group, value ? EAggregationState.COLLAPSE : EAggregationState.EXPAND);\r\n  }\r\n\r\n  setAggregationState(ranking: Ranking, group: IGroup, value: EAggregationState) {\r\n    this.setTopNAggregated(ranking, group, value === EAggregationState.COLLAPSE ? 0 : (value === EAggregationState.EXPAND_TOP_N ? this.showTopN  : -1));\r\n  }\r\n\r\n  getTopNAggregated(ranking: Ranking, group: IGroup) {\r\n    let g: IGroup | undefined | null = group;\r\n    while (g) {\r\n      const key = `${ranking.id}@${toGroupID(g)}`;\r\n      if (this.aggregations.has(key)) {\r\n        // propagate to leaf\r\n        const v = this.aggregations.get(key)!;\r\n        this.aggregations.set(`${ranking.id}@${toGroupID(group)}`, v);\r\n        return v;\r\n      }\r\n      g = g.parent;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  private unaggregateParents(ranking: Ranking, group: IGroup) {\r\n    let g: IGroup | undefined | null = group.parent;\r\n    while (g) {\r\n      this.aggregations.delete(`${ranking.id}@${toGroupID(g)}`);\r\n      g = g.parent;\r\n    }\r\n  }\r\n\r\n  getAggregationStrategy() {\r\n    return this.options.aggregationStrategy;\r\n  }\r\n\r\n  private initAggregateState(ranking: Ranking, groups: IGroup[]) {\r\n    let initial = -1;\r\n    switch(this.getAggregationStrategy()) {\r\n      case 'group':\r\n        initial = 0;\r\n        break;\r\n      case 'item':\r\n      case 'group+item':\r\n      case 'group+item+top':\r\n        initial = -1;\r\n        break;\r\n      case 'group+top+item':\r\n        initial = this.showTopN;\r\n        break;\r\n    }\r\n\r\n    for (const group of groups) {\r\n      const key = `${ranking.id}@${toGroupID(group)}`;\r\n      if (!this.aggregations.has(key) && initial >= 0) {\r\n        this.aggregations.set(key, initial);\r\n      }\r\n    }\r\n  }\r\n\r\n  setTopNAggregated(ranking: Ranking, group: IGroup, value: number) {\r\n    this.unaggregateParents(ranking, group);\r\n    const key = `${ranking.id}@${toGroupID(group)}`;\r\n    const current = this.getTopNAggregated(ranking, group);\r\n    if (current === value) {\r\n      return;\r\n    }\r\n    if (value >= 0) {\r\n      this.aggregations.set(key, value);\r\n    } else {\r\n      this.aggregations.delete(key);\r\n    }\r\n    this.fire([ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], ranking, group, value);\r\n  }\r\n\r\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean | number | EAggregationState, groups = ranking.getGroups()) {\r\n    let v: number;\r\n    if (typeof aggregateAll === 'boolean') {\r\n      v = aggregateAll ? 0 : -1;\r\n    } else if (aggregateAll === EAggregationState.COLLAPSE) {\r\n      v = 0;\r\n    } else if (aggregateAll === EAggregationState.EXPAND) {\r\n      v = -1;\r\n    } else if (aggregateAll === EAggregationState.EXPAND_TOP_N) {\r\n      v = this.showTopN;\r\n    } else {\r\n      v = aggregateAll;\r\n    }\r\n\r\n    for(const group of groups) {\r\n      this.unaggregateParents(ranking, group);\r\n      const current = this.getTopNAggregated(ranking, group);\r\n      if (current === v) {\r\n        continue;\r\n      }\r\n      const key = `${ranking.id}@${toGroupID(group)}`;\r\n      if (v >= 0) {\r\n        this.aggregations.set(key, v);\r\n      } else {\r\n        this.aggregations.delete(key);\r\n      }\r\n    }\r\n    this.fire([ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], ranking, groups, v >= 0, v);\r\n  }\r\n\r\n  getShowTopN() {\r\n    return this.showTopN;\r\n  }\r\n\r\n  setShowTopN(value: number) {\r\n    if (this.showTopN === value) {\r\n      return;\r\n    }\r\n    // update entries\r\n    for (const [k, v] of Array.from(this.aggregations.entries())) {\r\n      if (v === this.showTopN) {\r\n        this.aggregations.set(k, value);\r\n      }\r\n    }\r\n    this.fire([ADataProvider.EVENT_SHOWTOPN_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], this.showTopN, this.showTopN = value);\r\n  }\r\n\r\n  /**\r\n   * sorts the given ranking and eventually return a ordering of the data items\r\n   * @param ranking\r\n   * @return {Promise<any>}\r\n   */\r\n  abstract sort(ranking: Ranking, dirtyReason: EDirtyReason[]): Promise<{groups: IOrderedGroup[], index2pos: IndicesArray}> | {groups: IOrderedGroup[], index2pos: IndicesArray};\r\n\r\n  /**\r\n   * returns a view in the order of the given indices\r\n   * @param indices\r\n   * @return {Promise<any>}\r\n   */\r\n  abstract view(indices: ArrayLike<number>): Promise<any[]> | any[];\r\n\r\n\r\n  abstract getRow(index: number): Promise<IDataRow> | IDataRow;\r\n\r\n  /**\r\n   * returns a data sample used for the mapping editor\r\n   * @param col\r\n   * @return {Promise<any>}\r\n   */\r\n  abstract mappingSample(col: Column): Promise<ISequence<number>> | ISequence<number>;\r\n\r\n  /**\r\n   * is the given row selected\r\n   * @param index\r\n   * @return {boolean}\r\n   */\r\n  isSelected(index: number) {\r\n    return this.selection.has(index);\r\n  }\r\n\r\n  /**\r\n   * also select the given row\r\n   * @param index\r\n   */\r\n  select(index: number) {\r\n    if (this.selection.has(index)) {\r\n      return; //no change\r\n    }\r\n    if (this.options.singleSelection === true && this.selection.size > 0) {\r\n      this.selection.clear();\r\n    }\r\n    this.selection.add(index);\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * hook for selecting elements matching the given arguments\r\n   * @param search\r\n   * @param col\r\n   */\r\n  abstract searchAndJump(search: string | RegExp, col: Column): void;\r\n\r\n  jumpToNearest(indices: number[]) {\r\n    if (indices.length === 0) {\r\n      return;\r\n    }\r\n    this.fire(ADataProvider.EVENT_JUMP_TO_NEAREST, indices);\r\n  }\r\n\r\n  /**\r\n   * also select all the given rows\r\n   * @param indices\r\n   */\r\n  selectAll(indices: IndicesArray) {\r\n    if (everyIndices(indices, (i) => this.selection.has(i))) {\r\n      return; //no change\r\n    }\r\n    if (this.options.singleSelection === true) {\r\n      this.selection.clear();\r\n      if (indices.length > 0) {\r\n        this.selection.add(indices[0]);\r\n      }\r\n    } else {\r\n      forEachIndices(indices, (index) => {\r\n        this.selection.add(index);\r\n      });\r\n    }\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  selectAllOf(ranking: Ranking) {\r\n    this.setSelection(Array.from(ranking.getOrder()));\r\n  }\r\n\r\n  /**\r\n   * set the selection to the given rows\r\n   * @param indices\r\n   */\r\n  setSelection(indices: number[]) {\r\n    if (indices.length === 0) {\r\n      return this.clearSelection();\r\n    }\r\n    if (this.selection.size === indices.length && indices.every((i) => this.selection.has(i))) {\r\n      return; //no change\r\n    }\r\n    this.selection.clear();\r\n    this.selectAll(indices);\r\n  }\r\n\r\n  /**\r\n   * toggles the selection of the given data index\r\n   * @param index\r\n   * @param additional just this element or all\r\n   * @returns {boolean} whether the index is currently selected\r\n   */\r\n  toggleSelection(index: number, additional = false) {\r\n    if (this.isSelected(index)) {\r\n      if (additional) {\r\n        this.deselect(index);\r\n      } else {\r\n        this.clearSelection();\r\n      }\r\n      return false;\r\n    }\r\n    if (additional) {\r\n      this.select(index);\r\n    } else {\r\n      this.setSelection([index]);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * deselect the given row\r\n   * @param index\r\n   */\r\n  deselect(index: number) {\r\n    if (!this.selection.has(index)) {\r\n      return; //no change\r\n    }\r\n    this.selection.delete(index);\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * also select all the given rows\r\n   * @param indices\r\n   */\r\n  deselectAll(indices: IndicesArray) {\r\n    if (everyIndices(indices, (i) => !this.selection.has(i))) {\r\n      return; //no change\r\n    }\r\n    forEachIndices(indices, (index) => {\r\n      this.selection.delete(index);\r\n    });\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * returns a promise containing the selected rows\r\n   * @return {Promise<any[]>}\r\n   */\r\n  selectedRows(): Promise<any[]> | any[] {\r\n    if (this.selection.size === 0) {\r\n      return [];\r\n    }\r\n    return this.view(this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * returns the currently selected indices\r\n   * @returns {Array}\r\n   */\r\n  getSelection() {\r\n    return Array.from(this.selection);\r\n  }\r\n\r\n  /**\r\n   * clears the selection\r\n   */\r\n  clearSelection() {\r\n    if (this.selection.size === 0) {\r\n      return; //no change\r\n    }\r\n    this.selection.clear();\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, [], false);\r\n  }\r\n\r\n  /**\r\n   * utility to export a ranking to a table with the given separator\r\n   * @param ranking\r\n   * @param options\r\n   * @returns {Promise<string>}\r\n   */\r\n  exportTable(ranking: Ranking, options: Partial<IExportOptions> = {}) {\r\n    return Promise.resolve(this.view(ranking.getOrder())).then((data) => exportRanking(ranking, data, options));\r\n  }\r\n}\r\n\r\nexport default ADataProvider;\r\n","import {ActionColumn, AggregateGroupColumn, AnnotateColumn, BooleanColumn, BooleansColumn, BoxPlotColumn, CategoricalColumn, CategoricalMapColumn, CategoricalsColumn, DateColumn, DatesColumn, DatesMapColumn, GroupColumn, HierarchyColumn, ImpositionBoxPlotColumn, ImpositionCompositeColumn, ImpositionCompositesColumn, LinkColumn, LinkMapColumn, LinksColumn, NestedColumn, NumberColumn, NumberMapColumn, NumbersColumn, OrdinalColumn, RankColumn, ReduceColumn, ScriptColumn, SelectionColumn, SetColumn, StackColumn, StringColumn, StringMapColumn, StringsColumn} from './';\r\n\r\n/**\r\n * a map of all known column types\r\n */\r\nexport function models() {\r\n  return {\r\n    actions: ActionColumn,\r\n    aggregate: AggregateGroupColumn,\r\n    annotate: AnnotateColumn,\r\n    boolean: BooleanColumn,\r\n    booleans: BooleansColumn,\r\n    boxplot: BoxPlotColumn,\r\n    categorical: CategoricalColumn,\r\n    categoricalMap: CategoricalMapColumn,\r\n    categoricals: CategoricalsColumn,\r\n    date: DateColumn,\r\n    dateMap: DatesMapColumn,\r\n    dates: DatesColumn,\r\n    group: GroupColumn,\r\n    hierarchy: HierarchyColumn,\r\n    imposition: ImpositionCompositeColumn,\r\n    impositionBoxPlot: ImpositionBoxPlotColumn,\r\n    impositions: ImpositionCompositesColumn,\r\n    reduce: ReduceColumn,\r\n    nested: NestedColumn,\r\n    number: NumberColumn,\r\n    numbers: NumbersColumn,\r\n    numberMap: NumberMapColumn,\r\n    ordinal: OrdinalColumn,\r\n    rank: RankColumn,\r\n    script: ScriptColumn,\r\n    selection: SelectionColumn,\r\n    set: SetColumn,\r\n    stack: StackColumn,\r\n    string: StringColumn,\r\n    stringMap: StringMapColumn,\r\n    strings: StringsColumn,\r\n    link: LinkColumn,\r\n    linkMap: LinkMapColumn,\r\n    links: LinksColumn\r\n  };\r\n}\r\n","import {IColumnDesc, Ranking} from '../model';\r\nimport ADataProvider from './ADataProvider';\r\nimport {IDataProviderDump, IDataProviderOptions} from './interfaces';\r\nimport {isComplexAccessor, rowGetter, rowComplexGetter, rowGuessGetter} from '../internal';\r\n\r\n\r\nfunction injectAccessor(d: any) {\r\n  d.accessor = d.accessor || (d.column ? (isComplexAccessor(d.column) ? rowComplexGetter : rowGetter) : rowGuessGetter);\r\n  d.label = d.label || d.column;\r\n  return d;\r\n}\r\n\r\n/**\r\n * common base implementation of a DataProvider with a fixed list of column descriptions\r\n */\r\nabstract class ACommonDataProvider extends ADataProvider {\r\n\r\n  private rankingIndex = 0;\r\n\r\n  constructor(private columns: IColumnDesc[] = [], options: Partial<IDataProviderOptions> = {}) {\r\n    super(options);\r\n    //generate the accessor\r\n    columns.forEach(injectAccessor);\r\n  }\r\n\r\n  cloneRanking(existing?: Ranking) {\r\n    const id = this.nextRankingId();\r\n    const clone = new Ranking(id);\r\n\r\n    if (existing) { //copy the ranking of the other one\r\n      //TODO better cloning\r\n      existing.children.forEach((child) => {\r\n        this.push(clone, child.desc);\r\n      });\r\n    }\r\n\r\n    return clone;\r\n  }\r\n\r\n  /**\r\n   * adds another column description to this data provider\r\n   * @param column\r\n   */\r\n  pushDesc(column: IColumnDesc) {\r\n    injectAccessor(column);\r\n    this.columns.push(column);\r\n    this.fire(ADataProvider.EVENT_ADD_DESC, column);\r\n  }\r\n\r\n  clearColumns() {\r\n    this.clearRankings();\r\n    this.columns.splice(0, this.columns.length);\r\n    this.fire(ADataProvider.EVENT_CLEAR_DESC);\r\n  }\r\n\r\n  getColumns(): IColumnDesc[] {\r\n    return this.columns.slice();\r\n  }\r\n\r\n  findDesc(ref: string) {\r\n    return this.columns.filter((c) => (<any>c).column === ref)[0];\r\n  }\r\n\r\n  /**\r\n   * identify by the tuple type@columnname\r\n   * @param desc\r\n   * @returns {string}\r\n   */\r\n  toDescRef(desc: any): any {\r\n    return typeof desc.column !== 'undefined' ? `${desc.type}@${desc.column}` : this.cleanDesc(Object.assign({}, desc));\r\n  }\r\n\r\n  fromDescRef(descRef: any): any {\r\n    if (typeof (descRef) === 'string') {\r\n      return this.columns.find((d: any) => `${d.type}@${d.column}` === descRef || d.type === descRef);\r\n    }\r\n    const existing = this.columns.find((d) => descRef.column === (<any>d).column && descRef.label === d.label && descRef.type === d.type);\r\n    if (existing) {\r\n      return existing;\r\n    }\r\n    return descRef;\r\n  }\r\n\r\n  restore(dump: IDataProviderDump) {\r\n    super.restore(dump);\r\n    this.rankingIndex = 1 + Math.max(...this.getRankings().map((r) => +r.id.substring(4)));\r\n  }\r\n\r\n  nextRankingId() {\r\n    return `rank${this.rankingIndex++}`;\r\n  }\r\n}\r\n\r\nexport default ACommonDataProvider;\r\n","import {createIndexArray, ILookUpArray} from '../internal';\r\nimport {FIRST_IS_MISSING, FIRST_IS_NAN, ECompareValueType, ICompareValue, Column, UIntTypedArray, Ranking, IDataRow} from '../model';\r\n\r\n\r\nconst missingUInt8 = FIRST_IS_MISSING > 0 ? 255 : 0;\r\nconst missingBinary = missingUInt8;\r\nconst missingUInt16 = FIRST_IS_MISSING > 0 ? 65535 : 0; // max or 0\r\nconst missingUInt32 = FIRST_IS_MISSING > 0 ? 4294967295 : 0; // max or 0\r\nconst missingInt8 = FIRST_IS_MISSING > 0 ? 127 : -128; // max or min\r\nconst missingInt16 = FIRST_IS_MISSING > 0 ? 32767 : -32768; // max or min\r\nconst missingInt32 = FIRST_IS_MISSING > 0 ? 2147483647 : -2147483648; // max or min\r\nconst missingFloat = FIRST_IS_NAN > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\r\nconst missingFloatAsc = FIRST_IS_MISSING > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\r\nconst missingString = FIRST_IS_MISSING > 0 ? '\\uffff' : '\\u0000'; // first or last character\r\n\r\n\r\nfunction chooseMissingByLength(length: number) {\r\n  if (length <= 255) {\r\n    return missingBinary;\r\n  }\r\n  if (length <= 65535) {\r\n    return missingUInt16;\r\n  }\r\n  return missingUInt32;\r\n}\r\n\r\n\r\nfunction toCompareLookUp(rawLength: number, type: ECompareValueType): ILookUpArray {\r\n  switch (type) {\r\n    case ECompareValueType.COUNT:\r\n      return createIndexArray(rawLength + 1);\r\n    case ECompareValueType.BINARY:\r\n    case ECompareValueType.UINT8:\r\n      return new Uint8Array(rawLength);\r\n    case ECompareValueType.UINT16:\r\n      return new Uint16Array(rawLength);\r\n    case ECompareValueType.UINT32:\r\n      return new Uint32Array(rawLength);\r\n    case ECompareValueType.INT8:\r\n      return new Int8Array(rawLength);\r\n    case ECompareValueType.INT16:\r\n      return new Int16Array(rawLength);\r\n    case ECompareValueType.INT32:\r\n      return new Int32Array(rawLength);\r\n    case ECompareValueType.STRING:\r\n      return <string[]>[];\r\n    case ECompareValueType.FLOAT_ASC:\r\n    case ECompareValueType.FLOAT:\r\n      return new Float32Array(rawLength);\r\n    case ECompareValueType.DOUBLE_ASC:\r\n    case ECompareValueType.DOUBLE:\r\n      return new Float64Array(rawLength);\r\n  }\r\n}\r\n\r\nfunction createSetter(type: ECompareValueType, lookup: ILookUpArray, missingCount: number): ((index: number, v: ICompareValue) => void) {\r\n  switch (type) {\r\n    case ECompareValueType.BINARY: // just 0 or 1 -> convert to 0=-Ininity 1 2 255=+Infinity\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingBinary : (<number>v) + 1;\r\n    case ECompareValueType.COUNT: // uint32\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingCount : (<number>v) + 1;\r\n    case ECompareValueType.UINT8: // shift by one to have 0 for -Inf\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingInt8 : (<number>v) + 1;\r\n    case ECompareValueType.UINT16: // shift by one to have 0 for -Inf\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingInt16 : (<number>v) + 1;\r\n    case ECompareValueType.UINT32: // shift by one to have 0 for -Inf\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingInt32 : (<number>v) + 1;\r\n    case ECompareValueType.INT8:\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingInt8 : (<number>v);\r\n    case ECompareValueType.INT16:\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingInt16 : (<number>v);\r\n    case ECompareValueType.INT32:\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingInt32 : (<number>v);\r\n    case ECompareValueType.STRING:\r\n      return (index, v) => lookup[index] = v == null || v === '' ? missingString : v;\r\n    case ECompareValueType.FLOAT:\r\n    case ECompareValueType.DOUBLE:\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingFloat : v;\r\n    case ECompareValueType.FLOAT_ASC:\r\n    case ECompareValueType.DOUBLE_ASC:\r\n      return (index, v) => lookup[index] = v == null || isNaN(<number>v) ? missingFloatAsc : v;\r\n  }\r\n}\r\n\r\nexport class CompareLookup {\r\n  private readonly criteria: {col: Column, valueCache?(dataIndex: number): any}[] = [];\r\n  private readonly data: {asc: boolean, v: ECompareValueType, lookup: ILookUpArray, setter: (dataIndex: number, value: ICompareValue) => void}[] = [];\r\n\r\n  constructor(rawLength: number, isSorting: boolean, ranking: Ranking, valueCaches?: (col: Column) => (undefined | ((i: number) => any))) {\r\n    const missingCount = chooseMissingByLength(rawLength + 1); // + 1 for the value shift to have 0 as start\r\n\r\n    for (const c of (isSorting ? ranking.getSortCriteria() : ranking.getGroupSortCriteria())) {\r\n      const v = (isSorting ? c.col.toCompareValueType() : c.col.toCompareGroupValueType());\r\n      const valueCache = valueCaches ? valueCaches(c.col) : undefined;\r\n      this.criteria.push({col: c.col, valueCache});\r\n      if (!Array.isArray(v)) {\r\n        const lookup = toCompareLookUp(rawLength, v);\r\n        this.data.push({asc: c.asc, v, lookup, setter: createSetter(v, lookup, missingCount)});\r\n        continue;\r\n      }\r\n      for (const vi of v) {\r\n        const lookup = toCompareLookUp(rawLength, vi);\r\n        this.data.push({asc: c.asc, v: vi, lookup, setter: createSetter(vi, lookup, missingCount)});\r\n      }\r\n    }\r\n\r\n    if (isSorting) {\r\n      return;\r\n    }\r\n\r\n    {\r\n      const v = ECompareValueType.STRING;\r\n      const lookup = toCompareLookUp(rawLength, v);\r\n      this.data.push({asc: true, v, lookup, setter: createSetter(v, lookup, missingCount)});\r\n    }\r\n  }\r\n\r\n  get sortOrders() {\r\n    return this.data.map((d) => ({asc: d.asc, lookup: d.lookup}));\r\n  }\r\n\r\n  get transferAbles() {\r\n    // so a typed array\r\n    return this.data.map((d) => d.lookup).filter((d): d is UIntTypedArray | Float32Array => !Array.isArray(d)).map((d) => d.buffer);\r\n  }\r\n\r\n  push(row: IDataRow) {\r\n    let i = 0;\r\n    for (const c of this.criteria) {\r\n      const r = c.col.toCompareValue(row, c.valueCache ? c.valueCache(row.i) : undefined);\r\n      if (!Array.isArray(r)) {\r\n        this.data[i++].setter(row.i, r);\r\n        continue;\r\n      }\r\n      for (const ri of r) {\r\n        this.data[i++].setter(row.i, ri);\r\n      }\r\n    }\r\n  }\r\n\r\n  pushValues(dataIndex: number, vs: ICompareValue[]) {\r\n    for (let i = 0; i < vs.length; ++i) {\r\n      this.data[i].setter(dataIndex, vs[i]);\r\n    }\r\n  }\r\n\r\n  free() {\r\n    // free up to save memory\r\n    this.data.splice(0, this.data.length);\r\n  }\r\n}\r\n","import {IAbortAblePromise, ABORTED, IAbortAblePromiseBase} from 'lineupengine';\r\nexport {ABORTED} from 'lineupengine';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface IPoorManIdleDeadline {\r\n  didTimeout: boolean;\r\n  timeRemaining(): number;\r\n}\r\n\r\n/**\r\n * helper since not part of the typings\r\n * @internal\r\n */\r\nexport interface IPoorManIdleCallback {\r\n  requestIdleCallback(callback: (deadline: IPoorManIdleDeadline) => void, options?: {timeout: number}): number;\r\n\r\n  clearIdleCallback(callbackId: number): void;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ITask<T> {\r\n  /**\r\n   * external task id\r\n   */\r\n  id: string;\r\n  /**\r\n   * iterator for the incremental task, return null for another round\r\n   */\r\n  it: Iterator<T | PromiseLike<T> | null>;\r\n  /**\r\n   * function to the resolve the resulting promise\r\n   */\r\n  resolve(r: T | PromiseLike<T> | symbol): void;\r\n  /**\r\n   * the resulting promise\r\n   */\r\n  result: PromiseLike<T | symbol>;\r\n\r\n  /**\r\n   * aborts this task\r\n   */\r\n  abort: () => void;\r\n\r\n  isAborted: boolean;\r\n}\r\n\r\n/**\r\n * iterator result for another round\r\n * @internal\r\n */\r\nexport const ANOTHER_ROUND = {\r\n  value: null,\r\n  done: false\r\n};\r\n\r\n/**\r\n * iterator for just one entry\r\n * @internal\r\n */\r\nexport function oneShotIterator<T>(calc: () => T): Iterator<T> {\r\n  return {\r\n    next: () => ({done: true, value: calc()})\r\n  };\r\n}\r\n\r\n\r\nfunction thenFactory<T>(wrappee: PromiseLike<T>, abort: () => void, isAborted: () => boolean) {\r\n  function then<TResult1 = T | symbol, TResult2 = never>(onfulfilled?: ((value: T | symbol) => TResult1 | PromiseLike<TResult1>) | undefined | null, onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null): IAbortAblePromiseBase<TResult1 | TResult2> {\r\n    const r = wrappee.then(onfulfilled, onrejected);\r\n    return {\r\n      then: <any>thenFactory(r, abort, isAborted),\r\n      abort,\r\n      isAborted\r\n    };\r\n  }\r\n  return then;\r\n}\r\n\r\n/**\r\n * task scheduler for running tasks in idle callbacks\r\n * @internal\r\n */\r\nexport default class TaskScheduler {\r\n  private tasks: ITask<any>[] = [];\r\n  // idle callback id\r\n  private taskId: number = -1;\r\n\r\n  private runTasks = (deadline: IPoorManIdleDeadline) => {\r\n    // while more tasks and not timed out\r\n    while (this.tasks.length > 0 && (deadline.didTimeout || deadline.timeRemaining() > 0)) {\r\n      const task = this.tasks.shift()!;\r\n\r\n      let r = task.it.next();\r\n      // call next till done or ran out of time\r\n      while (!r.done && (deadline.didTimeout || deadline.timeRemaining() > 0)) {\r\n        r = task.it.next();\r\n      }\r\n\r\n      if (r.done) {\r\n        // resolve async\r\n        requestAnimationFrame(() => task.resolve(r.value));\r\n      } else {\r\n        // reschedule again\r\n        this.tasks.unshift(task);\r\n      }\r\n    }\r\n\r\n    this.taskId = -1;\r\n    this.reSchedule();\r\n  }\r\n\r\n  private reSchedule() {\r\n    if (this.tasks.length === 0 || this.taskId > -1) {\r\n      return;\r\n    }\r\n\r\n    const ww = (<IPoorManIdleCallback><any>self);\r\n    if (ww.requestIdleCallback) {\r\n      this.taskId = ww.requestIdleCallback(this.runTasks);\r\n    } else {\r\n      this.taskId = self.setTimeout(this.runTasks, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * pushes a task with multi hops using an iterator\r\n   * @param id task id\r\n   * @param it iterator to execute\r\n   */\r\n  pushMulti<T>(id: string, it: Iterator<T | PromiseLike<T> | null>, abortAble = true): IAbortAblePromise<T> {\r\n    // abort task with the same id\r\n    const abort = () => {\r\n      const index = this.tasks.findIndex((d) => d.id === id);\r\n      if (index < 0) {\r\n        return; // too late or none\r\n      }\r\n      const task = this.tasks[index];\r\n      this.tasks.splice(index, 1);\r\n\r\n      task.isAborted = true;\r\n      task.resolve(ABORTED);\r\n    };\r\n\r\n    {\r\n      // abort existing\r\n      const index = this.tasks.findIndex((d) => d.id === id);\r\n      if (index >= 0) {\r\n        const task = this.tasks[index];\r\n        task.abort();\r\n      }\r\n    }\r\n\r\n    let resolve: (value: T | symbol) => void;\r\n\r\n    const p = new Promise<T | symbol>((r) => {\r\n      // called during constructor\r\n      resolve = r;\r\n    });\r\n\r\n    const task: ITask<T> = {\r\n      id,\r\n      it,\r\n      result: p,\r\n      abort,\r\n      isAborted: false,\r\n      resolve: resolve!\r\n    };\r\n    const isAborted = () => task.isAborted;\r\n\r\n    this.tasks.push(task);\r\n\r\n    this.reSchedule();\r\n\r\n    const abortOrDummy = abortAble ? abort : () => undefined;\r\n    const isAbortedOrDummy = abortAble ? isAborted : () => false;\r\n\r\n    return {\r\n      then: thenFactory(p, abortOrDummy, isAbortedOrDummy),\r\n      abort: abortOrDummy,\r\n      isAborted: isAbortedOrDummy\r\n    };\r\n  }\r\n\r\n  /**\r\n   * pushes a simple task\r\n   * @param id task id\r\n   * @param calc task function\r\n   */\r\n  push<T>(id: string, calc: () => T | PromiseLike<T>): IAbortAblePromise<T> {\r\n    return this.pushMulti(id, oneShotIterator(calc));\r\n  }\r\n\r\n  /**\r\n   * abort a task with the given id\r\n   * @param id task id\r\n   */\r\n  abort(id: string) {\r\n    const index = this.tasks.findIndex((d) => d.id === id);\r\n    if (index < 0) {\r\n      return false; // too late or none\r\n    }\r\n    const task = this.tasks[index];\r\n    task.abort();\r\n    return true;\r\n  }\r\n\r\n  abortAll(filter: (task: ITask<any>) => boolean) {\r\n    const abort = this.tasks.filter(filter);\r\n    if (abort.length === 0) {\r\n      return;\r\n    }\r\n    this.tasks = this.tasks.filter((d) => !filter(d));\r\n    for (const task of abort) {\r\n      task.resolve(ABORTED);\r\n      task.abort();\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    if (this.taskId === -1) {\r\n      return;\r\n    }\r\n    const ww = (<IPoorManIdleCallback><any>self);\r\n    if (ww.requestIdleCallback) {\r\n      ww.clearIdleCallback(this.taskId);\r\n    } else {\r\n      self.clearTimeout(this.taskId);\r\n    }\r\n    this.taskId = -1;\r\n\r\n    this.tasks.splice(0, this.tasks.length).forEach((d) => {\r\n      d.resolve(ABORTED);\r\n      d.abort();\r\n    });\r\n  }\r\n}\r\n","import {abortAbleAll, IAbortAblePromise} from 'lineupengine';\r\nimport {ANOTHER_ROUND} from '../internal/scheduler';\r\nimport {IForEachAble, lazySeq, boxplotBuilder, categoricalStatsBuilder, categoricalValueCacheBuilder, dateStatsBuilder, dateValueCacheBuilder, IAdvancedBoxPlotData, ICategoricalStatistics, IDateStatistics, IStatistics, normalizedStatsBuilder, dateValueCache2Value, categoricalValueCache2Value, joinIndexArrays, IBuilder, ISequence} from '../internal';\r\nimport {CategoricalColumn, Column, ICompareValue, DateColumn, ICategoricalLikeColumn, IDataRow, IDateColumn, IGroup, ImpositionCompositeColumn, IndicesArray, INumberColumn, NumberColumn, OrdinalColumn, Ranking, UIntTypedArray, ICategory} from '../model';\r\nimport {IRenderTask, IRenderTasks} from '../renderer';\r\nimport {CompareLookup} from './sort';\r\n\r\n\r\n/**\r\n * a render task that is already resolved\r\n */\r\nexport class TaskNow<T> implements IRenderTask<T> {\r\n  constructor(public readonly v: T) {\r\n\r\n  }\r\n\r\n  then<U = void>(onfullfilled: (value: T) => U) {\r\n    return onfullfilled(this.v);\r\n  }\r\n}\r\n\r\n/**\r\n * factory function for\r\n */\r\nexport function taskNow<T>(v: T) {\r\n  return new TaskNow(v);\r\n}\r\n\r\n/**\r\n * a render task based on an abortable promise\r\n */\r\nexport class TaskLater<T> implements IRenderTask<T> {\r\n  constructor(public readonly v: IAbortAblePromise<T>) {\r\n\r\n  }\r\n\r\n  then<U = void>(onfullfilled: (value: T | symbol) => U): IAbortAblePromise<U> {\r\n    return this.v.then(onfullfilled);\r\n  }\r\n}\r\n\r\nexport function taskLater<T>(v: IAbortAblePromise<T>) {\r\n  return new TaskLater(v);\r\n}\r\n\r\n/**\r\n * similar to Promise.all\r\n */\r\nexport function tasksAll<T>(tasks: IRenderTask<T>[]): IRenderTask<T[]> {\r\n  if (tasks.every((t) => t instanceof TaskNow)) {\r\n    return taskNow(tasks.map((d) => (<TaskNow<T>>d).v));\r\n  }\r\n  return taskLater(abortAbleAll((<(TaskNow<T> | TaskLater<T>)[]>tasks).map((d) => d.v)));\r\n}\r\n\r\n\r\n\r\nexport interface IRenderTaskExectutor extends IRenderTasks {\r\n  setData(data: IDataRow[]): void;\r\n\r\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group'): void;\r\n  dirtyRanking(ranking: Ranking, type: 'data' | 'summary' | 'group'): void;\r\n\r\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray): IRenderTask<ICompareValue[]>;\r\n\r\n  preCompute(ranking: Ranking, groups: {rows: IndicesArray, group: IGroup}[], maxDataIndex: number): void;\r\n  preComputeCol(col: Column): void;\r\n  preComputeData(ranking: Ranking): void;\r\n  copyData2Summary(ranking: Ranking): void;\r\n  copyCache(col: Column, from: Column): void;\r\n\r\n  sort(ranking: Ranking, group: IGroup, indices: IndicesArray, singleCall: boolean, maxDataIndex: number, lookups?: CompareLookup): Promise<IndicesArray>;\r\n\r\n  terminate(): void;\r\n\r\n  valueCache(col: Column): undefined | ((dataIndex: number) => any);\r\n}\r\n\r\nexport class MultiIndices {\r\n  private _joined: IndicesArray | null = null;\r\n\r\n  constructor(public readonly indices: IndicesArray[], private readonly maxDataIndex: number) {\r\n\r\n  }\r\n\r\n  get joined() {\r\n    if (this.indices.length === 1) {\r\n      return this.indices[0];\r\n    }\r\n    if (this.indices.length === 0) {\r\n      return new Uint8Array(0);\r\n    }\r\n    if (this._joined) {\r\n      return this._joined;\r\n    }\r\n    return this._joined = joinIndexArrays(this.indices, this.maxDataIndex);\r\n  }\r\n}\r\n\r\n/**\r\n * number of data points to build per iteration / chunk\r\n */\r\nconst CHUNK_SIZE = 100;\r\n\r\n\r\nexport class ARenderTasks {\r\n  protected readonly valueCacheData = new Map<string, Float32Array | UIntTypedArray | Int32Array | Float64Array>();\r\n\r\n  protected readonly byIndex = (i: number) => this.data[i];\r\n\r\n  constructor(protected data: IDataRow[] = []) {\r\n\r\n  }\r\n\r\n\r\n  protected byOrder(indices: IndicesArray): ISequence<IDataRow> {\r\n    return lazySeq(indices).map(this.byIndex);\r\n  }\r\n\r\n  protected byOrderAcc<T>(indices: IndicesArray, acc: (row: IDataRow) => T) {\r\n    return lazySeq(indices).map((i) => acc(this.data[i]));\r\n  }\r\n\r\n  /**\r\n   * builder factory to create an iterator that can be used to schedule\r\n   * @param builder the builder to use\r\n   * @param order the order to iterate over\r\n   * @param acc the accessor to get the value out of the data\r\n   * @param build optional build mapper\r\n   */\r\n  private builder<T, BR, B extends {push: (v: T) => void, build: () => BR}, R = BR>(builder: B, order: IndicesArray | null | MultiIndices, acc: (dataIndex: number) => T, build?: (r: BR) => R): Iterator<R | null> {\r\n    let i = 0;\r\n\r\n    // no indices given over the whole data\r\n    const nextData = (currentChunkSize: number = CHUNK_SIZE) => {\r\n      let chunkCounter = currentChunkSize;\r\n      const data = this.data;\r\n      for (; i < data.length && chunkCounter > 0; ++i, --chunkCounter) {\r\n        builder.push(acc(i));\r\n      }\r\n      if (i < data.length) { // need another round\r\n        return ANOTHER_ROUND;\r\n      }\r\n      // done\r\n      return {\r\n        done: true,\r\n        value: build ? build(builder.build()) : <R><any>builder.build()\r\n      };\r\n    };\r\n\r\n    let o = 0;\r\n    const orders = order instanceof MultiIndices ? order.indices : [order];\r\n\r\n    const nextOrder = (currentChunkSize: number = CHUNK_SIZE) => {\r\n      let chunkCounter = currentChunkSize;\r\n\r\n      while (o < orders.length) {\r\n        const actOrder = orders[o]!;\r\n        for (; i < actOrder.length && chunkCounter > 0; ++i, --chunkCounter) {\r\n          builder.push(acc(actOrder[i]));\r\n        }\r\n        if (i < actOrder.length) { // need another round\r\n          return ANOTHER_ROUND;\r\n        }\r\n        // done with this order\r\n        o++;\r\n        i = 0;\r\n      }\r\n      return {\r\n        done: true,\r\n        value: build ? build(builder.build()) : <R><any>builder.build()\r\n      };\r\n    };\r\n    return {next: order == null ? nextData : nextOrder};\r\n  }\r\n\r\n  private builderForEach<T, BR, B extends {pushAll: (v: IForEachAble<T>) => void, build: () => BR}, R = BR>(builder: B, order: IndicesArray | null | MultiIndices, acc: (dataIndex: number) => IForEachAble<T>, build?: (r: BR) => R): Iterator<R | null> {\r\n    return this.builder({\r\n      push: builder.pushAll,\r\n      build: builder.build\r\n    }, order, acc, build);\r\n  }\r\n\r\n  protected boxplotBuilder<R = IAdvancedBoxPlotData>(order: IndicesArray | null | MultiIndices, col: INumberColumn, raw?: boolean, build?: (stat: IAdvancedBoxPlotData) => R) {\r\n    const b = boxplotBuilder();\r\n    return this.numberStatsBuilder(b, order, col, raw, build);\r\n  }\r\n\r\n  protected normalizedStatsBuilder<R = IStatistics>(order: IndicesArray | null | MultiIndices, col: INumberColumn, numberOfBins: number, raw?: boolean, build?: (stat: IStatistics) => R) {\r\n    const b = normalizedStatsBuilder(numberOfBins);\r\n    return this.numberStatsBuilder(b, order, col, raw, build);\r\n  }\r\n\r\n  private numberStatsBuilder<R, B extends IBuilder<number, BR>, BR>(b: B, order: IndicesArray | null | MultiIndices, col: INumberColumn, raw?: boolean, build?: (stat: BR) => R) {\r\n    if (col instanceof NumberColumn || col instanceof OrdinalColumn || col instanceof ImpositionCompositeColumn) {\r\n      const key = raw ? `${col.id}:r` : col.id;\r\n      const dacc: (i: number) => number = raw ? (i) => col.getRawNumber(this.data[i]) : (i) => col.getNumber(this.data[i]);\r\n\r\n      if (order == null && !this.valueCacheData.has(key)) {\r\n        // build and valueCache\r\n        const vs = new Float32Array(this.data.length);\r\n        let i = 0;\r\n        return this.builder({\r\n          push: (v) => {\r\n            b.push(v);\r\n            vs[i++] = v;\r\n          },\r\n          build: () => {\r\n            this.setValueCacheData(key, vs);\r\n            return b.build();\r\n          }\r\n        }, null, dacc, build);\r\n      }\r\n\r\n      const cache = this.valueCacheData.get(key);\r\n      const acc: (i: number) => number = cache ? (i) => cache[i] : dacc;\r\n      return this.builder(b, order, acc, build);\r\n    }\r\n    const acc: (i: number) => IForEachAble<number> = raw ? (i) => col.iterRawNumber(this.data[i]) : (i) => col.iterNumber(this.data[i]);\r\n    return this.builderForEach(b, order, acc, build);\r\n  }\r\n\r\n  protected dateStatsBuilder<R = IDateStatistics>(order: IndicesArray | null | MultiIndices, col: IDateColumn, template?: IDateStatistics, build?: (stat: IDateStatistics) => R) {\r\n    const b = dateStatsBuilder(template);\r\n    if (col instanceof DateColumn) {\r\n      if (order == null) {\r\n        // build and valueCache\r\n        const vs = dateValueCacheBuilder(this.data.length);\r\n        return this.builder({\r\n          push: (v) => {\r\n            b.push(v);\r\n            vs.push(v);\r\n          },\r\n          build: () => {\r\n            this.setValueCacheData(col.id, vs.cache);\r\n            return b.build();\r\n          }\r\n        }, null, (i: number) => col.getDate(this.data[i]), build);\r\n      }\r\n      const cache = this.valueCacheData.get(col.id);\r\n      const acc: (i: number) => Date | null = cache ? (i) => dateValueCache2Value(cache[i]) : (i) => col.getDate(this.data[i]);\r\n      return this.builder(b, order, acc, build);\r\n    }\r\n    return this.builderForEach(b, order, (i: number) => col.iterDate(this.data[i]), build);\r\n  }\r\n\r\n  protected categoricalStatsBuilder<R = ICategoricalStatistics>(order: IndicesArray | null | MultiIndices, col: ICategoricalLikeColumn, build?: (stat: ICategoricalStatistics) => R) {\r\n    const b = categoricalStatsBuilder(col.categories);\r\n    if (col instanceof CategoricalColumn || col instanceof OrdinalColumn) {\r\n      if (order == null) {\r\n        // build and valueCache\r\n        const vs = categoricalValueCacheBuilder(this.data.length, col.categories);\r\n        return this.builder({\r\n          push: (v) => {\r\n            b.push(v);\r\n            vs.push(v);\r\n          },\r\n          build: () => {\r\n            this.setValueCacheData(col.id, vs.cache);\r\n            return b.build();\r\n          }\r\n        }, null, (i: number) => col.getCategory(this.data[i]), build);\r\n      }\r\n      const cache = this.valueCacheData.get(col.id);\r\n      const acc: (i: number) => ICategory | null = cache ? (i) => categoricalValueCache2Value(cache[i], col.categories) : (i) => col.getCategory(this.data[i]);\r\n      return this.builder(b, order, acc, build);\r\n    }\r\n    return this.builderForEach(b, order, (i: number) => col.iterCategory(this.data[i]), build);\r\n  }\r\n\r\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group') {\r\n    if (type !== 'data') {\r\n      return;\r\n    }\r\n    this.valueCacheData.delete(col.id);\r\n    this.valueCacheData.delete(`${col.id}:r`);\r\n  }\r\n\r\n  protected setValueCacheData(key: string, value: Float32Array | UIntTypedArray | Int32Array | Float64Array | null) {\r\n    if (value == null) {\r\n      this.valueCacheData.delete(key);\r\n    } else {\r\n      this.valueCacheData.set(key, value);\r\n    }\r\n  }\r\n\r\n  valueCache(col: Column) {\r\n    const v = this.valueCacheData.get(col.id);\r\n    if (!v) {\r\n      return undefined;\r\n    }\r\n    if (col instanceof DateColumn) {\r\n      return (dataIndex: number) => dateValueCache2Value(v[dataIndex]);\r\n    }\r\n    if (col instanceof CategoricalColumn || col instanceof OrdinalColumn) {\r\n      return (dataIndex: number) => categoricalValueCache2Value(v[dataIndex], col.categories);\r\n    }\r\n    return (dataIndex: number) => v[dataIndex];\r\n  }\r\n}\r\n","import Column, {IDataRow, Ranking, IndicesArray, IGroup, IOrderedGroup, INumberColumn, IDateColumn, ICategoricalLikeColumn, ICompareValue} from '../model';\r\nimport {ARenderTasks, IRenderTaskExectutor, taskNow} from './tasks';\r\nimport {ISequence, toIndexArray, sortComplex, getNumberOfBins} from '../internal';\r\nimport {CompareLookup} from './sort';\r\nimport {IRenderTask} from '..';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function sortDirect(indices: IndicesArray, maxDataIndex: number, lookups?: CompareLookup) {\r\n  const order = toIndexArray(indices, maxDataIndex);\r\n  if (lookups) {\r\n    sortComplex(order, lookups.sortOrders);\r\n  }\r\n  return order;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class DirectRenderTasks extends ARenderTasks implements IRenderTaskExectutor {\r\n\r\n  protected readonly cache = new Map<string, any>();\r\n\r\n  setData(data: IDataRow[]) {\r\n    this.data = data;\r\n    this.cache.clear();\r\n    this.valueCacheData.clear();\r\n  }\r\n\r\n\r\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group') {\r\n    super.dirtyColumn(col, type);\r\n\r\n    if (type === 'group') {\r\n      return; // not cached\r\n    }\r\n    this.cache.delete(`${col.id}:summary`);\r\n    this.cache.delete(`${col.id}:summary:raw`);\r\n    this.cache.delete(`${col.id}:summary:b`);\r\n    this.cache.delete(`${col.id}:summary:braw`);\r\n\r\n    if (type === 'summary') {\r\n      return;\r\n    }\r\n    this.cache.delete(`${col.id}:data`);\r\n    this.cache.delete(`${col.id}:data:raw`);\r\n    this.cache.delete(`${col.id}:data:b`);\r\n    this.cache.delete(`${col.id}:data:braw`);\r\n  }\r\n\r\n  dirtyRanking(ranking: Ranking, type: 'data' | 'summary' | 'group') {\r\n    for (const col of ranking.flatColumns) {\r\n      this.dirtyColumn(col, type);\r\n    }\r\n  }\r\n\r\n  preCompute() {\r\n    // dummy\r\n  }\r\n\r\n  preComputeData() {\r\n    // dummy\r\n  }\r\n\r\n  preComputeCol() {\r\n    // dummy\r\n  }\r\n\r\n  copyData2Summary() {\r\n    // dummy\r\n  }\r\n\r\n  copyCache(col: Column, from: Column) {\r\n    const fromPrefix = `${from.id}:`;\r\n\r\n    for (const key of Array.from(this.cache.keys()).sort()) {\r\n      if (!key.startsWith(fromPrefix)) {\r\n        continue;\r\n      }\r\n      const tkey = `${col.id}:${key.slice(fromPrefix.length)}`;\r\n      this.cache.set(tkey, this.cache.get(key)!);\r\n    }\r\n  }\r\n\r\n  sort(_ranking: Ranking, _group: IGroup, indices: IndicesArray, _singleCall: boolean, maxDataIndex: number, lookups?: CompareLookup) {\r\n    return Promise.resolve(sortDirect(indices, maxDataIndex, lookups));\r\n  }\r\n\r\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray): IRenderTask<ICompareValue[]> {\r\n    const rg = ranking.getGroupSortCriteria();\r\n    if (rg.length === 0) {\r\n      return taskNow([group.name.toLowerCase()]);\r\n    }\r\n    const o = this.byOrder(rows);\r\n    const vs: ICompareValue[] = [];\r\n    for (const s of rg) {\r\n      const r = s.col.toCompareGroupValue(o, group);\r\n      if (Array.isArray(r)) {\r\n        vs.push(...r);\r\n      } else {\r\n        vs.push(r);\r\n      }\r\n    }\r\n    vs.push(group.name.toLowerCase());\r\n    return taskNow(vs);\r\n  }\r\n\r\n  groupRows<T>(_col: Column, group: IOrderedGroup, _key: string, compute: (rows: ISequence<IDataRow>) => T): IRenderTask<T> {\r\n    return taskNow(compute(this.byOrder(group.order)));\r\n  }\r\n\r\n  groupExampleRows<T>(_col: Column, group: IOrderedGroup, _key: string, compute: (rows: ISequence<IDataRow>) => T): IRenderTask<T> {\r\n    return taskNow(compute(this.byOrder(group.order.slice(0, 5))));\r\n  }\r\n\r\n  groupBoxPlotStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\r\n    const {summary, data} = this.summaryBoxPlotStatsD(col, raw);\r\n    return taskNow({group: this.boxplotBuilder(group.order, col, raw).next(Infinity).value!, summary, data});\r\n  }\r\n\r\n  groupNumberStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\r\n    const {summary, data} = this.summaryNumberStatsD(col, raw);\r\n    return taskNow({group: this.normalizedStatsBuilder(group.order, col, summary.hist.length, raw).next(Infinity).value!, summary, data});\r\n  }\r\n\r\n  groupCategoricalStats(col: Column & ICategoricalLikeColumn, group: IOrderedGroup) {\r\n    const {summary, data} = this.summaryCategoricalStatsD(col);\r\n    return taskNow({group: this.categoricalStatsBuilder(group.order, col).next(Infinity).value!, summary, data});\r\n  }\r\n\r\n  groupDateStats(col: Column & IDateColumn, group: IOrderedGroup) {\r\n    const {summary, data} = this.summaryDateStatsD(col);\r\n    return taskNow({group: this.dateStatsBuilder(group.order, col, summary).next(Infinity).value!, summary, data});\r\n  }\r\n\r\n  summaryBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\r\n    return taskNow(this.summaryBoxPlotStatsD(col, raw));\r\n  }\r\n\r\n  summaryNumberStats(col: Column & INumberColumn, raw?: boolean) {\r\n    return taskNow(this.summaryNumberStatsD(col, raw));\r\n  }\r\n\r\n  summaryCategoricalStats(col: Column & ICategoricalLikeColumn) {\r\n    return taskNow(this.summaryCategoricalStatsD(col));\r\n  }\r\n\r\n  summaryDateStats(col: Column & IDateColumn) {\r\n    return taskNow(this.summaryDateStatsD(col));\r\n  }\r\n\r\n  private summaryNumberStatsD(col: Column & INumberColumn, raw?: boolean) {\r\n    return this.cached('summary', col, () => {\r\n      const ranking = col.findMyRanker()!.getOrder();\r\n      const data = this.dataNumberStats(col, raw);\r\n      return {summary: this.normalizedStatsBuilder(ranking, col, data.hist.length, raw).next(Infinity).value!, data};\r\n    }, raw ? ':raw' : '', col.findMyRanker()!.getOrderLength() === 0);\r\n  }\r\n\r\n  private summaryBoxPlotStatsD(col: Column & INumberColumn, raw?: boolean) {\r\n    return this.cached('summary', col, () => {\r\n      const ranking = col.findMyRanker()!.getOrder();\r\n      const data = this.dataBoxPlotStats(col, raw);\r\n      return {summary: this.boxplotBuilder(ranking, col, raw).next(Infinity).value!, data};\r\n    }, raw ? ':braw' : ':b' , col.findMyRanker()!.getOrderLength() === 0);\r\n  }\r\n\r\n  private summaryCategoricalStatsD(col: Column & ICategoricalLikeColumn) {\r\n    return this.cached('summary', col, () => {\r\n      const ranking = col.findMyRanker()!.getOrder();\r\n      const data = this.dataCategoricalStats(col);\r\n      return {summary: this.categoricalStatsBuilder(ranking, col).next(Infinity).value!, data};\r\n    }, '', col.findMyRanker()!.getOrderLength() === 0);\r\n  }\r\n\r\n  private summaryDateStatsD(col: Column & IDateColumn) {\r\n    return this.cached('summary', col, () => {\r\n      const ranking = col.findMyRanker()!.getOrder();\r\n      const data = this.dataDateStats(col);\r\n      return {summary: this.dateStatsBuilder(ranking, col, data).next(Infinity).value!, data};\r\n    }, '', col.findMyRanker()!.getOrderLength() === 0);\r\n  }\r\n\r\n  private cached<T>(prefix: string, col: Column, creator: () => T, suffix: string = '', dontCache = false): T {\r\n    const key = `${col.id}:${prefix}${suffix}`;\r\n    if (this.cache.has(key)) {\r\n      return this.cache.get(key)!;\r\n    }\r\n    const s = creator();\r\n    if (!dontCache) {\r\n      this.cache.set(key, s);\r\n    }\r\n    return s;\r\n  }\r\n\r\n  dataBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\r\n    return this.cached('data', col, () => this.boxplotBuilder(null, col, raw).next(Infinity).value!, raw ? ':braw' : ':b');\r\n  }\r\n\r\n  dataNumberStats(col: Column & INumberColumn, raw?: boolean) {\r\n    return this.cached('data', col, () => this.normalizedStatsBuilder(null, col, getNumberOfBins(this.data.length), raw).next(Infinity).value!, raw ? ':raw' : '');\r\n  }\r\n\r\n  dataCategoricalStats(col: Column & ICategoricalLikeColumn) {\r\n    return this.cached('data', col, () => this.categoricalStatsBuilder(null, col).next(Infinity).value!);\r\n  }\r\n\r\n  dataDateStats(col: Column & IDateColumn) {\r\n    return this.cached('data', col, () => this.dateStatsBuilder(null, col).next(Infinity).value!);\r\n  }\r\n\r\n  terminate() {\r\n    this.cache.clear();\r\n  }\r\n}\r\n\r\n\r\n","import Column from './Column';\r\nimport {IDataRow, IColumnDesc} from './interfaces';\r\n\r\n\r\nexport interface IArrayDesc {\r\n  dataLength?: number;\r\n  labels?: string[];\r\n}\r\n\r\nexport interface IKeyValue<T> {\r\n  key: string;\r\n  value: T;\r\n}\r\n\r\nexport interface IMapColumn<T> extends Column {\r\n  getMap(row: IDataRow): IKeyValue<T>[];\r\n\r\n  getMapLabel(row: IDataRow): IKeyValue<string>[];\r\n}\r\n\r\nexport function isMapColumn(col: Column): col is IMapColumn<any>;\r\nexport function isMapColumn(col: IColumnDesc): boolean;\r\nexport function isMapColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<IMapColumn<any>>col).getMap === 'function' && typeof (<IMapColumn<any>>col).getMapLabel === 'function') || (!(col instanceof Column) && (<IColumnDesc>col).type.endsWith('Map'));\r\n}\r\n\r\nexport interface IArrayColumn<T> extends IMapColumn<T> {\r\n  readonly labels: string[];\r\n  readonly dataLength: number | null;\r\n\r\n  getLabels(row: IDataRow): string[];\r\n\r\n  getValues(row: IDataRow): T[];\r\n}\r\n\r\nexport function isArrayColumn(col: Column): col is IArrayColumn<any>;\r\nexport function isArrayColumn(col: IColumnDesc): col is IArrayDesc & IColumnDesc;\r\nexport function isArrayColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<IArrayColumn<any>>col).getLabels === 'function' && typeof (<IArrayColumn<any>>col).getValues === 'function' && isMapColumn(col) || (!(col instanceof Column) && (<IColumnDesc>col).type.endsWith('s') && (<IColumnDesc>col).type !== 'actions'));\r\n}\r\n","import {IForEachAble} from '../internal';\r\nimport Column from './Column';\r\nimport {IArrayColumn, isArrayColumn} from './IArrayColumn';\r\nimport {IValueColumnDesc, IColumnDesc, IDataRow, ITypedDump} from './interfaces';\r\n\r\nexport interface ICategoricalDesc {\r\n  categories: (string | Partial<ICategory>)[];\r\n}\r\n\r\nexport declare type ICategoricalColumnDesc = IValueColumnDesc<string> & ICategoricalDesc;\r\n\r\nexport interface ICategoricalColorMappingFunction {\r\n  apply(v: ICategory): string;\r\n\r\n  toJSON(): ITypedDump | null;\r\n\r\n  clone(): ICategoricalColorMappingFunction;\r\n\r\n  eq(other: ICategoricalColorMappingFunction): boolean;\r\n}\r\n\r\nexport interface ICategoricalColorMappingFunctionConstructor {\r\n  new(dump: ITypedDump): ICategoricalColorMappingFunction;\r\n}\r\n\r\nexport interface ICategoricalLikeColumn extends Column {\r\n  readonly categories: ICategory[];\r\n\r\n  getColorMapping(): ICategoricalColorMappingFunction;\r\n  setColorMapping(mapping: ICategoricalColorMappingFunction): void;\r\n\r\n  iterCategory(row: IDataRow): IForEachAble<ICategory | null>;\r\n\r\n  getCategories(row: IDataRow): (ICategory | null)[];\r\n}\r\n\r\nexport function isCategoricalLikeColumn(col: Column): col is ICategoricalLikeColumn {\r\n  return typeof (<ICategoricalLikeColumn>col).categories !== 'undefined' && typeof (<ICategoricalLikeColumn>col).iterCategory === 'function';\r\n}\r\n\r\nexport interface ISetColumn extends IArrayColumn<boolean>, ICategoricalLikeColumn {\r\n  getSet(row: IDataRow): Set<ICategory>;\r\n}\r\n\r\nexport function isSetColumn(col: Column): col is ISetColumn {\r\n  return isCategoricalLikeColumn(col) && typeof (<ISetColumn>col).getSet === 'function';\r\n}\r\n\r\nexport interface ICategoricalColumn extends ISetColumn {\r\n  getCategory(row: IDataRow): ICategory | null;\r\n}\r\n\r\nexport interface ICategory {\r\n  readonly name: string;\r\n\r\n  /**\r\n   * optional label of this category (the one to render)\r\n   */\r\n  readonly label: string;\r\n  /**\r\n   * category color\r\n   * @default next in d3 color 10 range\r\n   */\r\n  readonly color: string;\r\n\r\n  value: number;\r\n}\r\n/**\r\n * checks whether the given column or description is a categorical column, i.e. the value is a list of categories\r\n * @param col\r\n * @returns {boolean}\r\n */\r\nexport function isCategoricalColumn(col: Column): col is ICategoricalColumn;\r\nexport function isCategoricalColumn(col: IColumnDesc): col is ICategoricalColumnDesc & IColumnDesc;\r\nexport function isCategoricalColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<ICategoricalColumn>col).getCategory === 'function' || (!(col instanceof Column) && (<IColumnDesc>col).type.match(/(categorical|ordinal|hierarchy)/) != null));\r\n}\r\n\r\nexport declare type ICategoricalsColumn = ICategoricalLikeColumn & IArrayColumn<string | null>;\r\n\r\nexport function isCategoricalsColumn(col: Column): col is ICategoricalsColumn {\r\n  return isCategoricalLikeColumn(col) && isArrayColumn(col) && !isSetColumn(col);\r\n}\r\n\r\n\r\nexport interface ICategoricalFilter {\r\n  filter: string[] | string | RegExp;\r\n  filterMissing: boolean;\r\n}\r\n\r\nexport interface ISetCategoricalFilter extends ICategoricalFilter {\r\n  mode?: 'every' | 'some';\r\n}\r\n\r\nexport function isCategory(v: any): v is ICategory {\r\n  return typeof v.name === 'string' && typeof v.label === 'string' && typeof v.color === 'string' && typeof v.value === 'number';\r\n}\r\n","import {IForEachAble} from '../internal';\r\nimport Column from './Column';\r\nimport {IColumnDesc, IDataRow} from './interfaces';\r\nimport {INumberFilter} from './INumberColumn';\r\nimport {IArrayColumn} from './IArrayColumn';\r\n\r\nexport interface IDateColumn extends Column {\r\n  getFormatter(): (v: Date | null) => string;\r\n\r\n  getDate(row: IDataRow): Date | null;\r\n\r\n  iterDate(row: IDataRow): IForEachAble<Date | null>;\r\n\r\n  getFilter(): IDateFilter;\r\n  setFilter(value: IDateFilter | null): void;\r\n}\r\n\r\nexport interface IDatesColumn extends IDateColumn, IArrayColumn<Date | null> {\r\n  getDates(row: IDataRow): (Date | null)[];\r\n}\r\n\r\nexport interface IDateDesc {\r\n  /**\r\n   * d3 formatting option\r\n   * @default %x\r\n   */\r\n  dateFormat?: string;\r\n\r\n  /**\r\n   * d3 formation option\r\n   * @dfeault dateFormat\r\n   */\r\n  dateParse?: string;\r\n}\r\n\r\n\r\n/**\r\n * checks whether the given column or description is a date column, i.e. the value is a date\r\n * @param col\r\n * @returns {boolean}\r\n */\r\nexport function isDateColumn(col: Column): col is IDateColumn;\r\nexport function isDateColumn(col: IColumnDesc): col is IDateDesc & IColumnDesc;\r\nexport function isDateColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<IDateColumn>col).getDate === 'function' || (!(col instanceof Column) && (<IColumnDesc>col).type.startsWith('date')));\r\n}\r\n\r\nexport function isDatesColumn(col: Column): col is IDatesColumn {\r\n  return typeof (<IDatesColumn>col).getDates === 'function';\r\n}\r\n\r\nexport declare type IDateFilter = INumberFilter;\r\n\r\nexport declare type IDateGranularity = 'century' | 'decade' | 'year' | 'month' | 'week' | 'day_of_week' | 'day_of_month' | 'day_of_year' | 'hour' | 'minute' | 'second';\r\n\r\nexport interface IDateGrouper {\r\n  /**\r\n   * granuality level for the grouping\r\n   */\r\n  granularity: IDateGranularity;\r\n  /**\r\n   * whether circular occurrences should be in the same bin\r\n   * e.g. granularity = month\r\n   * circular: 01.2018 == 01.2017\r\n   * not circular: 01.2018 != 01.2017\r\n   */\r\n  circular: boolean;\r\n}\r\n","import {abortAble} from 'lineupengine';\r\nimport {getNumberOfBins, IAdvancedBoxPlotData, ICategoricalStatistics, IDateStatistics, ISequence, ISortMessageResponse, IStatistics, lazySeq, toIndexArray, WorkerTaskScheduler, createWorkerBlob} from '../internal';\r\nimport TaskScheduler, {ABORTED, oneShotIterator} from '../internal/scheduler';\r\nimport Column, {ICategoricalLikeColumn, ICompareValue, IDataRow, IDateColumn, IGroup, IndicesArray, INumberColumn, IOrderedGroup, isCategoricalLikeColumn, isDateColumn, isNumberColumn, Ranking, UIntTypedArray} from '../model';\r\nimport {IRenderTask} from '../renderer';\r\nimport {sortDirect} from './DirectRenderTasks';\r\nimport {CompareLookup} from './sort';\r\nimport {ARenderTasks, IRenderTaskExectutor, MultiIndices, taskLater, TaskLater, taskNow, TaskNow} from './tasks';\r\n\r\nexport class ScheduleRenderTasks extends ARenderTasks implements IRenderTaskExectutor {\r\n\r\n  private readonly cache = new Map<string, IRenderTask<any>>();\r\n  private readonly tasks = new TaskScheduler();\r\n  private readonly workers = new WorkerTaskScheduler(createWorkerBlob());\r\n\r\n  setData(data: IDataRow[]) {\r\n    this.data = data;\r\n    this.cache.clear();\r\n    this.tasks.clear();\r\n    this.valueCacheData.clear();\r\n    this.workers.deleteRefs();\r\n  }\r\n\r\n  dirtyColumn(col: Column, type: 'data' | 'group' | 'summary') {\r\n    super.dirtyColumn(col, type);\r\n    // order designed such that first groups, then summaries, then data is deleted\r\n\r\n    for (const key of Array.from(this.cache.keys()).sort()) {\r\n      // data = all\r\n      // summary = summary + group\r\n      // group = group only\r\n      if ((type === 'data' && key.startsWith(`${col.id}:`) ||\r\n        (type === 'summary' && key.startsWith(`${col.id}:b:summary:`)) ||\r\n        (key.startsWith(`${col.id}:a:group`)))) {\r\n        this.cache.delete(key);\r\n        this.tasks.abort(key);\r\n      }\r\n    }\r\n\r\n    if (type !== 'data') {\r\n      return;\r\n    }\r\n\r\n    this.valueCacheData.delete(col.id);\r\n    this.workers.deleteRef(col.id);\r\n  }\r\n\r\n  dirtyRanking(ranking: Ranking, type: 'data' | 'group' | 'summary') {\r\n    const cols = ranking.flatColumns;\r\n\r\n    let checker: ((key: string) => boolean)[];\r\n    switch (type) {\r\n      case 'group':\r\n        checker = cols.map((col) => (key: string) => key.startsWith(`${col.id}:a:group`));\r\n        break;\r\n      case 'summary':\r\n        checker = cols.map((col) => (key: string) => key.startsWith(`${col.id}:b:summary`) || key.startsWith(`${col.id}:a:group`));\r\n        break;\r\n      case 'data':\r\n      default:\r\n        checker = cols.map((col) => (key: string) => key.startsWith(`${col.id}:`));\r\n        break;\r\n    }\r\n    for (const key of Array.from(this.cache.keys()).sort()) {\r\n      if (checker.some((f) => f(key))) {\r\n        this.cache.delete(key);\r\n        this.tasks.abort(key);\r\n      }\r\n    }\r\n    // group compare tasks\r\n    this.tasks.abortAll((t) => t.id.startsWith(`r${ranking.id}:`));\r\n\r\n    // delete remote caches\r\n    this.workers.deleteRef(ranking.id, true);\r\n\r\n    if (type !== 'data') {\r\n      return;\r\n    }\r\n\r\n    for (const col of cols) {\r\n      super.dirtyColumn(col, type);\r\n      this.workers.deleteRef(col.id);\r\n    }\r\n  }\r\n\r\n  preCompute(ranking: Ranking, groups: {rows: IndicesArray, group: IGroup}[], maxDataIndex: number) {\r\n    if (groups.length === 0) {\r\n      return;\r\n    }\r\n    const cols = ranking.flatColumns;\r\n    if (groups.length === 1) {\r\n      const {group, rows} = groups[0];\r\n      const multi = new MultiIndices([rows], maxDataIndex);\r\n      for (const col of cols) {\r\n        if (isCategoricalLikeColumn(col)) {\r\n          this.summaryCategoricalStats(col, multi);\r\n        } else if (isNumberColumn(col)) {\r\n          this.summaryNumberStats(col, false, multi);\r\n          this.summaryNumberStats(col, true, multi);\r\n        } else if (isDateColumn(col)) {\r\n          this.summaryDateStats(col, multi);\r\n        } else {\r\n          continue;\r\n        }\r\n        // copy from summary to group and create proper structure\r\n        this.chainCopy(`${col.id}:a:group:${group.name}`, this.cache.get(`${col.id}:b:summary`)!, (v: {summary: any, data: any}) => ({group: v.summary, summary: v.summary, data: v.data}));\r\n        if (isNumberColumn(col)) {\r\n          this.chainCopy(`${col.id}:a:group:${group.name}:raw`, this.cache.get(`${col.id}:b:summary:raw`)!, (v: {summary: any, data: any}) => ({group: v.summary, summary: v.summary, data: v.data}));\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    const ogroups = groups.map(({rows, group}) => Object.assign({order: rows}, group));\r\n    const full = new MultiIndices(groups.map((d) => d.rows), maxDataIndex);\r\n    for (const col of cols) {\r\n      if (isCategoricalLikeColumn(col)) {\r\n        this.summaryCategoricalStats(col, full);\r\n        for (const g of ogroups) {\r\n          this.groupCategoricalStats(col, g);\r\n        }\r\n      } else if (isDateColumn(col)) {\r\n        this.summaryDateStats(col, full);\r\n        for (const g of ogroups) {\r\n          this.groupDateStats(col, g);\r\n        }\r\n      } else if (isNumberColumn(col)) {\r\n        this.summaryNumberStats(col, false, full);\r\n        this.summaryNumberStats(col, true, full);\r\n        for (const g of ogroups) {\r\n          this.groupNumberStats(col, g, false);\r\n          this.groupNumberStats(col, g, true);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  preComputeData(ranking: Ranking) {\r\n    for (const col of ranking.flatColumns) {\r\n      if (isCategoricalLikeColumn(col)) {\r\n        this.dataCategoricalStats(col);\r\n      } else if (isNumberColumn(col)) {\r\n        this.dataNumberStats(col, false);\r\n        this.dataNumberStats(col, true);\r\n      } else if (isDateColumn(col)) {\r\n        this.dataDateStats(col);\r\n      }\r\n    }\r\n  }\r\n\r\n  preComputeCol(col: Column) {\r\n    const ranking = col.findMyRanker();\r\n\r\n    if (isCategoricalLikeColumn(col)) {\r\n      this.dataCategoricalStats(col);\r\n      if (!ranking) {\r\n        return;\r\n      }\r\n      this.summaryCategoricalStats(col);\r\n      for (const group of ranking.getGroups()) {\r\n        this.groupCategoricalStats(col, group);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (isNumberColumn(col)) {\r\n      this.dataNumberStats(col, false);\r\n      this.dataNumberStats(col, true);\r\n\r\n      if (!ranking) {\r\n        return;\r\n      }\r\n      this.summaryNumberStats(col, false);\r\n      this.summaryNumberStats(col, true);\r\n      for (const group of ranking.getGroups()) {\r\n        this.groupNumberStats(col, group, false);\r\n        this.groupNumberStats(col, group, true);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (!isDateColumn(col)) {\r\n      return;\r\n    }\r\n\r\n    this.dataDateStats(col);\r\n\r\n    if (!ranking) {\r\n      return;\r\n    }\r\n    this.summaryDateStats(col);\r\n    for (const group of ranking.getGroups()) {\r\n      this.groupDateStats(col, group);\r\n    }\r\n  }\r\n\r\n  copyData2Summary(ranking: Ranking) {\r\n    for (const col of ranking.flatColumns) {\r\n      if (isCategoricalLikeColumn(col)) {\r\n        this.dataCategoricalStats(col);\r\n      } else if (isNumberColumn(col)) {\r\n        this.dataNumberStats(col, false);\r\n        this.dataNumberStats(col, true);\r\n      } else if (isDateColumn(col)) {\r\n        this.dataDateStats(col);\r\n      } else {\r\n        continue;\r\n      }\r\n      // copy from data to summary and create proper structure\r\n      this.chainCopy(`${col.id}:b:summary`, this.cache.get(`${col.id}:c:data`)!, (data: any) => ({summary: data, data}));\r\n      if (isNumberColumn(col)) {\r\n        this.chainCopy(`${col.id}:b:summary:raw`, this.cache.get(`${col.id}:c:data:raw`)!, (data: any) => ({summary: data, data}));\r\n      }\r\n    }\r\n  }\r\n\r\n  copyCache(col: Column, from: Column) {\r\n    const fromPrefix = `${from.id}:`;\r\n\r\n    for (const key of Array.from(this.cache.keys()).sort()) {\r\n      if (!key.startsWith(fromPrefix)) {\r\n        continue;\r\n      }\r\n      const tkey = `${col.id}:${key.slice(fromPrefix.length)}`;\r\n      this.chainCopy(tkey, this.cache.get(key)!, (data: any) => data);\r\n    }\r\n  }\r\n\r\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray) {\r\n    return taskLater(this.tasks.push(`r${ranking.id}:${group.name}`, () => {\r\n      const rg = ranking.getGroupSortCriteria();\r\n      if (rg.length === 0) {\r\n        return [group.name.toLowerCase()];\r\n      }\r\n      const o = this.byOrder(rows);\r\n      const vs: ICompareValue[] = [];\r\n      for (const s of rg) {\r\n        const cache = this.valueCache(s.col);\r\n        const r = s.col.toCompareGroupValue(o, group, cache ? lazySeq(rows).map((d) => cache(d)) : undefined);\r\n        if (Array.isArray(r)) {\r\n          vs.push(...r);\r\n        } else {\r\n          vs.push(r);\r\n        }\r\n      }\r\n      vs.push(group.name.toLowerCase());\r\n      return vs;\r\n    }));\r\n  }\r\n\r\n  groupRows<T>(col: Column, group: IOrderedGroup, key: string, compute: (rows: ISequence<IDataRow>) => T) {\r\n    return this.cached(`${col.id}:a:group:${group.name}:${key}`, true, oneShotIterator(() => compute(this.byOrder(group.order))));\r\n  }\r\n\r\n  groupExampleRows<T>(_col: Column, group: IOrderedGroup, _key: string, compute: (rows: ISequence<IDataRow>) => T) {\r\n    return taskNow(compute(this.byOrder(group.order.slice(0, 5))));\r\n  }\r\n\r\n  groupBoxPlotStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\r\n    return this.chain(`${col.id}:a:group:${group.name}${raw ? ':braw' : ':b'}`, this.summaryBoxPlotStats(col, raw), ({summary, data}) => {\r\n      const ranking = col.findMyRanker()!;\r\n      const key = raw ? `${col.id}:r` : col.id;\r\n      if (this.valueCacheData.has(key) && group.order.length > 0) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('boxplotStats', {}, key, <Float32Array>this.valueCacheData.get(key), `${ranking.id}:${group.name}`, group.order)\r\n          .then((group) => ({group, summary, data}));\r\n      }\r\n      return this.boxplotBuilder(group.order, col, raw, (group) => ({group, summary, data}));\r\n    });\r\n  }\r\n\r\n  groupNumberStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\r\n    return this.chain(`${col.id}:a:group:${group.name}${raw ? ':raw' : ''}`, this.summaryNumberStats(col, raw), ({summary, data}) => {\r\n      const ranking = col.findMyRanker()!;\r\n      const key = raw ? `${col.id}:r` : col.id;\r\n      if (this.valueCacheData.has(key) && group.order.length > 0) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('numberStats', {numberOfBins: summary.hist.length}, key, <Float32Array>this.valueCacheData.get(key), `${ranking.id}:${group.name}`, group.order)\r\n          .then((group) => ({group, summary, data}));\r\n      }\r\n      return this.normalizedStatsBuilder(group.order, col, summary.hist.length, raw, (group) => ({group, summary, data}));\r\n    });\r\n  }\r\n\r\n  groupCategoricalStats(col: Column & ICategoricalLikeColumn, group: IOrderedGroup) {\r\n    return this.chain(`${col.id}:a:group:${group.name}`, this.summaryCategoricalStats(col), ({summary, data}) => {\r\n      const ranking = col.findMyRanker()!;\r\n      if (this.valueCacheData.has(col.id) && group.order.length > 0) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('categoricalStats', {categories: col.categories.map((d) => d.name)}, col.id, <UIntTypedArray>this.valueCacheData.get(col.id), `${ranking.id}:${group.name}`, group.order)\r\n          .then((group) => ({group, summary, data}));\r\n      }\r\n      return this.categoricalStatsBuilder(group.order, col, (group) => ({group, summary, data}));\r\n    });\r\n  }\r\n\r\n  groupDateStats(col: Column & IDateColumn, group: IOrderedGroup) {\r\n    const key = `${col.id}:a:group:${group.name}`;\r\n    return this.chain(key, this.summaryDateStats(col), ({summary, data}) => {\r\n      const ranking = col.findMyRanker()!;\r\n      if (this.valueCacheData.has(col.id) && group.order.length > 0) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('dateStats', {template: summary}, col.id, <Float64Array>this.valueCacheData.get(col.id), `${ranking.id}:${group.name}`, group.order)\r\n          .then((group) => ({group, summary, data}));\r\n      }\r\n      return this.dateStatsBuilder(group.order, col, summary, (group) => ({group, summary, data}));\r\n    });\r\n  }\r\n\r\n  summaryBoxPlotStats(col: Column & INumberColumn, raw?: boolean, order?: MultiIndices) {\r\n    return this.chain(`${col.id}:b:summary${raw ? ':braw' : ':b'}`, this.dataBoxPlotStats(col, raw), (data) => {\r\n      const ranking = col.findMyRanker()!;\r\n      const key = raw ? `${col.id}:r` : col.id;\r\n      if (this.valueCacheData.has(key)) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('boxplotStats', {}, key, <Float32Array>this.valueCacheData.get(key), ranking.id, order ? order.joined : ranking.getOrder())\r\n          .then((summary) => ({summary, data}));\r\n      }\r\n      return this.boxplotBuilder(order ? order : ranking.getOrder(), col, raw, (summary) => ({summary, data}));\r\n    });\r\n  }\r\n\r\n  summaryNumberStats(col: Column & INumberColumn, raw?: boolean, order?: MultiIndices) {\r\n    return this.chain(`${col.id}:b:summary${raw ? ':raw' : ''}`, this.dataNumberStats(col, raw), (data) => {\r\n      const ranking = col.findMyRanker()!;\r\n      const key = raw ? `${col.id}:r` : col.id;\r\n      if (this.valueCacheData.has(key)) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('numberStats', {numberOfBins: data.hist.length}, key, <Float32Array>this.valueCacheData.get(key), ranking.id, order ? order.joined : ranking.getOrder())\r\n          .then((summary) => ({summary, data}));\r\n      }\r\n      return this.normalizedStatsBuilder(order ? order : ranking.getOrder(), col, data.hist.length, raw, (summary) => ({summary, data}));\r\n    });\r\n  }\r\n\r\n  summaryCategoricalStats(col: Column & ICategoricalLikeColumn, order?: MultiIndices) {\r\n    return this.chain(`${col.id}:b:summary`, this.dataCategoricalStats(col), (data) => {\r\n      const ranking = col.findMyRanker()!;\r\n      if (this.valueCacheData.has(col.id)) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('categoricalStats', {categories: col.categories.map((d) => d.name)}, col.id, <UIntTypedArray>this.valueCacheData.get(col.id), ranking.id, order ? order.joined : ranking.getOrder())\r\n          .then((summary) => ({summary, data}));\r\n      }\r\n      return this.categoricalStatsBuilder(order ? order : ranking.getOrder(), col, (summary) => ({summary, data}));\r\n    });\r\n  }\r\n\r\n  summaryDateStats(col: Column & IDateColumn, order?: MultiIndices) {\r\n    return this.chain(`${col.id}:b:summary`, this.dataDateStats(col), (data) => {\r\n      const ranking = col.findMyRanker()!;\r\n      if (this.valueCacheData.has(col.id)) {\r\n        // web worker version\r\n        return () => this.workers.pushStats('dateStats', {template: data}, col.id, <Float64Array>this.valueCacheData.get(col.id), ranking.id, order ? order.joined : ranking.getOrder())\r\n          .then((summary) => ({summary, data}));\r\n      }\r\n      return this.dateStatsBuilder(order ? order : ranking.getOrder(), col, data, (summary) => ({summary, data}));\r\n    });\r\n  }\r\n\r\n  private cached<T>(key: string, canAbort: boolean, it: Iterator<T | null> | (() => Promise<T>)): IRenderTask<T> {\r\n    const dontCache = this.data.length === 0;\r\n\r\n    if (this.isValidCacheEntry(key) && !dontCache) {\r\n      return this.cache.get(key)!;\r\n    }\r\n\r\n    const task = typeof it === 'function' ? abortAble(it()) : this.tasks.pushMulti(key, it, canAbort);\r\n    const s = taskLater(task);\r\n    if (!dontCache) {\r\n      this.cache.set(key, s);\r\n    }\r\n    task.then((r) => {\r\n      if (this.cache.get(key) !== s) {\r\n        return;\r\n      }\r\n      if (typeof r === 'symbol') {\r\n        this.cache.delete(key);\r\n      } else {\r\n        this.cache.set(key, taskNow(r));\r\n      }\r\n    });\r\n    return s;\r\n  }\r\n\r\n  private chain<T, U>(key: string, task: IRenderTask<T>, creator: (data: T) => Iterator<U | null> | (() => Promise<U>)): IRenderTask<U> {\r\n    if (this.isValidCacheEntry(key)) {\r\n      return this.cache.get(key)!;\r\n    }\r\n    if (task instanceof TaskNow) {\r\n      if (typeof task.v === 'symbol') {\r\n        // aborted\r\n        return taskNow(ABORTED);\r\n      }\r\n      return this.cached(key, true, creator(task.v));\r\n    }\r\n\r\n    const v = (<TaskLater<T>>task).v;\r\n    const subTask = v.then((data) => {\r\n      if (typeof data === 'symbol') {\r\n        return ABORTED;\r\n      }\r\n      const created = creator(data);\r\n      if (typeof created === 'function') {\r\n        // promise\r\n        return created();\r\n      }\r\n      return this.tasks.pushMulti(key, created);\r\n    });\r\n    const s = taskLater(subTask);\r\n    this.cache.set(key, s);\r\n    subTask.then((r) => {\r\n      if (this.cache.get(key) !== s) {\r\n        return;\r\n      }\r\n      if (typeof r === 'symbol') {\r\n        this.cache.delete(key);\r\n      } else {\r\n        this.cache.set(key, taskNow(r));\r\n      }\r\n    });\r\n    return s;\r\n  }\r\n\r\n  private isValidCacheEntry(key: string) {\r\n    if (!this.cache.has(key)) {\r\n      return false;\r\n    }\r\n    const v = this.cache.get(key);\r\n    // not an aborted task\r\n    return !((v instanceof TaskNow) && typeof v.v === 'symbol') && !(v instanceof TaskLater && v.v.isAborted());\r\n  }\r\n\r\n  private chainCopy<T, U>(key: string, task: IRenderTask<T>, creator: (data: T) => U): IRenderTask<U> {\r\n    if (this.isValidCacheEntry(key)) {\r\n      return this.cache.get(key)!;\r\n    }\r\n    if (task instanceof TaskNow) {\r\n      if (typeof task.v === 'symbol') {\r\n        // aborted\r\n        return taskNow(ABORTED);\r\n      }\r\n      const subTask = taskNow(creator(task.v));\r\n      this.cache.set(key, subTask);\r\n      return subTask;\r\n    }\r\n\r\n    const v = (<TaskLater<T>>task).v;\r\n    const subTask = v.then((data) => {\r\n      if (typeof data === 'symbol') {\r\n        return ABORTED;\r\n      }\r\n      return creator(data);\r\n    });\r\n    const s = taskLater(subTask);\r\n    this.cache.set(key, s);\r\n    subTask.then((r) => {\r\n      if (this.cache.get(key) !== s) {\r\n        return;\r\n      }\r\n      if (typeof r === 'symbol') {\r\n        this.cache.delete(key);\r\n      } else {\r\n        this.cache.set(key, taskNow(r));\r\n      }\r\n    });\r\n    return s;\r\n  }\r\n\r\n  dataBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\r\n    const key = `${col.id}:c:data${raw ? ':braw' : ':b'}`;\r\n    const valueCacheKey = raw ? `${col.id}:r` : col.id;\r\n    if (this.valueCacheData.has(valueCacheKey) && this.data.length > 0) {\r\n      // use webworker\r\n      return this.cached(key, false, () => this.workers.pushStats('boxplotStats', {}, valueCacheKey, <Float32Array>this.valueCacheData.get(valueCacheKey)!));\r\n    }\r\n    return this.cached(key, false, this.boxplotBuilder<IAdvancedBoxPlotData>(null, col, raw));\r\n  }\r\n\r\n  dataNumberStats(col: Column & INumberColumn, raw?: boolean) {\r\n    return this.cached(`${col.id}:c:data${raw ? ':raw' : ''}`, false, this.normalizedStatsBuilder<IStatistics>(null, col, getNumberOfBins(this.data.length), raw));\r\n  }\r\n\r\n  dataCategoricalStats(col: Column & ICategoricalLikeColumn) {\r\n    return this.cached(`${col.id}:c:data`, false, this.categoricalStatsBuilder<ICategoricalStatistics>(null, col));\r\n  }\r\n\r\n  dataDateStats(col: Column & IDateColumn) {\r\n    return this.cached(`${col.id}:c:data`, false, this.dateStatsBuilder<IDateStatistics>(null, col));\r\n  }\r\n\r\n  sort(ranking: Ranking, group: IGroup, indices: IndicesArray, singleCall: boolean, maxDataIndex: number, lookups?: CompareLookup) {\r\n    if (!lookups || indices.length < 1000) {\r\n      // no thread needed\r\n      const order = sortDirect(indices, maxDataIndex, lookups);\r\n      return Promise.resolve(order);\r\n    }\r\n\r\n    const indexArray = toIndexArray(indices, maxDataIndex);\r\n    const toTransfer = [indexArray.buffer];\r\n\r\n    if (singleCall) {\r\n      // can transfer otherwise need to copy\r\n      toTransfer.push(...lookups.transferAbles);\r\n    }\r\n\r\n    return this.workers.push('sort', {\r\n      ref: `${ranking.id}:${group.name}`,\r\n      indices: indexArray,\r\n      sortOrders: lookups.sortOrders\r\n    }, toTransfer, (r: ISortMessageResponse) => r.order);\r\n  }\r\n\r\n  terminate() {\r\n    this.workers.terminate();\r\n    this.cache.clear();\r\n    this.valueCacheData.clear();\r\n  }\r\n}\r\n","import {IAbortAblePromise} from 'lineupengine';\r\nimport {Column, IDataRow, IOrderedGroup, INumberColumn, ICategoricalLikeColumn, IDateColumn} from '../model';\r\nimport {IDataProvider} from '../provider';\r\nimport DialogManager from '../ui/dialogs/DialogManager';\r\nimport {ISequence, IDateStatistics, ICategoricalStatistics, IAdvancedBoxPlotData, IStatistics} from '../internal';\r\n\r\n\r\nexport interface IImposer {\r\n  color?(row: IDataRow | null, valueHint?: number): string | null;\r\n}\r\n\r\nexport declare type IRenderCallback = (ctx: CanvasRenderingContext2D) => void;\r\n\r\n/**\r\n * a cell renderer for rendering a cell of specific column\r\n */\r\nexport interface ICellRenderer {\r\n  /**\r\n   * template as a basis for the update\r\n   */\r\n  readonly template: string;\r\n\r\n  /**\r\n   * update a given node (create using the template) with the given data\r\n   * @param node the node to update\r\n   * @param d the data item\r\n   * @param i the order relative index\r\n   * @param group the group this row is part of\r\n   */\r\n  update(node: HTMLElement, d: IDataRow, i: number, group: IOrderedGroup): void | IAbortAblePromise<void> | null;\r\n\r\n  /**\r\n   * render a low detail canvas row\r\n   * @return true if a dom element is needed\r\n   */\r\n  render?(ctx: CanvasRenderingContext2D, d: IDataRow, i: number, group: IOrderedGroup): void | IAbortAblePromise<IRenderCallback> | boolean | null;\r\n}\r\n\r\n/**\r\n * a cell renderer for rendering a cell of specific column\r\n */\r\nexport interface IGroupCellRenderer {\r\n  /**\r\n   * template as a basis for the update\r\n   */\r\n  readonly template: string;\r\n\r\n  /**\r\n   * update a given node (create using the template) with the given data\r\n   * @param node the node to update\r\n   * @param group the group to render\r\n   */\r\n  update(node: HTMLElement, group: IOrderedGroup): void | IAbortAblePromise<void> | null;\r\n}\r\n\r\nexport interface ISummaryRenderer {\r\n  /**\r\n   * template as a basis for the update\r\n   */\r\n  readonly template: string;\r\n\r\n  update(node: HTMLElement): void | IAbortAblePromise<void> | null;\r\n}\r\n\r\n\r\nexport interface IRenderTask<T> {\r\n  then<U = void>(onfullfilled: (value: T | symbol) => U): U | IAbortAblePromise<U>;\r\n}\r\n\r\nexport interface IRenderTasks {\r\n  groupRows<T>(col: Column, group: IOrderedGroup, key: string, compute: (rows: ISequence<IDataRow>) => T): IRenderTask<T>;\r\n  groupExampleRows<T>(col: Column, group: IOrderedGroup, key: string, compute: (rows: ISequence<IDataRow>) => T): IRenderTask<T>;\r\n\r\n  groupBoxPlotStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean): IRenderTask<{group: IAdvancedBoxPlotData, summary: IAdvancedBoxPlotData, data: IAdvancedBoxPlotData}>;\r\n  groupNumberStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean): IRenderTask<{group: IStatistics, summary: IStatistics, data: IStatistics}>;\r\n  groupCategoricalStats(col: Column & ICategoricalLikeColumn, group: IOrderedGroup): IRenderTask<{group: ICategoricalStatistics, summary: ICategoricalStatistics, data: ICategoricalStatistics}>;\r\n  groupDateStats(col: Column & IDateColumn, group: IOrderedGroup): IRenderTask<{group: IDateStatistics, summary: IDateStatistics, data: IDateStatistics}>;\r\n\r\n  summaryBoxPlotStats(col: Column & INumberColumn, raw?: boolean): IRenderTask<{summary: IAdvancedBoxPlotData, data: IAdvancedBoxPlotData}>;\r\n  summaryNumberStats(col: Column & INumberColumn, raw?: boolean): IRenderTask<{summary: IStatistics, data: IStatistics}>;\r\n  summaryCategoricalStats(col: Column & ICategoricalLikeColumn): IRenderTask<{summary: ICategoricalStatistics, data: ICategoricalStatistics}>;\r\n  summaryDateStats(col: Column & IDateColumn): IRenderTask<{summary: IDateStatistics, data: IDateStatistics}>;\r\n}\r\n\r\n/**\r\n * context for rendering, wrapped as an object for easy extensibility\r\n */\r\nexport interface IRenderContext {\r\n  readonly tasks: IRenderTasks;\r\n  /**\r\n   * render a column\r\n   * @param col\r\n   */\r\n  renderer(col: Column, imposer?: IImposer): ICellRenderer;\r\n\r\n  /**\r\n   * render a column\r\n   * @param col\r\n   */\r\n  groupRenderer(col: Column, imposer?: IImposer): IGroupCellRenderer;\r\n\r\n  summaryRenderer(co: Column, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\r\n\r\n  /**\r\n   * prefix used for all generated id names\r\n   */\r\n  readonly idPrefix: string;\r\n\r\n  asElement(html: string): HTMLElement;\r\n\r\n  colWidth(col: Column): number;\r\n\r\n  readonly provider: IDataProvider;\r\n  readonly dialogManager: DialogManager;\r\n}\r\n\r\nexport enum ERenderMode {\r\n  CELL, GROUP, SUMMARY\r\n}\r\n\r\n\r\nexport interface ICellRendererFactory {\r\n  readonly title: string;\r\n  readonly groupTitle?: string;\r\n  readonly summaryTitle?: string;\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean;\r\n\r\n  create?(col: Column, context: IRenderContext, imposer?: IImposer): ICellRenderer;\r\n\r\n  createGroup?(col: Column, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer;\r\n\r\n  createSummary?(col: Column, context: IRenderContext, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\r\n}\r\n","import {createIndexArray, sortComplex, ISequence, lazySeq, IEventContext} from '../internal';\r\nimport {Column, EDirtyReason, Ranking, defaultGroup, IColumnDesc, ICompareValue, IDataRow, IGroup, IndicesArray, INumberColumn, IOrderedGroup, CompositeColumn} from '../model';\r\nimport ACommonDataProvider from './ACommonDataProvider';\r\nimport ADataProvider from './ADataProvider';\r\nimport {IDataProviderOptions} from './interfaces';\r\nimport {CompareLookup} from './sort';\r\nimport {IRenderTaskExectutor} from './tasks';\r\nimport {DirectRenderTasks} from './DirectRenderTasks';\r\nimport {ScheduleRenderTasks} from './ScheduledTasks';\r\nimport {joinGroups, mapIndices, duplicateGroup} from '../model/internal';\r\n\r\n\r\nexport interface ILocalDataProviderOptions {\r\n  /**\r\n   * whether the filter should be applied to all rankings regardless where they are\r\n   * default: false\r\n   */\r\n  filterGlobally: boolean;\r\n  /**\r\n   * jump to search results such that they are visible\r\n   * default: false\r\n   */\r\n  jumpToSearchResult: boolean;\r\n\r\n  /**\r\n   * specify the task executor to use direct = no delay, scheduled = run when idle\r\n   */\r\n  taskExecutor: 'direct' | 'scheduled';\r\n}\r\n\r\ninterface ISortHelper {\r\n  group: IGroup;\r\n  rows: IndicesArray;\r\n}\r\n\r\n/**\r\n * a data provider based on an local array\r\n */\r\nexport default class LocalDataProvider extends ACommonDataProvider {\r\n  private readonly ooptions: ILocalDataProviderOptions = {\r\n    /**\r\n     * whether the filter should be applied to all rankings regardless where they are\r\n     */\r\n    filterGlobally: false,\r\n\r\n    jumpToSearchResult: false,\r\n\r\n    taskExecutor: 'direct'\r\n  };\r\n\r\n  private readonly reorderAll: () => void;\r\n\r\n  private _dataRows: IDataRow[];\r\n  private filter: ((row: IDataRow) => boolean) | null = null;\r\n  private readonly tasks: IRenderTaskExectutor;\r\n\r\n  constructor(private _data: any[], columns: IColumnDesc[] = [], options: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {}) {\r\n    super(columns, options);\r\n    Object.assign(this.ooptions, options);\r\n    this._dataRows = toRows(_data);\r\n    this.tasks = this.ooptions.taskExecutor === 'direct' ? new DirectRenderTasks() : new ScheduleRenderTasks();\r\n    this.tasks.setData(this._dataRows);\r\n\r\n    const that = this;\r\n    this.reorderAll = function (this: {source?: Ranking, type: string}) {\r\n      //fire for all other rankings a dirty order event, too\r\n      const ranking = this.source;\r\n      const type = this.type;\r\n      for (const r of that.getRankings()) {\r\n        if (r !== ranking) {\r\n          r.dirtyOrder(type === Ranking.EVENT_FILTER_CHANGED ? [EDirtyReason.FILTER_CHANGED] : [EDirtyReason.UNKNOWN]);\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * set a globally applied filter to all data without changing the data source itself\r\n   * @param {((row: IDataRow) => boolean) | null} filter\r\n   */\r\n  setFilter(filter: ((row: IDataRow) => boolean) | null) {\r\n    this.filter = filter;\r\n    this.reorderAll.call({type: Ranking.EVENT_FILTER_CHANGED});\r\n  }\r\n\r\n  getFilter() {\r\n    return this.filter;\r\n  }\r\n\r\n  getTotalNumberOfRows() {\r\n    return this.data.length;\r\n  }\r\n\r\n  getTaskExecutor() {\r\n    return this.tasks;\r\n  }\r\n\r\n  get data() {\r\n    return this._data;\r\n  }\r\n\r\n  destroy() {\r\n    super.destroy();\r\n    this.tasks.terminate();\r\n  }\r\n\r\n  /**\r\n   * replaces the dataset rows with a new one\r\n   * @param data\r\n   */\r\n  setData(data: any[]) {\r\n    this._data = data;\r\n    this._dataRows = toRows(data);\r\n    this.dataChanged();\r\n  }\r\n\r\n  private dataChanged() {\r\n    this.tasks.setData(this._dataRows);\r\n\r\n    for (const ranking of this.getRankings()) {\r\n      this.tasks.preComputeData(ranking);\r\n    }\r\n\r\n    this.fire(ADataProvider.EVENT_DATA_CHANGED, this._dataRows);\r\n    this.reorderAll.call({type: Ranking.EVENT_FILTER_CHANGED});\r\n\r\n  }\r\n\r\n  clearData() {\r\n    this.setData([]);\r\n  }\r\n\r\n  /**\r\n   * append rows to the dataset\r\n   * @param data\r\n   */\r\n  appendData(data: any[]) {\r\n    for (const d of data) {\r\n      this._data.push(d);\r\n      this._dataRows.push({v: d, i: this._dataRows.length});\r\n    }\r\n    this.dataChanged();\r\n  }\r\n\r\n  cloneRanking(existing?: Ranking) {\r\n    const ranking = super.cloneRanking(existing);\r\n\r\n    if (this.ooptions.filterGlobally) {\r\n      ranking.on(`${Ranking.EVENT_FILTER_CHANGED}.reorderAll`, this.reorderAll);\r\n    }\r\n\r\n    this.trackRanking(ranking, existing);\r\n    return ranking;\r\n  }\r\n\r\n  private trackRanking(ranking: Ranking, existing?: Ranking) {\r\n\r\n    const that = this;\r\n    ranking.on(`${Column.EVENT_DIRTY_CACHES}.cache`, function (this: IEventContext) {\r\n      let col: any = this.origin;\r\n      while (col instanceof Column) {\r\n        // console.log(col.label, 'dirty data');\r\n        that.tasks.dirtyColumn(col, 'data');\r\n        that.tasks.preComputeCol(col);\r\n        col = col.parent;\r\n      }\r\n    });\r\n\r\n    const cols = ranking.flatColumns;\r\n    const addKey = `${Ranking.EVENT_ADD_COLUMN}.cache`;\r\n    const removeKey = `${Ranking.EVENT_REMOVE_COLUMN}.cache`;\r\n\r\n    const removeCol = (col: Column) => {\r\n      this.tasks.dirtyColumn(col, 'data');\r\n      if (col instanceof CompositeColumn) {\r\n        col.on(addKey, null);\r\n        col.on(removeKey, null);\r\n      }\r\n    };\r\n\r\n    const addCol = (col: Column) => {\r\n      this.tasks.preComputeCol(col);\r\n      if (col instanceof CompositeColumn) {\r\n        col.on(addKey, addCol);\r\n        col.on(removeKey, removeCol);\r\n      }\r\n    };\r\n\r\n\r\n    ranking.on(addKey, addCol);\r\n    ranking.on(removeKey, removeCol);\r\n    for (const col of cols) {\r\n      if (col instanceof CompositeColumn) {\r\n        col.on(addKey, addCol);\r\n        col.on(removeKey, removeCol);\r\n      }\r\n    }\r\n\r\n    if (existing) {\r\n      const copy = existing.flatColumns;\r\n      for (let i = 0; i < cols.length; ++i) {\r\n        this.tasks.copyCache(cols[i], copy[i]);\r\n      }\r\n    }\r\n\r\n    this.tasks.preComputeData(ranking);\r\n  }\r\n\r\n  cleanUpRanking(ranking: Ranking) {\r\n    if (this.ooptions.filterGlobally) {\r\n      ranking.on(`${Ranking.EVENT_FILTER_CHANGED}.reorderAll`, null);\r\n    }\r\n\r\n\r\n    const cols = ranking.flatColumns;\r\n    const addKey = `${Ranking.EVENT_ADD_COLUMN}.cache`;\r\n    const removeKey = `${Ranking.EVENT_REMOVE_COLUMN}.cache`;\r\n    ranking.on(addKey, null);\r\n    ranking.on(removeKey, null);\r\n    for (const col of cols) {\r\n      if (col instanceof CompositeColumn) {\r\n        col.on(addKey, null);\r\n        col.on(removeKey, null);\r\n      }\r\n    }\r\n\r\n    this.tasks.dirtyRanking(ranking, 'data');\r\n\r\n    super.cleanUpRanking(ranking);\r\n  }\r\n\r\n  private resolveFilter(ranking: Ranking) {\r\n    //do the optional filtering step\r\n    const filter: (Column | ((d: IDataRow) => boolean))[] = [];\r\n\r\n    if (this.ooptions.filterGlobally) {\r\n      for (const r of this.getRankings()) {\r\n        if (r.isFiltered()) {\r\n          filter.push(...r.flatColumns.filter((d) => d.isFiltered()));\r\n        }\r\n      }\r\n    } else if (ranking.isFiltered()) {\r\n      filter.push(...ranking.flatColumns.filter((d) => d.isFiltered()));\r\n    }\r\n\r\n    if (this.filter) {\r\n      filter.push(this.filter);\r\n    }\r\n    return filter;\r\n  }\r\n\r\n  private noSorting(ranking: Ranking) {\r\n    // initial no sorting required just index mapping\r\n    const l = this._data.length;\r\n    const order = createIndexArray(l, l - 1);\r\n    const index2pos = order.slice();\r\n    for (let i = 0; i < l; ++i) {\r\n      order[i] = i;\r\n      index2pos[i] = i + 1; // shift since default is 0\r\n    }\r\n\r\n    this.tasks.preCompute(ranking, [{rows: order, group: defaultGroup}], l - 1);\r\n    return {groups: [Object.assign({order}, defaultGroup)], index2pos};\r\n  }\r\n\r\n  private createSorter(ranking: Ranking, filter: (Column | ((d: IDataRow) => boolean))[], needsFiltering: boolean, needsGrouping: boolean, needsSorting: boolean) {\r\n    const groups = new Map<string, ISortHelper>();\r\n    const groupOrder: ISortHelper[] = [];\r\n    let maxDataIndex = -1;\r\n\r\n    const groupCriteria = ranking.getGroupCriteria();\r\n    const lookups = needsSorting ? new CompareLookup(this._data.length, true, ranking, this.tasks.valueCache.bind(this.tasks)) : undefined;\r\n\r\n    const pushGroup = (group: IGroup, r: IDataRow) => {\r\n      const groupKey = group.name.toLowerCase();\r\n      if (groups.has(groupKey)) {\r\n        (<number[]>groups.get(groupKey)!.rows).push(r.i);\r\n        return;\r\n      }\r\n      const s = {group, rows: [r.i]};\r\n      groups.set(groupKey, s);\r\n      groupOrder.push(s);\r\n    };\r\n\r\n    const groupCaches = groupCriteria.map((c) => this.tasks.valueCache(c));\r\n    const filterCaches = filter.map((c) => typeof c === 'function' ? undefined : this.tasks.valueCache(c));\r\n\r\n    const toGroup = groupCriteria.length === 1 ?\r\n      (r: IDataRow) => joinGroups([groupCriteria[0].group(r, groupCaches[0] ? groupCaches[0]!(r.i) : undefined)]) :\r\n      (r: IDataRow) => joinGroups(groupCriteria.map((c, i) => c.group(r, groupCaches[i] ? groupCaches[i]!(r.i) : undefined)));\r\n\r\n    if (needsFiltering) {\r\n      // filter, group, sort\r\n      outer: for (const r of this._dataRows) {\r\n        for (let f = 0; f < filter.length; ++f) {\r\n          const fc = filter[f];\r\n          const c = filterCaches[f];\r\n          if ((typeof fc === 'function' && !fc(r)) || (fc instanceof Column && !fc.filter(r, c ? c(r.i) : undefined))) {\r\n            continue outer;\r\n          }\r\n        }\r\n        if (maxDataIndex < r.i) {\r\n          maxDataIndex = r.i;\r\n        }\r\n        if (lookups) {\r\n          lookups.push(r);\r\n        }\r\n        pushGroup(toGroup(r), r);\r\n      }\r\n\r\n      // some default sorting\r\n      groupOrder.sort((a, b) => a.group.name.toLowerCase().localeCompare(b.group.name.toLowerCase()));\r\n      return {maxDataIndex, lookups, groupOrder};\r\n    }\r\n\r\n    // reuse the existing groups\r\n\r\n    for (const before of ranking.getGroups()) {\r\n      const order = before.order;\r\n      if (!needsGrouping) {\r\n        const clone = duplicateGroup(before);\r\n        // reuse in full\r\n        groupOrder.push({group: clone, rows: order});\r\n\r\n        if (!lookups) {\r\n          maxDataIndex = (<ReadonlyArray<number>>order).reduce((a, b) => Math.max(a, b), maxDataIndex);\r\n          continue;\r\n        }\r\n        // sort\r\n        // tslint:disable-next-line:prefer-for-of\r\n        for (let o = 0; o < order.length; ++o) {\r\n          const i = order[o];\r\n          if (maxDataIndex < i) {\r\n            maxDataIndex = i;\r\n          }\r\n          lookups.push(this._dataRows[i]);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      // group, [sort]\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let o = 0; o < order.length; ++o) {\r\n        const i = order[o];\r\n        if (maxDataIndex < i) {\r\n          maxDataIndex = i;\r\n        }\r\n        const r = this._dataRows[i];\r\n        if (lookups) {\r\n          lookups.push(r);\r\n        }\r\n        pushGroup(toGroup(r), r);\r\n      }\r\n    }\r\n\r\n    if (needsGrouping) {\r\n      // some default sorting\r\n      groupOrder.sort((a, b) => a.group.name.toLowerCase().localeCompare(b.group.name.toLowerCase()));\r\n    }\r\n    return {maxDataIndex, lookups, groupOrder};\r\n  }\r\n\r\n  private sortGroup(g: ISortHelper, i: number, ranking: Ranking, lookups: CompareLookup | undefined, groupLookup: CompareLookup | undefined, singleGroup: boolean, maxDataIndex: number): Promise<IOrderedGroup> {\r\n    const group = g.group;\r\n\r\n    const sortTask = this.tasks.sort(ranking, group, g.rows, singleGroup, maxDataIndex, lookups);\r\n\r\n    // compute sort group value as task\r\n    const groupSortTask = groupLookup ? this.tasks.groupCompare(ranking, group, g.rows).then((r) => r) : <ICompareValue[]>[];\r\n\r\n    // trigger task for groups to compute for this group\r\n\r\n\r\n    return Promise.all([sortTask, groupSortTask]).then(([order, groupC]) => {\r\n      if (groupLookup && Array.isArray(groupC)) {\r\n        groupLookup.pushValues(i, groupC);\r\n      }\r\n      return Object.assign(group, {order});\r\n    });\r\n  }\r\n\r\n  private sortGroups(groups: IOrderedGroup[], groupLookup: CompareLookup | undefined, enforceSorting: boolean) {\r\n    // sort groups\r\n    if (groupLookup) {\r\n      const groupIndices = groups.map((_, i) => i);\r\n      sortComplex(groupIndices, groupLookup.sortOrders);\r\n      return groupIndices.map((i) => groups[i]);\r\n    }\r\n    if (enforceSorting) {\r\n      // create a default sorting\r\n      return groups.sort((a, b) => a.name.localeCompare(b.name));\r\n    }\r\n    return groups;\r\n  }\r\n\r\n  private index2pos(groups: IOrderedGroup[], maxDataIndex: number) {\r\n    const total = groups.reduce((a, b) => a + b.order.length, 1);\r\n    const index2pos = createIndexArray(maxDataIndex + 1, total);\r\n    let offset = 1;\r\n    for (const g of groups) {\r\n      // tslint:disable-next-line\r\n      for (let i = 0; i < g.order.length; i++ , offset++) {\r\n        index2pos[g.order[i]] = offset;\r\n      }\r\n    }\r\n\r\n    return {groups, index2pos};\r\n  }\r\n\r\n  sort(ranking: Ranking, dirtyReason: EDirtyReason[]) {\r\n    const reasons = new Set(dirtyReason);\r\n\r\n    if (this._data.length === 0) {\r\n      return {groups: [], index2pos: []};\r\n    }\r\n\r\n    // console.log(dirtyReason);\r\n\r\n    const filter = this.resolveFilter(ranking);\r\n\r\n    const needsFiltering = reasons.has(EDirtyReason.UNKNOWN) || reasons.has(EDirtyReason.FILTER_CHANGED);\r\n    const needsGrouping = needsFiltering || reasons.has(EDirtyReason.GROUP_CRITERIA_CHANGED) || reasons.has(EDirtyReason.GROUP_CRITERIA_DIRTY);\r\n    const needsSorting = needsGrouping || reasons.has(EDirtyReason.SORT_CRITERIA_CHANGED) || reasons.has(EDirtyReason.SORT_CRITERIA_DIRTY);\r\n    const needsGroupSorting = needsGrouping || reasons.has(EDirtyReason.GROUP_SORT_CRITERIA_CHANGED) || reasons.has(EDirtyReason.GROUP_SORT_CRITERIA_DIRTY);\r\n\r\n    if (needsFiltering) {\r\n      this.tasks.dirtyRanking(ranking, 'summary');\r\n    } else if (needsGrouping) {\r\n      this.tasks.dirtyRanking(ranking, 'group');\r\n    }\r\n    // otherwise the summary and group summaries should still be valid\r\n\r\n    if (filter.length === 0) {\r\n      // all rows so summary = data\r\n      this.tasks.copyData2Summary(ranking);\r\n    }\r\n\r\n    const isGroupedBy = ranking.getGroupCriteria().length > 0;\r\n    const isSortedBy = ranking.getSortCriteria().length > 0;\r\n    const isGroupedSortedBy = ranking.getGroupSortCriteria().length > 0;\r\n\r\n    if (!isGroupedBy && !isSortedBy && filter.length === 0) {\r\n      return this.noSorting(ranking);\r\n    }\r\n\r\n    const {maxDataIndex, lookups, groupOrder} = this.createSorter(ranking, filter, needsFiltering, needsGrouping, needsSorting);\r\n\r\n    if (groupOrder.length === 0) {\r\n      return {groups: [], index2pos: []};\r\n    }\r\n\r\n    this.tasks.preCompute(ranking, groupOrder, maxDataIndex);\r\n\r\n\r\n    if (groupOrder.length === 1) {\r\n      const g = groupOrder[0]!;\r\n\r\n      // not required if: group sort criteria changed -> lookups will be none\r\n      return this.sortGroup(g, 0, ranking, lookups, undefined, true, maxDataIndex).then((group) => {\r\n        return this.index2pos([group], maxDataIndex);\r\n      });\r\n    }\r\n\r\n    const groupLookup = isGroupedSortedBy && needsGroupSorting ? new CompareLookup(groupOrder.length, false, ranking) : undefined;\r\n\r\n    return Promise.all(groupOrder.map((g, i) => {\r\n      // not required if: group sort criteria changed -> lookups will be none\r\n      return this.sortGroup(g, i, ranking, lookups, groupLookup, false, maxDataIndex);\r\n    })).then((groups) => {\r\n      // not required if: sort criteria changed -> groupLookup will be none\r\n      const sortedGroups = this.sortGroups(groups, groupLookup, needsGroupSorting);\r\n      return this.index2pos(sortedGroups, maxDataIndex);\r\n    });\r\n  }\r\n\r\n  private readonly mapToDataRow = (i: number) => {\r\n    if (i < 0 || i >= this._dataRows.length) {\r\n      return {i, v: {}};\r\n    }\r\n    return this._dataRows[i];\r\n  };\r\n\r\n  viewRaw(indices: IndicesArray) {\r\n    return mapIndices(indices, (i) => this._data[i] || {});\r\n  }\r\n\r\n  viewRawRows(indices: IndicesArray) {\r\n    return mapIndices(indices, this.mapToDataRow);\r\n  }\r\n\r\n  getRow(index: number) {\r\n    return this._dataRows[index];\r\n  }\r\n\r\n  seq(indices: IndicesArray) {\r\n    return lazySeq(indices).map(this.mapToDataRow);\r\n  }\r\n\r\n  view(indices: IndicesArray) {\r\n    return this.viewRaw(indices);\r\n  }\r\n\r\n  mappingSample(col: INumberColumn): ISequence<number> {\r\n    const MAX_SAMPLE = 120; //at most 120 sample lines\r\n    const l = this._dataRows.length;\r\n    if (l <= MAX_SAMPLE) {\r\n      return lazySeq(this._dataRows).map((v) => col.getRawNumber(v));\r\n    }\r\n    //randomly select 500 elements\r\n    const indices = new Set<number>();\r\n\r\n    for (let i = 0; i < MAX_SAMPLE; ++i) {\r\n      let j = Math.floor(Math.random() * (l - 1));\r\n      while (indices.has(j)) {\r\n        j = Math.floor(Math.random() * (l - 1));\r\n      }\r\n      indices.add(j);\r\n    }\r\n    return lazySeq(Array.from(indices)).map((i) => col.getRawNumber(this._dataRows[i]));\r\n  }\r\n\r\n  searchAndJump(search: string | RegExp, col: Column) {\r\n    //case insensitive search\r\n    search = typeof search === 'string' ? search.toLowerCase() : search;\r\n    const f = typeof search === 'string' ? (v: string) => v.toLowerCase().indexOf((<string>search)) >= 0 : (<RegExp>search).test.bind(search);\r\n    const indices = <number[]>[];\r\n    for (let i = 0; i < this._dataRows.length; ++i) {\r\n      if (f(col.getLabel(this._dataRows[i]))) {\r\n        indices.push(i);\r\n      }\r\n    }\r\n    this.jumpToNearest(indices);\r\n  }\r\n\r\n}\r\n\r\nfunction toRows(data: any[]) {\r\n  return data.map((v, i) => ({v, i}));\r\n}\r\n","/**\r\n * number of bins before switching to dense mode\r\n * @internal\r\n */\r\nexport const DENSE_HISTOGRAM = 19;\r\n/**\r\n * minimal witdh of a column to show the label in the header\r\n * @internal\r\n */\r\nexport const MIN_LABEL_WIDTH = 30;\r\n/**\r\n * number of milliseconds to wait before a hovered canvas row will be replaced with a DOM one\r\n * @type {number}\r\n * @internal\r\n */\r\nexport const HOVER_DELAY_SHOW_DETAIL = 500;\r\n\r\nexport const GUESSED_ROW_HEIGHT = 18;\r\nexport const GUESSES_GROUP_HEIGHT = 40;\r\n","\r\nconst styles = new Map<string, string>();\r\n// {\r\n//   const r = /^[$]([\\w]+): ([\\w #.()'\\/,-]+)( !default)?;/gmi;\r\n//   const s = String(vars);\r\n\r\n//   let m: RegExpMatchArray | null = r.exec(s);\r\n//   while (m != null) {\r\n//     styles.set(m[1], m[2]);\r\n//     m = r.exec(s);\r\n//   }\r\n// }\r\n\r\n/** @internal */\r\nexport default function getStyle(key: string, defaultValue = '') {\r\n  if (key[0] === '$') {\r\n    key = key.slice(1);\r\n  }\r\n  if (styles.has(key)) {\r\n    return styles.get(key)!;\r\n  }\r\n  return defaultValue;\r\n}\r\n\r\n/** @internal */\r\nexport const COLUMN_PADDING = parseInt(getStyle('lu_engine_grip_gap', '5px'), 10);\r\n/** @internal */\r\nexport const FILTERED_OPACITY = parseFloat(getStyle('lu_filtered_opacity', '0.2'));\r\n/** @internal */\r\nexport const DASH = {\r\n  width: parseInt(getStyle('lu_missing_dash_width', '3px'), 10),\r\n  height: parseInt(getStyle('lu_missing_dash_height', '10px'), 10),\r\n  color: getStyle('lu_missing_dash_color', 'gray')\r\n};\r\n/** @internal */\r\nexport const UPSET = {\r\n  color: getStyle('lu_renderer_upset_color'),\r\n  inactive: parseFloat(getStyle('lu_renderer_upset_inactive_opacity', '0.1'))\r\n};\r\n/** @internal */\r\nexport const DOT = {\r\n  color: getStyle('lu_renderer_dot_color', 'gray'),\r\n  size: parseInt(getStyle('lu_renderer_dot_size', '5px'), 10),\r\n  opacity: parseFloat(getStyle('lu_renderer_dot_opacity', '0.5'))\r\n};\r\n/** @internal */\r\nexport const BOX_PLOT = {\r\n  box: getStyle('lu_renderer_boxplot_box', '#e0e0e0'),\r\n  stroke: getStyle('lu_renderer_boxplot_stroke', 'black'),\r\n  sort: getStyle('lu_renderer_boxplot_sort_indicator', '#ffa500'),\r\n  outlier: getStyle('lu_renderer_boxplot_outlier', '#e0e0e0')\r\n};\r\n/** @internal */\r\nexport const AGGREGATE = {\r\n  width: parseInt(getStyle('lu_aggregate_square_bracket_width', '4px'), 10),\r\n  strokeWidth: parseInt(getStyle('lu_aggregate_square_bracket_stroke_width', '2px'), 10),\r\n  color: getStyle('lu_aggregate_square_bracket_stroke_color', '#000'),\r\n  levelOffset: parseInt(getStyle('lu_aggregate_level_offset', '2px'), 10),\r\n  levelWidth: parseInt(getStyle('lu_aggregate_level_width', '22px'), 10)\r\n};\r\n/** @internal */\r\nexport const SLOPEGRAPH_WIDTH = parseInt(getStyle('lu_slope_width', '200px'), 10);\r\n/** @internal */\r\nexport const CANVAS_HEIGHT = 4;\r\n\r\n/** @internal */\r\nexport const CSS_PREFIX = getStyle('lu_css_prefix', 'lu');\r\n/** @internal */\r\nexport const ENGINE_CSS_PREFIX = 'le';\r\n\r\n/** @internal */\r\nexport const RESIZE_SPACE = parseInt(getStyle('lu_engine_resize_space', '50px'), 10);\r\n/** @internal */\r\nexport const RESIZE_ANIMATION_DURATION = parseInt(getStyle('lu_engine_resize_animation_duration', '1000ms'), 10);\r\n\r\n/** @internal */\r\nexport function cssClass(suffix?: string) {\r\n  return suffix? `${CSS_PREFIX}-${suffix}` : CSS_PREFIX;\r\n}\r\n/** @internal */\r\nexport function engineCssClass(suffix?: string) {\r\n  return suffix? `${ENGINE_CSS_PREFIX}-${suffix}` : ENGINE_CSS_PREFIX;\r\n}\r\n\r\n/** @internal */\r\nexport function aria(text: string) {\r\n  return `<span class=\"${cssClass('aria')}\" aria-hidden=\"true\">${text}</span>`;\r\n}\r\n","import {MIN_LABEL_WIDTH} from '../constants';\r\nimport {Column, IArrayColumn, IDataRow, ICategoricalLikeColumn, isMapAbleColumn, DEFAULT_COLOR} from '../model';\r\nimport {hsl} from 'd3-color';\r\nimport {cssClass} from '../styles';\r\nimport {IRenderContext} from '.';\r\nimport {ISequence} from '../internal';\r\n\r\n/** @internal */\r\nexport function noop() {\r\n  // no op\r\n}\r\n\r\nexport const noRenderer = {\r\n  template: `<div></div>`,\r\n  update: <() => void>noop\r\n};\r\n\r\n/** @internal */\r\nexport function setText<T extends Node>(node: T, text?: string): T {\r\n  if (text === undefined) {\r\n    return node;\r\n  }\r\n  //no performance boost if setting the text node directly\r\n  //const textNode = <Text>node.firstChild;\r\n  //if (textNode == null) {\r\n  //  node.appendChild(node.ownerDocument!.createTextNode(text));\r\n  //} else {\r\n  //  textNode.data = text;\r\n  //}\r\n  if (node.textContent !== text) {\r\n    node.textContent = text;\r\n  }\r\n  return node;\r\n}\r\n\r\n/**\r\n * for each item matching the selector execute the callback\r\n * @param node\r\n * @param selector\r\n * @param callback\r\n * @internal\r\n */\r\nexport function forEach<T extends Element>(node: Element, selector: string, callback: (d: T, i: number) => void) {\r\n  (<T[]>Array.from(node.querySelectorAll(selector))).forEach(callback);\r\n}\r\n\r\n/** @internal */\r\nexport function forEachChild<T extends Element>(node: Element, callback: (d: T, i: number) => void) {\r\n  (<T[]>Array.from(node.children)).forEach(callback);\r\n}\r\n\r\n/**\r\n * matches the columns and the dom nodes representing them\r\n * @param {HTMLElement} node row\r\n * @param columns columns to check\r\n * @internal\r\n */\r\nexport function matchColumns(node: HTMLElement, columns: {column: Column, template: string, rendererId: string}[], ctx: IRenderContext) {\r\n  if (node.childElementCount === 0) {\r\n    // initial call fast method\r\n    node.innerHTML = columns.map((c) => c.template).join('');\r\n    const children = Array.from(node.children);\r\n    columns.forEach((col, i) => {\r\n      const cnode = <HTMLElement>children[i];\r\n      // set attribute for finding again\r\n      cnode.dataset.columnId = col.column.id;\r\n      // store current renderer\r\n      cnode.dataset.renderer = col.rendererId;\r\n      cnode.classList.add(cssClass(`renderer-${col.rendererId}`));\r\n    });\r\n    return;\r\n  }\r\n\r\n  function matches(c: {column: Column, rendererId: string}, i: number) {\r\n    //do both match?\r\n    const n = <HTMLElement>node.children[i];\r\n    return n != null && n.dataset.columnId === c.column.id && n.dataset.renderer === c.rendererId;\r\n  }\r\n\r\n  if (columns.every(matches)) {\r\n    return; //nothing to do\r\n  }\r\n\r\n  const idsAndRenderer = new Set(columns.map((c) => `${c.column.id}@${c.rendererId}`));\r\n  //remove all that are not existing anymore\r\n  forEachChild(node, (n: HTMLElement) => {\r\n    const id = n.dataset.columnId;\r\n    const renderer = n.dataset.renderer;\r\n    const idAndRenderer = `${id}@${renderer}`;\r\n    if (!idsAndRenderer.has(idAndRenderer)) {\r\n      node.removeChild(n);\r\n    }\r\n  });\r\n  columns.forEach((col) => {\r\n    let cnode = <HTMLElement>node.querySelector(`[data-column-id=\"${col.column.id}\"]`);\r\n    if (!cnode) {\r\n      cnode = ctx.asElement(col.template);\r\n      cnode.dataset.columnId = col.column.id;\r\n      cnode.dataset.renderer = col.rendererId;\r\n      cnode.classList.add(cssClass(`renderer-${col.rendererId}`));\r\n    }\r\n    node.appendChild(cnode);\r\n  });\r\n}\r\n\r\nexport function wideEnough(col: IArrayColumn<any>, length: number = col.labels.length) {\r\n  const w = col.getWidth();\r\n  return w / length > MIN_LABEL_WIDTH; // at least 30 pixel\r\n}\r\n\r\nexport function wideEnoughCat(col: ICategoricalLikeColumn) {\r\n  const w = col.getWidth();\r\n  return w / col.categories.length > MIN_LABEL_WIDTH; // at least 30 pixel\r\n}\r\n\r\n\r\n\r\n// side effect\r\nconst adaptColorCache: {[bg: string]: string} = {};\r\n/**\r\n * Adapts the text color for a given background color\r\n * @param {string} bgColor as `#ff0000`\r\n * @returns {string} returns `black` or `white` for best contrast\r\n */\r\nexport function adaptTextColorToBgColor(bgColor: string): string {\r\n  const bak = adaptColorCache[bgColor];\r\n  if (bak) {\r\n    return bak;\r\n  }\r\n  return adaptColorCache[bgColor] = hsl(bgColor).l > 0.5 ? 'black' : 'white';\r\n}\r\n\r\n\r\n/**\r\n *\r\n * Adapts the text color for a given background color\r\n * @param {HTMLElement} node the node containing the text\r\n * @param {string} bgColor as `#ff0000`\r\n * @param {string} title the title to render\r\n * @param {number} width for which percentages of the cell this background applies (0..1)\r\n */\r\nexport function adaptDynamicColorToBgColor(node: HTMLElement, bgColor: string, title: string, width: number) {\r\n  const adapt = adaptTextColorToBgColor(bgColor);\r\n  if ((width <= 0.05 || adapt === 'black') || width > 0.9) { // almost empty or full\r\n    node.style.color = adapt === 'black' || width <= 0.05 ? null : adapt; // null = black\r\n    // node.classList.remove('lu-gradient-text');\r\n    // node.style.backgroundImage = null;\r\n    return;\r\n  }\r\n\r\n  node.style.color = null;\r\n  node.innerText = title;\r\n\r\n  const span = node.ownerDocument!.createElement('span');\r\n  span.classList.add(cssClass('gradient-text'));\r\n  span.style.color = adapt;\r\n  span.innerText = title;\r\n  node.appendChild(span);\r\n}\r\n\r\n\r\n/** @internal */\r\nexport const uniqueId: (prefix: string) => string = (function () {\r\n  // side effect but just within the function itself, so good for the library\r\n  let idCounter = 0;\r\n  return (prefix: string) => `${prefix}${(idCounter++).toString(36)}`;\r\n})();\r\n\r\n\r\nconst NUM_EXAMPLE_VALUES = 5;\r\n\r\n/** @internal */\r\nexport function exampleText(col: Column, rows: ISequence<IDataRow>) {\r\n  const examples = <string[]>[];\r\n  rows.every((row) => {\r\n    if (col.getValue(row) == null) {\r\n      return true;\r\n    }\r\n    const v = col.getLabel(row);\r\n    examples.push(v);\r\n    return examples.length < NUM_EXAMPLE_VALUES;\r\n  });\r\n  if (examples.length === 0) {\r\n    return '';\r\n  }\r\n  return `${examples.join(', ')}${examples.length < rows.length ? ', ...' : ''}`;\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function multiLevelGridCSSClass(idPrefix: string, column: Column) {\r\n  return cssClass(`stacked-${idPrefix}-${column.id}`);\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function colorOf(col: Column) {\r\n  if (isMapAbleColumn(col)) {\r\n    return col.getColorMapping().apply(0);\r\n  }\r\n  return DEFAULT_COLOR;\r\n}\r\n","import {IDataRow, IOrderedGroup, ActionColumn, Column} from '../model';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {forEachChild, noRenderer} from './utils';\r\nimport {cssClass} from '../styles';\r\n\r\nexport default class ActionRenderer implements ICellRendererFactory {\r\n  readonly title = 'Default';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof ActionColumn && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: ActionColumn): ICellRenderer {\r\n    const actions = col.actions;\r\n    return {\r\n      template: `<div class=\"${cssClass('actions')} ${cssClass('hover-only')}\">${actions.map((a) => `<span title='${a.name}' class='${a.className || ''}'>${a.icon || ''}</span>`).join('')}</div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\r\n          ni.onclick = function (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            setTimeout(() => actions[i].action(d), 1); // async\r\n          };\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ActionColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const actions = col.groupActions;\r\n    return {\r\n      template: `<div class=\"${cssClass('actions')} ${cssClass('hover-only')}\">${actions.map((a) => `<span title='${a.name}' class='${a.className || ''}'>${a.icon || ''}</span>`).join('')}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\r\n          ni.onclick = function (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            context.tasks.groupRows(col, group, 'identity', (r) => r).then((rows) => {\r\n              if (typeof rows === 'symbol') {\r\n                return;\r\n              }\r\n              setTimeout(() => actions[i].action(group, Array.from(rows)), 1); // async\r\n            });\r\n          };\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IAggregationStrategy} from './interfaces';\r\nimport {IOrderedGroup, IGroup, IGroupParent, IGroupData, IGroupItem, isGroup} from '../model';\r\n\r\nexport function isAlwaysShowingGroupStrategy(strategy: IAggregationStrategy) {\r\n  return strategy === 'group+item' || strategy === 'group+item+top' || strategy === 'group+top+item';\r\n}\r\n\r\nexport function hasTopNStrategy(strategy: IAggregationStrategy) {\r\n  return strategy === 'group+item+top' || strategy === 'group+top+item';\r\n}\r\n\r\nexport declare type IGroupMeta = 'first' | 'last' | 'first last' | null;\r\n\r\nexport function toItemMeta(relativeIndex: number, group: IOrderedGroup, topN: number): IGroupMeta {\r\n  if (relativeIndex === 0) {\r\n    return group.order.length === 1 ? 'first last' : 'first';\r\n  }\r\n  if ((relativeIndex === (group.order.length - 1)) || (topN > 0 && relativeIndex === (topN - 1))) {\r\n    return 'last';\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function groupParents(group: IGroup, meta: IGroupMeta) {\r\n  const parents: {group: IGroup, meta: IGroupMeta}[] = [{group, meta}];\r\n\r\n  let prev = group;\r\n  let prevMeta = meta;\r\n  let parent: IGroupParent | undefined | null = group.parent;\r\n\r\n  while (parent) {\r\n    if (parent.subGroups.length === 1 && (prevMeta === 'first last')) {\r\n      meta = 'first last';\r\n    } else if (parent.subGroups[0] === prev && (prevMeta === 'first last' || prevMeta === 'first')) {\r\n      meta = 'first';\r\n    } else if (parent.subGroups[parent.subGroups.length - 1] === prev && (prevMeta === 'last' || prevMeta === 'first last')) {\r\n      meta = 'last';\r\n    } else {\r\n      meta = null;\r\n    }\r\n    parents.unshift({group: parent, meta});\r\n\r\n    prev = parent;\r\n    prevMeta = meta;\r\n    parent = parent.parent;\r\n  }\r\n  return parents;\r\n}\r\n\r\nexport interface ITopNGetter {\r\n  (item: IGroup): number;\r\n}\r\n\r\n/**\r\n * number of group levels this items ends\r\n */\r\nexport function groupEndLevel(item: IGroupData | IGroupItem, topNGetter: ITopNGetter) {\r\n  const group: IGroup = isGroup(item) ? item : item.group;\r\n  const last = isGroup(item) ? 'first last' : toItemMeta(item.relativeIndex, item.group, topNGetter(group));\r\n  if (last !== 'last' && last !== 'first last') {\r\n    return 0;\r\n  }\r\n\r\n  let prev = group;\r\n  let parent: IGroupParent | undefined | null = group.parent;\r\n  let i = 1;\r\n\r\n  while (parent) {\r\n    if (!(parent.subGroups.length === 1 || (parent.subGroups[parent.subGroups.length - 1] === prev))) {\r\n      // not last of group - end\r\n      return i;\r\n    }\r\n    ++i;\r\n    prev = parent;\r\n    parent = parent.parent;\r\n  }\r\n\r\n  return i;\r\n}\r\n\r\nexport function isSummaryGroup(group: IGroup, strategy: IAggregationStrategy, topNGetter: ITopNGetter) {\r\n  const topN = topNGetter(group);\r\n  return isAlwaysShowingGroupStrategy(strategy) && topN !== 0;\r\n}\r\n\r\nexport function toRowMeta(item: IGroupData | IGroupItem, strategy: IAggregationStrategy, topNGetter: ITopNGetter): string | null {\r\n  if (isGroup(item)) {\r\n    if (isSummaryGroup(item, strategy, topNGetter)) {\r\n      return 'first';\r\n    }\r\n    const level = groupEndLevel(item, topNGetter);\r\n    if (level === 0) {\r\n      return 'first';\r\n    }\r\n    return `first last${level === 1 ? '' : level - 1}`;\r\n  }\r\n\r\n  const last =  toItemMeta(item.relativeIndex, item.group, topNGetter(item.group));\r\n  if (last == null) {\r\n    return null;\r\n  }\r\n  const level = groupEndLevel(item, topNGetter);\r\n  if (level === 0) {\r\n    return null;\r\n  }\r\n  return `last${level === 1 ? '' : level - 1}`;\r\n}\r\n","import {IDataRow, Column, AggregateGroupColumn, EAggregationState, IOrderedGroup, IGroupParent, IGroup, defaultGroup} from '../model';\r\nimport {AGGREGATE, CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {IRenderContext, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {IDataProvider} from '../provider';\r\nimport {groupParents, toItemMeta, isAlwaysShowingGroupStrategy, hasTopNStrategy, isSummaryGroup} from '../provider/internal';\r\nimport {clear} from '../internal';\r\n\r\nfunction preventDefault(event: Event) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n}\r\n\r\nfunction matchNodes(node: HTMLElement, length: number, clazz = 'agg-level', addTopN = false) {\r\n  const doc = node.ownerDocument!;\r\n  const children = <HTMLElement[]>Array.from(node.children);\r\n  if (addTopN) { // top N buttons\r\n    length = length + 1;\r\n  }\r\n\r\n  // add missing\r\n  for (let i = children.length; i < length; ++i) {\r\n    const child = doc.createElement('div');\r\n    child.classList.add(cssClass(clazz));\r\n    children.push(child);\r\n    node.appendChild(child);\r\n  }\r\n  // remove too many\r\n  for (const r of children.splice(length, children.length - length)) {\r\n    r.remove();\r\n  }\r\n  if (addTopN) {\r\n    const last = children[children.length - 1];\r\n    last.classList.remove(cssClass(clazz));\r\n    last.classList.add(cssClass('agg-all'));\r\n  }\r\n  return children;\r\n}\r\n\r\nfunction renderGroups(node: HTMLElement, group: IOrderedGroup, relativeIndex: number, col: AggregateGroupColumn, provider: IDataProvider) {\r\n  const strategy = provider.getAggregationStrategy();\r\n  const ranking = col.findMyRanker()!;\r\n  const topNGetter = (group: IGroup) => provider.getTopNAggregated(ranking, group);\r\n\r\n  const isRow = relativeIndex >= 0;\r\n  const isLeafGroup = !(<IGroupParent><any>group).subGroups || (<IGroupParent><any>group).subGroups.length === 0;\r\n\r\n  const alwaysShowGroup = isAlwaysShowingGroupStrategy(strategy);\r\n  const isSummary = !isRow && isSummaryGroup(group, strategy, topNGetter);\r\n  const hasTopN = isSummary && isLeafGroup && hasTopNStrategy(strategy);\r\n\r\n  const parents = groupParents(group, relativeIndex >= 0 ? toItemMeta(relativeIndex, group, provider.getTopNAggregated(ranking, group)) : 'first last');\r\n  const children = matchNodes(node, parents.length, 'agg-level', hasTopN);\r\n\r\n  const lastParent = parents.length - 1;\r\n\r\n  for (let i = 0; i < parents.length; ++i) {\r\n    const parent = parents[i];\r\n    const child = children[i];\r\n    const state = provider.getAggregationState(ranking, parent.group);\r\n    const isLastGroup = i === lastParent;\r\n    child.dataset.level = String(parents.length - 1 - i); // count backwards\r\n\r\n    if (alwaysShowGroup && (isRow || i < lastParent)) {\r\n      // inner or last\r\n      if (!isSummary && (parent.meta === 'last' || parent.meta === 'first last')) {\r\n        child.dataset.meta = 'last';\r\n      } else {\r\n        delete child.dataset.meta;\r\n      }\r\n      child.classList.toggle(cssClass('agg-inner'), isRow && isLastGroup);\r\n      child.classList.remove(cssClass('agg-expand'), cssClass('agg-collapse'));\r\n      child.title = '';\r\n      delete child.onclick;\r\n      continue;\r\n    }\r\n\r\n    const isCollapsed = state === EAggregationState.COLLAPSE;\r\n    const isFirst = parent.meta === 'first' || parent.meta === 'first last';\r\n    const isShowAll = state === EAggregationState.EXPAND;\r\n    const childTopN = hasTopN && isLastGroup ? children[parents.length] : null;\r\n\r\n    let meta = parent.meta;\r\n    if (isSummary && parent.meta === 'first last') {\r\n      meta = 'first';\r\n    }\r\n\r\n    if (meta) {\r\n      child.dataset.meta = meta;\r\n    } else {\r\n      delete child.dataset.meta;\r\n    }\r\n\r\n    child.classList.toggle(cssClass('agg-expand'), isFirst);\r\n    child.classList.toggle(cssClass('agg-collapse'), isCollapsed);\r\n    child.title = isFirst ? (isCollapsed ? 'Expand Group' : 'Collapse Group') : '';\r\n\r\n    if (!isFirst) {\r\n      delete child.onclick;\r\n    } else {\r\n      child.onclick = (evt) => {\r\n        preventDefault(evt);\r\n        let nextState: EAggregationState;\r\n        switch (strategy) {\r\n          case 'group+top+item':\r\n            nextState = state === EAggregationState.COLLAPSE ? EAggregationState.EXPAND_TOP_N : EAggregationState.COLLAPSE;\r\n            break;\r\n          case 'group':\r\n          case 'item':\r\n          case 'group+item':\r\n          case 'group+item+top':\r\n          default:\r\n            nextState = state === EAggregationState.COLLAPSE ? EAggregationState.EXPAND : EAggregationState.COLLAPSE;\r\n            break;\r\n        }\r\n        col.setAggregated(parent.group, nextState);\r\n      };\r\n    }\r\n\r\n    if (!childTopN) {\r\n      continue;\r\n    }\r\n    childTopN.dataset.level = String(i); // count upwards\r\n    childTopN.classList.toggle(cssClass('agg-compress'), isShowAll);\r\n    childTopN.title = isShowAll ? `Show Top ${provider.getShowTopN()} Only` : 'Show All';\r\n    childTopN.onclick = (evt) => {\r\n      preventDefault(evt);\r\n      col.setAggregated(parent.group, state === EAggregationState.EXPAND ? EAggregationState.EXPAND_TOP_N : EAggregationState.EXPAND);\r\n    };\r\n  }\r\n}\r\n\r\nfunction isDummyGroup(group: IGroup) {\r\n  return group.parent == null && group.name === defaultGroup.name;\r\n}\r\n\r\nexport default class AggregateGroupRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof AggregateGroupColumn;\r\n  }\r\n\r\n  create(col: AggregateGroupColumn, context: IRenderContext): ICellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update(node: HTMLElement, _row: IDataRow, i: number, group: IOrderedGroup) {\r\n        if (isDummyGroup(group)) {\r\n          clear(node);\r\n          return;\r\n        }\r\n        renderGroups(node, group, i, col, context.provider);\r\n      },\r\n      render(ctx: CanvasRenderingContext2D, _row: IDataRow, i: number, group: IOrderedGroup) {\r\n        if (isDummyGroup(group)) {\r\n          return;\r\n        }\r\n        const parents = groupParents(group, toItemMeta(i, group, context.provider.getTopNAggregated(col.findMyRanker()!, group)));\r\n        ctx.fillStyle = AGGREGATE.color;\r\n        for (let i = 0; i < parents.length; ++i) {\r\n          ctx.fillRect(AGGREGATE.levelWidth * i + AGGREGATE.levelOffset, 0, AGGREGATE.strokeWidth, CANVAS_HEIGHT);\r\n        }\r\n        return parents.some((d) => d.meta != null);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: AggregateGroupColumn, context: IRenderContext): IGroupCellRenderer {\r\n    return {\r\n      template: `<div><div class=\"${cssClass('agg-level')}\"></div></div>`,\r\n      update(node: HTMLElement, group: IOrderedGroup) {\r\n        renderGroups(node, group, -1, col, context.provider);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: AggregateGroupColumn, context: IRenderContext): ISummaryRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (node: HTMLElement) => {\r\n        const ranking = col.findMyRanker()!;\r\n        const groups = ranking.getGroups();\r\n        if (groups.length === 1 && groups[0].name === defaultGroup.name) {\r\n          clear(node);\r\n          return;\r\n        }\r\n\r\n        const gparents = groups.map((group) => groupParents(group, 'first last'));\r\n\r\n        const max = gparents.reduce((a, b) => Math.max(a, b.length), Number.NEGATIVE_INFINITY);\r\n        const children = matchNodes(node, max, 'agg-expand');\r\n\r\n        for (let i = 0; i < max; ++i) {\r\n          const child = children[i];\r\n          const subGroups = <IOrderedGroup[]>gparents.map((d) => d[i] ? d[i].group : null).filter((d) => d != null);\r\n\r\n          const isCollapsed = subGroups.every((d) => context.provider.getAggregationState(ranking, d) === EAggregationState.COLLAPSE);\r\n          child.classList.toggle(cssClass('agg-collapse'), isCollapsed);\r\n          child.title = isCollapsed ? 'Expand All Groups' : 'Collapse All Groups';\r\n\r\n          child.onclick = (evt) => {\r\n            preventDefault(evt);\r\n            context.provider.aggregateAllOf(ranking, isCollapsed ? EAggregationState.EXPAND : EAggregationState.COLLAPSE, subGroups);\r\n          };\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n","import {cssClass} from '../styles';\r\n\r\n/** @internal */\r\nexport const filterMissingText = 'Filter rows containing missing values';\r\n\r\n/** @internal */\r\nexport function filterMissingMarkup(bakMissing: boolean) {\r\n  return `<label class=\"${cssClass('checkbox')}\">\r\n    <input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''}>\r\n    <span class=\"${cssClass('filter-missing')}\">${filterMissingText}</span>\r\n  </label>`;\r\n}\r\n\r\n/** @internal */\r\nexport function filterMissingNumberMarkup(bakMissing: boolean, count: number) {\r\n  return `<label class=\"${cssClass('checkbox')}\">\r\n    <input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''} ${count === 0 ? 'disabled' : ''}>\r\n    <span class=\"${cssClass('filter-missing')} ${count === 0 ? cssClass('disabled') : ''}\">Filter ${count} missing value rows</span>\r\n  </label>`;\r\n}\r\n\r\n/** @internal */\r\nexport function findFilterMissing(node: HTMLElement) {\r\n  return <HTMLInputElement>(<HTMLElement>node.getElementsByClassName(cssClass('filter-missing'))[0]!).previousElementSibling!;\r\n}\r\n\r\n/** @internal */\r\nexport function updateFilterMissingNumberMarkup(element: HTMLElement, count: number) {\r\n  const checked = element.getElementsByTagName('input')![0];\r\n  checked.disabled = count === 0;\r\n  element.lastElementChild!.classList.toggle(cssClass('disabled'), count === 0);\r\n  element.lastElementChild!.textContent = `Filter ${count} missing value rows`;\r\n}\r\n","import {Column, IDataRow, isMissingValue} from '../model';\r\nimport {CANVAS_HEIGHT, DASH, cssClass} from '../styles';\r\n\r\nexport function renderMissingValue(ctx: CanvasRenderingContext2D, width: number, height: number, x = 0, y = 0) {\r\n\r\n  const dashX = Math.max(0, x + (width - DASH.width) / 2); // center horizontally\r\n  const dashY = Math.max(0, y + (height - DASH.height) / 2); // center vertically\r\n  ctx.fillStyle = DASH.color;\r\n  ctx.fillRect(dashX, dashY, Math.min(width, DASH.width), Math.min(height, DASH.height));\r\n}\r\n\r\nexport function renderMissingDOM(node: HTMLElement, col: Column, d: IDataRow) {\r\n  const missing = isMissingValue(col.getValue(d));\r\n  node.classList.toggle(cssClass('missing'), missing);\r\n  return missing;\r\n}\r\n\r\nexport function renderMissingCanvas(ctx: CanvasRenderingContext2D, col: Column, d: IDataRow, width: number, x = 0, y = 0) {\r\n  const missing = isMissingValue(col.getValue(d));\r\n  if (missing) {\r\n    renderMissingValue(ctx, width, CANVAS_HEIGHT, x, y);\r\n  }\r\n  return missing;\r\n}\r\n","import {StringColumn, Column, IDataRow, IOrderedGroup, IStringFilter} from '../model';\r\nimport {filterMissingMarkup, findFilterMissing} from '../ui/missing';\r\nimport {IRenderContext, ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {setText, exampleText} from './utils';\r\nimport {cssClass} from '../styles';\r\nimport {debounce} from '../internal';\r\n\r\n\r\n/**\r\n * renders a string with additional alignment behavior\r\n * one instance factory shared among strings\r\n */\r\nexport default class StringCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof StringColumn;\r\n  }\r\n\r\n  create(col: StringColumn): ICellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<div${align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''}> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        if (col.escape) {\r\n          setText(n, col.getLabel(d));\r\n        } else {\r\n          n.innerHTML = col.getLabel(d);\r\n        }\r\n        n.title = n.textContent!;\r\n      }\r\n    };\r\n  }\r\n\r\n\r\n  createGroup(col: StringColumn, context: IRenderContext): IGroupCellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupExampleRows(col, group, 'string', (rows) => exampleText(col, rows)).then((text) => {\r\n          if (typeof text === 'symbol') {\r\n            return;\r\n          }\r\n          n.classList.toggle(cssClass('missing'), !text);\r\n          if (col.escape) {\r\n            setText(n, text);\r\n          } else {\r\n            n.innerHTML = text;\r\n            n.title = text;\r\n          }\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  private static interactiveSummary(col: StringColumn, node: HTMLElement) {\r\n    const form = <HTMLFormElement>node;\r\n    const filterMissing = findFilterMissing(node);\r\n    const input = <HTMLInputElement>node.querySelector('input[type=\"text\"]');\r\n    const isRegex = <HTMLInputElement>node.querySelector('input[type=\"checkbox\"]');\r\n\r\n    const update = () => {\r\n      const valid = input.value.trim();\r\n      if (valid.length <= 0) {\r\n        const filter = filterMissing.checked ? {filter: null, filterMissing: filterMissing.checked} : null;\r\n        col.setFilter(filter);\r\n        return;\r\n      }\r\n      col.setFilter({\r\n        filter: isRegex.checked ? new RegExp(input.value) : input.value,\r\n        filterMissing: filterMissing.checked\r\n      });\r\n    };\r\n\r\n    filterMissing.onchange = update;\r\n    input.onchange = update;\r\n    input.oninput = debounce(update, 100);\r\n    isRegex.onchange = update;\r\n    form.onsubmit = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      update();\r\n      return false;\r\n    };\r\n\r\n    return (actCol: StringColumn) => {\r\n      col = actCol;\r\n      const f = col.getFilter() || {filter: null, filterMissing: false};\r\n      const bak = f.filter;\r\n      filterMissing.checked = f.filterMissing;\r\n      input.value = bak instanceof RegExp ? bak.source : bak || '';\r\n      isRegex.checked = bak instanceof RegExp;\r\n    };\r\n  }\r\n\r\n  createSummary(col: StringColumn, _context: IRenderContext, interactive: boolean): ISummaryRenderer {\r\n    if (!interactive) {\r\n      return {\r\n        template: `<div></div>`,\r\n        update: (node: HTMLElement) => {\r\n          const filter = col.getFilter();\r\n          node.textContent = toString(filter);\r\n        }\r\n      };\r\n    }\r\n    const f = col.getFilter() || {filter: null, filterMissing: false};\r\n    const bak = f.filter || '';\r\n    let update: (col: StringColumn) => void;\r\n    return {\r\n      template: `<form><input type=\"text\" placeholder=\"Filter ${col.desc.label}...\" autofocus value=\"${(bak instanceof RegExp) ? bak.source : bak}\">\r\n          <label class=\"${cssClass('checkbox')}\">\r\n            <input type=\"checkbox\" ${(bak instanceof RegExp) ? 'checked=\"checked\"' : ''}>\r\n            <span>Use regular expressions</span>\r\n          </label>\r\n          ${filterMissingMarkup(f.filterMissing)}</form>`,\r\n      update: (node: HTMLElement) => {\r\n        if (!update) {\r\n          update = StringCellRenderer.interactiveSummary(col, node);\r\n        }\r\n        update(col);\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nfunction toString(filter: IStringFilter | null) {\r\n  if (filter == null || !filter.filter) {\r\n    return '';\r\n  }\r\n  if (filter.filter instanceof RegExp) {\r\n    return filter.filter.source;\r\n  }\r\n  return filter.filter;\r\n}\r\n","import {IDataRow, AnnotateColumn, Column} from '../model';\r\nimport StringCellRenderer from './StringCellRenderer';\r\nimport {cssClass} from '../styles';\r\nimport {ICellRenderer} from './interfaces';\r\n\r\nexport default class AnnotationRenderer extends StringCellRenderer {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column) {\r\n    return super.canRender(col) && col instanceof AnnotateColumn;\r\n  }\r\n\r\n  create(col: AnnotateColumn): ICellRenderer {\r\n    return {\r\n      template: `<div>\r\n        <span></span>\r\n        <input class=\"${cssClass('hover-only')} ${cssClass('annotate-input')}\">\r\n       </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const label = <HTMLElement>n.firstElementChild!;\r\n        const input = <HTMLInputElement>n.lastElementChild!;\r\n        input.onchange = () => {\r\n          label.textContent = input.value;\r\n          col.setValue(d, input.value);\r\n        };\r\n        input.onclick = (event) => {\r\n          event.stopPropagation();\r\n        };\r\n        label.textContent = input.value = col.getLabel(d);\r\n      }\r\n    };\r\n  }\r\n}\r\n","import {Column, isMapAbleColumn, IDataRow, DEFAULT_COLOR} from '../model';\r\nimport {IImposer} from './interfaces';\r\n\r\nexport function colorOf(col: Column, row: IDataRow | null, imposer?: IImposer, valueHint?: number) {\r\n  if (imposer && imposer.color) {\r\n    return imposer.color(row, valueHint);\r\n  }\r\n  if (!row) {\r\n    if (isMapAbleColumn(col)) {\r\n      return col.getColorMapping().apply(valueHint != null ? valueHint : 0);\r\n    }\r\n    return DEFAULT_COLOR;\r\n  }\r\n  return col.getColor(row);\r\n}\r\n","import {round} from '../internal';\r\nimport {Column, isNumbersColumn, IDataRow, INumberColumn, isNumberColumn, DEFAULT_COLOR} from '../model';\r\nimport {setText, adaptDynamicColorToBgColor, noRenderer} from './utils';\r\nimport {CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, IImposer, IGroupCellRenderer, ISummaryRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\n\r\n\r\nexport default class BarCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Bar';\r\n\r\n  /**\r\n   * flag to always render the value\r\n   * @type {boolean}\r\n   */\r\n\r\n  constructor(private readonly renderValue: boolean = false) {\r\n  }\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return mode === ERenderMode.CELL && isNumberColumn(col) && !isNumbersColumn(col);\r\n  }\r\n\r\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div title=\"\">\r\n          <div class=\"${cssClass('bar-label')}\" style='background-color: ${DEFAULT_COLOR}'>\r\n            <span ${this.renderValue ? '' : `class=\"${cssClass('hover-only')}\"`}></span>\r\n          </div>\r\n        </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        const value = col.getNumber(d);\r\n        const missing = renderMissingDOM(n, col, d);\r\n        const w = isNaN(value) ? 0 : round(value * 100, 2);\r\n        const title = col.getLabel(d);\r\n        n.title = title;\r\n\r\n        const bar = <HTMLElement>n.firstElementChild!;\r\n        bar.style.width = missing ? '100%' : `${w}%`;\r\n        const color = colorOf(col, d, imposer, value);\r\n        bar.style.backgroundColor = missing ? null : color;\r\n        setText(bar.firstElementChild!, title);\r\n        const item = <HTMLElement>bar.firstElementChild!;\r\n        setText(item, title);\r\n        adaptDynamicColorToBgColor(item, color || DEFAULT_COLOR, title, w / 100);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        const value = col.getNumber(d);\r\n        ctx.fillStyle = colorOf(col, d, imposer, value) || DEFAULT_COLOR;\r\n        const w = width * value;\r\n        ctx.fillRect(0, 0, isNaN(w) ? 0 : w, CANVAS_HEIGHT);\r\n\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {Column, IDataRow} from '../model';\r\nimport {ERenderMode, ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noRenderer, setText} from './utils';\r\n\r\n/**\r\n * default renderer instance rendering the value as a text\r\n */\r\nexport class DefaultCellRenderer implements ICellRendererFactory {\r\n  title: string = 'String';\r\n  groupTitle: string = 'None';\r\n  summaryTitle: string = 'None';\r\n\r\n  canRender(_col: Column, _mode: ERenderMode): boolean {\r\n    return true;\r\n  }\r\n\r\n  create(col: Column): ICellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        const l = col.getLabel(d);\r\n        setText(n, l);\r\n        n.title = l;\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(_col: Column): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {Column, BooleanColumn} from '../model';\r\nimport {DefaultCellRenderer} from './DefaultCellRenderer';\r\nimport {ERenderMode, ICellRenderer} from './interfaces';\r\nimport {cssClass} from '../styles';\r\n\r\nexport default class BooleanCellRenderer extends DefaultCellRenderer {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof BooleanColumn && mode === ERenderMode.CELL;\r\n  }\r\n\r\n  create(col: Column): ICellRenderer {\r\n    const r = super.create(col);\r\n    (<any>r).template = `<div class=\"${cssClass('center')}\"> </div>`;\r\n    return r;\r\n  }\r\n}\r\n","import {IBoxPlotData, IAdvancedBoxPlotData, round} from '../internal';\r\nimport {NumberColumn, IBoxPlotColumn, INumberColumn, isBoxPlotColumn, Column, IDataRow, isNumberColumn, isMapAbleColumn, IOrderedGroup} from '../model';\r\nimport {BOX_PLOT, CANVAS_HEIGHT, DOT, cssClass} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas} from './missing';\r\nimport {tasksAll} from '../provider';\r\n\r\nconst BOXPLOT = `<div title=\"\">\r\n  <div class=\"${cssClass('boxplot-whisker')}\">\r\n    <div class=\"${cssClass('boxplot-box')}\"></div>\r\n    <div class=\"${cssClass('boxplot-median')}\"></div>\r\n    <div class=\"${cssClass('boxplot-mean')}\"></div>\r\n  </div>\r\n</div>`;\r\n\r\nconst MAPPED_BOXPLOT = `<div title=\"\">\r\n  <div class=\"${cssClass('boxplot-whisker')}\">\r\n    <div class=\"${cssClass('boxplot-box')}\"></div>\r\n    <div class=\"${cssClass('boxplot-median')}\"></div>\r\n    <div class=\"${cssClass('boxplot-mean')}\"></div>\r\n  </div>\r\n  <span class=\"${cssClass('mapping-hint')}\"></span><span class=\"${cssClass('mapping-hint')}\"></span>\r\n</div>`;\r\n\r\n\r\n/** @internal */\r\nexport function computeLabel(col: INumberColumn, v: IBoxPlotData | IAdvancedBoxPlotData) {\r\n  if (v == null) {\r\n    return '';\r\n  }\r\n  const f = col.getNumberFormat();\r\n  const mean = (<IAdvancedBoxPlotData>v).mean != null ? `mean = ${f((<IAdvancedBoxPlotData>v).mean)} (dashed line)\\n` : '';\r\n  return `min = ${f(v.min)}\\nq1 = ${f(v.q1)}\\nmedian = ${f(v.median)}\\n${mean}q3 = ${f(v.q3)}\\nmax = ${f(v.max)}`;\r\n}\r\n\r\nexport default class BoxplotCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Box Plot';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return (isBoxPlotColumn(col) && mode === ERenderMode.CELL || (isNumberColumn(col) && mode !== ERenderMode.CELL));\r\n  }\r\n\r\n  create(col: IBoxPlotColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const sortMethod = <keyof IBoxPlotData>col.getSortMethod();\r\n    const sortedByMe = col.isSortedByMe().asc !== undefined;\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: BOXPLOT,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const data = col.getBoxPlotData(d);\r\n        n.classList.toggle(cssClass('missing'), !data);\r\n        if (!data) {\r\n          return;\r\n        }\r\n        const label = col.getRawBoxPlotData(d)!;\r\n        renderDOMBoxPlot(col, n, data!, label, sortedByMe ? sortMethod : '', colorOf(col, d, imposer));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n\r\n        // Rectangle\r\n        const data = col.getBoxPlotData(d);\r\n        if (!data) {\r\n          return;\r\n        }\r\n\r\n        const scaled = {\r\n          min: data.min * width,\r\n          median: data.median * width,\r\n          mean: (<IAdvancedBoxPlotData>data).mean != null ? (<IAdvancedBoxPlotData>data).mean * width : undefined,\r\n          q1: data.q1 * width,\r\n          q3: data.q3 * width,\r\n          max: data.max * width,\r\n          outlier: data.outlier ? data.outlier.map((d) => d * width) : undefined,\r\n          whiskerLow: data.whiskerLow != null ? data.whiskerLow * width : undefined,\r\n          whiskerHigh: data.whiskerHigh != null ? data.whiskerHigh * width : undefined\r\n        };\r\n        renderBoxPlot(ctx, scaled, sortedByMe ? sortMethod : '', colorOf(col, d, imposer), CANVAS_HEIGHT, 0);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\r\n    const sort = (col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined) ? col.getSortMethod() : '';\r\n    return {\r\n      template: BOXPLOT,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return tasksAll([context.tasks.groupBoxPlotStats(col, group, false), context.tasks.groupBoxPlotStats(col, group, true)]).then((data) => {\r\n          if (typeof data === 'symbol') {\r\n            return;\r\n          }\r\n          // render\r\n          const isMissing = data == null || data[0] == null || data[0].group.count === 0 || data[0].group.count === data[0].group.missing;\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          renderDOMBoxPlot(col, n, data[0].group, data[1].group, sort, colorOf(col, null, imposer));\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: INumberColumn, context: IRenderContext, _interactive: boolean, imposer?: IImposer): ISummaryRenderer {\r\n    return {\r\n      template: isMapAbleColumn(col) ? MAPPED_BOXPLOT : BOXPLOT,\r\n      update: (n: HTMLElement) => {\r\n        return tasksAll([context.tasks.summaryBoxPlotStats(col, false), context.tasks.summaryBoxPlotStats(col, true)]).then((data) => {\r\n          if (typeof data === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = data == null || data[0] == null || data[0].summary.count === 0 || data[0].summary.count === data[0].summary.missing;\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          const mappedSummary = data[0].summary;\r\n          const rawSummary = data[1].summary;\r\n          const sort = (col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined) ? col.getSortMethod() : '';\r\n\r\n          if (isMapAbleColumn(col)) {\r\n            const range = col.getRange();\r\n            Array.from(n.getElementsByTagName('span')).forEach((d: HTMLElement, i) => d.textContent = range[i]);\r\n          }\r\n\r\n          renderDOMBoxPlot(col, n, mappedSummary, rawSummary, sort, colorOf(col, null, imposer), isMapAbleColumn(col));\r\n        });\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nfunction renderDOMBoxPlot(col: INumberColumn, n: HTMLElement, data: IBoxPlotData | IAdvancedBoxPlotData, label: IBoxPlotData | IAdvancedBoxPlotData, sort: string, color: string | null, hasRange: boolean = false) {\r\n  n.title = computeLabel(col, label);\r\n\r\n  const whiskers = <HTMLElement>n.firstElementChild;\r\n  const box = <HTMLElement>whiskers.firstElementChild;\r\n  const median = <HTMLElement>box.nextElementSibling;\r\n  const mean = <HTMLElement>whiskers.lastElementChild;\r\n\r\n  const leftWhisker = data.whiskerLow != null ? data.whiskerLow : Math.max(data.q1 - 1.5 * (data.q3 - data.q1), data.min);\r\n  const rightWhisker = data.whiskerHigh != null ? data.whiskerHigh : Math.min(data.q3 + 1.5 * (data.q3 - data.q1), data.max);\r\n  whiskers.style.left = `${round(leftWhisker * 100, 2)}%`;\r\n  const range = rightWhisker - leftWhisker;\r\n  whiskers.style.width = `${round(range * 100, 2)}%`;\r\n\r\n  //relative within the whiskers\r\n  box.style.left = `${round((data.q1 - leftWhisker) / range * 100, 2)}%`;\r\n  box.style.width = `${round((data.q3 - data.q1) / range * 100, 2)}%`;\r\n  box.style.backgroundColor = color;\r\n\r\n  //relative within the whiskers\r\n  median.style.left = `${round((data.median - leftWhisker) / range * 100, 2)}%`;\r\n  if ((<IAdvancedBoxPlotData>data).mean != null) {\r\n    mean.style.left = `${round(((<IAdvancedBoxPlotData>data).mean - leftWhisker) / range * 100, 2)}%`;\r\n    mean.style.display = null;\r\n  } else {\r\n    mean.style.display = 'none';\r\n  }\r\n\r\n  // match lengths\r\n  const outliers = <HTMLElement[]>Array.from(n.children).slice(1, hasRange ? -2 : undefined);\r\n  const numOutliers = data.outlier ? data.outlier.length : 0;\r\n  outliers.splice(numOutliers, outliers.length - numOutliers).forEach((v) => v.remove());\r\n\r\n  whiskers.dataset.sort = sort;\r\n\r\n  if (!data.outlier || numOutliers === 0) {\r\n    return;\r\n  }\r\n\r\n  for (let i = outliers.length; i < numOutliers; ++i) {\r\n    const p = n.ownerDocument!.createElement('div');\r\n    p.classList.add(cssClass('boxplot-outlier'));\r\n    outliers.unshift(p);\r\n    whiskers.insertAdjacentElement('afterend', p);\r\n  }\r\n  data.outlier.forEach((v, i) => {\r\n    delete outliers[i].dataset.sort;\r\n    outliers[i].style.left = `${round(v * 100, 2)}%`;\r\n  });\r\n\r\n  if (sort === 'min' && data.outlier[0] <= leftWhisker) {\r\n    // first outliers is the min\r\n    whiskers.dataset.sort = '';\r\n    outliers[0].dataset.sort = 'min';\r\n    if (outliers.length > 1) {\r\n      // append at the end of the DOM to be on top\r\n      outliers[outliers.length - 1].insertAdjacentElement('afterend', outliers[0]);\r\n    }\r\n  } else if (sort === 'max' && data.outlier[outliers.length - 1] >= rightWhisker) {\r\n    // last outlier is the max\r\n    whiskers.dataset.sort = '';\r\n    outliers[outliers.length - 1].dataset.sort = 'max';\r\n  }\r\n}\r\n\r\nfunction renderBoxPlot(ctx: CanvasRenderingContext2D, box: IBoxPlotData, sort: string, color: string | null, height: number, topPadding: number) {\r\n  const left = box.whiskerLow != null ? box.whiskerLow : Math.max((box.q1 - 1.5 * (box.q3 - box.q1)), box.min);\r\n  const right = box.whiskerHigh != null ? box.whiskerHigh : Math.min((box.q3 + 1.5 * (box.q3 - box.q1)), box.max);\r\n\r\n  ctx.fillStyle = color || BOX_PLOT.box;\r\n  ctx.strokeStyle = BOX_PLOT.stroke;\r\n  ctx.beginPath();\r\n  ctx.rect(box.q1, 0, box.q3 - box.q1, height);\r\n  ctx.fill();\r\n  ctx.stroke();\r\n\r\n  //Line\r\n  const bottomPos = height - topPadding;\r\n  const middlePos = height / 2;\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(left, middlePos);\r\n  ctx.lineTo(box.q1, middlePos);\r\n  ctx.moveTo(left, topPadding);\r\n  ctx.lineTo(left, bottomPos);\r\n  ctx.moveTo(box.median, 0);\r\n  ctx.lineTo(box.median, height);\r\n  ctx.moveTo(box.q3, middlePos);\r\n  ctx.lineTo(right, middlePos);\r\n  ctx.moveTo(right, topPadding);\r\n  ctx.lineTo(right, bottomPos);\r\n  ctx.stroke();\r\n  ctx.fill();\r\n\r\n  if (sort !== '') {\r\n    ctx.strokeStyle = BOX_PLOT.sort;\r\n    ctx.beginPath();\r\n    ctx.moveTo(<number>box[<keyof IBoxPlotData>sort], topPadding);\r\n    ctx.lineTo(<number>box[<keyof IBoxPlotData>sort], height - topPadding);\r\n    ctx.stroke();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (!box.outlier) {\r\n    return;\r\n  }\r\n  ctx.fillStyle = BOX_PLOT.outlier;\r\n  box.outlier.forEach((v) => {\r\n    // currently dots with 3px\r\n    ctx.fillRect(Math.max(v - DOT.size / 2, 0), middlePos - DOT.size / 2, DOT.size, DOT.size);\r\n  });\r\n}\r\n","import {hsl} from 'd3-color';\r\nimport {Column, isNumbersColumn, IDataRow, INumberColumn, isNumberColumn, isMapAbleColumn, DEFAULT_COLOR, SolidColorFunction} from '../model';\r\nimport {CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {noRenderer, setText} from './utils';\r\n\r\nexport function toHeatMapColor(v: number | null, row: IDataRow, col: INumberColumn, imposer?: IImposer) {\r\n  if (v == null || isNaN(v)) {\r\n    v = 1; // max = brightest\r\n  }\r\n  if (imposer || !isMapAbleColumn(col)) {\r\n    //hsl space encoding, encode in lightness\r\n    const color = hsl(colorOf(col, row, imposer, v) || DEFAULT_COLOR);\r\n    color.l = 1 - v; // largest value = darkest color\r\n    return color.toString();\r\n  }\r\n  const map = col.getColorMapping();\r\n  const valueColor = map.apply(v);\r\n  if (map instanceof SolidColorFunction) {\r\n    //hsl space encoding, encode in lightness\r\n    const color = hsl(valueColor);\r\n    color.l = 1 - v; // largest value = darkest color\r\n    return color.toString();\r\n  }\r\n  // some custom logic that maps to another value\r\n  return valueColor;\r\n}\r\n\r\nexport default class BrightnessCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Brightness';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\r\n  }\r\n\r\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div title=\"\">\r\n        <div class=\"${cssClass('cat-color')}\" style=\"background-color: ${DEFAULT_COLOR}\"></div><div class=\"${cssClass('cat-label')}\"> </div>\r\n      </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const missing = renderMissingDOM(n, col, d);\r\n        n.title = col.getLabel(d);\r\n        (<HTMLDivElement>n.firstElementChild!).style.backgroundColor = missing ? null : toHeatMapColor(col.getNumber(d), d, col, imposer);\r\n        setText(<HTMLSpanElement>n.lastElementChild!, n.title);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        ctx.fillStyle = toHeatMapColor(col.getNumber(d), d, col, imposer);\r\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {DENSE_HISTOGRAM} from '../constants';\r\nimport {ICategoricalStatistics, round} from '../internal';\r\nimport {OrdinalColumn, isCategoricalColumn, isCategoricalLikeColumn, ICategoricalLikeColumn, ICategory, Column, CategoricalColumn, ICategoricalColumn, IDataRow, IOrderedGroup, SetColumn} from '../model';\r\nimport {CANVAS_HEIGHT, cssClass, FILTERED_OPACITY} from '../styles';\r\nimport {filterMissingNumberMarkup, updateFilterMissingNumberMarkup} from '../ui/missing';\r\nimport {IRenderContext, ICellRendererFactory, ERenderMode, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {setText, wideEnough, forEach} from './utils';\r\nimport {color} from 'd3-color';\r\n\r\n/** @internal */\r\nexport declare type HasCategoricalFilter = CategoricalColumn | OrdinalColumn | SetColumn;\r\n\r\nexport default class CategoricalCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Color';\r\n  readonly groupTitle: string = 'Histogram';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isCategoricalLikeColumn(col) && (mode !== ERenderMode.CELL || isCategoricalColumn(col));\r\n  }\r\n\r\n  create(col: ICategoricalColumn, context: IRenderContext): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div>\r\n        <div class=\"${cssClass('cat-color')}\"></div><div class=\"${cssClass('cat-label')}\"></div>\r\n      </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        const v = col.getCategory(d);\r\n        (<HTMLDivElement>n.firstElementChild!).style.backgroundColor = v ? col.getColor(d) : null;\r\n        setText(<HTMLSpanElement>n.lastElementChild!, col.getLabel(d));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        const v = col.getCategory(d);\r\n        ctx.fillStyle = v ? col.getColor(d) : '';\r\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ICategoricalLikeColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {template, update} = hist(col, false);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\r\n          if (typeof r === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          update(n, r.group);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ICategoricalLikeColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\r\n    return (col instanceof CategoricalColumn || col instanceof OrdinalColumn || col instanceof SetColumn) ? interactiveSummary(col, context, interactive) : staticSummary(col, context, interactive);\r\n  }\r\n}\r\n\r\nfunction staticSummary(col: ICategoricalLikeColumn, context: IRenderContext, interactive: boolean) {\r\n  const {template, update} = hist(col, interactive);\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (n: HTMLElement) => {\r\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\r\n        n.classList.toggle(cssClass('missing'), isMissing);\r\n        if (isMissing) {\r\n          return;\r\n        }\r\n        update(n, r.summary);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nfunction interactiveSummary(col: HasCategoricalFilter, context: IRenderContext, interactive: boolean) {\r\n  const {template, update} = hist(col, interactive || wideEnough(col));\r\n  let filterUpdate: (missing: number, col: HasCategoricalFilter) => void;\r\n  return {\r\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0) : ''}</div>`,\r\n    update: (n: HTMLElement) => {\r\n      n.classList.toggle(cssClass('histogram-i'), interactive);\r\n\r\n      if (!filterUpdate) {\r\n        filterUpdate = interactiveHist(col, n);\r\n      }\r\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const {summary, data} = r;\r\n        filterUpdate((interactive && data) ? data.missing : (summary ? summary.missing : 0), col);\r\n\r\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\r\n        n.classList.toggle(cssClass('missing'), isMissing);\r\n        if (isMissing) {\r\n          return;\r\n        }\r\n        update(n, summary, interactive ? data : undefined);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nfunction hist(col: ICategoricalLikeColumn, showLabels: boolean) {\r\n  const mapping = col.getColorMapping();\r\n  const bins = col.categories.map((c) => `<div class=\"${cssClass('histogram-bin')}\" title=\"${c.label}: 0\" data-cat=\"${c.name}\" ${showLabels ? `data-title=\"${c.label}\"` : ''}><div style=\"height: 0; background-color: ${mapping.apply(c)}\"></div></div>`).join('');\r\n  const template = `<div class=\"${cssClass('histogram')} ${col.categories.length! > DENSE_HISTOGRAM ? cssClass('dense') : ''}\">${bins}`; // no closing div to be able to append things\r\n\r\n\r\n  return {\r\n    template,\r\n    update: (n: HTMLElement, hist: ICategoricalStatistics, gHist?: ICategoricalStatistics) => {\r\n      const mapping = col.getColorMapping();\r\n\r\n      const selected = col.categories.map((d) => {\r\n        const c = color(mapping.apply(d))!;\r\n        c.opacity = FILTERED_OPACITY;\r\n        return c.toString();\r\n      });\r\n\r\n      const maxBin = gHist ? gHist.maxBin : hist.maxBin;\r\n      forEach(n, '[data-cat]', (d: HTMLElement, i) => {\r\n        const cat = col.categories[i];\r\n        const {count} = hist.hist[i];\r\n        const inner = <HTMLElement>d.firstElementChild!;\r\n        if (gHist) {\r\n          const {count: gCount} = gHist.hist[i];\r\n          d.title = `${cat.label}: ${count} of ${gCount}`;\r\n          inner.style.height = `${round(gCount * 100 / maxBin, 2)}%`;\r\n          const relY = 100 - round(count * 100 / gCount, 2);\r\n          inner.style.background = relY === 0 ? mapping.apply(cat) : (relY === 100 ? selected[i] : `linear-gradient(${selected[i]} ${relY}%, ${mapping.apply(cat)} ${relY}%, ${mapping.apply(cat)} 100%)`);\r\n        } else {\r\n          d.title = `${col.categories[i].label}: ${count}`;\r\n          const inner = <HTMLElement>d.firstElementChild!;\r\n          inner.style.height = `${Math.round(count * 100 / maxBin)}%`;\r\n          inner.style.background = mapping.apply(cat);\r\n        }\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nfunction setCategoricalFilter(col: HasCategoricalFilter, filter: string | RegExp | string[], filterMissing: boolean) {\r\n  if (col instanceof SetColumn) {\r\n    const f = col.getFilter();\r\n    const mode = f ? f.mode : undefined;\r\n    col.setFilter({\r\n      filter, filterMissing, mode\r\n    });\r\n  } else {\r\n    col.setFilter({\r\n      filter, filterMissing\r\n    });\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport function interactiveHist(col: HasCategoricalFilter, node: HTMLElement) {\r\n  const bins = <HTMLElement[]>Array.from(node.querySelectorAll('[data-cat]'));\r\n\r\n  const markFilter = (bin: HTMLElement, cat: ICategory, value: boolean) => {\r\n    // update filter highlight eagerly for better user feedback\r\n    const inner = <HTMLElement>bin.firstElementChild!;\r\n    const base = col.getColorMapping().apply(cat);\r\n    if (value) {\r\n      inner.style.background = base;\r\n      return;\r\n    }\r\n    const c = color(base)!;\r\n    c.opacity = FILTERED_OPACITY;\r\n    inner.style.background = c.toString();\r\n  };\r\n\r\n  bins.forEach((bin, i) => {\r\n    const cat = col.categories[i];\r\n\r\n    bin.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n\r\n      // toggle filter\r\n      const old = col.getFilter();\r\n      if (old == null || !Array.isArray(old.filter)) {\r\n        // deselect\r\n        markFilter(bin, cat, false);\r\n        const included = col.categories.slice();\r\n        included.splice(i, 1);\r\n        setCategoricalFilter(col, included.map((d) => d.name), old ? old.filterMissing : false);\r\n        return;\r\n      }\r\n      const filter = old.filter.slice();\r\n      const contained = filter.indexOf(cat.name);\r\n      if (contained >= 0) {\r\n        // remove\r\n        filter.splice(contained, 1);\r\n        markFilter(bin, cat, false);\r\n      } else {\r\n        // readd\r\n        filter.push(cat.name);\r\n        markFilter(bin, cat, true);\r\n      }\r\n      if (!old.filterMissing && filter.length === col.categories.length) {\r\n        // dummy filter\r\n        col.setFilter(null);\r\n        return;\r\n      }\r\n      setCategoricalFilter(col, filter, old.filterMissing);\r\n    };\r\n  });\r\n\r\n\r\n  const filterMissing = <HTMLInputElement>node.getElementsByTagName('input')[0]!;\r\n\r\n  if (filterMissing) {\r\n    filterMissing.onchange = () => {\r\n      // toggle filter\r\n      const v = filterMissing.checked;\r\n      const old = col.getFilter();\r\n      if (old == null) {\r\n        if (v) {\r\n          setCategoricalFilter(col, col.categories.map((d) => d.name), v);\r\n        } else {\r\n          col.setFilter(null);\r\n        }\r\n      } else if (!v && Array.isArray(old.filter) && old.filter.length === col.categories.length) {\r\n        // dummy\r\n        col.setFilter(null);\r\n      } else {\r\n        setCategoricalFilter(col, old.filter, v);\r\n      }\r\n    };\r\n  }\r\n\r\n\r\n  return (missing: number, actCol: HasCategoricalFilter) => {\r\n    col = actCol;\r\n    const f = col.getFilter();\r\n    if (filterMissing) {\r\n      filterMissing.checked = f != null && f.filterMissing;\r\n      updateFilterMissingNumberMarkup(<HTMLElement>filterMissing.parentElement, missing);\r\n    }\r\n  };\r\n}\r\n","import {Column, ICategoricalsColumn, ICategory, IDataRow, IOrderedGroup, isCategoricalsColumn} from '../model';\r\nimport {toMostFrequentCategoricals} from '../model/internalCategorical';\r\nimport {CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {ICellRendererFactory, IRenderContext, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM, renderMissingValue} from './missing';\r\nimport {noop, wideEnough} from './utils';\r\nimport {GUESSED_ROW_HEIGHT} from '../constants';\r\n\r\nexport default class CategoricalHeatmapCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Heatmap';\r\n\r\n  canRender(col: Column): boolean {\r\n    return isCategoricalsColumn(col) && Boolean(col.dataLength);\r\n  }\r\n\r\n  private createContext(col: ICategoricalsColumn, context: IRenderContext) {\r\n    const width = context.colWidth(col);\r\n    const cellDimension = width / col.dataLength!;\r\n    const labels = col.labels;\r\n    const render = (ctx: CanvasRenderingContext2D, data: (ICategory | null)[], height: number) => {\r\n      data.forEach((d: ICategory | null, j: number) => {\r\n        const x = j * cellDimension;\r\n        if (d == null) {\r\n          renderMissingValue(ctx, cellDimension, height, x, 0);\r\n          return;\r\n        }\r\n        ctx.fillStyle = d.color;\r\n        ctx.fillRect(x, 0, cellDimension, height);\r\n      });\r\n    };\r\n    return {\r\n      template: `<canvas height=\"${GUESSED_ROW_HEIGHT}\" title=\"\"></canvas>`,\r\n      render,\r\n      width,\r\n      mover: (n: HTMLElement, values: string[]) => (evt: MouseEvent) => {\r\n        const percent = evt.offsetX / width;\r\n        const index = Math.max(0, Math.min(col.dataLength! - 1, Math.floor(percent * (col.dataLength! - 1) + 0.5)));\r\n        n.title = `${labels[index]}: ${values[index]}`;\r\n      }\r\n    };\r\n  }\r\n\r\n  create(col: ICategoricalsColumn, context: IRenderContext): ICellRenderer {\r\n    const {template, render, mover, width} = this.createContext(col, context);\r\n\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const ctx = (<HTMLCanvasElement>n).getContext('2d')!;\r\n        ctx.canvas.width = width;\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        n.onmousemove = mover(n, col.getLabels(d));\r\n        n.onmouseleave = () => n.title = '';\r\n        render(ctx, col.getCategories(d), GUESSED_ROW_HEIGHT);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        render(ctx, col.getCategories(d), CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ICategoricalsColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {template, render, mover, width} = this.createContext(col, context);\r\n\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupRows(col, group, this.title, (rows) => toMostFrequentCategoricals(rows, col)).then((data) => {\r\n          if (typeof data === 'symbol') {\r\n            return;\r\n          }\r\n          const ctx = (<HTMLCanvasElement>n).getContext('2d')!;\r\n          ctx.canvas.width = width;\r\n          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n          const isMissing = !data || data.length === 0 || data.every((d) => d == null);\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          n.onmousemove = mover(n, data.map((d) => d ? d.label : 'missing'));\r\n          n.onmouseleave = () => n.title = '';\r\n          render(ctx, data, GUESSED_ROW_HEIGHT);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ICategoricalsColumn): ISummaryRenderer {\r\n    let labels = col.labels.slice();\r\n    while (labels.length > 0 && !wideEnough(col, labels.length)) {\r\n      labels = labels.filter((_, i) => i % 2 === 0); // even\r\n    }\r\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\r\n    for (const label of labels) {\r\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\"  title=\"${label}\" data-title=\"${label}\"></div>`;\r\n    }\r\n    templateRows += '</div>';\r\n    return {\r\n      template: templateRows,\r\n      update: noop\r\n    };\r\n  }\r\n}\r\n","import {ICategoricalStatistics, round} from '../internal';\r\nimport {CategoricalColumn, Column, OrdinalColumn, ICategoricalColumn, isCategoricalColumn, IOrderedGroup, ISetColumn, DEFAULT_COLOR} from '../model';\r\nimport {filterMissingNumberMarkup} from '../ui/missing';\r\nimport {interactiveHist, HasCategoricalFilter} from './CategoricalCellRenderer';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {noRenderer, adaptTextColorToBgColor} from './utils';\r\nimport {cssClass, FILTERED_OPACITY} from '../styles';\r\nimport {color} from 'd3-color';\r\n\r\nexport default class CategoricalStackedDistributionlCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Distribution Bar';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isCategoricalColumn(col) && mode !== ERenderMode.CELL;\r\n  }\r\n\r\n  create(): ICellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createGroup(col: ICategoricalColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {template, update} = stackedBar(col);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\r\n          if (typeof r === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          update(n, r.group);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ICategoricalColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\r\n    return (col instanceof CategoricalColumn || col instanceof OrdinalColumn) ? interactiveSummary(col, context, interactive) : staticSummary(col, context);\r\n  }\r\n}\r\n\r\nfunction staticSummary(col: ICategoricalColumn, context: IRenderContext) {\r\n  const {template, update} = stackedBar(col);\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (n: HTMLElement) => {\r\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\r\n        n.classList.toggle(cssClass('missing'), isMissing);\r\n        if (isMissing) {\r\n          return;\r\n        }\r\n        update(n, r.summary, r.data);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nfunction interactiveSummary(col: HasCategoricalFilter, context: IRenderContext, interactive: boolean) {\r\n  const {template, update} = stackedBar(col);\r\n  let filterUpdate: (missing: number, col: HasCategoricalFilter) => void;\r\n  return {\r\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0) : ''}</div>`,\r\n    update: (n: HTMLElement) => {\r\n      if (!filterUpdate) {\r\n        filterUpdate = interactiveHist(col, n);\r\n      }\r\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const {summary, data} = r;\r\n\r\n        const missing = interactive && data ? data.missing : (summary ? summary.missing : 0);\r\n        filterUpdate(missing, col);\r\n\r\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\r\n        n.classList.toggle(cssClass('missing'), isMissing);\r\n        if (isMissing) {\r\n          return;\r\n        }\r\n        update(n, summary, data);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nfunction selectedCol(value: string) {\r\n  const c = color(value)!;\r\n  c.opacity = FILTERED_OPACITY;\r\n  return c.toString();\r\n}\r\n\r\nfunction stackedBar(col: ISetColumn) {\r\n  const mapping = col.getColorMapping();\r\n  const cats = col.categories.map((c) => ({\r\n    label: c.label,\r\n    name: c.name,\r\n    color: mapping.apply(c),\r\n    selected: selectedCol(mapping.apply(c))\r\n  }));\r\n  cats.push({label: 'Missing Values', name: 'missing', color: DEFAULT_COLOR, selected: 'transparent'});\r\n\r\n  const bins = cats.map((c) => `<div class=\"${cssClass('distribution-bar')}\" style=\"background-color: ${c.color}; color: ${adaptTextColorToBgColor(c.color)}\" title=\"${c.label}: 0\" data-cat=\"${c.name}\"><span>${c.label}</span></div>`).join('');\r\n\r\n  return {\r\n    template: `<div>${bins}`, // no closing div to be able to append things\r\n    update: (n: HTMLElement, hist: ICategoricalStatistics, gHist?: ICategoricalStatistics) => {\r\n      const bins: {count: number}[] = hist.hist.slice();\r\n      bins.push({count: hist.missing});\r\n      const children = <HTMLElement[]>Array.from(n.children);\r\n\r\n      if (!gHist) {\r\n        const total = bins.reduce((acc, {count}) => acc + count, 0);\r\n\r\n        for (let i = 0; i < cats.length; ++i) {\r\n          const d = children[i];\r\n          const count = bins[i].count;\r\n          const label = cats[i].label;\r\n          d.style.flexGrow = `${round(total === 0 ? 0 : count, 2)}`;\r\n          d.title = `${label}: ${count}`;\r\n        }\r\n        return;\r\n      }\r\n\r\n      const gBins: {count: number}[] = gHist.hist.slice();\r\n      gBins.push({count: gHist.missing});\r\n      const total = gBins.reduce((acc, {count}) => acc + count, 9);\r\n\r\n      for (let i = 0; i < cats.length; ++i) {\r\n        const d = children[i];\r\n        const count = bins[i].count;\r\n        const label = cats[i].label;\r\n        const gCount = gBins[i].count;\r\n\r\n        d.style.flexGrow = `${round(total === 0 ? 0 : gCount, 2)}`;\r\n        d.title = `${label}: ${count} of ${gCount}`;\r\n        const relY = 100 - round(count * 100 / gCount, 2);\r\n        d.style.background = relY === 0 ? cats[i].color : (relY === 100 ? cats[i].selected : `linear-gradient(${cats[i].selected} ${relY}%, ${cats[i].color} ${relY}%, ${cats[i].color} 100%)`);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import {Column, isNumbersColumn, IDataRow, INumberColumn, isNumberColumn} from '../model';\r\nimport {colorOf} from './impose';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noRenderer, setText} from './utils';\r\nimport {cssClass} from '../styles';\r\n\r\nexport default class CircleCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Proportional Symbol';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\r\n  }\r\n\r\n  create(col: INumberColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    return {\r\n      template: `<div style=\"background: radial-gradient(circle closest-side, red 100%, transparent 100%)\" title=\"\">\r\n              <div class=\"${cssClass('hover-only')} ${cssClass('bar-label')}\"></div>\r\n          </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const v = col.getNumber(d);\r\n        const p = Math.round(v * 100);\r\n        const missing = renderMissingDOM(n, col, d);\r\n        n.style.background = missing ? null : `radial-gradient(circle closest-side, ${colorOf(col, d, imposer)} ${p}%, transparent ${p}%)`;\r\n        setText(n.firstElementChild!, col.getLabel(d));\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {GUESSES_GROUP_HEIGHT} from '../constants';\r\nimport {concatSeq, ISequence, round} from '../internal';\r\nimport {Column, DEFAULT_COLOR, IDataRow, INumberColumn, IOrderedGroup, isNumberColumn, isNumbersColumn} from '../model';\r\nimport {CANVAS_HEIGHT, DOT, cssClass} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {ERenderMode, ICellRendererFactory, IImposer, IRenderContext, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {noRenderer} from './utils';\r\n\r\n\r\nexport default class DotCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Dot';\r\n  readonly groupTitle: string = 'Dots';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumberColumn(col) && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  private static getCanvasRenderer(col: INumberColumn, context: IRenderContext) {\r\n    const width = context.colWidth(col);\r\n    const pi2 = Math.PI * 2;\r\n    const radius = DOT.size / 2;\r\n    const render = (ctx: CanvasRenderingContext2D, vs: {value: number, color: (string | null)}[], width: number) => {\r\n      ctx.save();\r\n      ctx.globalAlpha = DOT.opacity;\r\n      for (const v of vs) {\r\n        ctx.fillStyle = v.color || DOT.color;\r\n        const x = Math.min(width - radius, Math.max(radius, v.value * width));\r\n        const y = round(Math.random() * (GUESSES_GROUP_HEIGHT - DOT.size) + radius, 2);\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + radius, y);\r\n        ctx.arc(x, y, radius, 0, pi2, true);\r\n        ctx.fill();\r\n      }\r\n      ctx.restore();\r\n    };\r\n    return {\r\n      template: `<canvas height=\"${GUESSES_GROUP_HEIGHT}\"></canvas>`,\r\n      render,\r\n      width\r\n    };\r\n  }\r\n\r\n  private static getDOMRenderer(col: INumberColumn) {\r\n    const dots = isNumbersColumn(col) ? col.dataLength! : 1;\r\n    let tmp = '';\r\n    for (let i = 0; i < dots; ++i) {\r\n      tmp += `<div style='background-color: ${DEFAULT_COLOR}' title=''></div>`;\r\n    }\r\n\r\n    const update = (n: HTMLElement, data: ISequence<{value: number, label: string, color: string | null}>) => {\r\n      //adapt the number of children\r\n      const l = data.length;\r\n      if (n.children.length !== l) {\r\n        n.innerHTML = data.reduce((tmp, r) => {\r\n          return `${tmp}<div style='background-color: ${r.color}' title='${r.label}'></div>`;\r\n        }, '');\r\n      }\r\n      const children = n.children;\r\n      data.forEach((v, i) => {\r\n        const d = <HTMLElement>children[i];\r\n        d.title = v.label;\r\n        d.style.display = isNaN(v.value) ? 'none' : null;\r\n        d.style.left = `${round(v.value * 100, 2)}%`;\r\n        // jitter\r\n        d.style.top = l > 1 ? `${round(Math.random() * 80 + 10, 2)}%` : null;\r\n        d.style.backgroundColor = v.color;\r\n      });\r\n    };\r\n\r\n    const render = (ctx: CanvasRenderingContext2D, vs: number[], colors: (string | null)[], width: number) => {\r\n      ctx.save();\r\n      ctx.globalAlpha = DOT.opacity;\r\n      vs.forEach((v, i) => {\r\n        ctx.fillStyle = colors[i] || DOT.color;\r\n        ctx.fillRect(Math.max(0, v * width - DOT.size / 2), 0, DOT.size, CANVAS_HEIGHT);\r\n      });\r\n      ctx.restore();\r\n    };\r\n\r\n    return {template: `<div>${tmp}</div>`, update, render};\r\n  }\r\n\r\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const {template, render, update} = DotCellRenderer.getDOMRenderer(col);\r\n    const width = context.colWidth(col);\r\n    const formatter = col.getNumberFormat();\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        const color = colorOf(col, d, imposer);\r\n        if (!isNumbersColumn(col)) {\r\n          const v = col.getNumber(d);\r\n          return update(n, [{value: v, label: col.getLabel(d), color}]);\r\n        }\r\n        const data = col.getNumbers(d).filter((vi: number) => !isNaN(vi)).map((value) => ({value, label: formatter(value), color}));\r\n        return update(n, data);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        const color = colorOf(col, d, imposer);\r\n        if (!isNumbersColumn(col)) {\r\n          const v = col.getNumber(d);\r\n          return render(ctx, [v], [color], width);\r\n        }\r\n        const vs: number[] = col.getNumbers(d).filter((vi: number) => !isNaN(vi));\r\n        return render(ctx, vs, vs.map((_: any) => color), width);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\r\n    const {template, render, width} = DotCellRenderer.getCanvasRenderer(col, context);\r\n\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupRows(col, group, 'dot', (rows) => {\r\n          //value, color, label,\r\n\r\n          if (!isNumbersColumn(col)) {\r\n            return Array.from(rows.map((r) => ({value: col.getNumber(r), color: colorOf(col, r, imposer)})));\r\n          }\r\n          // concatenate all columns\r\n          const vs = rows.map((r) => {\r\n            const color = colorOf(col, r, imposer);\r\n            return col.getNumbers(r)\r\n              .filter((vi: number) => !isNaN(vi))\r\n              .map((value) => ({value, color}));\r\n          });\r\n          return Array.from(concatSeq(vs));\r\n        }).then((data) => {\r\n          if (typeof data === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = !data || data.length === 0 || data.every((v) => Number.isNaN(v.value));\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          const ctx = (<HTMLCanvasElement>n).getContext('2d')!;\r\n          ctx.canvas.width = width;\r\n          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n          render(ctx, data, width);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {Column, GroupColumn, IOrderedGroup, IGroup, defaultGroup, IDataRow} from '../model';\r\nimport {ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {noRenderer} from './utils';\r\n\r\n\r\nfunction isDummyGroup(group: IGroup) {\r\n  return group.parent == null && group.name === defaultGroup.name;\r\n}\r\n\r\nexport default class GroupCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof GroupColumn;\r\n  }\r\n\r\n  create(): ICellRenderer {\r\n    return {\r\n      template: `<div><div></div></div>`,\r\n      update(node: HTMLElement, _row: IDataRow, i: number, group: IOrderedGroup) {\r\n        (<HTMLElement>node.firstElementChild!).textContent = isDummyGroup(group) || i > 0 ? '' : `${group.name} (${group.order.length})`;\r\n      },\r\n      render(_ctx: CanvasRenderingContext2D, _row: IDataRow, i: number) {\r\n        return i === 0;\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return {\r\n      template: `<div><div></div></div>`,\r\n      update(node: HTMLElement, group: IOrderedGroup) {\r\n        (<HTMLElement>node.firstElementChild!).textContent = isDummyGroup(group) ? '' : `${group.name} (${group.order.length})`;\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDataRow, INumbersColumn, EAdvancedSortMethod, IOrderedGroup} from '../model';\r\nimport {IRenderContext, IImposer, ICellRenderer, IGroupCellRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {ISequence, boxplotBuilder, getSortLabel} from '../internal';\r\n\r\nexport abstract class ANumbersCellRenderer {\r\n  abstract readonly title: string;\r\n\r\n  protected abstract createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): {\r\n    clazz: string,\r\n    templateRow: string,\r\n    update: (row: HTMLElement, data: number[], raw: number[], d: IDataRow, tooltipPrefix?: string) => void,\r\n    render: (ctx: CanvasRenderingContext2D, data: number[], d: IDataRow) => void,\r\n  };\r\n\r\n  static choose(col: INumbersColumn, rows: ISequence<IDataRow>) {\r\n    let row: IDataRow | null = null;\r\n    const data = rows.map((r, i) => {\r\n      if (i === 0) {\r\n        row = r;\r\n      }\r\n      return {n: col.getNumbers(r), raw: col.getRawNumbers(r)};\r\n    });\r\n    const cols = col.dataLength!;\r\n    const normalized = <number[]>[];\r\n    const raw = <number[]>[];\r\n    // mean column)\r\n    for (let i = 0; i < cols; ++i) {\r\n      const vs = data.map((d) => ({n: d.n[i], raw: d.raw[i]})).filter((d) => !isNaN(d.n));\r\n      if (vs.length === 0) {\r\n        normalized.push(NaN);\r\n        raw.push(NaN);\r\n      } else {\r\n        const bbn = boxplotBuilder();\r\n        const bbr = boxplotBuilder();\r\n        const s: EAdvancedSortMethod = <any>col.getSortMethod();\r\n        vs.forEach((d) => {\r\n          bbn.push(d.n);\r\n          bbr.push(d.raw);\r\n        });\r\n        normalized.push(bbn.build()[s]!);\r\n        raw.push(bbr.build()[s]!);\r\n      }\r\n    }\r\n    return {normalized, raw, row};\r\n  }\r\n\r\n  create(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    const {templateRow, render, update, clazz} = this.createContext(col, context, imposer);\r\n    return {\r\n      template: `<div class=\"${clazz}\">${templateRow}</div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        update(n, col.getNumbers(d), col.getRawNumbers(d), d);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        render(ctx, col.getNumbers(d), d);\r\n      },\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\r\n    const {templateRow, update, clazz} = this.createContext(col, context, imposer);\r\n    return {\r\n      template: `<div class=\"${clazz}\">${templateRow}</div>`,\r\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\r\n        // render a heatmap\r\n        return context.tasks.groupRows(col, group, this.title, (rows) => ANumbersCellRenderer.choose(col, rows)).then((data) => {\r\n          if (typeof data !== 'symbol') {\r\n            update(n, data.normalized, data.raw, data.row!, `${getSortLabel(col.getSortMethod())} `);\r\n          }\r\n        });\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport function matchRows(n: HTMLElement | SVGElement, length: number, template: string) {\r\n  // first match the number of rows\r\n  const children = <(HTMLElement | SVGElement)[]>Array.from(n.children);\r\n  if (children.length > length) {\r\n    children.slice(length).forEach((c) => c.remove());\r\n  } else if (length > children.length) {\r\n    n.insertAdjacentHTML('beforeend', template.repeat(length - children.length));\r\n  }\r\n}\r\n","/**!\n * @fileOverview Kickass library to create and place poppers near their reference elements.\n * @version 1.15.0\n * @license\n * Copyright (c) 2016 Federico Zivolo and contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\n\nvar longerTimeoutBrowsers = ['Edge', 'Trident', 'Firefox'];\nvar timeoutDuration = 0;\nfor (var i = 0; i < longerTimeoutBrowsers.length; i += 1) {\n  if (isBrowser && navigator.userAgent.indexOf(longerTimeoutBrowsers[i]) >= 0) {\n    timeoutDuration = 1;\n    break;\n  }\n}\n\nfunction microtaskDebounce(fn) {\n  var called = false;\n  return function () {\n    if (called) {\n      return;\n    }\n    called = true;\n    window.Promise.resolve().then(function () {\n      called = false;\n      fn();\n    });\n  };\n}\n\nfunction taskDebounce(fn) {\n  var scheduled = false;\n  return function () {\n    if (!scheduled) {\n      scheduled = true;\n      setTimeout(function () {\n        scheduled = false;\n        fn();\n      }, timeoutDuration);\n    }\n  };\n}\n\nvar supportsMicroTasks = isBrowser && window.Promise;\n\n/**\n* Create a debounced version of a method, that's asynchronously deferred\n* but called in the minimum time possible.\n*\n* @method\n* @memberof Popper.Utils\n* @argument {Function} fn\n* @returns {Function}\n*/\nvar debounce = supportsMicroTasks ? microtaskDebounce : taskDebounce;\n\n/**\n * Check if the given variable is a function\n * @method\n * @memberof Popper.Utils\n * @argument {Any} functionToCheck - variable to check\n * @returns {Boolean} answer to: is a function?\n */\nfunction isFunction(functionToCheck) {\n  var getType = {};\n  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n}\n\n/**\n * Get CSS computed property of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Eement} element\n * @argument {String} property\n */\nfunction getStyleComputedProperty(element, property) {\n  if (element.nodeType !== 1) {\n    return [];\n  }\n  // NOTE: 1 DOM access here\n  var window = element.ownerDocument.defaultView;\n  var css = window.getComputedStyle(element, null);\n  return property ? css[property] : css;\n}\n\n/**\n * Returns the parentNode or the host of the element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} parent\n */\nfunction getParentNode(element) {\n  if (element.nodeName === 'HTML') {\n    return element;\n  }\n  return element.parentNode || element.host;\n}\n\n/**\n * Returns the scrolling parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} scroll parent\n */\nfunction getScrollParent(element) {\n  // Return body, `getScroll` will take care to get the correct `scrollTop` from it\n  if (!element) {\n    return document.body;\n  }\n\n  switch (element.nodeName) {\n    case 'HTML':\n    case 'BODY':\n      return element.ownerDocument.body;\n    case '#document':\n      return element.body;\n  }\n\n  // Firefox want us to check `-x` and `-y` variations as well\n\n  var _getStyleComputedProp = getStyleComputedProperty(element),\n      overflow = _getStyleComputedProp.overflow,\n      overflowX = _getStyleComputedProp.overflowX,\n      overflowY = _getStyleComputedProp.overflowY;\n\n  if (/(auto|scroll|overlay)/.test(overflow + overflowY + overflowX)) {\n    return element;\n  }\n\n  return getScrollParent(getParentNode(element));\n}\n\nvar isIE11 = isBrowser && !!(window.MSInputMethodContext && document.documentMode);\nvar isIE10 = isBrowser && /MSIE 10/.test(navigator.userAgent);\n\n/**\n * Determines if the browser is Internet Explorer\n * @method\n * @memberof Popper.Utils\n * @param {Number} version to check\n * @returns {Boolean} isIE\n */\nfunction isIE(version) {\n  if (version === 11) {\n    return isIE11;\n  }\n  if (version === 10) {\n    return isIE10;\n  }\n  return isIE11 || isIE10;\n}\n\n/**\n * Returns the offset parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} offset parent\n */\nfunction getOffsetParent(element) {\n  if (!element) {\n    return document.documentElement;\n  }\n\n  var noOffsetParent = isIE(10) ? document.body : null;\n\n  // NOTE: 1 DOM access here\n  var offsetParent = element.offsetParent || null;\n  // Skip hidden elements which don't have an offsetParent\n  while (offsetParent === noOffsetParent && element.nextElementSibling) {\n    offsetParent = (element = element.nextElementSibling).offsetParent;\n  }\n\n  var nodeName = offsetParent && offsetParent.nodeName;\n\n  if (!nodeName || nodeName === 'BODY' || nodeName === 'HTML') {\n    return element ? element.ownerDocument.documentElement : document.documentElement;\n  }\n\n  // .offsetParent will return the closest TH, TD or TABLE in case\n  // no offsetParent is present, I hate this job...\n  if (['TH', 'TD', 'TABLE'].indexOf(offsetParent.nodeName) !== -1 && getStyleComputedProperty(offsetParent, 'position') === 'static') {\n    return getOffsetParent(offsetParent);\n  }\n\n  return offsetParent;\n}\n\nfunction isOffsetContainer(element) {\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY') {\n    return false;\n  }\n  return nodeName === 'HTML' || getOffsetParent(element.firstElementChild) === element;\n}\n\n/**\n * Finds the root node (document, shadowDOM root) of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} node\n * @returns {Element} root node\n */\nfunction getRoot(node) {\n  if (node.parentNode !== null) {\n    return getRoot(node.parentNode);\n  }\n\n  return node;\n}\n\n/**\n * Finds the offset parent common to the two provided nodes\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element1\n * @argument {Element} element2\n * @returns {Element} common offset parent\n */\nfunction findCommonOffsetParent(element1, element2) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element1 || !element1.nodeType || !element2 || !element2.nodeType) {\n    return document.documentElement;\n  }\n\n  // Here we make sure to give as \"start\" the element that comes first in the DOM\n  var order = element1.compareDocumentPosition(element2) & Node.DOCUMENT_POSITION_FOLLOWING;\n  var start = order ? element1 : element2;\n  var end = order ? element2 : element1;\n\n  // Get common ancestor container\n  var range = document.createRange();\n  range.setStart(start, 0);\n  range.setEnd(end, 0);\n  var commonAncestorContainer = range.commonAncestorContainer;\n\n  // Both nodes are inside #document\n\n  if (element1 !== commonAncestorContainer && element2 !== commonAncestorContainer || start.contains(end)) {\n    if (isOffsetContainer(commonAncestorContainer)) {\n      return commonAncestorContainer;\n    }\n\n    return getOffsetParent(commonAncestorContainer);\n  }\n\n  // one of the nodes is inside shadowDOM, find which one\n  var element1root = getRoot(element1);\n  if (element1root.host) {\n    return findCommonOffsetParent(element1root.host, element2);\n  } else {\n    return findCommonOffsetParent(element1, getRoot(element2).host);\n  }\n}\n\n/**\n * Gets the scroll value of the given element in the given side (top and left)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {String} side `top` or `left`\n * @returns {number} amount of scrolled pixels\n */\nfunction getScroll(element) {\n  var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n  var upperSide = side === 'top' ? 'scrollTop' : 'scrollLeft';\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    var html = element.ownerDocument.documentElement;\n    var scrollingElement = element.ownerDocument.scrollingElement || html;\n    return scrollingElement[upperSide];\n  }\n\n  return element[upperSide];\n}\n\n/*\n * Sum or subtract the element scroll values (left and top) from a given rect object\n * @method\n * @memberof Popper.Utils\n * @param {Object} rect - Rect object you want to change\n * @param {HTMLElement} element - The element from the function reads the scroll values\n * @param {Boolean} subtract - set to true if you want to subtract the scroll values\n * @return {Object} rect - The modifier rect object\n */\nfunction includeScroll(rect, element) {\n  var subtract = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var scrollTop = getScroll(element, 'top');\n  var scrollLeft = getScroll(element, 'left');\n  var modifier = subtract ? -1 : 1;\n  rect.top += scrollTop * modifier;\n  rect.bottom += scrollTop * modifier;\n  rect.left += scrollLeft * modifier;\n  rect.right += scrollLeft * modifier;\n  return rect;\n}\n\n/*\n * Helper to detect borders of a given element\n * @method\n * @memberof Popper.Utils\n * @param {CSSStyleDeclaration} styles\n * Result of `getStyleComputedProperty` on the given element\n * @param {String} axis - `x` or `y`\n * @return {number} borders - The borders size of the given axis\n */\n\nfunction getBordersSize(styles, axis) {\n  var sideA = axis === 'x' ? 'Left' : 'Top';\n  var sideB = sideA === 'Left' ? 'Right' : 'Bottom';\n\n  return parseFloat(styles['border' + sideA + 'Width'], 10) + parseFloat(styles['border' + sideB + 'Width'], 10);\n}\n\nfunction getSize(axis, body, html, computedStyle) {\n  return Math.max(body['offset' + axis], body['scroll' + axis], html['client' + axis], html['offset' + axis], html['scroll' + axis], isIE(10) ? parseInt(html['offset' + axis]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Top' : 'Left')]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Bottom' : 'Right')]) : 0);\n}\n\nfunction getWindowSizes(document) {\n  var body = document.body;\n  var html = document.documentElement;\n  var computedStyle = isIE(10) && getComputedStyle(html);\n\n  return {\n    height: getSize('Height', body, html, computedStyle),\n    width: getSize('Width', body, html, computedStyle)\n  };\n}\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\nvar defineProperty = function (obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n/**\n * Given element offsets, generate an output similar to getBoundingClientRect\n * @method\n * @memberof Popper.Utils\n * @argument {Object} offsets\n * @returns {Object} ClientRect like output\n */\nfunction getClientRect(offsets) {\n  return _extends({}, offsets, {\n    right: offsets.left + offsets.width,\n    bottom: offsets.top + offsets.height\n  });\n}\n\n/**\n * Get bounding client rect of given element\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} element\n * @return {Object} client rect\n */\nfunction getBoundingClientRect(element) {\n  var rect = {};\n\n  // IE10 10 FIX: Please, don't ask, the element isn't\n  // considered in DOM in some circumstances...\n  // This isn't reproducible in IE10 compatibility mode of IE11\n  try {\n    if (isIE(10)) {\n      rect = element.getBoundingClientRect();\n      var scrollTop = getScroll(element, 'top');\n      var scrollLeft = getScroll(element, 'left');\n      rect.top += scrollTop;\n      rect.left += scrollLeft;\n      rect.bottom += scrollTop;\n      rect.right += scrollLeft;\n    } else {\n      rect = element.getBoundingClientRect();\n    }\n  } catch (e) {}\n\n  var result = {\n    left: rect.left,\n    top: rect.top,\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top\n  };\n\n  // subtract scrollbar size from sizes\n  var sizes = element.nodeName === 'HTML' ? getWindowSizes(element.ownerDocument) : {};\n  var width = sizes.width || element.clientWidth || result.right - result.left;\n  var height = sizes.height || element.clientHeight || result.bottom - result.top;\n\n  var horizScrollbar = element.offsetWidth - width;\n  var vertScrollbar = element.offsetHeight - height;\n\n  // if an hypothetical scrollbar is detected, we must be sure it's not a `border`\n  // we make this check conditional for performance reasons\n  if (horizScrollbar || vertScrollbar) {\n    var styles = getStyleComputedProperty(element);\n    horizScrollbar -= getBordersSize(styles, 'x');\n    vertScrollbar -= getBordersSize(styles, 'y');\n\n    result.width -= horizScrollbar;\n    result.height -= vertScrollbar;\n  }\n\n  return getClientRect(result);\n}\n\nfunction getOffsetRectRelativeToArbitraryNode(children, parent) {\n  var fixedPosition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var isIE10 = isIE(10);\n  var isHTML = parent.nodeName === 'HTML';\n  var childrenRect = getBoundingClientRect(children);\n  var parentRect = getBoundingClientRect(parent);\n  var scrollParent = getScrollParent(children);\n\n  var styles = getStyleComputedProperty(parent);\n  var borderTopWidth = parseFloat(styles.borderTopWidth, 10);\n  var borderLeftWidth = parseFloat(styles.borderLeftWidth, 10);\n\n  // In cases where the parent is fixed, we must ignore negative scroll in offset calc\n  if (fixedPosition && isHTML) {\n    parentRect.top = Math.max(parentRect.top, 0);\n    parentRect.left = Math.max(parentRect.left, 0);\n  }\n  var offsets = getClientRect({\n    top: childrenRect.top - parentRect.top - borderTopWidth,\n    left: childrenRect.left - parentRect.left - borderLeftWidth,\n    width: childrenRect.width,\n    height: childrenRect.height\n  });\n  offsets.marginTop = 0;\n  offsets.marginLeft = 0;\n\n  // Subtract margins of documentElement in case it's being used as parent\n  // we do this only on HTML because it's the only element that behaves\n  // differently when margins are applied to it. The margins are included in\n  // the box of the documentElement, in the other cases not.\n  if (!isIE10 && isHTML) {\n    var marginTop = parseFloat(styles.marginTop, 10);\n    var marginLeft = parseFloat(styles.marginLeft, 10);\n\n    offsets.top -= borderTopWidth - marginTop;\n    offsets.bottom -= borderTopWidth - marginTop;\n    offsets.left -= borderLeftWidth - marginLeft;\n    offsets.right -= borderLeftWidth - marginLeft;\n\n    // Attach marginTop and marginLeft because in some circumstances we may need them\n    offsets.marginTop = marginTop;\n    offsets.marginLeft = marginLeft;\n  }\n\n  if (isIE10 && !fixedPosition ? parent.contains(scrollParent) : parent === scrollParent && scrollParent.nodeName !== 'BODY') {\n    offsets = includeScroll(offsets, parent);\n  }\n\n  return offsets;\n}\n\nfunction getViewportOffsetRectRelativeToArtbitraryNode(element) {\n  var excludeScroll = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var html = element.ownerDocument.documentElement;\n  var relativeOffset = getOffsetRectRelativeToArbitraryNode(element, html);\n  var width = Math.max(html.clientWidth, window.innerWidth || 0);\n  var height = Math.max(html.clientHeight, window.innerHeight || 0);\n\n  var scrollTop = !excludeScroll ? getScroll(html) : 0;\n  var scrollLeft = !excludeScroll ? getScroll(html, 'left') : 0;\n\n  var offset = {\n    top: scrollTop - relativeOffset.top + relativeOffset.marginTop,\n    left: scrollLeft - relativeOffset.left + relativeOffset.marginLeft,\n    width: width,\n    height: height\n  };\n\n  return getClientRect(offset);\n}\n\n/**\n * Check if the given element is fixed or is inside a fixed parent\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {Element} customContainer\n * @returns {Boolean} answer to \"isFixed?\"\n */\nfunction isFixed(element) {\n  var nodeName = element.nodeName;\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    return false;\n  }\n  if (getStyleComputedProperty(element, 'position') === 'fixed') {\n    return true;\n  }\n  var parentNode = getParentNode(element);\n  if (!parentNode) {\n    return false;\n  }\n  return isFixed(parentNode);\n}\n\n/**\n * Finds the first parent of an element that has a transformed property defined\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} first transformed parent or documentElement\n */\n\nfunction getFixedPositionOffsetParent(element) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element || !element.parentElement || isIE()) {\n    return document.documentElement;\n  }\n  var el = element.parentElement;\n  while (el && getStyleComputedProperty(el, 'transform') === 'none') {\n    el = el.parentElement;\n  }\n  return el || document.documentElement;\n}\n\n/**\n * Computed the boundaries limits and return them\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} popper\n * @param {HTMLElement} reference\n * @param {number} padding\n * @param {HTMLElement} boundariesElement - Element used to define the boundaries\n * @param {Boolean} fixedPosition - Is in fixed position mode\n * @returns {Object} Coordinates of the boundaries\n */\nfunction getBoundaries(popper, reference, padding, boundariesElement) {\n  var fixedPosition = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n  // NOTE: 1 DOM access here\n\n  var boundaries = { top: 0, left: 0 };\n  var offsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n\n  // Handle viewport case\n  if (boundariesElement === 'viewport') {\n    boundaries = getViewportOffsetRectRelativeToArtbitraryNode(offsetParent, fixedPosition);\n  } else {\n    // Handle other cases based on DOM element used as boundaries\n    var boundariesNode = void 0;\n    if (boundariesElement === 'scrollParent') {\n      boundariesNode = getScrollParent(getParentNode(reference));\n      if (boundariesNode.nodeName === 'BODY') {\n        boundariesNode = popper.ownerDocument.documentElement;\n      }\n    } else if (boundariesElement === 'window') {\n      boundariesNode = popper.ownerDocument.documentElement;\n    } else {\n      boundariesNode = boundariesElement;\n    }\n\n    var offsets = getOffsetRectRelativeToArbitraryNode(boundariesNode, offsetParent, fixedPosition);\n\n    // In case of HTML, we need a different computation\n    if (boundariesNode.nodeName === 'HTML' && !isFixed(offsetParent)) {\n      var _getWindowSizes = getWindowSizes(popper.ownerDocument),\n          height = _getWindowSizes.height,\n          width = _getWindowSizes.width;\n\n      boundaries.top += offsets.top - offsets.marginTop;\n      boundaries.bottom = height + offsets.top;\n      boundaries.left += offsets.left - offsets.marginLeft;\n      boundaries.right = width + offsets.left;\n    } else {\n      // for all the other DOM elements, this one is good\n      boundaries = offsets;\n    }\n  }\n\n  // Add paddings\n  padding = padding || 0;\n  var isPaddingNumber = typeof padding === 'number';\n  boundaries.left += isPaddingNumber ? padding : padding.left || 0;\n  boundaries.top += isPaddingNumber ? padding : padding.top || 0;\n  boundaries.right -= isPaddingNumber ? padding : padding.right || 0;\n  boundaries.bottom -= isPaddingNumber ? padding : padding.bottom || 0;\n\n  return boundaries;\n}\n\nfunction getArea(_ref) {\n  var width = _ref.width,\n      height = _ref.height;\n\n  return width * height;\n}\n\n/**\n * Utility used to transform the `auto` placement to the placement with more\n * available space.\n * @method\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeAutoPlacement(placement, refRect, popper, reference, boundariesElement) {\n  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n  if (placement.indexOf('auto') === -1) {\n    return placement;\n  }\n\n  var boundaries = getBoundaries(popper, reference, padding, boundariesElement);\n\n  var rects = {\n    top: {\n      width: boundaries.width,\n      height: refRect.top - boundaries.top\n    },\n    right: {\n      width: boundaries.right - refRect.right,\n      height: boundaries.height\n    },\n    bottom: {\n      width: boundaries.width,\n      height: boundaries.bottom - refRect.bottom\n    },\n    left: {\n      width: refRect.left - boundaries.left,\n      height: boundaries.height\n    }\n  };\n\n  var sortedAreas = Object.keys(rects).map(function (key) {\n    return _extends({\n      key: key\n    }, rects[key], {\n      area: getArea(rects[key])\n    });\n  }).sort(function (a, b) {\n    return b.area - a.area;\n  });\n\n  var filteredAreas = sortedAreas.filter(function (_ref2) {\n    var width = _ref2.width,\n        height = _ref2.height;\n    return width >= popper.clientWidth && height >= popper.clientHeight;\n  });\n\n  var computedPlacement = filteredAreas.length > 0 ? filteredAreas[0].key : sortedAreas[0].key;\n\n  var variation = placement.split('-')[1];\n\n  return computedPlacement + (variation ? '-' + variation : '');\n}\n\n/**\n * Get offsets to the reference element\n * @method\n * @memberof Popper.Utils\n * @param {Object} state\n * @param {Element} popper - the popper element\n * @param {Element} reference - the reference element (the popper will be relative to this)\n * @param {Element} fixedPosition - is in fixed position mode\n * @returns {Object} An object containing the offsets which will be applied to the popper\n */\nfunction getReferenceOffsets(state, popper, reference) {\n  var fixedPosition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var commonOffsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n  return getOffsetRectRelativeToArbitraryNode(reference, commonOffsetParent, fixedPosition);\n}\n\n/**\n * Get the outer sizes of the given element (offset size + margins)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Object} object containing width and height properties\n */\nfunction getOuterSizes(element) {\n  var window = element.ownerDocument.defaultView;\n  var styles = window.getComputedStyle(element);\n  var x = parseFloat(styles.marginTop || 0) + parseFloat(styles.marginBottom || 0);\n  var y = parseFloat(styles.marginLeft || 0) + parseFloat(styles.marginRight || 0);\n  var result = {\n    width: element.offsetWidth + y,\n    height: element.offsetHeight + x\n  };\n  return result;\n}\n\n/**\n * Get the opposite placement of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement\n * @returns {String} flipped placement\n */\nfunction getOppositePlacement(placement) {\n  var hash = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' };\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}\n\n/**\n * Get offsets to the popper\n * @method\n * @memberof Popper.Utils\n * @param {Object} position - CSS position the Popper will get applied\n * @param {HTMLElement} popper - the popper element\n * @param {Object} referenceOffsets - the reference offsets (the popper will be relative to this)\n * @param {String} placement - one of the valid placement options\n * @returns {Object} popperOffsets - An object containing the offsets which will be applied to the popper\n */\nfunction getPopperOffsets(popper, referenceOffsets, placement) {\n  placement = placement.split('-')[0];\n\n  // Get popper node sizes\n  var popperRect = getOuterSizes(popper);\n\n  // Add position, width and height to our offsets object\n  var popperOffsets = {\n    width: popperRect.width,\n    height: popperRect.height\n  };\n\n  // depending by the popper placement we have to compute its offsets slightly differently\n  var isHoriz = ['right', 'left'].indexOf(placement) !== -1;\n  var mainSide = isHoriz ? 'top' : 'left';\n  var secondarySide = isHoriz ? 'left' : 'top';\n  var measurement = isHoriz ? 'height' : 'width';\n  var secondaryMeasurement = !isHoriz ? 'height' : 'width';\n\n  popperOffsets[mainSide] = referenceOffsets[mainSide] + referenceOffsets[measurement] / 2 - popperRect[measurement] / 2;\n  if (placement === secondarySide) {\n    popperOffsets[secondarySide] = referenceOffsets[secondarySide] - popperRect[secondaryMeasurement];\n  } else {\n    popperOffsets[secondarySide] = referenceOffsets[getOppositePlacement(secondarySide)];\n  }\n\n  return popperOffsets;\n}\n\n/**\n * Mimics the `find` method of Array\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction find(arr, check) {\n  // use native find if supported\n  if (Array.prototype.find) {\n    return arr.find(check);\n  }\n\n  // use `filter` to obtain the same behavior of `find`\n  return arr.filter(check)[0];\n}\n\n/**\n * Return the index of the matching object\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction findIndex(arr, prop, value) {\n  // use native findIndex if supported\n  if (Array.prototype.findIndex) {\n    return arr.findIndex(function (cur) {\n      return cur[prop] === value;\n    });\n  }\n\n  // use `find` + `indexOf` if `findIndex` isn't supported\n  var match = find(arr, function (obj) {\n    return obj[prop] === value;\n  });\n  return arr.indexOf(match);\n}\n\n/**\n * Loop trough the list of modifiers and run them in order,\n * each of them will then edit the data object.\n * @method\n * @memberof Popper.Utils\n * @param {dataObject} data\n * @param {Array} modifiers\n * @param {String} ends - Optional modifier name used as stopper\n * @returns {dataObject}\n */\nfunction runModifiers(modifiers, data, ends) {\n  var modifiersToRun = ends === undefined ? modifiers : modifiers.slice(0, findIndex(modifiers, 'name', ends));\n\n  modifiersToRun.forEach(function (modifier) {\n    if (modifier['function']) {\n      // eslint-disable-line dot-notation\n      console.warn('`modifier.function` is deprecated, use `modifier.fn`!');\n    }\n    var fn = modifier['function'] || modifier.fn; // eslint-disable-line dot-notation\n    if (modifier.enabled && isFunction(fn)) {\n      // Add properties to offsets to make them a complete clientRect object\n      // we do this before each modifier to make sure the previous one doesn't\n      // mess with these values\n      data.offsets.popper = getClientRect(data.offsets.popper);\n      data.offsets.reference = getClientRect(data.offsets.reference);\n\n      data = fn(data, modifier);\n    }\n  });\n\n  return data;\n}\n\n/**\n * Updates the position of the popper, computing the new offsets and applying\n * the new style.<br />\n * Prefer `scheduleUpdate` over `update` because of performance reasons.\n * @method\n * @memberof Popper\n */\nfunction update() {\n  // if popper is destroyed, don't perform any further update\n  if (this.state.isDestroyed) {\n    return;\n  }\n\n  var data = {\n    instance: this,\n    styles: {},\n    arrowStyles: {},\n    attributes: {},\n    flipped: false,\n    offsets: {}\n  };\n\n  // compute reference element offsets\n  data.offsets.reference = getReferenceOffsets(this.state, this.popper, this.reference, this.options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  data.placement = computeAutoPlacement(this.options.placement, data.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding);\n\n  // store the computed placement inside `originalPlacement`\n  data.originalPlacement = data.placement;\n\n  data.positionFixed = this.options.positionFixed;\n\n  // compute the popper offsets\n  data.offsets.popper = getPopperOffsets(this.popper, data.offsets.reference, data.placement);\n\n  data.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute';\n\n  // run the modifiers\n  data = runModifiers(this.modifiers, data);\n\n  // the first `update` will call `onCreate` callback\n  // the other ones will call `onUpdate` callback\n  if (!this.state.isCreated) {\n    this.state.isCreated = true;\n    this.options.onCreate(data);\n  } else {\n    this.options.onUpdate(data);\n  }\n}\n\n/**\n * Helper used to know if the given modifier is enabled.\n * @method\n * @memberof Popper.Utils\n * @returns {Boolean}\n */\nfunction isModifierEnabled(modifiers, modifierName) {\n  return modifiers.some(function (_ref) {\n    var name = _ref.name,\n        enabled = _ref.enabled;\n    return enabled && name === modifierName;\n  });\n}\n\n/**\n * Get the prefixed supported property name\n * @method\n * @memberof Popper.Utils\n * @argument {String} property (camelCase)\n * @returns {String} prefixed property (camelCase or PascalCase, depending on the vendor prefix)\n */\nfunction getSupportedPropertyName(property) {\n  var prefixes = [false, 'ms', 'Webkit', 'Moz', 'O'];\n  var upperProp = property.charAt(0).toUpperCase() + property.slice(1);\n\n  for (var i = 0; i < prefixes.length; i++) {\n    var prefix = prefixes[i];\n    var toCheck = prefix ? '' + prefix + upperProp : property;\n    if (typeof document.body.style[toCheck] !== 'undefined') {\n      return toCheck;\n    }\n  }\n  return null;\n}\n\n/**\n * Destroys the popper.\n * @method\n * @memberof Popper\n */\nfunction destroy() {\n  this.state.isDestroyed = true;\n\n  // touch DOM only if `applyStyle` modifier is enabled\n  if (isModifierEnabled(this.modifiers, 'applyStyle')) {\n    this.popper.removeAttribute('x-placement');\n    this.popper.style.position = '';\n    this.popper.style.top = '';\n    this.popper.style.left = '';\n    this.popper.style.right = '';\n    this.popper.style.bottom = '';\n    this.popper.style.willChange = '';\n    this.popper.style[getSupportedPropertyName('transform')] = '';\n  }\n\n  this.disableEventListeners();\n\n  // remove the popper if user explicity asked for the deletion on destroy\n  // do not use `remove` because IE11 doesn't support it\n  if (this.options.removeOnDestroy) {\n    this.popper.parentNode.removeChild(this.popper);\n  }\n  return this;\n}\n\n/**\n * Get the window associated with the element\n * @argument {Element} element\n * @returns {Window}\n */\nfunction getWindow(element) {\n  var ownerDocument = element.ownerDocument;\n  return ownerDocument ? ownerDocument.defaultView : window;\n}\n\nfunction attachToScrollParents(scrollParent, event, callback, scrollParents) {\n  var isBody = scrollParent.nodeName === 'BODY';\n  var target = isBody ? scrollParent.ownerDocument.defaultView : scrollParent;\n  target.addEventListener(event, callback, { passive: true });\n\n  if (!isBody) {\n    attachToScrollParents(getScrollParent(target.parentNode), event, callback, scrollParents);\n  }\n  scrollParents.push(target);\n}\n\n/**\n * Setup needed event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction setupEventListeners(reference, options, state, updateBound) {\n  // Resize event listener on window\n  state.updateBound = updateBound;\n  getWindow(reference).addEventListener('resize', state.updateBound, { passive: true });\n\n  // Scroll event listener on scroll parents\n  var scrollElement = getScrollParent(reference);\n  attachToScrollParents(scrollElement, 'scroll', state.updateBound, state.scrollParents);\n  state.scrollElement = scrollElement;\n  state.eventsEnabled = true;\n\n  return state;\n}\n\n/**\n * It will add resize/scroll events and start recalculating\n * position of the popper element when they are triggered.\n * @method\n * @memberof Popper\n */\nfunction enableEventListeners() {\n  if (!this.state.eventsEnabled) {\n    this.state = setupEventListeners(this.reference, this.options, this.state, this.scheduleUpdate);\n  }\n}\n\n/**\n * Remove event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction removeEventListeners(reference, state) {\n  // Remove resize event listener on window\n  getWindow(reference).removeEventListener('resize', state.updateBound);\n\n  // Remove scroll event listener on scroll parents\n  state.scrollParents.forEach(function (target) {\n    target.removeEventListener('scroll', state.updateBound);\n  });\n\n  // Reset state\n  state.updateBound = null;\n  state.scrollParents = [];\n  state.scrollElement = null;\n  state.eventsEnabled = false;\n  return state;\n}\n\n/**\n * It will remove resize/scroll events and won't recalculate popper position\n * when they are triggered. It also won't trigger `onUpdate` callback anymore,\n * unless you call `update` method manually.\n * @method\n * @memberof Popper\n */\nfunction disableEventListeners() {\n  if (this.state.eventsEnabled) {\n    cancelAnimationFrame(this.scheduleUpdate);\n    this.state = removeEventListeners(this.reference, this.state);\n  }\n}\n\n/**\n * Tells if a given input is a number\n * @method\n * @memberof Popper.Utils\n * @param {*} input to check\n * @return {Boolean}\n */\nfunction isNumeric(n) {\n  return n !== '' && !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * Set the style to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the style to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setStyles(element, styles) {\n  Object.keys(styles).forEach(function (prop) {\n    var unit = '';\n    // add unit if the value is numeric and is one of the following\n    if (['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(prop) !== -1 && isNumeric(styles[prop])) {\n      unit = 'px';\n    }\n    element.style[prop] = styles[prop] + unit;\n  });\n}\n\n/**\n * Set the attributes to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the attributes to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setAttributes(element, attributes) {\n  Object.keys(attributes).forEach(function (prop) {\n    var value = attributes[prop];\n    if (value !== false) {\n      element.setAttribute(prop, attributes[prop]);\n    } else {\n      element.removeAttribute(prop);\n    }\n  });\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} data.styles - List of style properties - values to apply to popper element\n * @argument {Object} data.attributes - List of attribute properties - values to apply to popper element\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The same data object\n */\nfunction applyStyle(data) {\n  // any property present in `data.styles` will be applied to the popper,\n  // in this way we can make the 3rd party modifiers add custom styles to it\n  // Be aware, modifiers could override the properties defined in the previous\n  // lines of this modifier!\n  setStyles(data.instance.popper, data.styles);\n\n  // any property present in `data.attributes` will be applied to the popper,\n  // they will be set as HTML attributes of the element\n  setAttributes(data.instance.popper, data.attributes);\n\n  // if arrowElement is defined and arrowStyles has some properties\n  if (data.arrowElement && Object.keys(data.arrowStyles).length) {\n    setStyles(data.arrowElement, data.arrowStyles);\n  }\n\n  return data;\n}\n\n/**\n * Set the x-placement attribute before everything else because it could be used\n * to add margins to the popper margins needs to be calculated to get the\n * correct popper offsets.\n * @method\n * @memberof Popper.modifiers\n * @param {HTMLElement} reference - The reference element used to position the popper\n * @param {HTMLElement} popper - The HTML element used as popper\n * @param {Object} options - Popper.js options\n */\nfunction applyStyleOnLoad(reference, popper, options, modifierOptions, state) {\n  // compute reference element offsets\n  var referenceOffsets = getReferenceOffsets(state, popper, reference, options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  var placement = computeAutoPlacement(options.placement, referenceOffsets, popper, reference, options.modifiers.flip.boundariesElement, options.modifiers.flip.padding);\n\n  popper.setAttribute('x-placement', placement);\n\n  // Apply `position` to popper before anything else because\n  // without the position applied we can't guarantee correct computations\n  setStyles(popper, { position: options.positionFixed ? 'fixed' : 'absolute' });\n\n  return options;\n}\n\n/**\n * @function\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Boolean} shouldRound - If the offsets should be rounded at all\n * @returns {Object} The popper's position offsets rounded\n *\n * The tale of pixel-perfect positioning. It's still not 100% perfect, but as\n * good as it can be within reason.\n * Discussion here: https://github.com/FezVrasta/popper.js/pull/715\n *\n * Low DPI screens cause a popper to be blurry if not using full pixels (Safari\n * as well on High DPI screens).\n *\n * Firefox prefers no rounding for positioning and does not have blurriness on\n * high DPI screens.\n *\n * Only horizontal placement and left/right values need to be considered.\n */\nfunction getRoundedOffsets(data, shouldRound) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n  var round = Math.round,\n      floor = Math.floor;\n\n  var noRound = function noRound(v) {\n    return v;\n  };\n\n  var referenceWidth = round(reference.width);\n  var popperWidth = round(popper.width);\n\n  var isVertical = ['left', 'right'].indexOf(data.placement) !== -1;\n  var isVariation = data.placement.indexOf('-') !== -1;\n  var sameWidthParity = referenceWidth % 2 === popperWidth % 2;\n  var bothOddWidth = referenceWidth % 2 === 1 && popperWidth % 2 === 1;\n\n  var horizontalToInteger = !shouldRound ? noRound : isVertical || isVariation || sameWidthParity ? round : floor;\n  var verticalToInteger = !shouldRound ? noRound : round;\n\n  return {\n    left: horizontalToInteger(bothOddWidth && !isVariation && shouldRound ? popper.left - 1 : popper.left),\n    top: verticalToInteger(popper.top),\n    bottom: verticalToInteger(popper.bottom),\n    right: horizontalToInteger(popper.right)\n  };\n}\n\nvar isFirefox = isBrowser && /Firefox/i.test(navigator.userAgent);\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeStyle(data, options) {\n  var x = options.x,\n      y = options.y;\n  var popper = data.offsets.popper;\n\n  // Remove this legacy support in Popper.js v2\n\n  var legacyGpuAccelerationOption = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'applyStyle';\n  }).gpuAcceleration;\n  if (legacyGpuAccelerationOption !== undefined) {\n    console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');\n  }\n  var gpuAcceleration = legacyGpuAccelerationOption !== undefined ? legacyGpuAccelerationOption : options.gpuAcceleration;\n\n  var offsetParent = getOffsetParent(data.instance.popper);\n  var offsetParentRect = getBoundingClientRect(offsetParent);\n\n  // Styles\n  var styles = {\n    position: popper.position\n  };\n\n  var offsets = getRoundedOffsets(data, window.devicePixelRatio < 2 || !isFirefox);\n\n  var sideA = x === 'bottom' ? 'top' : 'bottom';\n  var sideB = y === 'right' ? 'left' : 'right';\n\n  // if gpuAcceleration is set to `true` and transform is supported,\n  //  we use `translate3d` to apply the position to the popper we\n  // automatically use the supported prefixed version if needed\n  var prefixedProperty = getSupportedPropertyName('transform');\n\n  // now, let's make a step back and look at this code closely (wtf?)\n  // If the content of the popper grows once it's been positioned, it\n  // may happen that the popper gets misplaced because of the new content\n  // overflowing its reference element\n  // To avoid this problem, we provide two options (x and y), which allow\n  // the consumer to define the offset origin.\n  // If we position a popper on top of a reference element, we can set\n  // `x` to `top` to make the popper grow towards its top instead of\n  // its bottom.\n  var left = void 0,\n      top = void 0;\n  if (sideA === 'bottom') {\n    // when offsetParent is <html> the positioning is relative to the bottom of the screen (excluding the scrollbar)\n    // and not the bottom of the html element\n    if (offsetParent.nodeName === 'HTML') {\n      top = -offsetParent.clientHeight + offsets.bottom;\n    } else {\n      top = -offsetParentRect.height + offsets.bottom;\n    }\n  } else {\n    top = offsets.top;\n  }\n  if (sideB === 'right') {\n    if (offsetParent.nodeName === 'HTML') {\n      left = -offsetParent.clientWidth + offsets.right;\n    } else {\n      left = -offsetParentRect.width + offsets.right;\n    }\n  } else {\n    left = offsets.left;\n  }\n  if (gpuAcceleration && prefixedProperty) {\n    styles[prefixedProperty] = 'translate3d(' + left + 'px, ' + top + 'px, 0)';\n    styles[sideA] = 0;\n    styles[sideB] = 0;\n    styles.willChange = 'transform';\n  } else {\n    // othwerise, we use the standard `top`, `left`, `bottom` and `right` properties\n    var invertTop = sideA === 'bottom' ? -1 : 1;\n    var invertLeft = sideB === 'right' ? -1 : 1;\n    styles[sideA] = top * invertTop;\n    styles[sideB] = left * invertLeft;\n    styles.willChange = sideA + ', ' + sideB;\n  }\n\n  // Attributes\n  var attributes = {\n    'x-placement': data.placement\n  };\n\n  // Update `data` attributes, styles and arrowStyles\n  data.attributes = _extends({}, attributes, data.attributes);\n  data.styles = _extends({}, styles, data.styles);\n  data.arrowStyles = _extends({}, data.offsets.arrow, data.arrowStyles);\n\n  return data;\n}\n\n/**\n * Helper used to know if the given modifier depends from another one.<br />\n * It checks if the needed modifier is listed and enabled.\n * @method\n * @memberof Popper.Utils\n * @param {Array} modifiers - list of modifiers\n * @param {String} requestingName - name of requesting modifier\n * @param {String} requestedName - name of requested modifier\n * @returns {Boolean}\n */\nfunction isModifierRequired(modifiers, requestingName, requestedName) {\n  var requesting = find(modifiers, function (_ref) {\n    var name = _ref.name;\n    return name === requestingName;\n  });\n\n  var isRequired = !!requesting && modifiers.some(function (modifier) {\n    return modifier.name === requestedName && modifier.enabled && modifier.order < requesting.order;\n  });\n\n  if (!isRequired) {\n    var _requesting = '`' + requestingName + '`';\n    var requested = '`' + requestedName + '`';\n    console.warn(requested + ' modifier is required by ' + _requesting + ' modifier in order to work, be sure to include it before ' + _requesting + '!');\n  }\n  return isRequired;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction arrow(data, options) {\n  var _data$offsets$arrow;\n\n  // arrow depends on keepTogether in order to work\n  if (!isModifierRequired(data.instance.modifiers, 'arrow', 'keepTogether')) {\n    return data;\n  }\n\n  var arrowElement = options.element;\n\n  // if arrowElement is a string, suppose it's a CSS selector\n  if (typeof arrowElement === 'string') {\n    arrowElement = data.instance.popper.querySelector(arrowElement);\n\n    // if arrowElement is not found, don't run the modifier\n    if (!arrowElement) {\n      return data;\n    }\n  } else {\n    // if the arrowElement isn't a query selector we must check that the\n    // provided DOM node is child of its popper node\n    if (!data.instance.popper.contains(arrowElement)) {\n      console.warn('WARNING: `arrow.element` must be child of its popper element!');\n      return data;\n    }\n  }\n\n  var placement = data.placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isVertical = ['left', 'right'].indexOf(placement) !== -1;\n\n  var len = isVertical ? 'height' : 'width';\n  var sideCapitalized = isVertical ? 'Top' : 'Left';\n  var side = sideCapitalized.toLowerCase();\n  var altSide = isVertical ? 'left' : 'top';\n  var opSide = isVertical ? 'bottom' : 'right';\n  var arrowElementSize = getOuterSizes(arrowElement)[len];\n\n  //\n  // extends keepTogether behavior making sure the popper and its\n  // reference have enough pixels in conjunction\n  //\n\n  // top/left side\n  if (reference[opSide] - arrowElementSize < popper[side]) {\n    data.offsets.popper[side] -= popper[side] - (reference[opSide] - arrowElementSize);\n  }\n  // bottom/right side\n  if (reference[side] + arrowElementSize > popper[opSide]) {\n    data.offsets.popper[side] += reference[side] + arrowElementSize - popper[opSide];\n  }\n  data.offsets.popper = getClientRect(data.offsets.popper);\n\n  // compute center of the popper\n  var center = reference[side] + reference[len] / 2 - arrowElementSize / 2;\n\n  // Compute the sideValue using the updated popper offsets\n  // take popper margin in account because we don't have this info available\n  var css = getStyleComputedProperty(data.instance.popper);\n  var popperMarginSide = parseFloat(css['margin' + sideCapitalized], 10);\n  var popperBorderSide = parseFloat(css['border' + sideCapitalized + 'Width'], 10);\n  var sideValue = center - data.offsets.popper[side] - popperMarginSide - popperBorderSide;\n\n  // prevent arrowElement from being placed not contiguously to its popper\n  sideValue = Math.max(Math.min(popper[len] - arrowElementSize, sideValue), 0);\n\n  data.arrowElement = arrowElement;\n  data.offsets.arrow = (_data$offsets$arrow = {}, defineProperty(_data$offsets$arrow, side, Math.round(sideValue)), defineProperty(_data$offsets$arrow, altSide, ''), _data$offsets$arrow);\n\n  return data;\n}\n\n/**\n * Get the opposite placement variation of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement variation\n * @returns {String} flipped placement variation\n */\nfunction getOppositeVariation(variation) {\n  if (variation === 'end') {\n    return 'start';\n  } else if (variation === 'start') {\n    return 'end';\n  }\n  return variation;\n}\n\n/**\n * List of accepted placements to use as values of the `placement` option.<br />\n * Valid placements are:\n * - `auto`\n * - `top`\n * - `right`\n * - `bottom`\n * - `left`\n *\n * Each placement can have a variation from this list:\n * - `-start`\n * - `-end`\n *\n * Variations are interpreted easily if you think of them as the left to right\n * written languages. Horizontally (`top` and `bottom`), `start` is left and `end`\n * is right.<br />\n * Vertically (`left` and `right`), `start` is top and `end` is bottom.\n *\n * Some valid examples are:\n * - `top-end` (on top of reference, right aligned)\n * - `right-start` (on right of reference, top aligned)\n * - `bottom` (on bottom, centered)\n * - `auto-end` (on the side with more space available, alignment depends by placement)\n *\n * @static\n * @type {Array}\n * @enum {String}\n * @readonly\n * @method placements\n * @memberof Popper\n */\nvar placements = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'];\n\n// Get rid of `auto` `auto-start` and `auto-end`\nvar validPlacements = placements.slice(3);\n\n/**\n * Given an initial placement, returns all the subsequent placements\n * clockwise (or counter-clockwise).\n *\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement - A valid placement (it accepts variations)\n * @argument {Boolean} counter - Set to true to walk the placements counterclockwise\n * @returns {Array} placements including their variations\n */\nfunction clockwise(placement) {\n  var counter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var index = validPlacements.indexOf(placement);\n  var arr = validPlacements.slice(index + 1).concat(validPlacements.slice(0, index));\n  return counter ? arr.reverse() : arr;\n}\n\nvar BEHAVIORS = {\n  FLIP: 'flip',\n  CLOCKWISE: 'clockwise',\n  COUNTERCLOCKWISE: 'counterclockwise'\n};\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction flip(data, options) {\n  // if `inner` modifier is enabled, we can't use the `flip` modifier\n  if (isModifierEnabled(data.instance.modifiers, 'inner')) {\n    return data;\n  }\n\n  if (data.flipped && data.placement === data.originalPlacement) {\n    // seems like flip is trying to loop, probably there's not enough space on any of the flippable sides\n    return data;\n  }\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, options.boundariesElement, data.positionFixed);\n\n  var placement = data.placement.split('-')[0];\n  var placementOpposite = getOppositePlacement(placement);\n  var variation = data.placement.split('-')[1] || '';\n\n  var flipOrder = [];\n\n  switch (options.behavior) {\n    case BEHAVIORS.FLIP:\n      flipOrder = [placement, placementOpposite];\n      break;\n    case BEHAVIORS.CLOCKWISE:\n      flipOrder = clockwise(placement);\n      break;\n    case BEHAVIORS.COUNTERCLOCKWISE:\n      flipOrder = clockwise(placement, true);\n      break;\n    default:\n      flipOrder = options.behavior;\n  }\n\n  flipOrder.forEach(function (step, index) {\n    if (placement !== step || flipOrder.length === index + 1) {\n      return data;\n    }\n\n    placement = data.placement.split('-')[0];\n    placementOpposite = getOppositePlacement(placement);\n\n    var popperOffsets = data.offsets.popper;\n    var refOffsets = data.offsets.reference;\n\n    // using floor because the reference offsets may contain decimals we are not going to consider here\n    var floor = Math.floor;\n    var overlapsRef = placement === 'left' && floor(popperOffsets.right) > floor(refOffsets.left) || placement === 'right' && floor(popperOffsets.left) < floor(refOffsets.right) || placement === 'top' && floor(popperOffsets.bottom) > floor(refOffsets.top) || placement === 'bottom' && floor(popperOffsets.top) < floor(refOffsets.bottom);\n\n    var overflowsLeft = floor(popperOffsets.left) < floor(boundaries.left);\n    var overflowsRight = floor(popperOffsets.right) > floor(boundaries.right);\n    var overflowsTop = floor(popperOffsets.top) < floor(boundaries.top);\n    var overflowsBottom = floor(popperOffsets.bottom) > floor(boundaries.bottom);\n\n    var overflowsBoundaries = placement === 'left' && overflowsLeft || placement === 'right' && overflowsRight || placement === 'top' && overflowsTop || placement === 'bottom' && overflowsBottom;\n\n    // flip the variation if required\n    var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n\n    // flips variation if reference element overflows boundaries\n    var flippedVariationByRef = !!options.flipVariations && (isVertical && variation === 'start' && overflowsLeft || isVertical && variation === 'end' && overflowsRight || !isVertical && variation === 'start' && overflowsTop || !isVertical && variation === 'end' && overflowsBottom);\n\n    // flips variation if popper content overflows boundaries\n    var flippedVariationByContent = !!options.flipVariationsByContent && (isVertical && variation === 'start' && overflowsRight || isVertical && variation === 'end' && overflowsLeft || !isVertical && variation === 'start' && overflowsBottom || !isVertical && variation === 'end' && overflowsTop);\n\n    var flippedVariation = flippedVariationByRef || flippedVariationByContent;\n\n    if (overlapsRef || overflowsBoundaries || flippedVariation) {\n      // this boolean to detect any flip loop\n      data.flipped = true;\n\n      if (overlapsRef || overflowsBoundaries) {\n        placement = flipOrder[index + 1];\n      }\n\n      if (flippedVariation) {\n        variation = getOppositeVariation(variation);\n      }\n\n      data.placement = placement + (variation ? '-' + variation : '');\n\n      // this object contains `position`, we want to preserve it along with\n      // any additional property we may add in the future\n      data.offsets.popper = _extends({}, data.offsets.popper, getPopperOffsets(data.instance.popper, data.offsets.reference, data.placement));\n\n      data = runModifiers(data.instance.modifiers, data, 'flip');\n    }\n  });\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction keepTogether(data) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var placement = data.placement.split('-')[0];\n  var floor = Math.floor;\n  var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n  var side = isVertical ? 'right' : 'bottom';\n  var opSide = isVertical ? 'left' : 'top';\n  var measurement = isVertical ? 'width' : 'height';\n\n  if (popper[side] < floor(reference[opSide])) {\n    data.offsets.popper[opSide] = floor(reference[opSide]) - popper[measurement];\n  }\n  if (popper[opSide] > floor(reference[side])) {\n    data.offsets.popper[opSide] = floor(reference[side]);\n  }\n\n  return data;\n}\n\n/**\n * Converts a string containing value + unit into a px value number\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} str - Value + unit string\n * @argument {String} measurement - `height` or `width`\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @returns {Number|String}\n * Value in pixels, or original string if no values were extracted\n */\nfunction toValue(str, measurement, popperOffsets, referenceOffsets) {\n  // separate value from unit\n  var split = str.match(/((?:\\-|\\+)?\\d*\\.?\\d*)(.*)/);\n  var value = +split[1];\n  var unit = split[2];\n\n  // If it's not a number it's an operator, I guess\n  if (!value) {\n    return str;\n  }\n\n  if (unit.indexOf('%') === 0) {\n    var element = void 0;\n    switch (unit) {\n      case '%p':\n        element = popperOffsets;\n        break;\n      case '%':\n      case '%r':\n      default:\n        element = referenceOffsets;\n    }\n\n    var rect = getClientRect(element);\n    return rect[measurement] / 100 * value;\n  } else if (unit === 'vh' || unit === 'vw') {\n    // if is a vh or vw, we calculate the size based on the viewport\n    var size = void 0;\n    if (unit === 'vh') {\n      size = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    } else {\n      size = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n    }\n    return size / 100 * value;\n  } else {\n    // if is an explicit pixel unit, we get rid of the unit and keep the value\n    // if is an implicit unit, it's px, and we return just the value\n    return value;\n  }\n}\n\n/**\n * Parse an `offset` string to extrapolate `x` and `y` numeric offsets.\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} offset\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @argument {String} basePlacement\n * @returns {Array} a two cells array with x and y offsets in numbers\n */\nfunction parseOffset(offset, popperOffsets, referenceOffsets, basePlacement) {\n  var offsets = [0, 0];\n\n  // Use height if placement is left or right and index is 0 otherwise use width\n  // in this way the first offset will use an axis and the second one\n  // will use the other one\n  var useHeight = ['right', 'left'].indexOf(basePlacement) !== -1;\n\n  // Split the offset string to obtain a list of values and operands\n  // The regex addresses values with the plus or minus sign in front (+10, -20, etc)\n  var fragments = offset.split(/(\\+|\\-)/).map(function (frag) {\n    return frag.trim();\n  });\n\n  // Detect if the offset string contains a pair of values or a single one\n  // they could be separated by comma or space\n  var divider = fragments.indexOf(find(fragments, function (frag) {\n    return frag.search(/,|\\s/) !== -1;\n  }));\n\n  if (fragments[divider] && fragments[divider].indexOf(',') === -1) {\n    console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');\n  }\n\n  // If divider is found, we divide the list of values and operands to divide\n  // them by ofset X and Y.\n  var splitRegex = /\\s*,\\s*|\\s+/;\n  var ops = divider !== -1 ? [fragments.slice(0, divider).concat([fragments[divider].split(splitRegex)[0]]), [fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider + 1))] : [fragments];\n\n  // Convert the values with units to absolute pixels to allow our computations\n  ops = ops.map(function (op, index) {\n    // Most of the units rely on the orientation of the popper\n    var measurement = (index === 1 ? !useHeight : useHeight) ? 'height' : 'width';\n    var mergeWithPrevious = false;\n    return op\n    // This aggregates any `+` or `-` sign that aren't considered operators\n    // e.g.: 10 + +5 => [10, +, +5]\n    .reduce(function (a, b) {\n      if (a[a.length - 1] === '' && ['+', '-'].indexOf(b) !== -1) {\n        a[a.length - 1] = b;\n        mergeWithPrevious = true;\n        return a;\n      } else if (mergeWithPrevious) {\n        a[a.length - 1] += b;\n        mergeWithPrevious = false;\n        return a;\n      } else {\n        return a.concat(b);\n      }\n    }, [])\n    // Here we convert the string values into number values (in px)\n    .map(function (str) {\n      return toValue(str, measurement, popperOffsets, referenceOffsets);\n    });\n  });\n\n  // Loop trough the offsets arrays and execute the operations\n  ops.forEach(function (op, index) {\n    op.forEach(function (frag, index2) {\n      if (isNumeric(frag)) {\n        offsets[index] += frag * (op[index2 - 1] === '-' ? -1 : 1);\n      }\n    });\n  });\n  return offsets;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @argument {Number|String} options.offset=0\n * The offset value as described in the modifier description\n * @returns {Object} The data object, properly modified\n */\nfunction offset(data, _ref) {\n  var offset = _ref.offset;\n  var placement = data.placement,\n      _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var basePlacement = placement.split('-')[0];\n\n  var offsets = void 0;\n  if (isNumeric(+offset)) {\n    offsets = [+offset, 0];\n  } else {\n    offsets = parseOffset(offset, popper, reference, basePlacement);\n  }\n\n  if (basePlacement === 'left') {\n    popper.top += offsets[0];\n    popper.left -= offsets[1];\n  } else if (basePlacement === 'right') {\n    popper.top += offsets[0];\n    popper.left += offsets[1];\n  } else if (basePlacement === 'top') {\n    popper.left += offsets[0];\n    popper.top -= offsets[1];\n  } else if (basePlacement === 'bottom') {\n    popper.left += offsets[0];\n    popper.top += offsets[1];\n  }\n\n  data.popper = popper;\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction preventOverflow(data, options) {\n  var boundariesElement = options.boundariesElement || getOffsetParent(data.instance.popper);\n\n  // If offsetParent is the reference element, we really want to\n  // go one step up and use the next offsetParent as reference to\n  // avoid to make this modifier completely useless and look like broken\n  if (data.instance.reference === boundariesElement) {\n    boundariesElement = getOffsetParent(boundariesElement);\n  }\n\n  // NOTE: DOM access here\n  // resets the popper's position so that the document size can be calculated excluding\n  // the size of the popper element itself\n  var transformProp = getSupportedPropertyName('transform');\n  var popperStyles = data.instance.popper.style; // assignment to help minification\n  var top = popperStyles.top,\n      left = popperStyles.left,\n      transform = popperStyles[transformProp];\n\n  popperStyles.top = '';\n  popperStyles.left = '';\n  popperStyles[transformProp] = '';\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, boundariesElement, data.positionFixed);\n\n  // NOTE: DOM access here\n  // restores the original style properties after the offsets have been computed\n  popperStyles.top = top;\n  popperStyles.left = left;\n  popperStyles[transformProp] = transform;\n\n  options.boundaries = boundaries;\n\n  var order = options.priority;\n  var popper = data.offsets.popper;\n\n  var check = {\n    primary: function primary(placement) {\n      var value = popper[placement];\n      if (popper[placement] < boundaries[placement] && !options.escapeWithReference) {\n        value = Math.max(popper[placement], boundaries[placement]);\n      }\n      return defineProperty({}, placement, value);\n    },\n    secondary: function secondary(placement) {\n      var mainSide = placement === 'right' ? 'left' : 'top';\n      var value = popper[mainSide];\n      if (popper[placement] > boundaries[placement] && !options.escapeWithReference) {\n        value = Math.min(popper[mainSide], boundaries[placement] - (placement === 'right' ? popper.width : popper.height));\n      }\n      return defineProperty({}, mainSide, value);\n    }\n  };\n\n  order.forEach(function (placement) {\n    var side = ['left', 'top'].indexOf(placement) !== -1 ? 'primary' : 'secondary';\n    popper = _extends({}, popper, check[side](placement));\n  });\n\n  data.offsets.popper = popper;\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction shift(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var shiftvariation = placement.split('-')[1];\n\n  // if shift shiftvariation is specified, run the modifier\n  if (shiftvariation) {\n    var _data$offsets = data.offsets,\n        reference = _data$offsets.reference,\n        popper = _data$offsets.popper;\n\n    var isVertical = ['bottom', 'top'].indexOf(basePlacement) !== -1;\n    var side = isVertical ? 'left' : 'top';\n    var measurement = isVertical ? 'width' : 'height';\n\n    var shiftOffsets = {\n      start: defineProperty({}, side, reference[side]),\n      end: defineProperty({}, side, reference[side] + reference[measurement] - popper[measurement])\n    };\n\n    data.offsets.popper = _extends({}, popper, shiftOffsets[shiftvariation]);\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction hide(data) {\n  if (!isModifierRequired(data.instance.modifiers, 'hide', 'preventOverflow')) {\n    return data;\n  }\n\n  var refRect = data.offsets.reference;\n  var bound = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'preventOverflow';\n  }).boundaries;\n\n  if (refRect.bottom < bound.top || refRect.left > bound.right || refRect.top > bound.bottom || refRect.right < bound.left) {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === true) {\n      return data;\n    }\n\n    data.hide = true;\n    data.attributes['x-out-of-boundaries'] = '';\n  } else {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === false) {\n      return data;\n    }\n\n    data.hide = false;\n    data.attributes['x-out-of-boundaries'] = false;\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction inner(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isHoriz = ['left', 'right'].indexOf(basePlacement) !== -1;\n\n  var subtractLength = ['top', 'left'].indexOf(basePlacement) === -1;\n\n  popper[isHoriz ? 'left' : 'top'] = reference[basePlacement] - (subtractLength ? popper[isHoriz ? 'width' : 'height'] : 0);\n\n  data.placement = getOppositePlacement(placement);\n  data.offsets.popper = getClientRect(popper);\n\n  return data;\n}\n\n/**\n * Modifier function, each modifier can have a function of this type assigned\n * to its `fn` property.<br />\n * These functions will be called on each update, this means that you must\n * make sure they are performant enough to avoid performance bottlenecks.\n *\n * @function ModifierFn\n * @argument {dataObject} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {dataObject} The data object, properly modified\n */\n\n/**\n * Modifiers are plugins used to alter the behavior of your poppers.<br />\n * Popper.js uses a set of 9 modifiers to provide all the basic functionalities\n * needed by the library.\n *\n * Usually you don't want to override the `order`, `fn` and `onLoad` props.\n * All the other properties are configurations that could be tweaked.\n * @namespace modifiers\n */\nvar modifiers = {\n  /**\n   * Modifier used to shift the popper on the start or end of its reference\n   * element.<br />\n   * It will read the variation of the `placement` property.<br />\n   * It can be one either `-end` or `-start`.\n   * @memberof modifiers\n   * @inner\n   */\n  shift: {\n    /** @prop {number} order=100 - Index used to define the order of execution */\n    order: 100,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: shift\n  },\n\n  /**\n   * The `offset` modifier can shift your popper on both its axis.\n   *\n   * It accepts the following units:\n   * - `px` or unit-less, interpreted as pixels\n   * - `%` or `%r`, percentage relative to the length of the reference element\n   * - `%p`, percentage relative to the length of the popper element\n   * - `vw`, CSS viewport width unit\n   * - `vh`, CSS viewport height unit\n   *\n   * For length is intended the main axis relative to the placement of the popper.<br />\n   * This means that if the placement is `top` or `bottom`, the length will be the\n   * `width`. In case of `left` or `right`, it will be the `height`.\n   *\n   * You can provide a single value (as `Number` or `String`), or a pair of values\n   * as `String` divided by a comma or one (or more) white spaces.<br />\n   * The latter is a deprecated method because it leads to confusion and will be\n   * removed in v2.<br />\n   * Additionally, it accepts additions and subtractions between different units.\n   * Note that multiplications and divisions aren't supported.\n   *\n   * Valid examples are:\n   * ```\n   * 10\n   * '10%'\n   * '10, 10'\n   * '10%, 10'\n   * '10 + 10%'\n   * '10 - 5vh + 3%'\n   * '-10px + 5vh, 5px - 6%'\n   * ```\n   * > **NB**: If you desire to apply offsets to your poppers in a way that may make them overlap\n   * > with their reference element, unfortunately, you will have to disable the `flip` modifier.\n   * > You can read more on this at this [issue](https://github.com/FezVrasta/popper.js/issues/373).\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  offset: {\n    /** @prop {number} order=200 - Index used to define the order of execution */\n    order: 200,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: offset,\n    /** @prop {Number|String} offset=0\n     * The offset value as described in the modifier description\n     */\n    offset: 0\n  },\n\n  /**\n   * Modifier used to prevent the popper from being positioned outside the boundary.\n   *\n   * A scenario exists where the reference itself is not within the boundaries.<br />\n   * We can say it has \"escaped the boundaries\"  or just \"escaped\".<br />\n   * In this case we need to decide whether the popper should either:\n   *\n   * - detach from the reference and remain \"trapped\" in the boundaries, or\n   * - if it should ignore the boundary and \"escape with its reference\"\n   *\n   * When `escapeWithReference` is set to`true` and reference is completely\n   * outside its boundaries, the popper will overflow (or completely leave)\n   * the boundaries in order to remain attached to the edge of the reference.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  preventOverflow: {\n    /** @prop {number} order=300 - Index used to define the order of execution */\n    order: 300,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: preventOverflow,\n    /**\n     * @prop {Array} [priority=['left','right','top','bottom']]\n     * Popper will try to prevent overflow following these priorities by default,\n     * then, it could overflow on the left and on top of the `boundariesElement`\n     */\n    priority: ['left', 'right', 'top', 'bottom'],\n    /**\n     * @prop {number} padding=5\n     * Amount of pixel used to define a minimum distance between the boundaries\n     * and the popper. This makes sure the popper always has a little padding\n     * between the edges of its container\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='scrollParent'\n     * Boundaries used by the modifier. Can be `scrollParent`, `window`,\n     * `viewport` or any DOM element.\n     */\n    boundariesElement: 'scrollParent'\n  },\n\n  /**\n   * Modifier used to make sure the reference and its popper stay near each other\n   * without leaving any gap between the two. Especially useful when the arrow is\n   * enabled and you want to ensure that it points to its reference element.\n   * It cares only about the first axis. You can still have poppers with margin\n   * between the popper and its reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  keepTogether: {\n    /** @prop {number} order=400 - Index used to define the order of execution */\n    order: 400,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: keepTogether\n  },\n\n  /**\n   * This modifier is used to move the `arrowElement` of the popper to make\n   * sure it is positioned between the reference element and its popper element.\n   * It will read the outer size of the `arrowElement` node to detect how many\n   * pixels of conjunction are needed.\n   *\n   * It has no effect if no `arrowElement` is provided.\n   * @memberof modifiers\n   * @inner\n   */\n  arrow: {\n    /** @prop {number} order=500 - Index used to define the order of execution */\n    order: 500,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: arrow,\n    /** @prop {String|HTMLElement} element='[x-arrow]' - Selector or node used as arrow */\n    element: '[x-arrow]'\n  },\n\n  /**\n   * Modifier used to flip the popper's placement when it starts to overlap its\n   * reference element.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   *\n   * **NOTE:** this modifier will interrupt the current update cycle and will\n   * restart it if it detects the need to flip the placement.\n   * @memberof modifiers\n   * @inner\n   */\n  flip: {\n    /** @prop {number} order=600 - Index used to define the order of execution */\n    order: 600,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: flip,\n    /**\n     * @prop {String|Array} behavior='flip'\n     * The behavior used to change the popper's placement. It can be one of\n     * `flip`, `clockwise`, `counterclockwise` or an array with a list of valid\n     * placements (with optional variations)\n     */\n    behavior: 'flip',\n    /**\n     * @prop {number} padding=5\n     * The popper will flip if it hits the edges of the `boundariesElement`\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='viewport'\n     * The element which will define the boundaries of the popper position.\n     * The popper will never be placed outside of the defined boundaries\n     * (except if `keepTogether` is enabled)\n     */\n    boundariesElement: 'viewport',\n    /**\n     * @prop {Boolean} flipVariations=false\n     * The popper will switch placement variation between `-start` and `-end` when\n     * the reference element overlaps its boundaries.\n     *\n     * The original placement should have a set variation.\n     */\n    flipVariations: false,\n    /**\n     * @prop {Boolean} flipVariationsByContent=false\n     * The popper will switch placement variation between `-start` and `-end` when\n     * the popper element overlaps its reference boundaries.\n     *\n     * The original placement should have a set variation.\n     */\n    flipVariationsByContent: false\n  },\n\n  /**\n   * Modifier used to make the popper flow toward the inner of the reference element.\n   * By default, when this modifier is disabled, the popper will be placed outside\n   * the reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  inner: {\n    /** @prop {number} order=700 - Index used to define the order of execution */\n    order: 700,\n    /** @prop {Boolean} enabled=false - Whether the modifier is enabled or not */\n    enabled: false,\n    /** @prop {ModifierFn} */\n    fn: inner\n  },\n\n  /**\n   * Modifier used to hide the popper when its reference element is outside of the\n   * popper boundaries. It will set a `x-out-of-boundaries` attribute which can\n   * be used to hide with a CSS selector the popper when its reference is\n   * out of boundaries.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   * @memberof modifiers\n   * @inner\n   */\n  hide: {\n    /** @prop {number} order=800 - Index used to define the order of execution */\n    order: 800,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: hide\n  },\n\n  /**\n   * Computes the style that will be applied to the popper element to gets\n   * properly positioned.\n   *\n   * Note that this modifier will not touch the DOM, it just prepares the styles\n   * so that `applyStyle` modifier can apply it. This separation is useful\n   * in case you need to replace `applyStyle` with a custom implementation.\n   *\n   * This modifier has `850` as `order` value to maintain backward compatibility\n   * with previous versions of Popper.js. Expect the modifiers ordering method\n   * to change in future major versions of the library.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  computeStyle: {\n    /** @prop {number} order=850 - Index used to define the order of execution */\n    order: 850,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: computeStyle,\n    /**\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: true,\n    /**\n     * @prop {string} [x='bottom']\n     * Where to anchor the X axis (`bottom` or `top`). AKA X offset origin.\n     * Change this if your popper should grow in a direction different from `bottom`\n     */\n    x: 'bottom',\n    /**\n     * @prop {string} [x='left']\n     * Where to anchor the Y axis (`left` or `right`). AKA Y offset origin.\n     * Change this if your popper should grow in a direction different from `right`\n     */\n    y: 'right'\n  },\n\n  /**\n   * Applies the computed styles to the popper element.\n   *\n   * All the DOM manipulations are limited to this modifier. This is useful in case\n   * you want to integrate Popper.js inside a framework or view library and you\n   * want to delegate all the DOM manipulations to it.\n   *\n   * Note that if you disable this modifier, you must make sure the popper element\n   * has its position set to `absolute` before Popper.js can do its work!\n   *\n   * Just disable this modifier and define your own to achieve the desired effect.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  applyStyle: {\n    /** @prop {number} order=900 - Index used to define the order of execution */\n    order: 900,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: applyStyle,\n    /** @prop {Function} */\n    onLoad: applyStyleOnLoad,\n    /**\n     * @deprecated since version 1.10.0, the property moved to `computeStyle` modifier\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: undefined\n  }\n};\n\n/**\n * The `dataObject` is an object containing all the information used by Popper.js.\n * This object is passed to modifiers and to the `onCreate` and `onUpdate` callbacks.\n * @name dataObject\n * @property {Object} data.instance The Popper.js instance\n * @property {String} data.placement Placement applied to popper\n * @property {String} data.originalPlacement Placement originally defined on init\n * @property {Boolean} data.flipped True if popper has been flipped by flip modifier\n * @property {Boolean} data.hide True if the reference element is out of boundaries, useful to know when to hide the popper\n * @property {HTMLElement} data.arrowElement Node used as arrow by arrow modifier\n * @property {Object} data.styles Any CSS property defined here will be applied to the popper. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.arrowStyles Any CSS property defined here will be applied to the popper arrow. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.boundaries Offsets of the popper boundaries\n * @property {Object} data.offsets The measurements of popper, reference and arrow elements\n * @property {Object} data.offsets.popper `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.reference `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.arrow] `top` and `left` offsets, only one of them will be different from 0\n */\n\n/**\n * Default options provided to Popper.js constructor.<br />\n * These can be overridden using the `options` argument of Popper.js.<br />\n * To override an option, simply pass an object with the same\n * structure of the `options` object, as the 3rd argument. For example:\n * ```\n * new Popper(ref, pop, {\n *   modifiers: {\n *     preventOverflow: { enabled: false }\n *   }\n * })\n * ```\n * @type {Object}\n * @static\n * @memberof Popper\n */\nvar Defaults = {\n  /**\n   * Popper's placement.\n   * @prop {Popper.placements} placement='bottom'\n   */\n  placement: 'bottom',\n\n  /**\n   * Set this to true if you want popper to position it self in 'fixed' mode\n   * @prop {Boolean} positionFixed=false\n   */\n  positionFixed: false,\n\n  /**\n   * Whether events (resize, scroll) are initially enabled.\n   * @prop {Boolean} eventsEnabled=true\n   */\n  eventsEnabled: true,\n\n  /**\n   * Set to true if you want to automatically remove the popper when\n   * you call the `destroy` method.\n   * @prop {Boolean} removeOnDestroy=false\n   */\n  removeOnDestroy: false,\n\n  /**\n   * Callback called when the popper is created.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onCreate}\n   */\n  onCreate: function onCreate() {},\n\n  /**\n   * Callback called when the popper is updated. This callback is not called\n   * on the initialization/creation of the popper, but only on subsequent\n   * updates.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onUpdate}\n   */\n  onUpdate: function onUpdate() {},\n\n  /**\n   * List of modifiers used to modify the offsets before they are applied to the popper.\n   * They provide most of the functionalities of Popper.js.\n   * @prop {modifiers}\n   */\n  modifiers: modifiers\n};\n\n/**\n * @callback onCreate\n * @param {dataObject} data\n */\n\n/**\n * @callback onUpdate\n * @param {dataObject} data\n */\n\n// Utils\n// Methods\nvar Popper = function () {\n  /**\n   * Creates a new Popper.js instance.\n   * @class Popper\n   * @param {Element|referenceObject} reference - The reference element used to position the popper\n   * @param {Element} popper - The HTML / XML element used as the popper\n   * @param {Object} options - Your custom options to override the ones defined in [Defaults](#defaults)\n   * @return {Object} instance - The generated Popper.js instance\n   */\n  function Popper(reference, popper) {\n    var _this = this;\n\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    classCallCheck(this, Popper);\n\n    this.scheduleUpdate = function () {\n      return requestAnimationFrame(_this.update);\n    };\n\n    // make update() debounced, so that it only runs at most once-per-tick\n    this.update = debounce(this.update.bind(this));\n\n    // with {} we create a new object with the options inside it\n    this.options = _extends({}, Popper.Defaults, options);\n\n    // init state\n    this.state = {\n      isDestroyed: false,\n      isCreated: false,\n      scrollParents: []\n    };\n\n    // get reference and popper elements (allow jQuery wrappers)\n    this.reference = reference && reference.jquery ? reference[0] : reference;\n    this.popper = popper && popper.jquery ? popper[0] : popper;\n\n    // Deep merge modifiers options\n    this.options.modifiers = {};\n    Object.keys(_extends({}, Popper.Defaults.modifiers, options.modifiers)).forEach(function (name) {\n      _this.options.modifiers[name] = _extends({}, Popper.Defaults.modifiers[name] || {}, options.modifiers ? options.modifiers[name] : {});\n    });\n\n    // Refactoring modifiers' list (Object => Array)\n    this.modifiers = Object.keys(this.options.modifiers).map(function (name) {\n      return _extends({\n        name: name\n      }, _this.options.modifiers[name]);\n    })\n    // sort the modifiers by order\n    .sort(function (a, b) {\n      return a.order - b.order;\n    });\n\n    // modifiers have the ability to execute arbitrary code when Popper.js get inited\n    // such code is executed in the same order of its modifier\n    // they could add new properties to their options configuration\n    // BE AWARE: don't add options to `options.modifiers.name` but to `modifierOptions`!\n    this.modifiers.forEach(function (modifierOptions) {\n      if (modifierOptions.enabled && isFunction(modifierOptions.onLoad)) {\n        modifierOptions.onLoad(_this.reference, _this.popper, _this.options, modifierOptions, _this.state);\n      }\n    });\n\n    // fire the first update to position the popper in the right place\n    this.update();\n\n    var eventsEnabled = this.options.eventsEnabled;\n    if (eventsEnabled) {\n      // setup event listeners, they will take care of update the position in specific situations\n      this.enableEventListeners();\n    }\n\n    this.state.eventsEnabled = eventsEnabled;\n  }\n\n  // We can't use class properties because they don't get listed in the\n  // class prototype and break stuff like Sinon stubs\n\n\n  createClass(Popper, [{\n    key: 'update',\n    value: function update$$1() {\n      return update.call(this);\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy$$1() {\n      return destroy.call(this);\n    }\n  }, {\n    key: 'enableEventListeners',\n    value: function enableEventListeners$$1() {\n      return enableEventListeners.call(this);\n    }\n  }, {\n    key: 'disableEventListeners',\n    value: function disableEventListeners$$1() {\n      return disableEventListeners.call(this);\n    }\n\n    /**\n     * Schedules an update. It will run on the next UI update available.\n     * @method scheduleUpdate\n     * @memberof Popper\n     */\n\n\n    /**\n     * Collection of utilities useful when writing custom modifiers.\n     * Starting from version 1.7, this method is available only if you\n     * include `popper-utils.js` before `popper.js`.\n     *\n     * **DEPRECATION**: This way to access PopperUtils is deprecated\n     * and will be removed in v2! Use the PopperUtils module directly instead.\n     * Due to the high instability of the methods contained in Utils, we can't\n     * guarantee them to follow semver. Use them at your own risk!\n     * @static\n     * @private\n     * @type {Object}\n     * @deprecated since version 1.8\n     * @member Utils\n     * @memberof Popper\n     */\n\n  }]);\n  return Popper;\n}();\n\n/**\n * The `referenceObject` is an object that provides an interface compatible with Popper.js\n * and lets you use it as replacement of a real DOM node.<br />\n * You can use this method to position a popper relatively to a set of coordinates\n * in case you don't have a DOM node to use as reference.\n *\n * ```\n * new Popper(referenceObject, popperNode);\n * ```\n *\n * NB: This feature isn't supported in Internet Explorer 10.\n * @name referenceObject\n * @property {Function} data.getBoundingClientRect\n * A function that returns a set of coordinates compatible with the native `getBoundingClientRect` method.\n * @property {number} data.clientWidth\n * An ES6 getter that will return the width of the virtual reference element.\n * @property {number} data.clientHeight\n * An ES6 getter that will return the height of the virtual reference element.\n */\n\n\nPopper.Utils = (typeof window !== 'undefined' ? window : global).PopperUtils;\nPopper.placements = placements;\nPopper.Defaults = Defaults;\n\nexport default Popper;\n//# sourceMappingURL=popper.js.map\n","import {Column, INumbersColumn, isNumbersColumn, IDataRow, IOrderedGroup} from '../model';\r\nimport {CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {ANumbersCellRenderer} from './ANumbersCellRenderer';\r\nimport {toHeatMapColor} from './BrightnessCellRenderer';\r\nimport {IRenderContext, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingValue, renderMissingDOM} from './missing';\r\nimport {noop, wideEnough} from './utils';\r\nimport {GUESSED_ROW_HEIGHT} from '../constants';\r\nimport {getSortLabel} from '../internal';\r\n\r\n\r\nexport default class HeatmapCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Heatmap';\r\n\r\n  canRender(col: Column): boolean {\r\n    return isNumbersColumn(col) && Boolean(col.dataLength);\r\n  }\r\n\r\n  private createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer) {\r\n    const width = context.colWidth(col);\r\n    const cellDimension = width / col.dataLength!;\r\n    const labels = col.labels;\r\n    const render = (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow, height: number) => {\r\n      data.forEach((d: number, j: number) => {\r\n        const x = j * cellDimension;\r\n        if (isNaN(d)) {\r\n          renderMissingValue(ctx, cellDimension, height, x, 0);\r\n          return;\r\n        }\r\n        ctx.fillStyle = toHeatMapColor(d, item, col, imposer);\r\n        ctx.fillRect(x, 0, cellDimension, height);\r\n      });\r\n    };\r\n    return {\r\n      template: `<canvas height=\"${GUESSED_ROW_HEIGHT}\" title=\"\"></canvas>`,\r\n      render,\r\n      width,\r\n      mover: (n: HTMLElement, values: string[], prefix?: string) => (evt: MouseEvent) => {\r\n        const percent = evt.offsetX / width;\r\n        const index = Math.max(0, Math.min(col.dataLength! - 1, Math.floor(percent * (col.dataLength! - 1) + 0.5)));\r\n        n.title = `${prefix || ''}${labels[index]}: ${values[index]}`;\r\n      }\r\n    };\r\n  }\r\n\r\n  create(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer): ICellRenderer {\r\n    const {template, render, mover, width} = this.createContext(col, context, imposer);\r\n\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const ctx = (<HTMLCanvasElement>n).getContext('2d')!;\r\n        ctx.canvas.width = width;\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        n.onmousemove = mover(n, col.getLabels(d));\r\n        n.onmouseleave = () => n.title = '';\r\n        render(ctx, col.getNumbers(d), d, GUESSED_ROW_HEIGHT);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        render(ctx, col.getNumbers(d), d, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\r\n    const {template, render, mover, width} = this.createContext(col, context, imposer);\r\n    const formatter = col.getNumberFormat();\r\n\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupRows(col, group, this.title, (rows) => ANumbersCellRenderer.choose(col, rows)).then((data) => {\r\n          if (typeof data === 'symbol') {\r\n            return;\r\n          }\r\n          const ctx = (<HTMLCanvasElement>n).getContext('2d')!;\r\n          ctx.canvas.width = width;\r\n          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n          const isMissing = !data || data.normalized.length === 0 || data.normalized.every((v) => Number.isNaN(v));\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n\r\n          n.onmousemove = mover(n, data.raw.map(formatter), `${getSortLabel(col.getSortMethod())} `);\r\n          n.onmouseleave = () => n.title = '';\r\n          render(ctx, data.normalized, data.row!, GUESSED_ROW_HEIGHT);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: INumbersColumn): ISummaryRenderer {\r\n    let labels = col.labels.slice();\r\n    while (labels.length > 0 && !wideEnough(col, labels.length)) {\r\n      labels = labels.filter((_, i) => i % 2 === 0); // even\r\n    }\r\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\r\n    for (const label of labels) {\r\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\"  title=\"${label}\" data-title=\"${label}\"></div>`;\r\n    }\r\n    templateRows += '</div>';\r\n    return {\r\n      template: templateRows,\r\n      update: noop\r\n    };\r\n  }\r\n}\r\n","const TYPE_OBJECT = '[object Object]';\r\n\r\n/**\r\n * deep merge the source object into the target object and return the target object.\r\n * will concatenate arrays instead of replacing them.\r\n * @internal\r\n */\r\nexport default function merge<T1, T2>(target: T1, source: T2): T1 | T2 {\r\n  const result: any = target;\r\n\r\n  if (!source) {\r\n    return result;\r\n  }\r\n\r\n  const bKeys: (keyof T2)[] = <(keyof T2)[]>Object.keys(source);\r\n  if (bKeys.length === 0) {\r\n    return result;\r\n  }\r\n\r\n  for (const key of bKeys) {\r\n    const value = source[key];\r\n\r\n    //merge just POJOs\r\n    if (Object.prototype.toString.call(value) === TYPE_OBJECT && (Object.getPrototypeOf(value) === Object.prototype)) { //pojo\r\n      if (result[key] == null) {\r\n        result[key] = {};\r\n      }\r\n      result[key] = merge(result[key], value);\r\n    } else if (Array.isArray(value)) {\r\n      if (result[key] == null) {\r\n        result[key] = [];\r\n      }\r\n      result[key] = result[key].concat(value);\r\n    } else {\r\n      result[key] = value;\r\n    }\r\n  }\r\n  return result;\r\n}\r\n","import Popper from 'popper.js';\r\nimport DialogManager from './DialogManager';\r\nimport {merge} from '../../internal';\r\nimport {cssClass} from '../../styles';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {ILivePreviewOptions} from '../../config';\r\n\r\nexport interface IDialogOptions {\r\n  title: string;\r\n  livePreview: boolean | keyof ILivePreviewOptions;\r\n  popup: boolean;\r\n  // popper options\r\n  placement?: Popper.Placement;\r\n  eventsEnabled?: boolean;\r\n  modifiers?: Popper.Modifiers;\r\n  toggleDialog: boolean;\r\n  cancelSubDialogs?: boolean;\r\n  autoClose?: boolean;\r\n}\r\n\r\nexport interface IDialogContext {\r\n  attachment: HTMLElement;\r\n  level: number;\r\n  manager: DialogManager;\r\n  idPrefix: string;\r\n}\r\n\r\nexport function dialogContext(ctx: IRankingHeaderContext, level: number, attachment: HTMLElement | MouseEvent): IDialogContext {\r\n  return {\r\n    attachment: (<MouseEvent>attachment).currentTarget != null ? <HTMLElement>(<MouseEvent>attachment).currentTarget : <HTMLElement>attachment,\r\n    level,\r\n    manager: ctx.dialogManager,\r\n    idPrefix: ctx.idPrefix\r\n  };\r\n}\r\n\r\nabstract class ADialog {\r\n\r\n  private readonly options: Readonly<IDialogOptions> = {\r\n    title: '',\r\n    livePreview: false,\r\n    popup: false,\r\n    placement: 'bottom-start',\r\n    toggleDialog: true,\r\n    cancelSubDialogs: false,\r\n    autoClose: false,\r\n    modifiers: {\r\n    }\r\n  };\r\n\r\n  readonly node: HTMLFormElement;\r\n  private popper: Popper | null = null;\r\n\r\n  constructor(protected readonly dialog: Readonly<IDialogContext>, options: Partial<IDialogOptions> = {}) {\r\n    Object.assign(this.options, options);\r\n    this.node = dialog.attachment.ownerDocument!.createElement('form');\r\n    this.node.classList.add(cssClass('dialog'));\r\n  }\r\n\r\n  get autoClose() {\r\n    return this.options.autoClose;\r\n  }\r\n\r\n  get attachment() {\r\n    return this.dialog.attachment;\r\n  }\r\n\r\n  get level() {\r\n    return this.dialog.level;\r\n  }\r\n\r\n  protected abstract build(node: HTMLElement): boolean | void;\r\n\r\n  protected showLivePreviews() {\r\n    return this.options.livePreview === true || (typeof this.options.livePreview === 'string' && this.dialog.manager.livePreviews[this.options.livePreview] === true);\r\n  }\r\n\r\n  protected enableLivePreviews(selector: string | (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[]) {\r\n    if (!this.showLivePreviews()) {\r\n      return;\r\n    }\r\n    const submitter = () => {\r\n      this.submit();\r\n    };\r\n    if (typeof selector === 'string') {\r\n      this.forEach(selector, (n: HTMLInputElement | HTMLSelectElement) => {\r\n        n.addEventListener('change', submitter, {passive: true});\r\n      });\r\n    } else {\r\n      selector.forEach((n) => {\r\n        n.addEventListener('change', submitter, {passive: true});\r\n      });\r\n    }\r\n  }\r\n\r\n  equals(that: ADialog) {\r\n    return this.dialog.level === that.dialog.level && this.dialog.attachment === that.dialog.attachment;\r\n  }\r\n\r\n  protected appendDialogButtons() {\r\n    this.node.insertAdjacentHTML('beforeend', `<div class=\"${cssClass('dialog-buttons')}\">\r\n      <button class=\"${cssClass('dialog-button')}\" type=\"submit\" title=\"Apply\"></button>\r\n      <button class=\"${cssClass('dialog-button')}\" type=\"button\" title=\"Cancel\"></button>\r\n      <button class=\"${cssClass('dialog-button')}\" type=\"reset\" title=\"Reset to default values\"></button>\r\n    </div>`);\r\n  }\r\n\r\n  open() {\r\n    if (this.options.toggleDialog && this.dialog.manager.removeLike(this)) {\r\n      return;\r\n    }\r\n    if (this.build(this.node) === false) {\r\n      return;\r\n    }\r\n    const parent = <HTMLElement>this.attachment.closest(`.${cssClass()}`)!;\r\n\r\n    if (this.options.title) {\r\n      this.node.insertAdjacentHTML('afterbegin', `<strong>${this.options.title}</strong>`);\r\n    }\r\n    if (!this.options.popup) {\r\n      this.appendDialogButtons();\r\n    }\r\n\r\n    parent.appendChild(this.node);\r\n    this.popper = new Popper(this.attachment, this.node, merge({\r\n      modifiers: {\r\n        preventOverflow: {\r\n          boundariesElement: parent\r\n        }\r\n      }\r\n    }, this.options));\r\n\r\n    const auto = this.find<HTMLInputElement>('input[autofocus]');\r\n    if (auto) {\r\n      // delay such that it works\r\n      self.setTimeout(() => auto.focus());\r\n    }\r\n\r\n    const reset = this.find<HTMLButtonElement>('button[type=reset]');\r\n    if (reset) {\r\n      reset.onclick = (evt) => {\r\n        evt.stopPropagation();\r\n        evt.preventDefault();\r\n        this.reset();\r\n        if (this.showLivePreviews()) {\r\n          this.submit();\r\n        }\r\n      };\r\n    }\r\n    this.node.onsubmit = (evt) => {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n      return this.triggerSubmit();\r\n    };\r\n    const cancel = this.find<HTMLButtonElement>('button[title=Cancel]');\r\n    if (cancel) {\r\n      cancel.onclick = (evt) => {\r\n        evt.stopPropagation();\r\n        evt.preventDefault();\r\n        this.cancel();\r\n        this.destroy('cancel');\r\n      };\r\n    }\r\n\r\n    if (this.options.cancelSubDialogs) {\r\n      this.node.addEventListener('click', () => {\r\n        this.dialog.manager.removeAboveLevel(this.dialog.level + 1);\r\n      });\r\n    }\r\n\r\n    this.dialog.manager.push(this);\r\n  }\r\n\r\n  protected triggerSubmit() {\r\n    if (!this.node.checkValidity()) {\r\n      return false;\r\n    }\r\n    if (this.submit() !== false) {\r\n      this.destroy('confirm');\r\n    }\r\n    return false;\r\n  }\r\n\r\n  protected find<T extends HTMLElement>(selector: string): T {\r\n    return <T>this.node.querySelector(selector);\r\n  }\r\n\r\n  protected findInput(selector: string) {\r\n    return this.find<HTMLInputElement>(selector);\r\n  }\r\n\r\n  protected forEach<M extends Element, T>(selector: string, callback: (d: M, i: number) => T): T[] {\r\n    return (<M[]>Array.from(this.node.querySelectorAll(selector))).map(callback);\r\n  }\r\n\r\n  protected abstract reset(): void;\r\n\r\n  protected abstract submit(): boolean | undefined;\r\n\r\n  protected abstract cancel(): void;\r\n\r\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\r\n    if (action === 'confirm') {\r\n      this.submit(); // TODO what if submit wasn't successful?\r\n    } else if (action === 'cancel') {\r\n      this.cancel();\r\n    }\r\n\r\n    if (action !== 'handled') {\r\n      this.dialog.manager.triggerDialogClosed(this, action);\r\n    }\r\n\r\n    if (this.popper) {\r\n      this.popper.destroy();\r\n    }\r\n    this.node.remove();\r\n  }\r\n\r\n  protected destroy(action: 'cancel' | 'confirm' = 'cancel') {\r\n    this.dialog.manager.triggerDialogClosed(this, action);\r\n    this.dialog.manager.remove(this, true);\r\n  }\r\n}\r\n\r\nexport default ADialog;\r\n","import ADialog, {IDialogContext, IDialogOptions} from './ADialog';\r\n\r\nabstract class APopup extends ADialog {\r\n  constructor(dialog: Readonly<IDialogContext>, options: Partial<IDialogOptions> = {}) {\r\n    super(dialog, Object.assign({\r\n      popup: true\r\n    }, options));\r\n  }\r\n\r\n  protected submit() {\r\n    return true;\r\n  }\r\n\r\n  protected reset() {\r\n    // dummy\r\n  }\r\n\r\n  protected cancel() {\r\n    // dummy\r\n  }\r\n}\r\n\r\nexport default APopup;\r\n","import {IDialogContext} from './ADialog';\r\nimport APopup from './APopup';\r\n\r\n/** @internal */\r\nexport interface IInputNumberOptions {\r\n  min: number;\r\n  max: number;\r\n  step: number | 'any';\r\n  value: number;\r\n  label: string | null;\r\n}\r\n\r\n/** @internal */\r\nexport default class InputNumberDialog extends APopup {\r\n\r\n  private readonly ioptions: Readonly<IInputNumberOptions> = {\r\n    min: NaN,\r\n    max: NaN,\r\n    step: 'any',\r\n    value: NaN,\r\n    label: null\r\n  };\r\n\r\n  constructor(dialog: IDialogContext, private readonly callback: (value: number) => void, options: Partial<IInputNumberOptions> = {}) {\r\n    super(dialog);\r\n    Object.assign(this.ioptions, options);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const o = this.ioptions;\r\n    node.insertAdjacentHTML('beforeend', `\r\n     <input type=\"number\" value=\"${isNaN(o.value) ? '' : String(o.value)}\" required autofocus placeholder=\"${o.label ? o.label : 'enter number'}\" ${isNaN(o.min) ? '' : ` min=\"${o.min}\"`} ${isNaN(o.max) ? '' : ` max=\"${o.max}\"`} step=\"${o.step}\">\r\n    `);\r\n    this.enableLivePreviews('input');\r\n  }\r\n\r\n  submit() {\r\n    this.callback(this.findInput('input[type=number]').valueAsNumber);\r\n    return true;\r\n  }\r\n}\r\n","import {cssClass} from '../styles';\r\n\r\n/** @internal */\r\nexport interface IDragHandleOptions {\r\n  /**\r\n   * drag base container\r\n   * @default handle parentElement\r\n   */\r\n  container: HTMLElement | SVGElement;\r\n  /**\r\n   * filter to certain mouse events, e.g. shift only\r\n   */\r\n  filter(evt: MouseEvent): boolean;\r\n\r\n  onStart(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\r\n\r\n  onDrag(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\r\n\r\n  onEnd(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\r\n\r\n  /**\r\n   * minimal pixel delta\r\n   * @default 2\r\n   */\r\n  minDelta: number;\r\n}\r\n\r\n/**\r\n * allow to change the width of a column using dragging the handle\r\n * @internal\r\n */\r\nexport function dragHandle(handle: HTMLElement | SVGElement, options: Partial<IDragHandleOptions> = {}) {\r\n  const o: Readonly<IDragHandleOptions> = Object.assign({\r\n    container: handle.parentElement!,\r\n    filter: () => true,\r\n    onStart: () => undefined,\r\n    onDrag: () => undefined,\r\n    onEnd: () => undefined,\r\n    minDelta: 2\r\n  }, options);\r\n\r\n  let ueberElement: HTMLElement | null = null;\r\n\r\n  // converts the given x coordinate to be relative to the given element\r\n  const toContainerRelative = (x: number, elem: HTMLElement | SVGElement) => {\r\n    const rect = elem.getBoundingClientRect();\r\n    return x - rect.left - elem.clientLeft;\r\n  };\r\n\r\n  let start = 0;\r\n  let last = 0;\r\n  let handleShift = 0;\r\n\r\n  const mouseMove = (evt: MouseEvent) => {\r\n    if (!o.filter(evt)) {\r\n      return;\r\n    }\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n\r\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\r\n    if (Math.abs(last - end) < o.minDelta) {\r\n      //ignore\r\n      return;\r\n    }\r\n\r\n    last = end;\r\n    o.onDrag(handle, end, last - end, evt);\r\n  };\r\n\r\n  const mouseUp = (evt: MouseEvent) => {\r\n    if (!o.filter(evt)) {\r\n      return;\r\n    }\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n\r\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\r\n    ueberElement!.removeEventListener('mousemove', <any>mouseMove);\r\n    ueberElement!.removeEventListener('mouseup', <any>mouseUp);\r\n    ueberElement!.removeEventListener('mouseleave', <any>mouseUp);\r\n    ueberElement!.classList.remove(cssClass('dragging'));\r\n\r\n    if (Math.abs(start - end) < 2) {\r\n      //ignore\r\n      return;\r\n    }\r\n\r\n    o.onEnd(handle, end, start - end, evt);\r\n  };\r\n\r\n  handle.onmousedown = (evt) => {\r\n    if (!o.filter(evt)) {\r\n      return;\r\n    }\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n\r\n    handleShift = toContainerRelative(evt.clientX, handle);\r\n    start = last = toContainerRelative(evt.clientX, o.container) - handleShift;\r\n\r\n    // register other event listeners\r\n    ueberElement = <HTMLElement>handle.closest('body') || <HTMLElement>handle.closest(`.${cssClass()}`)!; // take the whole body or root lineup\r\n    ueberElement.addEventListener('mousemove', <any>mouseMove);\r\n    ueberElement.addEventListener('mouseup', <any>mouseUp);\r\n    ueberElement.addEventListener('mouseleave', <any>mouseUp);\r\n    ueberElement.classList.add(cssClass('dragging'));\r\n\r\n    o.onStart(handle, start, 0, evt);\r\n  };\r\n}\r\n","import {DENSE_HISTOGRAM} from '../constants';\r\nimport {IBin, round, IDragHandleOptions, dragHandle} from '../internal';\r\nimport {cssClass, FILTERED_OPACITY} from '../styles';\r\nimport {color} from 'd3-color';\r\nimport {filterMissingNumberMarkup, updateFilterMissingNumberMarkup} from '../ui/missing';\r\n\r\nfunction filteredColor(input: string) {\r\n  const c = color(input)!;\r\n  c.opacity = FILTERED_OPACITY;\r\n  return c.toString();\r\n}\r\n\r\nexport function histogramTemplate(guessedBins: number) {\r\n  let bins = '';\r\n  for (let i = 0; i < guessedBins; ++i) {\r\n    bins += `<div class=\"${cssClass('histogram-bin')}\" title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`;\r\n  }\r\n  // no closing div to be able to append things\r\n  return `<div class=\"${cssClass('histogram')} ${guessedBins > DENSE_HISTOGRAM ? cssClass('dense') : ''}\">${bins}`;\r\n}\r\n\r\nfunction matchBins(n: HTMLElement, bins: number) {\r\n  //adapt the number of children\r\n  let nodes = <HTMLElement[]>Array.from(n.querySelectorAll('[data-x]'));\r\n  if (nodes.length > bins) {\r\n    nodes.splice(bins, nodes.length - bins).forEach((d) => d.remove());\r\n  } else if (nodes.length < bins) {\r\n    for (let i = nodes.length; i < bins; ++i) {\r\n      n.insertAdjacentHTML('afterbegin', `<div class=\"${cssClass('histogram-bin')}\" title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`);\r\n    }\r\n    nodes = Array.from(n.querySelectorAll('[data-x]'));\r\n  }\r\n  n.classList.toggle(cssClass('dense'), bins > DENSE_HISTOGRAM);\r\n  return nodes;\r\n}\r\n\r\nexport interface IHistogramLike<T> {\r\n  readonly maxBin: number;\r\n  readonly hist: ReadonlyArray<IBin<T>>;\r\n}\r\n\r\n/** @internal */\r\nexport function histogramUpdate<T>(n: HTMLElement, stats: IHistogramLike<T>, unfiltered: IHistogramLike<T> | null, formatter: (v: T) => string, colorOf: (bin: IBin<T>) => string) {\r\n  const hist = stats.hist;\r\n  const nodes = matchBins(n, hist.length);\r\n\r\n  nodes.forEach((d: HTMLElement, i) => {\r\n    const bin = hist[i];\r\n    const inner = <HTMLElement>d.firstElementChild!;\r\n    if (!bin) {\r\n      inner.style.height = '0%';\r\n      return;\r\n    }\r\n\r\n    const {x0, x1, count} = bin;\r\n    const color = colorOf(bin);\r\n    d.dataset.x = formatter(x0);\r\n\r\n    if (unfiltered) {\r\n      const gCount = (unfiltered.hist[i] || {count}).count;\r\n      d.title = `${formatter(x0)} - ${formatter(x1)} (${count} of ${gCount})`;\r\n      inner.style.height = `${round(gCount * 100 / unfiltered.maxBin, 2)}%`;\r\n      const relY = 100 - round(count * 100 / gCount, 2);\r\n      inner.style.background = relY === 0 ? color : (relY === 100 ? filteredColor(color) : `linear-gradient(${filteredColor(color)} ${relY}%, ${color} ${relY}%, ${color} 100%)`);\r\n    } else {\r\n      d.title = `${formatter(x0)} - ${formatter(x1)} (${count})`;\r\n      inner.style.height = `${round(count * 100 / stats.maxBin, 2)}%`;\r\n      inner.style.backgroundColor = color;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function mappingHintTemplate(range: [string, string]) {\r\n  return `<span class=\"${cssClass('mapping-hint')}\" title=\"${range[0]}\">${range[0]}</span><span class=\"${cssClass('mapping-hint')}\" title=\"${range[1]}\">${range[1]}</span>`;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function mappingHintUpdate(n: HTMLElement, range: [string, string]) {\r\n  Array.from(n.getElementsByTagName('span')).forEach((d: HTMLElement, i) => d.textContent = range[i]);\r\n}\r\n\r\n\r\nexport interface IFilterContext<T> {\r\n  percent(v: T): number;\r\n  unpercent(p: number): T;\r\n  format(v: T): string;\r\n  formatRaw(v: T): string;\r\n  parseRaw(v: string): T;\r\n  setFilter(filterMissing: boolean, min: T, max: T): void;\r\n  edit(value: T, attachment: HTMLElement, type: 'min' | 'max'): Promise<T>;\r\n  domain: [T, T];\r\n}\r\n\r\n/** @internal */\r\nexport interface IFilterInfo<T> {\r\n  filterMissing: boolean;\r\n  filterMin: T;\r\n  filterMax: T;\r\n}\r\n\r\n\r\nexport function filteredHistTemplate<T>(c: IFilterContext<T>, f: IFilterInfo<T>) {\r\n  return `\r\n    <div class=\"${cssClass('histogram-min-hint')}\" style=\"width: ${c.percent(f.filterMin)}%\"></div>\r\n    <div class=\"${cssClass('histogram-max-hint')}\" style=\"width: ${100 - c.percent(f.filterMax)}%\"></div>\r\n    <div class=\"${cssClass('histogram-min')}\" data-value=\"${c.format(f.filterMin)}\" data-raw=\"${c.formatRaw(f.filterMin)}\" style=\"left: ${c.percent(f.filterMin)}%\" title=\"min filter, drag or double click to change\"></div>\r\n    <div class=\"${cssClass('histogram-max')}\" data-value=\"${c.format(f.filterMax)}\" data-raw=\"${c.formatRaw(f.filterMax)}\" style=\"right: ${100 - c.percent(f.filterMax)}%\" title=\"max filter, drag or double click to change\"></div>\r\n    ${filterMissingNumberMarkup(f.filterMissing, 0)}\r\n  `;\r\n}\r\n\r\n\r\nexport function initFilter<T>(node: HTMLElement, context: IFilterContext<T>) {\r\n  const min = <HTMLElement>node.getElementsByClassName(cssClass('histogram-min'))[0];\r\n  const max = <HTMLElement>node.getElementsByClassName(cssClass('histogram-max'))[0];\r\n  const minHint = <HTMLElement>node.getElementsByClassName(cssClass('histogram-min-hint'))[0];\r\n  const maxHint = <HTMLElement>node.getElementsByClassName(cssClass('histogram-max-hint'))[0];\r\n  const filterMissing = <HTMLInputElement>node.getElementsByTagName('input')[0];\r\n\r\n  const setFilter = () => {\r\n    const minValue = context.parseRaw(min.dataset.raw!);\r\n    const maxValue = context.parseRaw(max.dataset.raw!);\r\n    context.setFilter(filterMissing.checked, minValue, maxValue);\r\n  };\r\n\r\n  const minImpl = (evt: MouseEvent) => {\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n\r\n    const value = context.parseRaw(min.dataset.raw!);\r\n\r\n    context.edit(value, min, 'min').then((newValue) => {\r\n      minHint.style.width = `${context.percent(newValue)}%`;\r\n      min.dataset.value = context.format(newValue);\r\n      min.dataset.raw = context.formatRaw(newValue);\r\n      min.style.left = `${context.percent(newValue)}%`;\r\n      min.classList.toggle(cssClass('swap-hint'), context.percent(newValue) > 15);\r\n      setFilter();\r\n    });\r\n  };\r\n\r\n  min.onclick = (evt) => {\r\n    if (!evt.shiftKey && !evt.ctrlKey) {\r\n      return;\r\n    }\r\n    minImpl(evt);\r\n  };\r\n  min.ondblclick = minImpl;\r\n\r\n  const maxImpl = (evt: MouseEvent) => {\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n\r\n    const value = context.parseRaw(max.dataset.raw!);\r\n\r\n    context.edit(value, max, 'max').then((newValue) => {\r\n      maxHint.style.width = `${100 - context.percent(newValue)}%`;\r\n      max.dataset.value = context.format(newValue);\r\n      max.dataset.raw = context.formatRaw(newValue);\r\n      max.style.right = `${100 - context.percent(newValue)}%`;\r\n      max.classList.toggle(cssClass('swap-hint'), context.percent(newValue) < 85);\r\n      setFilter();\r\n    });\r\n  };\r\n\r\n  max.onclick = (evt) => {\r\n    if (!evt.shiftKey && !evt.ctrlKey) {\r\n      return;\r\n    }\r\n    maxImpl(evt);\r\n  };\r\n  max.ondblclick = maxImpl;\r\n\r\n  filterMissing.onchange = () => setFilter();\r\n\r\n  const options: Partial<IDragHandleOptions> = {\r\n    minDelta: 0,\r\n    filter: (evt) => evt.button === 0 && !evt.shiftKey && !evt.ctrlKey,\r\n    onStart: (handle) => handle.classList.add(cssClass('hist-dragging')),\r\n    onDrag: (handle, x) => {\r\n      const total = node.clientWidth;\r\n      const px = Math.max(0, Math.min(x, total));\r\n      const percent = Math.round(100 * px / total);\r\n      (<HTMLElement>handle).dataset.value = context.format(context.unpercent(percent));\r\n      (<HTMLElement>handle).dataset.raw = context.formatRaw(context.unpercent(percent));\r\n\r\n      if ((<HTMLElement>handle).classList.contains(cssClass('histogram-min'))) {\r\n        handle.style.left = `${percent}%`;\r\n        handle.classList.toggle(cssClass('swap-hint'), percent > 15);\r\n        minHint.style.width = `${percent}%`;\r\n        return;\r\n      }\r\n      handle.style.right = `${100 - percent}%`;\r\n      handle.classList.toggle(cssClass('swap-hint'), percent < 85);\r\n      maxHint.style.width = `${100 - percent}%`;\r\n    },\r\n    onEnd: (handle) => {\r\n      handle.classList.remove(cssClass('hist-dragging'));\r\n      setFilter();\r\n    }\r\n  };\r\n  dragHandle(min, options);\r\n  dragHandle(max, options);\r\n\r\n  return (missing: number, f: IFilterInfo<T>) => {\r\n    minHint.style.width = `${context.percent(f.filterMin)}%`;\r\n    maxHint.style.width = `${100 - context.percent(f.filterMax)}%`;\r\n    min.dataset.value = context.format(f.filterMin);\r\n    max.dataset.value = context.format(f.filterMax);\r\n    min.dataset.raw = context.formatRaw(f.filterMin);\r\n    max.dataset.raw = context.formatRaw(f.filterMax);\r\n    min.style.left = `${context.percent(f.filterMin)}%`;\r\n    max.style.right = `${100 - context.percent(f.filterMax)}%`;\r\n    min.classList.toggle(cssClass('swap-hint'), context.percent(f.filterMin) > 15);\r\n    max.classList.toggle(cssClass('swap-hint'), context.percent(f.filterMax) < 85);\r\n    filterMissing.checked = f.filterMissing;\r\n    updateFilterMissingNumberMarkup(<HTMLElement>filterMissing.parentElement, missing);\r\n  };\r\n}\r\n","import {normalizedStatsBuilder, IStatistics, getNumberOfBins} from '../internal';\r\nimport {Column, IDataRow, IOrderedGroup, INumberColumn, INumbersColumn, isNumberColumn, isNumbersColumn, IMapAbleColumn, isMapAbleColumn, Ranking} from '../model';\r\nimport InputNumberDialog from '../ui/dialogs/InputNumberDialog';\r\nimport {colorOf} from './impose';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, IImposer, IRenderTasks, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {cssClass, engineCssClass} from '../styles';\r\nimport {histogramUpdate, histogramTemplate, IHistogramLike, mappingHintTemplate, mappingHintUpdate, IFilterInfo, filteredHistTemplate, IFilterContext, initFilter} from './histogram';\r\nimport {noNumberFilter} from '../model/internalNumber';\r\nimport DialogManager from '../ui/dialogs/DialogManager';\r\n\r\nexport default class HistogramCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Histogram';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return (isNumberColumn(col) && mode !== ERenderMode.CELL) || (isNumbersColumn(col) && mode === ERenderMode.CELL);\r\n  }\r\n\r\n  create(col: INumbersColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const {template, render, guessedBins} = getHistDOMRenderer(col, imposer);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, row: IDataRow) => {\r\n        if (renderMissingDOM(n, col, row)) {\r\n          return;\r\n        }\r\n        const b = normalizedStatsBuilder(guessedBins);\r\n        for (const n of col.getNumbers(row)) {\r\n          b.push(n);\r\n        }\r\n        const hist = b.build();\r\n        render(n, hist);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\r\n    const {template, render} = getHistDOMRenderer(col, imposer);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupNumberStats(col, group).then((r) => {\r\n          if (typeof r === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n\r\n          const {summary, group} = r;\r\n          render(n, group, summary);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: INumberColumn, context: IRenderContext, interactive: boolean, imposer?: IImposer): ISummaryRenderer {\r\n    const r = getHistDOMRenderer(col, imposer);\r\n\r\n    const staticHist = !interactive || !isMapAbleColumn(col);\r\n    return staticHist ? staticSummary(col, context, r.template, r.render) : interactiveSummary(<IMapAbleColumn>col, context, r.template, r.render);\r\n  }\r\n}\r\n\r\n\r\nfunction staticSummary(col: INumberColumn, context: IRenderContext, template: string, render: (n: HTMLElement, stats: IStatistics, unfiltered?: IStatistics) => void) {\r\n  if (isMapAbleColumn(col)) {\r\n    template += mappingHintTemplate(col.getRange());\r\n  }\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (node: HTMLElement) => {\r\n      if (isMapAbleColumn(col)) {\r\n        mappingHintUpdate(node, col.getRange());\r\n      }\r\n\r\n      return context.tasks.summaryNumberStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\r\n        node.classList.toggle(cssClass('missing'), isMissing);\r\n        if (isMissing) {\r\n          return;\r\n        }\r\n        render(node, r.summary);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nfunction interactiveSummary(col: IMapAbleColumn, context: IRenderContext, template: string, render: (n: HTMLElement, stats: IStatistics, unfiltered?: IStatistics) => void) {\r\n  const fContext = createFilterContext(col, context);\r\n  template += filteredHistTemplate(fContext, createFilterInfo(col));\r\n\r\n  let updateFilter: (missing: number, f: IFilterInfo<number>) => void;\r\n\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (node: HTMLElement) => {\r\n      if (!updateFilter) {\r\n        updateFilter = initFilter(node, fContext);\r\n      }\r\n      return context.tasks.summaryNumberStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const {summary, data} = r;\r\n\r\n        updateFilter(data ? data.missing : (summary ? summary.missing : 0), createFilterInfo(col));\r\n\r\n        node.classList.add(cssClass('histogram-i'));\r\n        node.classList.toggle(cssClass('missing'), !summary);\r\n        if (!summary) {\r\n          return;\r\n        }\r\n        render(node, summary, data);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport function createNumberFilter(col: INumberColumn & IMapAbleColumn, parent: HTMLElement, context: {idPrefix: string, dialogManager: DialogManager, tasks: IRenderTasks}, livePreviews: boolean) {\r\n  const renderer = getHistDOMRenderer(col);\r\n  const fContext = createFilterContext(col, context);\r\n\r\n  parent.innerHTML = `${renderer.template}${filteredHistTemplate(fContext, createFilterInfo(col))}</div>`;\r\n  const summaryNode = <HTMLElement>parent.firstElementChild!;\r\n  summaryNode.classList.add(cssClass('summary'), cssClass('renderer'));\r\n  summaryNode.dataset.renderer = 'histogram';\r\n  summaryNode.dataset.interactive = '';\r\n  summaryNode.classList.add(cssClass('histogram-i'));\r\n\r\n  const applyFilter = fContext.setFilter;\r\n  let currentFilter = createFilterInfo(col);\r\n  fContext.setFilter = (filterMissing, min, max) => {\r\n    currentFilter = {filterMissing, filterMin: min, filterMax: max};\r\n    if (livePreviews) {\r\n      applyFilter(filterMissing, min, max);\r\n    }\r\n  };\r\n\r\n  const updateFilter = initFilter(summaryNode, fContext);\r\n\r\n  const rerender = () => {\r\n    const ready = context.tasks.summaryNumberStats(col).then((r) => {\r\n      if (typeof r === 'symbol') {\r\n        return;\r\n      }\r\n      const {summary, data} = r;\r\n      updateFilter(data ? data.missing : (summary ? summary.missing : 0), currentFilter);\r\n      summaryNode.classList.toggle(cssClass('missing'), !summary);\r\n      if (!summary) {\r\n        return;\r\n      }\r\n      renderer.render(summaryNode, summary, data);\r\n    });\r\n    if (!ready) {\r\n      return;\r\n    }\r\n    summaryNode.classList.add(engineCssClass('loading'));\r\n    ready.then(() => {\r\n      summaryNode.classList.remove(engineCssClass('loading'));\r\n    });\r\n  };\r\n\r\n  const ranking = col.findMyRanker()!;\r\n\r\n  if (ranking) {\r\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, () => rerender());\r\n  }\r\n  rerender();\r\n\r\n  return {\r\n    cleanUp() {\r\n      if (ranking) {\r\n        ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, null);\r\n      }\r\n    },\r\n    reset() {\r\n      currentFilter = createFilterInfo(col, noNumberFilter());\r\n      rerender();\r\n    },\r\n    submit() {\r\n      applyFilter(currentFilter.filterMissing, currentFilter.filterMin, currentFilter.filterMax);\r\n    }\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport function getHistDOMRenderer(col: INumberColumn, imposer?: IImposer) {\r\n  const ranking = col.findMyRanker();\r\n  const guessedBins = ranking ? getNumberOfBins(ranking.getOrderLength()) : 10;\r\n  const formatter = col.getNumberFormat();\r\n\r\n  const render = (n: HTMLElement, stats: IHistogramLike<number>, unfiltered?: IHistogramLike<number>) => {\r\n    return histogramUpdate(n, stats, unfiltered || null, formatter, (bin) => colorOf(col, null, imposer, (bin.x1 + bin.x0) / 2)!);\r\n  };\r\n  return {\r\n    template: histogramTemplate(guessedBins),\r\n    render,\r\n    guessedBins\r\n  };\r\n}\r\n\r\nfunction createFilterInfo(col: IMapAbleColumn, filter = col.getFilter()): IFilterInfo<number> {\r\n  const domain = col.getMapping().domain;\r\n  const filterMin = isFinite(filter.min) ? filter.min : domain[0];\r\n  const filterMax = isFinite(filter.max) ? filter.max : domain[1];\r\n  return {\r\n    filterMissing: filter.filterMissing,\r\n    filterMin,\r\n    filterMax\r\n  };\r\n}\r\n\r\nfunction createFilterContext(col: IMapAbleColumn, context: {idPrefix: string, dialogManager: DialogManager}): IFilterContext<number> {\r\n  const domain = col.getMapping().domain;\r\n  const format = col.getNumberFormat();\r\n  const clamp = (v: number) => Math.max(0, Math.min(100, v));\r\n  const percent = (v: number) => clamp(Math.round(100 * (v - domain[0]) / (domain[1] - domain[0])));\r\n  const unpercent = (v: number) => ((v / 100) * (domain[1] - domain[0]) + domain[0]);\r\n  return {\r\n    percent,\r\n    unpercent,\r\n    domain: <[number, number]>domain,\r\n    format,\r\n    formatRaw: String,\r\n    parseRaw: Number.parseFloat,\r\n    setFilter: (filterMissing, minValue, maxValue) => col.setFilter({\r\n      filterMissing,\r\n      min: minValue === domain[0] ? Number.NEGATIVE_INFINITY : minValue,\r\n      max: maxValue === domain[1] ? Number.POSITIVE_INFINITY : maxValue\r\n    }),\r\n    edit: (value, attachment) => {\r\n      return new Promise((resolve) => {\r\n        const dialogCtx = {\r\n          attachment,\r\n          manager: context.dialogManager,\r\n          level: context.dialogManager.maxLevel + 1,\r\n          idPrefix: context.idPrefix\r\n        };\r\n        const dialog = new InputNumberDialog(dialogCtx, resolve, {\r\n            value, min: domain[0], max: domain[1]\r\n          });\r\n        dialog.open();\r\n      });\r\n    }\r\n  };\r\n}\r\n","import {Column, IDataRow, LinkColumn} from '../model';\r\nimport {ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noRenderer} from './utils';\r\nimport {abortAble} from 'lineupengine';\r\n\r\nfunction loadImage(src: string) {\r\n  return new Promise<HTMLImageElement>((resolve) => {\r\n    const image = new Image();\r\n    image.onload = () => resolve(image);\r\n    image.src = src;\r\n  });\r\n}\r\n\r\nexport default class ImageCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Image';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof LinkColumn && mode === ERenderMode.CELL;\r\n  }\r\n\r\n  create(col: LinkColumn): ICellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const missing = renderMissingDOM(n, col, d);\r\n        n.style.backgroundImage = null;\r\n        if (missing) {\r\n          n.title = '';\r\n          return;\r\n        }\r\n        const v = col.getLink(d);\r\n        n.title = v ? v.alt : '';\r\n        if (!v) {\r\n          return;\r\n        }\r\n        return abortAble(loadImage(v.href)).then((image) => {\r\n          if (typeof image === 'symbol') {\r\n            return;\r\n          }\r\n          n.style.backgroundImage = missing || !v ? null : `url('${image.src}')`;\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {ISequence} from '../internal';\r\nimport {Column, IDataRow, IOrderedGroup} from '../model';\r\nimport {ERenderMode, ICellRenderer, ICellRendererFactory, IGroupCellRenderer, IImposer, IRenderContext} from './interfaces';\r\nimport {noRenderer} from './utils';\r\nimport {ISummaryRenderer} from './interfaces';\r\n\r\n/**\r\n * helper class that renders a group renderer as a selected (e.g. median) single item\r\n */\r\nexport abstract class AAggregatedGroupRenderer<T extends Column> implements ICellRendererFactory {\r\n  abstract readonly title: string;\r\n\r\n  abstract canRender(col: Column, mode: ERenderMode): boolean;\r\n\r\n  abstract create(col: T, context: IRenderContext, imposer?: IImposer): ICellRenderer;\r\n\r\n  protected abstract aggregatedIndex(rows: ISequence<IDataRow>, col: T): {row: IDataRow, index: number};\r\n\r\n  createGroup(col: T, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\r\n    const single = this.create(col, context, imposer);\r\n    return {\r\n      template: single.template,\r\n      update: (node: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupRows(col, group, 'aggregated', (rows) => this.aggregatedIndex(rows, col)).then((data) => {\r\n          if (typeof data !== 'symbol') {\r\n            single.update(node, data.row, data.index, group);\r\n          }\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n\r\nexport default AAggregatedGroupRenderer;\r\n","import {ISequence, round} from '../internal';\r\nimport {Column, IDataRow, INumberColumn, isNumberColumn, IMultiLevelColumn, isMultiLevelColumn, IOrderedGroup} from '../model';\r\nimport {medianIndex} from '../model/internalNumber';\r\nimport {COLUMN_PADDING} from '../styles';\r\nimport {AAggregatedGroupRenderer} from './AAggregatedGroupRenderer';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, IImposer, IRenderCallback, IGroupCellRenderer, ICellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {matchColumns, multiLevelGridCSSClass} from './utils';\r\nimport {cssClass} from '../styles';\r\nimport {IAbortAblePromise, abortAbleAll} from 'lineupengine';\r\n\r\n/** @internal */\r\nexport interface ICols {\r\n  column: Column;\r\n  shift: number;\r\n  width: number;\r\n  template: string;\r\n  rendererId: string;\r\n  renderer: ICellRenderer | null;\r\n  groupRenderer: IGroupCellRenderer | null;\r\n  summaryRenderer: ISummaryRenderer | null;\r\n}\r\n\r\n/**\r\n * @internal\r\n * @param parent Parent column\r\n * @param context Render context\r\n * @param stacked Are the columns stacked?\r\n * @param mode Render mode\r\n * @param imposer Imposer object\r\n */\r\nexport function createData(parent: {children: Column[]} & Column, context: IRenderContext, stacked: boolean, mode: ERenderMode, imposer?: IImposer): {cols: ICols[], stacked: boolean, padding: number} {\r\n  const padding = COLUMN_PADDING;\r\n  let offset = 0;\r\n  const cols = parent.children.map((column) => {\r\n    const shift = offset;\r\n    const width = column.getWidth();\r\n    offset += width;\r\n    offset += (!stacked ? padding : 0);\r\n\r\n    const renderer = mode === ERenderMode.CELL ? context.renderer(column, imposer) : null;\r\n    const groupRenderer = mode === ERenderMode.GROUP ? context.groupRenderer(column, imposer) : null;\r\n    const summaryRenderer = mode === ERenderMode.GROUP ? context.summaryRenderer(column, false, imposer) : null;\r\n    let template: string = '';\r\n    let rendererId: string = '';\r\n    switch (mode) {\r\n      case ERenderMode.CELL:\r\n        template = renderer!.template;\r\n        rendererId = column.getRenderer();\r\n        break;\r\n      case ERenderMode.GROUP:\r\n        template = groupRenderer!.template;\r\n        rendererId = column.getGroupRenderer();\r\n        break;\r\n      case ERenderMode.SUMMARY:\r\n        template = summaryRenderer!.template;\r\n        rendererId = column.getSummaryRenderer();\r\n        break;\r\n    }\r\n    // inject data attributes\r\n    template = template.replace(/^<([^ >]+)([ >])/, `<$1 data-column-id=\"${column.id}\" data-renderer=\"${rendererId}\"$2`);\r\n    // inject classes\r\n    if (/^<([^>]+) class=\"([ >]*)/.test(template)) {\r\n      // has class attribute\r\n      template = template.replace(/^<([^>]+) class=\"([ >]*)/, `<$1 class=\"${cssClass(`renderer-${rendererId}`)} $2`);\r\n    } else {\r\n      // inject as the others\r\n      template = template.replace(/^<([^ >]+)([ >])/, `<$1 class=\"${cssClass(`renderer-${rendererId}`)}\"$2`);\r\n    }\r\n    return {\r\n      column,\r\n      shift,\r\n      width,\r\n      template,\r\n      rendererId,\r\n      renderer,\r\n      groupRenderer,\r\n      summaryRenderer\r\n    };\r\n  });\r\n  return {cols, stacked, padding};\r\n}\r\n\r\nexport default class MultiLevelCellRenderer extends AAggregatedGroupRenderer<IMultiLevelColumn & Column> implements ICellRendererFactory {\r\n  readonly title: string;\r\n\r\n  constructor(private readonly stacked: boolean = true) {\r\n    super();\r\n    this.title = this.stacked ? 'Stacked Bar' : 'Nested';\r\n  }\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isMultiLevelColumn(col) && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: IMultiLevelColumn & Column, context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const {cols, stacked} = createData(col, context, this.stacked, ERenderMode.CELL, imposer);\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div class='${multiLevelGridCSSClass(context.idPrefix, col)} ${!stacked ? cssClass('grid-space') : ''}'>${cols.map((d) => d.template).join('')}</div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IOrderedGroup) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return null;\r\n        }\r\n        matchColumns(n, cols, context);\r\n\r\n        const toWait: IAbortAblePromise<void>[] = [];\r\n        const children = <HTMLElement[]>Array.from(n.children);\r\n        const total = col.getWidth();\r\n        let missingWeight = 0;\r\n        cols.forEach((col, ci) => {\r\n          const weight = col.column.getWidth() / total;\r\n          const cnode = children[ci];\r\n          cnode.classList.add(cssClass(this.stacked ? 'stack-sub' : 'nested-sub'), cssClass('detail'));\r\n          cnode.dataset.group = 'd';\r\n          cnode.style.transform = stacked ? `translate(-${round((missingWeight / weight) * 100, 4)}%,0)` : null;\r\n          (<any>cnode.style).gridColumnStart = (ci + 1).toString();\r\n          const r = col.renderer!.update(cnode, d, i, group);\r\n          if (stacked) {\r\n            missingWeight += (1 - (<INumberColumn>col.column).getNumber(d)) * weight;\r\n            if (ci < cols.length - 1) {\r\n              const span = cnode.querySelector('span');\r\n              if (span) {\r\n                span.style.overflow = 'hidden';\r\n              }\r\n            }\r\n          }\r\n          if (r) {\r\n            toWait.push(r);\r\n          }\r\n        });\r\n\r\n        if (toWait.length > 0) {\r\n          return <IAbortAblePromise<void>>abortAbleAll(toWait);\r\n        }\r\n        return null;\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, i: number, group: IOrderedGroup) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return null;\r\n        }\r\n        const toWait: {shift: number, r: IAbortAblePromise<IRenderCallback>}[] = [];\r\n        let stackShift = 0;\r\n        for (const col of cols) {\r\n          const cr = col.renderer!;\r\n          if (cr.render) {\r\n            const shift = col.shift - stackShift;\r\n            ctx.translate(shift, 0);\r\n            const r = cr.render(ctx, d, i, group);\r\n            if (typeof r !== 'boolean' && r) {\r\n              toWait.push({shift, r});\r\n            }\r\n            ctx.translate(-shift, 0);\r\n          }\r\n          if (stacked) {\r\n            stackShift += col.width * (1 - (<INumberColumn>col.column).getNumber(d));\r\n          }\r\n        }\r\n\r\n        if (toWait.length === 0) {\r\n          return null;\r\n        }\r\n\r\n        return abortAbleAll(toWait.map((d) => d.r)).then((callbacks) => {\r\n          return (ctx: CanvasRenderingContext2D) => {\r\n            if (typeof callbacks === 'symbol') {\r\n              return;\r\n            }\r\n            for (let i = 0; i < callbacks.length; ++i) {\r\n              const callback = callbacks[i];\r\n              if (typeof callback !== 'function') {\r\n                continue;\r\n              }\r\n              const shift = toWait[i].shift;\r\n              ctx.translate(shift, 0);\r\n              callback(ctx);\r\n              ctx.translate(-shift, 0);\r\n            }\r\n          };\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n\r\n  createGroup(col: IMultiLevelColumn & Column, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\r\n    if (this.stacked && isNumberColumn(col)) {\r\n      return super.createGroup(col, context, imposer);\r\n    }\r\n\r\n    const {cols} = createData(col, context, false, ERenderMode.GROUP, imposer);\r\n    return {\r\n      template: `<div class='${multiLevelGridCSSClass(context.idPrefix, col)} ${cssClass('grid-space')}'>${cols.map((d) => d.template).join('')}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        matchColumns(n, cols, context);\r\n\r\n        const toWait: IAbortAblePromise<void>[] = [];\r\n        const children = <HTMLElement[]>Array.from(n.children);\r\n        cols.forEach((col, ci) => {\r\n          const cnode = children[ci];\r\n          cnode.classList.add(cssClass(this.stacked ? 'stack-sub' : 'nested-sub'), cssClass('group'));\r\n          cnode.dataset.group = 'g';\r\n          (<any>cnode.style).gridColumnStart = (ci + 1).toString();\r\n          const r = col.groupRenderer!.update(cnode, group);\r\n          if (r) {\r\n            toWait.push(r);\r\n          }\r\n        });\r\n\r\n        if (toWait.length > 0) {\r\n          return <IAbortAblePromise<void>>abortAbleAll(toWait);\r\n        }\r\n        return null;\r\n      }\r\n    };\r\n  }\r\n\r\n  protected aggregatedIndex(rows: ISequence<IDataRow>, col: IMultiLevelColumn & Column) {\r\n    console.assert(isNumberColumn(col));\r\n    return medianIndex(rows, (<INumberColumn><any>col));\r\n  }\r\n}\r\n","import {INumberBin, IStatistics} from '../internal';\r\nimport {Column, CompositeNumberColumn, IDataRow, IOrderedGroup, INumberColumn} from '../model';\r\nimport {CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {getHistDOMRenderer} from './HistogramCellRenderer';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {createData} from './MultiLevelCellRenderer';\r\nimport {colorOf, matchColumns, forEachChild} from './utils';\r\nimport {tasksAll} from '../provider';\r\nimport {IHistogramLike} from './histogram';\r\n\r\n\r\nexport default class InterleavingCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Interleaved';\r\n\r\n  canRender(col: Column) {\r\n    return col instanceof CompositeNumberColumn;\r\n  }\r\n\r\n  create(col: CompositeNumberColumn, context: IRenderContext): ICellRenderer {\r\n    const {cols} = createData(col, context, false, ERenderMode.CELL);\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IOrderedGroup) => {\r\n        const missing = renderMissingDOM(n, col, d);\r\n        if (missing) {\r\n          return;\r\n        }\r\n        matchColumns(n, cols, context);\r\n        forEachChild(n, (ni: HTMLElement, j) => {\r\n          cols[j].renderer!.update(ni, d, i, group);\r\n        });\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, _i: number, group: IOrderedGroup) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n\r\n        ctx.save();\r\n        ctx.scale(1, 1 / cols.length); // scale since internal use the height, too\r\n        cols.forEach((r, i) => {\r\n          const rr = r.renderer!;\r\n          if (rr.render) {\r\n            rr.render(ctx, d, i, group);\r\n          }\r\n          ctx.translate(0, CANVAS_HEIGHT);\r\n        });\r\n        ctx.restore();\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: CompositeNumberColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {cols} = createData(col, context, false, ERenderMode.GROUP);\r\n    return {\r\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        matchColumns(n, cols, context);\r\n        forEachChild(n, (ni: HTMLElement, j) => {\r\n          cols[j].groupRenderer!.update(ni, group);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: CompositeNumberColumn, context: IRenderContext, _interactive: boolean): ISummaryRenderer {\r\n    const cols = col.children;\r\n    let acc = 0;\r\n    const {template, render} = getHistDOMRenderer(col, {\r\n      color: () => colorOf(cols[(acc++) % cols.length])\r\n    });\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement) => {\r\n        const tasks = cols.map((col) => context.tasks.summaryNumberStats(<INumberColumn>col));\r\n\r\n        return tasksAll(tasks).then((vs) => {\r\n          if (typeof vs === 'symbol') {\r\n            return;\r\n          }\r\n          const summaries = vs.map((d) => d.summary);\r\n          if (!summaries.some(Boolean)) {\r\n            n.classList.add(cssClass('missing'));\r\n            return;\r\n          }\r\n          n.classList.remove(cssClass('missing'));\r\n          const grouped = groupedHist(summaries)!;\r\n          render(n, grouped);\r\n        });\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nconst dummyBin: INumberBin = {\r\n  count: 0,\r\n  x0: 0,\r\n  x1: 0\r\n};\r\n\r\nfunction groupedHist(stats: (IStatistics | null)[]): IHistogramLike<number> | null {\r\n  const sample = stats.find(Boolean)!;\r\n  if (!sample) {\r\n    return null;\r\n  }\r\n\r\n  const bins = sample.hist.length;\r\n  // assert all have the same bin size\r\n  const hist = <INumberBin[]>[];\r\n  let maxBin = 0;\r\n  for (let i = 0; i < bins; ++i) {\r\n    stats.forEach((s) => {\r\n      const bin = s ? s.hist[i] : null;\r\n      if (!bin) {\r\n        hist.push(dummyBin);\r\n        return;\r\n      }\r\n      if (bin.count > maxBin) {\r\n        maxBin = bin.count;\r\n      }\r\n      hist.push(bin);\r\n    });\r\n  }\r\n  return {\r\n    maxBin,\r\n    hist\r\n  };\r\n}\r\n","import {LinkColumn, Column, IDataRow, IOrderedGroup} from '../model';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noRenderer, setText} from './utils';\r\nimport {cssClass} from '../styles';\r\nimport {ISequence} from '../internal';\r\n\r\nexport default class LinkCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Link';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof LinkColumn && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: LinkColumn): ICellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<a${align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''} target=\"_blank\" rel=\"noopener\" href=\"\"></a>`,\r\n      update: (n: HTMLAnchorElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        const v = col.getLink(d);\r\n        n.href = v ? v.href : '';\r\n        if (col.escape) {\r\n          setText(n, v ? v.alt : '');\r\n        } else {\r\n          n.innerHTML = v ? v.alt : '';\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private static exampleText(col: LinkColumn, rows: ISequence<IDataRow>) {\r\n    const numExampleRows = 5;\r\n    const examples = <string[]>[];\r\n    rows.every((row) => {\r\n      const v = col.getLink(row);\r\n      if (!v) {\r\n        return true;\r\n      }\r\n      examples.push(`<a target=\"_blank\" rel=\"noopener\"  href=\"${v.href}\">${v.alt}</a>`);\r\n      return examples.length < numExampleRows;\r\n    });\r\n    if (examples.length === 0) {\r\n      return '';\r\n    }\r\n    return `${examples.join(', ')}${examples.length < rows.length ? ', &hellip;' : ''}`;\r\n  }\r\n\r\n  createGroup(col: LinkColumn, context: IRenderContext): IGroupCellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupExampleRows(col, group, 'link', (rows) => LinkCellRenderer.exampleText(col, rows)).then((text) => {\r\n          if (typeof text === 'symbol') {\r\n            return;\r\n          }\r\n          n.classList.toggle(cssClass('missing'), !text);\r\n          n.innerHTML = text;\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IArrayColumn, IKeyValue, IMapColumn, isArrayColumn, isMapColumn, Column, IDataRow, isMissingValue, IOrderedGroup} from '../model';\r\nimport {IRenderContext, ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {forEach, noop} from './utils';\r\nimport {cssClass} from '../styles';\r\nimport {ISequence} from '../internal';\r\n\r\nexport default class TableCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Table';\r\n\r\n  canRender(col: Column) {\r\n    return isMapColumn(col);\r\n  }\r\n\r\n  create(col: IMapColumn<any>): ICellRenderer {\r\n    if (isArrayColumn(col) && col.dataLength) {\r\n      // fixed length optimized rendering\r\n      return this.createFixed(col);\r\n    }\r\n    return {\r\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        node.innerHTML = col.getMapLabel(d).map(({key, value}) => `<div class=\"${cssClass('table-cell')}\">${key}</div><div class=\"${cssClass('table-cell')}\">${value}</div>`).join('');\r\n      }\r\n    };\r\n  }\r\n\r\n  private static template(col: IArrayColumn<any>) {\r\n    const labels = col.labels;\r\n    return `<div>${labels.map((l) => `<div class=\"${cssClass('table-cell')}\">${l}</div><div  class=\"${cssClass('table-cell')}\" data-v></div>`).join('\\n')}</div>`;\r\n  }\r\n\r\n  private createFixed(col: IArrayColumn<any>) {\r\n    return {\r\n      template: TableCellRenderer.template(col),\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        const value = col.getLabels(d);\r\n        forEach(node, '[data-v]', (n: HTMLElement, i) => {\r\n          n.innerHTML = value[i];\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  private static example(arr: IKeyValue<string>[]) {\r\n    const numExampleRows = 5;\r\n    return `${arr.slice(0, numExampleRows).map((d) => d.value).join(', ')}${numExampleRows < arr.length ? ', &hellip;' : ''}`;\r\n  }\r\n\r\n  createGroup(col: IMapColumn<any>, context: IRenderContext): IGroupCellRenderer {\r\n    if (isArrayColumn(col) && col.dataLength) {\r\n      // fixed length optimized rendering\r\n      return this.createFixedGroup(col, context);\r\n    }\r\n    return {\r\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\r\n      update: (node: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupRows(col, group, 'table', (rows) => groupByKey(rows.map((d) => col.getMapLabel(d)))).then((entries) => {\r\n          if (typeof entries === 'symbol') {\r\n            return;\r\n          }\r\n          node.innerHTML = entries.map(({key, values}) => `<div class=\"${cssClass('table-cell')}\">${key}</div><div class=\"${cssClass('table-cell')}\">${TableCellRenderer.example(values)}</div>`).join('');\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  private createFixedGroup(col: IArrayColumn<any>, context: IRenderContext) {\r\n    return {\r\n      template: TableCellRenderer.template(col),\r\n      update: (node: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupExampleRows(col, group, 'table', (rows) => {\r\n          const values: string[][] = col.labels.map(() => []);\r\n          rows.forEach((row) => {\r\n            const labels = col.getLabels(row);\r\n            for (let i = 0; i < Math.min(values.length, labels.length); ++i) {\r\n              if (!isMissingValue(labels[i])) {\r\n                values[i].push(labels[i]);\r\n              }\r\n            }\r\n          });\r\n          return values;\r\n        }).then((values) => {\r\n          if (typeof values === 'symbol') {\r\n            return;\r\n          }\r\n          forEach(node, '[data-v]', (n: HTMLElement, i) => {\r\n            n.innerHTML = `${values[i].join(', ')}&hellip;`;\r\n          });\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return {\r\n      template: `<div class=\"${cssClass('rtable')}\"><div>Key</div><div>Value</div></div>`,\r\n      update: noop\r\n    };\r\n  }\r\n\r\n}\r\n\r\n/** @internal */\r\nexport function groupByKey<T extends {key: string}>(arr: ISequence<ISequence<T>>) {\r\n  const m = new Map<string, T[]>();\r\n  arr.forEach((a) => a.forEach((d) => {\r\n    if (!m.has(d.key)) {\r\n      m.set(d.key, [d]);\r\n    } else {\r\n      m.get(d.key)!.push(d);\r\n    }\r\n  }));\r\n  return Array.from(m).sort((a, b) => a[0].localeCompare(b[0])).map(([key, values]) => ({key, values}));\r\n}\r\n","import {IDataRow, LinkMapColumn, Column, ILink, IKeyValue, IOrderedGroup} from '../model';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {groupByKey} from './TableCellRenderer';\r\nimport {noRenderer, noop} from './utils';\r\nimport {cssClass} from '../styles';\r\n\r\nexport default class LinkMapCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Table with Links';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof LinkMapColumn && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: LinkMapColumn): ICellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        node.innerHTML = col.getLinkMap(d).map(({key, value}) => `\r\n          <div class=\"${cssClass('table-cell')}\">${key}</div>\r\n          <div class=\"${cssClass('table-cell')} ${align !== 'left' ? cssClass(align) : ''}\">\r\n            <a href=\"${value.href}\" target=\"_blank\" rel=\"noopener\">${value.alt}</a>\r\n          </div>`).join('');\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  private static example(arr: IKeyValue<ILink>[]) {\r\n    const numExampleRows = 5;\r\n    const examples = <string[]>[];\r\n    for (const row of arr) {\r\n      if (!row || !row.value.href) {\r\n        continue;\r\n      }\r\n      examples.push(`<a target=\"_blank\" rel=\"noopener\" href=\"${row.value.href}\">${row.value.alt}</a>`);\r\n      if (examples.length >= numExampleRows) {\r\n        break;\r\n      }\r\n    }\r\n    if (examples.length === 0) {\r\n      return '';\r\n    }\r\n    return `${examples.join(', ')}${examples.length < arr.length} ? ', &hellip;': ''}`;\r\n  }\r\n\r\n  createGroup(col: LinkMapColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\r\n      update: (node: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupRows(col, group, 'linkmap', (rows) => groupByKey(rows.map((d) => col.getLinkMap(d)))).then((entries) => {\r\n          if (typeof entries === 'symbol') {\r\n            return;\r\n          }\r\n          node.innerHTML = entries.map(({key, values}) => {\r\n            const data = LinkMapCellRenderer.example(values);\r\n            if (!data) {\r\n              return `<div>${key}</div><div class=\"${cssClass('missing')}\"></div>`;\r\n            }\r\n            return `<div>${key}</div><div${align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''}>${data}</div>`;\r\n          }).join('');\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {noop} from './utils';\r\n\r\nexport default class LoadingCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Loading';\r\n\r\n  canRender(): boolean {\r\n    return false; // just direct selection\r\n  }\r\n\r\n  create() { // no typing because ICellRenderer would not be assignable to IGroupCellRenderer and ISummaryRenderer\r\n    return {\r\n      template: `<div>Loading &hellip;</div>`,\r\n      update: <() => void>noop\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return this.create();\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return this.create();\r\n  }\r\n}\r\n","import {round} from '../internal';\r\nimport {Column, IMapColumn, IMapAbleColumn, isMapAbleColumn, isMapColumn, IDataRow, isNumberColumn, INumberColumn} from '../model';\r\nimport {colorOf} from './impose';\r\nimport {ICellRendererFactory, IImposer, IRenderContext, ERenderMode, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noRenderer} from './utils';\r\nimport {cssClass} from '../styles';\r\n\r\nexport default class MapBarCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Bar Table';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isMapColumn(col) && isNumberColumn(col) && (mode === ERenderMode.CELL || (mode === ERenderMode.SUMMARY && isMapAbleColumn(col)));\r\n  }\r\n\r\n  create(col: IMapColumn<number> & INumberColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\r\n    const formatter = col.getNumberFormat();\r\n\r\n    return {\r\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        node.innerHTML = col.getMap(d).map(({key, value}) => {\r\n          if (isNaN(value)) {\r\n            return `<div class=\"${cssClass('table-cell')}\">${key}</div><div class=\"${cssClass('table-cell')} ${cssClass('missing')}\"></div>`;\r\n          }\r\n          const w = round(value * 100, 2);\r\n          return `<div class=\"${cssClass('table-cell')}\">${key}</div>\r\n            <div class=\"${cssClass('table-cell')}\" title=\"${formatter(value)}\">\r\n              <div style=\"width: ${w}%; background-color: ${colorOf(col, d, imposer)}\">\r\n                <span class=\"${cssClass('hover-only')}\">${value}</span>\r\n              </div>\r\n            </div>`;\r\n        }).join('');\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(col: IMapColumn<number> & IMapAbleColumn): ISummaryRenderer {\r\n    return {\r\n      template: `<div class=\"${cssClass('rtable')}\"><div>Key</div><div><span></span><span></span>Value</div></div>`,\r\n      update: (node: HTMLElement) => {\r\n        const range = col.getRange();\r\n        const value = <HTMLElement>node.lastElementChild!;\r\n        value.firstElementChild!.textContent = range[0];\r\n        value.children[1]!.textContent = range[1];\r\n      }\r\n    };\r\n  }\r\n}\r\n","import {Column, RankColumn, IDataRow, IOrderedGroup} from '../model';\r\nimport {ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noRenderer, setText} from './utils';\r\nimport {cssClass} from '../styles';\r\n\r\nexport default class RankCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column) {\r\n    return col instanceof RankColumn;\r\n  }\r\n\r\n  create(col: Column): ICellRenderer {\r\n    return {\r\n      template: `<div class=\"${cssClass('right')}\"> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        setText(n, col.getLabel(d));\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: Column): IGroupCellRenderer {\r\n    const ranking = col.findMyRanker()!;\r\n    return {\r\n      template: `<div><div></div><div></div></div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        const fromTSpan = <HTMLElement>n.firstElementChild!;\r\n        const toTSpan = <HTMLElement>n.lastElementChild!;\r\n        if (group.order.length === 0) {\r\n          fromTSpan.textContent = '';\r\n          toTSpan.textContent = '';\r\n          return;\r\n        }\r\n        fromTSpan.textContent = ranking.getRank(group.order[0]).toString();\r\n        toTSpan.textContent = ranking.getRank(group.order[group.order.length - 1]).toString();\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {Column, SelectionColumn, IDataRow, IOrderedGroup} from '../model';\r\nimport {IRenderContext, ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {cssClass} from '../styles';\r\nimport {everyIndices} from '../model/internal';\r\nimport {rangeSelection} from '../provider/utils';\r\n\r\nexport default class SelectionRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column) {\r\n    return col instanceof SelectionColumn;\r\n  }\r\n\r\n  create(col: SelectionColumn, ctx: IRenderContext): ICellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (n: HTMLElement, d: IDataRow, i: number) => {\r\n        n.onclick = function (event) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          if (event.shiftKey) {\r\n            const ranking = col.findMyRanker()!.id;\r\n            if (rangeSelection(ctx.provider, ranking, d.i, i, event.ctrlKey)) {\r\n              return;\r\n            }\r\n          }\r\n\r\n          col.toggleValue(d);\r\n        };\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: SelectionColumn, context: IRenderContext): IGroupCellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        let selected = 0;\r\n        let unselected = 0;\r\n        const total = group.order.length;\r\n        everyIndices(group.order, (i) => {\r\n          const s = context.provider.isSelected(i);\r\n          if (s) {\r\n            selected++;\r\n          } else {\r\n            unselected++;\r\n          }\r\n          if (selected * 2 > total || unselected * 2 > total) {\r\n            // more than half already, can abort already decided\r\n            return false;\r\n          }\r\n          return true;\r\n        });\r\n\r\n        n.classList.toggle(cssClass('group-selected'), selected * 2 > total);\r\n        n.onclick = function (event) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          const value = n.classList.toggle(cssClass('group-selected'));\r\n          col.setValues(group.order, value);\r\n        };\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: SelectionColumn, context: IRenderContext): ISummaryRenderer {\r\n    const unchecked = cssClass('icon-unchecked');\r\n    const checked = cssClass('icon-checked');\r\n    return {\r\n      template: `<div title=\"(Un)Select All\" class=\"${unchecked}\"></div>`,\r\n      update: (node: HTMLElement) => {\r\n        node.onclick = (evt) => {\r\n          evt.stopPropagation();\r\n          const isunchecked = node.classList.contains(unchecked);\r\n          if (isunchecked) {\r\n            context.provider.selectAllOf(col.findMyRanker()!);\r\n            node.classList.remove(unchecked);\r\n            node.classList.add(checked);\r\n          } else {\r\n            context.provider.setSelection([]);\r\n            node.classList.remove(checked);\r\n            node.classList.add(unchecked);\r\n          }\r\n        };\r\n      }\r\n    };\r\n  }\r\n}\r\n","import {Column, ICategoricalLikeColumn, IDataRow, IOrderedGroup, ISetColumn, isSetColumn} from '../model';\r\nimport {CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {ICellRendererFactory, IRenderContext, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {forEachChild, noop, wideEnoughCat} from './utils';\r\nimport {round} from '../internal';\r\n\r\nexport default class SetCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Matrix';\r\n\r\n  canRender(col: Column): boolean {\r\n    return isSetColumn(col);\r\n  }\r\n\r\n  private static createDOMContext(col: ICategoricalLikeColumn) {\r\n    const categories = col.categories;\r\n    const mapping = col.getColorMapping();\r\n    let templateRows = '';\r\n    for (const cat of categories) {\r\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" title=\"${cat.label}\" style=\"background-color: ${mapping.apply(cat)}\"></div>`;\r\n    }\r\n    return {\r\n      templateRow: templateRows,\r\n      render: (n: HTMLElement, value: (number | boolean)[]) => {\r\n        forEachChild(n, (d: HTMLElement, i) => {\r\n          const v = value[i];\r\n          d.style.opacity = typeof v === 'boolean' ? (v ? '1' : '0') : round(v, 2).toString();\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\r\n    const {templateRow, render} = SetCellRenderer.createDOMContext(col);\r\n    const width = context.colWidth(col);\r\n    const cellDimension = width / col.dataLength!;\r\n    const cats = col.categories;\r\n    const mapping = col.getColorMapping();\r\n\r\n    return {\r\n      template: `<div class=\"${cssClass('heatmap')}\">${templateRow}</div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        render(n, col.getValues(d));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        // Circle\r\n        const data = col.getValues(d);\r\n\r\n        ctx.save();\r\n        cats.forEach((d, j) => {\r\n          if (!data[j]) {\r\n            return;\r\n          }\r\n          const posx = (j * cellDimension);\r\n          ctx.fillStyle = mapping.apply(d);\r\n          ctx.fillRect(posx, 0, cellDimension, CANVAS_HEIGHT);\r\n        });\r\n\r\n        ctx.restore();\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ISetColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {templateRow, render} = SetCellRenderer.createDOMContext(col);\r\n    return {\r\n      template: `<div class=\"${cssClass('heatmap')}\">${templateRow}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\r\n          if (typeof r === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = !r || !r.group || r.group.count === 0 || r.group.count === r.group.missing;\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          render(n, r.group.hist.map((d) => d.count / r.group.maxBin));\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ICategoricalLikeColumn): ISummaryRenderer {\r\n    const categories = col.categories;\r\n    const mapping = col.getColorMapping();\r\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\r\n    const labels = wideEnoughCat(col);\r\n    for (const cat of categories) {\r\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" title=\"${cat.label}\"${labels ? ` data-title=\"${cat.label}\"` : ''} style=\"background-color: ${mapping.apply(cat)}\"></div>`;\r\n    }\r\n    templateRows += '</div>';\r\n    return {\r\n      template: templateRows,\r\n      update: noop\r\n    };\r\n  }\r\n}\r\n","import {Column, INumbersColumn, NumbersColumn, isNumbersColumn, IDataRow, IOrderedGroup, isMissingValue} from '../model';\r\nimport {matchRows} from './ANumbersCellRenderer';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {forEachChild, noRenderer} from './utils';\r\nimport {ISequence} from '../internal';\r\nimport {cssClass} from '../styles';\r\n\r\n/** @internal */\r\nexport function line(data: ISequence<number>) {\r\n  if (data.length === 0) {\r\n    return '';\r\n  }\r\n  let p = '';\r\n  let moveNext = true;\r\n\r\n  data.forEach((d, i) => {\r\n    if (isNaN(d)) {\r\n      moveNext = true;\r\n    } else if (moveNext) {\r\n      p += `M${i},${1 - d} `;\r\n      moveNext = false;\r\n    } else {\r\n      p += `L${i},${1 - d} `;\r\n    }\r\n  });\r\n  return p;\r\n}\r\n\r\nexport default class SparklineCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Sparkline';\r\n\r\n  canRender(col: Column, mode: ERenderMode) {\r\n    return isNumbersColumn(col) && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: INumbersColumn): ICellRenderer {\r\n    const dataLength = col.dataLength!;\r\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\r\n    return {\r\n      template: `<svg viewBox=\"0 0 ${dataLength - 1} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${dataLength - 1}\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        const data = col.getNumbers(d);\r\n        n.lastElementChild!.setAttribute('d', line(data));\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumbersColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const dataLength = col.dataLength!;\r\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\r\n    return {\r\n      template: `<svg viewBox=\"0 0 ${dataLength} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${dataLength - 1}\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        //overlapping ones\r\n        matchRows(n, group.order.length, `<path></path>`);\r\n        return context.tasks.groupRows(col, group, 'numbers', (r) => Array.from(r.map((d) => col.getNumbers(d)))).then((vs) => {\r\n          if (typeof vs === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = vs.length === 0 || vs.every((v) => v.every(isMissingValue));\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          forEachChild(n, ((row, i) => {\r\n            row.setAttribute('d', line(vs[i]));\r\n          }));\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n}\r\n","import {Column, IDataRow, IOrderedGroup, ISetColumn, isSetColumn} from '../model';\r\nimport {CANVAS_HEIGHT, cssClass, UPSET} from '../styles';\r\nimport {ICellRendererFactory, IRenderContext, ISummaryRenderer, IGroupCellRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\n\r\nexport default class UpSetCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'UpSet';\r\n\r\n  canRender(col: Column) {\r\n    return isSetColumn(col);\r\n  }\r\n\r\n  private static calculateSetPath(setData: boolean[], cellDimension: number) {\r\n    const catindexes: number[] = [];\r\n    setData.forEach((d: boolean, i: number) => (d) ? catindexes.push(i) : -1);\r\n\r\n    const left = (catindexes[0] * cellDimension) + (cellDimension / 2);\r\n    const right = (catindexes[catindexes.length - 1] * cellDimension) + (cellDimension / 2);\r\n\r\n    return {left, right};\r\n  }\r\n\r\n  private static createDOMContext(col: ISetColumn) {\r\n    const categories = col.categories;\r\n    let templateRows = '';\r\n    for (const cat of categories) {\r\n      templateRows += `<div class=\"${cssClass('upset-dot')}\" title=\"${cat.label}\"></div>`;\r\n    }\r\n    return {\r\n      template: `<div><div class=\"${cssClass('upset-line')}\"></div>${templateRows}</div>`,\r\n      render: (n: HTMLElement, value: boolean[]) => {\r\n        Array.from(n.children).slice(1).forEach((d, i) => {\r\n          const v = value[i];\r\n          d.classList.toggle(cssClass('enabled'), v);\r\n        });\r\n\r\n        const line = <HTMLElement>n.firstElementChild;\r\n        const left = value.findIndex((d) => d);\r\n        const right = (value.length - 1) - value.reverse().findIndex((d) => d);\r\n\r\n        if (left < 0 || left === right) {\r\n          line.style.display = 'none';\r\n          return;\r\n        }\r\n        line.style.display = null;\r\n        line.style.left = `${Math.round(100 * (left + 0.5) / value.length)}%`;\r\n        line.style.width = `${Math.round(100 * (right - left) / value.length)}%`;\r\n      }\r\n    };\r\n  }\r\n\r\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\r\n    const {template, render} = UpSetCellRenderer.createDOMContext(col);\r\n    const width = context.colWidth(col);\r\n    const cellDimension = width / col.categories.length;\r\n\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        render(n, col.getValues(d));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        // Circle\r\n        const data = col.getValues(d);\r\n\r\n        const hasTrueValues = data.some((d) => d); //some values are true?\r\n\r\n        ctx.save();\r\n        ctx.fillStyle = UPSET.color;\r\n        ctx.strokeStyle = UPSET.color;\r\n        if (hasTrueValues) {\r\n          const {left, right} = UpSetCellRenderer.calculateSetPath(data, cellDimension);\r\n          ctx.beginPath();\r\n          ctx.moveTo(left, CANVAS_HEIGHT / 2);\r\n          ctx.lineTo(right, CANVAS_HEIGHT / 2);\r\n          ctx.stroke();\r\n        }\r\n\r\n        data.forEach((d, j) => {\r\n          const posx = (j * cellDimension);\r\n          ctx.beginPath();\r\n          ctx.globalAlpha = d ? 1 : UPSET.inactive;\r\n          ctx.fillRect(posx, 0, cellDimension, CANVAS_HEIGHT);\r\n          ctx.fill();\r\n        });\r\n\r\n        ctx.restore();\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ISetColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {template, render} = UpSetCellRenderer.createDOMContext(col);\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\r\n          if (typeof r === 'symbol') {\r\n            return;\r\n          }\r\n          render(n, r.group.hist.map((d) => d.count > 0));\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ISetColumn, context: IRenderContext): ISummaryRenderer {\r\n    const {template, render} = UpSetCellRenderer.createDOMContext(col);\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement) => {\r\n        return context.tasks.summaryCategoricalStats(col).then((r) => {\r\n          if (typeof r === 'symbol') {\r\n            return;\r\n          }\r\n          render(n, r.summary.hist.map((d) => d.count > 0));\r\n        });\r\n      }\r\n    };\r\n  }\r\n}\r\n","import {Column, NumbersColumn, IDataRow, INumbersColumn, isNumbersColumn} from '../model';\r\nimport {CANVAS_HEIGHT, cssClass} from '../styles';\r\nimport {ANumbersCellRenderer} from './ANumbersCellRenderer';\r\nimport {toHeatMapColor} from './BrightnessCellRenderer';\r\nimport {IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ISummaryRenderer} from './interfaces';\r\nimport {forEachChild, noRenderer} from './utils';\r\n\r\nexport default class VerticalBarCellRenderer extends ANumbersCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Bar Chart';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumbersColumn(col) && Boolean(col.dataLength) && mode === ERenderMode.CELL;\r\n  }\r\n\r\n  private static compute(v: number, threshold: number, domain: number[]) {\r\n    if (v < threshold) {\r\n      //threshold to down\r\n      return {height: (threshold - v), bottom: (v - domain[0])};\r\n    }\r\n    //from top to down\r\n    return {height: (v - threshold), bottom: (threshold - domain[0])};\r\n  }\r\n\r\n  protected createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer) {\r\n    const cellDimension = context.colWidth(col) / col.dataLength!;\r\n    const threshold = col.getMapping().apply(NumbersColumn.CENTER);\r\n    const range = 1;\r\n    let templateRows = '';\r\n    for (let i = 0; i < col.dataLength!; ++i) {\r\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" style=\"background-color: white\" title=\"\"></div>`;\r\n    }\r\n    const formatter = col.getNumberFormat();\r\n\r\n    return {\r\n      clazz: cssClass('heatmap'),\r\n      templateRow: templateRows,\r\n      update: (row: HTMLElement, data: number[], raw: number[], item: IDataRow, tooltipPrefix?: string) => {\r\n        const zero = toHeatMapColor(0, item, col, imposer);\r\n        const one = toHeatMapColor(1, item, col, imposer);\r\n\r\n        forEachChild(row, (d: HTMLElement, i) => {\r\n          const v = data[i];\r\n          const {bottom, height} = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\r\n          d.title = `${tooltipPrefix || ''}${formatter(raw[i])}`;\r\n          d.style.backgroundColor = v < threshold ? zero : one;\r\n          d.style.bottom = `${Math.round((100 * bottom) / range)}%`;\r\n          d.style.height = `${Math.round((100 * height) / range)}%`;\r\n        });\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow) => {\r\n        const zero = toHeatMapColor(0, item, col, imposer);\r\n        const one = toHeatMapColor(1, item, col, imposer);\r\n        const scale = CANVAS_HEIGHT / range;\r\n        data.forEach((v, j) => {\r\n          ctx.fillStyle = v < threshold ? zero : one;\r\n          const xpos = (j * cellDimension);\r\n          const {bottom, height} = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\r\n          ctx.fillRect(xpos, (range - height - bottom) * scale, cellDimension, height * scale);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {Column, IDataRow, DateColumn, IOrderedGroup} from '../model';\r\nimport {IRenderContext, ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, noRenderer, setText, exampleText} from './utils';\r\nimport {chooseAggregatedDate} from '../model/internalDate';\r\nimport {cssClass} from '../styles';\r\n\r\nexport default class DateCellRenderer implements ICellRendererFactory {\r\n  title: string = 'Date';\r\n  groupTitle: string = 'Date';\r\n  summaryTitle: string = 'Date';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof DateColumn;\r\n  }\r\n\r\n  create(col: DateColumn): ICellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        setText(n, col.getLabel(d));\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(col: DateColumn, context: IRenderContext): IGroupCellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\r\n        const isGrouped = col.isGroupedBy() >= 0;\r\n        if (isGrouped) {\r\n          return context.tasks.groupRows(col, group, 'date', (rows) => chooseAggregatedDate(rows, col.getDateGrouper(), col)).then((chosen) => {\r\n            if (typeof chosen === 'symbol') {\r\n              return;\r\n            }\r\n            n.classList.toggle(cssClass('missing'), !chosen);\r\n            setText(n, chosen ? chosen.name : '');\r\n          });\r\n        }\r\n        return context.tasks.groupExampleRows(col, group, 'date', (sample) => exampleText(col, sample)).then((text) => {\r\n          if (typeof text === 'symbol') {\r\n            return;\r\n          }\r\n          n.classList.toggle(cssClass('missing'), !text);\r\n          setText(n, text);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDialogContext} from './ADialog';\r\nimport {timeFormat} from 'd3-time-format';\r\nimport APopup from './APopup';\r\n\r\n/** @internal */\r\nexport interface IInputDateOptions {\r\n  value: Date | null;\r\n  label: string | null;\r\n}\r\n\r\n/** @internal */\r\nexport default class InputDateDialog extends APopup {\r\n\r\n  private readonly ioptions: Readonly<IInputDateOptions> = {\r\n    value: null,\r\n    label: null\r\n  };\r\n\r\n  constructor(dialog: IDialogContext, private readonly callback: (value: Date | null) => void, options: Partial<IInputDateOptions> = {}) {\r\n    super(dialog);\r\n    Object.assign(this.ioptions, options);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const o = this.ioptions;\r\n\r\n    const f = timeFormat('%Y-%m-%d');\r\n\r\n    node.insertAdjacentHTML('beforeend', `\r\n     <input type=\"date\" value=\"${o.value ? f(o.value) : ''}\" required autofocus placeholder=\"${o.label ? o.label : 'enter date'}\">\r\n    `);\r\n    this.findInput('input[type=date]').addEventListener('keypress', (evt) => {\r\n      if (evt.key === 'Enter') {\r\n        this.triggerSubmit();\r\n      }\r\n    });\r\n    this.enableLivePreviews('input');\r\n  }\r\n\r\n  submit() {\r\n    this.callback(this.findInput('input[type=date]').valueAsDate);\r\n    return true;\r\n  }\r\n}\r\n","import {dateStatsBuilder, IDateStatistics} from '../internal';\r\nimport {Column, IDataRow, IDateColumn, IDatesColumn, IOrderedGroup, isDateColumn, isDatesColumn, Ranking} from '../model';\r\nimport {cssClass, engineCssClass} from '../styles';\r\nimport {ERenderMode, ICellRendererFactory, IRenderContext, ICellRenderer, IGroupCellRenderer, ISummaryRenderer, IRenderTasks} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {colorOf} from './utils';\r\nimport {histogramUpdate, histogramTemplate, mappingHintTemplate, mappingHintUpdate, IFilterInfo, IFilterContext, filteredHistTemplate, initFilter} from './histogram';\r\nimport InputDateDialog from '../ui/dialogs/InputDateDialog';\r\nimport {shiftFilterDateDay, noDateFilter} from '../model/internalDate';\r\nimport DialogManager from '../ui/dialogs/DialogManager';\r\n\r\nexport default class DateHistogramCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Histogram';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return (isDateColumn(col) && mode !== ERenderMode.CELL) || (isDatesColumn(col) && mode === ERenderMode.CELL);\r\n  }\r\n\r\n  create(col: IDatesColumn, _context: IRenderContext): ICellRenderer {\r\n    const {template, render} = getHistDOMRenderer(col);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, row: IDataRow) => {\r\n        if (renderMissingDOM(n, col, row)) {\r\n          return;\r\n        }\r\n        const b = dateStatsBuilder();\r\n        for (const n of col.getDates(row)) {\r\n          b.push(n);\r\n        }\r\n        const hist = b.build();\r\n        render(n, hist);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: IDateColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {template, render} = getHistDOMRenderer(col);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, group: IOrderedGroup) => {\r\n        return context.tasks.groupDateStats(col, group).then((r) => {\r\n          if (typeof r === 'symbol') {\r\n            return;\r\n          }\r\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\r\n          n.classList.toggle(cssClass('missing'), isMissing);\r\n          if (isMissing) {\r\n            return;\r\n          }\r\n          render(n, r.group);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: IDateColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\r\n    const r = getHistDOMRenderer(col);\r\n    return interactive ? interactiveSummary(col, context, r.template, r.render) : staticSummary(col, context, false, r.template, r.render);\r\n  }\r\n}\r\n\r\n\r\nfunction staticSummary(col: IDateColumn, context: IRenderContext, interactive: boolean, template: string, render: (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => void) {\r\n  template += mappingHintTemplate(['', '']);\r\n\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (node: HTMLElement) => {\r\n      return context.tasks.summaryDateStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const {summary, data} = r;\r\n\r\n        node.classList.toggle(cssClass('missing'), !summary);\r\n        if (!summary) {\r\n          return;\r\n        }\r\n        const formatter = col.getFormatter();\r\n        mappingHintUpdate(node, [formatter(summary.min), formatter(summary.max)]);\r\n\r\n        render(node, summary, interactive ? data: undefined);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n\r\nfunction interactiveSummary(col: IDateColumn, context: IRenderContext, template: string, render: (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => void) {\r\n  const filter = col.getFilter();\r\n  const dummyDomain: [number, number] = [isFinite(filter.min) ? filter.min : 0, isFinite(filter.max) ? filter.max : 100];\r\n\r\n  template += filteredHistTemplate(createFilterContext(col, context, dummyDomain), createFilterInfo(col, dummyDomain));\r\n\r\n  let fContext: IFilterContext<number>;\r\n  let updateFilter: (missing: number, f: IFilterInfo<number>) => void;\r\n\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (node: HTMLElement) => {\r\n      return context.tasks.summaryDateStats(col).then((r) => {\r\n        if (typeof r === 'symbol') {\r\n          return;\r\n        }\r\n        const {summary, data} = r;\r\n        if (!updateFilter) {\r\n          const domain: [number, number] = [data.min ? data.min.getTime() : Date.now(), data.max ? data.max.getTime() : Date.now()];\r\n          fContext = createFilterContext(col, context, domain);\r\n          updateFilter = initFilter(node, fContext);\r\n        }\r\n\r\n        updateFilter(data ? data.missing : (summary ? summary.missing : 0), createFilterInfo(col, fContext.domain));\r\n\r\n        node.classList.add(cssClass('histogram-i'));\r\n        node.classList.toggle(cssClass('missing'), !summary);\r\n        if (!summary) {\r\n          return;\r\n        }\r\n        render(node, summary, data);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function createDateFilter(col: IDateColumn, parent: HTMLElement, context: {idPrefix: string, dialogManager: DialogManager, tasks: IRenderTasks}, livePreviews: boolean) {\r\n  const renderer = getHistDOMRenderer(col);\r\n  const filter = col.getFilter();\r\n\r\n  let domain: [number, number] = [isFinite(filter.min) ? filter.min : 0, isFinite(filter.max) ? filter.max : 100];\r\n\r\n  let fContext = createFilterContext(col, context, domain);\r\n  let applyFilter = fContext.setFilter;\r\n  let currentFilter = createFilterInfo(col, domain);\r\n  fContext.setFilter = (filterMissing, min, max) => {\r\n    currentFilter = {filterMissing, filterMin: min, filterMax: max};\r\n    if (livePreviews) {\r\n      applyFilter(filterMissing, min, max);\r\n    }\r\n  };\r\n  parent.innerHTML = `${renderer.template}${filteredHistTemplate(fContext, createFilterInfo(col, domain))}</div>`;\r\n  const summaryNode = <HTMLElement>parent.firstElementChild!;\r\n  summaryNode.classList.add(cssClass('summary'), cssClass('renderer'));\r\n  summaryNode.dataset.renderer = 'histogram';\r\n  summaryNode.dataset.interactive = '';\r\n  summaryNode.classList.add(cssClass('histogram-i'));\r\n\r\n\r\n  let updateFilter: null | ((missing: number, filter: IFilterInfo<number>) => void) = null;\r\n  const prepareRender = (min: Date | null, max: Date | null) => {\r\n    // reinit with proper domain\r\n    domain = [min ? min.getTime() : Date.now(), max ? max.getTime() : Date.now()];\r\n    fContext = createFilterContext(col, context, domain);\r\n    applyFilter = fContext.setFilter;\r\n    currentFilter = createFilterInfo(col, domain);\r\n    fContext.setFilter = (filterMissing, min, max) => {\r\n      currentFilter = {filterMissing, filterMin: min, filterMax: max};\r\n      if (livePreviews) {\r\n        applyFilter(filterMissing, min, max);\r\n      }\r\n    };\r\n    return initFilter(summaryNode, fContext);\r\n  };\r\n\r\n  const rerender = () => {\r\n    const ready = context.tasks.summaryDateStats(col).then((r) => {\r\n      if (typeof r === 'symbol') {\r\n        return;\r\n      }\r\n      const {summary, data} = r;\r\n      if (!updateFilter) {\r\n        updateFilter = prepareRender(data.min, data.max);\r\n      }\r\n      updateFilter(data ? data.missing : (summary ? summary.missing : 0), currentFilter);\r\n      summaryNode.classList.toggle(cssClass('missing'), !summary);\r\n      if (!summary) {\r\n        return;\r\n      }\r\n      renderer.render(summaryNode, summary, data);\r\n    });\r\n    if (!ready) {\r\n      return;\r\n    }\r\n    summaryNode.classList.add(engineCssClass('loading'));\r\n    ready.then(() => {\r\n      summaryNode.classList.remove(engineCssClass('loading'));\r\n    });\r\n  };\r\n\r\n  const ranking = col.findMyRanker()!;\r\n\r\n  if (ranking) {\r\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, () => rerender());\r\n  }\r\n  rerender();\r\n\r\n  return {\r\n    cleanUp() {\r\n      if (ranking) {\r\n        ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, null);\r\n      }\r\n    },\r\n    reset() {\r\n      currentFilter = createFilterInfo(col, domain, noDateFilter());\r\n      rerender();\r\n    },\r\n    submit() {\r\n      applyFilter(currentFilter.filterMissing, currentFilter.filterMin, currentFilter.filterMax);\r\n    }\r\n  };\r\n}\r\n\r\n\r\nfunction getHistDOMRenderer(col: IDateColumn) {\r\n  const guessedBins = 10;\r\n\r\n  const formatter = col.getFormatter();\r\n  const color = colorOf(col)!;\r\n\r\n  const render = (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => {\r\n    return histogramUpdate(n, stats, unfiltered || null, formatter, () => color);\r\n  };\r\n  return {\r\n    template: histogramTemplate(guessedBins),\r\n    render,\r\n    guessedBins\r\n  };\r\n}\r\n\r\nfunction createFilterInfo(col: IDateColumn, domain: [number, number], filter = col.getFilter()): IFilterInfo<number> {\r\n  const filterMin = isFinite(filter.min) ? filter.min : domain[0];\r\n  const filterMax = isFinite(filter.max) ? filter.max : domain[1];\r\n  return {\r\n    filterMissing: filter.filterMissing,\r\n    filterMin,\r\n    filterMax\r\n  };\r\n}\r\n\r\nfunction createFilterContext(col: IDateColumn, context: {idPrefix: string, dialogManager: DialogManager}, domain: [number, number]): IFilterContext<number> {\r\n  const clamp = (v: number) => Math.max(0, Math.min(100, v));\r\n  const percent = (v: number) => clamp(Math.round(100 * (v - domain[0]) / (domain[1] - domain[0])));\r\n  const unpercent = (v: number) => ((v / 100) * (domain[1] - domain[0]) + domain[0]);\r\n  return {\r\n    percent,\r\n    unpercent,\r\n    domain,\r\n    format: (v) => isNaN(v) ? '' : col.getFormatter()(new Date(v)),\r\n    formatRaw: String,\r\n    parseRaw: (v) => Number.parseInt(v, 10),\r\n    setFilter: (filterMissing, minValue, maxValue) => col.setFilter({\r\n      filterMissing,\r\n      min: Math.abs(minValue - domain[0]) < 0.001 ? Number.NEGATIVE_INFINITY : shiftFilterDateDay(minValue, 'min'),\r\n      max: Math.abs(maxValue - domain[1]) < 0.001 ? Number.POSITIVE_INFINITY : shiftFilterDateDay(maxValue, 'max')\r\n    }),\r\n    edit: (value, attachment, type) => {\r\n      return new Promise((resolve) => {\r\n        const dialogCtx = {\r\n          attachment,\r\n          manager: context.dialogManager,\r\n          level: context.dialogManager.maxLevel + 1,\r\n          idPrefix: context.idPrefix\r\n        };\r\n        const dialog = new InputDateDialog(dialogCtx, (d) => resolve(d == null ? NaN : shiftFilterDateDay(d.getTime(), type)), {value: isNaN(value) ? null : new Date(value)});\r\n        dialog.open();\r\n      });\r\n    }\r\n  };\r\n}\r\n","import {Column} from '../model';\r\nimport ActionRenderer from './ActionRenderer';\r\nimport AggregateGroupRenderer from './AggregateGroupRenderer';\r\nimport AnnotationRenderer from './AnnotationRenderer';\r\nimport BarCellRenderer from './BarCellRenderer';\r\nimport BooleanCellRenderer from './BooleanCellRenderer';\r\nimport BoxplotCellRenderer from './BoxplotCellRenderer';\r\nimport BrightnessCellRenderer from './BrightnessCellRenderer';\r\nimport CategoricalCellRenderer from './CategoricalCellRenderer';\r\nimport CategoricalHeatmapCellRenderer from './CategoricalHeatmapCellRenderer';\r\nimport CategoricalStackedDistributionlCellRenderer from './CategoricalStackedDistributionlCellRenderer';\r\nimport CircleCellRenderer from './CircleCellRenderer';\r\nimport {DefaultCellRenderer} from './DefaultCellRenderer';\r\nimport DotCellRenderer from './DotCellRenderer';\r\nimport GroupCellRenderer from './GroupCellRenderer';\r\nimport HeatmapCellRenderer from './HeatmapCellRenderer';\r\nimport HistogramCellRenderer from './HistogramCellRenderer';\r\nimport ImageCellRenderer from './ImageCellRenderer';\r\nimport {ERenderMode, ICellRendererFactory} from './interfaces';\r\nimport InterleavingCellRenderer from './InterleavingCellRenderer';\r\nimport LinkCellRenderer from './LinkCellRenderer';\r\nimport LinkMapCellRenderer from './LinkMapCellRenderer';\r\nimport LoadingCellRenderer from './LoadingCellRenderer';\r\nimport MapBarCellRenderer from './MapBarCellRenderer';\r\nimport MultiLevelCellRenderer from './MultiLevelCellRenderer';\r\nimport RankCellRenderer from './RankCellRenderer';\r\nimport SelectionRenderer from './SelectionRenderer';\r\nimport SetCellRenderer from './SetCellRenderer';\r\nimport SparklineCellRenderer from './SparklineCellRenderer';\r\nimport StringCellRenderer from './StringCellRenderer';\r\nimport TableCellRenderer from './TableCellRenderer';\r\nimport UpSetCellRenderer from './UpSetCellRenderer';\r\nimport VerticalBarCellRenderer from './VerticalBarCellRenderer';\r\nimport DateCellRenderer from './DateCellRenderer';\r\nimport DateHistogramCellRenderer from './DateHistogramCellRenderer';\r\n\r\nconst defaultCellRenderer = new DefaultCellRenderer();\r\n/**\r\n * default render factories\r\n */\r\nexport const renderers: { [key: string]: ICellRendererFactory } = {\r\n  actions: new ActionRenderer(),\r\n  aggregate: new AggregateGroupRenderer(),\r\n  annotate: new AnnotationRenderer(),\r\n  boolean: new BooleanCellRenderer(),\r\n  boxplot: new BoxplotCellRenderer(),\r\n  brightness: new BrightnessCellRenderer(),\r\n  catdistributionbar: new CategoricalStackedDistributionlCellRenderer(),\r\n  categorical: new CategoricalCellRenderer(),\r\n  circle: new CircleCellRenderer(),\r\n  date: new DateCellRenderer(),\r\n  default: defaultCellRenderer,\r\n  dot: new DotCellRenderer(),\r\n  group: new GroupCellRenderer(),\r\n  heatmap: new HeatmapCellRenderer(),\r\n  catheatmap: new CategoricalHeatmapCellRenderer(),\r\n  histogram: new HistogramCellRenderer(),\r\n  datehistogram: new DateHistogramCellRenderer(),\r\n  image: new ImageCellRenderer(),\r\n  interleaving: new InterleavingCellRenderer(),\r\n  link: new LinkCellRenderer(),\r\n  linkMap: new LinkMapCellRenderer(),\r\n  loading: new LoadingCellRenderer(),\r\n  nested: new MultiLevelCellRenderer(false),\r\n  number: new BarCellRenderer(),\r\n  mapbars: new MapBarCellRenderer(),\r\n  rank: new RankCellRenderer(),\r\n  selection: new SelectionRenderer(),\r\n  set: new SetCellRenderer(),\r\n  sparkline: new SparklineCellRenderer(),\r\n  stack: new MultiLevelCellRenderer(),\r\n  string: new StringCellRenderer(),\r\n  table: new TableCellRenderer(),\r\n  upset: new UpSetCellRenderer(),\r\n  verticalbar: new VerticalBarCellRenderer()\r\n};\r\n\r\nexport function chooseRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\r\n  const r = renderers[col.getRenderer()];\r\n  return r && typeof r.create === 'function' ? r : defaultCellRenderer;\r\n}\r\n\r\nexport function chooseGroupRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\r\n  const r = renderers[col.getGroupRenderer()];\r\n  return r && typeof r.createGroup === 'function' ? r : defaultCellRenderer;\r\n}\r\n\r\nexport function chooseSummaryRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\r\n  const r = renderers[col.getSummaryRenderer()];\r\n  return r && typeof r.createSummary === 'function' ? r : defaultCellRenderer;\r\n}\r\n\r\n/**\r\n * determined the list of possible renderers for a given colum\r\n * @param col the column to resolve the renderers\r\n * @param renderers map of possible renderers\r\n * @param canRender optional custom canRender function\r\n */\r\nexport function getPossibleRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }, canRender?: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean) {\r\n  const all = Object.keys(renderers).filter(Boolean).map((type) => ({type, factory: renderers[type]}));\r\n\r\n  const item = all.filter(({type, factory}) => typeof factory.create === 'function' && factory.canRender(col, ERenderMode.CELL) && (!canRender || canRender(type, factory, col, ERenderMode.CELL)));\r\n  const group = all.filter(({type, factory}) => typeof factory.createGroup === 'function' && factory.canRender(col, ERenderMode.GROUP) && (!canRender || canRender(type, factory, col, ERenderMode.GROUP)));\r\n  const summary = all.filter(({type, factory}) => typeof factory.createSummary === 'function' && factory.canRender(col, ERenderMode.SUMMARY) && (!canRender || canRender(type, factory, col, ERenderMode.SUMMARY)));\r\n\r\n  return {\r\n    item: item.map(({type, factory}) => ({type, label: factory.title})),\r\n    group: group.map(({type, factory}) => ({type, label: factory.groupTitle || factory.title})),\r\n    summary: summary.map(({type, factory}) => ({type, label: factory.summaryTitle || factory.groupTitle || factory.title}))\r\n  };\r\n}\r\n","import {BooleanColumn} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class BooleanFilterDialog extends ADialog {\r\n\r\n  private readonly before: boolean | null;\r\n\r\n  constructor(private readonly column: BooleanColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      livePreview: 'filter'\r\n    });\r\n    this.before = this.column.getFilter();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.insertAdjacentHTML('beforeend', `\r\n     <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"boolean_check\" value=\"null\" ${this.before == null ? 'checked=\"checked\"' : ''}><span>No Filter</span></label>\r\n     <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"boolean_check\" value=\"true\" ${this.before === true ? 'checked=\"checked\"' : ''}><span>True</span></label>\r\n     <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"boolean_check\" value=\"false\" ${this.before === false ? 'checked=\"checked\"' : ''}><span>False</span></label>\r\n    `);\r\n    this.enableLivePreviews('input[type=radio]');\r\n  }\r\n\r\n  private updateFilter(filter: boolean | null) {\r\n    this.column.setFilter(filter);\r\n  }\r\n\r\n  protected reset() {\r\n    const v = 'null';\r\n    this.forEach('input[type=\"radio\"]', (d: HTMLInputElement) => d.checked = d.value === v);\r\n  }\r\n\r\n  protected cancel() {\r\n    this.updateFilter(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    const isTrue = this.findInput('input[type=\"radio\"][value=\"true\"]').checked;\r\n    const isFalse = this.findInput('input[type=\"radio\"][value=\"false\"]').checked;\r\n    this.updateFilter(isTrue ? true : (isFalse ? false : null));\r\n    return true;\r\n  }\r\n}\r\n","import {ICategoricalColumn, CategoricalsColumn, CategoricalMapColumn, ICategory, ICategoricalColorMappingFunction} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {uniqueId} from './utils';\r\nimport {cssClass} from '../../styles';\r\nimport {color} from 'd3-color';\r\nimport {schemeCategory10, schemeAccent, schemeDark2, schemePastel1, schemePastel2, schemeSet1, schemeSet2, schemeSet3} from 'd3-scale-chromatic';\r\nimport {DEFAULT_CATEGORICAL_COLOR_FUNCTION, ReplacmentColorMappingFunction} from '../../model/CategoricalColorMappingFunction';\r\n\r\nconst sets: {[key: string]: ReadonlyArray<string>} = {schemeCategory10, schemeAccent, schemeDark2, schemePastel1, schemePastel2, schemeSet1, schemeSet2, schemeSet3};\r\n\r\n/** @internal */\r\nexport default class CategoricalColorMappingDialog extends ADialog {\r\n\r\n  private readonly before: ICategoricalColorMappingFunction;\r\n\r\n  constructor(private readonly column: ICategoricalColumn | CategoricalsColumn | CategoricalMapColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      livePreview: 'colorMapping'\r\n    });\r\n\r\n    this.before = column.getColorMapping().clone();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n    const mapping = this.column.getColorMapping();\r\n    node.insertAdjacentHTML('beforeend', `<div class=\"${cssClass('dialog-table')}\">\r\n      <div class=\"${cssClass('dialog-color-table-entry')}\">\r\n        <select id=\"${id}Chooser\">\r\n          <option value=\"\">Apply Color Scheme...</option>\r\n          <option value=\"schemeCategory10\">D3 Category 10 (${schemeCategory10.length})</option>\r\n          <option value=\"schemeSet1\">Set 1 (${schemeSet1.length})</option>\r\n          <option value=\"schemeSet2\">Set 2 (${schemeSet2.length})</option>\r\n          <option value=\"schemeSet3\">Set 3 (${schemeSet3.length})</option>\r\n          <option value=\"schemeAccent\">Accent (${schemeAccent.length})</option>\r\n          <option value=\"schemeDark2\">Dark2 (${schemeDark2.length})</option>\r\n          <option value=\"schemePastel1\">Pastel 1 (${schemePastel1.length})</option>\r\n          <option value=\"schemePastel2\">Pastel 2 (${schemePastel2.length})</option>\r\n        </select>\r\n      </div>\r\n      ${this.column.categories.map((d) => `\r\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-color-table-entry')}\">\r\n          <input data-cat=\"${d.name}\" type=\"color\" value=\"${color(mapping.apply(d))!.hex()}\">\r\n          <span>${d.label}</span>\r\n        </label>`).join('')}\r\n    </div>`);\r\n\r\n    this.findInput('select').onchange = (evt) => {\r\n      const scheme = sets[(<HTMLInputElement>evt.currentTarget).value];\r\n      if (!scheme) {\r\n        return;\r\n      }\r\n      this.forEach('[data-cat]', (n: HTMLInputElement, i) => {\r\n        n.value = scheme[i % scheme.length];\r\n      });\r\n      if (this.showLivePreviews()) {\r\n        this.submit();\r\n      }\r\n    };\r\n\r\n    this.enableLivePreviews('input[type=color]');\r\n  }\r\n\r\n  reset() {\r\n    const cats = this.column.categories;\r\n    this.forEach('[data-cat]', (n: HTMLInputElement, i) => {\r\n      n.value = color(cats[i]!.color)!.hex();\r\n    });\r\n  }\r\n\r\n  submit() {\r\n    const cats = this.column.categories;\r\n    const map = new Map<ICategory, string>();\r\n    this.forEach('input[data-cat]', (n: HTMLInputElement, i) => {\r\n      const cat = cats[i];\r\n      if (color(cat.color)!.hex() !== n.value) {\r\n        map.set(cat, n.value);\r\n      }\r\n    });\r\n    if (map.size === 0) {\r\n      this.column.setColorMapping(DEFAULT_CATEGORICAL_COLOR_FUNCTION);\r\n    } else {\r\n      this.column.setColorMapping(new ReplacmentColorMappingFunction(map));\r\n    }\r\n    return true;\r\n  }\r\n\r\n  cancel() {\r\n    this.column.setColorMapping(this.before);\r\n  }\r\n}\r\n","import {SetColumn, CategoricalColumn, ICategoricalFilter, ISetCategoricalFilter} from '../../model';\r\nimport {filterMissingMarkup, findFilterMissing} from '../missing';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {forEach} from './utils';\r\nimport {cssClass} from '../../styles';\r\nimport {isCategoryIncluded} from '../../model/internalCategorical';\r\n\r\n/** @internal */\r\nexport default class CategoricalFilterDialog extends ADialog {\r\n\r\n  private readonly before: ICategoricalFilter;\r\n\r\n  constructor(private readonly column: CategoricalColumn | SetColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      livePreview: 'filter'\r\n    });\r\n    this.before = this.column.getFilter() || {filter: '', filterMissing: false};\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.insertAdjacentHTML('beforeend', `<div class=\"${cssClass('dialog-table')}\">\r\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\r\n          <input type=\"checkbox\" checked>\r\n          <span>\r\n            <span class=\"${cssClass('dialog-filter-table-color')}\"></span>\r\n            <div>Un/Select All</div>\r\n          </span>\r\n        </label>\r\n        ${this.column.categories.map((c) => `<label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\r\n          <input data-cat=\"${c.name}\" type=\"checkbox\"${isCategoryIncluded(this.before, c) ? 'checked' : ''}>\r\n          <span>\r\n            <span class=\"${cssClass('dialog-filter-table-color')}\" style=\"background-color: ${c.color}\"></span>\r\n            <div>${c.label}</div>\r\n          </span>\r\n        </label>`).join('')}\r\n    </div>`);\r\n    // selectAll\r\n    const selectAll = this.findInput('input:not([data-cat])');\r\n    selectAll.onchange =  () => {\r\n      forEach(node, 'input[data-cat]', (n: HTMLInputElement) => n.checked = selectAll.checked);\r\n    };\r\n    if (this.column instanceof SetColumn) {\r\n      const some = (<ISetCategoricalFilter>this.before).mode !== 'every';\r\n      node.insertAdjacentHTML('beforeend', `<strong>Show rows where</strong>`);\r\n      node.insertAdjacentHTML('beforeend', `<label class=\"${cssClass('checkbox')}\">\r\n        <input type=\"radio\" ${!some ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"every\">\r\n        <span>all are selected</span>\r\n      </label>`);\r\n      node.insertAdjacentHTML('beforeend', `<label class=\"${cssClass('checkbox')}\" style=\"padding-bottom: 0.6em\">\r\n        <input type=\"radio\" ${some ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"some\">\r\n        <span>some are selected</span>\r\n      </label>`);\r\n    }\r\n    node.insertAdjacentHTML('beforeend', filterMissingMarkup(this.before.filterMissing));\r\n\r\n    this.enableLivePreviews('input[type=checkbox],input[type=radio]');\r\n  }\r\n\r\n  private updateFilter(filter: string[] | null | RegExp | string, filterMissing: boolean, someMode = false) {\r\n    const noFilter = filter == null && filterMissing === false;\r\n    const f: ISetCategoricalFilter = {filter: filter!, filterMissing};\r\n    if (this.column instanceof SetColumn) {\r\n      f.mode = someMode ? 'some' : 'every';\r\n    }\r\n    this.column.setFilter(noFilter ? null : f);\r\n  }\r\n\r\n  protected reset() {\r\n    this.forEach('input[data-cat]', (n: HTMLInputElement) => n.checked = true);\r\n    findFilterMissing(this.node).checked = false;\r\n    const mode = this.findInput('input[value=every]');\r\n    if (mode) {\r\n      mode.checked = true;\r\n    }\r\n  }\r\n\r\n  protected cancel() {\r\n    this.updateFilter(this.before.filter === '' ? null : this.before.filter, this.before.filterMissing, (<ISetCategoricalFilter>this.before).mode === 'some');\r\n  }\r\n\r\n  protected submit() {\r\n    let f: string[] | null = this.forEach('input[data-cat]', (n: HTMLInputElement) => n.checked ? n.dataset.cat! : '').filter(Boolean);\r\n    if (f.length === this.column.categories.length) { // all checked = no filter\r\n      f = null;\r\n    }\r\n    const filterMissing = findFilterMissing(this.node).checked;\r\n    const mode = this.findInput('input[value=some]');\r\n    this.updateFilter(f, filterMissing, mode != null && mode.checked);\r\n    return true;\r\n  }\r\n}\r\n","import {round} from '../../internal';\r\nimport {OrdinalColumn, ICategoricalFilter} from '../../model';\r\nimport {isCategoryIncluded} from '../../model/internalCategorical';\r\nimport {filterMissingMarkup, findFilterMissing} from '../missing';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {forEach} from './utils';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class CategoricalMappingFilterDialog extends ADialog {\r\n\r\n  private readonly before: ICategoricalFilter;\r\n\r\n  constructor(private readonly column: OrdinalColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      livePreview: 'filter'\r\n    });\r\n    this.before = this.column.getFilter() || {filter: this.column.categories.map((d) => d.name), filterMissing: false};\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const joint = this.column.categories.map((d) => Object.assign({\r\n      range: round(d.value * 100, 2)\r\n    }));\r\n    joint.sort((a, b) => a.label.localeCompare(b.label));\r\n\r\n    node.insertAdjacentHTML('beforeend', `<div class=\"${cssClass('dialog-table')}\">\r\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\r\n          <input type=\"checkbox\" checked>\r\n          <span>\r\n            <div>Un/Select All</div>\r\n          </span>\r\n        </label>\r\n        ${joint.map(({name, color, label, range}) => `\r\n          <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\r\n            <input data-cat=\"${name}\" type=\"checkbox\"${isCategoryIncluded(this.before, name) ? 'checked' : ''}>\r\n            <span>\r\n              <input type=\"number\" value=\"${range}\" min=\"0\" max=\"100\" size=\"5\">\r\n              <div class=\"${cssClass('dialog-filter-color-bar')}\">\r\n                <span style=\"background-color: ${color}; width: ${range}%\"></span>\r\n              </div>\r\n              <div>${label}</div>\r\n            </span>\r\n          </label>`).join('')}\r\n    </div>`);\r\n    // selectAll\r\n    const selectAll = this.findInput('input[type=checkbox]:not([data-cat])');\r\n    selectAll.onchange = () => {\r\n      forEach(node, '[data-cat]', (n: HTMLInputElement) => n.checked = selectAll.checked);\r\n    };\r\n    this.forEach('input[type=number]', (d: HTMLInputElement) => {\r\n      d.oninput = () => {\r\n        (<HTMLElement>d.nextElementSibling!.firstElementChild).style.width = `${d.value}%`;\r\n      };\r\n    });\r\n    node.insertAdjacentHTML('beforeend', filterMissingMarkup(this.before.filterMissing));\r\n\r\n    this.enableLivePreviews('input[type=checkbox], input[type=number]');\r\n  }\r\n\r\n  private updateFilter(filter: string[] | null | string | RegExp, filterMissing: boolean) {\r\n    const noFilter = filter == null && filterMissing === false;\r\n    this.column.setFilter(noFilter ? null : {filter: filter!, filterMissing});\r\n  }\r\n\r\n  protected cancel() {\r\n    this.updateFilter(this.before.filter, this.before.filterMissing);\r\n  }\r\n\r\n  protected reset() {\r\n    this.forEach('[data-cat]', (n: HTMLInputElement) => {\r\n      n.checked = false;\r\n      (<HTMLInputElement>n.nextElementSibling!).value = '50';\r\n    });\r\n  }\r\n\r\n  protected submit() {\r\n    const items = this.forEach('input[data-cat]', (n: HTMLInputElement) => ({\r\n      checked: n.checked,\r\n      cat: n.dataset.cat!,\r\n      range: (<HTMLInputElement>n.nextElementSibling)!.valueAsNumber\r\n    }));\r\n    let f: string[] | null = items.filter((d) => d.checked).map((d) => d.cat);\r\n    if (f.length === this.column.categories.length) { // all checked = no filter\r\n      f = null;\r\n    }\r\n    const filterMissing = findFilterMissing(this.node).checked;\r\n    this.updateFilter(f, filterMissing);\r\n    this.column.setMapping(items.map((d) => d.range / 100));\r\n    return true;\r\n  }\r\n}\r\n","import {Column} from '../../model';\r\nimport {IRankingHeaderContext, IRenderInfo} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class ChangeRendererDialog extends ADialog {\r\n  private readonly before: {renderer: string, group: string, summary: string};\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      livePreview: 'vis'\r\n    });\r\n\r\n    this.before = {\r\n      renderer: column.getRenderer(),\r\n      group: column.getGroupRenderer(),\r\n      summary: column.getSummaryRenderer()\r\n    };\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const current = this.column.getRenderer();\r\n    const currentGroup = this.column.getGroupRenderer();\r\n    const currentSummary = this.column.getSummaryRenderer();\r\n    const {item, group, summary} = this.ctx.getPossibleRenderer(this.column);\r\n\r\n    console.assert(item.length > 1 || group.length > 1 || summary.length > 1); // otherwise no need to show this\r\n\r\n    const byName = (a: IRenderInfo, b: IRenderInfo) => a.label.localeCompare(b.label);\r\n    node.insertAdjacentHTML('beforeend', `\r\n      <strong>Item Visualization</strong>\r\n      ${item.sort(byName).map((d) => ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"renderer\" value=\"${d.type}\" ${(current === d.type) ? 'checked' : ''}><span>${d.label}</span></label>`).join('')}\r\n      <strong>Group Visualization</strong>\r\n      ${group.sort(byName).map((d) => ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"group\" value=\"${d.type}\" ${(currentGroup === d.type) ? 'checked' : ''}><span>${d.label}</span></label>`).join('')}\r\n      <strong>Summary Visualization</strong>\r\n      ${summary.sort(byName).map((d) => ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"summary\" value=\"${d.type}\" ${(currentSummary === d.type) ? 'checked' : ''}><span>${d.label}</span></label>`).join('')}\r\n    `);\r\n\r\n    this.enableLivePreviews('input[type=radio]');\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setRenderer(this.before.renderer);\r\n    this.column.setGroupRenderer(this.before.group);\r\n    this.column.setSummaryRenderer(this.before.summary);\r\n  }\r\n\r\n  protected reset() {\r\n    const desc = this.column.desc;\r\n    const r = this.findInput(`input[name=renderer][value=\"${desc.renderer || desc.type}\"]`);\r\n    if (r) {\r\n      r.checked = true;\r\n    }\r\n    const g = this.findInput(`input[name=group][value=\"${desc.groupRenderer || desc.type}\"]`);\r\n    if (g) {\r\n      g.checked = true;\r\n    }\r\n    const s = this.findInput(`input[name=summary][value=\"${desc.summaryRenderer || desc.type}\"]`);\r\n    if (s) {\r\n      s.checked = true;\r\n    }\r\n  }\r\n\r\n  protected submit() {\r\n    const renderer = this.findInput('input[name=renderer]:checked').value;\r\n    const group = this.findInput('input[name=group]:checked').value;\r\n    const summary = this.findInput('input[name=summary]:checked').value;\r\n\r\n    this.column.setRenderer(renderer);\r\n    this.column.setGroupRenderer(group);\r\n    this.column.setSummaryRenderer(summary);\r\n\r\n    return true;\r\n  }\r\n\r\n}\r\n","import ADialog, {IDialogContext} from './ADialog';\r\nimport {schemeCategory10, schemeSet1, schemeSet2, schemeSet3, schemeAccent, schemeDark2, schemePastel2, schemePastel1} from 'd3-scale-chromatic';\r\nimport {round} from '../../internal';\r\nimport {uniqueId} from '../../renderer/utils';\r\nimport {QuantizedColorFunction, CustomColorMappingFunction, SolidColorFunction, SequentialColorFunction, DivergentColorFunction} from '../../model/ColorMappingFunction';\r\nimport {IMapAbleColumn, DEFAULT_COLOR, IColorMappingFunction, IMapAbleDesc} from '../../model';\r\nimport {cssClass} from '../../styles';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\n\r\nexport default class ColorMappingDialog extends ADialog {\r\n  private readonly before: IColorMappingFunction;\r\n  private readonly id = uniqueId('col');\r\n\r\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      livePreview: 'colorMapping'\r\n    });\r\n\r\n    this.before = this.column.getColorMapping();\r\n  }\r\n\r\n  private createTemplate(id: string, wrapped: IColorMappingFunction) {\r\n    const current = wrapped instanceof QuantizedColorFunction ? wrapped.base : wrapped;\r\n    const entries = current instanceof CustomColorMappingFunction ? current.entries : [];\r\n\r\n    let h = '';\r\n    h += `<datalist id=\"${id}L\">${schemeCategory10.map((d) => `<option>${d}\"</option>`).join('')}</datalist>`;\r\n    h += `<datalist id=\"${id}LW\"><option>#FFFFFF\"</option>${schemeCategory10.slice(0, -1).map((d) => `<option>${d}</option>`).join('')}</datalist>`;\r\n\r\n    h += `<strong data-toggle=\"${current instanceof SolidColorFunction ? 'open' : ''}\">Solid Color</strong>`;\r\n    h += `<div>`;\r\n    {\r\n      const refColor = current instanceof SolidColorFunction ? current.color : '';\r\n      let has = refColor === DEFAULT_COLOR;\r\n      const colorsets = [schemeCategory10, schemeAccent, schemeDark2, schemePastel1, schemePastel2, schemeSet1, schemeSet2, schemeSet3];\r\n      const renderColor = (d: string) => `<label class=\"${cssClass('checkbox-color')}\">\r\n        <input name=\"color\" type=\"radio\" value=\"${d}\" ${d === refColor ? 'checked=\"checked\"' : ''}>\r\n        <span style=\"background: ${d}\"></span>\r\n      </label>`;\r\n      colorsets.forEach((colors, i) => {\r\n        has = has || colors.includes(refColor);\r\n        h += `<div class=\"${cssClass('color-line')}\">\r\n          ${colors.map(renderColor).join('')}\r\n          ${i === 0 ? renderColor(DEFAULT_COLOR) : ''}\r\n        </div>`;\r\n      });\r\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\"><input name=\"color\" type=\"radio\" value=\"custom:solid\" ${refColor && !has ? 'checked=\"checked\"' : ''}>\r\n        <span class=\"${cssClass('color-custom')}\"><input type=\"color\" name=\"solid\" list=\"${id}L\" value=\"${current instanceof SolidColorFunction ? current.color : DEFAULT_COLOR}\" ${refColor && !has ? '' : 'disabled'}></span>\r\n      </label>`;\r\n    }\r\n    h += '</div>';\r\n\r\n    h += `<strong data-toggle=\"${current instanceof SequentialColorFunction || (current instanceof CustomColorMappingFunction && entries.length === 2) ? 'open' : ''}\">Sequential Color</strong>`;\r\n    h += '<div>';\r\n    h += `<div><label class=\"${cssClass('checkbox')}\">\r\n      <input name=\"kindS\" type=\"radio\" id=\"${id}KC_S\" value=\"continuous\" ${!(wrapped instanceof QuantizedColorFunction) ? 'checked' : ''}>\r\n      <span>Continuous</span>\r\n    </label>\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input name=\"kindS\" type=\"radio\" id=\"${id}KQ_S\" value=\"quantized\" ${wrapped instanceof QuantizedColorFunction ? 'checked' : ''}>\r\n      <span>Discrete&nbsp;<input type=\"number\" id=\"${id}KQS_S\" min=\"2\" step=\"1\" style=\"width: 3em\" value=\"${wrapped instanceof QuantizedColorFunction ? `${wrapped.steps}\"` : '5\" disabled'}>&nbsp; steps</span>\r\n    </label></div>`;\r\n    {\r\n      const name = current instanceof SequentialColorFunction ? current.name : '';\r\n      for (const colors of Object.keys(SequentialColorFunction.FUNCTIONS)) {\r\n        h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\"><input name=\"color\" type=\"radio\" value=\"${colors}\" ${colors === name ? 'checked=\"checked\"' : ''}>\r\n        <span data-c=\"${colors}\" style=\"background: ${gradient(SequentialColorFunction.FUNCTIONS[colors], 9)}\"></span>\r\n      </label>`;\r\n      }\r\n      const isCustom = entries.length === 2;\r\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\">\r\n        <input name=\"color\" type=\"radio\" value=\"custom:sequential\" ${isCustom ? 'checked' : ''}>\r\n        <span class=\"${cssClass('color-custom')}\">\r\n          <input type=\"color\" name=\"interpolate0\" list=\"${id}LW\" ${!isCustom ? 'disabled' : `value=\"${entries[0].color}\"`}>\r\n          <input type=\"color\" name=\"interpolate1\" list=\"${id}LW\" ${!isCustom ? 'disabled' : `value=\"${entries[entries.length - 1].color}\"`}>\r\n        </span>\r\n      </label>`;\r\n    }\r\n    h += '</div>';\r\n    h += `<strong data-toggle=\"${current instanceof DivergentColorFunction || (current instanceof CustomColorMappingFunction && entries.length === 3) ? 'open' : ''}\">Diverging Color</strong>`;\r\n    h += '<div>';\r\n    h += `<div><label class=\"${cssClass('checkbox')}\">\r\n      <input name=\"kindD\" type=\"radio\" id=\"${id}KC_D\" value=\"continuous\" ${!(wrapped instanceof QuantizedColorFunction) ? 'checked' : ''}>\r\n      <span>Continuous</span>\r\n    </label>\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input name=\"kindD\" type=\"radio\" id=\"${id}KQ_D\" value=\"quantized\" ${wrapped instanceof QuantizedColorFunction ? 'checked' : ''}>\r\n      <span>Discrete&nbsp;<input type=\"number\" id=\"${id}KQS_D\" min=\"2\" step=\"1\" style=\"width: 3em\" value=\"${wrapped instanceof QuantizedColorFunction ? `${wrapped.steps}\"` : '5\" disabled'}>&nbsp; steps</span>\r\n    </label></div>`;\r\n\r\n    {\r\n      const name = current instanceof DivergentColorFunction ? current.name : '';\r\n      for (const colors of Object.keys(DivergentColorFunction.FUNCTIONS)) {\r\n        h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\"><input name=\"color\" type=\"radio\" value=\"${colors}\" ${colors === name ? 'checked=\"checked\"' : ''}>\r\n        <span data-c=\"${colors}\" style=\"background: ${gradient(DivergentColorFunction.FUNCTIONS[colors], 11)}\"></span>\r\n      </label>`;\r\n      }\r\n      const isCustom = entries.length === 3;\r\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\">\r\n        <input name=\"color\" type=\"radio\" value=\"custom:divergent\" ${isCustom ? 'checked' : ''}>\r\n        <span class=\"${cssClass('color-custom')}\">\r\n          <input type=\"color\" name=\"divergingm1\" list=\"${id}L\" ${!isCustom ? 'disabled' : `value=\"${entries[0].color}\"`}>\r\n          <input type=\"color\" name=\"diverging0\" list=\"${id}LW\" ${!isCustom ? 'disabled' : `value=\"${entries[1].color}\"`}>\r\n          <input type=\"color\" name=\"diverging1\" list=\"${id}L\" ${!isCustom ? 'disabled' : `value=\"${entries[2].color}\"`}>\r\n        </span>\r\n      </label>`;\r\n    }\r\n    h += '</div>';\r\n\r\n    return h;\r\n  }\r\n\r\n  private applyColor() {\r\n    const selected = this.findInput(`input[name=color]:checked`);\r\n    if (!selected) {\r\n      return;\r\n    }\r\n    const quantized = this.findInput(`#${this.id}KQ_S`);\r\n    const steps = this.findInput(`#${this.id}KQS_S`);\r\n\r\n    const base = toColor(selected, this.node);\r\n    if (quantized.checked && !(base instanceof SolidColorFunction)) {\r\n      this.column.setColorMapping(new QuantizedColorFunction(base, Number.parseInt(steps.value, 10)));\r\n    } else {\r\n      this.column.setColorMapping(base);\r\n    }\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const content = node.ownerDocument!.createElement('div');\r\n    content.classList.add(cssClass('dialog-color'));\r\n    node.appendChild(content);\r\n    this.render(content, this.column.getColorMapping());\r\n  }\r\n\r\n  private render(node: HTMLElement, value: IColorMappingFunction) {\r\n    const id = this.id;\r\n    node.innerHTML = this.createTemplate(id, value);\r\n\r\n    const toggles = <HTMLElement[]>Array.from(node.querySelectorAll('strong[data-toggle]'));\r\n\r\n    for (const toggle of toggles) {\r\n      toggle.onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        for (const t2 of toggles) {\r\n          t2.dataset.toggle = t2.dataset.toggle === 'open' || toggle !== t2 ? '' : 'open';\r\n        }\r\n      };\r\n    }\r\n\r\n    const customs: HTMLElement[] = [];\r\n    const updateColor = (d: HTMLInputElement) => {\r\n      if (!d.checked) {\r\n        return;\r\n      }\r\n      // disable customs\r\n      for (const custom of customs) {\r\n        Array.from(custom.nextElementSibling!.getElementsByTagName('input')).forEach((s) => s.disabled = custom !== d);\r\n      }\r\n      if (this.showLivePreviews()) {\r\n        this.applyColor();\r\n      }\r\n    };\r\n\r\n    const updateSelectedColor = () => {\r\n      const selected = this.findInput(`input[name=color]:checked`);\r\n      if (selected) {\r\n        updateColor(selected);\r\n      }\r\n    };\r\n\r\n    this.forEach('input[name=color]', (d: HTMLInputElement) => {\r\n      if (d.value.startsWith('custom:')) {\r\n        customs.push(d);\r\n      }\r\n      d.onchange = () => updateColor(d);\r\n    });\r\n\r\n    // upon changing custom parameter trigger an update\r\n    this.forEach(`.${cssClass('color-custom')} input[type=color]`, (d: HTMLInputElement) => {\r\n      d.onchange = () => {\r\n        const item = (<HTMLInputElement>d.parentElement!.previousElementSibling!);\r\n        updateColor(item);\r\n      };\r\n    });\r\n\r\n    // sync and apply\r\n    const continuouos = this.findInput(`#${id}KC_S`);\r\n    const quantized = this.findInput(`#${id}KQ_S`);\r\n    const steps = this.findInput(`#${id}KQS_S`);\r\n    const continuouos2 = this.findInput(`#${id}KC_D`);\r\n    const quantized2 = this.findInput(`#${id}KQ_D`);\r\n    const steps2 = this.findInput(`#${id}KQS_D`);\r\n\r\n    continuouos.onchange = continuouos2.onchange = (evt) => {\r\n      continuouos.checked = continuouos2.checked = (<HTMLInputElement>evt.currentTarget).checked;\r\n      steps.disabled = steps2.disabled = !quantized.checked;\r\n      if (continuouos.checked) {\r\n        this.updateGradients(-1);\r\n        updateSelectedColor();\r\n      }\r\n    };\r\n    steps.onchange = steps2.onchange = (evt) => {\r\n      steps.value = steps2.value = (<HTMLInputElement>evt.currentTarget).value;\r\n      this.updateGradients(Number.parseInt(steps.value, 10));\r\n      updateSelectedColor();\r\n    };\r\n    quantized.onchange = quantized2.onchange = (evt) => {\r\n      quantized.checked = quantized2.checked = (<HTMLInputElement>evt.currentTarget).checked;\r\n      steps.disabled = steps2.disabled = !quantized.checked;\r\n      if (quantized.checked) {\r\n        this.updateGradients(Number.parseInt(steps.value, 10));\r\n        updateSelectedColor();\r\n      }\r\n    };\r\n  }\r\n\r\n  protected reset() {\r\n    const desc = <IMapAbleDesc>this.column.desc;\r\n    const colorMapping = this.ctx.provider.getTypeFactory().colorMappingFunction(desc.colorMapping || desc.color);\r\n    this.render(this.node.querySelector<HTMLElement>(`.${cssClass('dialog-color')}`)!, colorMapping);\r\n  }\r\n\r\n  protected submit() {\r\n    this.applyColor();\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setColorMapping(this.before);\r\n  }\r\n\r\n  private updateGradients(steps: number) {\r\n    this.forEach(`span[data-c]`, (d: HTMLElement) => {\r\n      const key = d.dataset.c!;\r\n      const s = SequentialColorFunction.FUNCTIONS[key];\r\n      if (s) {\r\n        d.style.background = steps < 0 ? gradient(s, 9) : steppedGradient(s, steps);\r\n        return;\r\n      }\r\n      const di = DivergentColorFunction.FUNCTIONS[key];\r\n      if (di) {\r\n        d.style.background = steps < 0 ? gradient(di, 11) : steppedGradient(di, steps);\r\n        return;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction toColor(input: HTMLInputElement, node: HTMLElement) {\r\n  switch (input.value) {\r\n    case 'custom:solid':\r\n      return new SolidColorFunction((<HTMLInputElement>node.querySelector('input[name=solid]')!).value);\r\n    case 'custom:sequential':\r\n      const s0 = (<HTMLInputElement>node.querySelector('input[name=interpolate0]')!).value;\r\n      const s1 = (<HTMLInputElement>node.querySelector('input[name=interpolate1]')!).value;\r\n      return new CustomColorMappingFunction([{color: s0, value: 0}, {color: s1, value: 1}]);\r\n    case 'custom:diverging':\r\n      const dm1 = (<HTMLInputElement>node.querySelector('input[name=divergentm1]')!).value;\r\n      const d0 = (<HTMLInputElement>node.querySelector('input[name=divergent0]')!).value;\r\n      const d1 = (<HTMLInputElement>node.querySelector('input[name=divergent1]')!).value;\r\n      return new CustomColorMappingFunction([{color: dm1, value: 0}, {color: d0, value: 0.5}, {color: d1, value: 1}]);\r\n  }\r\n  if (input.value in SequentialColorFunction.FUNCTIONS) {\r\n    return new SequentialColorFunction(input.value);\r\n  }\r\n  if (input.value in DivergentColorFunction.FUNCTIONS) {\r\n    return new DivergentColorFunction(input.value);\r\n  }\r\n  return new SolidColorFunction(input.value);\r\n}\r\n\r\nfunction gradient(interpolate: (v: number)=>string, steps = 2) {\r\n  if (steps <= 1) {\r\n    return `${interpolate(0)}`;\r\n  }\r\n  const stepSize = 1 / (steps - 1);\r\n  let r = `linear-gradient(to right`;\r\n  for (let i = 0; i < steps; ++i) {\r\n    r += `, ${interpolate(i * stepSize)} ${round((i * stepSize) * 100, 2)}%`;\r\n  }\r\n  r += ')';\r\n  return r;\r\n}\r\n\r\nfunction steppedGradient(color: (v: number)=>string, count = 2) {\r\n  if (count === 1) {\r\n    return `${color(0)}`;\r\n  }\r\n  let r = `linear-gradient(to right`;\r\n  const stepSize = 1 / count;\r\n  const half = stepSize / 2;\r\n  for (let i = 0; i < count; ++i) {\r\n    // stepped\r\n    // first and last at border else center\r\n    const shift = i === 0 ? 0 : (i === (count - 1) ? stepSize : half);\r\n    const c = color(i * stepSize + shift);\r\n    r += `, ${c} ${round((i * stepSize) * 100, 2)}%, ${c} ${round(((i + 1) * stepSize) * 100, 2)}%`;\r\n  }\r\n  r += ')';\r\n  return r;\r\n}\r\n","import {cssClass} from '../styles';\r\n\r\n/** @internal */\r\nexport function hasDnDType(e: DragEvent, ...typesToCheck: string[]) {\r\n  const available: any = e.dataTransfer!.types;\r\n\r\n  /*\r\n   * In Chrome datatransfer.types is an Array,\r\n   * while in Firefox it is a DOMStringList\r\n   * that only implements a contains-method!\r\n   */\r\n  if (typeof available.indexOf === 'function') {\r\n    return typesToCheck.some((type) => available.indexOf(type) >= 0);\r\n  }\r\n  if (typeof available.includes === 'function') {\r\n    return typesToCheck.some((type) => available.includes(type));\r\n  }\r\n  if (typeof available.contains === 'function') {\r\n    return typesToCheck.some((type) => available.contains(type));\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\n/**\r\n * helper storage for dnd in edge since edge doesn't support custom mime-types\r\n * @type {Map<number, {[p: string]: string}>}\r\n */\r\nconst dndTransferStorage = new Map<number, {[key: string]: string}>();\r\n\r\nfunction isEdgeDnD(e: DragEvent) {\r\n  return dndTransferStorage.size > 0 && hasDnDType(e, 'text/plain');\r\n}\r\n\r\n/**\r\n * checks whether it is a copy operation\r\n * @param e\r\n * @returns {boolean|RegExpMatchArray}\r\n * @internal\r\n */\r\nexport function copyDnD(e: DragEvent) {\r\n  const dT = e.dataTransfer!;\r\n  return Boolean((e.ctrlKey && dT.effectAllowed.match(/copy/gi)) || (!dT.effectAllowed.match(/move/gi)));\r\n}\r\n\r\n/**\r\n * updates the drop effect accoriding to the current copyDnD state\r\n * @param e\r\n * @internal\r\n */\r\nexport function updateDropEffect(e: DragEvent) {\r\n  const dT = e.dataTransfer!;\r\n  if (copyDnD(e)) {\r\n    dT.dropEffect = 'copy';\r\n  } else {\r\n    dT.dropEffect = 'move';\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport type IDragEffect = 'none' | 'copy' | 'copyLink' | 'copyMove' | 'link' | 'linkMove' | 'move' | 'all';\r\n\r\n/** @internal */\r\nexport interface IDragStartResult {\r\n  effectAllowed: IDragEffect;\r\n  data: {[mimeType: string]: string};\r\n}\r\n\r\n/** @internal */\r\nexport interface IDropResult {\r\n  effect: IDragEffect;\r\n  data: {[mimeType: string]: string};\r\n}\r\n\r\nlet idCounter = 0;\r\n\r\n/**\r\n * add drag support for the given element\r\n * @param {HTMLElement} node\r\n * @param {() => IDragStartResult} onDragStart callback to compute the payload an object of mime types\r\n * @param {boolean} stopPropagation whether to stop propagation in case of success\r\n * @internal\r\n */\r\nexport function dragAble(node: HTMLElement, onDragStart: () => IDragStartResult, stopPropagation: boolean = false) {\r\n  const id = ++idCounter;\r\n\r\n  node.classList.add(cssClass('dragable'));\r\n  node.draggable = true;\r\n\r\n  node.addEventListener('dragstart', (e) => {\r\n    node.classList.add(cssClass('dragging'));\r\n    const payload = onDragStart();\r\n    e.dataTransfer!.effectAllowed = payload.effectAllowed;\r\n\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n\r\n    // copy all data transfer objects\r\n    const keys = Object.keys(payload.data);\r\n    const allSucceded = keys.every((k) => {\r\n      try {\r\n        e.dataTransfer!.setData(k, payload.data[k]);\r\n        return true;\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n    });\r\n    if (allSucceded) {\r\n      return;\r\n    }\r\n    //compatibility mode for edge\r\n    const text = payload.data['text/plain'] || '';\r\n    e.dataTransfer!.setData('text/plain', `${id}${text ? `: ${text}` : ''}`);\r\n    dndTransferStorage.set(id, payload.data);\r\n  });\r\n\r\n  node.addEventListener('dragend', (e) => {\r\n    node.classList.remove(cssClass('dragging'));\r\n\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n\r\n    if (dndTransferStorage.size > 0) {\r\n      //clear the id\r\n      dndTransferStorage.delete(id);\r\n    }\r\n\r\n    // remove all\r\n    const over = <HTMLElement>node.ownerDocument!.getElementsByClassName(cssClass('dragover'))[0];\r\n    if (over) {\r\n      over.classList.remove(cssClass('dragover'));\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * add dropable support for the given node\r\n * @param {HTMLElement} node\r\n * @param {string[]} mimeTypes mimeTypes to look for\r\n * @param {(result: IDropResult, e: DragEvent) => boolean} onDrop callback when dropped, returns true if the drop was successful\r\n * @param {(e: DragEvent) => void} onDragOver optional drag over handler, e.g. for special effects\r\n * @param {boolean} stopPropagation flag if the event propagation should be stopped in case of success\r\n * @param {() => boolean} optional whether to enable dropping at all\r\n * @internal\r\n */\r\nexport function dropAble(node: HTMLElement, mimeTypes: string[], onDrop: (result: IDropResult, e: DragEvent) => boolean, onDragOver: null | ((e: DragEvent) => void) = null, stopPropagation: boolean = false, canDrop: () => boolean = (() => true)) {\r\n  node.addEventListener('dragenter', (e) => {\r\n    //var xy = mouse($node.node());\r\n    if (node.classList.contains(cssClass('dragging')) || !(hasDnDType(e, ...mimeTypes) || isEdgeDnD(e)) || !canDrop()) {\r\n      // not a valid mime type\r\n      node.classList.remove(cssClass('dragover'));\r\n      return;\r\n    }\r\n    node.classList.add(cssClass('dragover'));\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n    //sounds good\r\n    return false;\r\n  });\r\n\r\n  node.addEventListener('dragover', (e) => {\r\n    if (node.classList.contains(cssClass('dragging')) || !(hasDnDType(e, ...mimeTypes) || isEdgeDnD(e)) || !canDrop()) {\r\n      // not a valid mime type\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    updateDropEffect(e);\r\n    node.classList.add(cssClass('dragover'));\r\n\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n    if (onDragOver) {\r\n      onDragOver(e);\r\n    }\r\n    //sound good\r\n    return false;\r\n  });\r\n\r\n  node.addEventListener('dragleave', (evt) => {\r\n    // same fix as in phovea\r\n    (<HTMLElement>evt.target).classList.remove(cssClass('dragover'));\r\n  });\r\n\r\n  node.addEventListener('drop', (e) => {\r\n    e.preventDefault();\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n    updateDropEffect(e);\r\n\r\n    const effect = <IDragEffect>e.dataTransfer!.dropEffect;\r\n\r\n    node.classList.remove(cssClass('dragover'));\r\n\r\n    if (isEdgeDnD(e)) {\r\n      // retrieve from helper\r\n      const base = e.dataTransfer!.getData('text/plain');\r\n      const id = parseInt(base.indexOf(':') >= 0 ? base.substring(0, base.indexOf(':')) : base, 10);\r\n      if (dndTransferStorage.has(id)) {\r\n        const data = dndTransferStorage.get(id)!;\r\n        dndTransferStorage.delete(id);\r\n        return !onDrop({effect, data}, e);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (!hasDnDType(e, ...mimeTypes)) {\r\n      return;\r\n    }\r\n\r\n    // copy sub mime types\r\n    const data: any = {};\r\n    //selects the data contained in the data transfer\r\n    mimeTypes.forEach((mime) => {\r\n      const value = e.dataTransfer!.getData(mime);\r\n      if (value !== '') {\r\n        data[mime] = value;\r\n      }\r\n    });\r\n    return !onDrop({effect, data}, e);\r\n  });\r\n}\r\n","import {Column} from '../../model';\r\nimport {createToolbarMenuItems, updateIconState} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\nimport APopup from './APopup';\r\n\r\n/** @internal */\r\nexport default class MoreColumnOptionsDialog extends APopup {\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly mode: 'header' | 'sidePanel', private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      autoClose: true\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('more-options'));\r\n    node.dataset.colId = this.column.id;\r\n    createToolbarMenuItems(node, this.dialog.level + 1, this.column, this.ctx, this.mode);\r\n\r\n    updateIconState(node, this.column);\r\n  }\r\n}\r\n","import {MIN_LABEL_WIDTH} from '../constants';\r\nimport {equalArrays, dragAble, dropAble, hasDnDType, IDropResult} from '../internal';\r\nimport {categoryOf, getSortType} from '../model';\r\nimport {createNestedDesc, createReduceDesc, createStackDesc, IColumnDesc, isArrayColumn, isBoxPlotColumn, isCategoricalColumn, isMapColumn, isNumberColumn, isNumbersColumn, Column, ImpositionCompositeColumn, ImpositionCompositesColumn, createImpositionDesc, createImpositionsDesc, ImpositionBoxPlotColumn, createImpositionBoxPlotDesc, CompositeColumn, IMultiLevelColumn, isMultiLevelColumn} from '../model';\r\nimport {aria, cssClass, engineCssClass, RESIZE_ANIMATION_DURATION, RESIZE_SPACE} from '../styles';\r\nimport MoreColumnOptionsDialog from './dialogs/MoreColumnOptionsDialog';\r\nimport {IRankingHeaderContext, IToolbarAction, IOnClickHandler} from './interfaces';\r\nimport {getToolbar} from './toolbar';\r\nimport {dialogContext} from './dialogs';\r\n\r\n/** @internal */\r\nexport interface IHeaderOptions {\r\n  dragAble: boolean;\r\n  mergeDropAble: boolean;\r\n  rearrangeAble: boolean;\r\n  resizeable: boolean;\r\n  level: number;\r\n  extraPrefix: string;\r\n}\r\n\r\n/** @internal */\r\nexport function createHeader(col: Column, ctx: IRankingHeaderContext, options: Partial<IHeaderOptions> = {}) {\r\n  options = Object.assign({\r\n    dragAble: true,\r\n    mergeDropAble: true,\r\n    rearrangeAble: true,\r\n    resizeable: true,\r\n    level: 0,\r\n    extraPrefix: ''\r\n  }, options);\r\n  const node = ctx.document.createElement('section');\r\n\r\n  const extra = options.extraPrefix ? (name: string) => `${cssClass(name)} ${cssClass(`${options.extraPrefix}-${name}`)}` : cssClass;\r\n  const summary = col.getMetaData().summary;\r\n  node.innerHTML = `\r\n    <div class=\"${extra('label')} ${cssClass('typed-icon')}\">${col.getWidth() < MIN_LABEL_WIDTH ? '&nbsp;' : col.label}</div>\r\n    <div class=\"${extra('sublabel')}\">${col.getWidth() < MIN_LABEL_WIDTH || !summary ? '&nbsp;' : summary}</div>\r\n    <div class=\"${extra('toolbar')}\"></div>\r\n    <div class=\"${extra('spacing')}\"></div>\r\n    <div class=\"${extra('handle')} ${cssClass('feature-advanced')} ${cssClass('feature-ui')}\"></div>\r\n  `;\r\n\r\n  // addTooltip(node, col);\r\n\r\n  createShortcutMenuItems(<HTMLElement>node.getElementsByClassName(cssClass('toolbar'))[0]!, options.level!, col, ctx, 'header');\r\n\r\n  toggleToolbarIcons(node, col);\r\n\r\n  if (options.dragAble) {\r\n    dragAbleColumn(node, col, ctx);\r\n  }\r\n  if (options.mergeDropAble) {\r\n    mergeDropAble(node, col, ctx);\r\n  }\r\n  if (options.rearrangeAble) {\r\n    rearrangeDropAble(<HTMLElement>node.getElementsByClassName(cssClass('handle'))[0]!, col, ctx);\r\n  }\r\n  if (options.resizeable) {\r\n    dragWidth(col, node);\r\n  }\r\n  return node;\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function updateHeader(node: HTMLElement, col: Column, minWidth = MIN_LABEL_WIDTH) {\r\n  const label = <HTMLElement>node.getElementsByClassName(cssClass('label'))[0]!;\r\n  label.innerHTML = col.getWidth() < minWidth ? '&nbsp;' : col.label;\r\n  const summary = col.getMetaData().summary;\r\n  const sublabel = <HTMLElement>node.getElementsByClassName(cssClass('sublabel'))[0];\r\n  if (sublabel) {\r\n    sublabel.innerHTML = col.getWidth() < minWidth || !summary ? '&nbsp;' : summary;\r\n  }\r\n\r\n  let title = col.label;\r\n  if (summary) {\r\n    title = `${title}\\n${summary}`;\r\n  }\r\n  if (col.description) {\r\n    title = `${title}\\n${col.description}`;\r\n  }\r\n  node.title = title;\r\n  node.dataset.colId = col.id;\r\n  node.dataset.type = col.desc.type;\r\n  label.dataset.typeCat = categoryOf(col).name;\r\n\r\n  updateIconState(node, col);\r\n\r\n  updateMoreDialogIcons(node, col);\r\n}\r\n\r\nfunction updateMoreDialogIcons(node: HTMLElement, col: Column) {\r\n  const root = node.closest(`.${cssClass()}`);\r\n  if (!root) {\r\n    return;\r\n  }\r\n  const dialog = root.querySelector<HTMLElement>(`.${cssClass('more-options')}[data-col-id=\"${col.id}\"]`);\r\n  if (!dialog) {\r\n    return;\r\n  }\r\n  updateIconState(dialog, col);\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function updateIconState(node: HTMLElement, col: Column) {\r\n  const sort = <HTMLElement>node.getElementsByClassName(cssClass('action-sort'))[0]!;\r\n  if (sort) {\r\n    const {asc, priority} = col.isSortedByMe();\r\n    sort.dataset.sort = asc !== undefined ? asc : '';\r\n    sort.dataset.type = getSortType(col);\r\n    if (priority !== undefined) {\r\n      sort.dataset.priority = (priority + 1).toString();\r\n    } else {\r\n      delete sort.dataset.priority;\r\n    }\r\n  }\r\n\r\n  const sortGroups = <HTMLElement>node.getElementsByClassName(cssClass('action-sort-groups'))[0]!;\r\n  if (sortGroups) {\r\n    const {asc, priority} = col.isGroupSortedByMe();\r\n    sortGroups.dataset.sort = asc !== undefined ? asc : '';\r\n    sortGroups.dataset.type = getSortType(col);\r\n    if (priority !== undefined) {\r\n      sortGroups.dataset.priority = (priority + 1).toString();\r\n    } else {\r\n      delete sortGroups.dataset.priority;\r\n    }\r\n  }\r\n\r\n  const group = <HTMLElement>node.getElementsByClassName(cssClass('action-group'))[0]!;\r\n  if (group) {\r\n    const groupedBy = col.isGroupedBy();\r\n    group.dataset.group = groupedBy >= 0 ? 'true' : 'false';\r\n    if (groupedBy >= 0) {\r\n      group.dataset.priority = (groupedBy + 1).toString();\r\n    } else {\r\n      delete group.dataset.priority;\r\n    }\r\n  }\r\n\r\n  const filter = <HTMLElement>node.getElementsByClassName(cssClass('action-filter'))[0]!;\r\n  if (!filter) {\r\n    return;\r\n  }\r\n  if (col.isFiltered()) {\r\n    filter.dataset.active = '';\r\n  } else {\r\n    delete filter.dataset.active;\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport function actionCSSClass(title: string) {\r\n  if (title.endsWith('&hellip;')) {\r\n    title = title.slice(0, -'&hellip;'.length - 1);\r\n  }\r\n  if (title.endsWith('By')) {\r\n    title = title.slice(0, -3);\r\n  }\r\n  const clean = title.toLowerCase().replace(/[ +-]/mg, '-');\r\n  return `${cssClass('action')} ${cssClass(`action-${clean}`)}`;\r\n}\r\n\r\nfunction addIconDOM(node: HTMLElement, col: Column, ctx: IRankingHeaderContext, level: number, showLabel: boolean, mode: 'header' | 'sidePanel') {\r\n  return (action: IToolbarAction) => {\r\n    const m = isActionMode(col, action, mode, 'shortcut') ? 'o' : isActionMode(col, action, mode, 'menu+shortcut') ? 's' : 'r';\r\n    node.insertAdjacentHTML('beforeend', `<i data-a=\"${m}\" title=\"${action.title}\" class=\"${actionCSSClass(action.title.toString())} ${cssClass(`feature-${action.options.featureLevel || 'basic'}`)} ${cssClass(`feature-${action.options.featureCategory || 'others'}`)}\"><span${!showLabel ? ` class=\"${cssClass('aria')}\" aria-hidden=\"true\"` : ''}>${action.title}</span> </i>`);\r\n    const i = <HTMLElement>node.lastElementChild;\r\n    i.onclick = (evt) => {\r\n      evt.stopPropagation();\r\n      ctx.dialogManager.setHighlightColumn(col);\r\n      action.onClick(col, <any>evt, ctx, level, !showLabel);\r\n    };\r\n    return i;\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport interface IAddIcon {\r\n  (title: string, onClick: IOnClickHandler): void;\r\n}\r\n\r\nfunction isActionMode(col: Column, d: IToolbarAction, mode: 'header' | 'sidePanel', value: 'menu' | 'menu+shortcut' | 'shortcut') {\r\n  const s = d.options.mode === undefined ? 'menu' : d.options.mode;\r\n  if (s === value) {\r\n    return true;\r\n  }\r\n  if (typeof s === 'function') {\r\n    return s(col, mode) === value;\r\n  }\r\n  return false;\r\n}\r\n\r\n/** @internal */\r\nexport function createShortcutMenuItems(node: HTMLElement, level: number, col: Column, ctx: IRankingHeaderContext, mode: 'header' | 'sidePanel', willAutoHide: boolean = true) {\r\n  const addIcon = addIconDOM(node, col, ctx, level, false, mode);\r\n  const toolbar = getToolbar(col, ctx);\r\n  const shortcuts = toolbar.filter((d) => !isActionMode(col, d, mode, 'menu'));\r\n  const hybrids = shortcuts.reduce((a, b) => a + (isActionMode(col, b, mode, 'menu+shortcut') ? 1 : 0), 0);\r\n\r\n  shortcuts.forEach(addIcon);\r\n  const moreEntries = toolbar.length - shortcuts.length + hybrids;\r\n\r\n  if (shortcuts.length === toolbar.length || (moreEntries === hybrids && !willAutoHide)) {\r\n    // all visible or just hybrids that will always be visible\r\n    return;\r\n  }\r\n\r\n  // need a more entry\r\n  node.insertAdjacentHTML('beforeend', `<i data-a=\"m\" data-m=\"${moreEntries}\" title=\"More &hellip;\" class=\"${actionCSSClass('More')}\">${aria('More &hellip;')}</i>`);\r\n  const i = <HTMLElement>node.lastElementChild;\r\n  i.onclick = (evt) => {\r\n    evt.stopPropagation();\r\n    ctx.dialogManager.setHighlightColumn(col);\r\n    const dialog = new MoreColumnOptionsDialog(col, dialogContext(ctx, level, <any>evt), mode, ctx);\r\n    dialog.open();\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport function createToolbarMenuItems(node: HTMLElement, level: number, col: Column, ctx: IRankingHeaderContext, mode: 'header' | 'sidePanel') {\r\n  const addIcon = addIconDOM(node, col, ctx, level, true, mode);\r\n  getToolbar(col, ctx).filter((d) => !isActionMode(col, d, mode, 'shortcut')).forEach(addIcon);\r\n}\r\n\r\n/** @internal */\r\nfunction toggleRotatedHeader(node: HTMLElement, col: Column, defaultVisibleClientWidth: number) {\r\n  // rotate header flag if needed\r\n  const label = <HTMLElement>node.getElementsByClassName(cssClass('label'))[0];\r\n  if (col.getWidth() < MIN_LABEL_WIDTH) {\r\n    label.classList.remove(`.${cssClass('rotated')}`);\r\n    return;\r\n  }\r\n  const width = label.clientWidth;\r\n  const rotated = width <= 0 ? (col.label.length * defaultVisibleClientWidth / 3 * 0.6 > col.getWidth()) : (label.scrollWidth * 0.6 > label.clientWidth);\r\n  label.classList.toggle(`.${cssClass('rotated')}`, rotated);\r\n}\r\n\r\n/** @internal */\r\nfunction toggleToolbarIcons(node: HTMLElement, col: Column, defaultVisibleClientWidth = 22.5) {\r\n  toggleRotatedHeader(node, col, defaultVisibleClientWidth);\r\n\r\n  const toolbar = <HTMLElement>node.getElementsByClassName(cssClass('toolbar'))[0];\r\n  if (toolbar.childElementCount === 0) {\r\n    return;\r\n  }\r\n  const availableWidth = col.getWidth();\r\n  const actions = Array.from(toolbar.children).map((d) => ({node: <HTMLElement>d, width: d.clientWidth > 0 ? d.clientWidth : defaultVisibleClientWidth}));\r\n\r\n  const shortCuts = actions.filter((d) => d.node.dataset.a === 'o');\r\n  const hybrids = actions.filter((d) => d.node.dataset.a === 's');\r\n  const moreIcon = actions.find((d) => d.node.dataset.a === 'm');\r\n  const moreEntries = moreIcon ? parseInt(moreIcon.node.dataset.m!, 10) : 0;\r\n  const needMore = moreEntries > hybrids.length;\r\n\r\n  let total = actions.reduce((a, b) => a + b.width, 0);\r\n\r\n  for (const action of actions) {\r\n    // maybe hide not needed \"more\"\r\n    action.node.classList.remove(cssClass('hidden'));\r\n  }\r\n\r\n  // all visible\r\n  if (total < availableWidth) {\r\n    return;\r\n  }\r\n  if (moreIcon && !needMore && (total - moreIcon.width) < availableWidth) {\r\n    // available space is enougth we can skip the \"more\" and then it fits\r\n    moreIcon.node.classList.add(cssClass('hidden'));\r\n    return;\r\n  }\r\n\r\n  for (const action of hybrids.reverse().concat(shortCuts.reverse())) { // back to forth and hybrids earlier than pure shortcuts\r\n    // hide and check if enough\r\n    action.node.classList.add(cssClass('hidden'));\r\n    total -= action.width;\r\n    if (total < availableWidth) {\r\n      return;\r\n    }\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * allow to change the width of a column using dragging the handle\r\n * @internal\r\n */\r\nexport function dragWidth(col: Column, node: HTMLElement) {\r\n  let ueberElement: HTMLElement;\r\n  let sizeHelper: HTMLElement;\r\n  let currentFooterTransformation = '';\r\n  const handle = <HTMLElement>node.getElementsByClassName(cssClass('handle'))[0];\r\n\r\n\r\n  let start = 0;\r\n  let originalWidth = 0;\r\n  const mouseMove = (evt: MouseEvent) => {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    const end = evt.clientX;\r\n    const delta = end - start;\r\n\r\n    if (Math.abs(start - end) < 2) {\r\n      //ignore\r\n      return;\r\n    }\r\n    start = end;\r\n    const width = Math.max(0, col.getWidth() + delta);\r\n\r\n    sizeHelper.classList.toggle(cssClass('resize-animated'), width < originalWidth);\r\n    // no idea why shifted by the size compared to the other footer element\r\n    sizeHelper.style.transform = `${currentFooterTransformation} translate(${width - originalWidth - RESIZE_SPACE}px, 0px)`;\r\n\r\n    node.style.width = `${width}px`;\r\n    col.setWidth(width);\r\n    toggleToolbarIcons(node, col);\r\n  };\r\n\r\n  const mouseUp = (evt: MouseEvent) => {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    const end = evt.clientX;\r\n    node.classList.remove(cssClass('change-width'));\r\n\r\n    ueberElement.removeEventListener('mousemove', mouseMove);\r\n    ueberElement.removeEventListener('mouseup', mouseUp);\r\n    ueberElement.removeEventListener('mouseleave', mouseUp);\r\n    ueberElement.classList.remove(cssClass('resizing'));\r\n    node.style.width = null;\r\n    setTimeout(() => {\r\n      sizeHelper.classList.remove(cssClass('resizing'), cssClass('resize-animated'));\r\n    }, RESIZE_ANIMATION_DURATION * 1.2); // after animation ended\r\n\r\n    if (Math.abs(start - end) < 2) {\r\n      //ignore\r\n      return;\r\n    }\r\n    const delta = end - start;\r\n    const width = Math.max(0, col.getWidth() + delta);\r\n    col.setWidth(width);\r\n    toggleToolbarIcons(node, col);\r\n  };\r\n  handle.onmousedown = (evt) => {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    node.classList.add(cssClass('change-width'));\r\n\r\n    originalWidth = col.getWidth();\r\n    start = evt.clientX;\r\n    ueberElement = <HTMLElement>node.closest('body') || <HTMLElement>node.closest(`.${cssClass()}`)!; // take the whole body or root lineup\r\n    ueberElement.addEventListener('mousemove', mouseMove);\r\n    ueberElement.addEventListener('mouseup', mouseUp);\r\n    ueberElement.addEventListener('mouseleave', mouseUp);\r\n    ueberElement.classList.add(cssClass('resizing'));\r\n\r\n    sizeHelper = <HTMLElement>node.closest(`.${engineCssClass()}`)!.querySelector<HTMLElement>(`.${cssClass('resize-helper')}`);\r\n    currentFooterTransformation = (<HTMLElement>sizeHelper.previousElementSibling!).style.transform!;\r\n    sizeHelper.style.transform = `${currentFooterTransformation} translate(${-RESIZE_SPACE}px, 0px)`;\r\n    sizeHelper.classList.add(cssClass('resizing'));\r\n  };\r\n  handle.onclick = (evt) => {\r\n    // avoid resorting\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport const MIMETYPE_PREFIX = 'text/x-caleydo-lineup-column';\r\n\r\n/**\r\n * allow to drag the column away\r\n * @internal\r\n */\r\nexport function dragAbleColumn(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\r\n  dragAble(node, () => {\r\n    const ref = JSON.stringify(ctx.provider.toDescRef(column.desc));\r\n    const data: any = {\r\n      'text/plain': column.label,\r\n      [`${MIMETYPE_PREFIX}-ref`]: column.id,\r\n      [MIMETYPE_PREFIX]: ref\r\n    };\r\n    if (isNumberColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-number`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-number-ref`] = column.id;\r\n    }\r\n    if (isCategoricalColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-categorical`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-categorical-ref`] = column.id;\r\n    }\r\n    if (isBoxPlotColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-boxplot`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-boxplot-ref`] = column.id;\r\n    }\r\n    if (isMapColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-map`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-map-ref`] = column.id;\r\n    }\r\n    if (isArrayColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-array`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-array-ref`] = column.id;\r\n    }\r\n    if (isNumbersColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-numbers`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-numbers-ref`] = column.id;\r\n    }\r\n    return {\r\n      effectAllowed: 'copyMove',\r\n      data\r\n    };\r\n  }, true);\r\n}\r\n\r\n/**\r\n * dropper for allowing to rearrange (move, copy) columns\r\n * @internal\r\n */\r\nexport function rearrangeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\r\n  dropAble(node, [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX], (result) => {\r\n    let col: Column | null = null;\r\n    const data = result.data;\r\n    if (!(`${MIMETYPE_PREFIX}-ref` in data)) {\r\n      const desc = JSON.parse(data[MIMETYPE_PREFIX]);\r\n      col = ctx.provider.create(ctx.provider.fromDescRef(desc));\r\n      return col != null && column.insertAfterMe(col) != null;\r\n    }\r\n\r\n    // find by reference\r\n    const id = data[`${MIMETYPE_PREFIX}-ref`];\r\n    col = ctx.provider.find(id);\r\n    if (!col || (col === column && !result.effect.startsWith('copy'))) {\r\n      return false;\r\n    }\r\n    if (result.effect.startsWith('copy')) {\r\n      col = ctx.provider.clone(col!);\r\n      return col != null && column.insertAfterMe(col) != null;\r\n    }\r\n    // detect whether it is an internal move operation or an real remove/insert operation\r\n    const toInsertParent = col.parent;\r\n    if (!toInsertParent) { // no parent will always be a move\r\n      return column.insertAfterMe(col) != null;\r\n    }\r\n    if (toInsertParent === column.parent) {\r\n      // move operation\r\n      return toInsertParent.moveAfter(col, column) != null;\r\n    }\r\n    col.removeMe();\r\n    return column.insertAfterMe(col) != null;\r\n  }, null, true);\r\n}\r\n\r\n/**\r\n * dropper for allowing to change the order by dropping it at a certain position\r\n * @internal\r\n */\r\nexport function resortDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext, where: 'before' | 'after', autoGroup: boolean) {\r\n  dropAble(node, [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX], (result) => {\r\n    let col: Column | null = null;\r\n    const data = result.data;\r\n    if (`${MIMETYPE_PREFIX}-ref` in data) {\r\n      const id = data[`${MIMETYPE_PREFIX}-ref`];\r\n      col = ctx.provider.find(id);\r\n      if (!col || col === column) {\r\n        return false;\r\n      }\r\n    } else {\r\n      const desc = JSON.parse(data[MIMETYPE_PREFIX]);\r\n      col = ctx.provider.create(ctx.provider.fromDescRef(desc));\r\n      if (col) {\r\n        column.findMyRanker()!.push(col);\r\n      }\r\n    }\r\n    const ranking = column.findMyRanker()!;\r\n    if (!col || col === column || !ranking) {\r\n      return false;\r\n    }\r\n\r\n    const criteria = ranking.getSortCriteria();\r\n    const groups = ranking.getGroupCriteria();\r\n\r\n    const removeFromSort = (col: Column) => {\r\n      const existing = criteria.findIndex((d) => d.col === col);\r\n      if (existing >= 0) { // remove existing column but keep asc state\r\n        return criteria.splice(existing, 1)[0].asc;\r\n      }\r\n      return false;\r\n    };\r\n\r\n    // remove the one to add\r\n    const asc = removeFromSort(col);\r\n\r\n    const groupIndex = groups.indexOf(column);\r\n    const index = criteria.findIndex((d) => d.col === column);\r\n\r\n    if (autoGroup && groupIndex >= 0) {\r\n      // before the grouping, so either ungroup or regroup\r\n      removeFromSort(column);\r\n      if (isCategoricalColumn(col)) { // we can group by it\r\n        groups.splice(groupIndex + (where === 'after' ? 1 : 0), 0, col);\r\n      } else {\r\n        // remove all before and shift to sorting + sorting\r\n        const removed = groups.splice(0, groups.length - groupIndex);\r\n        criteria.unshift(...removed.reverse().map((d) => ({asc: false, col: d}))); // now a first sorting criteria\r\n        criteria.unshift({asc, col});\r\n      }\r\n    } else if (index < 0) {\r\n      criteria.push({asc, col});\r\n    } else if (index === 0 && autoGroup && isCategoricalColumn(col)) {\r\n      // make group criteria\r\n      groups.push(col);\r\n    } else {\r\n      criteria.splice(index + (where === 'after' ? 1 : 0), 0, {asc, col});\r\n    }\r\n\r\n    if (!equalArrays(groups, ranking.getGroupCriteria())) {\r\n      ranking.setGroupCriteria(groups);\r\n    }\r\n    ranking.setSortCriteria(criteria);\r\n    return true;\r\n  }, null, true);\r\n}\r\n\r\n/**\r\n * dropper for merging columns\r\n * @internal\r\n */\r\nexport function mergeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\r\n  const resolveDrop = (result: IDropResult) => {\r\n    const data = result.data;\r\n    const copy = result.effect === 'copy';\r\n    const prefix = MIMETYPE_PREFIX;\r\n    const key = Object.keys(data).find((d) => d.startsWith(prefix) && d.endsWith('-ref'));\r\n    if (key) {\r\n      const id = data[key];\r\n      let col: Column = ctx.provider.find(id)!;\r\n      if (copy) {\r\n        col = ctx.provider.clone(col);\r\n      } else if (col === column) {\r\n        return null;\r\n      } else {\r\n        col.removeMe();\r\n      }\r\n      return col;\r\n    }\r\n    const alternative = Object.keys(data).find((d) => d.startsWith(prefix));\r\n    if (!alternative) {\r\n      return null;\r\n    }\r\n    const desc = JSON.parse(alternative);\r\n    return ctx.provider.create(ctx.provider.fromDescRef(desc))!;\r\n  };\r\n\r\n  const pushChild = (result: IDropResult) => {\r\n    const col: Column | null = resolveDrop(result);\r\n    return col != null && (<CompositeColumn>column).push(col) != null;\r\n  };\r\n\r\n  const mergeImpl = (col: Column | null, desc: IColumnDesc) => {\r\n    if (col == null) {\r\n      return false;\r\n    }\r\n    const ranking = column.findMyRanker()!;\r\n    const index = ranking.indexOf(column);\r\n    const parent = <CompositeColumn>ctx.provider.create(desc);\r\n    column.removeMe();\r\n    parent.push(column);\r\n    parent.push(col);\r\n    return ranking.insert(parent, index) != null;\r\n  };\r\n\r\n  const mergeWith = (desc: IColumnDesc) => (result: IDropResult) => {\r\n    const col: Column | null = resolveDrop(result);\r\n    return mergeImpl(col, desc);\r\n  };\r\n\r\n  const all = [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX];\r\n  const numberish = [`${MIMETYPE_PREFIX}-number-ref`, `${MIMETYPE_PREFIX}-number`];\r\n  const categorical = [`${MIMETYPE_PREFIX}-categorical-ref`, `${MIMETYPE_PREFIX}-categorical`];\r\n  const boxplot = [`${MIMETYPE_PREFIX}-boxplot-ref`, `${MIMETYPE_PREFIX}-boxplot`];\r\n  const numbers = [`${MIMETYPE_PREFIX}-numbers-ref`, `${MIMETYPE_PREFIX}-numbers`];\r\n\r\n  node.dataset.draginfo = '+';\r\n  if (column instanceof ImpositionCompositeColumn) {\r\n    return dropAble(node, categorical.concat(numberish), pushChild, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...numberish)) {\r\n        node.dataset.draginfo = 'Wrap';\r\n      }\r\n    }, false, () => column.children.length < 2);\r\n  }\r\n  if (column instanceof ImpositionBoxPlotColumn) {\r\n    return dropAble(node, categorical.concat(boxplot), pushChild, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...boxplot)) {\r\n        node.dataset.draginfo = 'Wrap';\r\n      }\r\n    }, false, () => column.children.length < 2);\r\n  }\r\n  if (column instanceof ImpositionCompositesColumn) {\r\n    return dropAble(node, categorical.concat(numbers), pushChild, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...numbers)) {\r\n        node.dataset.draginfo = 'Wrap';\r\n      }\r\n    }, false, () => column.children.length < 2);\r\n  }\r\n  if (isMultiLevelColumn(column)) {\r\n    // stack column or nested\r\n    return dropAble(node, (<IMultiLevelColumn>column).canJustAddNumbers ? numberish : all, pushChild);\r\n  }\r\n  if (column instanceof CompositeColumn) {\r\n    return dropAble(node, (<CompositeColumn>column).canJustAddNumbers ? numberish : all, pushChild);\r\n  }\r\n  if (isNumbersColumn(column)) {\r\n    node.dataset.draginfo = 'Color by';\r\n    return dropAble(node, categorical, mergeWith(createImpositionsDesc()));\r\n  }\r\n  if (isBoxPlotColumn(column)) {\r\n    node.dataset.draginfo = 'Color by';\r\n    return dropAble(node, categorical, mergeWith(createImpositionBoxPlotDesc()));\r\n  }\r\n  if (isNumberColumn(column)) {\r\n    node.dataset.draginfo = 'Merge';\r\n    return dropAble(node, categorical.concat(numberish), (result: IDropResult, evt: DragEvent) => {\r\n      const col: Column | null = resolveDrop(result);\r\n      if (col == null) {\r\n        return false;\r\n      }\r\n      if (isCategoricalColumn(col)) {\r\n        return mergeImpl(col, createImpositionDesc());\r\n      }\r\n      if (isNumberColumn(col)) {\r\n        return mergeImpl(col, evt.shiftKey ? createReduceDesc() : createStackDesc());\r\n      }\r\n      return false;\r\n    }, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...numberish)) {\r\n        node.dataset.draginfo = e.shiftKey ? 'Min/Max' : 'Sum';\r\n      }\r\n    });\r\n  }\r\n  node.dataset.draginfo = 'Group';\r\n  return dropAble(node, all, mergeWith(createNestedDesc()));\r\n}\r\n","import {debounce, clear, suffix} from '../../internal';\r\nimport {CompositeColumn} from '../../model';\r\nimport {createHeader, updateHeader} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {IDialogContext} from './ADialog';\r\nimport {cssClass, engineCssClass} from '../../styles';\r\nimport APopup from './APopup';\r\n\r\n/** @internal */\r\nexport default class CompositeChildrenDialog extends APopup {\r\n\r\n  private readonly id: string;\r\n\r\n  constructor(private readonly column: CompositeColumn, dialog: IDialogContext, private ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n    this.id = `.dialog${Math.random().toString(36).slice(-8).substr(0, 3)}`;\r\n  }\r\n\r\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\r\n    super.cleanUp(action);\r\n    this.column.on(suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN), null);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('dialog-sub-nested'));\r\n    const createChildren = () => {\r\n      this.column.children.forEach((c) => {\r\n        const n = createHeader(c, this.ctx, {\r\n          mergeDropAble: false,\r\n          resizeable: false,\r\n          level: this.dialog.level + 1,\r\n          extraPrefix: 'sub'\r\n        });\r\n        n.className = cssClass('header');\r\n        updateHeader(n, c);\r\n        const summary = this.ctx.summaryRenderer(c, false);\r\n        const summaryNode = this.ctx.asElement(summary.template);\r\n        summaryNode.dataset.renderer = c.getSummaryRenderer();\r\n        summaryNode.classList.add(cssClass('summary'), cssClass('renderer'), cssClass('th-summary'));\r\n\r\n        const r = summary.update(summaryNode);\r\n        if (r) {\r\n          summaryNode.classList.add(engineCssClass('loading'));\r\n          r.then(() => {\r\n            summaryNode.classList.remove(engineCssClass('loading'));\r\n          });\r\n        }\r\n        n.appendChild(summaryNode);\r\n        node.appendChild(n);\r\n      });\r\n    };\r\n    createChildren();\r\n\r\n    this.column.on(suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN), debounce(() => {\r\n      if (!node.parentElement) {\r\n        // already closed\r\n        this.destroy();\r\n        return;\r\n      }\r\n      clear(node);\r\n      createChildren();\r\n    }));\r\n  }\r\n}\r\n","import {HierarchyColumn, ICategoryInternalNode, ICutOffNode, resolveInnerNodes} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class CutOffHierarchyDialog extends ADialog {\r\n\r\n  private readonly innerNodes: ICategoryInternalNode[];\r\n  private readonly innerNodePaths: string[];\r\n\r\n  private readonly before: ICutOffNode;\r\n\r\n\r\n  constructor(private readonly column: HierarchyColumn, dialog: IDialogContext, private readonly idPrefix: string) {\r\n    super(dialog, {\r\n      livePreview: 'cutOff'\r\n    });\r\n\r\n    this.innerNodes = resolveInnerNodes(this.column.hierarchy);\r\n    this.innerNodePaths = this.innerNodes.map((n) => n.path);\r\n    this.before = column.getCutOff();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.insertAdjacentHTML('beforeend', `\r\n        <input type=\"text\" value=\"${this.before.node.label}\" required=\"required\" autofocus=\"autofocus\" list=\"ui${this.idPrefix}lineupHierarchyList\" placeholder=\"cut off node\">\r\n        <input type=\"number\" value=\"${isFinite(this.before.maxDepth) ? this.before.maxDepth : ''}\" placeholder=\"max depth (&infin;)\">\r\n        <datalist id=\"ui${this.idPrefix}lineupHierarchyList\">${this.innerNodes.map((node) => `<option value=\"${node.path}\">${node.label}</option>`)}</datalist>`);\r\n\r\n    //custom validation\r\n    const innerNodePaths = this.innerNodePaths;\r\n    this.findInput('input[type=\"text\"]').addEventListener('change', function (this: HTMLInputElement) {\r\n      const value = this.value;\r\n      if (innerNodePaths.indexOf(value) < 0) {\r\n        this.setCustomValidity('invalid node');\r\n      } else {\r\n        this.setCustomValidity('');\r\n      }\r\n    }, {\r\n      passive: true\r\n    });\r\n\r\n    this.enableLivePreviews('input[type=text],input[type=number]');\r\n  }\r\n\r\n  protected reset() {\r\n    this.findInput('input[type=\"text\"]').value = this.column.hierarchy.path;\r\n    this.findInput('input[type=\"number\"]').value = '';\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setCutOff(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    const newNode = this.findInput('input[type=\"text\"]').value;\r\n    const newNodeIndex = this.innerNodePaths.indexOf(newNode);\r\n    const node = this.innerNodes[newNodeIndex];\r\n    const maxDepthText = this.findInput('input[type=\"number\"]').value;\r\n    const maxDepth = maxDepthText === '' ? Infinity : parseInt(maxDepthText, 10);\r\n    this.column.setCutOff({node, maxDepth});\r\n    return true;\r\n  }\r\n}\r\n","import {DateColumn, IDateFilter} from '../../model';\r\nimport {noDateFilter} from '../../model/internalDate';\r\nimport {createDateFilter} from '../../renderer/DateHistogramCellRenderer';\r\nimport {cssClass} from '../../styles';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default class DateFilterDialog extends ADialog {\r\n  private readonly before: IDateFilter;\r\n  private handler: {reset: () => void, submit: () => void, cleanUp: () => void} | null = null;\r\n\r\n\r\n  constructor(private readonly column: DateColumn, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      livePreview: 'filter',\r\n      cancelSubDialogs: true,\r\n    });\r\n    this.before = this.column.getFilter() || noDateFilter();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('dialog-mapper'));\r\n\r\n    this.handler = createDateFilter(this.column, node, {\r\n      dialogManager: this.ctx.dialogManager,\r\n      idPrefix: this.ctx.idPrefix,\r\n      tasks: this.ctx.provider.getTaskExecutor(),\r\n    }, this.showLivePreviews());\r\n  }\r\n\r\n\r\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\r\n    super.cleanUp(action);\r\n    this.handler!.cleanUp();\r\n  }\r\n\r\n  protected reset() {\r\n    this.handler!.reset();\r\n  }\r\n\r\n  protected submit() {\r\n    this.handler!.submit();\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setFilter(this.before);\r\n  }\r\n}\r\n","import {LinkColumn, LinkMapColumn, LinksColumn} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class EditPatternDialog extends ADialog {\r\n\r\n  private readonly before: string;\r\n\r\n  constructor(private readonly column: LinkColumn | LinksColumn | LinkMapColumn, dialog: IDialogContext, private readonly idPrefix: string) {\r\n    super(dialog);\r\n\r\n    this.before = this.column.getPattern();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const templates = this.column.patternTemplates;\r\n    node.insertAdjacentHTML('beforeend', `<strong>Edit Pattern (access via $\\{value}, $\\{item})</strong><input\r\n        type=\"text\"\r\n        size=\"30\"\r\n        value=\"${this.before}\"\r\n        required\r\n        autofocus\r\n        placeholder=\"pattern (access via $\\{value}, $\\{item})\"\r\n        ${templates.length > 0 ? `list=\"ui${this.idPrefix}lineupPatternList\"` : ''}\r\n      >`);\r\n    if (templates.length > 0) {\r\n      node.insertAdjacentHTML('beforeend', `<datalist id=\"ui${this.idPrefix}lineupPatternList\">${templates.map((t) => `<option value=\"${t}\">`)}</datalist>`);\r\n    }\r\n\r\n    this.enableLivePreviews('input');\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setPattern(this.before);\r\n  }\r\n\r\n  protected reset() {\r\n    this.node.querySelector('input')!.value = '';\r\n  }\r\n\r\n  protected submit() {\r\n    const newValue = this.node.querySelector('input')!.value;\r\n    this.column.setPattern(newValue);\r\n    return true;\r\n  }\r\n}\r\n","import {Column} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {uniqueId, forEach} from './utils';\r\nimport {getToolbarDialogAddons} from '../toolbar';\r\nimport {IRankingHeaderContext, IToolbarDialogAddonHandler} from '../interfaces';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class GroupDialog extends ADialog {\r\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      livePreview: 'group'\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const addons = getToolbarDialogAddons(this.column, 'group', this.ctx);\r\n    for(const addon of addons) {\r\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\r\n      this.handlers.push(addon.append(this.column, this.node, this.dialog, this.ctx));\r\n    }\r\n\r\n    this.handlers.push(sortOrder(node, this.column, this.dialog.idPrefix));\r\n\r\n    for (const handler of this.handlers) {\r\n      this.enableLivePreviews(handler.elems);\r\n    }\r\n  }\r\n\r\n  protected submit() {\r\n    for (const handler of this.handlers) {\r\n      if (handler.submit() === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    for (const handler of this.handlers) {\r\n      handler.cancel();\r\n    }\r\n  }\r\n\r\n  protected reset() {\r\n    for (const handler of this.handlers) {\r\n      handler.reset();\r\n    }\r\n  }\r\n}\r\n\r\nfunction sortOrder(node: HTMLElement, column: Column, idPrefix: string): IToolbarDialogAddonHandler {\r\n  const ranking = column.findMyRanker()!;\r\n  const current = ranking.getGroupCriteria();\r\n  let order = current.indexOf(column);\r\n  const enabled = order >= 0;\r\n\r\n  if (order < 0) {\r\n    order = current.length;\r\n  }\r\n\r\n  const id = uniqueId(idPrefix);\r\n  node.insertAdjacentHTML('afterbegin', `\r\n        <strong>Group By</strong>\r\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"grouped\" value=\"true\" ${enabled ? 'checked' : ''} ><span>Enabled</span></label>\r\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"grouped\" value=\"false\" ${!enabled ? 'checked' : ''} ><span>Disabled</span></label>\r\n        <strong>Group Priority</strong>\r\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${order + 1}\">\r\n    `);\r\n\r\n  const updateDisabled = (disable: boolean) => {\r\n    forEach(node, 'input:not([name=grouped]), select, textarea', (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\r\n      d.disabled = disable;\r\n    });\r\n  };\r\n  updateDisabled(!enabled);\r\n\r\n  forEach(node, 'input[name=grouped]', (n: HTMLInputElement) => {\r\n    n.addEventListener('change', () => {\r\n      const enabled = n.value === 'true';\r\n      updateDisabled(!enabled);\r\n    }, {\r\n      passive: true\r\n    });\r\n  });\r\n\r\n  return {\r\n    elems: `input[name=grouped], #${id}P`,\r\n    submit() {\r\n      const enabled = node.querySelector<HTMLInputElement>('input[name=grouped]:checked')!.value === 'true';\r\n      const order = Number.parseInt(node.querySelector<HTMLInputElement>(`#${id}P`)!.value, 10) - 1;\r\n      ranking.groupBy(column, !enabled ? -1 : order);\r\n      return true;\r\n    },\r\n    reset() {\r\n      node.querySelector<HTMLInputElement>('input[name=grouped][value=false]')!.checked = true;\r\n      node.querySelector<HTMLInputElement>(`#${id}P`)!.value = (current.length + (!enabled ? 1 : 0)).toString();\r\n      updateDisabled(true);\r\n    },\r\n    cancel() {\r\n      ranking.groupBy(column, current.indexOf(column));\r\n    }\r\n  };\r\n}\r\n","import {round, similar, dragHandle, IDragHandleOptions} from '../../internal';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\n\r\nfunction clamp(v: number) {\r\n  return Math.max(Math.min(v, 100), 0);\r\n}\r\n\r\n/** @internal */\r\nexport interface IMappingAdapter {\r\n  destroyed(self: MappingLine): void;\r\n\r\n  updated(self: MappingLine): void;\r\n\r\n  domain(): number[];\r\n\r\n  normalizeRaw(v: number): number;\r\n\r\n  unnormalizeRaw(v: number): number;\r\n\r\n  dialog: IDialogContext;\r\n\r\n  formatter(v: number): string;\r\n}\r\n\r\n/** @internal */\r\nexport default class MappingLineDialog extends ADialog {\r\n  private readonly before: {domain: number, range: number};\r\n\r\n  constructor(private readonly line: {destroy(): void, domain: number, range: number, frozen: boolean, update(domain: number, range: number, trigger: boolean): void}, dialog: IDialogContext, private readonly adapter: IMappingAdapter) {\r\n    super(dialog, {\r\n      livePreview: 'dataMapping'\r\n    });\r\n    this.dialog.attachment.classList.add(cssClass('mapping-line-selected'));\r\n    this.before = {\r\n      domain: this.line.domain,\r\n      range: this.line.range\r\n    };\r\n  }\r\n\r\n  build(node: HTMLElement) {\r\n    const domain = this.adapter.domain();\r\n    node.insertAdjacentHTML('beforeend', `\r\n        <button class=\"${cssClass('dialog-button')} lu-action-remove\" title=\"Remove\" type=\"button\" ${this.line.frozen ? 'style=\"display: none\"' : ''} ><span style=\"margin-left: 3px\">Remove Mapping Line</span></button>\r\n        <strong>Input Domain Value (min ... max)</strong>\r\n        <input type=\"number\" value=\"${this.adapter.formatter(this.adapter.unnormalizeRaw(this.line.domain))}\" ${this.line.frozen ? 'readonly disabled' : ''} autofocus required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\">\r\n        <strong>Output Normalized Value (0 ... 1)</strong>\r\n        <input type=\"number\" value=\"${round(this.line.range / 100, 3)}\" required min=\"0\" max=\"1\" step=\"any\">\r\n      `);\r\n    this.find('button').addEventListener('click', () => {\r\n      this.destroy('confirm');\r\n      this.line.destroy();\r\n    }, {\r\n      passive: true\r\n      });\r\n    this.enableLivePreviews('input');\r\n  }\r\n\r\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\r\n    super.cleanUp(action);\r\n\r\n    this.dialog.attachment.classList.remove(cssClass('mapping-line-selected'));\r\n  }\r\n\r\n  protected cancel() {\r\n    this.line.update(this.before.domain, this.before.range, true);\r\n  }\r\n\r\n  protected reset() {\r\n    this.findInput('input[type=number]').value = round(this.adapter.unnormalizeRaw(this.before.domain), 3).toString();\r\n    this.findInput('input[type=number]:last-of-type').value = round(this.before.range / 100, 3).toString();\r\n  }\r\n\r\n  protected submit() {\r\n    if (!this.node.checkValidity()) {\r\n      return false;\r\n    }\r\n    const domain = this.adapter.normalizeRaw(this.findInput('input[type=number]').valueAsNumber);\r\n    const range = this.findInput('input[type=number]:last-of-type').valueAsNumber * 100;\r\n    this.line.update(domain, range, true);\r\n    return true;\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport class MappingLine {\r\n  readonly node: SVGGElement;\r\n\r\n  constructor(g: SVGGElement, public domain: number, public range: number, private readonly adapter: IMappingAdapter) {\r\n    const h = 52;\r\n    g.insertAdjacentHTML('beforeend', `<g class=\"${cssClass('dialog-mapper-mapping')}\" transform=\"translate(${domain},0)\">\r\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"${h}\"></line>\r\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"${h}\"></line>\r\n      <circle r=\"2\"></circle>\r\n      <circle cx=\"${range - domain}\" cy=\"${h}\" r=\"2\"></circle>\r\n      <text class=\"${cssClass('dialog-mapper-mapping-domain')} ${domain > 25 && domain < 75 ? cssClass('dialog-mapper-mapping-middle') : ''}${domain > 75 ? cssClass('dialog-mapper-mapping-right') : ''}\" dy=\"-3\">\r\n        ${this.adapter.formatter(this.adapter.unnormalizeRaw(domain))}\r\n      </text>\r\n      <text class=\"${cssClass('dialog-mapper-mapping-range')} ${range > 25 && range < 75 ? cssClass('dialog-mapper-mapping-middle') : ''}${range > 50 ? cssClass('dialog-mapper-mapping-right') : ''}\" dy=\"3\" x=\"${range - domain}\" y=\"${h}\">\r\n        ${round(range / 100, 3)}\r\n      </text>\r\n      <title>Drag the anchor circle to change the mapping, double click to edit</title>\r\n    </g>`);\r\n    this.node = <SVGGElement>g.lastElementChild!;\r\n\r\n    // freeze 0 and 100 domain = raw domain ones\r\n    this.node.classList.toggle(cssClass('frozen'), similar(0, domain) || similar(domain, 100));\r\n    {\r\n      let beforeDomain: number;\r\n      let beforeRange: number;\r\n      let shiftDomain: number;\r\n      let shiftRange: number;\r\n\r\n      const normalize = (x: number) => x * 100 / g.getBoundingClientRect().width;\r\n\r\n      const common: Partial<IDragHandleOptions> =  {\r\n        container: g.parentElement!,\r\n        filter: (evt) => evt.button === 0 && !evt.shiftKey,\r\n        onStart: (_, x) => {\r\n          beforeDomain = this.domain;\r\n          beforeRange = this.range;\r\n          const normalized = normalize(x);\r\n          shiftDomain = this.domain - normalized;\r\n          shiftRange = this.range - normalized;\r\n        } ,\r\n        onEnd: () => {\r\n          if (!similar(beforeDomain, this.domain) || !similar(beforeRange, this.range)) {\r\n            this.adapter.updated(this);\r\n          }\r\n        }\r\n      };\r\n\r\n      const line = this.node.querySelector<SVGLineElement>('line:first-of-type')!;\r\n      dragHandle(line, { // line\r\n        ...common,\r\n        onDrag: (_, x) => {\r\n          const normalized = normalize(x);\r\n          this.update(clamp(normalized + shiftDomain), clamp(normalized + shiftRange));\r\n        },\r\n      });\r\n\r\n      const domainCircle = this.node.querySelector<SVGLineElement>('circle:first-of-type')!;\r\n      dragHandle(domainCircle, {\r\n        ...common,\r\n        onDrag: (_, x) => {\r\n          const normalized = normalize(x);\r\n          this.update(clamp(normalized), this.range);\r\n        },\r\n      });\r\n      const rangeCircle = this.node.querySelector<SVGLineElement>('circle:last-of-type')!;\r\n      dragHandle(rangeCircle, {\r\n        ...common,\r\n        onDrag: (_, x) => {\r\n          const normalized = normalize(x);\r\n          this.update(this.domain, clamp(normalized));\r\n        },\r\n      });\r\n    }\r\n\r\n    this.node.onclick = (evt) => {\r\n      if (!evt.shiftKey) {\r\n        return;\r\n      }\r\n      this.openDialog();\r\n    };\r\n\r\n    this.node.ondblclick = () => {\r\n      this.openDialog();\r\n    };\r\n  }\r\n\r\n  private openDialog() {\r\n    const ctx = {\r\n      manager: this.adapter.dialog.manager,\r\n      level: this.adapter.dialog.level + 1,\r\n      attachment: <any>this.node,\r\n      idPrefix: this.adapter.dialog.idPrefix\r\n    };\r\n    const dialog = new MappingLineDialog(this, ctx, this.adapter);\r\n    dialog.open();\r\n  }\r\n\r\n  get frozen() {\r\n    return this.node.classList.contains(cssClass('frozen'));\r\n  }\r\n\r\n  destroy(handled = false) {\r\n    this.node.remove();\r\n    if (!handled) {\r\n      this.adapter.destroyed(this);\r\n    }\r\n  }\r\n\r\n  update(domain: number, range: number, trigger = false) {\r\n    if (similar(domain, 100)) {\r\n      domain = 100;\r\n    }\r\n    if (similar(domain, 0)) {\r\n      domain = 0;\r\n    }\r\n    if (similar(range, 100)) {\r\n      range = 100;\r\n    }\r\n    if (similar(range, 0)) {\r\n      range = 0;\r\n    }\r\n\r\n    if (similar(domain, this.domain) && similar(range, this.range)) {\r\n      return;\r\n    }\r\n    if (this.frozen) {\r\n      domain = this.domain;\r\n    }\r\n    this.domain = domain;\r\n    this.range = range;\r\n    this.node.setAttribute('transform', `translate(${domain},0)`);\r\n    const shift = range - domain;\r\n    Array.from(this.node.querySelectorAll<SVGLineElement>('line')).forEach((d) => d.setAttribute('x2', String(shift)));\r\n    this.node.querySelector<SVGCircleElement>('circle[cx]')!.setAttribute('cx', String(shift));\r\n\r\n    const t1 = this.node.querySelector<SVGTextElement>('text')!;\r\n    t1.textContent = this.adapter.formatter(this.adapter.unnormalizeRaw(domain));\r\n    t1.classList.toggle(cssClass('dialog-mapper-mapping-right'), domain > 75);\r\n    t1.classList.toggle(cssClass('dialog-mapper-mapping-middle'), domain >= 25 && domain <= 75);\r\n\r\n    const t2 = this.node.querySelector<SVGTextElement>('text[x]')!;\r\n    t2.textContent = round(range / 100, 3).toString();\r\n    t2.classList.toggle(cssClass('dialog-mapper-mapping-right'), range > 75);\r\n    t2.classList.toggle(cssClass('dialog-mapper-mapping-middle'), range >= 25 && range <= 75);\r\n    t2.setAttribute('x', String(shift));\r\n\r\n    if (trigger) {\r\n      this.adapter.updated(this);\r\n    }\r\n  }\r\n}\r\n","import {ISequence, round} from '../../internal';\r\nimport {IMapAbleColumn, IMappingFunction, isMissingValue, isMapAbleColumn} from '../../model';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {IMappingAdapter, MappingLine} from './MappingLineDialog';\r\nimport {cssClass} from '../../styles';\r\nimport {ScaleMappingFunction, ScriptMappingFunction} from '../../model/MappingFunction';\r\n\r\n/** @internal */\r\nexport default class MappingDialog extends ADialog {\r\n\r\n  private scale: IMappingFunction;\r\n\r\n  private readonly mappingLines: MappingLine[] = [];\r\n  private rawDomain: [number, number];\r\n\r\n  private readonly data: Promise<ISequence<number>>;\r\n  private readonly idPrefix: string;\r\n\r\n  private readonly before: IMappingFunction;\r\n\r\n  private readonly mappingAdapter: IMappingAdapter = {\r\n    destroyed: (self: MappingLine) => {\r\n      this.mappingLines.splice(this.mappingLines.indexOf(self), 1);\r\n      this.updateLines(this.computeScale());\r\n    },\r\n    updated: () => this.updateLines(this.computeScale()),\r\n    domain: () => this.rawDomain,\r\n    normalizeRaw: this.normalizeRaw.bind(this),\r\n    unnormalizeRaw: this.unnormalizeRaw.bind(this),\r\n    dialog: this.dialog,\r\n    formatter: this.column.getNumberFormat()\r\n  };\r\n\r\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext, ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      livePreview: 'dataMapping',\r\n      cancelSubDialogs: true,\r\n    });\r\n\r\n    this.idPrefix = `me${ctx.idPrefix}`;\r\n    this.before = this.column.getMapping().clone();\r\n    this.scale = this.column.getMapping().clone();\r\n    const domain = this.scale.domain;\r\n    this.rawDomain = [domain[0], domain[domain.length - 1]];\r\n\r\n    this.data = Promise.resolve(ctx.provider.mappingSample(column));\r\n  }\r\n\r\n  private get scaleType() {\r\n    if ((this.scale instanceof ScriptMappingFunction)) {\r\n      return 'script';\r\n    }\r\n    if (this.scale instanceof ScaleMappingFunction) {\r\n      const base = this.scale.scaleType;\r\n      if (base !== 'linear') {\r\n        return base;\r\n      }\r\n      // check if invert or absolute\r\n      const r = this.scale.range;\r\n      if (r.length === 2 && r[0] === 1 && r[1] === 0) {\r\n        return 'linear_invert';\r\n      }\r\n      if (r.length === 3 && r[0] === 1 && r[1] === 0 && r[2] === 1) {\r\n        return 'linear_abs';\r\n      }\r\n      return 'linear';\r\n    }\r\n    return 'unknown';\r\n  }\r\n\r\n  build(node: HTMLElement) {\r\n    node.classList.add(cssClass('dialog-mapper'));\r\n\r\n    const r = this.column.findMyRanker();\r\n    const others = !r ? [] : r.flatColumns.filter((d) => isMapAbleColumn(d) && d !== this.column);\r\n\r\n    node.insertAdjacentHTML('beforeend', `\r\n        <div><label for=\"${this.idPrefix}mapping_type\"><strong>Normalization Scaling:</strong></label><select id=\"${this.idPrefix}mapping_type\" class=\"browser-default\">\r\n        <option value=\"linear\">Linear</option>\r\n        <option value=\"linear_invert\">Invert</option>\r\n        <option value=\"linear_abs\">Absolute</option>\r\n        <option value=\"log\">Log</option>\r\n        <option value=\"pow1.1\">Pow 1.1</option>\r\n        <option value=\"pow2\">Pow 2</option>\r\n        <option value=\"pow3\">Pow 3</option>\r\n        <option value=\"sqrt\">Sqrt</option>\r\n        <option value=\"script\">Custom Script</option>\r\n        <option value=\"unknown\">Unknown</option>\r\n        ${others.length > 0 ? `<optgroup label=\"Copy From\">${others.map((d) => `<option value=\"copy_${d.id}\">${d.label}</option>`).join('')}</optgroup>`: ''}\r\n      </select>\r\n      </div>\r\n        <div class=${cssClass('dialog-mapper-domain')}>\r\n          <input id=\"${this.idPrefix}min\" required type=\"number\" value=\"${round(this.rawDomain[0], 3)}\" step=\"any\">\r\n          <span>Input Domain (min - max)</span>\r\n          <input id=\"${this.idPrefix}max\" required type=\"number\" value=\"${round(this.rawDomain[1], 3)}\" step=\"any\">\r\n        </div>\r\n        <svg class=\"${cssClass('dialog-mapper-details')}\" viewBox=\"0 0 106 66\">\r\n           <g transform=\"translate(3,7)\">\r\n              <rect y=\"-3\" width=\"100\" height=\"10\">\r\n                <title>Click to create a new mapping line</title>\r\n              </rect>\r\n              <rect y=\"49\" width=\"100\" height=\"10\">\r\n                <title>Click to create a new mapping line</title>\r\n              </rect>\r\n           </g>\r\n        </svg>\r\n        <div class=${cssClass('dialog-mapper-range')}>\r\n          <span>Output Normalized Domain (0 - 1)</span>\r\n        </div>\r\n        <div class=\"${cssClass('dialog-mapper-script')}\">\r\n          <strong>Custom Normalization Script</strong>\r\n          <textarea class=\"${cssClass('textarea')}\"></textarea>\r\n        </div>`);\r\n\r\n    const g = <SVGGElement>node.querySelector(`.${cssClass('dialog-mapper-details')} > g`);\r\n\r\n    this.forEach(`.${cssClass('dialog-mapper-details')} rect`, (d: SVGRectElement) => d.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      const bb = d.getBoundingClientRect();\r\n      const x = round((evt.x - bb.left) * 100 / bb.width, 2);\r\n      const m = new MappingLine(g, x, x, this.mappingAdapter);\r\n      this.mappingLines.push(m);\r\n    });\r\n\r\n    {\r\n\r\n      const select = <HTMLSelectElement>this.find('select');\r\n      const textarea = <HTMLTextAreaElement>this.find('textarea');\r\n      select.onchange = (evt) => {\r\n        const select = <HTMLSelectElement>evt.currentTarget;\r\n        switch (select.value) {\r\n          case 'linear_invert':\r\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), 'linear', [1, 0]);\r\n            break;\r\n          case 'linear_abs':\r\n            this.scale = new ScaleMappingFunction([this.rawDomain[0], (this.rawDomain[1] - this.rawDomain[0]) / 2, this.rawDomain[1]], 'linear', [1, 0, 1]);\r\n            break;\r\n          case 'script':\r\n            const s = new ScriptMappingFunction(this.rawDomain.slice());\r\n            this.scale = s;\r\n            textarea.value = s.code;\r\n            break;\r\n          case 'unknown':\r\n            // clone original again\r\n            this.scale = this.column.getOriginalMapping().clone();\r\n            break;\r\n          default:\r\n            if (select.value.startsWith('copy_')) {\r\n              this.copyMapping(select.value.slice('copy_'.length));\r\n              return;\r\n            }\r\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), select.value, [0, 1]);\r\n            break;\r\n        }\r\n        this.createMappings();\r\n        node.dataset.scale = select.value;\r\n        this.updateLines();\r\n      };\r\n      const scaleType = node.dataset.scale = this.scaleType;\r\n      select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\r\n\r\n      if (scaleType === 'script') {\r\n        textarea.value = (<ScriptMappingFunction>this.scale).code;\r\n      }\r\n      this.createMappings();\r\n    }\r\n\r\n    {\r\n      this.forEach(`#${this.idPrefix}min, #${this.idPrefix}max`, (d: HTMLInputElement, i) => d.onchange = () => {\r\n        const v = d.valueAsNumber;\r\n        if (v === this.rawDomain[i]) {\r\n          d.setCustomValidity('');\r\n          return;\r\n        }\r\n        const other = this.rawDomain[1 - i];\r\n        if (isNaN(v) || (i === 0 && v >= other) || (i === 1 && v <= other)) {\r\n          d.setCustomValidity(`value has to be ${i === 0 ? '<= max' : '>= min'}`);\r\n          return;\r\n        }\r\n        d.setCustomValidity('');\r\n        this.rawDomain[i] = v;\r\n        this.scale = this.computeScale();\r\n        const patchedDomain = this.scale.domain.slice();\r\n        patchedDomain[0] = this.rawDomain[0];\r\n        patchedDomain[patchedDomain.length - 1] = this.rawDomain[1];\r\n        this.scale.domain = patchedDomain;\r\n        this.createMappings();\r\n        this.updateLines();\r\n        if (this.showLivePreviews()) {\r\n          this.column.setMapping(this.scale);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.data.then((values) => {\r\n      values.forEach((v) => {\r\n        if (!isMissingValue(v)) {\r\n          g.insertAdjacentHTML('afterbegin', `<line data-v=\"${v}\" x1=\"${round(this.normalizeRaw(v), 2)}\" x2=\"${round(this.scale.apply(v) * 100, 2)}\" y2=\"52\"></line>`);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private createMappings() {\r\n    this.mappingLines.splice(0, this.mappingLines.length).forEach((d) => d.destroy(true));\r\n    if (!(this.scale instanceof ScaleMappingFunction)) {\r\n      return;\r\n    }\r\n    const g = <SVGGElement>this.node.querySelector(`.${cssClass('dialog-mapper-details')} > g`);\r\n    const domain = this.scale.domain;\r\n    const range = this.scale.range;\r\n    for (let i = 0; i < domain.length; ++i) {\r\n      this.mappingLines.push(new MappingLine(g, this.normalizeRaw(domain[i]), range[i] * 100, this.mappingAdapter));\r\n    }\r\n  }\r\n\r\n  private update() {\r\n    const scaleType = this.node.dataset.scale = this.scaleType;\r\n    const select = <HTMLSelectElement>this.find('select');\r\n    select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\r\n    if (scaleType === 'script') {\r\n      (<HTMLTextAreaElement>this.find('textarea')).value = (<ScriptMappingFunction>this.scale).code;\r\n    }\r\n    this.forEach(`input[type=number]`, (d: HTMLInputElement, i) => {\r\n      d.value = round(this.rawDomain[i], 3).toString();\r\n    });\r\n  }\r\n\r\n  private updateLines(scale = this.scale) {\r\n    this.forEach(`.${cssClass('dialog-mapper-details')}  > g > line[x1]`, (d: SVGLineElement) => {\r\n      const v = parseFloat(d.getAttribute('data-v')!);\r\n      d.setAttribute('x1', round(this.normalizeRaw(v), 2).toString());\r\n      d.setAttribute('x2', round(scale.apply(v) * 100, 2).toString());\r\n    });\r\n  }\r\n\r\n  protected reset() {\r\n    this.scale = this.column.getOriginalMapping().clone();\r\n    const domain = this.scale.domain;\r\n    this.rawDomain = [domain[0], domain[domain.length - 1]];\r\n    this.update();\r\n    this.createMappings();\r\n    this.updateLines();\r\n  }\r\n\r\n  private copyMapping(columnId: string) {\r\n    const r = this.column.findMyRanker();\r\n    if (!r) {\r\n      return;\r\n    }\r\n    const ref = <IMapAbleColumn>r.find(columnId)!;\r\n    this.scale = ref.getMapping().clone();\r\n    this.rawDomain = <[number, number]>this.scale.domain.slice();\r\n    this.update();\r\n    this.createMappings();\r\n    this.updateLines();\r\n  }\r\n\r\n  private normalizeRaw(d: number) {\r\n    const v = (d - this.rawDomain[0]) * 100 / (this.rawDomain[1] - this.rawDomain[0]);\r\n    return Math.max(Math.min(v, 100), 0); // clamp\r\n  }\r\n\r\n  private unnormalizeRaw(d: number) {\r\n    return (d) * (this.rawDomain[1] - this.rawDomain[0]) / 100 + this.rawDomain[0];\r\n  }\r\n\r\n  private computeScale() {\r\n    const type = this.scaleType;\r\n    if (type === 'script') {\r\n      return new ScriptMappingFunction(this.rawDomain.slice(), this.node.querySelector('textarea')!.value);\r\n    }\r\n    this.mappingLines.sort((a, b) => a.domain - b.domain);\r\n    const domain = this.mappingLines.map((d) => this.unnormalizeRaw(d.domain));\r\n    const range = this.mappingLines.map((d) => d.range / 100);\r\n    return new ScaleMappingFunction(domain, type, range);\r\n  }\r\n\r\n  protected submit() {\r\n    if (!this.node.checkValidity()) {\r\n      return false;\r\n    }\r\n    const scale = this.computeScale();\r\n    this.column.setMapping(scale);\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setMapping(this.before);\r\n  }\r\n}\r\n","import {IMapAbleColumn, INumberFilter} from '../../model';\r\nimport {createNumberFilter} from '../../renderer/HistogramCellRenderer';\r\nimport {cssClass} from '../../styles';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class NumberFilterDialog extends ADialog {\r\n  private readonly before: INumberFilter;\r\n  private handler: {reset: () => void, submit: () => void, cleanUp: () => void} | null = null;\r\n\r\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      livePreview: 'filter',\r\n      cancelSubDialogs: true,\r\n    });\r\n\r\n    this.before = column.getFilter();\r\n  }\r\n\r\n  build(node: HTMLElement) {\r\n    node.classList.add(cssClass('dialog-mapper'));\r\n\r\n    this.handler = createNumberFilter(this.column, node, {\r\n      dialogManager: this.ctx.dialogManager,\r\n      idPrefix: this.ctx.idPrefix,\r\n      tasks: this.ctx.provider.getTaskExecutor(),\r\n    }, this.showLivePreviews());\r\n  }\r\n\r\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\r\n    super.cleanUp(action);\r\n    this.handler!.cleanUp();\r\n  }\r\n\r\n  protected reset() {\r\n    this.handler!.reset();\r\n  }\r\n\r\n  protected submit() {\r\n    this.handler!.submit();\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setFilter(this.before);\r\n  }\r\n}\r\n","import {forEach} from '../../renderer/utils';\r\nimport {cssClass} from '../../styles';\r\nimport {getSortLabel} from '../../internal';\r\nimport {IToolbarDialogAddonHandler} from '../interfaces';\r\n\r\n/** @internal */\r\nexport function sortMethods(node: HTMLElement, column: {setSortMethod(v: string): void, getSortMethod(): string}, methods: string[]): IToolbarDialogAddonHandler {\r\n  const bak = column.getSortMethod();\r\n  methods.forEach((d) => node.insertAdjacentHTML('beforeend', `<label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"multivaluesort\" value=\"${d}\"  ${(bak === d) ? 'checked' : ''} ><span>${getSortLabel(d)}</span></label>`));\r\n\r\n  forEach(node, 'input[name=multivaluesort]', (n: HTMLInputElement) => {\r\n    n.addEventListener('change', () => column.setSortMethod(n.value), {\r\n      passive: true\r\n    });\r\n  });\r\n\r\n  return {\r\n    elems: 'input[name=multivaluesort]',\r\n    submit() {\r\n      const selected = node.querySelector<HTMLInputElement>('input[name=multivaluesort]:checked')!.value;\r\n      column.setSortMethod(selected);\r\n      return true;\r\n    },\r\n    cancel() {\r\n      column.setSortMethod(bak);\r\n    },\r\n    reset() {\r\n      node.querySelector<HTMLInputElement>(`input[name=multivaluesort][value=\"${bak}\"]`)!.checked = true;\r\n    }\r\n  };\r\n}\r\n\r\n\r\n/** @internal */\r\nexport {uniqueId, forEach, forEachChild, colorOf} from '../../renderer/utils';\r\n","import {EAdvancedSortMethod, ReduceColumn} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {sortMethods} from './utils';\r\nimport {IToolbarDialogAddonHandler} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default class ReduceDialog extends ADialog {\r\n  private handler: IToolbarDialogAddonHandler | null = null;\r\n\r\n  constructor(private readonly column: ReduceColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      livePreview: 'reduce'\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const wrapper = {\r\n      getSortMethod: () => this.column.getReduce(),\r\n      setSortMethod: (s: EAdvancedSortMethod) => this.column.setReduce(s)\r\n    };\r\n    this.handler = sortMethods(node, wrapper, Object.keys(EAdvancedSortMethod));\r\n\r\n    this.enableLivePreviews(this.handler.elems);\r\n  }\r\n\r\n  protected submit() {\r\n    return this.handler!.submit();\r\n  }\r\n\r\n  protected reset() {\r\n    this.handler!.reset();\r\n  }\r\n\r\n  protected cancel() {\r\n    this.handler!.cancel();\r\n  }\r\n}\r\n","import {Column, IColumnMetaData} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class RenameDialog extends ADialog {\r\n\r\n  private readonly before: IColumnMetaData;\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext) {\r\n    super(dialog);\r\n    this.before = column.getMetaData();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('dialog-rename'));\r\n    node.insertAdjacentHTML('beforeend', `\r\n      <input type=\"text\" value=\"${this.column.label}\" required autofocus placeholder=\"name\">\r\n      <input type=\"text\" value=\"${this.column.getMetaData().summary}\" placeholder=\"summary\" name=\"summary\">\r\n      <textarea class=\"${cssClass('textarea')}\" rows=\"5\" placeholder=\"description\">${this.column.description}</textarea>`);\r\n  }\r\n\r\n  protected reset() {\r\n    const desc = this.column.desc;\r\n    const meta = {\r\n      label: desc.label || this.column.id,\r\n      summary: desc.summary || '',\r\n      description: desc.description || ''\r\n    };\r\n    this.findInput('input[type=\"text\"]').value = meta.label;\r\n    this.findInput('input[name=\"summary\"]').value = meta.summary;\r\n    this.node.querySelector('textarea')!.value = meta.description;\r\n  }\r\n\r\n  protected submit() {\r\n    const label = this.findInput('input[type=\"text\"]').value;\r\n    const summary = this.findInput('input[name=\"summary\"]').value.trim();\r\n    const description = this.node.querySelector('textarea')!.value;\r\n    this.column.setMetaData({label, description, summary});\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setMetaData(this.before);\r\n  }\r\n}\r\n","import {ScriptColumn} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class ScriptEditDialog extends ADialog {\r\n  private readonly before: string;\r\n\r\n  constructor(private readonly column: ScriptColumn, dialog: IDialogContext) {\r\n    super(dialog);\r\n    this.before = column.getScript();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.insertAdjacentHTML('beforeend', `<textarea class=\"${cssClass('textarea')}\" autofocus=\"true\" rows=\"5\" autofocus=\"autofocus\" style=\"width: 95%;\">${this.column.getScript()}</textarea>`);\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setScript(this.before);\r\n  }\r\n\r\n  protected reset() {\r\n    this.node.querySelector('textarea')!.value = (<any>this.column.desc).script || ScriptColumn.DEFAULT_SCRIPT;\r\n  }\r\n\r\n  protected submit() {\r\n    this.column.setScript(this.node.querySelector('textarea')!.value);\r\n    return true;\r\n  }\r\n}\r\n","import {Column} from '../../model';\r\nimport {IDataProvider} from '../../provider';\r\nimport ADialog, { IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\nimport {debounce} from '../../internal';\r\n\r\n/** @internal */\r\nexport default class SearchDialog extends ADialog {\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly provider: IDataProvider) {\r\n    super(dialog, {\r\n      livePreview: 'search'\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.insertAdjacentHTML('beforeend', `<input type=\"text\" size=\"20\" value=\"\" required autofocus placeholder=\"search... (>= 3 chars)\">\r\n      <label class=\"${cssClass('checkbox')}\">\r\n        <input type=\"checkbox\">\r\n        <span>Use regular expressions</span>\r\n      </label>\r\n    `);\r\n\r\n    const input = <HTMLInputElement>node.querySelector('input[type=\"text\"]')!;\r\n    const checkbox = <HTMLInputElement>node.querySelector('input[type=\"checkbox\"]')!;\r\n    const update = () => {\r\n      const search: any = input.value;\r\n      if (search.length < 3) {\r\n        input.setCustomValidity('at least 3 characters');\r\n        return;\r\n      }\r\n      input.setCustomValidity('');\r\n    };\r\n    input.addEventListener('input', update, {\r\n      passive: true\r\n    });\r\n    checkbox.addEventListener('change', update, {\r\n      passive: true\r\n    });\r\n    this.enableLivePreviews([input, checkbox]);\r\n\r\n    if (!this.showLivePreviews()) {\r\n      return;\r\n    }\r\n    input.addEventListener('input', debounce(() => this.submit(), 100), {\r\n      passive: true\r\n    });\r\n  }\r\n\r\n  protected submit() {\r\n    const input = this.findInput('input[type=\"text\"]')!;\r\n    const checkbox = this.findInput('input[type=\"checkbox\"]')!;\r\n\r\n    let search: any = input.value;\r\n    const isRegex = checkbox.checked;\r\n    if (isRegex) {\r\n      search = new RegExp(search);\r\n    }\r\n    this.provider.searchAndJump(search, this.column);\r\n    return true;\r\n  }\r\n\r\n  protected reset() {\r\n    const input = this.findInput('input[type=\"text\"]')!;\r\n    const checkbox = this.findInput('input[type=\"checkbox\"]')!;\r\n    input.value = '';\r\n    checkbox.checked = false;\r\n  }\r\n\r\n  protected cancel() {\r\n    // nothing to do\r\n  }\r\n}\r\n","import ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\nimport {IDataProvider} from '../../provider';\r\n\r\n/** @internal */\r\nexport default class ShowTopNDialog extends ADialog {\r\n\r\n  private readonly before: number;\r\n\r\n  constructor(private readonly provider: IDataProvider, dialog: IDialogContext) {\r\n    super(dialog);\r\n\r\n    this.before = this.provider.getShowTopN();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('dialog-rename'));\r\n    node.insertAdjacentHTML('beforeend', `\r\n      <input type=\"number\" min=\"0\" step=\"1\" value=\"${this.before}\">`);\r\n\r\n    this.enableLivePreviews('input');\r\n  }\r\n\r\n  protected cancel() {\r\n    this.provider.setShowTopN(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    const value = this.findInput('input').valueAsNumber;\r\n    this.provider.setShowTopN(value);\r\n    return true;\r\n  }\r\n\r\n  protected reset() {\r\n    const defaultValue = 10;\r\n    this.findInput('input').value = defaultValue.toString();\r\n  }\r\n}\r\n","import {Column} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {uniqueId, forEach} from './utils';\r\nimport {getToolbarDialogAddons} from '../toolbar';\r\nimport {IRankingHeaderContext, IToolbarDialogAddonHandler} from '../interfaces';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class SortDialog extends ADialog {\r\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\r\n\r\n  constructor(private readonly column: Column, private readonly groupSortBy: boolean, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      livePreview: groupSortBy ? 'groupSort' : 'sort'\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const addons = getToolbarDialogAddons(this.column, this.groupSortBy ? 'sortGroup' : 'sort', this.ctx);\r\n    for(const addon of addons) {\r\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\r\n      this.handlers.push(addon.append(this.column, this.node, this.dialog, this.ctx));\r\n    }\r\n\r\n    this.handlers.push(sortOrder(node, this.column, this.dialog.idPrefix, this.groupSortBy));\r\n\r\n    for (const handler of this.handlers) {\r\n      this.enableLivePreviews(handler.elems);\r\n    }\r\n  }\r\n\r\n  protected submit() {\r\n    for (const handler of this.handlers) {\r\n      if (handler.submit() === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    for (const handler of this.handlers) {\r\n      handler.cancel();\r\n    }\r\n  }\r\n\r\n  protected reset() {\r\n    for (const handler of this.handlers) {\r\n      handler.reset();\r\n    }\r\n  }\r\n}\r\n\r\nfunction sortOrder(node: HTMLElement, column: Column, idPrefix: string, groupSortBy: boolean = false): IToolbarDialogAddonHandler {\r\n  const ranking = column.findMyRanker()!;\r\n  const current = groupSortBy  ? ranking.getGroupSortCriteria() : ranking.getSortCriteria();\r\n  const order = Object.assign({}, groupSortBy ? column.isGroupSortedByMe() : column.isSortedByMe());\r\n\r\n  const priority = order.priority === undefined ? current.length : order.priority;\r\n\r\n  const id = uniqueId(idPrefix);\r\n  node.insertAdjacentHTML('afterbegin', `\r\n        <strong>Sort Order</strong>\r\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"asc\"  ${(order.asc === 'asc') ? 'checked' : ''} ><span>Ascending</span></label>\r\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"desc\"  ${(order.asc === 'desc') ? 'checked' : ''} ><span>Decending</span></label>\r\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"none\"  ${(order.asc === undefined) ? 'checked' : ''} ><span>Unsorted</span></label>\r\n        <strong>Sort Priority</strong>\r\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${priority + 1}\">\r\n    `);\r\n\r\n  const updateDisabled = (disable: boolean) => {\r\n    forEach(node, 'input:not([name=sortorder]), select, textarea', (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\r\n      d.disabled = disable;\r\n    });\r\n  };\r\n  updateDisabled(order.asc === undefined);\r\n\r\n  forEach(node, 'input[name=sortorder]', (n: HTMLInputElement) => {\r\n    n.addEventListener('change', () => {\r\n      updateDisabled(n.value === 'none');\r\n    }, {\r\n      passive: true\r\n    });\r\n  });\r\n\r\n  return {\r\n    elems: `input[name=sortorder], #${id}P`,\r\n    submit() {\r\n      const asc = node.querySelector<HTMLInputElement>('input[name=sortorder]:checked')!.value;\r\n      const priority = Number.parseInt(node.querySelector<HTMLInputElement>(`#${id}P`)!.value, 10) - 1;\r\n\r\n      if (groupSortBy) {\r\n        ranking.groupSortBy(column, asc === 'asc', asc === 'none' ? -1 : priority);\r\n      } else {\r\n        ranking.sortBy(column, asc === 'asc', asc === 'none' ? -1 : priority);\r\n      }\r\n      return true;\r\n    },\r\n    reset() {\r\n      node.querySelector<HTMLInputElement>('input[name=sortorder][value=none]')!.checked = true;\r\n      node.querySelector<HTMLInputElement>(`#${id}P`)!.value = (current.length + (order.priority === undefined ? 1 : 0)).toString();\r\n      updateDisabled(true);\r\n    },\r\n    cancel() {\r\n      if (groupSortBy) {\r\n        ranking.groupSortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\r\n      } else {\r\n        ranking.sortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import {StringColumn, IStringFilter} from '../../model';\r\nimport {filterMissingMarkup, findFilterMissing} from '../missing';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\nimport {debounce} from '../../internal';\r\n\r\n\r\nfunction toInput(text: string, isRegex: boolean) {\r\n  const v = text.trim();\r\n  if (v === '') {\r\n    return null;\r\n  }\r\n  return isRegex ? new RegExp(v, 'gm') : v;\r\n}\r\n\r\n\r\n/** @internal */\r\nexport default class StringFilterDialog extends ADialog {\r\n\r\n  private readonly before: IStringFilter | null;\r\n\r\n  constructor(private readonly column: StringColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      livePreview: 'filter'\r\n    });\r\n\r\n    this.before = this.column.getFilter();\r\n  }\r\n\r\n  private updateFilter(filter: string | RegExp | null, filterMissing: boolean) {\r\n    if (filter == null && !filterMissing) {\r\n      this.column.setFilter(null);\r\n    } else {\r\n      this.column.setFilter({filter, filterMissing});\r\n    }\r\n  }\r\n\r\n  protected reset() {\r\n    this.findInput('input[type=\"text\"]').value = '';\r\n    this.forEach('input[type=checkbox]', (n: HTMLInputElement) => n.checked = false);\r\n  }\r\n\r\n  protected cancel() {\r\n    if (this.before) {\r\n      this.updateFilter(this.before.filter === '' ? null : this.before.filter, this.before.filterMissing);\r\n    } else {\r\n      this.updateFilter(null, false);\r\n    }\r\n  }\r\n\r\n  protected submit() {\r\n    const filterMissing = findFilterMissing(this.node).checked;\r\n    const input = this.findInput('input[type=\"text\"]').value;\r\n    const isRegex = this.findInput('input[type=\"checkbox\"]').checked;\r\n    this.updateFilter(toInput(input, isRegex), filterMissing);\r\n    return true;\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const bak = this.column.getFilter() || {filter: '', filterMissing: false};\r\n    node.insertAdjacentHTML('beforeend', `<input type=\"text\" placeholder=\"Filter ${this.column.desc.label}...\" autofocus value=\"${(bak.filter instanceof RegExp) ? bak.filter.source : bak.filter || ''}\" style=\"width: 100%\">\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input type=\"checkbox\" ${(bak.filter instanceof RegExp) ? 'checked=\"checked\"' : ''}>\r\n      <span>Use regular expressions</span>\r\n    </label>\r\n    ${filterMissingMarkup(bak.filterMissing)}`);\r\n\r\n    const filterMissing = findFilterMissing(node);\r\n    const input = <HTMLInputElement>node.querySelector('input[type=\"text\"]');\r\n    const isRegex = <HTMLInputElement>node.querySelector('input[type=\"checkbox\"]');\r\n\r\n    this.enableLivePreviews([filterMissing, input, isRegex]);\r\n\r\n    if (!this.showLivePreviews()) {\r\n      return;\r\n    }\r\n    input.addEventListener('input', debounce(() => this.submit(), 100), {\r\n      passive: true\r\n    });\r\n  }\r\n}\r\n","import {round} from '../../internal';\r\nimport {StackColumn} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {forEach, colorOf} from './utils';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class WeightsEditDialog extends ADialog {\r\n\r\n  private readonly weights: number[];\r\n\r\n  constructor(private readonly column: StackColumn, dialog: IDialogContext) {\r\n    super(dialog);\r\n\r\n    this.weights = this.column.getWeights();\r\n  }\r\n\r\n  protected cancel() {\r\n    this.column.setWeights(this.weights.slice());\r\n  }\r\n\r\n  protected reset() {\r\n    const weight = 100 / this.weights.length;\r\n    forEach(this.node, 'input[type=number]', (n: HTMLInputElement) => {\r\n      const v = round(weight, 2);\r\n      n.value = String(v);\r\n      (<HTMLElement>n.nextElementSibling!.firstElementChild!).style.width = `${v}%`;\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n\r\n    const children = this.column.children;\r\n    node.insertAdjacentHTML('beforeend', `<div class=\"${cssClass('dialog-table')}\">\r\n        ${this.weights.map((weight, i) => `<div class=\"${cssClass('dialog-weights-table-entry')}\">\r\n          <input type=\"number\" value=\"${round(weight * 100, 2)}\" min=\"0\" max=\"100\" step=\"any\" required>\r\n          <span class=\"${cssClass('dialog-filter-color-bar')}\">\r\n            <span style=\"background-color: ${colorOf(children[i])}; width: ${round(weight * 100, 2)}%\"></span>\r\n          </span>\r\n          ${children[i].label}\r\n        </div>`).join('')}\r\n    </div>`);\r\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]'));\r\n    inputs.forEach((d, i) => {\r\n      d.oninput = () => {\r\n        const weight = d.valueAsNumber;\r\n        if (weight <= 0) {\r\n          d.setCustomValidity('weight cannot be zero');\r\n        } else {\r\n          d.setCustomValidity('');\r\n        }\r\n        this.updateBar(d);\r\n\r\n        if (inputs.length !== 2) {\r\n          return;\r\n        }\r\n\r\n        // corner case auto decrease the other\r\n        const rest = 100 - weight;\r\n\r\n        if (rest <= 0) {\r\n          d.setCustomValidity('weight cannot be 100 in case of two elements');\r\n        } else {\r\n          d.setCustomValidity('');\r\n        }\r\n\r\n        const other = inputs[1 - i]!;\r\n        other.value = round(rest, 2).toString();\r\n        this.updateBar(other);\r\n      };\r\n    });\r\n  }\r\n\r\n  private updateBar(input: HTMLInputElement) {\r\n    (<HTMLElement>input.nextElementSibling!.firstElementChild!).style.width = `${input.value}%`;\r\n  }\r\n\r\n  private distributeWeights() {\r\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]')).map((d) => ({input: d, weight: d.value ? d.valueAsNumber : NaN}));\r\n    const hasMissing = inputs.some((d) => isNaN(d.weight));\r\n    if (hasMissing) {\r\n      // compute missing ones\r\n      const missingIndices = inputs.filter((d) => isNaN(d.weight));\r\n      const correct = inputs.filter((d) => !isNaN(d.weight));\r\n      const sum = correct.reduce((a, b) => a + b.weight, 0);\r\n\r\n      if (sum < 100) {\r\n        // compute rest\r\n        const rest = (100 - sum) / missingIndices.length;\r\n        for (const input of missingIndices) {\r\n          input.input.value = round(rest, 2).toString();\r\n          this.updateBar(input.input);\r\n        }\r\n        return;\r\n      }\r\n      // already above 100, set missing to 0 and do a regular normalization (user has to deal with it)\r\n      for (const input of missingIndices) {\r\n        input.input.value = '0';\r\n        this.updateBar(input.input);\r\n      }\r\n    }\r\n\r\n    const weights = inputs.map((d) => d.weight);\r\n    if (validWeights(weights)) {\r\n      return; // nothing to do\r\n    }\r\n\r\n    // pure distribute the sum\r\n    const sum = weights.reduce((a, b) => a + b, 0);\r\n    for (const input of inputs) {\r\n      input.input.value = round(input.weight * 100 / sum, 2).toString();\r\n      this.updateBar(input.input);\r\n    }\r\n  }\r\n\r\n  protected appendDialogButtons() {\r\n    super.appendDialogButtons();\r\n    const buttons = this.node.querySelector<HTMLElement>(`.${cssClass('dialog-buttons')}`)!;\r\n    buttons.insertAdjacentHTML('beforeend', `<button class=\"${cssClass('dialog-button')} ${cssClass('dialog-weights-distribute-button')}\" type=\"button\" title=\"distribute weights\"></button>`);\r\n\r\n    const last = <HTMLElement>buttons.lastElementChild!;\r\n    last.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      this.distributeWeights();\r\n    };\r\n  }\r\n\r\n  submit() {\r\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]')).map((d) => ({input: d, weight: d.valueAsNumber}));\r\n    let invalid = false;\r\n    for (const input of inputs) {\r\n      if (input.weight <= 0) {\r\n        input.input.setCustomValidity('weight cannot be zero');\r\n        invalid = true;\r\n      } else {\r\n        input.input.setCustomValidity('');\r\n      }\r\n    }\r\n    const weights = inputs.map((d) => d.weight);\r\n    if (!invalid && !validWeights(weights)) {\r\n      inputs[inputs.length - 1].input.setCustomValidity('sum of weights has to be 100, change weights or use the redistribute button to fix');\r\n      invalid = true;\r\n    }\r\n    if (invalid) {\r\n      if (typeof (<any>this.node).reportValidity === 'function') {\r\n        (<any>this.node).reportValidity();\r\n      }\r\n      return false;\r\n    }\r\n\r\n    this.column.setWeights(weights.map((d) => d / 100));\r\n    return true;\r\n  }\r\n}\r\n\r\nfunction validWeights(weights: number[]) {\r\n  return Math.abs(weights.reduce((a, b) => a + b, 0) - 100) < 3;\r\n}\r\n","import {getAllToolbarActions, getAllToolbarDialogAddons} from '../model/internal';\r\nimport {Column, EDateSort, EAdvancedSortMethod, ESortMethod, isSupportType, CompositeColumn, IMultiLevelColumn, isSortingAscByDefault} from '../model';\r\nimport {cssClass} from '../styles';\r\nimport ADialog, {IDialogContext, dialogContext} from './dialogs/ADialog';\r\nimport BooleanFilterDialog from './dialogs/BooleanFilterDialog';\r\nimport CategoricalColorMappingDialog from './dialogs/CategoricalColorMappingDialog';\r\nimport CategoricalFilterDialog from './dialogs/CategoricalFilterDialog';\r\nimport CategoricalMappingFilterDialog from './dialogs/CategoricalMappingFilterDialog';\r\nimport ChangeRendererDialog from './dialogs/ChangeRendererDialog';\r\nimport ColorMappingDialog from './dialogs/ColorMappingDialog';\r\nimport CompositeChildrenDialog from './dialogs/CompositeChildrenDialog';\r\nimport CutOffHierarchyDialog from './dialogs/CutOffHierarchyDialog';\r\nimport DateFilterDialog from './dialogs/DateFilterDialog';\r\nimport EditPatternDialog from './dialogs/EditPatternDialog';\r\nimport appendDate from './dialogs/groupDate';\r\nimport GroupDialog from './dialogs/GroupDialog';\r\nimport appendNumber from './dialogs/groupNumber';\r\nimport appendString from './dialogs/groupString';\r\nimport MappingDialog from './dialogs/MappingDialog';\r\nimport NumberFilterDialog from './dialogs/NumberFilterDialog';\r\nimport ReduceDialog from './dialogs/ReduceDialog';\r\nimport RenameDialog from './dialogs/RenameDialog';\r\nimport ScriptEditDialog from './dialogs/ScriptEditDialog';\r\nimport SearchDialog from './dialogs/SearchDialog';\r\nimport ShowTopNDialog from './dialogs/ShowTopNDialog';\r\nimport SortDialog from './dialogs/SortDialog';\r\nimport StringFilterDialog from './dialogs/StringFilterDialog';\r\nimport {sortMethods} from './dialogs/utils';\r\nimport WeightsEditDialog from './dialogs/WeightsEditDialog';\r\nimport {IRankingHeaderContext, IOnClickHandler, IUIOptions, IToolbarAction, IToolbarDialogAddon} from './interfaces';\r\n\r\ninterface IDialogClass {\r\n  new(col: any, dialog: IDialogContext, ...args: any[]): ADialog;\r\n}\r\n\r\nfunction ui(title: string, onClick: IOnClickHandler, options: Partial<IUIOptions> = {}): IToolbarAction {\r\n  return {title, onClick, options};\r\n}\r\n\r\nfunction uiDialog(title: string, dialogClass: IDialogClass, extraArgs: ((ctx: IRankingHeaderContext) => any[]) = () => [], options: Partial<IUIOptions> = {}): IToolbarAction {\r\n  return {\r\n    title,\r\n    onClick: (col, evt, ctx, level) => {\r\n      const dialog = new dialogClass(col, dialogContext(ctx, level, evt), ...extraArgs(ctx));\r\n      dialog.open();\r\n    }, options\r\n  };\r\n}\r\n\r\nfunction uiSortMethod(methods: string[]): IToolbarDialogAddon {\r\n  methods = methods.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));\r\n  return {\r\n    title: 'Sort By',\r\n    order: 2,\r\n    append(col, node) {\r\n      return sortMethods(node, <any>col, methods);\r\n    }\r\n  };\r\n}\r\n\r\nconst sort: IToolbarAction = {\r\n  title: 'Sort', // basic ranking\r\n  onClick: (col, evt, ctx, level) => {\r\n    ctx.dialogManager.removeAboveLevel(level);\r\n    if (!evt.ctrlKey) {\r\n      col.toggleMySorting();\r\n      return;\r\n    }\r\n    const ranking = col.findMyRanker()!;\r\n    const current = ranking.getSortCriteria();\r\n    const order = col.isSortedByMe();\r\n\r\n    const isAscByDefault = isSortingAscByDefault(col);\r\n\r\n    if (order.priority === undefined) {\r\n      ranking.sortBy(col, isAscByDefault, current.length);\r\n      return;\r\n    }\r\n    let next: string | undefined = undefined;\r\n    if (isAscByDefault) {\r\n      next = order.asc ? 'desc' : undefined;\r\n    } else {\r\n      next = !order.asc ? 'asc' : undefined;\r\n    }\r\n    ranking.sortBy(col, next === 'asc', next ? order.priority : -1);\r\n  },\r\n  options: {\r\n    mode: 'shortcut',\r\n    order: 1,\r\n    featureCategory: 'ranking',\r\n    featureLevel: 'basic'\r\n  }\r\n};\r\n\r\nconst sortBy: IToolbarAction = {\r\n  title: 'Sort By &hellip;', // advanced ranking\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new SortDialog(col, false, dialogContext(ctx, level, evt), ctx);\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    mode: 'menu',\r\n    order: 1,\r\n    featureCategory: 'ranking',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst sortGroupBy: IToolbarAction = {\r\n  title: 'Sort Groups By &hellip;', // advanced ranking\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new SortDialog(col, true, dialogContext(ctx, level, evt), ctx);\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    mode: 'menu',\r\n    order: 3,\r\n    featureCategory: 'ranking',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst rename: IToolbarAction = {\r\n  title: 'Rename &hellip;', // advanced\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new RenameDialog(col, dialogContext(ctx, level, evt));\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    order: 5,\r\n    featureCategory: 'ui',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst vis: IToolbarAction = {\r\n  title: 'Visualization &hellip;', // advanced view\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new ChangeRendererDialog(col, dialogContext(ctx, level, evt), ctx);\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    featureCategory: 'ui',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst clone: IToolbarAction = {\r\n  title: 'Clone', // advanced model\r\n  onClick: (col, _evt, ctx) => {\r\n    ctx.dialogManager.removeAll(); // since the column will be removed\r\n    ctx.provider.takeSnapshot(col);\r\n  },\r\n  options: {\r\n    order: 80,\r\n    featureCategory: 'model',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst remove: IToolbarAction = {\r\n  title: 'Remove', // advanced model\r\n  onClick: (col, _evt, ctx) => {\r\n    ctx.dialogManager.removeAll(); // since the column will be removed\r\n    const ranking = col.findMyRanker()!;\r\n    const last = ranking.children.every((d) => isSupportType(d) || d.fixed || d === col);\r\n    if (!last) {\r\n      col.removeMe();\r\n      return;\r\n    }\r\n    ctx.provider.removeRanking(ranking);\r\n    ctx.provider.ensureOneRanking();\r\n  },\r\n  options: {\r\n    order: 90,\r\n    featureCategory: 'model',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\n// basic ranking\r\nconst group = ui('Group', (col, evt, ctx, level) => {\r\n  ctx.dialogManager.removeAboveLevel(level);\r\n\r\n  if (!evt.ctrlKey) {\r\n    col.groupByMe();\r\n    return;\r\n  }\r\n  const ranking = col.findMyRanker()!;\r\n  const current = ranking.getGroupCriteria();\r\n  const order = current.indexOf(col);\r\n\r\n  ranking.groupBy(col, order >= 0 ? -1 : current.length);\r\n}, {mode: 'shortcut', order: 2, featureCategory: 'ranking', featureLevel: 'basic'});\r\n\r\n// advanced ranking\r\nconst groupBy = ui('Group By &hellip;', (col, evt, ctx, level) => {\r\n  const dialog = new GroupDialog(col, dialogContext(ctx, level, evt), ctx);\r\n  dialog.open();\r\n}, {mode: 'menu', order: 2, featureCategory: 'ranking', featureLevel: 'advanced'});\r\n\r\nfunction toggleCompressExpand(col: Column, evt: MouseEvent, ctx: IRankingHeaderContext, level: number) {\r\n  ctx.dialogManager.removeAboveLevel(level);\r\n  const mcol = <IMultiLevelColumn>col;\r\n  mcol.setCollapsed(!mcol.getCollapsed());\r\n\r\n  const collapsed = mcol.getCollapsed();\r\n  const i = <HTMLElement>evt.currentTarget;\r\n  i.title = collapsed ? 'Expand' : 'Compress';\r\n  i.classList.toggle(cssClass('action-compress'), !collapsed);\r\n  i.classList.toggle(cssClass('action-expand'), collapsed);\r\n  const inner = i.getElementsByTagName('span')[0]!;\r\n  if (inner) {\r\n    inner.textContent = i.title;\r\n  }\r\n}\r\n\r\nconst compress: IToolbarAction = {\r\n  title: 'Compress',\r\n  enabled: (col: IMultiLevelColumn) => !col.getCollapsed(),\r\n  onClick: toggleCompressExpand,\r\n  options: {featureCategory: 'model', featureLevel: 'advanced'}\r\n};\r\n\r\nconst expand: IToolbarAction = {\r\n  title: 'Expand',\r\n  enabled: (col: IMultiLevelColumn) => col.getCollapsed(),\r\n  onClick: toggleCompressExpand,\r\n  options: {featureCategory: 'model', featureLevel: 'advanced'}\r\n};\r\n\r\nconst setShowTopN: IToolbarAction = {\r\n  title: 'Change Show Top N',\r\n  onClick: (_col, evt, ctx, level) => {\r\n    const dialog = new ShowTopNDialog(ctx.provider, dialogContext(ctx, level, evt));\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    featureCategory: 'ui',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nexport const toolbarDialogAddons: {[key: string]: IToolbarDialogAddon} = {\r\n  sortNumber: uiSortMethod(Object.keys(EAdvancedSortMethod)),\r\n  sortNumbers: uiSortMethod(Object.keys(EAdvancedSortMethod)),\r\n  sortBoxPlot: uiSortMethod(Object.keys(ESortMethod)),\r\n  sortDates: uiSortMethod(Object.keys(EDateSort)),\r\n  sortGroups: uiSortMethod(['count', 'name']),\r\n  groupNumber: <IToolbarDialogAddon>{\r\n    title: 'Split',\r\n    order: 2,\r\n    append: appendNumber\r\n  },\r\n  groupString: <IToolbarDialogAddon>{\r\n    title: 'Groups',\r\n    order: 2,\r\n    append: appendString\r\n  },\r\n  groupDate: <IToolbarDialogAddon>{\r\n    title: 'Granularity',\r\n    order: 2,\r\n    append: appendDate\r\n  },\r\n};\r\n\r\nexport const toolbarActions: {[key: string]: IToolbarAction} = {\r\n  vis,\r\n  group,\r\n  groupBy,\r\n  compress,\r\n  expand,\r\n  sort,\r\n  sortBy,\r\n  sortGroupBy,\r\n  clone,\r\n  remove,\r\n  rename,\r\n  setShowTopN,\r\n  search: uiDialog('Search &hellip;', SearchDialog, (ctx) => [ctx.provider], {mode: 'menu+shortcut', order: 4, featureCategory: 'ranking', featureLevel: 'basic'}),\r\n  filterNumber: uiDialog('Filter &hellip;', NumberFilterDialog, (ctx) => [ctx], {mode: 'menu+shortcut', featureCategory: 'ranking', featureLevel: 'basic'}),\r\n  filterDate: uiDialog('Filter &hellip;', DateFilterDialog, (ctx) => [ctx], {mode: 'menu+shortcut', featureCategory: 'ranking', featureLevel: 'basic'}),\r\n  filterString: uiDialog('Filter &hellip;', StringFilterDialog, () => [], {mode: 'menu+shortcut', featureCategory: 'ranking', featureLevel: 'basic'}),\r\n  filterCategorical: uiDialog('Filter &hellip;', CategoricalFilterDialog, () => [], {mode: 'menu+shortcut', featureCategory: 'ranking', featureLevel: 'basic'}),\r\n  filterOrdinal: uiDialog('Filter &hellip;', CategoricalMappingFilterDialog, () => [], {mode: 'menu+shortcut', featureCategory: 'ranking', featureLevel: 'basic'}),\r\n  filterBoolean: uiDialog('Filter &hellip;', BooleanFilterDialog, () => [], {mode: 'menu+shortcut', featureCategory: 'ranking', featureLevel: 'basic'}),\r\n  colorMapped: uiDialog('Color Mapping &hellip;', ColorMappingDialog, (ctx) => [ctx], {mode: 'menu', featureCategory: 'ui', featureLevel: 'advanced'}),\r\n  colorMappedCategorical: uiDialog('Color Mapping &hellip;', CategoricalColorMappingDialog, () => [], {mode: 'menu', featureCategory: 'ui', featureLevel: 'advanced'}),\r\n  script: uiDialog('Edit Combine Script &hellip;', ScriptEditDialog, () => [], {mode: 'menu+shortcut', featureCategory: 'model', featureLevel: 'advanced'}),\r\n  reduce: uiDialog('Reduce by &hellip;', ReduceDialog, () => [], {featureCategory: 'model', featureLevel: 'advanced'}),\r\n  cutoff: uiDialog('Set Cut Off &hellip;', CutOffHierarchyDialog, (ctx) => [ctx.idPrefix], {featureCategory: 'model', featureLevel: 'advanced'}),\r\n  editMapping: uiDialog('Data Mapping &hellip;', MappingDialog, (ctx) => [ctx], {featureCategory: 'model', featureLevel: 'advanced'}),\r\n  editPattern: uiDialog('Edit Pattern &hellip;', EditPatternDialog, (ctx) => [ctx.idPrefix], {featureCategory: 'model', featureLevel: 'advanced'}),\r\n  editWeights: uiDialog('Edit Weights &hellip;', WeightsEditDialog, () => [], {mode: 'menu+shortcut', featureCategory: 'model', featureLevel: 'advanced'}),\r\n  compositeContained: uiDialog('Contained Columns &hellip;', CompositeChildrenDialog, (ctx) => [ctx], {featureCategory: 'model', featureLevel: 'advanced'}),\r\n  splitCombined: ui('Split Combined Column', (col, _evt, ctx, level) => {\r\n    ctx.dialogManager.removeAboveLevel(level - 1); // close itself\r\n    // split the combined column into its children\r\n    (<CompositeColumn>col).children.reverse().forEach((c) => col.insertAfterMe(c));\r\n    col.removeMe();\r\n  }, {featureCategory: 'model', featureLevel: 'advanced'}),\r\n  invertSelection: ui('Invert Selection', (col, _evt, ctx, level) => {\r\n    ctx.dialogManager.removeAboveLevel(level - 1); // close itself\r\n    const s = ctx.provider.getSelection();\r\n    const order = Array.from(col.findMyRanker()!.getOrder());\r\n    if (s.length === 0) {\r\n      ctx.provider.setSelection(order);\r\n      return;\r\n    }\r\n    const ss = new Set(s);\r\n    const others = order.filter((d) => !ss.has(d));\r\n    ctx.provider.setSelection(others);\r\n  }, {featureCategory: 'model', featureLevel: 'advanced'})\r\n};\r\n\r\nfunction sortActions(a: IToolbarAction, b: IToolbarAction) {\r\n  if (a.options.order === b.options.order) {\r\n    return a.title.toString().localeCompare(b.title.toString());\r\n  }\r\n  return (a.options.order || 50) - (b.options.order || 50);\r\n}\r\n\r\nfunction getFullToolbar(col: Column, ctx: IRankingHeaderContext) {\r\n  const cache = ctx.caches.toolbar;\r\n  if (cache.has(col.desc.type)) {\r\n    return cache.get(col.desc.type)!;\r\n  }\r\n\r\n  const keys = getAllToolbarActions(col);\r\n\r\n  if (!col.fixed) {\r\n    keys.push('remove');\r\n  }\r\n  {\r\n    const possible = ctx.getPossibleRenderer(col);\r\n    if (possible.item.length > 2 || possible.group.length > 2 || possible.summary.length > 2) { // default always possible\r\n      keys.push('vis');\r\n    }\r\n  }\r\n\r\n  const actions = ctx.resolveToolbarActions(col, keys);\r\n\r\n  const r = Array.from(new Set(actions)).sort(sortActions);\r\n  cache.set(col.desc.type, r);\r\n  return r;\r\n}\r\n\r\n/** @internal */\r\nexport function getToolbar(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  const flags = ctx.flags;\r\n\r\n  return toolbar.filter((a) => {\r\n    if (a.enabled && !a.enabled(col)) {\r\n      return false;\r\n    }\r\n    // level is basic or not one of disabled features\r\n    return a.options.featureLevel === 'basic' || !((flags.advancedModelFeatures === false && a.options.featureCategory === 'model') || (flags.advancedRankingFeatures === false && a.options.featureCategory === 'ranking') || (flags.advancedUIFeatures === false && a.options.featureCategory === 'ui'));\r\n  });\r\n}\r\n\r\n/** @internal */\r\nexport function getToolbarDialogAddons(col: Column, key: string, ctx: IRankingHeaderContext) {\r\n  const cacheKey = `${col.desc.type}@${key}`;\r\n  const cacheAddon = ctx.caches.toolbarAddons;\r\n  if (cacheAddon.has(cacheKey)) {\r\n    return cacheAddon.get(cacheKey)!;\r\n  }\r\n\r\n  const keys = getAllToolbarDialogAddons(col, key);\r\n  const actions = ctx.resolveToolbarDialogAddons(col, keys);\r\n\r\n  const r = Array.from(new Set(actions)).sort((a, b) => {\r\n    if (a.order === b.order) {\r\n      return a.title.localeCompare(b.title);\r\n    }\r\n    return (a.order || 50) - (b.order || 50);\r\n  });\r\n  cacheAddon.set(cacheKey, r);\r\n  return r;\r\n}\r\n\r\n/** @internal */\r\nexport function isSortAble(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  return toolbar.find((d) => d === sort || d === sortBy || d.title === sort.title || d.title.startsWith('Sort By')) != null;\r\n}\r\n\r\n/** @internal */\r\nexport function isGroupAble(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  return toolbar.find((d) => d === group || d === groupBy || d.title === group.title || d.title.startsWith('Group By')) != null;\r\n}\r\n\r\n/** @internal */\r\nexport function isGroupSortAble(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  return toolbar.find((d) => d === sortGroupBy || d.title === sortGroupBy.title || d.title.startsWith('Sort Groups By')) != null;\r\n}\r\n","import {NumberColumn} from '../../model';\r\nimport {IDialogContext} from './ADialog';\r\nimport {round, getNumberOfBins} from '../../internal';\r\nimport {forEach} from '../../renderer/utils';\r\nimport {cssClass} from '../../styles';\r\nimport {IToolbarDialogAddonHandler} from '../interfaces';\r\n\r\n\r\n/** @internal */\r\nexport default function groupNumber(col: NumberColumn, node: HTMLElement, dialog: IDialogContext): IToolbarDialogAddonHandler {\r\n  const domain = col.getMapping().domain;\r\n  const before = col.getGroupThresholds();\r\n  const isThreshold = before.length <= 1;\r\n  const ranking =  col.findMyRanker()!;\r\n  node.insertAdjacentHTML('beforeend', `\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input type=\"radio\" name=\"threshold\" value=\"threshold\" ${isThreshold ? 'checked' : ''}>\r\n      <span>at&nbsp;<input type=\"number\" size=\"10\" id=\"${dialog.idPrefix}N1\" value=\"${before.length > 0 ? before[0] : round((domain[1] - domain[0]) / 2, 2)}\"\r\n          required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\" ${!isThreshold ? 'disabled': ''}>\r\n      </span>\r\n    </label>\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input type=\"radio\" name=\"threshold\" value=\"bins\" ${!isThreshold ? 'checked' : ''}>\r\n      <span> in&nbsp;<input type=\"number\" size=\"5\" id=\"${dialog.idPrefix}N2\" value=\"${before.length > 1 ? before.length : getNumberOfBins(ranking.getOrderLength())}\"\r\n          required min=\"2\" step=\"1\" ${isThreshold ? 'disabled': ''}>&nbsp;bins\r\n      </span>\r\n    </label>\r\n  `);\r\n\r\n  const threshold = <HTMLInputElement>node.querySelector(`#${dialog.idPrefix}N1`);\r\n  const bins = <HTMLInputElement>node.querySelector(`#${dialog.idPrefix}N2`);\r\n\r\n  forEach(node, 'input[name=threshold]', (d: HTMLInputElement) => {\r\n    d.addEventListener('change', () => {\r\n      const isThreshold = d.value === 'threshold';\r\n      threshold.disabled = !isThreshold;\r\n      bins.disabled = isThreshold;\r\n    }, { passive: true });\r\n  });\r\n\r\n  return {\r\n    elems: `input[name=threshold], #${dialog.idPrefix}N1, #${dialog.idPrefix}N2`,\r\n    submit() {\r\n      const isThreshold = node.querySelector<HTMLInputElement>('input[name=threshold]:checked')!.value === 'threshold';\r\n      if (isThreshold) {\r\n        col.setGroupThresholds([threshold.valueAsNumber]);\r\n        return true;\r\n      }\r\n      const count = parseInt(bins.value, 10);\r\n      const delta = (domain[1] - domain[0]) / count;\r\n      let act = domain[0] + delta;\r\n      const thresholds = [act];\r\n      for (let i = 1; i < count - 1; ++i) {\r\n        act += delta;\r\n        thresholds.push(act);\r\n      }\r\n      col.setGroupThresholds(thresholds);\r\n      return true;\r\n    },\r\n    cancel() {\r\n      col.setGroupThresholds(before);\r\n    },\r\n    reset() {\r\n      const value = round((domain[1] - domain[0]) / 2, 2);\r\n      threshold.value = value.toString();\r\n      threshold.disabled = false;\r\n      bins.value = getNumberOfBins(ranking.getOrderLength()).toString();\r\n      bins.disabled = true;\r\n      node.querySelector<HTMLInputElement>('input[name=threshold][value=threshold]')!.checked = true;\r\n    }\r\n  };\r\n}\r\n","import {IDialogContext} from './ADialog';\r\nimport {StringColumn, EStringGroupCriteriaType} from '../../model';\r\nimport {cssClass} from '../../styles';\r\nimport {IToolbarDialogAddonHandler} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default function groupString(col: StringColumn, node: HTMLElement, dialog: IDialogContext): IToolbarDialogAddonHandler {\r\n  const current = col.getGroupCriteria();\r\n  const {type, values} = current;\r\n\r\n  node.insertAdjacentHTML('beforeend', `\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.value}\" id=\"${dialog.idPrefix}VAL\" ${type === EStringGroupCriteriaType.value ? 'checked' : ''}>\r\n      <span>Use text value</span>\r\n    </label>\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.startsWith}\" id=\"${dialog.idPrefix}RW\" ${type === EStringGroupCriteriaType.startsWith ? 'checked' : ''}>\r\n      <span>Text starts with &hellip;</span>\r\n    </label>\r\n    <label class=\"${cssClass('checkbox')}\">\r\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.regex}\" id=\"${dialog.idPrefix}RE\" ${type === EStringGroupCriteriaType.regex ? 'checked' : ''}>\r\n      <span>Use regular expressions</span>\r\n    </label>\r\n    <textarea required rows=\"5\" placeholder=\"e.g. Test,a.*\" id=\"${dialog.idPrefix}T\">${values.map((value) => value instanceof RegExp ? value.source : value).join('\\n')}</textarea>\r\n  `);\r\n\r\n  const valueRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}VAL`)!;\r\n  const startsWithRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RW`)!;\r\n  const regexRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RE`)!;\r\n  const text = node.querySelector<HTMLTextAreaElement>(`#${dialog.idPrefix}T`)!;\r\n\r\n  const showOrHideTextarea = (show: boolean) => {\r\n    text.style.display = show ? null : 'none';\r\n  };\r\n\r\n  showOrHideTextarea(type !== EStringGroupCriteriaType.value);\r\n  valueRadioButton.onchange = () => showOrHideTextarea(!valueRadioButton.checked);\r\n  startsWithRadioButton.onchange = () => showOrHideTextarea(startsWithRadioButton.checked);\r\n  regexRadioButton.onchange = () => showOrHideTextarea(regexRadioButton.checked);\r\n\r\n  text.addEventListener('change', () => {\r\n    const items: (string | RegExp)[] = text.value.trim().split('\\n').map((d) => d.trim()).filter((d) => d.length > 0);\r\n    text.setCustomValidity(!valueRadioButton.checked && items.length === 0 ? 'At least one entry is required' : '');\r\n  });\r\n\r\n  return {\r\n    elems: [text, valueRadioButton, startsWithRadioButton, regexRadioButton],\r\n    submit() {\r\n      const checkedNode = node.querySelector<HTMLInputElement>(`input[name=\"${dialog.idPrefix}groupString\"]:checked`)!;\r\n      const newType = <EStringGroupCriteriaType>checkedNode.value;\r\n      let items: (string | RegExp)[] = text.value.trim().split('\\n').map((d) => d.trim()).filter((d) => d.length > 0);\r\n\r\n      if (newType !== EStringGroupCriteriaType.value) {\r\n        const invalid = items.length === 0;\r\n        text.setCustomValidity(invalid ? 'At least one entry is required' : '');\r\n        if (invalid) {\r\n          (<any>text).reportValidity(); // typedoc not uptodate\r\n          return false;\r\n        }\r\n      }\r\n      if (newType === EStringGroupCriteriaType.regex) {\r\n        items = items.map((d) => new RegExp(d.toString(), 'gm'));\r\n      }\r\n      col.setGroupCriteria({\r\n        type: newType,\r\n        values: items\r\n      });\r\n      return true;\r\n    },\r\n    cancel() {\r\n      col.setGroupCriteria(current);\r\n    },\r\n    reset() {\r\n      text.value = '';\r\n      startsWithRadioButton.checked = true;\r\n    }\r\n  };\r\n}\r\n","import {DateColumn, IDateGranularity} from '../../model';\r\nimport {cssClass} from '../../styles';\r\nimport {IToolbarDialogAddonHandler} from '../interfaces';\r\nimport {defaultDateGrouper} from '../../model/internalDate';\r\n\r\n\r\n/** @internal */\r\nexport default function appendDate(col: DateColumn, node: HTMLElement): IToolbarDialogAddonHandler {\r\n  const before = col.getDateGrouper();\r\n\r\n  let html = '';\r\n  for (const g of ['century', 'decade', 'year', 'month', 'week', 'day_of_week', 'day_of_month', 'day_of_year', 'hour', 'minute', 'second']) {\r\n    html += `<label class=\"${cssClass('checkbox')}\">\r\n    <input type=\"radio\" name=\"granularity\" value=\"${g}\" ${before.granularity === g ? 'checked' : ''}>\r\n    <span> by ${g} </span>\r\n  </label>`;\r\n  }\r\n  html += `<label class=\"${cssClass('checkbox')}\">\r\n    <input type=\"checkbox\" name=\"circular\" ${before.circular ? 'checked' : ''}>\r\n    <span> Circular </span>\r\n  </label>`;\r\n\r\n  node.insertAdjacentHTML('beforeend', html);\r\n  const circular = node.querySelector<HTMLInputElement>('input[name=circular]')!;\r\n\r\n  return {\r\n    elems: 'input[name=granularity],input[name=circular]',\r\n    submit() {\r\n      const granularity = <IDateGranularity> node.querySelector<HTMLInputElement>('input[name=granularity]:checked')!.value;\r\n      col.setDateGrouper({\r\n        granularity,\r\n        circular: circular.checked\r\n      });\r\n      return true;\r\n    },\r\n    cancel() {\r\n      col.setDateGrouper(before);\r\n    },\r\n    reset() {\r\n      const r = defaultDateGrouper();\r\n      circular.checked = r.circular;\r\n      const g = node.querySelector<HTMLInputElement>(`input[name=granularity][value=\"${r.granularity}\"]`)!;\r\n      g.checked = true;\r\n    }\r\n  };\r\n}\r\n","import {renderers} from './renderer/renderers';\r\nimport {toolbarActions, toolbarDialogAddons} from './ui/toolbar';\r\nimport {Column, Ranking, IGroupData, IGroupItem} from './model';\r\nimport {IDataProvider} from './provider';\r\nimport {ICellRendererFactory, ERenderMode} from './renderer';\r\nimport {IToolbarAction, IToolbarDialogAddon} from './ui';\r\n\r\n/**\r\n * custom height implementation logic\r\n */\r\nexport interface IDynamicHeight {\r\n  /**\r\n   * default height for a row for optimized styling\r\n   */\r\n  defaultHeight: number;\r\n\r\n  /**\r\n   * returns the height in pixel for the given row\r\n   * @param {IGroupItem | IGroupData} item the item to show\r\n   * @returns {number} its height in pixel\r\n   */\r\n  height(item: IGroupItem | IGroupData): number;\r\n\r\n  /**\r\n   * returns the padding in pixel after the given row\r\n   * @param {IGroupItem | IGroupData | null} item item to show\r\n   * @returns {number} its padding in pixel\r\n   */\r\n  padding(item: IGroupItem | IGroupData | null): number;\r\n}\r\n\r\nexport interface ILineUpFlags {\r\n  /**\r\n   * optimization flag to disable frozen columns for optimizing rendering performance\r\n   * @default true\r\n   */\r\n  disableFrozenColumns: boolean;\r\n  /**\r\n   * flag whether advanced ranking features are enabled\r\n   * @default true\r\n   */\r\n  advancedRankingFeatures: boolean;\r\n  /**\r\n   * flag whether advanced model features are enabled\r\n   * @default true\r\n   */\r\n  advancedModelFeatures: boolean;\r\n  /**\r\n   * flag whether advanced UI features are enabled\r\n   * @default true\r\n   */\r\n  advancedUIFeatures: boolean;\r\n}\r\n\r\nexport interface IToolbarLookup<T> {\r\n  [key: string]: T;\r\n}\r\n\r\nexport interface ILivePreviewOptions {\r\n  search: boolean;\r\n  filter: boolean;\r\n  vis: boolean;\r\n  sort: boolean;\r\n  group: boolean;\r\n  groupSort: boolean;\r\n  colorMapping: boolean;\r\n  dataMapping: boolean;\r\n  reduce: boolean;\r\n  rename: boolean;\r\n  cutOff: boolean;\r\n}\r\n\r\nexport interface ILineUpOptions {\r\n  /**\r\n   * option to enable/disable showing a summary (histogram, ...) in the header\r\n   * @default true\r\n   */\r\n  summaryHeader: boolean;\r\n  /**\r\n   * option to enable/disable animated transitions\r\n   * @default true\r\n   */\r\n  animated: boolean;\r\n  /**\r\n   * option to enforce that the whole row is shown upon hover without overflow hidden\r\n   * @default false\r\n   */\r\n  expandLineOnHover: boolean;\r\n  /**\r\n   * option to enable/disable the panel\r\n   * @default true\r\n   */\r\n  sidePanel: boolean;\r\n  /**\r\n   * option to specify whether the panel should be collapsed by default\r\n   * @default false\r\n   */\r\n  sidePanelCollapsed: boolean;\r\n  /**\r\n   * show the sorting and grouping hierarchy indicators in the side panel\r\n   * @default true\r\n   */\r\n  hierarchyIndicator: boolean;\r\n\r\n  /**\r\n   * flag whether dialogs should confirm or cancel on clicking the background\r\n   * @default cancel\r\n   */\r\n  onDialogBackgroundClick: 'cancel' | 'confirm';\r\n\r\n  /**\r\n   * flag whether to shows filter previews as soon as the user changes the filter in the dialog\r\n   * @default {search: true,filter: true, vis: true,sort: true, group: true, groupSort: true, colorMapping: true}\r\n   */\r\n  livePreviews: Partial<ILivePreviewOptions>;\r\n\r\n  /**\r\n   * option to specify the default slope graph mode\r\n   * @default 'item'\r\n   */\r\n  defaultSlopeGraphMode: 'item' | 'band';\r\n\r\n  /**\r\n   * how many degrees should a label be rotated in case of narrow columns\r\n   * @default 0 no rotation\r\n   */\r\n  labelRotation: number;\r\n\r\n  /**\r\n   * height of a row\r\n   * @default 18\r\n   */\r\n  rowHeight: number;\r\n  /**\r\n   * padding between two rows\r\n   * @default 2\r\n   */\r\n  rowPadding: number;\r\n  /**\r\n   * height of an aggregated group in pixel\r\n   * @default 40\r\n   */\r\n  groupHeight: number;\r\n  /**\r\n   * padding between two groups in pixel\r\n   * @default 5\r\n   */\r\n  groupPadding: number;\r\n\r\n  /**\r\n   * custom function to compute the level of detail for a row\r\n   * @param {number} rowIndex the current row index to be rendered\r\n   * @returns {\"high\" | \"low\"}\r\n   */\r\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\r\n  /**\r\n   * custom function to compute the height of a row (group or item)\r\n   * @param {(IGroupItem | IGroupData)[]} data the data to render\r\n   * @param {Ranking} ranking the ranking of the data\r\n   * @returns {IDynamicHeight | null} the height compute function or null to use the default\r\n   */\r\n  dynamicHeight: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => IDynamicHeight | null;\r\n  /**\r\n   * custom function to be called when updating a HTML row\r\n   * @param {HTMLElement} row node element to be updated\r\n   * @param {number} rowIndex row index to be rendered in the row\r\n   */\r\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\r\n\r\n  /**\r\n   * register custom toolbar actions and dialog addons\r\n   */\r\n  toolbarActions: IToolbarLookup<IToolbarAction>;\r\n  toolbarDialogAddons: IToolbarLookup<IToolbarDialogAddon>;\r\n\r\n  /**\r\n   * hook for postprocess the toolbar actions for a column\r\n   */\r\n  resolveToolbarActions: (col: Column, keys: string[], lookup: IToolbarLookup<IToolbarAction>) => IToolbarAction[];\r\n  /**\r\n   * hook for postprocess the toolbar dialog addons for a column\r\n   */\r\n  resolveToolbarDialogAddons: (col: Column, keys: string[], lookup: IToolbarLookup<IToolbarDialogAddon>) => IToolbarDialogAddon[];\r\n\r\n  /**\r\n   * register custom renderer factories\r\n   */\r\n  renderers: {[type: string]: ICellRendererFactory};\r\n\r\n  /**\r\n   * custom check whether a given renderer can render the given column in the given mode\r\n   */\r\n  canRender: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean;\r\n\r\n  /**\r\n   * custom flags for optimization\r\n   */\r\n  flags: Partial<ILineUpFlags>;\r\n\r\n  /**\r\n   * ignore incompatible browser and always show (on own risk)\r\n   * @default false\r\n   */\r\n  ignoreUnsupportedBrowser: boolean;\r\n}\r\n\r\nexport interface ITaggleOptions extends ILineUpOptions {\r\n  /**\r\n   * whether the overview mode is enabled by default\r\n   * @default false\r\n   */\r\n  overviewMode: boolean;\r\n}\r\n\r\nexport interface ILineUpLike {\r\n  readonly node: HTMLElement;\r\n  readonly data: IDataProvider;\r\n\r\n  dump(): any;\r\n\r\n  destroy(): void;\r\n}\r\n\r\nfunction resolveToolbarActions(col: Column, keys: string[], lookup: IToolbarLookup<IToolbarAction>) {\r\n  const actions: IToolbarAction[] = [];\r\n\r\n  keys.forEach((key) => {\r\n    if (lookup.hasOwnProperty(key)) {\r\n      actions.push(lookup[key]);\r\n    } else {\r\n      console.warn(`cannot find toolbar action of type: \"${col.desc.type}\" with key \"${key}\"`);\r\n    }\r\n  });\r\n  return actions;\r\n}\r\n\r\nfunction resolveToolbarDialogAddons(col: Column, keys: string[], lookup: IToolbarLookup<IToolbarDialogAddon>) {\r\n  const actions: IToolbarDialogAddon[] = [];\r\n\r\n  keys.forEach((key) => {\r\n    if (lookup.hasOwnProperty(key)) {\r\n      actions.push(lookup[key]);\r\n    } else {\r\n      console.warn(`cannot find toolbar dialog addon of type: \"${col.desc.type}\" with key \"${key}\"`);\r\n    }\r\n  });\r\n  return actions;\r\n}\r\n\r\n\r\nexport function defaultOptions(): ITaggleOptions {\r\n  return {\r\n    toolbarActions,\r\n    toolbarDialogAddons,\r\n    resolveToolbarActions,\r\n    resolveToolbarDialogAddons,\r\n    renderers: Object.assign({}, renderers),\r\n    canRender: () => true,\r\n\r\n    labelRotation: 0,\r\n    summaryHeader: true,\r\n    animated: true,\r\n    expandLineOnHover: false,\r\n    sidePanel: true,\r\n    sidePanelCollapsed: false,\r\n    hierarchyIndicator: true,\r\n    defaultSlopeGraphMode: 'item',\r\n    overviewMode: false,\r\n\r\n    livePreviews: {\r\n      search: true,\r\n      filter: true,\r\n      vis: true,\r\n      sort: true,\r\n      group: true,\r\n      groupSort: true,\r\n      colorMapping: true\r\n    },\r\n    onDialogBackgroundClick: 'cancel',\r\n\r\n    rowHeight: 18,\r\n    groupHeight: 40,\r\n    groupPadding: 5,\r\n    rowPadding: 2,\r\n\r\n    levelOfDetail: () => 'high',\r\n    customRowUpdate: () => undefined,\r\n    dynamicHeight: () => null,\r\n\r\n    flags: {\r\n      disableFrozenColumns: true, //disable by default for speed navigator.userAgent.includes('Firefox/52') // disable by default in Firefox ESR 52\r\n      advancedRankingFeatures: true,\r\n      advancedModelFeatures: true,\r\n      advancedUIFeatures: true,\r\n    },\r\n\r\n    ignoreUnsupportedBrowser: false\r\n  };\r\n}\r\n","import {detect} from 'detect-browser';\r\n\r\nexport const SUPPORTED_FIREFOX_VERSION = 57;\r\nexport const SUPPORTED_CHROME_VERSION = 64;\r\nexport const SUPPORTED_EDGE_VERSION = 16;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function getUnsupportedBrowserError() {\r\n  const info = detect();\r\n  if (!info || !info.version) {\r\n    return 'browser cannot be detected';\r\n  }\r\n  const prefix = `unsupported browser detected:`;\r\n  switch (info.name) {\r\n    case 'firefox':\r\n      const fVersion = parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\r\n      if (fVersion <= SUPPORTED_FIREFOX_VERSION && fVersion !== 52) { // ESR\r\n        return `${prefix} Firefox ${info.version} (&lt; ${SUPPORTED_FIREFOX_VERSION})`;\r\n      }\r\n      return null;\r\n    case 'edge':\r\n      const eVersion = parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\r\n      if (eVersion <= SUPPORTED_EDGE_VERSION) {\r\n        return `${prefix} Edge ${info.version} (&lt; ${SUPPORTED_EDGE_VERSION})`;\r\n      }\r\n      return null;\r\n    case 'chrome':\r\n      const cVersion = parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\r\n      if (cVersion <= SUPPORTED_CHROME_VERSION) {\r\n        return `${prefix} Chrome ${info.version} (&lt; ${SUPPORTED_CHROME_VERSION})`;\r\n      }\r\n      return null;\r\n    case 'ie':\r\n      return `${prefix} Internet Explorer`;\r\n  }\r\n  console.warn('unknown browser detected', info, 'assuming fine...');\r\n  return null;\r\n}\r\n/**\r\n * checks whether the current browser is compatible with lineupjs\r\n * @return boolean\r\n */\r\nexport function isBrowserSupported() {\r\n  return getUnsupportedBrowserError() == null;\r\n}\r\n\r\n","import ADialog from './ADialog';\r\nimport Column from '../../model';\r\nimport {cssClass} from '../../styles';\r\nimport {ILivePreviewOptions} from '../../config';\r\nimport {AEventDispatcher, IEventListener} from '../../internal';\r\n\r\n/**\r\n * emitted a dialog is opened\r\n * @asMemberOf DialogManager\r\n * @param dialog the opened dialog\r\n * @event\r\n */\r\nexport declare function dialogOpened(dialog: ADialog): void;\r\n\r\n/**\r\n * emitted a dialog is closed\r\n * @asMemberOf DialogManager\r\n * @param dialog the closed dialog\r\n * @param action the action how the dialog was closed\r\n * @event\r\n */\r\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\r\n\r\n\r\nexport default class DialogManager extends AEventDispatcher {\r\n  static readonly EVENT_DIALOG_OPENED = 'dialogOpened';\r\n  static readonly EVENT_DIALOG_CLOSED = 'dialogClosed';\r\n\r\n  private readonly escKeyListener = (evt: KeyboardEvent) => {\r\n    if (evt.which === 27) {\r\n      this.removeLast();\r\n    }\r\n  }\r\n\r\n  private readonly openDialogs: ADialog[] = [];\r\n  readonly node: HTMLElement;\r\n  readonly livePreviews: Partial<ILivePreviewOptions>;\r\n  readonly onDialogBackgroundClick: 'cancel' | 'confirm';\r\n\r\n  constructor(options: {doc: Document, livePreviews: Partial<ILivePreviewOptions>, onDialogBackgroundClick: 'cancel' | 'confirm'}) {\r\n    super();\r\n    const doc = options.doc;\r\n    this.livePreviews = options.livePreviews;\r\n    this.onDialogBackgroundClick = options.onDialogBackgroundClick;\r\n    this.node = doc.createElement('div');\r\n    this.node.classList.add(cssClass('backdrop'));\r\n    this.node.innerHTML = `<div class=\"${cssClass('backdrop-bg')}\"></div>`;\r\n    this.node.onclick = () => {\r\n      this.removeAll();\r\n    };\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([DialogManager.EVENT_DIALOG_CLOSED, DialogManager.EVENT_DIALOG_OPENED]);\r\n  }\r\n\r\n  on(type: typeof DialogManager.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\r\n  on(type: typeof DialogManager.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  get maxLevel() {\r\n    return this.openDialogs.reduce((acc, a) => Math.max(acc, a.level), 0);\r\n  }\r\n\r\n\r\n  setHighlight(mask: {left: number, top: number, width: number, height: number}) {\r\n    const area = <HTMLElement>this.node.firstElementChild;\r\n    // @see http://bennettfeely.com/clippy/ -> select `Frame` example\r\n    // use webkit prefix for safari\r\n    area.style.clipPath = (<any>area.style).webkitClipPath = `polygon(\r\n      0% 0%,\r\n      0% 100%,\r\n      ${mask.left}px 100%,\r\n      ${mask.left}px ${mask.top}px,\r\n      ${mask.left + mask.width}px ${mask.top}px,\r\n      ${mask.left + mask.width}px ${mask.top + mask.height}px,\r\n      ${mask.left}px ${mask.top + mask.height}px,\r\n      ${mask.left}px 100%,\r\n      100% 100%,\r\n      100% 0%\r\n    )`;\r\n  }\r\n\r\n  setHighlightColumn(column: Column) {\r\n    const root = <HTMLElement>this.node.parentElement!;\r\n    if (!root) {\r\n      this.clearHighlight();\r\n      return;\r\n    }\r\n    const header = <HTMLElement>root.querySelector(`.${cssClass('header')}[data-col-id=\"${column.id}\"]`);\r\n    if (!header) {\r\n      this.clearHighlight();\r\n      return;\r\n    }\r\n    const base = header.getBoundingClientRect();\r\n    const offset = root.getBoundingClientRect();\r\n    this.setHighlight({\r\n      left: base.left - offset.left,\r\n      top: base.top - offset.top,\r\n      width: base.width,\r\n      height: offset.height\r\n    });\r\n  }\r\n\r\n  clearHighlight() {\r\n    const area = <HTMLElement>this.node.firstElementChild;\r\n    area.style.clipPath = null;\r\n  }\r\n\r\n  private removeLast() {\r\n    if (this.openDialogs.length === 0) {\r\n      return;\r\n    }\r\n    this.remove(this.openDialogs[this.openDialogs.length - 1]);\r\n  }\r\n\r\n  removeAll() {\r\n    if (this.openDialogs.length === 0) {\r\n      return;\r\n    }\r\n    const all = this.openDialogs.splice(0, this.openDialogs.length);\r\n    all.reverse().forEach((d) => d.cleanUp(this.onDialogBackgroundClick));\r\n    this.takeDown();\r\n  }\r\n\r\n  triggerDialogClosed(dialog: ADialog, action: 'cancel' | 'confirm') {\r\n    this.fire(DialogManager.EVENT_DIALOG_CLOSED, dialog, action);\r\n  }\r\n\r\n  remove(dialog: ADialog, handled = false) {\r\n    const index = this.openDialogs.indexOf(dialog);\r\n    if (index < 0) {\r\n      return false;\r\n    }\r\n    // destroy self and all levels below that = after that\r\n    const destroyed = this.openDialogs.splice(index, this.openDialogs.length - index);\r\n    destroyed.reverse().forEach((d) => d.cleanUp(handled ? 'handled' : this.onDialogBackgroundClick));\r\n    while (handled && this.openDialogs.length > 0 && this.openDialogs[this.openDialogs.length - 1].autoClose) {\r\n      const dialog = this.openDialogs.pop()!;\r\n      dialog.cleanUp(this.onDialogBackgroundClick);\r\n    }\r\n\r\n    if (this.openDialogs.length === 0) {\r\n      this.takeDown();\r\n    }\r\n    return true;\r\n  }\r\n\r\n  removeAboveLevel(level: number) {\r\n    // hide all dialogs which have a higher or equal level to the newly opened one\r\n    this.openDialogs.filter((d) => d.level >= level).reverse().forEach((d) => this.remove(d));\r\n  }\r\n\r\n  removeLike(dialog: ADialog) {\r\n    const similar = this.openDialogs.find((d) => dialog.equals(d));\r\n    if (!similar) {\r\n      return false;\r\n    }\r\n    this.remove(similar);\r\n    return true;\r\n  }\r\n\r\n  private setUp() {\r\n    this.node.ownerDocument!.addEventListener('keyup', this.escKeyListener, {\r\n      passive: true\r\n    });\r\n    this.node.style.display = 'block';\r\n  }\r\n\r\n  private takeDown() {\r\n    this.clearHighlight();\r\n    this.node.ownerDocument!.removeEventListener('keyup', this.escKeyListener);\r\n    this.node.style.display = null;\r\n  }\r\n\r\n  push(dialog: ADialog) {\r\n    this.removeAboveLevel(dialog.level);\r\n\r\n    if (this.openDialogs.length === 0) {\r\n      this.setUp();\r\n    }\r\n\r\n    this.openDialogs.push(dialog);\r\n    this.fire(DialogManager.EVENT_DIALOG_OPENED, dialog);\r\n  }\r\n}\r\n","export { default as KeyFinder } from './KeyFinder';\r\n/**\r\n * different row animation modes\r\n */\r\nexport var EAnimationMode;\r\n(function (EAnimationMode) {\r\n    /**\r\n     * plain update existed both before and after\r\n     */\r\n    EAnimationMode[EAnimationMode[\"UPDATE\"] = 0] = \"UPDATE\";\r\n    /**\r\n     * exists both before and after but wasn't visible yet thus waas created\r\n     */\r\n    EAnimationMode[EAnimationMode[\"UPDATE_CREATE\"] = 1] = \"UPDATE_CREATE\";\r\n    /**\r\n     * exists both before and after is visible but not needed anymore and thus removed\r\n     */\r\n    EAnimationMode[EAnimationMode[\"UPDATE_REMOVE\"] = 2] = \"UPDATE_REMOVE\";\r\n    /**\r\n     * row appears\r\n     */\r\n    EAnimationMode[EAnimationMode[\"SHOW\"] = 3] = \"SHOW\";\r\n    /**\r\n     * row disappears\r\n     */\r\n    EAnimationMode[EAnimationMode[\"HIDE\"] = 4] = \"HIDE\";\r\n})(EAnimationMode || (EAnimationMode = {}));\r\nvar NO_CHANGE_DELTA = 1;\r\nexport function noAnimationChange(_a, previousHeight, currentHeight) {\r\n    var previous = _a.previous, mode = _a.mode, nodeY = _a.nodeY, current = _a.current;\r\n    // sounds like the same\r\n    var prev = previous.height == null ? previousHeight : previous.height;\r\n    var curr = current.height == null ? currentHeight : current.height;\r\n    return mode === EAnimationMode.UPDATE && (Math.abs(previous.y - nodeY) <= NO_CHANGE_DELTA) && (Math.abs(prev - curr) <= NO_CHANGE_DELTA);\r\n}\r\n/**\r\n * maximal duration of all animations + extra waiting before e.g. rows are really removed\r\n * @type {number}\r\n */\r\nvar MAX_ANIMATION_TIME = 1100;\r\nexport var defaultPhases = [\r\n    {\r\n        delay: 0,\r\n        apply: function (_a) {\r\n            var mode = _a.mode, previous = _a.previous, nodeY = _a.nodeY, current = _a.current, node = _a.node;\r\n            node.dataset.animation = EAnimationMode[mode].toLowerCase();\r\n            node.style.transform = \"translate(0, \" + (previous.y - nodeY) + \"px)\";\r\n            if (mode === EAnimationMode.SHOW) {\r\n                // already target height\r\n                node.style.height = current.height !== null ? current.height + \"px\" : null;\r\n            }\r\n            else { // always set previous height for default height changes\r\n                node.style.height = previous.height + \"px\";\r\n            }\r\n            node.style.opacity = mode === EAnimationMode.SHOW ? '0' : (mode === EAnimationMode.HIDE ? '1' : null);\r\n        }\r\n    },\r\n    {\r\n        delay: 10,\r\n        apply: function (_a) {\r\n            var mode = _a.mode, current = _a.current, nodeY = _a.nodeY, node = _a.node;\r\n            // null for added/update since already at the right position\r\n            node.style.transform = (mode === EAnimationMode.HIDE || mode === EAnimationMode.UPDATE_REMOVE) ? \"translate(0, \" + (current.y - nodeY) + \"px)\" : null;\r\n            if (mode !== EAnimationMode.HIDE) { // keep height for removal\r\n                node.style.height = current.height !== null ? current.height + \"px\" : null;\r\n            }\r\n            node.style.opacity = mode === EAnimationMode.SHOW ? '1' : (mode === EAnimationMode.HIDE ? '0' : null);\r\n        }\r\n    },\r\n    {\r\n        delay: MAX_ANIMATION_TIME,\r\n        apply: function (_a) {\r\n            var node = _a.node;\r\n            delete node.dataset.animation;\r\n            node.style.opacity = null;\r\n            node.style.transform = null;\r\n        }\r\n    }\r\n];\r\n//# sourceMappingURL=index.js.map","import {getUnsupportedBrowserError, SUPPORTED_CHROME_VERSION, SUPPORTED_EDGE_VERSION, SUPPORTED_FIREFOX_VERSION} from '../browser';\r\nimport {ILineUpLike} from '../config';\r\nimport {AEventDispatcher, IEventListener, clear} from '../internal';\r\nimport {Column} from '../model';\r\nimport {DataProvider, IDataProviderDump} from '../provider';\r\nimport {cssClass} from '../styles';\r\nimport DialogManager from './dialogs/DialogManager';\r\nimport {ADialog} from './dialogs';\r\n\r\n\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf ALineUp\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n\r\n/**\r\n * emitted when the selection changes\r\n * @asMemberOf ALineUp\r\n * @param dataIndices the selected data indices\r\n * @event\r\n */\r\nexport declare function selectionChanged(dataIndices: number[]): void;\r\n/**\r\n * emitted a dialog is opened\r\n * @asMemberOf ALineUp\r\n * @param dialog the opened dialog\r\n * @event\r\n */\r\nexport declare function dialogOpened(dialog: ADialog): void;\r\n/**\r\n * emitted a dialog is closed\r\n * @asMemberOf ALineUp\r\n * @param dialog the closed dialog\r\n * @param action the action how the dialog was closed\r\n * @event\r\n */\r\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\r\n\r\nexport abstract class ALineUp extends AEventDispatcher implements ILineUpLike {\r\n  static readonly EVENT_SELECTION_CHANGED = DataProvider.EVENT_SELECTION_CHANGED;\r\n  static readonly EVENT_DIALOG_OPENED = DialogManager.EVENT_DIALOG_OPENED;\r\n  static readonly EVENT_DIALOG_CLOSED = DialogManager.EVENT_DIALOG_CLOSED;\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\r\n\r\n  private highlightListeners = 0;\r\n\r\n  readonly isBrowserSupported: boolean;\r\n\r\n  constructor(public readonly node: HTMLElement, private _data: DataProvider, ignoreIncompatibleBrowser: boolean) {\r\n    super();\r\n\r\n    const error = getUnsupportedBrowserError();\r\n    this.isBrowserSupported = ignoreIncompatibleBrowser || !error;\r\n\r\n    if (!this.isBrowserSupported) {\r\n      this.node.classList.add(cssClass('unsupported-browser'));\r\n      this.node.innerHTML = `<span>${error}</span>\r\n      <div class=\"${cssClass('unsupported-browser')}\">\r\n        <a href=\"https://www.mozilla.org/en-US/firefox/\" rel=\"noopener\" target=\"_blank\" data-browser=\"firefox\" data-version=\"${SUPPORTED_FIREFOX_VERSION}\"></a>\r\n        <a href=\"https://www.google.com/chrome/index.html\" rel=\"noopener\" target=\"_blank\" data-browser=\"chrome\" data-version=\"${SUPPORTED_CHROME_VERSION}\" title=\"best support\"></a>\r\n        <a href=\"https://www.microsoft.com/en-us/windows/microsoft-edge\" rel=\"noopener\" target=\"_blank\" data-browser=\"edge\" data-version=\"${SUPPORTED_EDGE_VERSION}\"></a>\r\n      </div><span>use the <code>ignoreUnsupportedBrowser=true</code> option to ignore this error at your own risk</span>`;\r\n    }\r\n\r\n    this.forward(_data, `${DataProvider.EVENT_SELECTION_CHANGED}.main`);\r\n    _data.on(`${DataProvider.EVENT_BUSY}.busy`, (busy) => this.node.classList.toggle(cssClass('busy'), busy));\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ALineUp.EVENT_HIGHLIGHT_CHANGED, ALineUp.EVENT_SELECTION_CHANGED, ALineUp.EVENT_DIALOG_OPENED, ALineUp.EVENT_DIALOG_CLOSED]);\r\n  }\r\n\r\n  on(type: typeof ALineUp.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: typeof ALineUp.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\r\n  on(type: typeof ALineUp.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\r\n  on(type: typeof ALineUp.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  get data() {\r\n    return this._data;\r\n  }\r\n\r\n  destroy() {\r\n    // just clear since we hand in the node itself\r\n    clear(this.node);\r\n    this._data.destroy();\r\n  }\r\n\r\n  dump() {\r\n    return this.data.dump();\r\n  }\r\n\r\n  restore(dump: IDataProviderDump) {\r\n    this._data.restore(dump);\r\n  }\r\n\r\n  abstract update(): void;\r\n\r\n  setDataProvider(data: DataProvider, dump?: IDataProviderDump) {\r\n    if (this._data) {\r\n      this.unforward(this._data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\r\n      this._data.on(`${DataProvider.EVENT_BUSY}.busy`, null);\r\n    }\r\n    this._data = data;\r\n    if (dump) {\r\n      data.restore(dump);\r\n    }\r\n    this.forward(data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\r\n\r\n    data.on(`${DataProvider.EVENT_BUSY}.busy`, (busy) => this.node.classList.toggle(cssClass('busy'), busy));\r\n  }\r\n\r\n  getSelection() {\r\n    return this._data.getSelection();\r\n  }\r\n\r\n  setSelection(dataIndices: number[]) {\r\n    this._data.setSelection(dataIndices);\r\n  }\r\n\r\n  /**\r\n   * sorts LineUp by he given column\r\n   * @param column callback function finding the column to sort\r\n   * @param ascending\r\n   * @returns {boolean}\r\n   */\r\n  sortBy(column: string | ((col: Column) => boolean), ascending = false) {\r\n    const col = this.data.find(column);\r\n    if (col) {\r\n      col.sortByMe(ascending);\r\n    }\r\n    return col != null;\r\n  }\r\n\r\n  abstract setHighlight(dataIndex: number, scrollIntoView: boolean): boolean;\r\n\r\n  abstract getHighlight(): number;\r\n\r\n  protected listenersChanged(type: string, enabled: boolean) {\r\n    super.listenersChanged(type, enabled);\r\n    if (!type.startsWith(ALineUp.EVENT_HIGHLIGHT_CHANGED)) {\r\n      return;\r\n    }\r\n    if (enabled) {\r\n      this.highlightListeners++;\r\n      if (this.highlightListeners === 1) { // first\r\n        this.enableHighlightListening(true);\r\n      }\r\n    } else {\r\n      this.highlightListeners -= 1;\r\n      if (this.highlightListeners === 0) { // last\r\n        this.enableHighlightListening(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected enableHighlightListening(_enable: boolean) {\r\n    // hook\r\n  }\r\n}\r\n\r\nexport default ALineUp;\r\n","/**\r\n * utility class for optimized row context access\r\n */\r\nvar KeyFinder = /** @class */ (function () {\r\n    /**\r\n     * constructor for fast key based row access\r\n     * @param {IExceptionContext} context context to use\r\n     * @param {(rowIndex: number) => string} key key function\r\n     */\r\n    function KeyFinder(context, key) {\r\n        var _this = this;\r\n        this.context = context;\r\n        this.key = key;\r\n        this.cache = [];\r\n        this.lastFilled = 0;\r\n        this.key2index = new Map();\r\n        this.context.exceptions.forEach(function (e) {\r\n            _this.cache[e.index] = e.y;\r\n            _this.key2index.set(key(e.index), e.index);\r\n        });\r\n    }\r\n    KeyFinder.prototype.findValidStart = function (before) {\r\n        for (var i = before - 1; i >= 0; --i) {\r\n            if (this.cache[i] !== undefined) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n    /**\r\n     * returns the position of the given given or -1 if not found\r\n     * @param {string} key\r\n     * @return {number} -1 if not found\r\n     */\r\n    KeyFinder.prototype.posByKey = function (key) {\r\n        if (this.key2index.has(key)) {\r\n            var index = this.key2index.get(key);\r\n            return { index: index, pos: this.pos(index) };\r\n        }\r\n        return this.fillCacheTillKey(key);\r\n    };\r\n    /**\r\n     * returns the position of the tthe given index\r\n     * @param {number} index index to look for\r\n     * @returns {number}\r\n     */\r\n    KeyFinder.prototype.pos = function (index) {\r\n        if (this.context.exceptions.length === 0) {\r\n            // fast pass\r\n            return index * this.context.defaultRowHeight;\r\n        }\r\n        var cached = this.cache[index];\r\n        if (cached !== undefined) {\r\n            return cached;\r\n        }\r\n        //need to compute it\r\n        // find the starting point where to start counting\r\n        var start = this.findValidStart(index);\r\n        if (start < 0) {\r\n            this.fillCache(0, index, 0);\r\n        }\r\n        else {\r\n            this.fillCache(start + 1, index, this.cache[start] + this.heightOf(start));\r\n        }\r\n        return this.cache[index];\r\n    };\r\n    KeyFinder.prototype.fillCache = function (first, last, offset, callback) {\r\n        if (last <= this.lastFilled) {\r\n            //everything already there\r\n            if (!callback) {\r\n                return;\r\n            }\r\n            for (var i = first; i <= last; ++i) {\r\n                callback(i, this.key(i), this.cache[i]);\r\n            }\r\n            return;\r\n        }\r\n        var pos = offset;\r\n        for (var i = first; i <= last; ++i) {\r\n            this.cache[i] = pos;\r\n            var key = this.key(i);\r\n            this.key2index.set(key, i);\r\n            if (callback) {\r\n                callback(i, key, pos);\r\n            }\r\n            pos += this.heightOf(i);\r\n        }\r\n    };\r\n    /**\r\n     * returns the height of the row identified by index\r\n     * @param {number} index\r\n     * @returns {number}\r\n     */\r\n    KeyFinder.prototype.heightOf = function (index) {\r\n        var lookup = this.context.exceptionsLookup;\r\n        return lookup.has(index) ? lookup.get(index) : this.context.defaultRowHeight;\r\n    };\r\n    /**\r\n     * see heightOf but ignores padding and optional null in case of default height\r\n     * @param {number} index row index\r\n     * @param {boolean} returnDefault return null if default height\r\n     * @returns {number}\r\n     */\r\n    KeyFinder.prototype.exceptionHeightOf = function (index, returnDefault) {\r\n        if (returnDefault === void 0) { returnDefault = false; }\r\n        var padding = this.context.padding(index);\r\n        var lookup = this.context.exceptionsLookup;\r\n        if (lookup.has(index)) {\r\n            return lookup.get(index) - padding;\r\n        }\r\n        return returnDefault ? this.context.defaultRowHeight - padding : null;\r\n    };\r\n    /**\r\n     * padding of the given index\r\n     * @param {number} index\r\n     * @returns {number}\r\n     */\r\n    KeyFinder.prototype.padding = function (index) {\r\n        return this.context.padding(index);\r\n    };\r\n    KeyFinder.prototype.fillCacheTillKey = function (target) {\r\n        var pos = 0;\r\n        for (var i = this.lastFilled; i < this.context.numberOfRows; ++i, ++this.lastFilled) {\r\n            var c = this.cache[i];\r\n            if (c !== undefined) {\r\n                pos = c + this.heightOf(i);\r\n                continue;\r\n            }\r\n            // new one fill up\r\n            var key = this.key(i);\r\n            this.cache[i] = pos;\r\n            this.key2index.set(key, i);\r\n            if (key === target) {\r\n                return { index: i, pos: pos };\r\n            }\r\n            pos += this.heightOf(i);\r\n        }\r\n        return { index: -1, pos: -1 };\r\n    };\r\n    /**\r\n     * computes the positions and keys for a range of given indices\r\n     * @param {number} first first row index\r\n     * @param {number} last last row index\r\n     * @param {number} offset pos offset for the first row index\r\n     * @param {(index: number, key: string, pos: number) => void} callback callack for each identified index\r\n     */\r\n    KeyFinder.prototype.positions = function (first, last, offset, callback) {\r\n        this.fillCache(first, last, offset, callback);\r\n    };\r\n    return KeyFinder;\r\n}());\r\nexport default KeyFinder;\r\n//# sourceMappingURL=KeyFinder.js.map","export var defaultMode = 'animation'; // Boolean((<any>window).chrome) ? 'animation' : 0, // animation frame on chrome;\r\nfunction dummy() {\r\n    return {\r\n        handler: [],\r\n        prev: null,\r\n        timer: -1\r\n    };\r\n}\r\nvar ScrollHandler = /** @class */ (function () {\r\n    function ScrollHandler(node) {\r\n        // this.current = this.asInfo();\r\n        var _this = this;\r\n        this.node = node;\r\n        this.sync = dummy();\r\n        this.animation = dummy();\r\n        this.numbers = new Map();\r\n        this.handleAnimationImpl = function () {\r\n            if (_this.animation.timer !== 1) {\r\n                return;\r\n            }\r\n            _this.handle(_this.animation);\r\n            _this.animation.timer = -1;\r\n        };\r\n        node.addEventListener('scroll', function () {\r\n            // this.current = this.asInfo();\r\n            // if (this.prev && (Math.abs(this.current.left - this.prev.left) + Math.abs(this.current.top - this.prev.top)) < 4) {\r\n            //   return;\r\n            // }\r\n            // this.prev = this.current;\r\n            if (_this.sync.handler.length > 0) {\r\n                _this.handle(_this.sync);\r\n            }\r\n            _this.handleAnimation();\r\n            _this.handleTimeouts();\r\n        }, {\r\n            passive: true\r\n        });\r\n    }\r\n    Object.defineProperty(ScrollHandler.prototype, \"current\", {\r\n        // current: IScrollInfo;\r\n        // private prev: IScrollInfo | null = null;\r\n        get: function () {\r\n            return this.asInfo();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ScrollHandler.prototype.handle = function (handler) {\r\n        var info = this.current;\r\n        if (handler.prev && (Math.abs(info.left - handler.prev.left) + Math.abs(info.top - handler.prev.top)) < 4) {\r\n            return;\r\n        }\r\n        handler.prev = info;\r\n        for (var _i = 0, _a = handler.handler; _i < _a.length; _i++) {\r\n            var s = _a[_i];\r\n            s(info);\r\n        }\r\n    };\r\n    ScrollHandler.prototype.handleAnimation = function () {\r\n        if (this.animation.timer !== -1 || this.animation.handler.length === 0) {\r\n            return;\r\n        }\r\n        this.animation.timer = 1;\r\n        requestAnimationFrame(this.handleAnimationImpl);\r\n    };\r\n    ScrollHandler.prototype.handleTimeouts = function () {\r\n        var _this = this;\r\n        if (this.numbers.size === 0) {\r\n            return;\r\n        }\r\n        this.numbers.forEach(function (handler, n) {\r\n            if (handler.handler.length === 0) {\r\n                return;\r\n            }\r\n            handler.timer = self.setTimeout(function () {\r\n                _this.handle(handler);\r\n                handler.timer = -1;\r\n            }, n);\r\n        });\r\n    };\r\n    ScrollHandler.prototype.asInfo = function () {\r\n        return {\r\n            left: this.node.scrollLeft,\r\n            top: this.node.scrollTop,\r\n            width: this.node.clientWidth,\r\n            height: this.node.clientHeight\r\n        };\r\n    };\r\n    ScrollHandler.prototype.push = function (mode, handler) {\r\n        if (typeof mode === 'number') {\r\n            if (!this.numbers.has(mode)) {\r\n                this.numbers.set(mode, dummy());\r\n            }\r\n            this.numbers.get(mode).handler.push(handler);\r\n        }\r\n        switch (mode) {\r\n            case 'sync':\r\n                this.sync.handler.push(handler);\r\n                break;\r\n            case 'animation':\r\n                this.animation.handler.push(handler);\r\n                break;\r\n        }\r\n    };\r\n    ScrollHandler.prototype.remove = function (handler) {\r\n        var test = [this.sync, this.animation].concat(Array.from(this.numbers.values()));\r\n        return test.some(function (d) {\r\n            var index = d.handler.indexOf(handler);\r\n            if (index >= 0) {\r\n                d.handler.splice(index, 1);\r\n            }\r\n            return index >= 0;\r\n        });\r\n    };\r\n    ScrollHandler.prototype.isWaiting = function (mode) {\r\n        switch (mode) {\r\n            case 'animation':\r\n                return this.animation.timer >= 0;\r\n            case 'sync':\r\n                return false;\r\n            default:\r\n                return this.numbers.has(mode) && this.numbers.get(mode).timer >= 0;\r\n        }\r\n    };\r\n    return ScrollHandler;\r\n}());\r\n/**\r\n * @internal\r\n */\r\nexport function addScroll(scroller, mode, handler) {\r\n    // hide in element to have just one real listener\r\n    if (!scroller.__le_scroller__) {\r\n        scroller.__le_scroller__ = new ScrollHandler(scroller);\r\n    }\r\n    var s = scroller.__le_scroller__;\r\n    s.push(mode, handler);\r\n    return s.asInfo();\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport function isScrollEventWaiting(scroller, mode) {\r\n    if (!scroller.__le_scroller__) {\r\n        return false;\r\n    }\r\n    var s = scroller.__le_scroller__;\r\n    return s.isWaiting(mode);\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport function removeScroll(scroller, handler) {\r\n    if (scroller.__le_scroller__) {\r\n        scroller.__le_scroller__.remove(handler);\r\n    }\r\n}\r\n//# sourceMappingURL=scroll.js.map","export * from './scroll';\r\n/**\r\n * clear node clearing\r\n * @param node\r\n * @internal\r\n */\r\nexport function clear(node) {\r\n    while (node.lastChild) {\r\n        node.removeChild(node.lastChild);\r\n    }\r\n    return node;\r\n}\r\n//# sourceMappingURL=index.js.map","var RowHeightException = /** @class */ (function () {\r\n    function RowHeightException(index, y, height) {\r\n        this.index = index;\r\n        this.y = y;\r\n        this.height = height;\r\n    }\r\n    Object.defineProperty(RowHeightException.prototype, \"y2\", {\r\n        get: function () {\r\n            return this.y + this.height;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return RowHeightException;\r\n}());\r\n/**\r\n * creates a uniform exception context, i.e no exceptions all rows are of the same height\r\n * @param {number} numberOfRows\r\n * @param {number} rowHeight\r\n * @param {number} rowPadding padding between rows\r\n * @return {IExceptionContext}\r\n */\r\nexport function uniformContext(numberOfRows, rowHeight, rowPadding) {\r\n    if (rowPadding === void 0) { rowPadding = 0; }\r\n    rowHeight += rowPadding;\r\n    var exceptionsLookup = {\r\n        keys: function () { return [].values(); },\r\n        get: function () { return rowHeight; },\r\n        has: function () { return false; },\r\n        size: 0\r\n    };\r\n    return {\r\n        exceptions: [],\r\n        exceptionsLookup: exceptionsLookup,\r\n        totalHeight: numberOfRows * rowHeight,\r\n        numberOfRows: numberOfRows,\r\n        defaultRowHeight: rowHeight,\r\n        padding: function () { return rowPadding; }\r\n    };\r\n}\r\n/**\r\n * computes the most frequent value in a given array like\r\n * @param {} values\r\n * @return {number}\r\n */\r\nfunction mostFrequentValue(values) {\r\n    var lookup = new Map();\r\n    values.forEach(function (value) {\r\n        lookup.set(value, (lookup.get(value) || 0) + 1);\r\n    });\r\n    if (lookup.size === 0) {\r\n        return 20; // default value since it doesn't matter\r\n    }\r\n    // sort desc take first key and asc by the second in case of tie, it is optimized to have exceptions for higher rows less for big rows\r\n    var sorted = Array.from(lookup).sort(function (a, b) {\r\n        if (a[1] !== b[1]) {\r\n            return b[1] - a[1];\r\n        }\r\n        return a[0] - b[0];\r\n    });\r\n    var mostFrequent = sorted[0][0];\r\n    if (mostFrequent === 0) { // cornercase\r\n        return sorted.length > 1 ? sorted[1][0] : 20; // all empty\r\n    }\r\n    return mostFrequent;\r\n}\r\n/**\r\n * creates a non uniform context based on the given array like heights\r\n * @param rowHeights arrayish to get the heights\r\n * @param {number} defaultRowHeight if not given the most frequent value will be used\r\n * @param {number} rowPadding padding between rows\r\n * @return {IExceptionContext}\r\n */\r\nexport function nonUniformContext(rowHeights, defaultRowHeight, rowPadding) {\r\n    if (defaultRowHeight === void 0) { defaultRowHeight = NaN; }\r\n    if (rowPadding === void 0) { rowPadding = 0; }\r\n    var exceptionsLookup = new Map();\r\n    var exceptions = [];\r\n    var padding = typeof rowPadding === 'function' ? rowPadding : function () { return rowPadding; };\r\n    if (isNaN(defaultRowHeight)) {\r\n        defaultRowHeight = mostFrequentValue(rowHeights);\r\n    }\r\n    defaultRowHeight += padding(-1);\r\n    var prev = -1, acc = 0, totalHeight = 0, numberOfRows = 0;\r\n    rowHeights.forEach(function (height, index) {\r\n        height += padding(index);\r\n        totalHeight += height;\r\n        numberOfRows++;\r\n        if (height === defaultRowHeight) {\r\n            //regular\r\n            return;\r\n        }\r\n        exceptionsLookup.set(index, height);\r\n        var between = (index - prev - 1) * defaultRowHeight;\r\n        prev = index;\r\n        var y = acc + between;\r\n        acc = y + height;\r\n        exceptions.push(new RowHeightException(index, y, height));\r\n    });\r\n    return { exceptionsLookup: exceptionsLookup, exceptions: exceptions, totalHeight: totalHeight, defaultRowHeight: defaultRowHeight, numberOfRows: numberOfRows, padding: padding };\r\n}\r\n/**\r\n * creates a random context with the given constraints\r\n * @param {number} numberOfRows\r\n * @param {number} defaultRowHeight\r\n * @param {number} minRowHeight\r\n * @param {number} maxRowHeight\r\n * @param {number} ratio around ratio percent will get a non uniform height\r\n * @param {number} seed random seed\r\n * @return {IExceptionContext}\r\n */\r\nexport function randomContext(numberOfRows, defaultRowHeight, minRowHeight, maxRowHeight, ratio, seed) {\r\n    if (minRowHeight === void 0) { minRowHeight = 2; }\r\n    if (maxRowHeight === void 0) { maxRowHeight = defaultRowHeight * 10; }\r\n    if (ratio === void 0) { ratio = 0.2; }\r\n    if (seed === void 0) { seed = Date.now(); }\r\n    var actSeed = seed;\r\n    var random = function () {\r\n        var x = Math.sin(actSeed++) * 10000;\r\n        return x - Math.floor(x);\r\n    };\r\n    var getter = function () {\r\n        var coin = random();\r\n        if (coin < ratio) {\r\n            //non uniform\r\n            return minRowHeight + Math.round(random() * (maxRowHeight - minRowHeight));\r\n        }\r\n        return defaultRowHeight;\r\n    };\r\n    var forEach = function (callback) {\r\n        for (var index = 0; index < numberOfRows; ++index) {\r\n            callback(getter(), index);\r\n        }\r\n    };\r\n    return nonUniformContext({ forEach: forEach }, defaultRowHeight);\r\n}\r\n/**\r\n * computes the visible range\r\n * @param {number} scrollTop top scrolling\r\n * @param {number} clientHeight visible height\r\n * @param {number} rowHeight height of a row by default\r\n * @param {IRowHeightException[]} heightExceptions exceptions of this default height\r\n * @param {number} numberOfRows the number of rows\r\n * @return {IVisibleRange} the computed visible range\r\n */\r\nexport function range(scrollTop, clientHeight, rowHeight, heightExceptions, numberOfRows) {\r\n    if (numberOfRows === 0) {\r\n        return { first: 0, last: -1, firstRowPos: 0, endPos: 0 };\r\n    }\r\n    if (numberOfRows === 1) {\r\n        return {\r\n            first: 0,\r\n            last: 0,\r\n            firstRowPos: 0,\r\n            endPos: heightExceptions.length === 0 ? rowHeight : heightExceptions[0].y2\r\n        };\r\n    }\r\n    var offset = scrollTop;\r\n    var offset2 = offset + clientHeight;\r\n    function indexOf(pos, indexShift) {\r\n        return Math.min(numberOfRows - 1, indexShift + Math.max(0, Math.floor(pos / rowHeight)));\r\n    }\r\n    function calc(offsetShift, indexShift, isGuess) {\r\n        if (isGuess === void 0) { isGuess = false; }\r\n        var shifted = offset - offsetShift;\r\n        var shifted2 = offset2 - offsetShift;\r\n        var first = indexOf(shifted, indexShift);\r\n        var last = indexOf(shifted2, indexShift);\r\n        var firstRowPos = offsetShift + (first - indexShift) * rowHeight;\r\n        var endPos = offsetShift + (last + 1 - indexShift) * rowHeight;\r\n        //if (!isGuess) {\r\n        //  console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\r\n        //}\r\n        console.assert(!isGuess || !(firstRowPos > offset || (endPos < offset2 && last < numberOfRows - 1)), 'error', isGuess, firstRowPos, endPos, offset, offset2, indexShift, offsetShift);\r\n        return { first: first, last: last, firstRowPos: firstRowPos, endPos: endPos };\r\n    }\r\n    var r = calc(0, 0, true);\r\n    if (heightExceptions.length === 0) {\r\n        //uniform\r\n        return r;\r\n    }\r\n    if (r.last < heightExceptions[0].index) {\r\n        //console.log('before the first exception = uniform with no shift');\r\n        //console.log(r.first, '@', r.firstRowPos, r.last, '#', r.end, offset, offset2, r.firstRowPos <= offset, offset2 <= r.end);\r\n        return r;\r\n    }\r\n    if (r.last === heightExceptions[0].index && heightExceptions[0].height > rowHeight) {\r\n        return Object.assign(r, { endPos: heightExceptions[0].y2 });\r\n    }\r\n    //the position where the exceptions ends\r\n    var lastPos = heightExceptions[heightExceptions.length - 1];\r\n    if (offset >= lastPos.y) {\r\n        var rest = calc(lastPos.y2, lastPos.index + 1);\r\n        if (offset < lastPos.y2) {\r\n            // include me\r\n            return Object.assign(rest, { first: lastPos.index, firstRowPos: lastPos.y });\r\n        }\r\n        return rest;\r\n    }\r\n    //we have some exceptions\r\n    var visible = [];\r\n    var closest = heightExceptions[0]; //closest before not in range\r\n    for (var _i = 0, heightExceptions_1 = heightExceptions; _i < heightExceptions_1.length; _i++) {\r\n        var item = heightExceptions_1[_i];\r\n        var y = item.y, y2 = item.y2;\r\n        if (y >= offset2) {\r\n            break;\r\n        }\r\n        if (y2 <= offset) {\r\n            closest = item;\r\n            continue;\r\n        }\r\n        visible.push(item);\r\n    }\r\n    if (visible.length === 0) {\r\n        //console.log('we are in the between some exceptions and none are visible');\r\n        return calc(closest.y2, closest.index + 1); //skip myself\r\n    }\r\n    {\r\n        //console.log('we show at least one exception');\r\n        var firstException = visible[0];\r\n        var lastException = visible[visible.length - 1];\r\n        var first = Math.max(0, firstException.index - Math.max(0, Math.ceil((firstException.y - offset) / rowHeight)));\r\n        var last = lastException.index;\r\n        if (offset2 >= lastException.y2) {\r\n            last = indexOf(offset2 - lastException.y2, lastException.index + 1);\r\n        }\r\n        var firstRowPos = firstException.y - (firstException.index - first) * rowHeight;\r\n        var endPos = lastException.y2 + (last - lastException.index) * rowHeight;\r\n        //console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\r\n        console.assert(firstRowPos <= offset && (endPos >= offset2 || last === numberOfRows - 1), 'error', firstRowPos, endPos, offset, offset2, firstException, lastException);\r\n        return { first: first, last: last, firstRowPos: firstRowPos, endPos: endPos };\r\n    }\r\n}\r\nexport function frozenDelta(current, target) {\r\n    var clength = current.length;\r\n    var tlength = target.length;\r\n    if (clength === 0) {\r\n        return { added: target, removed: [], common: 0 };\r\n    }\r\n    if (tlength === 0) {\r\n        return { added: [], removed: current, common: 0 };\r\n    }\r\n    if (clength === tlength) { //since sorted and left increasing true\r\n        return { added: [], removed: [], common: clength };\r\n    }\r\n    var removed = current.slice(Math.min(tlength, clength));\r\n    var added = target.slice(Math.min(tlength, clength));\r\n    return { added: added, removed: removed, common: clength - removed.length };\r\n}\r\nexport function updateFrozen(old, columns, first) {\r\n    var oldLast = old.length === 0 ? 0 : old[old.length - 1] + 1;\r\n    var added = [];\r\n    var removed = [];\r\n    for (var i = old.length - 1; i >= 0; --i) {\r\n        var index = old[i];\r\n        if (index >= first) {\r\n            removed.push(old.pop());\r\n        }\r\n        else {\r\n            // can stop since sorted and it will never happen again\r\n            break;\r\n        }\r\n    }\r\n    //added\r\n    for (var i = oldLast; i < first; ++i) {\r\n        if (columns[i].frozen) {\r\n            added.push(i);\r\n            old.push(i);\r\n        }\r\n    }\r\n    return { target: old, added: added, removed: removed };\r\n}\r\n//# sourceMappingURL=logic.js.map","/**\r\n * scrolling result\r\n */\r\nexport var EScrollResult;\r\n(function (EScrollResult) {\r\n    /**\r\n     * nothing has changed\r\n     */\r\n    EScrollResult[EScrollResult[\"NONE\"] = 0] = \"NONE\";\r\n    /**\r\n     * all rows needed to be recreated\r\n     */\r\n    EScrollResult[EScrollResult[\"ALL\"] = 1] = \"ALL\";\r\n    /**\r\n     * unknown\r\n     */\r\n    EScrollResult[EScrollResult[\"SOME\"] = 2] = \"SOME\";\r\n    /**\r\n     * some rows are added at the bottom\r\n     */\r\n    EScrollResult[EScrollResult[\"SOME_BOTTOM\"] = 3] = \"SOME_BOTTOM\";\r\n    /**\r\n     * some rows are added at the top\r\n     */\r\n    EScrollResult[EScrollResult[\"SOME_TOP\"] = 4] = \"SOME_TOP\";\r\n})(EScrollResult || (EScrollResult = {}));\r\n//# sourceMappingURL=IMixin.js.map","var PREFIX = 'le';\r\n/**\r\n * @internal\r\n * @param suffix suffix to suffix\r\n */\r\nexport function cssClass(suffix) {\r\n    if (!suffix) {\r\n        return PREFIX;\r\n    }\r\n    return PREFIX + \"-\" + suffix;\r\n}\r\nexport var CSS_CLASS_LOADING = cssClass('loading');\r\nexport var CSS_CLASS_FROZEN = cssClass('frozen');\r\nexport var CSS_CLASS_HIDDEN = cssClass('hidden');\r\nexport var CSS_CLASS_MULTI = cssClass('multi');\r\nexport var CSS_CLASS_EVEN = cssClass('even');\r\nexport var CSS_CLASS_SHIFTED = cssClass('shifted');\r\nexport var CSS_CLASS_SCROLLBAR_TESTER = cssClass('scrollbar-tester');\r\nexport var CSS_CLASS_HEADER = cssClass('header');\r\nexport var CSS_CLASS_BODY = cssClass('body');\r\nexport var CSS_CLASS_FOOTER = cssClass('footer');\r\nexport var CSS_CLASS_THEAD = cssClass('thead');\r\nexport var CSS_CLASS_TBODY = cssClass('tbody');\r\nexport var CSS_CLASS_TR = cssClass('tr');\r\nexport var CSS_CLASS_TH = cssClass('th');\r\nexport var CSS_CLASS_TD = cssClass('td');\r\nexport var CSS_CLASS_SCROLLING = cssClass('scrolling');\r\nexport var CSS_CLASS_ROW_ANIMATION = cssClass('row-animation');\r\n//# sourceMappingURL=index.js.map","import { ABORTED, isAbortAble } from './abortAble';\r\nimport { defaultPhases, EAnimationMode, noAnimationChange } from './animation';\r\nimport KeyFinder from './animation/KeyFinder';\r\nimport { addScroll, clear, defaultMode, removeScroll } from './internal';\r\nimport { isScrollEventWaiting } from './internal/scroll';\r\nimport { range } from './logic';\r\nimport { EScrollResult } from './mixin';\r\nimport { cssClass, CSS_CLASS_EVEN, CSS_CLASS_FOOTER, CSS_CLASS_LOADING, CSS_CLASS_ROW_ANIMATION, CSS_CLASS_SCROLLING, CSS_CLASS_TR } from './styles';\r\nexport function isLoadingCell(node) {\r\n    return node.classList.contains(CSS_CLASS_LOADING);\r\n}\r\n/**\r\n * base class for creating a scalable table renderer based on rows\r\n */\r\nvar ARowRenderer = /** @class */ (function () {\r\n    function ARowRenderer(body, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        this.body = body;\r\n        this.pool = [];\r\n        this.loadingPool = [];\r\n        this.loading = new WeakMap();\r\n        /**\r\n         * currently visible slice\r\n         */\r\n        this.visible = {\r\n            first: 0,\r\n            forcedFirst: 0,\r\n            last: -1,\r\n            forcedLast: -1\r\n        };\r\n        /**\r\n         * position of the first visible row in pixel\r\n         * @type {number}\r\n         */\r\n        this.visibleFirstRowPos = 0;\r\n        this.scrollListener = null;\r\n        this.lastScrollInfo = null;\r\n        this.abortAnimation = function () { return undefined; };\r\n        this.options = {\r\n            async: defaultMode,\r\n            minScrollDelta: 10,\r\n            mixins: [],\r\n            scrollingHint: false,\r\n            batchSize: 10,\r\n            striped: false,\r\n            viewportOversize: 200\r\n        };\r\n        this.adapter = this.createAdapter();\r\n        Object.assign(this.options, options);\r\n        this.mixins = this.options.mixins.map(function (mixinClass) { return new mixinClass(_this.adapter); });\r\n        this.fragment = body.ownerDocument.createDocumentFragment();\r\n    }\r\n    /**\r\n     * register another mixin to this renderer\r\n     * @param {IMixinClass} mixinClass the mixin class to instantitiate\r\n     * @param options optional constructor options\r\n     */\r\n    ARowRenderer.prototype.addMixin = function (mixinClass, options) {\r\n        this.mixins.push(new mixinClass(this.adapter, options));\r\n    };\r\n    ARowRenderer.prototype.createAdapter = function () {\r\n        var _this = this;\r\n        var r = {\r\n            visible: this.visible,\r\n            addAtBeginning: this.addAtBeginning.bind(this),\r\n            addAtBottom: this.addAtBottom.bind(this),\r\n            removeFromBeginning: this.removeFromBeginning.bind(this),\r\n            removeFromBottom: this.removeFromBottom.bind(this),\r\n            updateOffset: this.updateOffset.bind(this),\r\n            isScrollEventWaiting: function () { return isScrollEventWaiting(_this.bodyScroller, _this.options.async); }\r\n        };\r\n        Object.defineProperties(r, {\r\n            visibleFirstRowPos: {\r\n                get: function () { return _this.visibleFirstRowPos; },\r\n                enumerable: true\r\n            },\r\n            context: {\r\n                get: function () { return _this.context; },\r\n                enumerable: true\r\n            },\r\n            scrollOffset: {\r\n                get: function () { return _this.lastScrollInfo ? _this.lastScrollInfo.top : 0; },\r\n                enumerable: true\r\n            },\r\n            scrollTotal: {\r\n                get: function () { return _this.lastScrollInfo ? _this.lastScrollInfo.height : _this.bodyScroller.clientHeight; },\r\n                enumerable: true\r\n            }\r\n        });\r\n        return r;\r\n    };\r\n    Object.defineProperty(ARowRenderer.prototype, \"bodyScroller\", {\r\n        /**\r\n         * get the scrolling container i.e. parent of the body element\r\n         * @returns {HTMLElement}\r\n         */\r\n        get: function () {\r\n            return this.body.parentElement;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ARowRenderer.prototype, \"bodySizer\", {\r\n        get: function () {\r\n            var parent = this.bodyScroller;\r\n            var sizer = Array.from(parent.children).find(function (d) { return d.tagName.toLowerCase() === 'footer'; });\r\n            if (sizer) {\r\n                return sizer;\r\n            }\r\n            var s = parent.ownerDocument.createElement('footer');\r\n            s.classList.add(CSS_CLASS_FOOTER, cssClass(\"footer-\" + this.idPrefix));\r\n            parent.insertBefore(s, parent.firstChild);\r\n            return s;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * initializes the table and register the onscroll listener\r\n     * @returns {void} nothing\r\n     */\r\n    ARowRenderer.prototype.init = function () {\r\n        var _this = this;\r\n        var scroller = this.bodyScroller;\r\n        var old = addScroll(scroller, this.options.async, this.scrollListener = function (act) {\r\n            _this.lastScrollInfo = act;\r\n            if (Math.abs(old.top - act.top) < _this.options.minScrollDelta && Math.abs(old.height - act.height) < _this.options.minScrollDelta) {\r\n                return;\r\n            }\r\n            var isGoingDown = act.top > old.top;\r\n            old = act;\r\n            _this.onScrolledVertically(act.top, act.height, isGoingDown);\r\n            if (_this.options.scrollingHint) {\r\n                _this.body.classList.remove(CSS_CLASS_SCROLLING);\r\n            }\r\n        });\r\n        if (this.options.scrollingHint) {\r\n            addScroll(scroller, 'animation', function () { return _this.body.classList.add(CSS_CLASS_SCROLLING); });\r\n        }\r\n        this.recreate();\r\n    };\r\n    /**\r\n     * destroys this renderer and unregisters all event listeners\r\n     */\r\n    ARowRenderer.prototype.destroy = function () {\r\n        removeScroll(this.bodyScroller, this.scrollListener);\r\n        this.body.remove();\r\n    };\r\n    ARowRenderer.cleanUp = function (item) {\r\n        item.style.height = null;\r\n    };\r\n    ARowRenderer.prototype.select = function (index) {\r\n        var item;\r\n        var result;\r\n        if (this.pool.length > 0) {\r\n            item = this.pool.pop();\r\n            result = this.updateRow(item, index);\r\n        }\r\n        else if (this.loadingPool.length > 0) {\r\n            item = this.loadingPool.pop();\r\n            item.classList.remove(CSS_CLASS_LOADING);\r\n            result = this.createRow(item, index);\r\n        }\r\n        else {\r\n            item = this.body.ownerDocument.createElement('div');\r\n            item.classList.add(CSS_CLASS_TR, cssClass(\"tr-\" + this.idPrefix));\r\n            result = this.createRow(item, index);\r\n        }\r\n        item.dataset.index = String(index);\r\n        if (this.options.striped) {\r\n            item.classList.toggle(CSS_CLASS_EVEN, index % 2 === 0);\r\n        }\r\n        return { item: item, result: result };\r\n    };\r\n    ARowRenderer.prototype.selectProxy = function () {\r\n        var proxy;\r\n        if (this.loadingPool.length > 0) {\r\n            proxy = this.loadingPool.pop();\r\n        }\r\n        else {\r\n            proxy = this.body.ownerDocument.createElement('div');\r\n            proxy.classList.add(CSS_CLASS_LOADING, CSS_CLASS_TR, cssClass(\"tr-\" + this.idPrefix));\r\n        }\r\n        return proxy;\r\n    };\r\n    ARowRenderer.prototype.recycle = function (item) {\r\n        ARowRenderer.cleanUp(item);\r\n        // check if the original dom element is still being manipulated\r\n        if (this.loading.has(item)) {\r\n            var abort = this.loading.get(item);\r\n            abort.abort();\r\n        }\r\n        else {\r\n            this.pool.push(item);\r\n        }\r\n    };\r\n    ARowRenderer.prototype.proxy = function (item, result) {\r\n        var _this = this;\r\n        if (!isAbortAble(result)) {\r\n            return item;\r\n        }\r\n        var abort = result;\r\n        //lazy loading\r\n        var real = item;\r\n        var proxy = this.selectProxy();\r\n        // copy attributes\r\n        proxy.dataset.index = real.dataset.index;\r\n        proxy.style.height = real.style.height;\r\n        this.loading.set(proxy, abort);\r\n        abort.then(function (result) {\r\n            if (result === ABORTED) {\r\n                //aborted can recycle the real one\r\n                ARowRenderer.cleanUp(real);\r\n                _this.pool.push(real);\r\n            }\r\n            else {\r\n                //fully loaded\r\n                _this.body.replaceChild(real, proxy);\r\n            }\r\n            _this.loading.delete(proxy);\r\n            ARowRenderer.cleanUp(proxy);\r\n            _this.loadingPool.push(proxy);\r\n        });\r\n        return proxy;\r\n    };\r\n    ARowRenderer.prototype.create = function (index) {\r\n        var _a = this.select(index), item = _a.item, result = _a.result;\r\n        var _b = this.context, ex = _b.exceptionsLookup, padding = _b.padding;\r\n        if (ex.has(index)) {\r\n            item.style.height = ex.get(index) - padding(index) + \"px\";\r\n        }\r\n        return this.proxy(item, result);\r\n    };\r\n    ARowRenderer.prototype.removeAll = function (perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        var b = this.body;\r\n        if (!perform) {\r\n            return Array.from(b.children);\r\n        }\r\n        var torecycle = [];\r\n        while (b.lastElementChild) {\r\n            var i = b.lastElementChild;\r\n            b.removeChild(i);\r\n            this.recycle(i);\r\n            torecycle.push(i);\r\n        }\r\n        return torecycle;\r\n    };\r\n    /**\r\n     * triggers and visual update of all visible rows\r\n     */\r\n    ARowRenderer.prototype.update = function () {\r\n        var _this = this;\r\n        var first = this.visible.first;\r\n        var fragment = this.fragment;\r\n        var items = Array.from(this.body.children);\r\n        clear(this.body);\r\n        items.forEach(function (item, i) {\r\n            if (_this.loading.has(item)) {\r\n                // still loading\r\n                fragment.appendChild(item);\r\n                return;\r\n            }\r\n            var abort = _this.updateRow(item, i + first);\r\n            fragment.appendChild(_this.proxy(item, abort));\r\n        });\r\n        this.body.appendChild(fragment);\r\n    };\r\n    /**\r\n     * utility to execute a function for each visible row\r\n     * @param {(row: HTMLElement, rowIndex: number) => void} callback callback to execute\r\n     * @param {boolean} inplace whether the DOM changes should be performed inplace instead of in a fragment\r\n     */\r\n    ARowRenderer.prototype.forEachRow = function (callback, inplace) {\r\n        var _this = this;\r\n        if (inplace === void 0) { inplace = false; }\r\n        var rows = Array.from(this.body.children);\r\n        var fragment = this.fragment;\r\n        if (!inplace) {\r\n            clear(this.body);\r\n        }\r\n        rows.forEach(function (row, index) {\r\n            if (!isLoadingCell(row) && row.dataset.animation !== 'update_remove' && row.dataset.animation !== 'hide') {\r\n                //skip loading ones and temporary ones\r\n                callback(row, index + _this.visible.first);\r\n            }\r\n            if (!inplace) {\r\n                fragment.appendChild(row);\r\n            }\r\n        });\r\n        if (!inplace) {\r\n            this.body.appendChild(fragment);\r\n        }\r\n    };\r\n    ARowRenderer.prototype.removeFromBeginning = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        return this.remove(from, to, true, perform);\r\n    };\r\n    ARowRenderer.prototype.removeFromBottom = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        return this.remove(from, to, false, perform);\r\n    };\r\n    ARowRenderer.prototype.remove = function (from, to, fromBeginning, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        if (to < from) {\r\n            return;\r\n        }\r\n        var b = this.body;\r\n        var torecycle = [];\r\n        // console.log('remove', fromBeginning, (to - from) + 1, this.body.childElementCount - ((to - from) + 1));\r\n        var act = (fromBeginning ? b.firstChild : b.lastChild);\r\n        for (var i = from; i <= to; ++i) {\r\n            var item = act;\r\n            act = (fromBeginning ? act.nextSibling : act.previousSibling);\r\n            if (perform) {\r\n                b.removeChild(item);\r\n                this.recycle(item);\r\n            }\r\n            torecycle.push(item);\r\n        }\r\n        return torecycle;\r\n    };\r\n    ARowRenderer.prototype.addAtBeginning = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        if (to < from) {\r\n            return;\r\n        }\r\n        // console.log('add', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\r\n        var fragment = this.fragment;\r\n        if (from === to && perform) {\r\n            this.body.insertBefore(this.create(from), this.body.firstChild);\r\n            return;\r\n        }\r\n        for (var i = from; i <= to; ++i) {\r\n            fragment.appendChild(this.create(i));\r\n        }\r\n        if (perform) {\r\n            this.body.insertBefore(fragment, this.body.firstChild);\r\n        }\r\n        return fragment;\r\n    };\r\n    ARowRenderer.prototype.addAtBottom = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        if (to < from) {\r\n            return;\r\n        }\r\n        // console.log('add_b', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\r\n        if (from === to && perform) {\r\n            this.body.appendChild(this.create(from));\r\n            return;\r\n        }\r\n        var fragment = this.fragment;\r\n        for (var i = from; i <= to; ++i) {\r\n            fragment.appendChild(this.create(i));\r\n        }\r\n        if (perform) {\r\n            this.body.appendChild(fragment);\r\n        }\r\n        return fragment;\r\n    };\r\n    ARowRenderer.prototype.updateOffset = function (firstRowPos) {\r\n        this.visibleFirstRowPos = firstRowPos;\r\n        this.updateSizer(firstRowPos);\r\n    };\r\n    ARowRenderer.prototype.updateSizer = function (firstRowPos) {\r\n        var totalHeight = this.context.totalHeight;\r\n        setTransform(this.body, 0, firstRowPos.toFixed(0));\r\n        setTransform(this.bodySizer, 0, Math.max(0, totalHeight - 1).toFixed(0));\r\n    };\r\n    /**\r\n     * removes all rows and recreates the table\r\n     * @param {IAnimationContext} ctx optional animation context to create a transition between the previous and the current tables\r\n     * @returns {void} nothing\r\n     */\r\n    ARowRenderer.prototype.recreate = function (ctx) {\r\n        this.abortAnimation();\r\n        if (ctx) {\r\n            return this.recreateAnimated(ctx);\r\n        }\r\n        return this.recreatePure();\r\n    };\r\n    ARowRenderer.prototype.recreatePure = function () {\r\n        var context = this.context;\r\n        var scroller = this.bodyScroller;\r\n        //update first to avoid resetting scrollTop\r\n        this.updateOffset(0);\r\n        this.removeAll();\r\n        this.clearPool();\r\n        var _a = range(scroller.scrollTop, scroller.clientHeight, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\r\n        this.visible.first = this.visible.forcedFirst = first;\r\n        this.visible.last = this.visible.forcedLast = last;\r\n        if (first < 0) {\r\n            // empty\r\n            this.updateOffset(0);\r\n            return;\r\n        }\r\n        this.addAtBottom(first, last);\r\n        this.updateOffset(firstRowPos);\r\n    };\r\n    ARowRenderer.prototype.recreateAnimated = function (ctx) {\r\n        var _this = this;\r\n        var lookup = new Map();\r\n        var prev = new KeyFinder(ctx.previous, ctx.previousKey);\r\n        var cur = new KeyFinder(this.context, ctx.currentKey);\r\n        var next = range(this.bodyScroller.scrollTop, this.bodyScroller.clientHeight, cur.context.defaultRowHeight, cur.context.exceptions, cur.context.numberOfRows);\r\n        {\r\n            var rows_1 = Array.from(this.body.children);\r\n            var old = Object.assign({}, this.visible);\r\n            //store the current rows in a lookup and clear\r\n            clear(this.body);\r\n            prev.positions(old.first, Math.min(old.last, old.first + rows_1.length), this.visibleFirstRowPos, function (i, key, pos) {\r\n                var n = rows_1[i];\r\n                if (n) { // shouldn't happen that it is not there\r\n                    lookup.set(key, { n: n, pos: pos, i: i });\r\n                }\r\n                // else {\r\n                //  console.error(i, key, pos, rows);\r\n                //}\r\n            });\r\n        }\r\n        this.visible.first = this.visible.forcedFirst = next.first;\r\n        this.visible.last = this.visible.forcedLast = next.last;\r\n        var fragment = this.fragment;\r\n        var animation = [];\r\n        var nodeY = next.firstRowPos;\r\n        cur.positions(next.first, next.last, next.firstRowPos, function (i, key, pos) {\r\n            var node;\r\n            var mode = EAnimationMode.UPDATE;\r\n            var previous;\r\n            if (lookup.has(key)) {\r\n                // still visible\r\n                var item = lookup.get(key);\r\n                lookup.delete(key);\r\n                // update height\r\n                item.n.dataset.index = String(i);\r\n                node = _this.proxy(item.n, _this.updateRow(item.n, i));\r\n                previous = {\r\n                    index: item.i,\r\n                    y: item.pos,\r\n                    height: prev.exceptionHeightOf(item.i, true)\r\n                };\r\n            }\r\n            else {\r\n                // need a new row\r\n                var old = prev.posByKey(key);\r\n                // maybe not visible  before so keep in place\r\n                node = _this.create(i);\r\n                mode = old.index < 0 ? EAnimationMode.SHOW : EAnimationMode.UPDATE_CREATE;\r\n                previous = {\r\n                    index: old.index,\r\n                    y: old.pos >= 0 ? old.pos : pos,\r\n                    height: old.index < 0 ? cur.exceptionHeightOf(i, true) : prev.exceptionHeightOf(old.index, true)\r\n                };\r\n            }\r\n            animation.push({\r\n                node: node,\r\n                key: key,\r\n                mode: mode,\r\n                previous: previous,\r\n                nodeY: nodeY,\r\n                nodeYCurrentHeight: pos,\r\n                current: {\r\n                    index: i,\r\n                    y: pos,\r\n                    height: cur.exceptionHeightOf(i)\r\n                }\r\n            });\r\n            node.style.transform = \"translate(0, \" + (nodeY - pos) + \"px)\";\r\n            nodeY += previous.height + (previous.index < 0 ? cur.padding(i) : prev.padding(previous.index));\r\n            fragment.appendChild(node);\r\n        });\r\n        var nodeYCurrentHeight = next.endPos;\r\n        // items that are going to be removed\r\n        lookup.forEach(function (item, key) {\r\n            // calculate their next position\r\n            var r = cur.posByKey(key);\r\n            // maybe not visible anymore, keep in place\r\n            var nextPos = r.pos >= 0 ? r.pos : item.pos;\r\n            var node = item.n;\r\n            // located at addedPos\r\n            // should end up at nextPos\r\n            // was previously at item.pos\r\n            node.style.transform = \"translate(0, \" + (item.pos - nodeY) + \"px)\";\r\n            fragment.appendChild(node);\r\n            var prevHeight = prev.exceptionHeightOf(item.i, true);\r\n            animation.push({\r\n                node: item.n,\r\n                key: key,\r\n                mode: r.index < 0 ? EAnimationMode.HIDE : EAnimationMode.UPDATE_REMOVE,\r\n                previous: {\r\n                    index: item.i,\r\n                    y: item.pos,\r\n                    height: prevHeight\r\n                },\r\n                nodeY: nodeY,\r\n                nodeYCurrentHeight: nodeYCurrentHeight,\r\n                current: {\r\n                    index: r.index,\r\n                    y: nextPos,\r\n                    height: r.index < 0 ? null : cur.exceptionHeightOf(r.index)\r\n                }\r\n            });\r\n            nodeYCurrentHeight += r.index < 0 ? cur.context.defaultRowHeight : (cur.exceptionHeightOf(r.index, true) + cur.padding(r.index));\r\n            nodeY += prevHeight + prev.padding(item.i);\r\n        });\r\n        this.updateOffset(next.firstRowPos);\r\n        this.animate(animation, ctx.phases || defaultPhases, prev, cur, fragment);\r\n    };\r\n    ARowRenderer.prototype.animate = function (animation, phases, previousFinder, currentFinder, fragment) {\r\n        var _this = this;\r\n        if (animation.length <= 0) {\r\n            this.body.appendChild(fragment);\r\n            return;\r\n        }\r\n        var currentTimer = -1;\r\n        var actPhase = 0;\r\n        var executePhase = function (phase, items) {\r\n            if (items === void 0) { items = animation; }\r\n            items.forEach(function (anim) { return phase.apply(anim, previousFinder, currentFinder); });\r\n        };\r\n        var run = function () {\r\n            //dummy log for forcing dom update\r\n            console.assert(animation[0].node.offsetTop >= 0, 'dummy log for forcing dom update');\r\n            executePhase(phases[actPhase++]);\r\n            // shifted by one since already added through ++\r\n            if (actPhase < phases.length) {\r\n                // schedule the next one\r\n                var next = phases[actPhase];\r\n                currentTimer = self.setTimeout(run, next.delay);\r\n                return;\r\n            }\r\n            // last one\r\n            var body = _this.body.classList;\r\n            Array.from(body).forEach(function (v) {\r\n                if (v.startsWith(cssClass()) && v.endsWith('-animation')) {\r\n                    body.remove(v);\r\n                }\r\n            });\r\n            // clean up\r\n            animation.forEach(function (_a) {\r\n                var node = _a.node, mode = _a.mode;\r\n                if (mode !== EAnimationMode.UPDATE_REMOVE && mode !== EAnimationMode.HIDE) {\r\n                    return;\r\n                }\r\n                node.remove();\r\n                node.style.transform = null;\r\n                _this.recycle(node);\r\n            });\r\n            _this.abortAnimation = function () { return undefined; };\r\n            currentTimer = -1;\r\n        };\r\n        // execute all phases having a delay of zero\r\n        while (phases[actPhase].delay === 0) {\r\n            executePhase(phases[actPhase++]);\r\n        }\r\n        // after the initial one\r\n        var body = this.body;\r\n        this.body.appendChild(fragment);\r\n        var dummyAnimation = [];\r\n        animation = animation.filter(function (d) {\r\n            if (noAnimationChange(d, previousFinder.context.defaultRowHeight, currentFinder.context.defaultRowHeight)) {\r\n                dummyAnimation.push(d);\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n        if (dummyAnimation.length > 0) {\r\n            // execute all phases for them\r\n            phases.slice(actPhase).forEach(function (phase) { return executePhase(phase, dummyAnimation); });\r\n        }\r\n        if (animation.length === 0) {\r\n            return;\r\n        }\r\n        body.classList.add(CSS_CLASS_ROW_ANIMATION);\r\n        (new Set(animation.map(function (d) { return d.mode; }))).forEach(function (mode) {\r\n            // add class but map to UPDATE only\r\n            body.classList.add(cssClass(EAnimationMode[mode].toLowerCase().split('_')[0] + \"-animation\"));\r\n        });\r\n        this.abortAnimation = function () {\r\n            if (currentTimer <= 0) {\r\n                return;\r\n            }\r\n            // abort by removing\r\n            clearTimeout(currentTimer);\r\n            currentTimer = -1;\r\n            // run the last phase\r\n            actPhase = phases.length - 1;\r\n            run();\r\n        };\r\n        // next tick such that DOM will be updated\r\n        currentTimer = self.setTimeout(run, phases[actPhase].delay);\r\n    };\r\n    /**\r\n     * clears the row pool used for faster creation\r\n     */\r\n    ARowRenderer.prototype.clearPool = function () {\r\n        // clear pool\r\n        this.pool.splice(0, this.pool.length);\r\n    };\r\n    /**\r\n     * triggers a revalidation of the current scrolling offest\r\n     */\r\n    ARowRenderer.prototype.revalidate = function () {\r\n        var scroller = this.bodyScroller;\r\n        this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, true);\r\n        this.updateOffset(this.visibleFirstRowPos);\r\n    };\r\n    /**\r\n     * scrolling vertically\r\n     * @param {number} scrollTop top scrolling\r\n     * @param {number} clientHeight visible height\r\n     * @param {boolean} isGoingDown hint whether the scrollTop increases\r\n     * @return {EScrollResult} full in case of a full rebuild or partial update\r\n     */\r\n    ARowRenderer.prototype.onScrolledVertically = function (scrollTop, clientHeight, isGoingDown) {\r\n        var shift = this.options.viewportOversize;\r\n        var shiftTop = Math.max(0, scrollTop - shift);\r\n        var scrollResult = this.onScrolledImpl(shiftTop, clientHeight + shift + (scrollTop - shiftTop));\r\n        for (var _i = 0, _a = this.mixins; _i < _a.length; _i++) {\r\n            var mixin = _a[_i];\r\n            mixin.onScrolled(isGoingDown, scrollResult);\r\n        }\r\n        return scrollResult;\r\n    };\r\n    ARowRenderer.prototype.shiftLast = function (current, currentDelta) {\r\n        var b = this.options.batchSize;\r\n        if (currentDelta >= b) {\r\n            return current;\r\n        }\r\n        var total = this.context.numberOfRows;\r\n        return Math.min(total - 1, current + (this.options.batchSize - currentDelta));\r\n    };\r\n    ARowRenderer.prototype.shiftFirst = function (current, currentFirstRow, currentDelta) {\r\n        var b = this.options.batchSize;\r\n        if (currentDelta >= b || current <= 0) {\r\n            return { first: current, firstRowPos: currentFirstRow };\r\n        }\r\n        var first = Math.max(0, current - (this.options.batchSize - currentDelta));\r\n        var _a = this.context, exceptionsLookup = _a.exceptionsLookup, defaultRowHeight = _a.defaultRowHeight;\r\n        var firstRowPos = currentFirstRow;\r\n        for (var i = first; i < current; ++i) {\r\n            if (exceptionsLookup.has(i)) {\r\n                firstRowPos -= exceptionsLookup.get(i);\r\n            }\r\n            else {\r\n                firstRowPos -= defaultRowHeight;\r\n            }\r\n        }\r\n        return { first: first, firstRowPos: firstRowPos };\r\n    };\r\n    ARowRenderer.prototype.onScrolledImpl = function (scrollTop, clientHeight) {\r\n        var context = this.context;\r\n        var _a = range(scrollTop, clientHeight, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\r\n        var visible = this.visible;\r\n        visible.forcedFirst = first;\r\n        visible.forcedLast = last;\r\n        if ((first - visible.first) >= 0 && (last - visible.last) <= 0) {\r\n            //nothing to do\r\n            return EScrollResult.NONE;\r\n        }\r\n        var r = EScrollResult.SOME;\r\n        var torecycle;\r\n        var toadd;\r\n        var toaddBottom = false;\r\n        if (first > visible.last || last < visible.first) {\r\n            //no overlap, clean and draw everything\r\n            //console.log(`ff added: ${last - first + 1} removed: ${visibleLast - visibleFirst + 1} ${first}:${last} ${offset}`);\r\n            //removeRows(visibleFirst, visibleLast);\r\n            torecycle = this.removeAll(false);\r\n            toadd = this.addAtBottom(first, last, false);\r\n            toaddBottom = true;\r\n            r = EScrollResult.ALL;\r\n        }\r\n        else if (first < visible.first) {\r\n            //some first rows missing and some last rows to much\r\n            //console.log(`up added: ${visibleFirst - first + 1} removed: ${visibleLast - last + 1} ${first}:${last} ${offset}`);\r\n            var toRemove = visible.last - (last + 1);\r\n            if (toRemove >= this.options.batchSize) {\r\n                torecycle = this.removeFromBottom(last + 1, visible.last, false);\r\n            }\r\n            else {\r\n                last = visible.last;\r\n            }\r\n            var shift = this.shiftFirst(first, firstRowPos, visible.first - 1 - first);\r\n            first = shift.first;\r\n            firstRowPos = shift.firstRowPos;\r\n            toadd = this.addAtBeginning(first, visible.first - 1, false);\r\n            toaddBottom = false;\r\n            r = EScrollResult.SOME_TOP;\r\n        }\r\n        else {\r\n            //console.log(`do added: ${last - visibleLast + 1} removed: ${first - visibleFirst + 1} ${first}:${last} ${offset}`);\r\n            //some last rows missing and some first rows to much\r\n            var toRemove = first - 1 - visible.first;\r\n            if (toRemove >= this.options.batchSize) {\r\n                torecycle = this.removeFromBeginning(visible.first, first - 1, false);\r\n            }\r\n            else {\r\n                first = visible.first;\r\n                firstRowPos = this.visibleFirstRowPos;\r\n            }\r\n            last = this.shiftLast(last, last - visible.last + 1);\r\n            toadd = this.addAtBottom(visible.last + 1, last, false);\r\n            toaddBottom = true;\r\n            r = EScrollResult.SOME_BOTTOM;\r\n        }\r\n        visible.first = first;\r\n        visible.last = last;\r\n        this.updateOffset(firstRowPos);\r\n        this.manipulate(torecycle, toadd, toaddBottom);\r\n        return r;\r\n    };\r\n    ARowRenderer.prototype.manipulate = function (toRecycle, toAdd, bottom) {\r\n        if (toRecycle) {\r\n            for (var _i = 0, toRecycle_1 = toRecycle; _i < toRecycle_1.length; _i++) {\r\n                var item = toRecycle_1[_i];\r\n                item.remove();\r\n                this.recycle(item);\r\n            }\r\n        }\r\n        if (!toAdd) {\r\n            return;\r\n        }\r\n        if (bottom) {\r\n            this.body.appendChild(toAdd);\r\n        }\r\n        else {\r\n            this.body.insertBefore(toAdd, this.body.firstChild);\r\n        }\r\n    };\r\n    return ARowRenderer;\r\n}());\r\nexport { ARowRenderer };\r\nexport default ARowRenderer;\r\nexport function setTransform(elem, x, y) {\r\n    var text = \"translate(\" + x + \"px, \" + y + \"px)\";\r\n    var anyelem = elem;\r\n    if (anyelem.__transform__ === text) {\r\n        return;\r\n    }\r\n    anyelem.__transform__ = elem.style.transform = text;\r\n}\r\n//# sourceMappingURL=ARowRenderer.js.map","// import manually import './style.scss';\r\nfunction assignStyles(target, source) {\r\n    for (var _i = 0, _a = Object.keys(source); _i < _a.length; _i++) {\r\n        var key = _a[_i];\r\n        var v = source[key];\r\n        if (!v.endsWith(' !important')) {\r\n            if (target[key] !== v) {\r\n                target[key] = v;\r\n            }\r\n            continue;\r\n        }\r\n        // handle special important case\r\n        var plain = v.slice(0, -' !important'.length);\r\n        if (target[key] === plain) {\r\n            continue;\r\n        }\r\n        target[key] = plain;\r\n        // see https://gist.github.com/youssman/745578062609e8acac9f\r\n        var hyphen = key.replace(/([a-zA-Z])(?=[A-Z])/g, '$1-').toLowerCase();\r\n        target.setProperty(hyphen, plain, 'important');\r\n    }\r\n}\r\nvar StyleManager = /** @class */ (function () {\r\n    /**\r\n     * the parent element to append this managed style\r\n     * @param {HTMLElement} root\r\n     */\r\n    function StyleManager(root) {\r\n        this.rules = [];\r\n        this.testVerifyTimeout = -1;\r\n        this.node = root.ownerDocument.createElement('style');\r\n        this.node.appendChild(root.ownerDocument.createTextNode('')); // for webkit?\r\n        root.appendChild(this.node);\r\n    }\r\n    StyleManager.prototype.destroy = function () {\r\n        this.node.remove();\r\n    };\r\n    StyleManager.prototype.verifySheet = function () {\r\n        var _this = this;\r\n        var sheet = this.sheet;\r\n        if (!sheet) {\r\n            if (this.testVerifyTimeout >= 0) {\r\n                return;\r\n            }\r\n            // test till attached\r\n            this.testVerifyTimeout = self.setTimeout(function () {\r\n                _this.testVerifyTimeout = -1;\r\n                _this.verifySheet();\r\n            }, 20);\r\n            return;\r\n        }\r\n        var rules = sheet.cssRules;\r\n        if (rules.length === this.rules.length && this.rules.every(function (d, i) { return rules[i].selectorText === d.selector; })) {\r\n            // same\r\n            return;\r\n        }\r\n        console.warn('invalid sheet rules detected');\r\n        var l = rules.length;\r\n        for (var i = 0; i < l; ++i) {\r\n            sheet.deleteRule(i);\r\n        }\r\n        // create all\r\n        for (var _i = 0, _a = this.rules; _i < _a.length; _i++) {\r\n            var rule = _a[_i];\r\n            var index = sheet.insertRule(rule.selector + \" {}\", sheet.cssRules.length);\r\n            var cssRule = sheet.cssRules[index];\r\n            rule.selector = cssRule.selectorText;\r\n            assignStyles(cssRule.style, rule.style);\r\n        }\r\n    };\r\n    Object.defineProperty(StyleManager.prototype, \"sheet\", {\r\n        get: function () {\r\n            return this.node.sheet;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    StyleManager.prototype.getSheetRule = function (index) {\r\n        var sheet = this.sheet;\r\n        return sheet ? sheet.cssRules[index] : null;\r\n    };\r\n    /**\r\n     * add a custom css rule\r\n     * @param {string} id unique id of the rule for later identification\r\n     * @param {string} selector the css selector\r\n     * @param {Partial<CSSStyleDeclaration>} style the style attributes\r\n     * @returns {string} the id again\r\n     */\r\n    StyleManager.prototype.addRule = function (id, selector, style) {\r\n        this.verifySheet();\r\n        var sheet = this.sheet;\r\n        if (!sheet) {\r\n            // upon next update\r\n            this.rules.push({ id: id, selector: selector, style: style });\r\n            return;\r\n        }\r\n        var index = sheet.insertRule(selector + \" {}\", sheet.cssRules.length);\r\n        var rule = sheet.cssRules[index];\r\n        this.rules.push({ id: id, selector: rule.selectorText, style: style });\r\n        assignStyles(rule.style, style);\r\n        return id;\r\n    };\r\n    /**\r\n     * updates or add a rule, see @addRule\r\n     * @param {string} id unique id of the rule for later identification\r\n     * @param {string} selector the css selector\r\n     * @param {Partial<CSSStyleDeclaration>} style the style attributes\r\n     * @returns {string} the id again\r\n     */\r\n    StyleManager.prototype.updateRule = function (id, selector, style) {\r\n        this.verifySheet();\r\n        var index = this.rules.findIndex(function (d) { return d.id === id; });\r\n        if (index < 0) {\r\n            return this.addRule(id, selector, style);\r\n        }\r\n        var stored = this.rules[index];\r\n        stored.selector = selector;\r\n        stored.style = style;\r\n        var rule = this.getSheetRule(index);\r\n        if (rule) {\r\n            if (rule.selectorText.replace(/\\s/gm, '') !== selector.replace(/\\s/gm, '')) { //ignoring white space\r\n                rule.selectorText = selector;\r\n                stored.selector = rule.selectorText;\r\n            }\r\n            assignStyles(rule.style, style);\r\n        }\r\n        return id;\r\n    };\r\n    /**\r\n     * deletes the given rule by id\r\n     * @param {string} id the rule to delete\r\n     */\r\n    StyleManager.prototype.deleteRule = function (id) {\r\n        this.verifySheet();\r\n        var index = this.rules.findIndex(function (d) { return d.id === id; });\r\n        if (index < 0) {\r\n            return;\r\n        }\r\n        this.rules.splice(index, 1);\r\n        var sheet = this.sheet;\r\n        if (sheet) {\r\n            sheet.deleteRule(index);\r\n        }\r\n    };\r\n    Object.defineProperty(StyleManager.prototype, \"ruleNames\", {\r\n        /**\r\n         * get a list of all registered rule ids\r\n         * @returns {string[]}\r\n         */\r\n        get: function () {\r\n            return this.rules.map(function (d) { return d.id; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return StyleManager;\r\n}());\r\nexport default StyleManager;\r\n//# sourceMappingURL=StyleManager.js.map","import * as tslib_1 from \"tslib\";\r\nimport { addScroll } from '../internal';\r\nimport { cssClass, CSS_CLASS_BODY, CSS_CLASS_FOOTER, CSS_CLASS_HEADER, CSS_CLASS_SCROLLBAR_TESTER, CSS_CLASS_SHIFTED, CSS_CLASS_TBODY, CSS_CLASS_THEAD } from '../styles';\r\nimport StyleManager from './StyleManager';\r\nexport function setTemplate(root, id) {\r\n    id = id.startsWith('#') ? id.slice(1) : id;\r\n    root.innerHTML = \"\\n  <header id=\\\"header-\" + id + \"\\\" class=\\\"\" + CSS_CLASS_HEADER + \" \" + cssClass(\"header-\" + id) + \"\\\">\\n    <article class=\\\"\" + CSS_CLASS_THEAD + \" \" + cssClass(\"thead-\" + id) + \"\\\"></article>\\n  </header>\\n  <main id=\\\"body-\" + id + \"\\\" class=\\\"\" + CSS_CLASS_BODY + \" \" + cssClass(\"body-\" + id) + \"\\\">\\n    <footer class=\\\"\" + CSS_CLASS_FOOTER + \"\\\">&nbsp;</footer>\\n    <article class=\\\"\" + CSS_CLASS_TBODY + \" \" + cssClass(\"tbody-\" + id) + \"\\\"></article>\\n  </main>\";\r\n    return root;\r\n}\r\n/**\r\n * generates the HTML Ids used for the header and body article of a table\r\n * @param {string} tableId base table id\r\n * @param {boolean} asSelector flag whether to prepend with # for CSS selector\r\n * @return {ISelectors} the table ids used for header and body\r\n */\r\nexport function tableIds(tableId) {\r\n    return {\r\n        thead: \"thead-\" + tableId,\r\n        tbody: \"tbody-\" + tableId,\r\n        tr: \"tr-\" + tableId,\r\n        th: \"th-\" + tableId,\r\n        td: \"td-\" + tableId\r\n    };\r\n}\r\nexport function tableCSSClasses(tableId) {\r\n    var ids = tableIds(tableId);\r\n    return {\r\n        thead: cssClass(ids.thead),\r\n        tbody: cssClass(ids.tbody),\r\n        tr: cssClass(ids.tr),\r\n        th: cssClass(ids.th),\r\n        td: cssClass(ids.td)\r\n    };\r\n}\r\n/**\r\n * utility for custom generated CSS rules with a focus on dynamically generated grid layouts\r\n */\r\nvar GridStyleManager = /** @class */ (function (_super) {\r\n    tslib_1.__extends(GridStyleManager, _super);\r\n    function GridStyleManager(root, id) {\r\n        var _this = _super.call(this, root) || this;\r\n        _this.id = id.startsWith('#') ? id.slice(1) : id;\r\n        _this.ids = tableIds(_this.id);\r\n        _this.cssClasses = tableCSSClasses(_this.id);\r\n        var headerScroller = root.getElementsByTagName('header')[0];\r\n        var bodyScroller = root.getElementsByTagName('main')[0];\r\n        // async since style needs to be added to dom first\r\n        self.setTimeout(function () {\r\n            var width = measureScrollbar(root).width;\r\n            _this.updateRule('__scollBarFix2', \"#header-\" + _this.id + \" > article:last-of-type\", {\r\n                borderRight: width + \"px solid transparent\"\r\n            });\r\n        }, 20);\r\n        var old = headerScroller.scrollLeft;\r\n        // update frozen and sync header with body\r\n        addScroll(bodyScroller, 'animation', function (act) {\r\n            var newValue = act.left;\r\n            if (old !== newValue) {\r\n                old = headerScroller.scrollLeft = newValue;\r\n            }\r\n            root.classList.toggle(CSS_CLASS_SHIFTED, act.left > 0);\r\n        });\r\n        return _this;\r\n    }\r\n    /**\r\n     * updates the column widths and default row height for a table\r\n     * @param {number} defaultRowHeight\r\n     * @param {IColumn[]} columns\r\n     * @param {number} frozenShift shift frozen colums\r\n     * @param {string} tableId optional tableId in case of multiple tables within the same engine\r\n     * @param {string} unit\r\n     */\r\n    GridStyleManager.prototype.update = function (defaultRowHeight, columns, padding, frozenShift, tableId, unit) {\r\n        if (unit === void 0) { unit = 'px'; }\r\n        var ids = tableIds(tableId);\r\n        var selectors = tableCSSClasses(tableId);\r\n        var total = \"\" + columns.reduce(function (a, b, i) { return a + b.width + padding(i); }, 0) + unit;\r\n        this.updateRule(\"__heightsRule\" + selectors.tr, \".\" + selectors.tr, {\r\n            height: defaultRowHeight + \"px\",\r\n            width: total\r\n        });\r\n        this.updateRule(\"__heightsRule\" + selectors.tbody, \"#\" + ids.tbody, {\r\n            width: total\r\n        });\r\n        this.updateColumns(columns, padding, selectors, frozenShift, unit);\r\n    };\r\n    /**\r\n     * removes a given tableId if not needed anymore\r\n     * @param {string} tableId tableId to remove\r\n     */\r\n    GridStyleManager.prototype.remove = function (tableId) {\r\n        var selectors = tableCSSClasses(tableId);\r\n        this.deleteRule(\"__heightsRule\" + selectors.tr);\r\n        this.deleteRule(\"__heightsRule\" + selectors.tbody);\r\n        var prefix = \"__col\" + selectors.td + \"_\";\r\n        var rules = this.ruleNames.reduce(function (a, b) { return a + (b.startsWith(prefix) ? 1 : 0); }, 0);\r\n        // reset\r\n        for (var i = 0; i < rules; ++i) {\r\n            this.deleteRule(\"\" + prefix + i);\r\n        }\r\n    };\r\n    GridStyleManager.prototype.updateColumns = function (columns, padding, cssSelectors, frozenShift, unit) {\r\n        var _this = this;\r\n        if (unit === void 0) { unit = 'px'; }\r\n        var prefix = \"__col\" + cssSelectors.td + \"_\";\r\n        var rules = new Set(this.ruleNames.filter(function (d) { return d.startsWith(prefix); }));\r\n        var acc = 0;\r\n        columns.forEach(function (c, i) {\r\n            var th = \".\" + cssSelectors.th + \"[data-id=\\\"\" + c.id + \"\\\"]\";\r\n            var thStyles = {\r\n                width: \"\" + c.width + unit\r\n            };\r\n            var td = \".\" + cssSelectors.td + \"[data-id=\\\"\" + c.id + \"\\\"]\";\r\n            var tdStyles = {\r\n                transform: \"translateX(\" + acc + unit + \")\",\r\n                width: \"\" + c.width + unit\r\n            };\r\n            if (c.frozen) {\r\n                thStyles.left = acc + \"px\";\r\n                _this.updateRule(\"\" + prefix + td + \"F\", \".\" + cssSelectors.td + \".\" + CSS_CLASS_SHIFTED + \"[data-id=\\\"\" + c.id + \"\\\"]\", {\r\n                    transform: \"translateX(0)\",\r\n                    left: \"\" + (acc + frozenShift) + unit\r\n                });\r\n                rules.delete(\"\" + prefix + td + \"F\");\r\n            }\r\n            _this.updateRule(\"\" + prefix + th, th, thStyles);\r\n            rules.delete(\"\" + prefix + th);\r\n            _this.updateRule(\"\" + prefix + td, td, tdStyles);\r\n            rules.delete(\"\" + prefix + td);\r\n            acc += c.width + padding(i);\r\n        });\r\n        rules.forEach(function (d) { return _this.deleteRule(d); });\r\n    };\r\n    return GridStyleManager;\r\n}(StyleManager));\r\nexport default GridStyleManager;\r\n/**\r\n * measure the width and height of the scrollbars\r\n * based on Slick grid implementation\r\n * @param root\r\n */\r\nfunction measureScrollbar(root) {\r\n    var body = root.ownerDocument.body;\r\n    body.insertAdjacentHTML('beforeend', \"\\n    <div class=\\\"\" + CSS_CLASS_SCROLLBAR_TESTER + \"\\\"><div></div></div>\\n  \");\r\n    var elem = body.lastElementChild;\r\n    var width = elem.offsetWidth - elem.clientWidth;\r\n    var height = elem.offsetHeight - elem.clientHeight;\r\n    elem.remove();\r\n    return { width: width, height: height };\r\n}\r\n//# sourceMappingURL=GridStyleManager.js.map","import { setTransform } from '../ARowRenderer';\r\nimport { addScroll, defaultMode } from '../internal';\r\nimport { GridStyleManager, tableCSSClasses, tableIds } from '../style';\r\nimport { cssClass, CSS_CLASS_BODY, CSS_CLASS_FOOTER, CSS_CLASS_HEADER, CSS_CLASS_MULTI, CSS_CLASS_TBODY, CSS_CLASS_THEAD } from '../styles';\r\n/**\r\n * manager of multiple columns separated by separators each an own row renderer\r\n */\r\nvar MultiTableRowRenderer = /** @class */ (function () {\r\n    function MultiTableRowRenderer(node, htmlId, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        this.node = node;\r\n        this.tableId = 0;\r\n        this.sections = [];\r\n        this.options = {\r\n            columnPadding: 0,\r\n            async: defaultMode,\r\n            minScrollDelta: 30\r\n        };\r\n        Object.assign(this.options, options);\r\n        htmlId = htmlId.startsWith('#') ? htmlId.slice(1) : htmlId;\r\n        node.id = htmlId;\r\n        node.innerHTML = \"<header id=\\\"header-\" + htmlId + \"\\\" class=\\\"\" + CSS_CLASS_HEADER + \" \" + cssClass(\"header-\" + htmlId) + \"\\\">\\n      <footer class=\\\"\" + CSS_CLASS_FOOTER + \" \" + cssClass(\"footer-\" + htmlId) + \"\\\">&nbsp;</footer>\\n    </header>\\n    <main id=\\\"body-\" + htmlId + \"\\\" class=\\\"\" + CSS_CLASS_BODY + \" \" + cssClass(\"body-\" + htmlId) + \"\\\">\\n      <footer class=\\\"\" + CSS_CLASS_FOOTER + \"\\\">&nbsp;</footer>\\n    </main>\";\r\n        node.classList.add(cssClass(), CSS_CLASS_MULTI, 'lineup-engine');\r\n        this.style = new GridStyleManager(this.node, htmlId);\r\n        var old = addScroll(this.main, this.options.async, function (act) {\r\n            if (Math.abs(old.left - act.left) < _this.options.minScrollDelta && Math.abs(old.width - act.width) < _this.options.minScrollDelta) {\r\n                return;\r\n            }\r\n            var isGoingRight = act.left > old.left;\r\n            old = act;\r\n            _this.onScrolledHorizontally(act.left, act.width, isGoingRight);\r\n        });\r\n    }\r\n    MultiTableRowRenderer.prototype.update = function () {\r\n        var _this = this;\r\n        this.onScrolledHorizontally(this.main.scrollLeft, this.main.clientWidth, false);\r\n        var offset = 0;\r\n        this.sections.forEach(function (s) {\r\n            s.body.style.left = s.header.style.left = offset + \"px\";\r\n            offset += s.width + _this.options.columnPadding;\r\n        });\r\n    };\r\n    MultiTableRowRenderer.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var _this = this;\r\n        var offset = 0;\r\n        var scrollEnd = scrollLeft + clientWidth;\r\n        this.sections.forEach(function (s) {\r\n            var end = offset + s.width;\r\n            if (end < scrollLeft || offset > scrollEnd) {\r\n                s.hide();\r\n            }\r\n            else {\r\n                s.show(Math.max(0, scrollLeft - offset), Math.min(scrollEnd - offset, s.width), isGoingRight);\r\n            }\r\n            offset = end + _this.options.columnPadding;\r\n        });\r\n        this.updateOffset();\r\n    };\r\n    MultiTableRowRenderer.prototype.updateOffset = function () {\r\n        var _this = this;\r\n        var headerFooter = this.header.getElementsByTagName('footer')[0];\r\n        var bodyFooter = this.main.getElementsByTagName('footer')[0];\r\n        var maxHeight = Math.max.apply(Math, [0].concat(this.sections.map(function (d) { return d.height; })));\r\n        var total = this.sections.reduce(function (a, c) { return a + c.width + _this.options.columnPadding; }, 0);\r\n        setTransform(headerFooter, total, 0);\r\n        setTransform(bodyFooter, total, maxHeight);\r\n    };\r\n    MultiTableRowRenderer.prototype.destroy = function () {\r\n        this.sections.forEach(function (d) { return d.destroy(); });\r\n        this.node.remove();\r\n    };\r\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"doc\", {\r\n        get: function () {\r\n            return this.node.ownerDocument;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"header\", {\r\n        get: function () {\r\n            return this.node.getElementsByTagName('header')[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"main\", {\r\n        get: function () {\r\n            return this.node.getElementsByTagName('main')[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * push another table to this instance\r\n     * @param {ITableFactory<T extends ITableSection>} factory factory for the table\r\n     * @param extras additional arguments to provide for the factory\r\n     * @returns {T} the table instance\r\n     */\r\n    MultiTableRowRenderer.prototype.pushTable = function (factory) {\r\n        var extras = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            extras[_i - 1] = arguments[_i];\r\n        }\r\n        var header = this.doc.createElement('article');\r\n        var body = this.doc.createElement('article');\r\n        var tableId = this.node.id + \"T\" + this.tableId++;\r\n        var ids = tableIds(tableId);\r\n        var cssClasses = tableCSSClasses(tableId);\r\n        header.id = ids.thead;\r\n        header.classList.add(CSS_CLASS_THEAD, cssClasses.thead);\r\n        body.id = ids.tbody;\r\n        body.classList.add(CSS_CLASS_TBODY, cssClasses.tbody);\r\n        this.header.insertBefore(header, this.header.lastElementChild); //before the footer\r\n        this.main.appendChild(body);\r\n        var table = factory.apply(void 0, [header, body, tableId, this.style].concat(extras));\r\n        table.init();\r\n        this.sections.push(table);\r\n        this.update();\r\n        return table;\r\n    };\r\n    /**\r\n     * push another separator to the manager\r\n     * @param {ISeparatorFactory<T extends ITableSection>} factory the factory to create the separator\r\n     * @param extras optional additional arguments\r\n     * @returns {T} the new created separator\r\n     */\r\n    MultiTableRowRenderer.prototype.pushSeparator = function (factory) {\r\n        var extras = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            extras[_i - 1] = arguments[_i];\r\n        }\r\n        var header = this.doc.createElement('section');\r\n        var body = this.doc.createElement('section');\r\n        header.classList.add(cssClass('header-separator'));\r\n        body.classList.add(cssClass('separator'));\r\n        this.header.insertBefore(header, this.header.lastElementChild); //before the footer\r\n        this.main.appendChild(body);\r\n        var separator = factory.apply(void 0, [header, body, this.style].concat(extras));\r\n        separator.init();\r\n        this.sections.push(separator);\r\n        this.update();\r\n        return separator;\r\n    };\r\n    /**\r\n     * removes a given table section\r\n     * @param {ITableSection} section section to remove\r\n     * @returns {boolean} successful flag\r\n     */\r\n    MultiTableRowRenderer.prototype.remove = function (section) {\r\n        var index = this.sections.indexOf(section);\r\n        if (index < 0) {\r\n            return false;\r\n        }\r\n        this.sections.splice(index, 1);\r\n        section.destroy();\r\n        this.update();\r\n        return true;\r\n    };\r\n    MultiTableRowRenderer.prototype.clear = function () {\r\n        this.sections.splice(0, this.sections.length).forEach(function (s) { return s.destroy(); });\r\n        this.update();\r\n    };\r\n    /**\r\n     * triggers and update because of a change in width of one or more table sections\r\n     */\r\n    MultiTableRowRenderer.prototype.widthChanged = function () {\r\n        this.update();\r\n    };\r\n    return MultiTableRowRenderer;\r\n}());\r\nexport default MultiTableRowRenderer;\r\n//# sourceMappingURL=MultiTableRowRenderer.js.map","import { range } from '../logic';\r\nimport { EScrollResult } from './IMixin';\r\n/**\r\n * mixin that prefetches rows depending on the scrolling direction for faster rendering\r\n */\r\nvar PrefetchMixin = /** @class */ (function () {\r\n    function PrefetchMixin(adapter, options) {\r\n        this.adapter = adapter;\r\n        this.prefetchTimeout = -1;\r\n        this.cleanupTimeout = -1;\r\n        this.options = {\r\n            prefetchRows: 20,\r\n            cleanUpRows: 10,\r\n            delay: 200\r\n        };\r\n        Object.assign(this.options, options);\r\n        return this;\r\n    }\r\n    PrefetchMixin.prototype.prefetchDown = function () {\r\n        this.prefetchTimeout = -1;\r\n        if (this.adapter.isScrollEventWaiting()) {\r\n            return;\r\n        }\r\n        var context = this.adapter.context;\r\n        var nextLast = Math.min(this.adapter.visible.forcedLast + this.options.prefetchRows, context.numberOfRows - 1);\r\n        // add some rows in advance\r\n        if (this.adapter.visible.last === nextLast && this.adapter.visible.last >= (this.adapter.visible.forcedLast + this.options.prefetchRows)) {\r\n            return;\r\n        }\r\n        this.adapter.addAtBottom(this.adapter.visible.last + 1, nextLast);\r\n        //console.log('prefetch', visibleFirst, visibleLast + 1, '=>', nextLast, ranking.children.length);\r\n        this.adapter.visible.last = nextLast;\r\n    };\r\n    PrefetchMixin.prototype.prefetchUp = function () {\r\n        this.prefetchTimeout = -1;\r\n        if (this.adapter.isScrollEventWaiting() || this.adapter.visible.first <= (this.adapter.visible.forcedFirst - this.options.prefetchRows)) {\r\n            return;\r\n        }\r\n        var context = this.adapter.context;\r\n        var fakeOffset = Math.max(this.adapter.scrollOffset - this.options.prefetchRows * context.defaultRowHeight, 0);\r\n        var height = this.adapter.scrollTotal;\r\n        var _a = range(fakeOffset, height, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, firstRowPos = _a.firstRowPos;\r\n        if (first === this.adapter.visible.first) {\r\n            return;\r\n        }\r\n        var frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(first) : 0;\r\n        this.adapter.addAtBeginning(first, this.adapter.visible.first - 1, frozenShift);\r\n        //console.log('prefetch up ', visibleFirst, '=>', first, visibleLast, ranking.children.length);\r\n        this.adapter.visible.first = first;\r\n        this.adapter.updateOffset(firstRowPos);\r\n    };\r\n    PrefetchMixin.prototype.triggerPrefetch = function (isGoingDown) {\r\n        if (this.prefetchTimeout >= 0) {\r\n            clearTimeout(this.prefetchTimeout);\r\n        }\r\n        var prefetchDownPossible = this.adapter.visible.last < (this.adapter.visible.forcedLast + this.options.prefetchRows);\r\n        var prefetchUpPossible = this.adapter.visible.first > (this.adapter.visible.forcedFirst - this.options.prefetchRows);\r\n        var isLast = this.adapter.visible.last === this.adapter.context.numberOfRows;\r\n        var isFirst = this.adapter.visible.first === 0;\r\n        if ((isGoingDown && !prefetchDownPossible && !isLast) || (!isGoingDown && !prefetchUpPossible && !isFirst)) {\r\n            return;\r\n        }\r\n        // go down if we are already at the top, too\r\n        var op = (isGoingDown || isFirst) ? this.prefetchDown.bind(this) : this.prefetchUp.bind(this);\r\n        this.prefetchTimeout = self.setTimeout(op, this.options.delay);\r\n    };\r\n    PrefetchMixin.prototype.cleanUpTop = function (first) {\r\n        this.cleanupTimeout = -1;\r\n        if (this.adapter.isScrollEventWaiting()) {\r\n            return;\r\n        }\r\n        var newFirst = Math.max(0, first - this.options.cleanUpRows);\r\n        if (newFirst <= this.adapter.visible.first) {\r\n            return;\r\n        }\r\n        //console.log('cleanup top');\r\n        var frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(newFirst) : 0;\r\n        this.adapter.removeFromBeginning(this.adapter.visible.first, newFirst - 1, frozenShift);\r\n        var context = this.adapter.context;\r\n        //console.log('cleanup up ', visibleFirst, '=>', newFirst, visibleLast, ranking.children.length);\r\n        var shift = (newFirst - this.adapter.visible.first) * context.defaultRowHeight;\r\n        if (context.exceptions.length > 0) {\r\n            for (var i = this.adapter.visible.first; i < newFirst; ++i) {\r\n                if (context.exceptionsLookup.has(i)) {\r\n                    shift += context.exceptionsLookup.get(i) - context.defaultRowHeight;\r\n                }\r\n            }\r\n        }\r\n        this.adapter.visible.first = newFirst;\r\n        this.adapter.updateOffset(this.adapter.visibleFirstRowPos + shift);\r\n        this.prefetchDown();\r\n    };\r\n    PrefetchMixin.prototype.cleanUpBottom = function (last) {\r\n        this.cleanupTimeout = -1;\r\n        var newLast = last + this.options.cleanUpRows;\r\n        if (this.adapter.visible.last <= newLast) {\r\n            return;\r\n        }\r\n        //console.log('cleanup bottom');\r\n        this.adapter.removeFromBottom(newLast + 1, this.adapter.visible.last);\r\n        this.adapter.visible.last = newLast;\r\n        this.prefetchUp();\r\n    };\r\n    PrefetchMixin.prototype.triggerCleanUp = function (first, last, isGoingDown) {\r\n        if (this.cleanupTimeout >= 0) {\r\n            clearTimeout(this.cleanupTimeout);\r\n        }\r\n        if ((isGoingDown && (first - this.options.cleanUpRows) <= this.adapter.visible.first) || (!isGoingDown && this.adapter.visible.last <= (last + this.options.cleanUpRows))) {\r\n            return;\r\n        }\r\n        this.cleanupTimeout = self.setTimeout(isGoingDown ? this.cleanUpTop.bind(this) : this.cleanUpBottom.bind(this), this.options.delay, isGoingDown ? first : last);\r\n    };\r\n    PrefetchMixin.prototype.onScrolled = function (isGoingDown, scrollResult) {\r\n        if (this.adapter.isScrollEventWaiting()) {\r\n            return;\r\n        }\r\n        if (scrollResult !== EScrollResult.ALL && this.options.cleanUpRows > 0) {\r\n            this.triggerCleanUp(this.adapter.visible.forcedFirst, this.adapter.visible.forcedLast, isGoingDown);\r\n        }\r\n        if (scrollResult !== EScrollResult.NONE && this.options.prefetchRows > 0) {\r\n            this.triggerPrefetch(isGoingDown);\r\n        }\r\n    };\r\n    return PrefetchMixin;\r\n}());\r\nexport default PrefetchMixin;\r\n//# sourceMappingURL=PrefetchMixin.js.map","import { ABORTED, isAbortAble, isAsyncUpdate } from '../../abortAble';\r\nimport { isLoadingCell } from '../../ARowRenderer';\r\nimport { clear } from '../../internal';\r\nimport { isScrollEventWaiting } from '../../internal/scroll';\r\nimport { range, updateFrozen } from '../../logic';\r\nimport { EScrollResult } from '../../mixin';\r\nimport { cssClass, CSS_CLASS_FROZEN, CSS_CLASS_LOADING, CSS_CLASS_SHIFTED, CSS_CLASS_TD, CSS_CLASS_TH } from '../../styles';\r\nvar debug = false;\r\n/**\r\n * @internal\r\n */\r\nvar ACellAdapter = /** @class */ (function () {\r\n    function ACellAdapter(header, style, tableId) {\r\n        var _this = this;\r\n        var mixinClasses = [];\r\n        for (var _i = 3; _i < arguments.length; _i++) {\r\n            mixinClasses[_i - 3] = arguments[_i];\r\n        }\r\n        this.header = header;\r\n        this.style = style;\r\n        this.tableId = tableId;\r\n        /**\r\n         * pool of cells per column\r\n         * @type {Array}\r\n         */\r\n        this.cellPool = [];\r\n        this.loading = new WeakMap();\r\n        this.visibleColumns = {\r\n            frozen: [],\r\n            first: 0,\r\n            forcedFirst: 0,\r\n            last: -1,\r\n            forcedLast: -1\r\n        };\r\n        this.visibleFirstColumnPos = 0;\r\n        this.horizontallyShifted = false;\r\n        this.columnAdapter = this.createColumnAdapter();\r\n        this.columnMixins = mixinClasses.map(function (mixinClass) { return new mixinClass(_this.columnAdapter); });\r\n        this.columnFragment = header.ownerDocument.createDocumentFragment();\r\n    }\r\n    ACellAdapter.prototype.leftShift = function () {\r\n        var ctx = this.context;\r\n        var frozen = this.visibleColumns.frozen.reduce(function (a, d) { return a + ctx.columns[d].width + ctx.column.padding(d); }, 0);\r\n        return this.visibleFirstColumnPos - frozen;\r\n    };\r\n    Object.defineProperty(ACellAdapter.prototype, \"headerScroller\", {\r\n        get: function () {\r\n            return this.header.parentElement;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ACellAdapter.prototype.addColumnMixin = function (mixinClass, options) {\r\n        this.columnMixins.push(new mixinClass(this.columnAdapter, options));\r\n    };\r\n    ACellAdapter.prototype.createColumnAdapter = function () {\r\n        var _this = this;\r\n        var r = {\r\n            visible: this.visibleColumns,\r\n            addAtBeginning: this.addColumnAtStart.bind(this),\r\n            addAtBottom: this.addColumnAtEnd.bind(this),\r\n            removeFromBeginning: this.removeColumnFromStart.bind(this),\r\n            removeFromBottom: this.removeColumnFromEnd.bind(this),\r\n            updateOffset: this.updateColumnOffset.bind(this),\r\n            scroller: this.headerScroller,\r\n            syncFrozen: this.syncFrozen.bind(this),\r\n            isScrollEventWaiting: function () { return isScrollEventWaiting(_this.headerScroller, 'animation'); }\r\n        };\r\n        Object.defineProperties(r, {\r\n            visibleFirstRowPos: {\r\n                get: function () { return _this.visibleFirstColumnPos; },\r\n                enumerable: true\r\n            },\r\n            context: {\r\n                get: function () { return _this.context.column; },\r\n                enumerable: true\r\n            },\r\n            scrollOffset: {\r\n                get: function () { return _this.lastScrollInfo ? _this.lastScrollInfo.left : 0; },\r\n                enumerable: true\r\n            },\r\n            scrollTotal: {\r\n                get: function () { return _this.lastScrollInfo ? _this.lastScrollInfo.width : _this.headerScroller.clientWidth; },\r\n                enumerable: true\r\n            }\r\n        });\r\n        return r;\r\n    };\r\n    ACellAdapter.prototype.init = function () {\r\n        var _this = this;\r\n        var context = this.context;\r\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\r\n        context.columns.forEach(function () {\r\n            //init pool\r\n            _this.cellPool.push([]);\r\n        });\r\n    };\r\n    ACellAdapter.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var scrollResult = this.onScrolledHorizontallyImpl(scrollLeft, clientWidth);\r\n        for (var _i = 0, _a = this.columnMixins; _i < _a.length; _i++) {\r\n            var mixin = _a[_i];\r\n            mixin.onScrolled(isGoingRight, scrollResult);\r\n        }\r\n        return scrollResult;\r\n    };\r\n    ACellAdapter.prototype.removeColumnFromStart = function (from, to, frozenShift) {\r\n        var _this = this;\r\n        if (frozenShift === void 0) { frozenShift = this.visibleColumns.frozen.length; }\r\n        this.forEachRow(function (row) {\r\n            _this.removeCellFromStart(row, from, to, frozenShift);\r\n        });\r\n        if (debug) {\r\n            this.verifyRows();\r\n        }\r\n    };\r\n    ACellAdapter.prototype.removeCellFromStart = function (row, from, to, frozenShift) {\r\n        for (var i = from; i <= to; ++i) {\r\n            var node = (frozenShift === 0 ? row.firstElementChild : row.children[frozenShift]);\r\n            node.remove();\r\n            this.recycleCell(node, i);\r\n        }\r\n        if (debug) {\r\n            verifyRow(row, -1, this.context.columns);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.removeColumnFromEnd = function (from, to) {\r\n        var _this = this;\r\n        this.forEachRow(function (row) {\r\n            _this.removeCellFromEnd(row, from, to);\r\n        });\r\n        if (debug) {\r\n            this.verifyRows();\r\n        }\r\n    };\r\n    ACellAdapter.prototype.removeCellFromEnd = function (row, from, to) {\r\n        for (var i = to; i >= from; --i) {\r\n            var node = row.lastElementChild;\r\n            node.remove();\r\n            this.recycleCell(node, i);\r\n        }\r\n        if (debug) {\r\n            verifyRow(row, -1, this.context.columns);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.removeFrozenCells = function (row, columnIndices, shift) {\r\n        for (var _i = 0, columnIndices_1 = columnIndices; _i < columnIndices_1.length; _i++) {\r\n            var columnIndex = columnIndices_1[_i];\r\n            var node = row.children[shift];\r\n            node.remove();\r\n            this.recycleCell(node, columnIndex);\r\n        }\r\n        if (debug) {\r\n            verifyRow(row, -1, this.context.columns);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.removeFrozenColumns = function (columnIndices, shift) {\r\n        var _this = this;\r\n        this.forEachRow(function (row) {\r\n            _this.removeFrozenCells(row, columnIndices, shift);\r\n        });\r\n        if (debug) {\r\n            this.verifyRows();\r\n        }\r\n    };\r\n    ACellAdapter.prototype.removeAllColumns = function (includingFrozen) {\r\n        var _this = this;\r\n        this.forEachRow(function (row) {\r\n            _this.removeAllCells(row, includingFrozen);\r\n        });\r\n        if (debug) {\r\n            this.verifyRows();\r\n        }\r\n    };\r\n    ACellAdapter.prototype.removeAllCells = function (row, includingFrozen, shift) {\r\n        var _this = this;\r\n        if (shift === void 0) { shift = this.visibleColumns.first; }\r\n        var arr = Array.from(row.children);\r\n        var frozen = this.visibleColumns.frozen;\r\n        clear(row);\r\n        if (includingFrozen || frozen.length === 0) {\r\n            for (var _i = 0, frozen_1 = frozen; _i < frozen_1.length; _i++) {\r\n                var i = frozen_1[_i];\r\n                this.recycleCell(arr.shift(), i);\r\n            }\r\n        }\r\n        else {\r\n            // have frozen and keep them, so readd them\r\n            for (var _a = 0, frozen_2 = frozen; _a < frozen_2.length; _a++) {\r\n                var _1 = frozen_2[_a];\r\n                row.appendChild(arr.shift());\r\n            }\r\n        }\r\n        arr.forEach(function (item, i) {\r\n            _this.recycleCell(item, i + shift);\r\n        });\r\n        if (debug) {\r\n            verifyRow(row, -1, this.context.columns);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.selectProxyCell = function (row, column, columns) {\r\n        var pool = this.cellPool[column];\r\n        var columnObj = columns[column];\r\n        var item;\r\n        var ready;\r\n        var pooled = pool.pop();\r\n        var r = pooled ? this.updateCell(pooled, row, columnObj) || pooled : this.createCell(this.header.ownerDocument, row, columnObj);\r\n        if (isAsyncUpdate(r)) {\r\n            item = r.item;\r\n            ready = r.ready;\r\n        }\r\n        else {\r\n            item = r;\r\n        }\r\n        if (item !== pooled) {\r\n            item.dataset.id = columnObj.id;\r\n            item.classList.add(CSS_CLASS_TD, this.style.cssClasses.td, cssClass(\"td-\" + this.tableId));\r\n        }\r\n        this.updateShiftedState(item, columnObj);\r\n        return { item: item, ready: ready };\r\n    };\r\n    ACellAdapter.prototype.handleCellReady = function (item, ready, column) {\r\n        var _this = this;\r\n        if (column === void 0) { column = -1; }\r\n        item.classList.add(CSS_CLASS_LOADING);\r\n        var abort = ready;\r\n        //lazy loading\r\n        this.loading.set(item, abort);\r\n        abort.then(function (result) {\r\n            _this.loading.delete(item);\r\n            item.classList.remove(CSS_CLASS_LOADING);\r\n            if (result === ABORTED && column >= 0) {\r\n                //aborted can recycle the real one\r\n                _this.cellPool[column].push(item);\r\n            }\r\n        });\r\n        return item;\r\n    };\r\n    ACellAdapter.prototype.selectCell = function (row, column, columns) {\r\n        var _a = this.selectProxyCell(row, column, columns), item = _a.item, ready = _a.ready;\r\n        if (!isAbortAble(ready)) {\r\n            return item;\r\n        }\r\n        return this.handleCellReady(item, ready, column);\r\n    };\r\n    ACellAdapter.prototype.updateShiftedState = function (node, col) {\r\n        node.classList.toggle(CSS_CLASS_SHIFTED, col.frozen && this.horizontallyShifted);\r\n    };\r\n    ACellAdapter.prototype.recycleCell = function (item, column) {\r\n        if (column === void 0) { column = -1; }\r\n        // check if the dom element is still being manipulated\r\n        if (this.loading.has(item)) {\r\n            var abort = this.loading.get(item);\r\n            abort.abort();\r\n        }\r\n        else if (!isLoadingCell(item) && column >= 0) {\r\n            this.cellPool[column].push(item);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.addColumnAtStart = function (from, to, frozenShift) {\r\n        var _this = this;\r\n        if (frozenShift === void 0) { frozenShift = this.visibleColumns.frozen.length; }\r\n        var columns = this.context.columns;\r\n        this.forEachRow(function (row, rowIndex) {\r\n            _this.addCellAtStart(row, rowIndex, from, to, frozenShift, columns);\r\n        });\r\n        if (debug) {\r\n            this.verifyRows();\r\n        }\r\n    };\r\n    ACellAdapter.prototype.addCellAtStart = function (row, rowIndex, from, to, frozenShift, columns) {\r\n        if (debug) {\r\n            verifyRow(row, rowIndex, this.context.columns);\r\n        }\r\n        for (var i = to; i >= from; --i) {\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            row.insertBefore(cell, frozenShift > 0 ? row.children[frozenShift] : row.firstChild);\r\n        }\r\n        if (debug) {\r\n            verifyRow(row, rowIndex, this.context.columns);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.insertFrozenCells = function (row, rowIndex, columnIndices, shift, columns) {\r\n        var before = row.children[shift];\r\n        for (var _i = 0, columnIndices_2 = columnIndices; _i < columnIndices_2.length; _i++) {\r\n            var i = columnIndices_2[_i];\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            if (before) {\r\n                row.insertBefore(cell, before);\r\n            }\r\n            else {\r\n                row.appendChild(cell);\r\n            }\r\n        }\r\n    };\r\n    ACellAdapter.prototype.insertFrozenColumns = function (columnIndices, shift) {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        this.forEachRow(function (row, rowIndex) {\r\n            _this.insertFrozenCells(row, rowIndex, columnIndices, shift, columns);\r\n        });\r\n    };\r\n    ACellAdapter.prototype.addColumnAtEnd = function (from, to) {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        this.forEachRow(function (row, rowIndex) {\r\n            _this.addCellAtEnd(row, rowIndex, from, to, columns);\r\n        });\r\n        if (debug) {\r\n            this.verifyRows();\r\n        }\r\n    };\r\n    ACellAdapter.prototype.verifyRows = function () {\r\n        var columns = this.context.columns;\r\n        this.forEachRow(function (row, rowIndex) { return verifyRow(row, rowIndex, columns); });\r\n    };\r\n    ACellAdapter.prototype.addCellAtEnd = function (row, rowIndex, from, to, columns) {\r\n        for (var i = from; i <= to; ++i) {\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            row.appendChild(cell);\r\n        }\r\n        if (debug) {\r\n            verifyRow(row, rowIndex, this.context.columns);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.updateHeaders = function () {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        Array.from(this.header.children).forEach(function (node, i) {\r\n            var base = node;\r\n            var col = columns[i];\r\n            var r = _this.updateHeader(base, col);\r\n            var n;\r\n            if (isAsyncUpdate(r)) {\r\n                n = _this.handleCellReady(r.item, r.ready, -1);\r\n            }\r\n            else {\r\n                n = r || base;\r\n            }\r\n            if (n === base) {\r\n                return;\r\n            }\r\n            n.dataset.id = col.id;\r\n            n.classList.add(CSS_CLASS_TH, _this.style.cssClasses.th, cssClass(\"th-\" + _this.tableId));\r\n            _this.header.replaceChild(base, n);\r\n        });\r\n    };\r\n    ACellAdapter.prototype.recreate = function (left, width) {\r\n        var _this = this;\r\n        var context = this.context;\r\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, -this.leftShift(), this.tableId);\r\n        this.clearPool();\r\n        // init pool\r\n        for (var i = this.cellPool.length; i < context.columns.length; ++i) {\r\n            this.cellPool.push([]);\r\n        }\r\n        //create all header columns\r\n        {\r\n            var fragment_1 = this.columnFragment;\r\n            var document_1 = fragment_1.ownerDocument;\r\n            // create lookup cache to reuse headers\r\n            var ids_1 = new Map();\r\n            while (this.header.lastChild) {\r\n                var c = this.header.lastChild;\r\n                this.header.removeChild(c);\r\n                ids_1.set(c.dataset.id, c);\r\n            }\r\n            context.columns.forEach(function (col) {\r\n                var existing = ids_1.get(col.id);\r\n                var r = existing ? _this.updateHeader(existing, col) || existing : _this.createHeader(document_1, col);\r\n                var n;\r\n                if (isAsyncUpdate(r)) {\r\n                    n = _this.handleCellReady(r.item, r.ready, -1);\r\n                }\r\n                else {\r\n                    n = r;\r\n                }\r\n                if (n !== existing) {\r\n                    n.dataset.id = col.id;\r\n                    n.classList.add(CSS_CLASS_TH, _this.style.cssClasses.th, cssClass(\"th-\" + _this.tableId));\r\n                }\r\n                fragment_1.appendChild(n);\r\n            });\r\n            this.header.appendChild(fragment_1);\r\n        }\r\n        var _a = range(left, width, context.column.defaultRowHeight, context.column.exceptions, context.column.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\r\n        this.visibleColumns.first = this.visibleColumns.forcedFirst = first;\r\n        this.visibleColumns.last = this.visibleColumns.forcedLast = last;\r\n        if (context.columns.some(function (c) { return c.frozen; })) {\r\n            var target = updateFrozen([], context.columns, first).target;\r\n            this.visibleColumns.frozen = target;\r\n        }\r\n        else {\r\n            this.visibleColumns.frozen = [];\r\n        }\r\n        this.updateColumnOffset(firstRowPos);\r\n    };\r\n    ACellAdapter.prototype.clearPool = function () {\r\n        this.cellPool.forEach(function (p) { return p.splice(0, p.length); });\r\n    };\r\n    ACellAdapter.prototype.updateColumnOffset = function (firstColumnPos) {\r\n        var changed = firstColumnPos !== this.visibleFirstColumnPos;\r\n        this.visibleFirstColumnPos = firstColumnPos;\r\n        if (changed) {\r\n            var context = this.context;\r\n            this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, -this.leftShift(), this.tableId);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.createRow = function (node, rowIndex) {\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        if (visible.frozen.length > 0) {\r\n            for (var _i = 0, _a = visible.frozen; _i < _a.length; _i++) {\r\n                var i = _a[_i];\r\n                var cell = this.selectCell(rowIndex, i, columns);\r\n                node.appendChild(cell);\r\n            }\r\n        }\r\n        for (var i = visible.first; i <= visible.last; ++i) {\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            node.appendChild(cell);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.updateRow = function (node, rowIndex) {\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        //columns may not match anymore if it is a pooled item a long time ago\r\n        switch (node.childElementCount) {\r\n            case 0:\r\n                if (visible.frozen.length > 0) {\r\n                    this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\r\n                }\r\n                this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\r\n                break;\r\n            case 1:\r\n                var old = node.firstElementChild;\r\n                var id_1 = old.dataset.id;\r\n                var columnIndex = columns.findIndex(function (c) { return c.id === id_1; });\r\n                node.removeChild(old);\r\n                if (columnIndex >= 0) {\r\n                    this.recycleCell(old, columnIndex);\r\n                }\r\n                if (visible.frozen.length > 0) {\r\n                    this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\r\n                }\r\n                this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\r\n                break;\r\n            default:\r\n                this.mergeColumns(node, rowIndex);\r\n                break;\r\n        }\r\n    };\r\n    ACellAdapter.prototype.mergeColumns = function (node, rowIndex) {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        var ids = new Map();\r\n        while (node.lastChild) {\r\n            var c = node.lastChild;\r\n            node.removeChild(c);\r\n            ids.set(c.dataset.id, c);\r\n        }\r\n        var updateImpl = function (i) {\r\n            var col = columns[i];\r\n            var existing = ids.get(col.id);\r\n            if (!existing) {\r\n                var cell_1 = _this.selectCell(rowIndex, i, columns);\r\n                node.appendChild(cell_1);\r\n                return;\r\n            }\r\n            ids.delete(col.id);\r\n            var r = _this.updateCell(existing, rowIndex, col) || existing;\r\n            var cell;\r\n            if (isAsyncUpdate(r)) {\r\n                cell = _this.handleCellReady(r.item, r.ready, i);\r\n            }\r\n            else {\r\n                cell = r;\r\n            }\r\n            if (cell && cell !== existing) {\r\n                cell.dataset.id = col.id;\r\n                cell.classList.add(CSS_CLASS_TD, _this.style.cssClasses.td, cssClass(\"td-\" + _this.tableId));\r\n            }\r\n            _this.updateShiftedState(cell, col);\r\n            node.appendChild(cell);\r\n        };\r\n        for (var _i = 0, _a = visible.frozen; _i < _a.length; _i++) {\r\n            var frozen = _a[_i];\r\n            updateImpl(frozen);\r\n        }\r\n        for (var i = visible.first; i <= visible.last; ++i) {\r\n            updateImpl(i);\r\n        }\r\n        if (ids.size === 0) {\r\n            return;\r\n        }\r\n        // recycle\r\n        var byId = new Map(columns.map(function (d, i) { return [d.id, i]; }));\r\n        ids.forEach(function (node, key) {\r\n            var index = byId.get(key);\r\n            if (index != null && index >= 0) {\r\n                _this.recycleCell(node, index);\r\n            }\r\n        });\r\n    };\r\n    ACellAdapter.prototype.updateShiftedStates = function () {\r\n        if (!this.context.columns.some(function (d) { return d.frozen; })) {\r\n            return;\r\n        }\r\n        var shifted = this.horizontallyShifted;\r\n        var clazz = CSS_CLASS_SHIFTED;\r\n        if (shifted) {\r\n            var headers = Array.from(this.header.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \":not(.\" + clazz + \")\"));\r\n            var bodies = Array.from(this.body.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \":not(.\" + clazz + \")\"));\r\n            for (var _i = 0, headers_1 = headers; _i < headers_1.length; _i++) {\r\n                var item = headers_1[_i];\r\n                item.classList.add(clazz);\r\n            }\r\n            for (var _a = 0, bodies_1 = bodies; _a < bodies_1.length; _a++) {\r\n                var item = bodies_1[_a];\r\n                item.classList.add(clazz);\r\n            }\r\n        }\r\n        else {\r\n            var headers = Array.from(this.header.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \".\" + clazz));\r\n            var bodies = Array.from(this.body.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \".\" + clazz));\r\n            for (var _b = 0, headers_2 = headers; _b < headers_2.length; _b++) {\r\n                var item = headers_2[_b];\r\n                item.classList.remove(clazz);\r\n            }\r\n            for (var _c = 0, bodies_2 = bodies; _c < bodies_2.length; _c++) {\r\n                var item = bodies_2[_c];\r\n                item.classList.remove(clazz);\r\n            }\r\n        }\r\n    };\r\n    ACellAdapter.prototype.syncFrozen = function (first) {\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        if (!columns.some(function (d) { return d.frozen; })) {\r\n            return 0;\r\n        }\r\n        if (first === 0) {\r\n            if (visible.frozen.length > 0) {\r\n                this.removeFrozenColumns(visible.frozen, 0);\r\n                visible.frozen = [];\r\n            }\r\n            return 0;\r\n        }\r\n        var old = visible.frozen.length;\r\n        var _a = updateFrozen(visible.frozen, columns, first), target = _a.target, added = _a.added, removed = _a.removed;\r\n        if (removed.length > 0) {\r\n            this.removeFrozenColumns(removed, old - removed.length);\r\n        }\r\n        if (added.length > 0) {\r\n            this.insertFrozenColumns(added, old - removed.length);\r\n        }\r\n        visible.frozen = target;\r\n        return target.length;\r\n    };\r\n    ACellAdapter.prototype.onScrolledHorizontallyImpl = function (scrollLeft, clientWidth) {\r\n        var shiftingChanged = this.horizontallyShifted !== scrollLeft > 0;\r\n        this.horizontallyShifted = scrollLeft > 0;\r\n        var column = this.context.column;\r\n        var _a = range(scrollLeft, clientWidth, column.defaultRowHeight, column.exceptions, column.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\r\n        var visible = this.visibleColumns;\r\n        visible.forcedFirst = first;\r\n        visible.forcedLast = last;\r\n        if ((first - visible.first) >= 0 && (last - visible.last) <= 0) {\r\n            //nothing to do\r\n            if (shiftingChanged) {\r\n                this.updateShiftedStates();\r\n            }\r\n            return EScrollResult.NONE;\r\n        }\r\n        var r = EScrollResult.SOME;\r\n        var frozenShift = this.syncFrozen(first);\r\n        if (first > visible.last || last < visible.first) {\r\n            //no overlap, clean and draw everything\r\n            //console.log(`ff added: ${last - first + 1} removed: ${visibleLast - visibleFirst + 1} ${first}:${last} ${offset}`);\r\n            //removeRows(visibleFirst, visibleLast);\r\n            this.removeAllColumns(false);\r\n            this.addColumnAtEnd(first, last);\r\n            r = EScrollResult.ALL;\r\n        }\r\n        else if (first < visible.first) {\r\n            //some first rows missing and some last rows to much\r\n            //console.log(`up added: ${visibleFirst - first + 1} removed: ${visibleLast - last + 1} ${first}:${last} ${offset}`);\r\n            this.removeColumnFromEnd(last + 1, visible.last);\r\n            this.updateShiftedStates();\r\n            this.addColumnAtStart(first, visible.first - 1, frozenShift);\r\n            r = EScrollResult.SOME_TOP;\r\n        }\r\n        else {\r\n            //console.log(`do added: ${last - visibleLast + 1} removed: ${first - visibleFirst + 1} ${first}:${last} ${offset}`);\r\n            //some last rows missing and some first rows to much\r\n            this.removeColumnFromStart(visible.first, first - 1, frozenShift);\r\n            this.updateShiftedStates();\r\n            this.addColumnAtEnd(visible.last + 1, last);\r\n            r = EScrollResult.SOME_BOTTOM;\r\n        }\r\n        visible.first = first;\r\n        visible.last = last;\r\n        this.updateColumnOffset(firstRowPos);\r\n        return r;\r\n    };\r\n    return ACellAdapter;\r\n}());\r\nexport { ACellAdapter };\r\n/**\r\n * @internal\r\n */\r\nexport default ACellAdapter;\r\nfunction verifyRow(row, index, columns) {\r\n    var cols = Array.from(row.children);\r\n    //sort incrementally\r\n    if (cols.length <= 1) {\r\n        return;\r\n    }\r\n    var colObjs = cols.map(function (c) { return columns.find(function (d) { return d.id === c.dataset.id; }); });\r\n    console.assert(colObjs.every(function (d) { return Boolean(d); }), 'all columns must exist', index);\r\n    console.assert(colObjs.every(function (d, i) { return i === 0 || d.index >= colObjs[i - 1].index; }), 'all columns in ascending order', index);\r\n    console.assert((new Set(colObjs)).size === colObjs.length, 'unique columns', colObjs);\r\n}\r\n//# sourceMappingURL=ACellAdapter.js.map","import * as tslib_1 from \"tslib\";\r\nimport ARowRenderer, { setTransform } from '../ARowRenderer';\r\nimport { EScrollResult } from '../mixin';\r\nimport { CSS_CLASS_HIDDEN, CSS_CLASS_LOADING } from '../styles';\r\nimport ACellAdapter from './internal/ACellAdapter';\r\n/**\r\n * base class for a cell renderer as table section\r\n */\r\nvar ACellTableSection = /** @class */ (function (_super) {\r\n    tslib_1.__extends(ACellTableSection, _super);\r\n    function ACellTableSection(header, body, tableId, style, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = _super.call(this, body, options) || this;\r\n        _this.header = header;\r\n        _this.body = body;\r\n        _this.tableId = tableId;\r\n        _this.style = style;\r\n        var that = _this;\r\n        var LocalCell = /** @class */ (function (_super) {\r\n            tslib_1.__extends(LocalCell, _super);\r\n            function LocalCell() {\r\n                return _super !== null && _super.apply(this, arguments) || this;\r\n            }\r\n            Object.defineProperty(LocalCell.prototype, \"context\", {\r\n                get: function () {\r\n                    return that.context;\r\n                },\r\n                enumerable: true,\r\n                configurable: true\r\n            });\r\n            Object.defineProperty(LocalCell.prototype, \"body\", {\r\n                get: function () {\r\n                    return that.body;\r\n                },\r\n                enumerable: true,\r\n                configurable: true\r\n            });\r\n            Object.defineProperty(LocalCell.prototype, \"lastScrollInfo\", {\r\n                get: function () {\r\n                    return that.lastScrollInfo;\r\n                },\r\n                enumerable: true,\r\n                configurable: true\r\n            });\r\n            LocalCell.prototype.createHeader = function (document, column) {\r\n                return that.createHeader(document, column);\r\n            };\r\n            LocalCell.prototype.updateHeader = function (node, column) {\r\n                return that.updateHeader(node, column);\r\n            };\r\n            LocalCell.prototype.createCell = function (document, index, column) {\r\n                return that.createCell(document, index, column);\r\n            };\r\n            LocalCell.prototype.updateColumnOffset = function (firstColumnPos) {\r\n                _super.prototype.updateColumnOffset.call(this, firstColumnPos);\r\n                that.updateOffset(that.visibleFirstRowPos);\r\n            };\r\n            LocalCell.prototype.updateCell = function (node, index, column) {\r\n                return that.updateCell(node, index, column);\r\n            };\r\n            LocalCell.prototype.forEachRow = function (callback) {\r\n                return that.forEachRow(callback);\r\n            };\r\n            return LocalCell;\r\n        }(ACellAdapter));\r\n        _this.cell = new (LocalCell.bind.apply(LocalCell, [void 0, _this.header, _this.style, tableId].concat((options.mixins || []))))();\r\n        return _this;\r\n    }\r\n    ACellTableSection.prototype.addColumnMixin = function (mixinClass, options) {\r\n        this.cell.addColumnMixin(mixinClass, options);\r\n    };\r\n    Object.defineProperty(ACellTableSection.prototype, \"idPrefix\", {\r\n        get: function () {\r\n            return this.tableId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"width\", {\r\n        get: function () {\r\n            return this.context.column.totalHeight;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"visibleColumns\", {\r\n        get: function () {\r\n            return this.cell.visibleColumns;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"visibleFirstColumnPos\", {\r\n        get: function () {\r\n            return this.cell.visibleFirstColumnPos;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"height\", {\r\n        get: function () {\r\n            return this.context.totalHeight;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"hidden\", {\r\n        get: function () {\r\n            return this.header.classList.contains(CSS_CLASS_LOADING);\r\n        },\r\n        set: function (value) {\r\n            var old = this.hidden;\r\n            if (old === value) {\r\n                return;\r\n            }\r\n            this.header.classList.toggle(CSS_CLASS_LOADING, value);\r\n            this.body.classList.toggle(CSS_CLASS_LOADING, value);\r\n            this.header.classList.toggle(CSS_CLASS_HIDDEN, value);\r\n            this.body.classList.toggle(CSS_CLASS_HIDDEN, value);\r\n            this.onVisibilityChanged(!value);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ACellTableSection.prototype.updateSizer = function (firstRowPos) {\r\n        this.updateShifts(firstRowPos, this.cell.leftShift());\r\n        // no sizer update since centrally managed\r\n    };\r\n    ACellTableSection.prototype.updateShifts = function (top, _left) {\r\n        setTransform(this.body, 0 /*left.toFixed(0)*/, top.toFixed(0));\r\n    };\r\n    /**\r\n     * hook when the visibility changes\r\n     * @param {boolean} _visible current visibility\r\n     */\r\n    ACellTableSection.prototype.onVisibilityChanged = function (_visible) {\r\n        // hook\r\n    };\r\n    ACellTableSection.prototype.hide = function () {\r\n        this.hidden = true;\r\n    };\r\n    ACellTableSection.prototype.show = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var wasHidden = this.hidden;\r\n        this.hidden = false;\r\n        if (wasHidden) { // full update\r\n            this.revalidate();\r\n        }\r\n        else {\r\n            this.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\r\n        }\r\n    };\r\n    ACellTableSection.prototype.init = function () {\r\n        this.hide(); // hide by default\r\n        this.cell.init();\r\n        _super.prototype.init.call(this);\r\n    };\r\n    ACellTableSection.prototype.destroy = function () {\r\n        _super.prototype.destroy.call(this);\r\n        this.header.remove();\r\n        this.style.remove(this.tableId);\r\n    };\r\n    ACellTableSection.prototype.onScrolledVertically = function (scrollTop, clientHeight, isGoingDown) {\r\n        if (this.hidden) {\r\n            return EScrollResult.NONE;\r\n        }\r\n        return _super.prototype.onScrolledVertically.call(this, scrollTop, clientHeight, isGoingDown);\r\n    };\r\n    ACellTableSection.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var r = this.cell.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\r\n        this.updateSizer(this.visibleFirstRowPos);\r\n        return r;\r\n    };\r\n    /**\r\n     * triggers updating the header\r\n     */\r\n    ACellTableSection.prototype.updateHeaders = function () {\r\n        this.cell.updateHeaders();\r\n    };\r\n    ACellTableSection.prototype.handleCellReady = function (item, ready, column) {\r\n        if (column === void 0) { column = -1; }\r\n        return this.cell.handleCellReady(item, ready, column);\r\n    };\r\n    ACellTableSection.prototype.recycleCell = function (item, column) {\r\n        if (column === void 0) { column = -1; }\r\n        this.cell.recycleCell(item, column);\r\n    };\r\n    /**\r\n     * trigger an update all all column widths\r\n     */\r\n    ACellTableSection.prototype.updateColumnWidths = function () {\r\n        var context = this.context;\r\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, -this.cell.leftShift(), this.tableId);\r\n    };\r\n    ACellTableSection.prototype.recreate = function (ctx) {\r\n        var scroller = this.bodyScroller;\r\n        var oldLeft = scroller.scrollLeft;\r\n        this.cell.recreate(oldLeft, scroller.clientWidth);\r\n        _super.prototype.recreate.call(this, ctx);\r\n        // restore left\r\n        scroller.scrollLeft = oldLeft;\r\n    };\r\n    ACellTableSection.prototype.clearPool = function () {\r\n        _super.prototype.clearPool.call(this);\r\n        this.cell.clearPool();\r\n    };\r\n    ACellTableSection.prototype.createRow = function (node, rowIndex) {\r\n        this.cell.createRow(node, rowIndex);\r\n        node.classList.add(this.style.cssClasses.tr);\r\n    };\r\n    ACellTableSection.prototype.updateRow = function (node, rowIndex) {\r\n        this.cell.updateRow(node, rowIndex);\r\n    };\r\n    return ACellTableSection;\r\n}(ARowRenderer));\r\nexport { ACellTableSection };\r\nexport default ACellTableSection;\r\n//# sourceMappingURL=ACellTableSection.js.map","import {defaultPhases, EAnimationMode, IAnimationContext, IAnimationItem, IExceptionContext, IPhase, KeyFinder} from 'lineupengine';\r\nimport {IGroupData, IGroupItem, isGroup} from '../model';\r\n\r\n/** @internal */\r\nexport interface IGroupLookUp {\r\n  item2groupIndex: Map<number, number>;\r\n  group2firstItemIndex: Map<string, number>;\r\n}\r\n\r\nfunction toGroupLookup(items: (IGroupItem | IGroupData)[]): IGroupLookUp {\r\n  const item2groupIndex = new Map<number, number>();\r\n  const group2firstItemIndex = new Map<string, number>();\r\n  items.forEach((item, i) => {\r\n    if (isGroup(item)) {\r\n      for (let o = 0; o < item.order.length; ++o) {\r\n        item2groupIndex.set(o, i);\r\n      }\r\n    } else if (item.group && item.relativeIndex === 0) {\r\n      group2firstItemIndex.set(item.group.name, i);\r\n    }\r\n  });\r\n  return {item2groupIndex, group2firstItemIndex};\r\n}\r\n\r\nfunction toKey(item: IGroupItem | IGroupData) {\r\n  if (isGroup(item)) {\r\n    return item.name;\r\n  }\r\n  return (<IGroupItem>item).dataIndex.toString();\r\n}\r\n\r\n/** @internal */\r\nexport function lineupAnimation(previous: IExceptionContext, previousData: (IGroupItem | IGroupData)[], currentData: (IGroupItem | IGroupData)[]): IAnimationContext {\r\n\r\n  const previousKey = (index: number) => toKey(previousData[index]);\r\n  const currentKey = (index: number) => toKey(currentData[index]);\r\n\r\n\r\n  const previousGroupCount = previousData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\r\n  const currentGroupCount = currentData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\r\n\r\n  if (previousGroupCount === currentGroupCount) {\r\n    // reorder or filter only\r\n    return {currentKey, previous, previousKey};\r\n  }\r\n\r\n  // try to appear where the group was uncollapsed and vice versa\r\n  let prevHelper: IGroupLookUp;\r\n  const appearPosition = (currentRowIndex: number, previousFinder: KeyFinder, defaultValue: number) => {\r\n    if (!prevHelper) {\r\n      prevHelper = toGroupLookup(previousData);\r\n    }\r\n    const item = currentData[currentRowIndex];\r\n    const referenceIndex = isGroup(item) ? prevHelper.group2firstItemIndex.get(item.name) : prevHelper.item2groupIndex.get(item.dataIndex);\r\n    if (referenceIndex === undefined) {\r\n      return defaultValue;\r\n    }\r\n    const pos = previousFinder.posByKey(previousKey(referenceIndex));\r\n    return pos.pos >= 0 ? pos.pos : defaultValue;\r\n  };\r\n\r\n\r\n  let currHelper: IGroupLookUp;\r\n  const removePosition = (previousRowIndex: number, currentFinder: KeyFinder, defaultValue: number) => {\r\n    if (!currHelper) {\r\n      currHelper = toGroupLookup(currentData);\r\n    }\r\n    const item = previousData[previousRowIndex];\r\n    const referenceIndex = isGroup(item) ? currHelper.group2firstItemIndex.get(item.name) : currHelper.item2groupIndex.get(item.dataIndex);\r\n    if (referenceIndex === undefined) {\r\n      return defaultValue;\r\n    }\r\n    const pos = currentFinder.posByKey(currentKey(referenceIndex));\r\n    return pos.pos >= 0 ? pos.pos : defaultValue;\r\n  };\r\n\r\n  const phases: IPhase[] = [\r\n    Object.assign({}, defaultPhases[0], {\r\n      apply(item: Readonly<IAnimationItem>, previousFinder: KeyFinder) {\r\n        defaultPhases[0].apply(item);\r\n        if (item.mode === EAnimationMode.SHOW) {\r\n          item.node.style.transform = `translate(0, ${appearPosition(item.current.index, previousFinder, item.previous.y) - item.nodeY}px)`;\r\n        }\r\n      }\r\n    }),\r\n    Object.assign({}, defaultPhases[1], {\r\n      apply(item: Readonly<IAnimationItem>, _previousFinder: KeyFinder, currentFinder: KeyFinder) {\r\n        defaultPhases[1].apply(item);\r\n        if (item.mode === EAnimationMode.HIDE) {\r\n          item.node.style.transform = `translate(0, ${removePosition(item.previous.index, currentFinder, item.current.y) - item.nodeY}px)`;\r\n        }\r\n      }\r\n    }),\r\n    defaultPhases[defaultPhases.length - 1]\r\n  ];\r\n\r\n  return {previous, previousKey, currentKey, phases};\r\n}\r\n","import {IColumn, IAbortAblePromise, IAsyncUpdate, isAbortAble} from 'lineupengine';\r\nimport {Column} from '../model';\r\nimport {ICellRenderer, IGroupCellRenderer} from '../renderer';\r\nimport {ISummaryRenderer, IRenderCallback} from '../renderer';\r\nimport {createHeader, updateHeader} from './header';\r\nimport {IRankingContext} from './interfaces';\r\nimport {ILineUpFlags} from '../config';\r\nimport {cssClass, engineCssClass} from '../styles';\r\nimport {isPromiseLike} from '../internal';\r\n\r\nexport interface IRenderers {\r\n  singleId: string;\r\n  single: ICellRenderer;\r\n  groupId: string;\r\n  group: IGroupCellRenderer;\r\n  summaryId: string;\r\n  summary: ISummaryRenderer | null;\r\n  singleTemplate: HTMLElement | null;\r\n  groupTemplate: HTMLElement | null;\r\n  summaryTemplate: HTMLElement | null;\r\n}\r\n\r\nexport default class RenderColumn implements IColumn {\r\n  renderers: IRenderers | null = null;\r\n\r\n  constructor(public readonly c: Column, public index: number, protected ctx: IRankingContext, protected readonly flags: ILineUpFlags) {\r\n\r\n  }\r\n\r\n  get width() {\r\n    return this.c.getWidth();\r\n  }\r\n\r\n  get id() {\r\n    return this.c.id;\r\n  }\r\n\r\n  get frozen() {\r\n    return this.flags.disableFrozenColumns ? false : this.c.frozen;\r\n  }\r\n\r\n  private singleRenderer() {\r\n    if (!this.renderers || !this.renderers.single) {\r\n      return null;\r\n    }\r\n    if (this.renderers.singleTemplate) {\r\n      return <HTMLElement>this.renderers.singleTemplate.cloneNode(true);\r\n    }\r\n    const elem = this.ctx.asElement(this.renderers.single.template);\r\n    elem.classList.add(cssClass(`renderer-${this.renderers.singleId}`), cssClass('detail'));\r\n    elem.dataset.renderer = this.renderers.singleId;\r\n    elem.dataset.group = 'd';\r\n\r\n    this.renderers.singleTemplate = <HTMLElement>elem.cloneNode(true);\r\n    return elem;\r\n  }\r\n\r\n  private groupRenderer() {\r\n    if (!this.renderers || !this.renderers.group) {\r\n      return null;\r\n    }\r\n    if (this.renderers.groupTemplate) {\r\n      return <HTMLElement>this.renderers.groupTemplate.cloneNode(true);\r\n    }\r\n    const elem = this.ctx.asElement(this.renderers.group.template);\r\n    elem.classList.add(cssClass(`renderer-${this.renderers.groupId}`), cssClass('group'));\r\n    elem.dataset.renderer = this.renderers.groupId;\r\n    elem.dataset.group = 'g';\r\n\r\n    this.renderers.groupTemplate = <HTMLElement>elem.cloneNode(true);\r\n    return elem;\r\n  }\r\n\r\n  private summaryRenderer() {\r\n    if (!this.renderers || !this.renderers.summary) {\r\n      return null;\r\n    }\r\n    if (this.renderers.summaryTemplate) {\r\n      return <HTMLElement>this.renderers.summaryTemplate.cloneNode(true);\r\n    }\r\n    const elem = this.ctx.asElement(this.renderers.summary.template);\r\n    elem.classList.add(cssClass('summary'), cssClass('th-summary'), cssClass(`renderer-${this.renderers.summaryId}`));\r\n    elem.dataset.renderer = this.renderers.summaryId;\r\n\r\n    this.renderers.summaryTemplate = <HTMLElement>elem.cloneNode(true);\r\n    return elem;\r\n  }\r\n\r\n  createHeader(): HTMLElement | IAsyncUpdate<HTMLElement> {\r\n    const node = createHeader(this.c, this.ctx, {\r\n      extraPrefix: 'th',\r\n      dragAble: this.flags.advancedUIFeatures,\r\n      mergeDropAble: this.flags.advancedModelFeatures,\r\n      rearrangeAble: this.flags.advancedUIFeatures,\r\n      resizeable: this.flags.advancedUIFeatures\r\n    });\r\n    node.classList.add(cssClass('header'));\r\n    if (!this.flags.disableFrozenColumns) {\r\n      node.classList.toggle(engineCssClass('frozen'), this.frozen);\r\n    }\r\n\r\n    if (this.renderers && this.renderers.summary) {\r\n      const summary = this.summaryRenderer()!;\r\n      node.appendChild(summary);\r\n    }\r\n    return this.updateHeader(node);\r\n  }\r\n\r\n  hasSummaryLine() {\r\n    return Boolean(this.c.getMetaData().summary);\r\n  }\r\n\r\n  updateHeader(node: HTMLElement): HTMLElement | IAsyncUpdate<HTMLElement> {\r\n    updateHeader(node, this.c);\r\n    if (!this.renderers || !this.renderers.summary) {\r\n      return node;\r\n    }\r\n    let summary = <HTMLElement>node.getElementsByClassName(cssClass('summary'))[0]!;\r\n    const oldRenderer = summary.dataset.renderer;\r\n    const currentRenderer = this.renderers.summaryId;\r\n    if (oldRenderer !== currentRenderer) {\r\n      summary.remove();\r\n      summary = this.summaryRenderer()!;\r\n      node.appendChild(summary);\r\n    }\r\n    const ready = this.renderers.summary.update(summary);\r\n    if (ready) {\r\n      return {item: node, ready};\r\n    }\r\n    return node;\r\n  }\r\n\r\n  createCell(index: number): HTMLElement | IAsyncUpdate<HTMLElement> {\r\n    const isGroup = this.ctx.isGroup(index);\r\n    const node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\r\n    return this.updateCell(node, index);\r\n  }\r\n\r\n  updateCell(node: HTMLElement, index: number): HTMLElement | IAsyncUpdate<HTMLElement> {\r\n    if (!this.flags.disableFrozenColumns) {\r\n      node.classList.toggle(engineCssClass('frozen'), this.frozen);\r\n    }\r\n    const isGroup = this.ctx.isGroup(index);\r\n    // assert that we have the template of the right mode\r\n    const oldRenderer = node.dataset.renderer;\r\n    const currentRenderer = isGroup ? this.renderers!.groupId : this.renderers!.singleId;\r\n    const oldGroup = node.dataset.group;\r\n    const currentGroup = (isGroup ? 'g' : 'd');\r\n    if (oldRenderer !== currentRenderer || oldGroup !== currentGroup) {\r\n      node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\r\n    }\r\n    let ready: IAbortAblePromise<void> | void | null;\r\n    if (isGroup) {\r\n      const g = this.ctx.getGroup(index);\r\n      ready = this.renderers!.group.update(node, g);\r\n    } else {\r\n      const r = this.ctx.getRow(index);\r\n      const row = this.ctx.provider.getRow(r.dataIndex);\r\n      if (!isPromiseLike(row)) {\r\n        ready = this.renderers!.single.update(node, row, r.relativeIndex, r.group);\r\n      } else {\r\n        ready = chainAbortAble(row, (row) => this.renderers!.single.update(node, row, r.relativeIndex, r.group));\r\n      }\r\n    }\r\n    if (ready) {\r\n      return {item: node, ready};\r\n    }\r\n    return node;\r\n  }\r\n\r\n  renderCell(ctx: CanvasRenderingContext2D, index: number): boolean | IAbortAblePromise<IRenderCallback> {\r\n    const r = this.ctx.getRow(index);\r\n    const s = this.renderers!.single;\r\n    if (!s.render) {\r\n      return false;\r\n    }\r\n    const row = this.ctx.provider.getRow(r.dataIndex);\r\n    if (!isPromiseLike(row)) {\r\n      return s.render(ctx, row, r.relativeIndex, r.group) || false;\r\n    }\r\n    return chainAbortAble(row, (row) => s.render!(ctx, row, r.relativeIndex, r.group) || false);\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction chainAbortAble<T, U, V>(toWait: Promise<T>, mapper: (value: T) => IAbortAblePromise<U> | V): IAbortAblePromise<U> | V {\r\n  let aborted = false;\r\n  const p: any = new Promise<IAbortAblePromise<U> | null | void>((resolve) => {\r\n    if (aborted) {\r\n      return;\r\n    }\r\n    toWait.then((r) => {\r\n      if (aborted) {\r\n        return;\r\n      }\r\n      const mapped = mapper(r);\r\n      if (isAbortAble(<any>mapped)) {\r\n        p.abort = (<IAbortAblePromise<U>>mapped).abort.bind(mapped);\r\n        return p.then(resolve);\r\n      }\r\n      return resolve(<any>mapped);\r\n    });\r\n  });\r\n\r\n  p.abort = () => {\r\n    aborted = true;\r\n  };\r\n  return p;\r\n}\r\n","import {abortAbleAll, IAbortAblePromise, IAsyncUpdate, isAsyncUpdate, StyleManager} from 'lineupengine';\r\nimport {ILineUpFlags} from '../config';\r\nimport {round} from '../internal';\r\nimport {Column, IMultiLevelColumn} from '../model';\r\nimport {ISummaryRenderer} from '../renderer';\r\nimport {multiLevelGridCSSClass} from '../renderer/utils';\r\nimport {COLUMN_PADDING, cssClass} from '../styles';\r\nimport {createHeader, updateHeader} from './header';\r\nimport {IRankingContext} from './interfaces';\r\nimport RenderColumn from './RenderColumn';\r\n\r\n/** @internal */\r\nexport default class MultiLevelRenderColumn extends RenderColumn {\r\n  private summaries: ISummaryRenderer[] = [];\r\n\r\n  constructor(c: IMultiLevelColumn & Column, index: number, ctx: IRankingContext, flags: ILineUpFlags) {\r\n    super(c, index, ctx, flags);\r\n  }\r\n\r\n  private get mc() {\r\n    return <IMultiLevelColumn & Column>this.c;\r\n  }\r\n\r\n  get width() {\r\n    return this.c.getWidth() + COLUMN_PADDING * this.mc.length;\r\n  }\r\n\r\n  createHeader() {\r\n    const r = super.createHeader();\r\n    const wrapper = this.ctx.document.createElement('div');\r\n    wrapper.classList.add(cssClass('nested'));\r\n    wrapper.classList.add(multiLevelGridCSSClass(this.ctx.idPrefix, this.c));\r\n\r\n    if (isAsyncUpdate(r)) {\r\n      r.item.appendChild(wrapper);\r\n    } else {\r\n      r.appendChild(wrapper);\r\n    }\r\n\r\n    return this.updateNested(wrapper, r);\r\n  }\r\n\r\n  private matchChildren(wrapper: HTMLElement, children: Column[]) {\r\n    function matches(col: Column, i: number) {\r\n      //do both match?\r\n      const n = <HTMLElement>wrapper.children[i];\r\n      return n != null && n.dataset.colId === col.id;\r\n    }\r\n\r\n    if (children.every(matches) && children.length === wrapper.childElementCount) {\r\n      // 1:1 match\r\n      return;\r\n    }\r\n\r\n    const lookup = new Map((<HTMLElement[]>Array.from(wrapper.children)).map((n: HTMLElement, i) =>\r\n      (<[string, {node: HTMLElement, summary: ISummaryRenderer}]>[n.dataset.colId!, {node: n, summary: this.summaries[i]}]))\r\n    );\r\n\r\n    // reset summaries array\r\n    this.summaries = [];\r\n\r\n    children.forEach((cc, i) => {\r\n      const existing = lookup.get(cc.id);\r\n      if (existing) { // reuse existing\r\n        lookup.delete(cc.id);\r\n        const n = existing.node;\r\n        (<any>n.style).gridColumnStart = (i + 1).toString();\r\n        wrapper.appendChild(n);\r\n        this.summaries[i] = existing.summary;\r\n        return;\r\n      }\r\n\r\n      const n = createHeader(cc, this.ctx, {\r\n        extraPrefix: 'th',\r\n        mergeDropAble: false,\r\n        dragAble: this.flags.advancedModelFeatures,\r\n        rearrangeAble: this.flags.advancedModelFeatures,\r\n        resizeable: this.flags.advancedModelFeatures\r\n      });\r\n      n.classList.add(cssClass('header'), cssClass('nested-th'));\r\n      (<any>n.style).gridColumnStart = (i + 1).toString();\r\n      wrapper.appendChild(n);\r\n\r\n      if (!this.renderers || !this.renderers.summary) {\r\n        return;\r\n      }\r\n      const summary = this.ctx.summaryRenderer(cc, false);\r\n      const summaryNode = this.ctx.asElement(summary.template);\r\n      summaryNode.classList.add(cssClass('summary'), cssClass('th-summary'), cssClass(`renderer-${cc.getSummaryRenderer()}`));\r\n      summaryNode.dataset.renderer = cc.getSummaryRenderer();\r\n      n.appendChild(summaryNode);\r\n      this.summaries[i] = summary;\r\n      summary.update(summaryNode);\r\n    });\r\n\r\n    // delete not used ones anymore\r\n    lookup.forEach((v) => v.node.remove());\r\n  }\r\n\r\n  updateHeader(node: HTMLElement) {\r\n    const r = super.updateHeader(node);\r\n    node = isAsyncUpdate(r) ? r.item : r;\r\n    const wrapper = <HTMLElement>node.getElementsByClassName(cssClass('nested'))[0];\r\n    if (!wrapper) {\r\n      return r; // too early\r\n    }\r\n    node.appendChild(wrapper); // ensure the last one\r\n    return this.updateNested(wrapper, r);\r\n  }\r\n\r\n  hasSummaryLine() {\r\n    return super.hasSummaryLine() || this.mc.children.some((c) => Boolean(c.getMetaData().summary));\r\n  }\r\n\r\n  updateWidthRule(style: StyleManager) {\r\n    const mc = this.mc;\r\n    // need this for chrome to work properly\r\n    const widths = mc.children.map((c) => `minmax(0, ${round(c.getWidth())}fr)`);\r\n    const clazz = multiLevelGridCSSClass(this.ctx.idPrefix, this.c);\r\n    style.updateRule(`stacked-${this.c.id}`, `.${clazz}`, <any>{\r\n      display: 'grid',\r\n      gridTemplateColumns: widths.join(' ')\r\n    });\r\n    return clazz;\r\n  }\r\n\r\n  private updateNested(wrapper: HTMLElement, r: HTMLElement | IAsyncUpdate<HTMLElement>) {\r\n    const sub = this.mc.children;\r\n    this.matchChildren(wrapper, sub);\r\n\r\n    const children = <HTMLElement[]>Array.from(wrapper.children);\r\n\r\n    const toWait: IAbortAblePromise<void>[] = [];\r\n    let header: HTMLElement;\r\n    if (isAsyncUpdate(r)) {\r\n      toWait.push(r.ready);\r\n      header = r.item;\r\n    } else {\r\n      header = r;\r\n    }\r\n\r\n    sub.forEach((c, i) => {\r\n      const node = children[i];\r\n      updateHeader(node, c);\r\n\r\n      if (!this.renderers || !this.renderers.summary) {\r\n        return;\r\n      }\r\n      let summary = <HTMLElement>node.getElementsByClassName(cssClass('summary'))[0];\r\n      const oldRenderer = summary.dataset.renderer;\r\n      const currentRenderer = c.getSummaryRenderer();\r\n      if (oldRenderer !== currentRenderer) {\r\n        const renderer = this.ctx.summaryRenderer(c, false);\r\n        summary.remove();\r\n        summary = this.ctx.asElement(renderer.template);\r\n        summary.classList.add(cssClass('summary'), cssClass('th-summary'), cssClass(`renderer-${currentRenderer}`));\r\n        summary.dataset.renderer = currentRenderer;\r\n        this.summaries[i] = renderer;\r\n        node.appendChild(summary);\r\n      }\r\n      const ready = this.summaries[i].update(summary);\r\n      if (ready) {\r\n        toWait.push(ready);\r\n      }\r\n    });\r\n\r\n    if (toWait.length === 0) {\r\n      return header;\r\n    }\r\n    return {\r\n      item: header,\r\n      ready: <IAbortAblePromise<void>>abortAbleAll(toWait)\r\n    };\r\n  }\r\n}\r\n","import {ILineUpFlags} from '../config';\r\nimport {Column, IGroupData, IGroupItem} from '../model';\r\nimport {IDataProvider} from '../provider';\r\nimport {IImposer, IRenderContext, ISummaryRenderer} from '../renderer';\r\nimport DialogManager from './dialogs/DialogManager';\r\nimport {IDialogContext} from './dialogs';\r\n\r\nexport interface IUIOptions {\r\n  /**\r\n   * whether to show this action as a shortcut action\r\n   * @default 'menu'\r\n   */\r\n  mode: 'menu' | 'menu+shortcut' | 'shortcut' | ((col: Column, mode: 'sidePanel' | 'header') => 'menu' | 'menu+shortcut' | 'shortcut');\r\n\r\n  /**\r\n   * order hint for sorting actions\r\n   * @default 50\r\n   */\r\n  order: number;\r\n\r\n  featureLevel: 'basic' | 'advanced';\r\n  featureCategory: 'ranking' | 'model' | 'ui';\r\n}\r\n\r\nexport interface IOnClickHandler {\r\n  (col: Column, evt: MouseEvent, ctx: IRankingHeaderContext, level: number, viaShortcut: boolean): any;\r\n}\r\n\r\nexport interface IToolbarAction {\r\n  title: string;\r\n\r\n  enabled?(col: Column): boolean;\r\n\r\n  onClick: IOnClickHandler;\r\n\r\n  options: Partial<IUIOptions>;\r\n}\r\n\r\nexport interface IToolbarDialogAddonHandler {\r\n  elems: string | (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[];\r\n  reset(): void;\r\n  submit(): boolean | undefined;\r\n  cancel(): void;\r\n}\r\n\r\nexport interface IToolbarDialogAddon {\r\n  title: string;\r\n\r\n  order: number;\r\n\r\n  append(col: Column, node: HTMLElement, dialog: IDialogContext, ctx: IRankingHeaderContext): IToolbarDialogAddonHandler;\r\n}\r\n\r\n\r\nexport interface IRenderInfo {\r\n  type: string;\r\n  label: string;\r\n}\r\n\r\nexport interface IRankingHeaderContextContainer {\r\n  readonly idPrefix: string;\r\n  readonly document: Document;\r\n  readonly provider: IDataProvider;\r\n\r\n  readonly dialogManager: DialogManager;\r\n\r\n  asElement(html: string): HTMLElement;\r\n\r\n  resolveToolbarActions(col: Column, keys: string[]): IToolbarAction[];\r\n  resolveToolbarDialogAddons(col: Column, keys: string[]): IToolbarDialogAddon[];\r\n\r\n  readonly flags: ILineUpFlags;\r\n\r\n  getPossibleRenderer(col: Column): {item: IRenderInfo[], group: IRenderInfo[], summary: IRenderInfo[]};\r\n\r\n  summaryRenderer(co: Column, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\r\n\r\n  readonly caches: {\r\n    toolbar: Map<string, IToolbarAction[]>,\r\n    toolbarAddons: Map<string, IToolbarDialogAddon[]>\r\n  };\r\n}\r\n\r\nexport interface IRankingBodyContext extends IRankingHeaderContextContainer, IRenderContext {\r\n  isGroup(index: number): boolean;\r\n\r\n  getGroup(index: number): IGroupData;\r\n\r\n  getRow(index: number): IGroupItem;\r\n}\r\n\r\nexport declare type IRankingHeaderContext = Readonly<IRankingHeaderContextContainer>;\r\n\r\nexport declare type IRankingContext = Readonly<IRankingBodyContext>;\r\n\r\nexport enum EMode {\r\n  ITEM = 'item',\r\n  BAND = 'band'\r\n}\r\n","import {OrderedSet, AEventDispatcher, IEventListener} from '../internal';\r\nimport {IGroupData, IGroupItem, isGroup} from '../model';\r\nimport {IDataProvider} from '../provider';\r\nimport {cssClass, engineCssClass} from '../styles';\r\nimport {forEachIndices} from '../model/internal';\r\nimport {rangeSelection} from '../provider/utils';\r\n\r\ninterface IPoint {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\ninterface IShift {\r\n  xShift: number;\r\n  yShift: number;\r\n  node: HTMLElement;\r\n}\r\n\r\n/**\r\n * @asMemberOf SelectionManager\r\n * @internal\r\n * @event\r\n */\r\nexport declare function selectRange(from: number, to: number, additional: boolean): void;\r\n\r\n/** @internal */\r\nexport default class SelectionManager extends AEventDispatcher {\r\n  static readonly EVENT_SELECT_RANGE = 'selectRange';\r\n  private static readonly MIN_DISTANCE = 10;\r\n\r\n  private readonly hr: HTMLHRElement;\r\n\r\n  private start: (IPoint & IShift) | null = null;\r\n\r\n  constructor(private readonly ctx: {provider: IDataProvider}, private readonly body: HTMLElement) {\r\n    super();\r\n    const root = body.parentElement!.parentElement!;\r\n    let hr = <HTMLHRElement>root.querySelector('hr');\r\n    if (!hr) {\r\n      hr = root.ownerDocument!.createElement('hr');\r\n      root.appendChild(hr);\r\n    }\r\n    this.hr = hr;\r\n    this.hr.classList.add(cssClass('hr'));\r\n\r\n    const mouseMove = (evt: MouseEvent) => {\r\n      this.showHint(evt);\r\n    };\r\n    const mouseUp = (evt: MouseEvent) => {\r\n      this.body.removeEventListener('mousemove', mouseMove);\r\n      this.body.removeEventListener('mouseup', mouseUp);\r\n      this.body.removeEventListener('mouseleave', mouseUp);\r\n\r\n      if (!this.start) {\r\n        return;\r\n      }\r\n      const row = engineCssClass('tr');\r\n      const startNode = this.start.node.classList.contains(row) ? this.start.node : <HTMLElement>this.start.node.closest(`.${row}`);\r\n      // somehow on firefox the mouseUp will be triggered on the original node\r\n      // thus search the node explicitly\r\n      const end = <HTMLElement>this.body.ownerDocument!.elementFromPoint(evt.clientX, evt.clientY);\r\n      const endNode = end.classList.contains(row) ? end : <HTMLElement>(end.closest(`.${row}`));\r\n      this.start = null;\r\n\r\n      this.body.classList.remove(cssClass('selection-active'));\r\n      this.hr.classList.remove(cssClass('selection-active'));\r\n\r\n      this.select(evt.ctrlKey, startNode, endNode);\r\n    };\r\n\r\n    body.addEventListener('mousedown', (evt) => {\r\n      const r = root.getBoundingClientRect();\r\n      this.start = {x: evt.clientX, y: evt.clientY, xShift: r.left, yShift: r.top, node: <HTMLElement>evt.target};\r\n\r\n      this.body.classList.add(cssClass('selection-active'));\r\n      body.addEventListener('mousemove', mouseMove, {\r\n        passive: true\r\n      });\r\n      body.addEventListener('mouseup', mouseUp, {\r\n        passive: true\r\n      });\r\n      body.addEventListener('mouseleave', mouseUp, {\r\n        passive: true\r\n      });\r\n    }, {\r\n        passive: true\r\n      });\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SelectionManager.EVENT_SELECT_RANGE]);\r\n  }\r\n\r\n  on(type: typeof SelectionManager.EVENT_SELECT_RANGE, listener: typeof selectRange | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  private select(additional: boolean, startNode?: HTMLElement, endNode?: HTMLElement) {\r\n    if (!startNode || !endNode || startNode === endNode) {\r\n      return; // no single\r\n    }\r\n\r\n    const startIndex = parseInt(startNode.dataset.index!, 10);\r\n    const endIndex = parseInt(endNode.dataset.index!, 10);\r\n\r\n    const from = Math.min(startIndex, endIndex);\r\n    const end = Math.max(startIndex, endIndex);\r\n    if (from === end) {\r\n      return; // no single\r\n    }\r\n    // bounce event end\r\n    requestAnimationFrame(() => this.fire(SelectionManager.EVENT_SELECT_RANGE, from, end, additional));\r\n  }\r\n\r\n  private showHint(end: MouseEvent) {\r\n    const start = this.start!;\r\n    const sy = start.y;\r\n    const ey = end.clientY;\r\n\r\n    const visible = Math.abs(sy - ey) > SelectionManager.MIN_DISTANCE;\r\n    this.hr.classList.toggle(cssClass('selection-active'), visible);\r\n    this.hr.style.transform = `translate(${start.x - start.xShift}px,${sy - start.yShift}px)scale(1,${Math.abs(ey - sy)})rotate(${ey > sy ? 90 : -90}deg)`;\r\n  }\r\n\r\n  remove(node: HTMLElement) {\r\n    node.onclick = <any>undefined;\r\n  }\r\n\r\n  add(node: HTMLElement) {\r\n    node.onclick = (evt) => {\r\n      const dataIndex = parseInt(node.dataset.i!, 10);\r\n      if (evt.shiftKey) {\r\n        const relIndex = parseInt(node.dataset.index!, 10);\r\n        const ranking = node.parentElement!.dataset.ranking!;\r\n        if (rangeSelection(this.ctx.provider, ranking, dataIndex, relIndex, evt.ctrlKey)) {\r\n          return;\r\n        }\r\n      }\r\n      this.ctx.provider.toggleSelection(dataIndex, evt.ctrlKey);\r\n    };\r\n  }\r\n\r\n  selectRange(rows: {forEach: (c: (item: (IGroupItem | IGroupData)) => void) => void}, additional: boolean = false) {\r\n    const current = new OrderedSet<number>(additional ? this.ctx.provider.getSelection() : []);\r\n    const toggle = (dataIndex: number) => {\r\n      if (current.has(dataIndex)) {\r\n        current.delete(dataIndex);\r\n      } else {\r\n        current.add(dataIndex);\r\n      }\r\n    };\r\n    rows.forEach((d) => {\r\n      if (isGroup(d)) {\r\n        forEachIndices(d.order, toggle);\r\n      } else {\r\n        toggle(d.dataIndex);\r\n      }\r\n    });\r\n    this.ctx.provider.setSelection(Array.from(current));\r\n  }\r\n\r\n  updateState(node: HTMLElement, dataIndex: number) {\r\n    if (this.ctx.provider.isSelected(dataIndex)) {\r\n      node.classList.add(cssClass('selected'));\r\n    } else {\r\n      node.classList.remove(cssClass('selected'));\r\n    }\r\n  }\r\n\r\n  update(node: HTMLElement, selectedDataIndices: {has(dataIndex: number): boolean}) {\r\n    const dataIndex = parseInt(node.dataset.i!, 10);\r\n    if (selectedDataIndices.has(dataIndex)) {\r\n      node.classList.add(cssClass('selected'));\r\n    } else {\r\n      node.classList.remove(cssClass('selected'));\r\n    }\r\n  }\r\n}\r\n","import {ACellTableSection, GridStyleManager, IAbortAblePromise, ICellRenderContext, IExceptionContext, isAbortAble, isAsyncUpdate, isLoadingCell, ITableSection, nonUniformContext, PrefetchMixin, tableIds, uniformContext, IAsyncUpdate} from 'lineupengine';\r\nimport {ILineUpFlags} from '../config';\r\nimport {HOVER_DELAY_SHOW_DETAIL} from '../constants';\r\nimport {AEventDispatcher, clear, debounce, IEventContext, IEventHandler, IEventListener, suffix} from '../internal';\r\nimport {Column, IGroupData, IGroupItem, IOrderedGroup, isGroup, isMultiLevelColumn, Ranking, StackColumn, IGroupParent, defaultGroup, IGroup} from '../model';\r\nimport {IImposer, IRenderCallback, IRenderContext} from '../renderer';\r\nimport {CANVAS_HEIGHT, COLUMN_PADDING, cssClass, engineCssClass} from '../styles';\r\nimport {lineupAnimation} from './animation';\r\nimport {IRankingBodyContext, IRankingHeaderContextContainer} from './interfaces';\r\nimport MultiLevelRenderColumn from './MultiLevelRenderColumn';\r\nimport RenderColumn, {IRenderers} from './RenderColumn';\r\nimport SelectionManager from './SelectionManager';\r\nimport {groupRoots} from '../model/internal';\r\nimport {isAlwaysShowingGroupStrategy, toRowMeta} from '../provider/internal';\r\n\r\nexport interface IEngineRankingContext extends IRankingHeaderContextContainer, IRenderContext {\r\n  createRenderer(c: Column, imposer?: IImposer): IRenderers;\r\n}\r\n\r\n\r\nexport interface IEngineRankingOptions {\r\n  animation: boolean;\r\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\r\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\r\n  flags: ILineUpFlags;\r\n}\r\n\r\n/**\r\n * emitted when the width of the ranking changed\r\n * @asMemberOf EngineRanking\r\n * @event\r\n */\r\nexport declare function widthChanged(): void;\r\n/**\r\n * emitted when the data of the ranking needs to be updated\r\n * @asMemberOf EngineRanking\r\n * @event\r\n */\r\nexport declare function updateData(): void;\r\n/**\r\n * emitted when the table has be recreated\r\n * @asMemberOf EngineRanking\r\n * @event\r\n */\r\nexport declare function recreate(): void;\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf EngineRanking\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n\r\n\r\n/** @internal */\r\nclass RankingEvents extends AEventDispatcher {\r\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\r\n  static readonly EVENT_UPDATE_DATA = 'updateData';\r\n  static readonly EVENT_RECREATE = 'recreate';\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\r\n\r\n  fire(type: string | string[], ...args: any[]) {\r\n    super.fire(type, ...args);\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([RankingEvents.EVENT_WIDTH_CHANGED, RankingEvents.EVENT_UPDATE_DATA, RankingEvents.EVENT_RECREATE, RankingEvents.EVENT_HIGHLIGHT_CHANGED]);\r\n  }\r\n}\r\n\r\nconst PASSIVE: AddEventListenerOptions = {\r\n  passive: false\r\n};\r\n\r\nexport default class EngineRanking extends ACellTableSection<RenderColumn> implements ITableSection, IEventHandler {\r\n  static readonly EVENT_WIDTH_CHANGED = RankingEvents.EVENT_WIDTH_CHANGED;\r\n  static readonly EVENT_UPDATE_DATA = RankingEvents.EVENT_UPDATE_DATA;\r\n  static readonly EVENT_RECREATE = RankingEvents.EVENT_RECREATE;\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = RankingEvents.EVENT_HIGHLIGHT_CHANGED;\r\n\r\n  private _context: ICellRenderContext<RenderColumn>;\r\n\r\n  private readonly loadingCanvas = new WeakMap<HTMLCanvasElement, {col: number, render: IAbortAblePromise<IRenderCallback>}[]>();\r\n\r\n  private readonly renderCtx: IRankingBodyContext;\r\n  private data: (IGroupItem | IGroupData)[] = [];\r\n  private readonly selection: SelectionManager;\r\n  private highlight: number = -1;\r\n  private readonly canvasPool: HTMLCanvasElement[] = [];\r\n\r\n  private currentCanvasShift: number = 0;\r\n  private currentCanvasWidth: number = 0;\r\n\r\n  private readonly events = new RankingEvents();\r\n\r\n  private roptions: Readonly<IEngineRankingOptions> = {\r\n    animation: true,\r\n    levelOfDetail: () => 'high',\r\n    customRowUpdate: () => undefined,\r\n    flags: {\r\n      disableFrozenColumns: false,\r\n      advancedModelFeatures: true,\r\n      advancedRankingFeatures: true,\r\n      advancedUIFeatures: true\r\n    }\r\n  };\r\n\r\n  private readonly delayedUpdate: (this: {type: string}) => void;\r\n  private readonly delayedUpdateAll: () => void;\r\n  private readonly delayedUpdateColumnWidths: () => void;\r\n  private readonly columns: RenderColumn[];\r\n\r\n  private readonly canvasMouseHandler = {\r\n    timer: new Set<number>(),\r\n    hoveredRows: new Set<HTMLElement>(),\r\n    cleanUp: () => {\r\n      const c = this.canvasMouseHandler;\r\n      c.timer.forEach((timer) => {\r\n        self.clearTimeout(timer);\r\n      });\r\n      c.timer.clear();\r\n      for (const row of Array.from(c.hoveredRows)) {\r\n        c.unhover(row);\r\n      }\r\n    },\r\n    enter: (evt: MouseEvent) => {\r\n      const c = this.canvasMouseHandler;\r\n      c.cleanUp();\r\n      const row = <HTMLElement>evt.currentTarget;\r\n      row.addEventListener('mouseleave', c.leave, PASSIVE);\r\n      c.timer.add(self.setTimeout(() => {\r\n        c.hoveredRows.add(row);\r\n        this.updateHoveredRow(row, true);\r\n      }, HOVER_DELAY_SHOW_DETAIL));\r\n    },\r\n    leave: (evt: MouseEvent | HTMLElement) => {\r\n      // on row to survive canvas removal\r\n      const c = this.canvasMouseHandler;\r\n      const row = <HTMLElement>((typeof (<MouseEvent>evt).currentTarget !== 'undefined') ? (<MouseEvent>evt).currentTarget : evt);\r\n      c.unhover(row);\r\n\r\n      c.cleanUp();\r\n    },\r\n    unhover: (row: HTMLElement) => {\r\n      // remove self\r\n      const c = this.canvasMouseHandler;\r\n      c.hoveredRows.delete(row);\r\n      row.removeEventListener('mouseleave', c.leave);\r\n      if (!EngineRanking.isCanvasRenderedRow(row) && row.parentElement) { // and part of dom\r\n        self.setTimeout(() => this.updateHoveredRow(row, false));\r\n      }\r\n    }\r\n  };\r\n\r\n  private readonly highlightHandler = {\r\n    enabled: false,\r\n    enter: (evt: MouseEvent) => {\r\n      if (this.highlight >= 0) {\r\n        const old = this.body.getElementsByClassName(engineCssClass('highlighted'))[0];\r\n        if (old) {\r\n          old.classList.remove(engineCssClass('highlighted'));\r\n        }\r\n        this.highlight = -1;\r\n      }\r\n      const row = <HTMLElement>evt.currentTarget;\r\n      const dataIndex = parseInt(row.dataset.i || '-1', 10);\r\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, dataIndex);\r\n    },\r\n    leave: () => {\r\n      if (this.highlight >= 0) {\r\n        const old = this.body.getElementsByClassName(engineCssClass('highlighted'))[0];\r\n        if (old) {\r\n          old.classList.remove(engineCssClass('highlighted'));\r\n        }\r\n        this.highlight = -1;\r\n      }\r\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, -1);\r\n    }\r\n  };\r\n\r\n  constructor(public readonly ranking: Ranking, header: HTMLElement, body: HTMLElement, tableId: string, style: GridStyleManager, private readonly ctx: IEngineRankingContext, roptions: Partial<IEngineRankingOptions> = {}) {\r\n    super(header, body, tableId, style, {mixins: [PrefetchMixin], batchSize: 20});\r\n    Object.assign(this.roptions, roptions);\r\n    body.dataset.ranking = ranking.id;\r\n\r\n    const that = this;\r\n    this.delayedUpdate = debounce((function (this: {type: string, primaryType: string}) {\r\n      if (this.type !== Ranking.EVENT_DIRTY_VALUES) {\r\n        that.events.fire(EngineRanking.EVENT_UPDATE_DATA);\r\n        return;\r\n      }\r\n      if (this.primaryType !== Column.EVENT_RENDERER_TYPE_CHANGED && this.primaryType !== Column.EVENT_GROUP_RENDERER_TYPE_CHANGED && this.primaryType !== Column.EVENT_LABEL_CHANGED) { // just the single column will be updated\r\n        that.updateBody();\r\n      }\r\n    }), 50, (current, next) => {\r\n      const currentEvent = current.self.type;\r\n      // order changed is more important\r\n      return currentEvent === Ranking.EVENT_ORDER_CHANGED ? current : next;\r\n    });\r\n\r\n    this.delayedUpdateAll = debounce(() => this.updateAll(), 50);\r\n    this.delayedUpdateColumnWidths = debounce(() => this.updateColumnWidths(), 50);\r\n    ranking.on(`${Ranking.EVENT_ADD_COLUMN}.hist`, (col: Column, index: number) => {\r\n      this.columns.splice(index, 0, this.createCol(col, index));\r\n      this.reindex();\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_REMOVE_COLUMN}.body`, (col: Column, index: number) => {\r\n      EngineRanking.disableListener(col);\r\n      this.columns.splice(index, 1);\r\n      this.reindex();\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_MOVE_COLUMN}.body`, (col: Column, index: number, old: number) => {\r\n      //delete first\r\n      const c = this.columns.splice(old, 1)[0];\r\n      console.assert(c.c === col);\r\n      // adapt target index based on previous index, i.e shift by one\r\n      this.columns.splice(old < index ? index - 1 : index, 0, c);\r\n      this.reindex();\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_COLUMN_VISIBILITY_CHANGED}.body`, (col: Column, _oldValue: boolean, newValue: boolean) => {\r\n      if (newValue) {\r\n        // become visible\r\n        const index = ranking.children.indexOf(col);\r\n        this.columns.splice(index, 0, this.createCol(col, index));\r\n      } else {\r\n        // hide\r\n        const index = this.columns.findIndex((d) => d.c === col);\r\n        EngineRanking.disableListener(col);\r\n        this.columns.splice(index, 1);\r\n      }\r\n      this.reindex();\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.body`, this.delayedUpdate);\r\n\r\n    this.selection = new SelectionManager(this.ctx, body);\r\n    this.selection.on(SelectionManager.EVENT_SELECT_RANGE, (from: number, to: number, additional: boolean) => {\r\n      this.selection.selectRange(this.data.slice(from, to + 1), additional);\r\n    });\r\n\r\n    this.renderCtx = Object.assign({\r\n      isGroup: (index: number) => isGroup(this.data[index]),\r\n      getRow: (index: number) => <IGroupItem>this.data[index],\r\n      getGroup: (index: number) => <IGroupData>this.data[index]\r\n    }, ctx);\r\n\r\n    // default context\r\n    this.columns = ranking.children.filter((c) => c.isVisible()).map((c, i) => this.createCol(c, i));\r\n    this._context = Object.assign({\r\n      columns: this.columns,\r\n      column: nonUniformContext(this.columns.map((w) => w.width), 100, COLUMN_PADDING)\r\n    }, uniformContext(0, 20));\r\n\r\n    this.columns.forEach((column) => {\r\n      if (column instanceof MultiLevelRenderColumn) {\r\n        column.updateWidthRule(this.style);\r\n      }\r\n      column.renderers = this.ctx.createRenderer(column.c);\r\n    });\r\n\r\n    this.style.updateRule(`hoverOnly${this.tableId}`, `\r\n      #${tableIds(this.tableId).tbody}:hover > .${engineCssClass('tr')}:hover .${cssClass('hover-only')},\r\n      #${tableIds(this.tableId).tbody} > .${engineCssClass('tr')}.${cssClass('selected')} .${cssClass('hover-only')},\r\n      #${tableIds(this.tableId).tbody} > .${engineCssClass('tr')}.${engineCssClass('highlighted')} .${cssClass('hover-only')}`, {\r\n        visibility: 'visible'\r\n      });\r\n\r\n    this.updateCanvasRule();\r\n  }\r\n\r\n  on(type: typeof EngineRanking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof EngineRanking.EVENT_UPDATE_DATA, listener: typeof updateData | null): this;\r\n  on(type: typeof EngineRanking.EVENT_RECREATE, listener: typeof recreate | null): this;\r\n  on(type: typeof EngineRanking.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    this.events.on(type, listener);\r\n    return this;\r\n  }\r\n\r\n  get id() {\r\n    return this.ranking.id;\r\n  }\r\n\r\n  protected onVisibilityChanged(visible: boolean) {\r\n    super.onVisibilityChanged(visible);\r\n    if (visible) {\r\n      this.delayedUpdate.call({type: Ranking.EVENT_ORDER_CHANGED});\r\n    }\r\n  }\r\n\r\n  updateHeaders() {\r\n    this.updateColumnSummaryFlag();\r\n    return super.updateHeaders();\r\n  }\r\n\r\n  get currentData() {\r\n    return this.data;\r\n  }\r\n\r\n  get context(): ICellRenderContext<RenderColumn> {\r\n    return this._context;\r\n  }\r\n\r\n  protected createHeader(_document: Document, column: RenderColumn): HTMLElement | IAsyncUpdate<HTMLElement> {\r\n    return column.createHeader();\r\n  }\r\n\r\n  private updateColumnSummaryFlag() {\r\n    // updates the header flag depending on whether there are any sublabels\r\n    this.header.classList.toggle(cssClass('show-sublabel'), this.columns.some((c) => c.hasSummaryLine()));\r\n  }\r\n\r\n  protected updateHeader(node: HTMLElement, column: RenderColumn) {\r\n    if (column instanceof MultiLevelRenderColumn) {\r\n      column.updateWidthRule(this.style);\r\n    }\r\n    return column.updateHeader(node);\r\n  }\r\n\r\n  protected createCell(_document: Document, index: number, column: RenderColumn) {\r\n    return column.createCell(index);\r\n  }\r\n\r\n  private createCellHandled(col: RenderColumn, index: number) {\r\n    const r = col.createCell(index);\r\n    let item: HTMLElement;\r\n    if (isAsyncUpdate(r)) {\r\n      item = this.handleCellReady(r.item, r.ready, col.index);\r\n    } else {\r\n      item = r;\r\n    }\r\n    this.initCellClasses(item, col.id);\r\n    return item;\r\n  }\r\n\r\n  protected updateCell(node: HTMLElement, index: number, column: RenderColumn) {\r\n    return column.updateCell(node, index);\r\n  }\r\n\r\n  private selectCanvas() {\r\n    if (this.canvasPool.length > 0) {\r\n      return this.canvasPool.pop()!;\r\n    }\r\n    const c = this.body.ownerDocument!.createElement('canvas');\r\n    c.classList.add(cssClass(`low-c${this.tableId}`));\r\n    return c;\r\n  }\r\n\r\n  private rowFlags(row: HTMLElement) {\r\n    const rowany: any = row;\r\n    const v = rowany.__lu__;\r\n    if (v == null) {\r\n      return rowany.__lu__ = {};\r\n    }\r\n    return v;\r\n  }\r\n\r\n  private visibleRenderedWidth() {\r\n    let width = 0;\r\n    for (const col of this.visibleColumns.frozen) {\r\n      width += this.columns[col].width + COLUMN_PADDING;\r\n    }\r\n    for (let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\r\n      width += this.columns[col].width + COLUMN_PADDING;\r\n    }\r\n    if (width > 0) {\r\n      width -= COLUMN_PADDING; // for the last one\r\n    }\r\n    return width;\r\n  }\r\n\r\n  private pushLazyRedraw(canvas: HTMLCanvasElement, x: number, column: RenderColumn, render: IAbortAblePromise<IRenderCallback>) {\r\n    render.then((r) => {\r\n      const l = (this.loadingCanvas.get(canvas) || []);\r\n      const pos = l.findIndex((d) => d.render === render && d.col === column.index);\r\n      if (pos < 0) { // not part anymore ignore\r\n        return;\r\n      }\r\n      l.splice(pos, 1);\r\n      if (typeof r === 'function') { // i.e not aborted\r\n        const ctx = canvas.getContext('2d')!;\r\n        ctx.clearRect(x - 1, 0, column.width + 2, canvas.height);\r\n        ctx.save();\r\n        ctx.translate(x, 0);\r\n        r(ctx);\r\n        ctx.restore();\r\n      }\r\n\r\n      if (l.length > 0) {\r\n        return;\r\n      }\r\n      this.loadingCanvas.delete(canvas);\r\n      canvas.classList.remove(cssClass('loading-c'));\r\n    });\r\n\r\n    if (!this.loadingCanvas.has(canvas)) {\r\n      canvas.classList.add(cssClass('loading-c'));\r\n      this.loadingCanvas.set(canvas, [{col: column.index, render}]);\r\n    } else {\r\n      this.loadingCanvas.get(canvas)!.push({col: column.index, render});\r\n    }\r\n  }\r\n\r\n  private renderRow(canvas: HTMLCanvasElement, node: HTMLElement, index: number) {\r\n    if (this.loadingCanvas.has(canvas)) {\r\n      for (const a of this.loadingCanvas.get(canvas)!) {\r\n        a.render.abort();\r\n      }\r\n      this.loadingCanvas.delete(canvas);\r\n    }\r\n    canvas.classList.remove(cssClass('loading-c'));\r\n\r\n    canvas.width = this.currentCanvasWidth;\r\n    canvas.height = CANVAS_HEIGHT;\r\n    const ctx = canvas.getContext('2d')!;\r\n    ctx.imageSmoothingEnabled = false;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.save();\r\n    const domColumns = <RenderColumn[]>[];\r\n\r\n    let x = 0;\r\n    const renderCellImpl = (col: number) => {\r\n      const c = this.columns[col];\r\n      const r = c.renderCell(ctx, index);\r\n      if (r === true) {\r\n        domColumns.push(c);\r\n      } else if (r !== false && isAbortAble(r)) {\r\n        this.pushLazyRedraw(canvas, x, c, r);\r\n      }\r\n      const shift = c.width + COLUMN_PADDING;\r\n      x += shift;\r\n      ctx.translate(shift, 0);\r\n    };\r\n\r\n    for (const col of this.visibleColumns.frozen) {\r\n      renderCellImpl(col);\r\n    }\r\n    for (let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\r\n      renderCellImpl(col);\r\n    }\r\n    ctx.restore();\r\n\r\n    const visibleElements = node.childElementCount - 1; // for canvas\r\n\r\n    if (domColumns.length === 0) {\r\n      while (node.lastElementChild !== node.firstElementChild) {\r\n        const n = <HTMLElement>node.lastElementChild!;\r\n        node.removeChild(n);\r\n        this.recycleCell(n);\r\n      }\r\n      return;\r\n    }\r\n    if (domColumns.length === 1) {\r\n      const first = domColumns[0];\r\n      if (visibleElements === 0) {\r\n        const item = this.createCellHandled(first, index);\r\n        item.classList.add(cssClass('low'));\r\n        node.appendChild(item);\r\n        return;\r\n      }\r\n      const firstDOM = <HTMLElement>node.lastElementChild!;\r\n      if (visibleElements === 1 && firstDOM.dataset.colId === first.id) {\r\n        const isLoading = isLoadingCell(firstDOM);\r\n        if (isLoading) {\r\n          const item = this.createCellHandled(first, index);\r\n          node.replaceChild(item, firstDOM);\r\n          this.recycleCell(firstDOM, first.index);\r\n          return;\r\n        }\r\n        this.updateCellImpl(first, <HTMLElement>node.lastElementChild, index);\r\n        return;\r\n      }\r\n    }\r\n\r\n    const existing = new Map((<HTMLElement[]>Array.from(node.children)).slice(1).map((d) => <[string, HTMLElement]>[d.dataset.col, d]));\r\n    for (const col of domColumns) {\r\n      const elem = existing.get(col.id);\r\n      if (elem && !isLoadingCell(elem)) {\r\n        existing.delete(col.id);\r\n        this.updateCellImpl(col, elem, index);\r\n      } else {\r\n        const c = this.createCellHandled(col, index);\r\n        c.classList.add(cssClass('low'));\r\n        node.appendChild(c);\r\n      }\r\n    }\r\n    existing.forEach((v) => {\r\n      v.remove();\r\n      this.recycleCell(v);\r\n    });\r\n  }\r\n\r\n\r\n  protected updateCanvasCell(canvas: HTMLCanvasElement, node: HTMLElement, index: number, column: RenderColumn, x: number) {\r\n    // delete lazy that would render the same thing\r\n    if (this.loadingCanvas.has(canvas)) {\r\n      const l = this.loadingCanvas.get(canvas)!;\r\n      const me = l.filter((d) => d.col === column.index);\r\n      if (me.length > 0) {\r\n        this.loadingCanvas.set(canvas, l.filter((d) => d.col !== column.index));\r\n        for (const a of me) {\r\n          a.render.abort();\r\n        }\r\n      }\r\n    }\r\n\r\n    const ctx = canvas.getContext('2d')!;\r\n    ctx.clearRect(x - 1, 0, column.width + 2, canvas.height);\r\n    ctx.save();\r\n    ctx.translate(x, 0);\r\n    const needDOM = column.renderCell(ctx, index);\r\n    ctx.restore();\r\n\r\n    if (typeof needDOM !== 'boolean' && isAbortAble(needDOM)) {\r\n      this.pushLazyRedraw(canvas, x, column, needDOM);\r\n    }\r\n\r\n    if (needDOM !== true && node.childElementCount === 1) { // just canvas\r\n      return;\r\n    }\r\n    const elem = <HTMLElement>node.querySelector(`[data-col-id=\"${column.id}\"]`);\r\n    if (elem && !needDOM) {\r\n      elem.remove();\r\n      this.recycleCell(elem, column.index);\r\n      return;\r\n    }\r\n    if (elem) {\r\n      return this.updateCellImpl(column, elem, index);\r\n    }\r\n\r\n    const c = this.createCellHandled(column, index);\r\n    c.classList.add(cssClass('low'));\r\n    node.appendChild(c);\r\n  }\r\n\r\n  private reindex() {\r\n    this.columns.forEach((c, i) => {\r\n      c.index = i;\r\n    });\r\n  }\r\n\r\n  updateAll() {\r\n    this.columns.forEach((c, i) => {\r\n      c.index = i;\r\n      c.renderers = this.ctx.createRenderer(c.c);\r\n    });\r\n\r\n    this._context = Object.assign({}, this._context, {\r\n      column: nonUniformContext(this.columns.map((w) => w.width), 100, COLUMN_PADDING)\r\n    });\r\n\r\n    this.updateColumnSummaryFlag();\r\n\r\n    this.events.fire(EngineRanking.EVENT_RECREATE);\r\n    super.recreate();\r\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\r\n  }\r\n\r\n  updateBody() {\r\n    if (this.hidden) {\r\n      return;\r\n    }\r\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\r\n    super.forEachRow((row, rowIndex) => this.updateRow(row, rowIndex));\r\n  }\r\n\r\n  updateHeaderOf(col: Column) {\r\n    const i = this._context.columns.findIndex((d) => d.c === col);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n    const node = <HTMLElement>this.header.children[i]!;\r\n    const column = this._context.columns[i];\r\n    if (node && column) {\r\n      this.updateHeader(node, column);\r\n    }\r\n    this.updateColumnSummaryFlag();\r\n    return node && column;\r\n  }\r\n\r\n  protected createRow(node: HTMLElement, rowIndex: number): void {\r\n    node.classList.add(this.style.cssClasses.tr);\r\n    this.roptions.customRowUpdate(node, rowIndex);\r\n    if (this.highlightHandler.enabled) {\r\n      node.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\r\n      this.rowFlags(node).highlight = true;\r\n    }\r\n\r\n    const isGroup = this.renderCtx.isGroup(rowIndex);\r\n\r\n    const meta = this.toRowMeta(rowIndex);\r\n    if (!meta) {\r\n      delete node.dataset.meta;\r\n    } else {\r\n      node.dataset.meta = meta;\r\n    }\r\n\r\n    if (isGroup) {\r\n      node.dataset.agg = 'group';\r\n      super.createRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    const {dataIndex} = this.renderCtx.getRow(rowIndex);\r\n    node.classList.toggle(engineCssClass('highlighted'), this.highlight === dataIndex);\r\n    node.dataset.i = dataIndex.toString();\r\n    node.dataset.agg = 'detail'; //or 'group'\r\n\r\n    this.selection.updateState(node, dataIndex);\r\n    this.selection.add(node);\r\n\r\n    const low = this.roptions.levelOfDetail(rowIndex) === 'low';\r\n    node.classList.toggle(cssClass('low'), low);\r\n\r\n    if (!low || this.ctx.provider.isSelected(dataIndex)) {\r\n      super.createRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    const canvas = this.selectCanvas();\r\n    node.appendChild(canvas);\r\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, PASSIVE);\r\n    this.renderRow(canvas, node, rowIndex);\r\n  }\r\n\r\n  protected updateRow(node: HTMLElement, rowIndex: number, hoverLod?: 'high' | 'low'): void {\r\n    this.roptions.customRowUpdate(node, rowIndex);\r\n\r\n    const computedLod = this.roptions.levelOfDetail(rowIndex);\r\n    const low = (hoverLod ? hoverLod : computedLod) === 'low';\r\n    const wasLow = node.classList.contains(cssClass('low'));\r\n    const isGroup = this.renderCtx.isGroup(rowIndex);\r\n    const wasGroup = node.dataset.agg === 'group';\r\n\r\n    node.classList.toggle(cssClass('low'), computedLod === 'low');\r\n\r\n    if (this.highlightHandler.enabled && !this.rowFlags(node).highlight) {\r\n      node.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\r\n      this.rowFlags(node).highlight = true;\r\n    }\r\n\r\n    if (isGroup !== wasGroup) {\r\n      // change of mode clear the children to reinitialize them\r\n      clear(node);\r\n\r\n      // adapt body\r\n      node.dataset.agg = isGroup ? 'group' : 'detail';\r\n      if (isGroup) {\r\n        node.dataset.i = '';\r\n        this.selection.remove(node);\r\n      } else {\r\n        this.selection.add(node);\r\n      }\r\n    }\r\n\r\n    if (wasLow && (!computedLod || isGroup)) {\r\n      node.removeEventListener('mouseenter', this.canvasMouseHandler.enter);\r\n    }\r\n\r\n    const meta = this.toRowMeta(rowIndex);\r\n    if (!meta) {\r\n      delete node.dataset.meta;\r\n    } else {\r\n      node.dataset.meta = meta;\r\n    }\r\n\r\n    if (isGroup) {\r\n      node.classList.remove(engineCssClass('highlighted'));\r\n      super.updateRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    const {dataIndex} = this.renderCtx.getRow(rowIndex);\r\n    node.classList.toggle(engineCssClass('highlighted'), this.highlight === dataIndex);\r\n    node.dataset.i = dataIndex.toString();\r\n    this.selection.updateState(node, dataIndex);\r\n\r\n    const canvas = (wasLow && node.firstElementChild!.nodeName.toLowerCase() === 'canvas') ? <HTMLCanvasElement>node.firstElementChild! : null;\r\n    if (!low || this.ctx.provider.isSelected(dataIndex)) {\r\n      if (canvas) {\r\n        this.recycleCanvas(canvas);\r\n        clear(node);\r\n        node.removeEventListener('mouseenter', this.canvasMouseHandler.enter);\r\n      }\r\n      super.updateRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    // use canvas\r\n    if (wasLow && canvas) {\r\n      this.renderRow(canvas, node, rowIndex);\r\n      return;\r\n    }\r\n    // clear old\r\n    clear(node);\r\n    node.dataset.agg = 'detail';\r\n    const canvas2 = this.selectCanvas();\r\n    node.appendChild(canvas2);\r\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, PASSIVE);\r\n    this.renderRow(canvas2, node, rowIndex);\r\n  }\r\n\r\n  private updateCanvasBody() {\r\n    this.updateCanvasRule();\r\n    super.forEachRow((row, index) => {\r\n      if (EngineRanking.isCanvasRenderedRow(row)) {\r\n        this.renderRow(<HTMLCanvasElement>row.firstElementChild!, row, index);\r\n      }\r\n    });\r\n  }\r\n\r\n  private toRowMeta(rowIndex: number) {\r\n    const provider = this.renderCtx.provider;\r\n    const topNGetter = (group: IGroup) => provider.getTopNAggregated(this.ranking, group);\r\n    return toRowMeta(this.renderCtx.getRow(rowIndex), provider.getAggregationStrategy(), topNGetter);\r\n  }\r\n\r\n  private updateCanvasRule() {\r\n    this.style.updateRule(`renderCanvas${this.tableId}`, `.${cssClass(`low-c${this.tableId}`)}`, {\r\n        transform: `translateX(${this.currentCanvasShift}px)`,\r\n        width: `${this.currentCanvasWidth}px`\r\n      });\r\n  }\r\n\r\n  protected updateShifts(top: number, left: number) {\r\n    super.updateShifts(top, left);\r\n\r\n    const width = this.visibleRenderedWidth();\r\n    if (left === this.currentCanvasShift && width === this.currentCanvasWidth) {\r\n      return;\r\n    }\r\n\r\n    this.currentCanvasShift = left;\r\n    this.currentCanvasWidth = width;\r\n    this.updateCanvasBody();\r\n  }\r\n\r\n  private recycleCanvas(canvas: HTMLCanvasElement) {\r\n    if (this.loadingCanvas.has(canvas)) {\r\n      for (const a of this.loadingCanvas.get(canvas)!) {\r\n        a.render.abort();\r\n      }\r\n      this.loadingCanvas.delete(canvas);\r\n    } else if (!canvas.classList.contains(cssClass('loading-c'))) {\r\n      this.canvasPool.push(canvas);\r\n    }\r\n  }\r\n\r\n  enableHighlightListening(enable: boolean) {\r\n    if (this.highlightHandler.enabled === enable) {\r\n      return;\r\n    }\r\n\r\n    this.highlightHandler.enabled = enable;\r\n\r\n    if (enable) {\r\n      this.body.addEventListener('mouseleave', this.highlightHandler.leave, PASSIVE);\r\n      super.forEachRow((row) => {\r\n        row.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\r\n        this.rowFlags(row).highlight = true;\r\n      });\r\n      return;\r\n    }\r\n\r\n    this.body.removeEventListener('mouseleave', this.highlightHandler.leave);\r\n\r\n    super.forEachRow((row) => {\r\n      row.removeEventListener('mouseenter', this.highlightHandler.enter);\r\n      this.rowFlags(row).highlight = false;\r\n    });\r\n  }\r\n\r\n  private updateHoveredRow(row: HTMLElement, hover: boolean) {\r\n    const isCanvas = EngineRanking.isCanvasRenderedRow(row);\r\n    if (isCanvas !== hover) {\r\n      return; // good nothing to do\r\n    }\r\n    const index = parseInt(row.dataset.index!, 10);\r\n    this.updateRow(row, index, hover ? 'high' : 'low');\r\n  }\r\n\r\n  protected forEachRow(callback: (row: HTMLElement, rowIndex: number) => void, inplace: boolean = false) {\r\n    const adapter = (row: HTMLElement, rowIndex: number) => {\r\n      if (EngineRanking.isCanvasRenderedRow(row)) {\r\n        // skip canvas\r\n        return;\r\n      }\r\n      callback(row, rowIndex);\r\n    };\r\n    return super.forEachRow(adapter, inplace);\r\n  }\r\n\r\n  updateSelection(selectedDataIndices: {has(i: number): boolean}) {\r\n    super.forEachRow((node: HTMLElement, rowIndex: number) => {\r\n      if (this.renderCtx.isGroup(rowIndex)) {\r\n        this.updateRow(node, rowIndex);\r\n      } else {\r\n        // fast pass for item\r\n        this.selection.update(node, selectedDataIndices);\r\n      }\r\n    }, true);\r\n  }\r\n\r\n  updateColumnWidths() {\r\n    // update the column context in place\r\n    (<any>this._context).column = nonUniformContext(this._context.columns.map((w) => w.width), 100, COLUMN_PADDING);\r\n    super.updateColumnWidths();\r\n    const {columns} = this.context;\r\n    //no data update needed since just width changed\r\n    columns.forEach((column) => {\r\n      if (column instanceof MultiLevelRenderColumn) {\r\n        column.updateWidthRule(this.style);\r\n      }\r\n      column.renderers = this.ctx.createRenderer(column.c);\r\n    });\r\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\r\n  }\r\n\r\n  private updateColumn(index: number) {\r\n    const columns = this.context.columns;\r\n    const column = columns[index];\r\n    if (!column) {\r\n      return false;\r\n    }\r\n    let x = 0;\r\n    for (let i = this.visibleColumns.first; i < index; ++i) {\r\n      x += columns[i].width + COLUMN_PADDING;\r\n    }\r\n    super.forEachRow((row, rowIndex) => {\r\n      if (EngineRanking.isCanvasRenderedRow(row)) {\r\n        this.updateCanvasCell(<HTMLCanvasElement>row.firstElementChild!, row, rowIndex, column, x);\r\n        return;\r\n      }\r\n      this.updateCellImpl(column, <HTMLElement>row.children[index], rowIndex);\r\n    });\r\n    return true;\r\n  }\r\n\r\n  private updateCellImpl(column: RenderColumn, before: HTMLElement, rowIndex: number) {\r\n    if (!before) {\r\n      return; // race condition\r\n    }\r\n    const r = this.updateCell(before, rowIndex, column);\r\n    let after: HTMLElement;\r\n    if (isAsyncUpdate(r)) {\r\n      after = this.handleCellReady(r.item, r.ready, column.index);\r\n    } else {\r\n      after = r;\r\n    }\r\n    if (before === after || !after) {\r\n      return;\r\n    }\r\n    this.initCellClasses(after, column.id);\r\n    before.parentElement!.replaceChild(after, before);\r\n  }\r\n\r\n  private initCellClasses(node: HTMLElement, id: string) {\r\n    node.dataset.id = id;\r\n    node.classList.add(engineCssClass('td'), this.style.cssClasses.td, engineCssClass(`td-${this.tableId}`));\r\n  }\r\n\r\n  destroy() {\r\n    super.destroy();\r\n    this.style.deleteRule(`hoverOnly${this.tableId}`);\r\n    this.style.deleteRule(`renderCanvas${this.tableId}`);\r\n    this.ranking.flatColumns.forEach((c) => EngineRanking.disableListener(c));\r\n  }\r\n\r\n  groupData(): (IGroupItem | IGroupData)[] {\r\n    const groups = this.ranking.getGroups();\r\n    const provider = this.ctx.provider;\r\n    const strategy = provider.getAggregationStrategy();\r\n    const alwaysShowGroup = isAlwaysShowingGroupStrategy(strategy);\r\n\r\n    const r = <(IGroupItem | IGroupData)[]>[];\r\n\r\n    if (groups.length === 0) {\r\n      return r;\r\n    }\r\n\r\n    const pushItem = (group: IOrderedGroup, dataIndex: number, i: number) => {\r\n      r.push({\r\n        group,\r\n        dataIndex,\r\n        relativeIndex: i\r\n      });\r\n    };\r\n\r\n    if (groups.length === 1 && groups[0].name === defaultGroup.name) {\r\n      const group = groups[0];\r\n      const l = group.order.length;\r\n      for (let i = 0; i < l; ++i) {\r\n        pushItem(group, group.order[i], i);\r\n      }\r\n      return r;\r\n    }\r\n\r\n    const roots = groupRoots(groups);\r\n\r\n    const pushGroup = (group: IOrderedGroup | Readonly<IGroupParent>) => {\r\n      const n = provider.getTopNAggregated(this.ranking, group);\r\n\r\n      // all are IOrderedGroup since propagated\r\n      const ordered = <IOrderedGroup>group;\r\n      const gparent = <IGroupParent>group;\r\n\r\n      if (n === 0 || alwaysShowGroup) {\r\n        r.push(ordered);\r\n      }\r\n\r\n      if (n !== 0 && Array.isArray(gparent.subGroups) && gparent.subGroups.length > 0) {\r\n        for (const g of gparent.subGroups) {\r\n          pushGroup(<IOrderedGroup | Readonly<IGroupParent>>g);\r\n        }\r\n        return;\r\n      }\r\n\r\n      const l = n < 0 ? ordered.order.length : Math.min(n, ordered.order.length);\r\n      for (let i = 0; i < l; ++i) {\r\n        pushItem(ordered, ordered.order[i], i);\r\n      }\r\n    };\r\n\r\n    for (const root of roots) {\r\n      pushGroup(root);\r\n    }\r\n\r\n    return r;\r\n  }\r\n\r\n  render(data: (IGroupItem | IGroupData)[], rowContext: IExceptionContext) {\r\n    const previous = this._context;\r\n    const previousData = this.data;\r\n    this.data = data;\r\n\r\n    this.columns.forEach((c, i) => {\r\n      c.index = i;\r\n      c.renderers = this.ctx.createRenderer(c.c);\r\n    });\r\n    this._context = Object.assign({\r\n      columns: this.columns,\r\n      column: nonUniformContext(this.columns.map((w) => w.width), 100, COLUMN_PADDING)\r\n    }, rowContext);\r\n\r\n    if (!this.bodyScroller) { // somehow not part of dom\r\n      return;\r\n    }\r\n    this.events.fire(EngineRanking.EVENT_RECREATE);\r\n    return super.recreate(this.roptions.animation ? lineupAnimation(previous, previousData, this.data) : undefined);\r\n  }\r\n\r\n  setHighlight(dataIndex: number) {\r\n    this.highlight = dataIndex;\r\n    const old = this.body.querySelector(`[data-i].${engineCssClass('highlighted')}`);\r\n    if (old) {\r\n      old.classList.remove(engineCssClass('highlighted'));\r\n    }\r\n    if (dataIndex < 0) {\r\n      return;\r\n    }\r\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (item) {\r\n      item.classList.add(engineCssClass('highlighted'));\r\n    }\r\n    return item != null;\r\n  }\r\n\r\n  findNearest(dataIndices: number[]) {\r\n    // find the nearest visible data index\r\n    // first check if already visible\r\n    const index = dataIndices.find((d) => Boolean(this.body.querySelectorAll(`[data-i=\"${d}\"]`)));\r\n    if (index != null) {\r\n      return index; // visible one\r\n    }\r\n    const visible = this.visible;\r\n    const lookFor = new Set(dataIndices);\r\n    let firstBeforePos = -1;\r\n    let firstAfterPos = -1;\r\n    for (let i = visible.first; i >= 0; --i) {\r\n      const d = this.data[i];\r\n      if (!isGroup(d) && lookFor.has(d.dataIndex)) {\r\n        firstBeforePos = i;\r\n        break;\r\n      }\r\n    }\r\n    for (let i = visible.last; i < this.data.length; ++i) {\r\n      const d = this.data[i];\r\n      if (!isGroup(d) && lookFor.has(d.dataIndex)) {\r\n        firstAfterPos = i;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (firstBeforePos < 0 && firstBeforePos < 0) {\r\n      return -1; // not found at all\r\n    }\r\n    const nearestPos = (firstBeforePos >= 0 && (visible.first - firstBeforePos) < (firstAfterPos - visible.last)) ? firstBeforePos : firstAfterPos;\r\n    return (<IGroupItem>this.data[nearestPos]).dataIndex;\r\n  }\r\n\r\n  scrollIntoView(dataIndex: number) {\r\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (item) {\r\n      item.scrollIntoView(true);\r\n      return true;\r\n    }\r\n    const index = this.data.findIndex((d) => !isGroup(d) && d.dataIndex === dataIndex);\r\n    if (index < 0) {\r\n      return false; // part of a group?\r\n    }\r\n\r\n    const posOf = () => {\r\n      const c = this._context;\r\n      if (c.exceptions.length === 0 || index < c.exceptions[0].index) {\r\n        // fast pass\r\n        return index * c.defaultRowHeight;\r\n      }\r\n      const before = c.exceptions.reverse().find((d) => d.index <= index);\r\n      if (!before) {\r\n        return -1;\r\n      }\r\n      if (before.index === index) {\r\n        return before.y;\r\n      }\r\n      const regular = index - before.index - 1;\r\n      return before.y2 + regular * c.defaultRowHeight;\r\n    };\r\n    const pos = posOf();\r\n    if (pos < 0) {\r\n      return false;\r\n    }\r\n    const scroller = this.bodyScroller;\r\n    if (!scroller) {\r\n      return false;\r\n    }\r\n    const top = scroller.scrollTop;\r\n    scroller.scrollTop = Math.min(pos, scroller.scrollHeight - scroller.clientHeight);\r\n    this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, top < scroller.scrollTop);\r\n\r\n    const found = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (found) {\r\n      found.scrollIntoView(true);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getHighlight() {\r\n    const item = <HTMLElement>this.body.querySelector(`[data-i]:hover, [data-i].${engineCssClass('highlighted')}`);\r\n    if (item) {\r\n      return parseInt(item.dataset.i!, 10);\r\n    }\r\n    return this.highlight;\r\n  }\r\n\r\n  private createCol(c: Column, index: number) {\r\n    const col = (isMultiLevelColumn(c) && !c.getCollapsed()) ? new MultiLevelRenderColumn(c, index, this.renderCtx, this.roptions.flags) : new RenderColumn(c, index, this.renderCtx, this.roptions.flags);\r\n\r\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, () => {\r\n      // replace myself upon width change since we renderers are allowed to\r\n      col.renderers = this.ctx.createRenderer(c);\r\n      this.delayedUpdateColumnWidths();\r\n    });\r\n    const debounceUpdate = debounce(() => {\r\n      const valid = this.updateColumn(col.index);\r\n      if (!valid) {\r\n        EngineRanking.disableListener(c); // destroy myself\r\n      }\r\n    }, 25);\r\n    c.on([`${Column.EVENT_RENDERER_TYPE_CHANGED}.body`, `${Column.EVENT_GROUP_RENDERER_TYPE_CHANGED}.body`], () => {\r\n      // replace myself upon renderer type change\r\n      col.renderers = this.ctx.createRenderer(c);\r\n      debounceUpdate();\r\n    });\r\n    const that = this;\r\n    c.on(`${Column.EVENT_DIRTY_HEADER}.body`, function (this: IEventContext) {\r\n      const valid = that.updateHeaderOf(col.c);\r\n      if (!valid) {\r\n        EngineRanking.disableListener(c); // destroy myself\r\n      }\r\n    });\r\n    c.on(suffix('.body', Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES), () => {\r\n      // replace myself upon renderer type change\r\n      col.renderers = this.ctx.createRenderer(c);\r\n      const valid = this.updateHeaderOf(col.c);\r\n      if (!valid) {\r\n        EngineRanking.disableListener(c); // destroy myself\r\n      }\r\n    });\r\n    c.on(`${Column.EVENT_DIRTY_VALUES}.body`, debounceUpdate);\r\n\r\n    if (isMultiLevelColumn(c)) {\r\n      c.on(`${StackColumn.EVENT_COLLAPSE_CHANGED}.body`, () => {\r\n        // rebuild myself from scratch\r\n        EngineRanking.disableListener(c); // destroy myself\r\n        const index = col.index;\r\n        const replacement = this.createCol(c, index);\r\n        replacement.index = index;\r\n        this.columns.splice(index, 1, replacement);\r\n        this.delayedUpdateAll();\r\n      });\r\n      if (!c.getCollapsed()) {\r\n        (<MultiLevelRenderColumn>col).updateWidthRule(this.style);\r\n        c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, () => {\r\n          (<MultiLevelRenderColumn>col).updateWidthRule(this.style);\r\n        });\r\n        c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, debounceUpdate);\r\n      }\r\n    }\r\n\r\n    return col;\r\n  }\r\n\r\n  private static isCanvasRenderedRow(row: HTMLElement) {\r\n    return row.classList.contains(cssClass('low')) && row.childElementCount >= 1 && row.firstElementChild!.nodeName.toLowerCase() === 'canvas';\r\n  }\r\n\r\n  private static disableListener(c: Column) {\r\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, null);\r\n    c.on(suffix('.body', Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES, Column.EVENT_LABEL_CHANGED), null);\r\n    c.on(`${Ranking.EVENT_DIRTY_HEADER}.body`, null);\r\n    c.on(`${Ranking.EVENT_DIRTY_VALUES}.body`, null);\r\n\r\n    if (!(isMultiLevelColumn(c))) {\r\n      return;\r\n    }\r\n    c.on(`${StackColumn.EVENT_COLLAPSE_CHANGED}.body`, null);\r\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, null);\r\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, null);\r\n  }\r\n}\r\n","import {IExceptionContext, ITableSection, range} from 'lineupengine';\r\nimport {IGroupData, IGroupItem, IOrderedGroup, isGroup, Ranking} from '../model';\r\nimport {aria, cssClass, engineCssClass, SLOPEGRAPH_WIDTH} from '../styles';\r\nimport {IRankingHeaderContextContainer, EMode} from './interfaces';\r\nimport {forEachIndices, filterIndices} from '../model/internal';\r\n\r\ninterface ISlope {\r\n  isSelected(selection: {has(dataIndex: number): boolean}): boolean;\r\n\r\n  update(path: SVGPathElement, width: number): void;\r\n\r\n  readonly dataIndices: number[];\r\n}\r\n\r\nclass ItemSlope implements ISlope {\r\n  constructor(private readonly left: number, private readonly right: number, public readonly dataIndices: number[]) {\r\n\r\n  }\r\n\r\n  isSelected(selection: {has(dataIndex: number): boolean}) {\r\n    return this.dataIndices.length === 1 ? selection.has(this.dataIndices[0]) : this.dataIndices.some((s) => selection.has(s));\r\n  }\r\n\r\n  update(path: SVGPathElement, width: number) {\r\n    path.setAttribute('data-i', String(this.dataIndices[0]));\r\n    path.setAttribute('class', cssClass('slope'));\r\n    path.setAttribute('d', `M0,${this.left}L${width},${this.right}`);\r\n  }\r\n}\r\n\r\nclass GroupSlope implements ISlope {\r\n  constructor(private readonly left: [number, number], private readonly right: [number, number], public readonly dataIndices: number[]) {\r\n\r\n  }\r\n\r\n  isSelected(selection: {has(dataIndex: number): boolean}) {\r\n    return this.dataIndices.some((s) => selection.has(s));\r\n  }\r\n\r\n  update(path: SVGPathElement, width: number) {\r\n    path.setAttribute('class', cssClass('group-slope'));\r\n    path.setAttribute('d', `M0,${this.left[0]}L${width},${this.right[0]}L${width},${this.right[1]}L0,${this.left[1]}Z`);\r\n  }\r\n}\r\n\r\ninterface IPos {\r\n  start: number;\r\n  heightPerRow: number;\r\n  rows: number[]; // data indices\r\n  offset: number;\r\n  ref: number[];\r\n  group: IOrderedGroup;\r\n}\r\n\r\nexport interface ISlopeGraphOptions {\r\n  mode: EMode;\r\n}\r\n\r\nexport default class SlopeGraph implements ITableSection {\r\n  readonly node: SVGSVGElement;\r\n\r\n  private leftSlopes: ISlope[][] = [];\r\n  // rendered row to one ore multiple slopes\r\n  private rightSlopes: ISlope[][] = [];\r\n  private readonly pool: SVGPathElement[] = [];\r\n\r\n  private scrollListener: ((act: {top: number, height: number}) => void) | null = null;\r\n\r\n  readonly width = SLOPEGRAPH_WIDTH;\r\n  readonly height = 0;\r\n\r\n  private current: {\r\n    leftRanking: Ranking;\r\n    left: (IGroupItem | IGroupData)[];\r\n    leftContext: IExceptionContext;\r\n    rightRanking: Ranking;\r\n    right: (IGroupItem | IGroupData)[];\r\n    rightContext: IExceptionContext;\r\n  } | null = null;\r\n\r\n  private chosen = new Set<ISlope>();\r\n  private chosenSelectionOnly = new Set<ISlope>();\r\n\r\n  private _mode: EMode = EMode.ITEM;\r\n\r\n  constructor(public readonly header: HTMLElement, public readonly body: HTMLElement, public readonly id: string, private readonly ctx: IRankingHeaderContextContainer, options: Partial<ISlopeGraphOptions> = {}) {\r\n    this.node = header.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    this.node.innerHTML = `<g transform=\"translate(0,0)\"></g>`;\r\n    header.classList.add(cssClass('slopegraph-header'));\r\n    this._mode = options.mode === EMode.BAND ? EMode.BAND : EMode.ITEM;\r\n    this.initHeader(header);\r\n    body.classList.add(cssClass('slopegraph'));\r\n    this.body.style.height = `1px`;\r\n    body.appendChild(this.node);\r\n  }\r\n\r\n  init() {\r\n    this.hide(); // hide by default\r\n\r\n    const scroller = <any>this.body.parentElement!;\r\n\r\n    //sync scrolling of header and body\r\n    // use internals from lineup engine\r\n    const scroll = (<any>scroller).__le_scroller__;\r\n    let old: {top: number, height: number} = scroll.asInfo();\r\n    scroll.push('animation', this.scrollListener = (act: {top: number, height: number}) => {\r\n      if (Math.abs(old.top - act.top) < 5) {\r\n        return;\r\n      }\r\n      old = act;\r\n      this.onScrolledVertically(act.top, act.height);\r\n    });\r\n  }\r\n\r\n  private initHeader(header: HTMLElement) {\r\n    const active = cssClass('active');\r\n    header.innerHTML = `<i title=\"Item\" class=\"${this._mode === EMode.ITEM ? active : ''}\">${aria('Item')}</i>\r\n        <i title=\"Band\" class=\"${this._mode === EMode.BAND ? active : ''}\">${aria('Band')}</i>`;\r\n\r\n    const icons = <HTMLElement[]>Array.from(header.children);\r\n    icons.forEach((n: HTMLElement, i) => {\r\n      n.onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        if (n.classList.contains(active)) {\r\n          return;\r\n        }\r\n        this.mode = i === 0 ? EMode.ITEM : EMode.BAND;\r\n        icons.forEach((d, j) => d.classList.toggle(active, j === i));\r\n      };\r\n    });\r\n  }\r\n\r\n  get mode() {\r\n    return this._mode;\r\n  }\r\n\r\n  set mode(value: EMode) {\r\n    if (value === this._mode) {\r\n      return;\r\n    }\r\n    this._mode = value;\r\n    if (this.current) {\r\n      this.rebuild(this.current.leftRanking, this.current.left, this.current.leftContext, this.current.rightRanking, this.current.right, this.current.rightContext);\r\n    }\r\n  }\r\n\r\n  get hidden() {\r\n    return this.header.classList.contains(engineCssClass('loading'));\r\n  }\r\n\r\n  set hidden(value: boolean) {\r\n    this.header.classList.toggle(engineCssClass('loading'), value);\r\n    this.body.classList.toggle(engineCssClass('loading'), value);\r\n  }\r\n\r\n  hide() {\r\n    this.hidden = true;\r\n  }\r\n\r\n  show() {\r\n    const was = this.hidden;\r\n    this.hidden = false;\r\n    if (was) {\r\n      this.revalidate();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.header.remove();\r\n    if (this.scrollListener) {\r\n      //sync scrolling of header and body\r\n      // use internals from lineup engine\r\n      const scroll = (<any>this.body.parentElement!).__le_scroller__;\r\n      scroll.remove(this.scrollListener);\r\n    }\r\n    this.body.remove();\r\n  }\r\n\r\n  rebuild(leftRanking: Ranking, left: (IGroupItem | IGroupData)[], leftContext: IExceptionContext, rightRanking: Ranking, right: (IGroupItem | IGroupData)[], rightContext: IExceptionContext) {\r\n    this.current = {leftRanking, left, leftContext, right, rightRanking, rightContext};\r\n\r\n    const lookup: Map<number, IPos> = this.prepareRightSlopes(right, rightContext);\r\n    this.computeSlopes(left, leftContext, lookup);\r\n\r\n    this.revalidate();\r\n  }\r\n\r\n  private computeSlopes(left: (IGroupItem | IGroupData)[], leftContext: IExceptionContext, lookup: Map<number, IPos>) {\r\n    const mode = this.mode;\r\n    const fakeGroups = new Map<IOrderedGroup, ISlope[]>();\r\n\r\n    const createFakeGroup = (first: number, group: IOrderedGroup) => {\r\n      let count = 0;\r\n      let height = 0;\r\n      // find all items in this group, assuming that they are in order\r\n      for (let i = first; i < left.length; ++i) {\r\n        const item = left[i];\r\n        if (isGroup(item) || (<IGroupItem>item).group !== group) {\r\n          break;\r\n        }\r\n        count++;\r\n        height += (leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight);\r\n      }\r\n\r\n      const padded = height - leftContext.padding(first + count - 1);\r\n\r\n      const gr = group;\r\n\r\n      return {gr, padded, height};\r\n    };\r\n\r\n    let acc = 0;\r\n    this.leftSlopes = left.map((r, i) => {\r\n\r\n      let height = (leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight);\r\n      let padded = height - 0; //leftContext.padding(i);\r\n      const slopes = <ISlope[]>[];\r\n      const start = acc;\r\n\r\n      // shift by item height\r\n      acc += height;\r\n\r\n      let offset = 0;\r\n\r\n      const push = (s: ISlope, right: IPos, common = 1, heightPerRow = 0) => {\r\n        // store slope in both\r\n        slopes.push(s);\r\n        forEachIndices(right.ref, (r) => this.rightSlopes[r].push(s));\r\n\r\n        // update the offset of myself and of the right side\r\n        right.offset += common * right.heightPerRow;\r\n        offset += common * heightPerRow;\r\n      };\r\n\r\n      let gr: IGroupData;\r\n\r\n      if (isGroup(r)) {\r\n        gr = r;\r\n      } else {\r\n        const item = (<IGroupItem>r);\r\n        const dataIndex = item.dataIndex;\r\n        const right = lookup.get(dataIndex);\r\n\r\n        if (!right) { // no match\r\n          return slopes;\r\n        }\r\n        if (mode === EMode.ITEM) {\r\n          const s = new ItemSlope(start + padded / 2, right.start + right.offset + right.heightPerRow / 2, [dataIndex]);\r\n          push(s, right);\r\n          return slopes;\r\n        }\r\n\r\n        if (fakeGroups.has(item.group)) {\r\n          // already handled by the first one, take the fake slopes\r\n          return fakeGroups.get(item.group)!;\r\n        }\r\n\r\n        const fakeGroup = createFakeGroup(i, item.group);\r\n        gr = fakeGroup.gr;\r\n        height = fakeGroup.height;\r\n        padded = fakeGroup.padded;\r\n        fakeGroups.set(item.group, slopes);\r\n      }\r\n\r\n      // free group items to share\r\n      const free = new Set(gr.order);\r\n\r\n      const heightPerRow = padded / gr.order.length;\r\n\r\n      forEachIndices(gr.order, (d: number) => {\r\n        if (!free.has(d)) {\r\n          return; // already handled\r\n        }\r\n        free.delete(d);\r\n        const right = lookup.get(d);\r\n        if (!right) {\r\n          return; // no matching\r\n        }\r\n        // find all of this group\r\n        const intersection = filterIndices(right.rows, (r) => free.delete(r));\r\n        intersection.push(d); //self\r\n\r\n        const common = intersection.length;\r\n        let s: ISlope;\r\n        if (common === 1) {\r\n          s = new ItemSlope(start + offset + heightPerRow / 2, right.start + right.offset + right.heightPerRow / 2, [d]);\r\n        } else if (mode === EMode.ITEM) {\r\n          // fake item\r\n          s = new ItemSlope(start + offset + heightPerRow * common / 2, right.start + right.offset + right.heightPerRow * common / 2, intersection);\r\n        } else {\r\n          s = new GroupSlope([start + offset, start + offset + heightPerRow * common], [right.start + right.offset, right.start + right.offset + right.heightPerRow * common], intersection);\r\n        }\r\n        push(s, right, common, heightPerRow);\r\n      });\r\n      return slopes;\r\n    });\r\n  }\r\n\r\n  private prepareRightSlopes(right: (IGroupItem | IGroupData)[], rightContext: IExceptionContext) {\r\n    const lookup = new Map<number, IPos>();\r\n    const mode = this.mode;\r\n\r\n    const fakeGroups = new Map<IOrderedGroup, IPos>();\r\n    let acc = 0;\r\n\r\n    this.rightSlopes = right.map((r, i) => {\r\n      const height = (rightContext.exceptionsLookup.get(i) || rightContext.defaultRowHeight);\r\n      const padded = height - 0; //rightContext.padding(i);\r\n      const start = acc;\r\n      acc += height;\r\n      const slopes = <ISlope[]>[];\r\n\r\n      const base = {\r\n        start,\r\n        offset: 0,\r\n        ref: [i]\r\n      };\r\n      if (isGroup(r)) {\r\n        const p = Object.assign(base, {\r\n          rows: Array.from(r.order),\r\n          heightPerRow: padded / r.order.length,\r\n          group: r\r\n        });\r\n\r\n        forEachIndices(r.order, (ri) => lookup.set(ri, p));\r\n        return slopes;\r\n      }\r\n      // item\r\n      const item = (<IGroupItem>r);\r\n      const dataIndex = r.dataIndex;\r\n\r\n      let p = Object.assign(base, {\r\n        rows: [dataIndex],\r\n        heightPerRow: padded,\r\n        group: item.group\r\n      });\r\n\r\n      if (mode === EMode.ITEM) {\r\n        lookup.set(dataIndex, p);\r\n        return slopes;\r\n      }\r\n      // forced band mode\r\n      // merge with the 'ueber' band\r\n      if (!fakeGroups.has(item.group)) {\r\n        p.heightPerRow = height; // include padding\r\n        // TODO just support uniform item height\r\n        fakeGroups.set(item.group, p);\r\n      } else { // reuse old\r\n        p = fakeGroups.get(item.group)!;\r\n        p.rows.push(dataIndex);\r\n        p.ref.push(i);\r\n      }\r\n      lookup.set(dataIndex, p);\r\n      return slopes;\r\n    });\r\n\r\n    return lookup;\r\n  }\r\n\r\n  private revalidate() {\r\n    if (!this.current || this.hidden) {\r\n      return;\r\n    }\r\n    const p = this.body.parentElement!;\r\n    this.onScrolledVertically(p.scrollTop, p.clientHeight);\r\n  }\r\n\r\n\r\n  highlight(dataIndex: number) {\r\n    const highlight = engineCssClass('highlighted');\r\n    const old = this.body.querySelector(`[data-i].${highlight}`);\r\n    if (old) {\r\n      old.classList.remove(highlight);\r\n    }\r\n    if (dataIndex < 0) {\r\n      return;\r\n    }\r\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (item) {\r\n      item.classList.add(highlight);\r\n    }\r\n    return item != null;\r\n  }\r\n\r\n  private onScrolledVertically(scrollTop: number, clientHeight: number) {\r\n    if (!this.current) {\r\n      return;\r\n    }\r\n\r\n    // which lines are currently shown\r\n    const {leftContext, rightContext} = this.current;\r\n    const left = range(scrollTop, clientHeight, leftContext.defaultRowHeight, leftContext.exceptions, leftContext.numberOfRows);\r\n    const right = range(scrollTop, clientHeight, rightContext.defaultRowHeight, rightContext.exceptions, rightContext.numberOfRows);\r\n\r\n    const start = Math.min(left.firstRowPos, right.firstRowPos);\r\n    const end = Math.max(left.endPos, right.endPos);\r\n\r\n    // move to right position\r\n    this.body.style.transform = `translate(0, ${start.toFixed(0)}px)`;\r\n    this.body.style.height = `${(end - start).toFixed(0)}px`;\r\n    (this.node.firstElementChild!).setAttribute('transform', `translate(0,-${start.toFixed(0)})`);\r\n\r\n    this.chosen = this.choose(left.first, left.last, right.first, right.last);\r\n    this.render(this.chosen, this.chooseSelection(left.first, left.last, this.chosen));\r\n  }\r\n\r\n  private choose(leftVisibleFirst: number, leftVisibleLast: number, rightVisibleFirst: number, rightVisibleLast: number) {\r\n    // assume no separate scrolling\r\n\r\n    const slopes = new Set<ISlope>();\r\n    for (let i = leftVisibleFirst; i <= leftVisibleLast; ++i) {\r\n      for (const s of this.leftSlopes[i]) {\r\n        slopes.add(s);\r\n      }\r\n    }\r\n    for (let i = rightVisibleFirst; i <= rightVisibleLast; ++i) {\r\n      for (const s of this.rightSlopes[i]) {\r\n        slopes.add(s);\r\n      }\r\n    }\r\n    return slopes;\r\n  }\r\n\r\n  private chooseSelection(leftVisibleFirst: number, leftVisibleLast: number, alreadyVisible: Set<ISlope>) {\r\n    const slopes = new Set<ISlope>();\r\n    // ensure selected slopes are always part of\r\n    const p = this.ctx.provider;\r\n\r\n    if (p.getSelection().length === 0) {\r\n      return slopes;\r\n    }\r\n\r\n    const selectionLookup = {has: (dataIndex: number) => p.isSelected(dataIndex)};\r\n\r\n    // try all not visible ones\r\n    for (let i = 0; i < leftVisibleFirst; ++i) {\r\n      for (const s of this.leftSlopes[i]) {\r\n        if (s.isSelected(selectionLookup) && !alreadyVisible.has(s)) {\r\n          slopes.add(s);\r\n        }\r\n      }\r\n    }\r\n    for (let i = leftVisibleLast + 1; i < this.leftSlopes.length; ++i) {\r\n      for (const s of this.leftSlopes[i]) {\r\n        if (s.isSelected(selectionLookup) && !alreadyVisible.has(s)) {\r\n          slopes.add(s);\r\n        }\r\n      }\r\n    }\r\n    return slopes;\r\n  }\r\n\r\n  private updatePath(p: SVGPathElement, g: SVGGElement, s: ISlope, width: number, selection: {has(dataIndex: number): boolean}) {\r\n    s.update(p, width);\r\n    (<any>p).__data__ = s; // data binding\r\n    const selected = s.isSelected(selection);\r\n    p.classList.toggle(cssClass('selected'), selected);\r\n    if (selected) {\r\n      g.appendChild(p); // to put it on top\r\n    }\r\n  }\r\n\r\n  private render(visible: Set<ISlope>, selectionSlopes: Set<ISlope>) {\r\n    const g = <SVGGElement>this.node.firstElementChild!;\r\n    const width = g.ownerSVGElement!.getBoundingClientRect()!.width;\r\n    const paths = this.matchLength(visible.size + selectionSlopes.size, g);\r\n\r\n    const p = this.ctx.provider;\r\n    const selectionLookup = {has: (dataIndex: number) => p.isSelected(dataIndex)};\r\n\r\n    // update paths\r\n    let i = 0;\r\n    const updatePath = (s: ISlope) => {\r\n      this.updatePath(paths[i++], g, s, width, selectionLookup);\r\n    };\r\n\r\n    visible.forEach(updatePath);\r\n    selectionSlopes.forEach(updatePath);\r\n  }\r\n\r\n  private addPath(g: SVGGElement) {\r\n    const elem = this.pool.pop();\r\n    if (elem) {\r\n      g.appendChild(elem);\r\n      return elem;\r\n    }\r\n\r\n    const path = g.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    path.onclick = (evt) => {\r\n      // d3 style\r\n      const s: ISlope = (<any>path).__data__;\r\n      const p = this.ctx.provider;\r\n      const ids = s.dataIndices;\r\n      if (evt.ctrlKey) {\r\n        ids.forEach((id) => p.toggleSelection(id, true));\r\n      } else {\r\n        // either unset or set depending on the first state\r\n        const isSelected = p.isSelected(ids[0]!);\r\n        p.setSelection(isSelected ? [] : ids);\r\n      }\r\n    };\r\n    g.appendChild(path);\r\n    return path;\r\n  }\r\n\r\n  private matchLength(slopes: number, g: SVGGElement) {\r\n    const paths = <SVGPathElement[]>Array.from(g.children);\r\n    for (let i = slopes; i < paths.length; ++i) {\r\n      const elem = paths[i];\r\n      this.pool.push(elem);\r\n      elem.remove();\r\n    }\r\n\r\n    for (let i = paths.length; i < slopes; ++i) {\r\n      paths.push(this.addPath(g));\r\n    }\r\n    return paths;\r\n  }\r\n\r\n  updateSelection(selectedDataIndices: Set<number>) {\r\n    const g = <SVGGElement>this.node.firstElementChild!;\r\n    const paths = <SVGPathElement[]>Array.from(g.children);\r\n\r\n    const openDataIndices = new Set(selectedDataIndices);\r\n\r\n    if (selectedDataIndices.size === 0) {\r\n      // clear\r\n      for (const p of paths) {\r\n        const s: ISlope = (<any>p).__data__;\r\n        p.classList.toggle(cssClass('selected'), false);\r\n        if (this.chosenSelectionOnly.has(s)) {\r\n          p.remove();\r\n        }\r\n      }\r\n      this.chosenSelectionOnly.clear();\r\n      return;\r\n    }\r\n\r\n    for (const p of paths) {\r\n      const s: ISlope = (<any>p).__data__;\r\n      const selected = s.isSelected(selectedDataIndices);\r\n      p.classList.toggle(cssClass('selected'), selected);\r\n      if (!selected) {\r\n        if (this.chosenSelectionOnly.delete(s)) {\r\n          // was only needed because of the selection\r\n          p.remove();\r\n        }\r\n        continue;\r\n      }\r\n\r\n      g.appendChild(p); // to put it on top\r\n      // remove already handled\r\n      s.dataIndices.forEach((d) => openDataIndices.delete(d));\r\n    }\r\n\r\n    if (openDataIndices.size === 0) {\r\n      return;\r\n    }\r\n\r\n    // find and add missing slopes\r\n    const width = g.ownerSVGElement!.getBoundingClientRect()!.width;\r\n    for (const ss of this.leftSlopes) {\r\n      for (const s of ss) {\r\n        if (this.chosen.has(s) || this.chosenSelectionOnly.has(s) || !s.isSelected(openDataIndices)) {\r\n          // not visible or not selected -> skip\r\n          continue;\r\n        }\r\n        // create new path for it\r\n        this.chosenSelectionOnly.add(s);\r\n        const p = this.addPath(g);\r\n        this.updatePath(p, g, s, width, openDataIndices);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import {GridStyleManager, MultiTableRowRenderer, nonUniformContext} from 'lineupengine';\r\nimport {ILineUpFlags, ILineUpOptions} from '../config';\r\nimport {AEventDispatcher, IEventListener, round, suffix} from '../internal';\r\nimport {Column, IGroupData, IGroupItem, isGroup, Ranking, IGroup} from '../model';\r\nimport {DataProvider} from '../provider';\r\nimport {isSummaryGroup, groupEndLevel} from '../provider/internal';\r\nimport {IImposer, IRenderContext} from '../renderer';\r\nimport {chooseGroupRenderer, chooseRenderer, chooseSummaryRenderer, getPossibleRenderer} from '../renderer/renderers';\r\nimport {cssClass, engineCssClass} from '../styles';\r\nimport DialogManager from './dialogs/DialogManager';\r\nimport domElementCache from './domElementCache';\r\nimport EngineRanking, {IEngineRankingContext} from './EngineRanking';\r\nimport {EMode, IRankingHeaderContext, IRankingHeaderContextContainer} from './interfaces';\r\nimport SlopeGraph from './SlopeGraph';\r\nimport {ADialog} from './dialogs';\r\n\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf EngineRenderer\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n\r\n/**\r\n * emitted a dialog is opened\r\n * @asMemberOf EngineRenderer\r\n * @param dialog the opened dialog\r\n * @event\r\n */\r\nexport declare function dialogOpenedER(dialog: ADialog): void;\r\n/**\r\n * emitted a dialog is closed\r\n * @asMemberOf EngineRenderer\r\n * @param dialog the closed dialog\r\n * @param action the action how the dialog was closed\r\n * @event\r\n */\r\nexport declare function dialogClosedER(dialog: ADialog, action: 'cancel' | 'confirm'): void;\r\n\r\nexport default class EngineRenderer extends AEventDispatcher {\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRanking.EVENT_HIGHLIGHT_CHANGED;\r\n  static readonly EVENT_DIALOG_OPENED = DialogManager.EVENT_DIALOG_OPENED;\r\n  static readonly EVENT_DIALOG_CLOSED = DialogManager.EVENT_DIALOG_CLOSED;\r\n\r\n  protected readonly options: Readonly<ILineUpOptions>;\r\n\r\n  readonly node: HTMLElement;\r\n  private readonly table: MultiTableRowRenderer;\r\n  private readonly rankings: EngineRanking[] = [];\r\n  private readonly slopeGraphs: SlopeGraph[] = [];\r\n\r\n  readonly ctx: IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext;\r\n\r\n  private readonly updateAbles: ((ctx: IRankingHeaderContext) => void)[] = [];\r\n  private zoomFactor = 1;\r\n  readonly idPrefix = `lu${Math.random().toString(36).slice(-8).substr(0, 3)}`; //generate a random string with length3;\r\n\r\n  private enabledHighlightListening: boolean = false;\r\n\r\n  constructor(protected data: DataProvider, parent: HTMLElement, options: Readonly<ILineUpOptions>) {\r\n    super();\r\n    this.options = options;\r\n    this.node = parent.ownerDocument!.createElement('main');\r\n    this.node.id = this.idPrefix;\r\n    // FIXME inline\r\n    this.node.classList.toggle(cssClass('whole-hover'), options.expandLineOnHover);\r\n    parent.appendChild(this.node);\r\n\r\n    const dialogManager = new DialogManager({\r\n      doc: parent.ownerDocument!,\r\n      livePreviews: options.livePreviews,\r\n      onDialogBackgroundClick: options.onDialogBackgroundClick,\r\n    });\r\n    this.forward(dialogManager, ...suffix('.main', EngineRenderer.EVENT_DIALOG_OPENED, EngineRenderer.EVENT_DIALOG_CLOSED));\r\n\r\n    parent.appendChild(dialogManager.node);\r\n    this.ctx = {\r\n      idPrefix: this.idPrefix,\r\n      document: parent.ownerDocument!,\r\n      provider: data,\r\n      tasks: data.getTaskExecutor(),\r\n      dialogManager,\r\n      resolveToolbarActions: (col, keys) => this.options.resolveToolbarActions(col, keys, this.options.toolbarActions),\r\n      resolveToolbarDialogAddons: (col, keys) => this.options.resolveToolbarDialogAddons(col, keys, this.options.toolbarDialogAddons),\r\n      flags: <ILineUpFlags>this.options.flags,\r\n      asElement: domElementCache(parent.ownerDocument!),\r\n      renderer: (col: Column, imposer?: IImposer) => {\r\n        const r = chooseRenderer(col, this.options.renderers);\r\n        return r.create!(col, this.ctx, imposer);\r\n      },\r\n      groupRenderer: (col: Column, imposer?: IImposer) => {\r\n        const r = chooseGroupRenderer(col, this.options.renderers);\r\n        return r.createGroup!(col, this.ctx, imposer);\r\n      },\r\n      summaryRenderer: (col: Column, interactive: boolean, imposer?: IImposer) => {\r\n        const r = chooseSummaryRenderer(col, this.options.renderers);\r\n        return r.createSummary!(col, this.ctx, interactive, imposer);\r\n      },\r\n      createRenderer(col: Column, imposer?: IImposer) {\r\n        const single = this.renderer(col, imposer);\r\n        const group = this.groupRenderer(col, imposer);\r\n        const summary = options.summaryHeader ? this.summaryRenderer(col, false, imposer) : null;\r\n        return {\r\n          single,\r\n          group,\r\n          summary,\r\n          singleId: col.getRenderer(),\r\n          groupId: col.getGroupRenderer(),\r\n          summaryId: col.getSummaryRenderer(),\r\n          singleTemplate: null,\r\n          groupTemplate: null,\r\n          summaryTemplate: null\r\n        };\r\n      },\r\n      getPossibleRenderer: (col: Column) => getPossibleRenderer(col, this.options.renderers, this.options.canRender),\r\n      colWidth: (col: Column) => !col.isVisible() ? 0 : col.getWidth(),\r\n      caches: {\r\n        toolbar: new Map(),\r\n        toolbarAddons: new Map()\r\n      }\r\n    };\r\n\r\n    this.table = new MultiTableRowRenderer(this.node, this.idPrefix);\r\n\r\n    {\r\n      // helper object for better resizing experience\r\n      const footer = this.table.node.querySelector(`.${engineCssClass('body')} .${engineCssClass('footer')}`)!;\r\n      const copy = <HTMLElement>footer.cloneNode(true);\r\n      copy.classList.add(cssClass('resize-helper'));\r\n      footer!.insertAdjacentElement('afterend', copy);\r\n    }\r\n\r\n    //apply rules\r\n    {\r\n\r\n      this.style.addRule('lineup_rowPadding0', `\r\n        .${this.style.cssClasses.tr}`, {\r\n          marginTop: `${options.rowPadding}px`\r\n        });\r\n\r\n      for (let level = 0; level < 4; ++level) {\r\n        this.style.addRule(`lineup_groupPadding${level}`, `\r\n        .${this.style.cssClasses.tr}[data-meta~=last${level === 0 ? '' : level}]`, {\r\n            marginBottom: `${options.groupPadding * (level + 1)}px`\r\n          });\r\n      }\r\n\r\n\r\n      this.style.addRule('lineup_rowPaddingAgg0', `\r\n        .${cssClass('agg-level')}::after`, {\r\n          top: `-${options.rowPadding}px`\r\n        });\r\n      for (let level = 1; level <= 4; ++level) {\r\n        this.style.addRule(`lineup_rowPaddingAgg${level}`, `\r\n        .${cssClass('agg-level')}[data-level='${level}']::after`, {\r\n            top: `-${options.rowPadding + options.groupPadding}px`\r\n          });\r\n      }\r\n\r\n      // FIXME flat\r\n      this.style.addRule('lineup_rotation', `\r\n       #${this.idPrefix}.${cssClass('rotated-label')} .${cssClass('label')}.${cssClass('rotated')}`, {\r\n          transform: `rotate(${-this.options.labelRotation}deg)`\r\n        });\r\n\r\n      const toDisable: string[] = [];\r\n      if (!this.options.flags.advancedRankingFeatures) {\r\n        toDisable.push('ranking');\r\n      }\r\n      if (!this.options.flags.advancedModelFeatures) {\r\n        toDisable.push('model');\r\n      }\r\n      if (!this.options.flags.advancedUIFeatures) {\r\n        toDisable.push('ui');\r\n      }\r\n      if (toDisable.length > 0) {\r\n        this.style.addRule('lineup_feature_disable', `\r\n        ${toDisable.map((d) => `.${cssClass('feature')}-${d}.${cssClass('feature-advanced')}`).join(', ')}`, {\r\n            display: 'none !important'\r\n          });\r\n      }\r\n    }\r\n\r\n    this.initProvider(data);\r\n  }\r\n\r\n  get style(): GridStyleManager {\r\n    return this.table.style;\r\n  }\r\n\r\n  zoomOut() {\r\n    this.zoomFactor = Math.max(this.zoomFactor - 0.1, 0.5);\r\n    this.updateZoomFactor();\r\n    this.update();\r\n  }\r\n\r\n  zoomIn() {\r\n    this.zoomFactor = Math.min(this.zoomFactor + 0.1, 2.0);\r\n    this.updateZoomFactor();\r\n    this.update();\r\n  }\r\n\r\n  private updateZoomFactor() {\r\n    const body = <HTMLElement>this.node.querySelector('main')!;\r\n    body.style.fontSize = `${this.zoomFactor * 100}%`;\r\n  }\r\n\r\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\r\n    this.updateAbles.push(updateAble);\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([EngineRenderer.EVENT_HIGHLIGHT_CHANGED, EngineRenderer.EVENT_DIALOG_OPENED, EngineRenderer.EVENT_DIALOG_CLOSED]);\r\n  }\r\n\r\n  on(type: typeof EngineRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: typeof EngineRenderer.EVENT_DIALOG_OPENED, listener: typeof dialogOpenedER | null): this;\r\n  on(type: typeof EngineRenderer.EVENT_DIALOG_CLOSED, listener: typeof dialogClosedER | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n\r\n  setDataProvider(data: DataProvider) {\r\n    this.takeDownProvider();\r\n\r\n    this.data = data;\r\n    (<any>this.ctx).provider = data;\r\n    (<any>this.ctx).tasks = data.getTaskExecutor();\r\n\r\n    this.initProvider(data);\r\n  }\r\n\r\n  private takeDownProvider() {\r\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.body`, null);\r\n    this.data.on(`${DataProvider.EVENT_ADD_RANKING}.body`, null);\r\n    this.data.on(`${DataProvider.EVENT_REMOVE_RANKING}.body`, null);\r\n    this.data.on(`${DataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, null);\r\n    this.data.on(`${DataProvider.EVENT_SHOWTOPN_CHANGED}.body`, null);\r\n    this.data.on(`${DataProvider.EVENT_JUMP_TO_NEAREST}.body`, null);\r\n    this.data.on(`${DataProvider.EVENT_BUSY}.body`, null);\r\n\r\n    this.rankings.forEach((r) => this.table.remove(r));\r\n    this.rankings.splice(0, this.rankings.length);\r\n    this.slopeGraphs.forEach((s) => this.table.remove(s));\r\n    this.slopeGraphs.splice(0, this.slopeGraphs.length);\r\n  }\r\n\r\n  private initProvider(data: DataProvider) {\r\n    data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.body`, () => this.updateSelection(data.getSelection()));\r\n    data.on(`${DataProvider.EVENT_ADD_RANKING}.body`, (ranking: Ranking) => {\r\n      this.addRanking(ranking);\r\n    });\r\n    data.on(`${DataProvider.EVENT_REMOVE_RANKING}.body`, (ranking: Ranking) => {\r\n      this.removeRanking(ranking);\r\n    });\r\n    data.on(`${DataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, (ranking: Ranking) => {\r\n      this.update(this.rankings.filter((r) => r.ranking === ranking));\r\n    });\r\n    data.on(`${DataProvider.EVENT_SHOWTOPN_CHANGED}.body`, () => {\r\n      this.update(this.rankings);\r\n    });\r\n    data.on(`${DataProvider.EVENT_JUMP_TO_NEAREST}.body`, (indices: number[]) => {\r\n      this.setHighlightToNearest(indices, true);\r\n    });\r\n\r\n    (<any>this.ctx).provider = data;\r\n\r\n    this.data.getRankings().forEach((r) => this.addRanking(r));\r\n  }\r\n\r\n  private updateSelection(dataIndices: number[]) {\r\n    const s = new Set(dataIndices);\r\n    this.rankings.forEach((r) => r.updateSelection(s));\r\n\r\n    this.slopeGraphs.forEach((r) => r.updateSelection(s));\r\n  }\r\n\r\n  private updateHist(ranking?: EngineRanking, col?: Column) {\r\n    if (!this.options.summaryHeader) {\r\n      return;\r\n    }\r\n    const rankings = ranking ? [ranking] : this.rankings;\r\n\r\n    for (const r of rankings) {\r\n      if (col) {\r\n        // single update\r\n        r.updateHeaderOf(col);\r\n      } else {\r\n        r.updateHeaders();\r\n      }\r\n    }\r\n    this.updateUpdateAbles();\r\n  }\r\n\r\n  private addRanking(ranking: Ranking) {\r\n    if (this.rankings.length > 0) {\r\n      // add slope graph first\r\n      const s = this.table.pushSeparator((header, body) => new SlopeGraph(header, body, `${ranking.id}S`, this.ctx, {\r\n        mode: this.options.defaultSlopeGraphMode === 'band' ? EMode.BAND : EMode.ITEM\r\n      }));\r\n      this.slopeGraphs.push(s);\r\n    }\r\n\r\n    const r = this.table.pushTable((header, body, tableId, style) => new EngineRanking(ranking, header, body, tableId, style, this.ctx, {\r\n      animation: this.options.animated,\r\n      customRowUpdate: this.options.customRowUpdate || (() => undefined),\r\n      levelOfDetail: this.options.levelOfDetail || (() => 'high'),\r\n      flags: <ILineUpFlags>this.options.flags\r\n    }));\r\n    r.on(EngineRanking.EVENT_WIDTH_CHANGED, () => {\r\n      this.updateRotatedHeaderState();\r\n      this.table.widthChanged();\r\n    });\r\n    r.on(EngineRanking.EVENT_UPDATE_DATA, () => this.update([r]));\r\n    r.on(EngineRanking.EVENT_RECREATE, () => this.updateUpdateAbles());\r\n    this.forward(r, EngineRanking.EVENT_HIGHLIGHT_CHANGED);\r\n    if (this.enabledHighlightListening) {\r\n      r.enableHighlightListening(true);\r\n    }\r\n\r\n    ranking.on(suffix('.renderer', Ranking.EVENT_ORDER_CHANGED), () => this.updateHist(r));\r\n\r\n    this.rankings.push(r);\r\n    this.update([r]);\r\n  }\r\n\r\n  private updateRotatedHeaderState() {\r\n    if (this.options.labelRotation === 0) {\r\n      return;\r\n    }\r\n    const l = this.node.querySelector(`.${cssClass('label')}.${cssClass('rotated')}`);\r\n    this.node.classList.toggle(cssClass('rotated-label'), Boolean(l));\r\n  }\r\n\r\n  private removeRanking(ranking: Ranking | null) {\r\n    if (!ranking) {\r\n      // remove all\r\n      this.rankings.splice(0, this.rankings.length);\r\n      this.slopeGraphs.splice(0, this.slopeGraphs.length);\r\n      this.table.clear();\r\n      return;\r\n    }\r\n    const index = this.rankings.findIndex((r) => r.ranking === ranking);\r\n    if (index < 0) {\r\n      return; // error\r\n    }\r\n    const section = this.rankings.splice(index, 1)[0]!;\r\n    const slope = this.slopeGraphs.splice(index === 0 ? index : index - 1, 1)[0];\r\n    this.table.remove(section);\r\n    if (slope) {\r\n      this.table.remove(slope);\r\n    }\r\n  }\r\n\r\n  update(rankings: EngineRanking[] = this.rankings) {\r\n    // visible and has parent = part of dom\r\n    rankings = rankings.filter((d) => !d.hidden && d.body.parentElement!);\r\n    if (rankings.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const round2 = (v: number) => round(v, 2);\r\n    const rowPadding = round2(this.zoomFactor * this.options.rowPadding!);\r\n    const groupPadding = round2(this.zoomFactor * this.options.groupPadding!);\r\n\r\n    const heightsFor = (ranking: Ranking, data: (IGroupItem | IGroupData)[]) => {\r\n      if (this.options.dynamicHeight) {\r\n        const impl = this.options.dynamicHeight(data, ranking);\r\n        const f = (v: number | any, d: any) => typeof v === 'number' ? v : v(d);\r\n        if (impl) {\r\n          return {\r\n            defaultHeight: round2(this.zoomFactor * impl.defaultHeight),\r\n            height: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.height, d)),\r\n            padding: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.padding, d)),\r\n          };\r\n        }\r\n      }\r\n      const item = round2(this.zoomFactor * this.options.rowHeight!);\r\n      const group = round2(this.zoomFactor * this.options.groupHeight!);\r\n      return {\r\n        defaultHeight: item,\r\n        height: (d: IGroupItem | IGroupData) => isGroup(d) ? group : item,\r\n        padding: rowPadding\r\n      };\r\n    };\r\n\r\n    for (const r of rankings) {\r\n      const grouped = r.groupData();\r\n\r\n      // inline with creating the groupData\r\n      const {height, defaultHeight, padding} = heightsFor(r.ranking, grouped);\r\n\r\n      const strategy = this.data.getAggregationStrategy();\r\n      const topNGetter = (group: IGroup) => this.data.getTopNAggregated(r.ranking, group);\r\n\r\n      // inline and create manually for better performance\r\n      const rowContext = nonUniformContext(grouped.map(height), defaultHeight, (index) => {\r\n        const pad = (typeof padding === 'number' ? padding : padding(grouped[index] || null));\r\n        const v = grouped[index];\r\n\r\n        if (index < 0 || !v || (isGroup(v) && isSummaryGroup(v, strategy, topNGetter))) {\r\n          return pad;\r\n        }\r\n        return pad + groupPadding * groupEndLevel(v, topNGetter);\r\n      });\r\n      r.render(grouped, rowContext);\r\n    }\r\n\r\n    this.updateSlopeGraphs(rankings);\r\n\r\n    this.updateUpdateAbles();\r\n    this.updateRotatedHeaderState();\r\n    this.table.widthChanged();\r\n  }\r\n\r\n  private updateUpdateAbles() {\r\n    for (const u of this.updateAbles) {\r\n      u(this.ctx);\r\n    }\r\n  }\r\n\r\n  private updateSlopeGraphs(rankings: EngineRanking[] = this.rankings) {\r\n    const indices = new Set(rankings.map((d) => this.rankings.indexOf(d)));\r\n\r\n    for (let i = 0; i < this.slopeGraphs.length; ++i) {\r\n      const s = this.slopeGraphs[i];\r\n      if (s.hidden) {\r\n        return;\r\n      }\r\n      const left = i;\r\n      const right = i + 1;\r\n      if (!indices.has(left) && !indices.has(right)) {\r\n        return;\r\n      }\r\n      const leftRanking = this.rankings[left];\r\n      const rightRanking = this.rankings[right];\r\n      s.rebuild(leftRanking.ranking, leftRanking.currentData, leftRanking.context, rightRanking.ranking, rightRanking.currentData, rightRanking.context);\r\n    }\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\r\n    const found = this.rankings.map((r) => r.setHighlight(dataIndex));\r\n    this.fire(EngineRenderer.EVENT_HIGHLIGHT_CHANGED, dataIndex);\r\n    if (this.rankings.length === 0 || dataIndex < 0) {\r\n      return false;\r\n    }\r\n    if (!scrollIntoView) {\r\n      return found[0]!;\r\n    }\r\n    return this.rankings[0].scrollIntoView(dataIndex);\r\n  }\r\n\r\n  setHighlightToNearest(dataIndices: number[], scrollIntoView: boolean) {\r\n    if (this.rankings.length === 0) {\r\n      return false;\r\n    }\r\n    const nearest = this.rankings[0].findNearest(dataIndices);\r\n    if (nearest >= 0) {\r\n      return this.setHighlight(nearest, scrollIntoView);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getHighlight() {\r\n    for (const ranking of this.rankings) {\r\n      const h = ranking.getHighlight();\r\n      if (h >= 0) {\r\n        return h;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  enableHighlightListening(enable: boolean) {\r\n    for (const ranking of this.rankings) {\r\n      ranking.enableHighlightListening(enable);\r\n    }\r\n    this.enabledHighlightListening = enable;\r\n  }\r\n\r\n  destroy() {\r\n    this.takeDownProvider();\r\n    this.table.destroy();\r\n    this.node.remove();\r\n  }\r\n}\r\n\r\n","\r\n\r\n/**\r\n * caches parsing of html strings in a dom element cache\r\n * @param doc the doc to create the elements under\r\n * @internal\r\n */\r\nexport default function domElementCache(doc: Document): (html: string) => HTMLElement {\r\n  const cache = new Map<string, HTMLElement>();\r\n\r\n  const helper = doc.createElement('div');\r\n\r\n  return (html: string) => {\r\n    if (cache.has(html)) {\r\n      return <HTMLElement>cache.get(html)!.cloneNode(true);\r\n    }\r\n\r\n    helper.innerHTML = html;\r\n    const node = <HTMLElement>helper.firstElementChild!;\r\n    // keep a copy\r\n    cache.set(html, <HTMLElement>node.cloneNode(true));\r\n\r\n    return node;\r\n  };\r\n}\r\n","import {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\nimport APopup from './APopup';\r\n\r\n/** @internal */\r\nexport default class ChooseRankingDialog extends APopup {\r\n\r\n  constructor(private readonly items: HTMLElement[], dialog: IDialogContext) {\r\n    super(dialog);\r\n  }\r\n\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('more-options'), cssClass('choose-options'));\r\n    for (const item of this.items) {\r\n      node.appendChild(item);\r\n    }\r\n  }\r\n}\r\n","import {clear, AEventDispatcher, IEventListener} from '../../internal';\r\nimport {cssClass} from '../../styles';\r\n\r\nexport interface IItem {\r\n  id: string;\r\n  text: string;\r\n}\r\n\r\nexport interface IGroupSearchItem<T extends IItem> {\r\n  text: string;\r\n  children: (T | IGroupSearchItem<T>)[];\r\n}\r\n\r\nfunction isItem<T extends IItem>(v: T | IGroupSearchItem<T>): v is T {\r\n  return (<T>v).id !== undefined;\r\n}\r\n\r\nexport interface ISearchBoxOptions<T extends IItem> {\r\n  doc: Document;\r\n\r\n  formatItem(item: T | IGroupSearchItem<T>, node: HTMLElement): string;\r\n\r\n  placeholder: string;\r\n}\r\n\r\n/**\r\n * @asMemberOf SearchBox\r\n * @event\r\n */\r\nexport declare function select(item: any): void;\r\n\r\n\r\nexport default class SearchBox<T extends IItem> extends AEventDispatcher {\r\n  static readonly EVENT_SELECT = 'select';\r\n\r\n  private readonly options: Readonly<ISearchBoxOptions<T>> = {\r\n    formatItem: (item) => item.text,\r\n    doc: document,\r\n    placeholder: 'Select...',\r\n  };\r\n\r\n  readonly node: HTMLElement;\r\n  private search: HTMLInputElement;\r\n  private body: HTMLElement;\r\n\r\n  private readonly itemTemplate: HTMLElement;\r\n  private readonly groupTemplate: HTMLElement;\r\n\r\n  private values: (T | IGroupSearchItem<T>)[] = [];\r\n\r\n  constructor(options: Partial<ISearchBoxOptions<T>> = {}) {\r\n    super();\r\n    Object.assign(this.options, options);\r\n\r\n    this.node = this.options.doc.createElement('div');\r\n    this.node.classList.add(cssClass('search'));\r\n    this.node.innerHTML = `<input class=\"${cssClass('search-input')}\" type=\"search\" placeholder=\"${this.options.placeholder}\">\r\n    <ul class=\"${cssClass('search-list')}\"></ul>`;\r\n\r\n    this.search = <HTMLInputElement>this.node.firstElementChild!;\r\n    this.body = <HTMLElement>this.node.lastElementChild!;\r\n\r\n    this.search.onfocus = () => this.focus();\r\n    this.search.onblur = () => this.blur();\r\n    this.search.oninput = () => this.filter();\r\n    this.search.onkeydown = (evt) => this.handleKey(evt);\r\n\r\n\r\n    this.itemTemplate = this.options.doc.createElement('li');\r\n    this.itemTemplate.classList.add(cssClass('search-item'));\r\n    this.itemTemplate.innerHTML = `<span></span>`;\r\n    this.groupTemplate = this.options.doc.createElement('li');\r\n    this.groupTemplate.classList.add(cssClass('search-group'));\r\n    this.groupTemplate.innerHTML = `<span></span><ul></ul>`;\r\n  }\r\n\r\n  get data() {\r\n    return this.values;\r\n  }\r\n\r\n  set data(data: (T | IGroupSearchItem<T>)[]) {\r\n    this.values = data;\r\n    clear(this.body);\r\n    this.buildDialog(this.body, this.values);\r\n  }\r\n\r\n  private buildDialog(node: HTMLElement, values: (T | IGroupSearchItem<T>)[]) {\r\n    for (const v of values) {\r\n      let li: HTMLElement;\r\n      if (isItem(v)) {\r\n        li = <HTMLElement>this.itemTemplate.cloneNode(true);\r\n        li.onmousedown = (evt) => {\r\n          // see https://stackoverflow.com/questions/10652852/jquery-fire-click-before-blur-event#10653160\r\n          evt.preventDefault();\r\n        };\r\n        li.onclick = () => this.select(v);\r\n        li.onmouseenter = () => this.highlighted = li;\r\n        li.onmouseleave = () => this.highlighted = null;\r\n        node.appendChild(li);\r\n      } else {\r\n        li = <HTMLElement>this.groupTemplate.cloneNode(true);\r\n        this.buildDialog(<HTMLElement>li.lastElementChild!, v.children);\r\n        node.appendChild(li);\r\n      }\r\n      const item = <HTMLElement>li.firstElementChild!;\r\n      item.innerHTML = this.options.formatItem(v, item);\r\n    }\r\n  }\r\n\r\n  private handleKey(evt: KeyboardEvent) {\r\n    const KEYS = {\r\n      ESC: 27,\r\n      ENTER: 13,\r\n      UP: 38,\r\n      DOWN: 40\r\n    };\r\n    switch (evt.which) {\r\n      case KEYS.ESC:\r\n        this.search.blur();\r\n        break;\r\n      case KEYS.ENTER:\r\n        const h = this.highlighted;\r\n        if (h) {\r\n          h.click();\r\n        }\r\n        break;\r\n      case KEYS.UP:\r\n        this.highlightPrevious();\r\n        break;\r\n      case KEYS.DOWN:\r\n        this.highlightNext();\r\n        break;\r\n    }\r\n  }\r\n\r\n  private select(item: T) {\r\n    this.search.value = ''; // reset\r\n    this.search.blur();\r\n    this.fire(SearchBox.EVENT_SELECT, item);\r\n  }\r\n\r\n  focus() {\r\n    this.body.style.width = `${this.search.offsetWidth}px`;\r\n    this.highlighted = <HTMLElement>this.body.firstElementChild || null;\r\n    this.node.classList.add(cssClass('search-open'));\r\n  }\r\n\r\n  private get highlighted() {\r\n    return <HTMLElement>this.body.getElementsByClassName(cssClass('search-highlighted'))[0] || null;\r\n  }\r\n\r\n  private set highlighted(value: HTMLElement | null) {\r\n    const old = this.highlighted;\r\n    if (old === value) {\r\n      return;\r\n    }\r\n    if (old) {\r\n      old.classList.remove(cssClass('search-highlighted'));\r\n    }\r\n    if (value) {\r\n      value.classList.add(cssClass('search-highlighted'));\r\n    }\r\n  }\r\n\r\n  private highlightNext() {\r\n    const h = this.highlighted;\r\n    if (!h || h.classList.contains(cssClass('hidden'))) {\r\n      this.highlighted = <HTMLElement>this.body.querySelector(`.${cssClass('search-item')}:not(.${cssClass('hidden')})`) || null;\r\n      return;\r\n    }\r\n\r\n    const items = <HTMLElement[]>Array.from(this.body.querySelectorAll(`.${cssClass('search-item')}:not(.${cssClass('hidden')})`));\r\n    const index = items.indexOf(h);\r\n    this.highlighted = items[index + 1] || null;\r\n  }\r\n\r\n  private highlightPrevious() {\r\n    const h = this.highlighted;\r\n    const items = <HTMLElement[]>Array.from(this.body.querySelectorAll(`.${cssClass('search-item')}:not(.${cssClass('hidden')})`));\r\n\r\n    if (!h || h.classList.contains(cssClass('hidden'))) {\r\n      this.highlighted = items[items.length - 1] || null;\r\n      return;\r\n    }\r\n    const index = items.indexOf(h);\r\n    this.highlighted = items[index - 1] || null;\r\n  }\r\n\r\n  private blur() {\r\n    this.search.value = '';\r\n    // clear filter\r\n    this.filterResults(this.body, '');\r\n    this.node.classList.remove(cssClass('search-open'));\r\n  }\r\n\r\n  private filter() {\r\n    const empty = this.filterResults(this.body, this.search.value.toLowerCase());\r\n    this.body.classList.toggle(cssClass('search-empty'), empty);\r\n  }\r\n\r\n  private filterResults(node: HTMLElement, text: string) {\r\n    if (text === '') {\r\n      // show all\r\n      (<HTMLElement[]>Array.from(node.getElementsByClassName(cssClass('hidden')))).forEach((d: HTMLElement) => d.classList.remove(cssClass('hidden')));\r\n      return false;\r\n    }\r\n    const children = Array.from(node.children);\r\n    children.forEach((d) => {\r\n      const content = d.firstElementChild!.innerHTML.toLowerCase();\r\n      let hidden = !content.includes(text);\r\n      if (d.classList.contains(cssClass('search-group'))) {\r\n        const ul = <HTMLElement>d.lastElementChild!;\r\n        const allChildrenHidden = this.filterResults(ul, text);\r\n        hidden = hidden && allChildrenHidden;\r\n      }\r\n      d.classList.toggle(cssClass('hidden'), hidden);\r\n    });\r\n\r\n    return children.every((d) => d.classList.contains(cssClass('hidden')));\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SearchBox.EVENT_SELECT]);\r\n  }\r\n\r\n  on(type: typeof SearchBox.EVENT_SELECT, listener: typeof select | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n}\r\n","import {Ranking} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {cssClass} from '../../styles';\r\n\r\n/** @internal */\r\nexport default class RenameRankingDialog extends ADialog {\r\n\r\n  private readonly before: string;\r\n\r\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      livePreview: 'rename'\r\n    });\r\n    this.before = ranking.getLabel();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('dialog-rename'));\r\n    node.insertAdjacentHTML('beforeend', `\r\n      <input type=\"text\" value=\"${this.ranking.getLabel()}\" required autofocus placeholder=\"name\">`);\r\n  }\r\n\r\n  protected reset() {\r\n    this.findInput('input[type=\"text\"]').value = this.before;\r\n  }\r\n\r\n  protected cancel() {\r\n    this.ranking.setLabel(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    const newValue = this.findInput('input[type=\"text\"]').value;\r\n    this.ranking.setLabel(newValue);\r\n    return true;\r\n  }\r\n}\r\n","import {Ranking} from '../../model';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {dialogContext, IDialogContext} from './ADialog';\r\nimport RenameRankingDialog from './RenameRankingDialog';\r\nimport {cssClass} from '../../styles';\r\nimport {actionCSSClass} from '../header';\r\nimport APopup from './APopup';\r\n\r\n/** @internal */\r\nexport default class MoreRankingOptionsDialog extends APopup {\r\n\r\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      autoClose: true\r\n    });\r\n  }\r\n\r\n  private addIcon(node: HTMLElement, title: string, onClick: (evt: MouseEvent) => void) {\r\n    node.insertAdjacentHTML('beforeend', `<i title=\"${title}\" class=\"${actionCSSClass(title)}\"><span>${title}</span> </i>`);\r\n    const i = <HTMLElement>node.lastElementChild;\r\n    i.onclick = (evt) => {\r\n      evt.stopPropagation();\r\n      onClick(evt);\r\n    };\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add(cssClass('more-options'));\r\n    this.addIcon(node, 'Rename', (evt) => {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n      const dialog = new RenameRankingDialog(this.ranking, dialogContext(this.ctx, this.level + 1, <any>evt));\r\n      dialog.open();\r\n    });\r\n    this.addIcon(node, 'Remove', (evt) => {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n      this.destroy('confirm');\r\n      this.ctx.provider.removeRanking(this.ranking);\r\n    });\r\n  }\r\n}\r\n","import {Column} from '../../model';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {IToolbarDialogAddon, IRankingHeaderContext, IToolbarDialogAddonHandler} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default class AddonDialog extends ADialog {\r\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\r\n\r\n  constructor(private readonly column: Column, private readonly addons: IToolbarDialogAddon[], dialog: IDialogContext, private readonly ctx: IRankingHeaderContext, private readonly onClick?: () => void) {\r\n    super(dialog);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    for(const addon of this.addons) {\r\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\r\n      this.handlers.push(addon.append(this.column, node, this.dialog, this.ctx));\r\n    }\r\n  }\r\n\r\n  protected submit(): boolean {\r\n    for (const handler of this.handlers) {\r\n      if (handler.submit() === false) {\r\n        return false;\r\n      }\r\n    }\r\n    if (this.onClick) {\r\n      this.onClick();\r\n    }\r\n    return true;\r\n  }\r\n\r\n  protected cancel() {\r\n    for (const handler of this.handlers) {\r\n      handler.cancel();\r\n    }\r\n  }\r\n\r\n  protected reset() {\r\n    for (const handler of this.handlers) {\r\n      handler.reset();\r\n    }\r\n  }\r\n}\r\n","import {clear} from '../../internal';\r\nimport {Column, Ranking, categoryOf, isSortingAscByDefault, ISortCriteria, isSupportType} from '../../model';\r\nimport {aria, cssClass} from '../../styles';\r\nimport AddonDialog from '../dialogs/AddonDialog';\r\nimport {actionCSSClass, updateHeader} from '../header';\r\nimport {IRankingHeaderContext, IToolbarDialogAddon} from '../interfaces';\r\nimport {getToolbarDialogAddons, isGroupAble, isGroupSortAble, isSortAble} from '../toolbar';\r\nimport SearchBox, {ISearchBoxOptions} from './SearchBox';\r\nimport {dialogContext} from '../dialogs';\r\n\r\ninterface IColumnItem {\r\n  col: Column;\r\n  id: string;\r\n  text: string;\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport default class Hierarchy {\r\n  readonly node: HTMLElement;\r\n  readonly groupAdder: SearchBox<IColumnItem>;\r\n  readonly sortAdder: SearchBox<IColumnItem>;\r\n  readonly groupSortAdder: SearchBox<IColumnItem>;\r\n\r\n  constructor(private readonly ctx: IRankingHeaderContext, document: Document) {\r\n    this.node = document.createElement('aside');\r\n    this.node.classList.add(cssClass('hierarchy'), cssClass('feature-advanced'), cssClass('feature-ranking'));\r\n    this.node.innerHTML = `\r\n      <section class=\"${cssClass('group-hierarchy')}\">\r\n      </section>\r\n      <section class=\"${cssClass('sort-hierarchy')}\">\r\n      </section>\r\n      <section class=\"${cssClass('sort-groups-hierarchy')}\">\r\n      </section>\r\n    `;\r\n    const options = <Partial<ISearchBoxOptions<IColumnItem>>>{\r\n      doc: document,\r\n      placeholder: 'Add Sort Criteria...',\r\n      formatItem: (item: IColumnItem, node: HTMLElement) => {\r\n        node.classList.add(cssClass('typed-icon'));\r\n        node.dataset.typeCat = categoryOf(item.col).name;\r\n        node.dataset.type = item.col.desc.type;\r\n        return item.text;\r\n      },\r\n\r\n    };\r\n    this.groupAdder = new SearchBox(Object.assign({}, options, {\r\n      placeholder: 'Add Grouping Criteria...'\r\n    }));\r\n    this.groupSortAdder = new SearchBox(Object.assign({}, options, {\r\n      placeholder: 'Add Grouping Sort Criteria...'\r\n    }));\r\n    this.sortAdder = new SearchBox(options);\r\n  }\r\n\r\n  update(ranking: Ranking | null) {\r\n    if (!ranking) {\r\n      this.node.style.display = 'none';\r\n      return;\r\n    }\r\n    this.node.style.display = null;\r\n    this.renderGroups(ranking, <HTMLElement>this.node.firstElementChild!);\r\n    this.renderSorting(ranking, <HTMLElement>this.node.children[1]!);\r\n    this.renderGroupSorting(ranking, <HTMLElement>this.node.lastElementChild!);\r\n  }\r\n\r\n  private render<T>(node: HTMLElement, items: T[], toColumn: (item: T) => Column, extras: (item: T, node: HTMLElement) => void, addonKey: string, onChange: (item: T, delta: number) => void) {\r\n    const cache = new Map((<HTMLElement[]>Array.from(node.children)).map((d) => <[string, HTMLElement]>[d.dataset.id, d]));\r\n    clear(node);\r\n\r\n    items.forEach((d) => {\r\n      const col = toColumn(d);\r\n      const item = cache.get(col.id);\r\n      if (item) {\r\n        node.appendChild(item);\r\n        updateHeader(item, col, 0);\r\n        return;\r\n      }\r\n      const addons = getToolbarDialogAddons(col, addonKey, this.ctx);\r\n\r\n      node.insertAdjacentHTML('beforeend', `<div data-id=\"${col.id}\" class=\"${cssClass('toolbar')} ${cssClass('hierarchy-entry')}\">\r\n      <div class=\"${cssClass('label')} ${cssClass('typed-icon')}\">${col.label}</div>\r\n      ${addons.length > 0 ? `<i title=\"Customize\" class=\"${actionCSSClass('customize')}\">${aria('Customize')}</i>` : ''}\r\n      <i title=\"Move Up\" class=\"${actionCSSClass('Move Up')}\">${aria('Move Up')}</i>\r\n      <i title=\"Move Down\" class=\"${actionCSSClass('Move Down')}\">${aria('Move Down')}</i>\r\n      <i title=\"Remove from hierarchy\" class=\"${actionCSSClass('Remove')}\">${aria('Remove from hierarchy')}</i>\r\n      </div>`);\r\n      const last = <HTMLElement>node.lastElementChild!;\r\n\r\n      function prevent(evt: Event) {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n      }\r\n\r\n      (<HTMLElement>last.querySelector('i[title=\"Move Down\"]')!).onclick = (evt) => {\r\n        prevent(evt);\r\n        onChange(d, + 1);\r\n      };\r\n      (<HTMLElement>last.querySelector('i[title=\"Move Up\"]')!).onclick = (evt) => {\r\n        prevent(evt);\r\n        onChange(d, -1);\r\n      };\r\n      (<HTMLElement>last.querySelector('i[title^=Remove]')!).onclick = (evt) => {\r\n        prevent(evt);\r\n        onChange(d, 0);\r\n      };\r\n\r\n      if (addons.length > 0) {\r\n        (<HTMLElement>last.querySelector('i[title=Customize]')!).onclick = (evt) => {\r\n          prevent(evt);\r\n          this.customize(col, addons, <any>evt);\r\n        };\r\n      }\r\n\r\n      extras(d, last);\r\n\r\n      updateHeader(last, col, 0);\r\n    });\r\n  }\r\n\r\n  private renderGroups(ranking: Ranking, node: HTMLElement) {\r\n    const groups = ranking.getGroupCriteria();\r\n\r\n    if (groups.length === 0) {\r\n      clear(node);\r\n      return;\r\n    }\r\n\r\n    const click = (col: Column, delta: number) => {\r\n      if (delta === 0) {\r\n        col.groupByMe();\r\n        return;\r\n      }\r\n      const current = col.isGroupedBy();\r\n      col.findMyRanker()!.groupBy(col, current + delta);\r\n    };\r\n\r\n    const addButton = (_: Column, last: HTMLElement) => {\r\n      last.insertAdjacentHTML('afterbegin', `<i title=\"Group\" class=\"${actionCSSClass('group')}\" data-group=\"true\">${aria('Group')}</i>`);\r\n    };\r\n\r\n    this.render(node, groups, (d) => d, addButton, 'group', click);\r\n    this.addGroupAdder(ranking, groups, node);\r\n  }\r\n\r\n  private renderSorting(ranking: Ranking, node: HTMLElement) {\r\n    const sortCriterias = ranking.getSortCriteria();\r\n\r\n    if (sortCriterias.length === 0) {\r\n      clear(node);\r\n      return;\r\n    }\r\n\r\n    const click = ({col}: ISortCriteria, delta: number) => {\r\n      const current = col.isSortedByMe();\r\n      if (!isFinite(delta)) {\r\n        col.sortByMe(current.asc === 'desc', current.priority);\r\n        return;\r\n      }\r\n      if (delta === 0) {\r\n        col.sortByMe(current.asc === 'asc', -1);\r\n        return;\r\n      }\r\n      col.sortByMe(current.asc === 'asc', current.priority! + delta);\r\n    };\r\n\r\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\r\n      last.insertAdjacentHTML('afterbegin', `\r\n      <i title=\"Sort\" class=\"${actionCSSClass('sort')}\" data-sort=\"${s.asc ? 'asc' : 'desc'}\">${aria('Toggle Sorting')}</i>`);\r\n      (<HTMLElement>last.querySelector('i[title=Sort]')!).onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        click(s, Infinity);\r\n      };\r\n    };\r\n\r\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sort', click);\r\n\r\n    this.addSortAdder(ranking, sortCriterias, node);\r\n  }\r\n\r\n  private renderGroupSorting(ranking: Ranking, node: HTMLElement) {\r\n    const sortCriterias = ranking.getGroupSortCriteria();\r\n\r\n    if (sortCriterias.length === 0) {\r\n      clear(node);\r\n      return;\r\n    }\r\n\r\n    const click = ({col}: ISortCriteria, delta: number) => {\r\n      const current = col.isGroupSortedByMe();\r\n      if (!isFinite(delta)) {\r\n        col.groupSortByMe(current.asc === 'desc', current.priority);\r\n        return;\r\n      }\r\n      if (delta === 0) {\r\n        col.groupSortByMe(current.asc === 'asc', -1);\r\n        return;\r\n      }\r\n      col.groupSortByMe(current.asc === 'asc', current.priority! + delta);\r\n    };\r\n\r\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\r\n      last.insertAdjacentHTML('afterbegin', `\r\n      <i title=\"Sort Group\" class=\"${actionCSSClass('sort-groups')}\" data-sort=\"${s.asc ? 'asc' : 'desc'}\">${aria('Toggle Sorting')}</i>`);\r\n      (<HTMLElement>last.querySelector('i[title=\"Sort Group\"]')!).onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        click(s, Infinity);\r\n      };\r\n    };\r\n\r\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sortGroup', click);\r\n\r\n    this.addGroupSortAdder(ranking, sortCriterias, node);\r\n  }\r\n\r\n  private addAdder(adder: SearchBox<IColumnItem>, ranking: Ranking, addonKey: string, current: Column[], node: HTMLElement, check: (col: Column) => boolean, onSelect: (col: Column) => void) {\r\n    const used = new Set(current);\r\n\r\n    adder.data = ranking.children.filter((col) => !isSupportType(col) && !used.has(col) && check(col)).map((col) => ({col, id: col.id, text: col.label}));\r\n\r\n    adder.on(SearchBox.EVENT_SELECT, (item: IColumnItem) => {\r\n      const addons = getToolbarDialogAddons(item.col, addonKey, this.ctx);\r\n      if (addons.length > 0) {\r\n        this.customize(item.col, addons, adder.node, () => onSelect(item.col));\r\n      } else {\r\n        onSelect(item.col);\r\n      }\r\n    });\r\n\r\n    if (adder.data.length <= 0) {\r\n      return;\r\n    }\r\n\r\n    const wrapper = node.ownerDocument!.createElement('footer');\r\n    wrapper.appendChild(adder.node);\r\n    wrapper.classList.add(cssClass('hierarchy-adder'));\r\n    node.appendChild(wrapper);\r\n  }\r\n\r\n  private addSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\r\n    this.addAdder(this.sortAdder, ranking, 'sort', sortCriterias.map((d) => d.col), node, (d) => isSortAble(d, this.ctx), (col) => {\r\n      ranking.sortBy(col, isSortingAscByDefault(col), sortCriterias.length);\r\n    });\r\n  }\r\n\r\n  private addGroupAdder(ranking: Ranking, groups: Column[], node: HTMLElement) {\r\n    this.addAdder(this.groupAdder, ranking, 'group', groups, node, (d) => isGroupAble(d, this.ctx), (col) => {\r\n      ranking.groupBy(col, groups.length);\r\n    });\r\n  }\r\n\r\n  private addGroupSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\r\n    this.addAdder(this.groupSortAdder, ranking, 'sortGroup', sortCriterias.map((d) => d.col), node, (d) => isGroupSortAble(d, this.ctx), (col) => {\r\n      ranking.groupSortBy(col, isSortingAscByDefault(col), sortCriterias.length);\r\n    });\r\n  }\r\n\r\n  private customize(col: Column, addons: IToolbarDialogAddon[], attachment: HTMLElement, onClick?: () => void) {\r\n    const dialog = new AddonDialog(col, addons, dialogContext(this.ctx, 0, attachment), this.ctx, onClick);\r\n    dialog.open();\r\n  }\r\n}\r\n\r\n","import {Column, isMapAbleColumn, NumberColumn} from '../../model';\r\nimport {IAbortAblePromise} from '../../provider';\r\nimport {ISummaryRenderer} from '../../renderer';\r\nimport {cssClass, engineCssClass} from '../../styles';\r\nimport {createShortcutMenuItems, dragAbleColumn, updateHeader} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {suffix} from '../../internal';\r\n\r\n/** @internal */\r\nexport default class SidePanelEntryVis {\r\n  readonly node: HTMLElement;\r\n  private summary: ISummaryRenderer;\r\n  private summaryUpdater: IAbortAblePromise<void> | null = null;\r\n\r\n  constructor(public readonly column: Column, private ctx: IRankingHeaderContext, document: Document) {\r\n    this.node = document.createElement('article');\r\n    this.node.classList.add(cssClass('side-panel-entry'));\r\n    this.node.dataset.colId = column.id;\r\n    this.node.dataset.type = column.desc.type;\r\n\r\n    this.summary = ctx.summaryRenderer(column, true);\r\n\r\n    this.column.on(suffix('.panel', NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_HEADER), () => {\r\n      this.update();\r\n    });\r\n    this.column.on(suffix('.panel',Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES), () => {\r\n      this.recreateSummary();\r\n    });\r\n    this.init();\r\n    this.update();\r\n  }\r\n\r\n\r\n  private init() {\r\n    this.node.innerHTML = `\r\n      <header class=\"${cssClass('side-panel-entry-header')}\">\r\n        <div class=\"${cssClass('side-panel-labels')}\">\r\n          <span class=\"${cssClass('label')} ${cssClass('typed-icon')} ${cssClass('side-panel-label')}\"></span>\r\n          <span class=\"${cssClass('sublabel')} ${cssClass('side-panel-sublabel')}\"></span>\r\n        </div>\r\n        <div class=\"${cssClass('toolbar')} ${cssClass('side-panel-toolbar')}\"></div>\r\n      </header>`;\r\n    createShortcutMenuItems(<HTMLElement>this.node.querySelector(`.${cssClass('toolbar')}`), 0, this.column, this.ctx, 'sidePanel', false);\r\n    dragAbleColumn(<HTMLElement>this.node.querySelector('header'), this.column, this.ctx);\r\n    this.appendSummary();\r\n  }\r\n\r\n  update(ctx: IRankingHeaderContext = this.ctx) {\r\n    this.ctx = ctx;\r\n    updateHeader(this.node, this.column);\r\n    this.updateSummary();\r\n  }\r\n\r\n  private updateSummary() {\r\n    const summaryNode = <HTMLElement>this.node.querySelector(`.${cssClass('summary')}`)!;\r\n    if (this.summaryUpdater) {\r\n      this.summaryUpdater.abort();\r\n      summaryNode.classList.remove(engineCssClass('loading'));\r\n      this.summaryUpdater = null;\r\n    }\r\n    const r = this.summary.update(summaryNode);\r\n    if (!r) {\r\n      return;\r\n    }\r\n\r\n    this.summaryUpdater = r;\r\n    summaryNode.classList.add(engineCssClass('loading'));\r\n    r.then((a) => {\r\n      if (typeof a === 'symbol') {\r\n        return;\r\n      }\r\n      summaryNode.classList.remove(engineCssClass('loading'));\r\n    });\r\n  }\r\n\r\n  private appendSummary() {\r\n    const summary = this.ctx.asElement(this.summary.template);\r\n    summary.classList.add(cssClass('summary'), cssClass('side-panel-summary'), cssClass('renderer'), cssClass(`renderer-${this.column.getSummaryRenderer()}`));\r\n    summary.dataset.renderer = this.column.getSummaryRenderer();\r\n    summary.dataset.interactive = isMapAbleColumn(this.column).toString();\r\n    this.node.appendChild(summary);\r\n  }\r\n\r\n  private recreateSummary() {\r\n    // remove old summary\r\n    this.node.removeChild(this.node.querySelector(`.${cssClass('summary')}`)!!);\r\n\r\n    this.summary = this.ctx.summaryRenderer(this.column, true);\r\n    this.appendSummary();\r\n    this.updateSummary();\r\n  }\r\n\r\n  destroy() {\r\n    this.column.on(suffix('.panel', NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES), null);\r\n    this.node.remove();\r\n  }\r\n}\r\n","import {clear, suffix} from '../../internal';\r\nimport {Ranking, isSupportType} from '../../model';\r\nimport {aria, cssClass} from '../../styles';\r\nimport MoreRankingOptionsDialog from '../dialogs/MoreRankingOptionsDialog';\r\nimport {actionCSSClass} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {dialogContext} from '../dialogs';\r\nimport Hierarchy from './Hierarchy';\r\nimport {ISidePanelOptions} from './SidePanel';\r\nimport SidePanelEntryVis from './SidePanelEntryVis';\r\n\r\n/** @internal */\r\nexport default class SidePanelRanking {\r\n\r\n  readonly header: HTMLElement;\r\n  readonly dropdown: HTMLElement;\r\n  readonly node: HTMLElement;\r\n\r\n  private readonly hierarchy: Hierarchy | null;\r\n  private readonly entries = new Map<string, SidePanelEntryVis>();\r\n\r\n  constructor(public readonly ranking: Ranking, private ctx: IRankingHeaderContext, document: Document, private readonly options: Readonly<ISidePanelOptions>) {\r\n    this.node = document.createElement('section');\r\n    this.header = document.createElement('div');\r\n    this.dropdown = document.createElement('div');\r\n\r\n    this.node.classList.add(cssClass('side-panel-ranking'));\r\n    this.header.classList.add(cssClass('side-panel-ranking-header'), cssClass('side-panel-ranking-label'));\r\n    this.dropdown.classList.add(cssClass('side-panel-ranking-label'));\r\n\r\n    this.dropdown.innerHTML = this.header.innerHTML = `<span>${ranking.getLabel()}</span><i class=\"${actionCSSClass('more')}\" title=\"More &hellip;\">${aria('More &hellip;')}</i>`;\r\n    (<HTMLElement>this.header.lastElementChild!).onclick = (<HTMLElement>this.dropdown.lastElementChild!).onclick = (evt) => {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n      const dialog = new MoreRankingOptionsDialog(ranking, dialogContext(ctx, 1, <any>evt), ctx);\r\n      dialog.open();\r\n    };\r\n\r\n    this.hierarchy = this.options.hierarchy ? new Hierarchy(ctx, document) : null;\r\n\r\n    this.init();\r\n  }\r\n\r\n  private init() {\r\n    this.node.innerHTML = `<main class=\"${cssClass('side-panel-ranking-main')}\"></main>`;\r\n    if (this.hierarchy) {\r\n      this.node.insertBefore(this.hierarchy.node, this.node.firstChild);\r\n    }\r\n\r\n    if (this.hierarchy) {\r\n      this.ranking.on(suffix('.panel', Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED), () => {\r\n        this.updateHierarchy();\r\n      });\r\n    }\r\n    this.ranking.on(suffix('.panel', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_MOVE_COLUMN), () => {\r\n      this.updateList();\r\n      this.updateHierarchy();\r\n    });\r\n    this.ranking.on(suffix('.panel', Ranking.EVENT_LABEL_CHANGED), () => {\r\n      this.dropdown.firstElementChild!.textContent = this.header.firstElementChild!.textContent = this.ranking.getLabel();\r\n    });\r\n  }\r\n\r\n  get active() {\r\n    return this.node.classList.contains(cssClass('active'));\r\n  }\r\n\r\n  set active(value: boolean) {\r\n    this.node.classList.toggle(cssClass('active'), value);\r\n    this.header.classList.toggle(cssClass('active'), value);\r\n    this.dropdown.classList.toggle(cssClass('active'), value);\r\n    if (value) {\r\n      return;\r\n    }\r\n    this.updateList();\r\n    this.updateHierarchy();\r\n  }\r\n\r\n  update(ctx: IRankingHeaderContext) {\r\n    this.ctx = ctx;\r\n    this.updateList();\r\n    this.updateHierarchy();\r\n  }\r\n\r\n  private updateHierarchy() {\r\n    if (!this.hierarchy || !this.active) {\r\n      return;\r\n    }\r\n    this.hierarchy.update(this.ranking);\r\n  }\r\n\r\n  private updateList() {\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    const node = this.node.querySelector('main')!;\r\n    const columns = this.ranking.flatColumns.filter((d) => !isSupportType(d));\r\n\r\n    if (columns.length === 0) {\r\n      clear(node);\r\n      this.entries.forEach((d) => d.destroy());\r\n      this.entries.clear();\r\n      return;\r\n    }\r\n\r\n    clear(node);\r\n\r\n    const copy = new Map(this.entries);\r\n    this.entries.clear();\r\n\r\n    columns.forEach((col) => {\r\n      const existing = copy.get(col.id);\r\n      if (existing) {\r\n        existing.update(this.ctx);\r\n        node.appendChild(existing.node);\r\n        this.entries.set(col.id, existing);\r\n        copy.delete(col.id);\r\n        return;\r\n      }\r\n\r\n      const entry = new SidePanelEntryVis(col, this.ctx, node.ownerDocument!);\r\n      node.appendChild(entry.node);\r\n      this.entries.set(col.id, entry);\r\n    });\r\n\r\n    copy.forEach((d) => d.destroy());\r\n  }\r\n\r\n  destroy() {\r\n    this.header.remove();\r\n    this.node.remove();\r\n    this.ranking.on(suffix('.panel', Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_MOVE_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_LABEL_CHANGED), null);\r\n\r\n    this.entries.forEach((d) => d.destroy());\r\n    this.entries.clear();\r\n  }\r\n}\r\n","import {suffix} from '../../internal';\r\nimport {categoryOfDesc, IColumnCategory, createAggregateDesc, createGroupDesc, createImpositionDesc, createNestedDesc, createRankDesc, createReduceDesc, createScriptDesc, createSelectionDesc, createStackDesc, IColumnDesc, Ranking} from '../../model';\r\nimport {DataProvider, IDataProvider} from '../../provider';\r\nimport {aria, cssClass} from '../../styles';\r\nimport ChooseRankingDialog from '../dialogs/ChooseRankingDialog';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {dialogContext} from '../dialogs';\r\nimport SearchBox, {IGroupSearchItem, ISearchBoxOptions} from './SearchBox';\r\nimport SidePanelRanking from './SidePanelRanking';\r\nimport {format} from 'd3-format';\r\n\r\n\r\nexport interface IColumnWrapper {\r\n  desc: IColumnDesc;\r\n  category: IColumnCategory;\r\n  id: string;\r\n  text: string;\r\n}\r\n\r\nfunction isWrapper(item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>): item is IColumnWrapper {\r\n  return (<IColumnWrapper>item).desc != null;\r\n}\r\n\r\nexport interface ISidePanelOptions extends Partial<ISearchBoxOptions<IColumnWrapper>> {\r\n  additionalDescs: IColumnDesc[];\r\n  chooser: boolean;\r\n  hierarchy: boolean;\r\n  collapseable: boolean | 'collapsed';\r\n}\r\n\r\nexport default class SidePanel {\r\n\r\n  private readonly options: ISidePanelOptions = {\r\n    additionalDescs: [\r\n      createStackDesc('Weighted Sum'),\r\n      createScriptDesc('Scripted Formula'),\r\n      createNestedDesc('Nested'),\r\n      createReduceDesc(),\r\n      createImpositionDesc(),\r\n      createRankDesc(),\r\n      createSelectionDesc(),\r\n      createGroupDesc(),\r\n      createAggregateDesc(),\r\n    ],\r\n    chooser: true,\r\n    hierarchy: true,\r\n    placeholder: 'Add Column...',\r\n    formatItem: (item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>, node: HTMLElement) => {\r\n      const w: IColumnWrapper = isWrapper(item) ? item : (<IColumnWrapper>item.children[0]);\r\n      node.dataset.typeCat = w.category.name;\r\n      node.classList.add(cssClass('typed-icon'));\r\n      if (isWrapper(item)) {\r\n        node.dataset.type = w.desc.type;\r\n      }\r\n      if (node.parentElement) {\r\n        node.parentElement.classList.add(cssClass('feature-model'));\r\n        node.parentElement.classList.toggle(cssClass('feature-advanced'), w.category.featureLevel === 'advanced');\r\n        node.parentElement.classList.toggle(cssClass('feature-basic'), w.category.featureLevel === 'basic');\r\n      }\r\n      return item.text;\r\n    },\r\n    collapseable: true\r\n  };\r\n\r\n  readonly node: HTMLElement;\r\n  private readonly search: SearchBox<IColumnWrapper> | null;\r\n  private chooser: HTMLElement | null = null;\r\n  private readonly descs: IColumnWrapper[] = [];\r\n  private data: IDataProvider;\r\n  private readonly rankings: SidePanelRanking[] = [];\r\n\r\n  constructor(private ctx: IRankingHeaderContext, document: Document, options: Partial<ISidePanelOptions> = {}) {\r\n    Object.assign(this.options, options);\r\n\r\n    this.node = document.createElement('aside');\r\n    this.node.classList.add(cssClass('side-panel'));\r\n\r\n    this.search = this.options.chooser ? new SearchBox<IColumnWrapper>(this.options) : null;\r\n\r\n    this.data = ctx.provider;\r\n    this.init();\r\n    this.update(ctx);\r\n  }\r\n\r\n  private init() {\r\n    this.node.innerHTML = `\r\n      <aside class=\"${cssClass('stats')}\"></aside>\r\n      <header class=\"${cssClass('side-panel-rankings')}\">\r\n        <i class=\"${cssClass('action')}\" title=\"Choose &hellip;\">${aria('Choose &hellip;')}</i>\r\n      </header>\r\n      <main class=\"${cssClass('side-panel-main')}\"></main>\r\n    `;\r\n\r\n    {\r\n      const choose = <HTMLElement>this.node.querySelector('header > i');\r\n      choose.onclick = (evt) => {\r\n        evt.stopPropagation();\r\n        const dialog = new ChooseRankingDialog(this.rankings.map((d) => d.dropdown), dialogContext(this.ctx, 1, <any>evt));\r\n        dialog.open();\r\n      };\r\n    }\r\n\r\n    if (this.options.collapseable) {\r\n      this.node.insertAdjacentHTML('beforeend', `<div class=\"${cssClass('collapser')}\" title=\"Collapse Panel\">${aria('Collapse Panel')}</div>`);\r\n      const last = <HTMLElement>this.node.lastElementChild;\r\n      last.onclick = () => this.collapsed = !this.collapsed;\r\n      this.collapsed = this.options.collapseable === 'collapsed';\r\n    }\r\n    this.initChooser();\r\n    this.changeDataStorage(null, this.data);\r\n  }\r\n\r\n  private initChooser() {\r\n    if (!this.search) {\r\n      return;\r\n    }\r\n    this.chooser = this.node.ownerDocument!.createElement('header');\r\n    this.chooser.appendChild(this.chooser.ownerDocument!.createElement('form'));\r\n    this.chooser.classList.add(cssClass('side-panel-chooser'));\r\n    this.chooser.firstElementChild!.appendChild(this.search.node);\r\n    this.search.on(SearchBox.EVENT_SELECT, (panel: IColumnWrapper) => {\r\n      const col = this.data.create(panel.desc);\r\n      if (!col) {\r\n        return;\r\n      }\r\n      const a = this.active;\r\n      if (a) {\r\n        a.ranking.push(col);\r\n      }\r\n    });\r\n  }\r\n\r\n  private get active() {\r\n    return this.rankings.find((d) => d.active);\r\n  }\r\n\r\n  private changeDataStorage(old: IDataProvider | null, data: IDataProvider) {\r\n    if (old) {\r\n      old.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING, DataProvider.EVENT_REMOVE_RANKING,\r\n        DataProvider.EVENT_ADD_DESC, DataProvider.EVENT_CLEAR_DESC, DataProvider.EVENT_ORDER_CHANGED, DataProvider.EVENT_SELECTION_CHANGED), null);\r\n    }\r\n    this.data = data;\r\n\r\n    const wrapDesc = (desc: IColumnDesc) => ({\r\n      desc,\r\n      category: categoryOfDesc(desc, data.columnTypes),\r\n      id: `${desc.type}@${desc.label}`,\r\n      text: desc.label\r\n    });\r\n    this.descs.splice(0, this.descs.length, ...data.getColumns().concat(this.options.additionalDescs).map(wrapDesc));\r\n\r\n    data.on(`${DataProvider.EVENT_ADD_DESC}.panel`, (desc) => {\r\n      this.descs.push(wrapDesc(desc));\r\n      this.updateChooser();\r\n    });\r\n\r\n    data.on(`${DataProvider.EVENT_CLEAR_DESC}.panel`, () => {\r\n      this.descs.splice(0, this.descs.length);\r\n      this.updateChooser();\r\n    });\r\n\r\n    data.on(suffix('.panel', DataProvider.EVENT_SELECTION_CHANGED, DataProvider.EVENT_ORDER_CHANGED), () => {\r\n      this.updateStats();\r\n    });\r\n\r\n    data.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING), (ranking: Ranking, index: number) => {\r\n      this.createEntry(ranking, index);\r\n      this.makeActive(index);\r\n    });\r\n\r\n    data.on(suffix('.panel', DataProvider.EVENT_REMOVE_RANKING), (_: Ranking, index: number) => {\r\n      if (index < 0) {\r\n        // remove all\r\n        this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\r\n        this.node.querySelector('header')!.dataset.count = '0';\r\n        this.makeActive(-1);\r\n        return;\r\n      }\r\n      const r = this.rankings.splice(index, 1)[0];\r\n      this.node.querySelector('header')!.dataset.count = String(this.rankings.length);\r\n      r.destroy();\r\n      if (r.active) {\r\n        this.makeActive(this.rankings.length === 0 ? -1 : Math.max(index - 1, 0));\r\n      }\r\n    });\r\n\r\n    this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\r\n    data.getRankings().forEach((d, i) => {\r\n      this.createEntry(d, i);\r\n    });\r\n    if (this.rankings.length > 0) {\r\n      this.makeActive(0);\r\n    }\r\n\r\n    this.updateStats();\r\n  }\r\n\r\n  private createEntry(ranking: Ranking, index: number) {\r\n    const entry = new SidePanelRanking(ranking, this.ctx, this.node.ownerDocument!, this.options);\r\n\r\n    const header = this.node.querySelector('header')!;\r\n    const main = this.node.querySelector('main')!;\r\n\r\n    header.insertBefore(entry.header, header.children[index + 1]); // for the action\r\n    header.dataset.count = String(this.rankings.length + 1);\r\n\r\n    entry.header.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      this.makeActive(this.rankings.indexOf(entry));\r\n    };\r\n    entry.dropdown.onclick = entry.header.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      this.ctx.dialogManager.removeAboveLevel(0);\r\n      this.makeActive(this.rankings.indexOf(entry));\r\n    };\r\n\r\n    main.insertBefore(entry.node, main.children[index]);\r\n\r\n    this.rankings.splice(index, 0, entry);\r\n  }\r\n\r\n  get collapsed() {\r\n    return this.node.classList.contains(cssClass('collapsed'));\r\n  }\r\n\r\n  set collapsed(value: boolean) {\r\n    this.node.classList.toggle(cssClass('collapsed'), value);\r\n    if (value) {\r\n      return;\r\n    }\r\n    this.updateChooser();\r\n    this.updateStats();\r\n    this.updateRanking();\r\n  }\r\n\r\n  private makeActive(index: number) {\r\n    this.rankings.forEach((d, i) => d.active = index === i);\r\n\r\n    const active = this.active;\r\n    if (active && this.chooser) {\r\n      active.node.insertAdjacentElement('afterbegin', this.chooser);\r\n      // scroll to body\r\n      const parent = <HTMLElement>this.node.closest(`.${cssClass()}`)!;\r\n      const body = parent ? parent.querySelector(`article[data-ranking=\"${active.ranking.id}\"]`) : null;\r\n      if (body) {\r\n        body.scrollIntoView();\r\n      }\r\n    }\r\n    this.updateRanking();\r\n  }\r\n\r\n  private updateRanking() {\r\n    const active = this.active;\r\n    if (active && !this.collapsed) {\r\n      active.update(this.ctx);\r\n    }\r\n  }\r\n\r\n  update(ctx: IRankingHeaderContext) {\r\n    const bak = this.data;\r\n    this.ctx = ctx;\r\n    if (ctx.provider !== bak) {\r\n      this.changeDataStorage(bak, ctx.provider);\r\n    }\r\n    this.updateChooser();\r\n    this.updateStats();\r\n\r\n    const active = this.active;\r\n    if (active) {\r\n      active.update(ctx);\r\n    }\r\n  }\r\n\r\n  private updateStats() {\r\n    if (this.collapsed) {\r\n      return;\r\n    }\r\n    const stats = <HTMLElement>this.node.querySelector(`.${cssClass('stats')}`);\r\n    const s = this.data.getSelection();\r\n    const r = this.data.getFirstRanking();\r\n    const f = format(',d');\r\n    const visible = r ? r.getGroups().reduce((a, b) => a + b.order.length, 0) : 0;\r\n    const total = this.data.getTotalNumberOfRows();\r\n    stats.innerHTML = `Showing <strong>${f(visible)}</strong> of ${f(total)} items${s.length > 0 ? `; <span>${f(s.length)} selected</span>` : ''}${visible < total ? ` <i class=\"${cssClass('action')} ${cssClass('action-filter')} ${cssClass('stats-reset')}\" title=\"Reset filters\"><span>Reset</span></i>` : ''}`;\r\n\r\n    const resetButton = stats.querySelector<HTMLElement>(`.${cssClass('stats-reset')}`);\r\n    if (!resetButton) {\r\n      return;\r\n    }\r\n    resetButton.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      this.data.clearFilters();\r\n    };\r\n  }\r\n\r\n  destroy() {\r\n    this.node.remove();\r\n    if (!this.data) {\r\n      return;\r\n    }\r\n    this.rankings.forEach((d) => d.destroy());\r\n    this.rankings.length = 0;\r\n    this.data.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING, DataProvider.EVENT_REMOVE_RANKING,\r\n      DataProvider.EVENT_ADD_DESC), null);\r\n  }\r\n\r\n  private static groupByType(entries: IColumnWrapper[]): {text: string, children: IColumnWrapper[]}[] {\r\n    const map = new Map<IColumnCategory, IColumnWrapper[]>();\r\n    entries.forEach((entry) => {\r\n      if (!map.has(entry.category)) {\r\n        map.set(entry.category, [entry]);\r\n      } else {\r\n        map.get(entry.category)!.push(entry);\r\n      }\r\n    });\r\n    return Array.from(map).map(([key, value]) => {\r\n      return {\r\n        text: key.label,\r\n        order: key.order,\r\n        children: value.sort((a, b) => a.text.localeCompare(b.text))\r\n      };\r\n    }).sort((a, b) => a.order - b.order);\r\n  }\r\n\r\n  private updateChooser() {\r\n    if (!this.search || this.collapsed) {\r\n      return;\r\n    }\r\n    this.search.data = SidePanel.groupByType(this.descs);\r\n  }\r\n}\r\n","import {ILineUpOptions, defaultOptions} from '../config';\r\nimport {merge, suffix} from '../internal';\r\nimport {DataProvider} from '../provider';\r\nimport {cssClass} from '../styles';\r\nimport {ALineUp} from './ALineUp';\r\nimport EngineRenderer from './EngineRenderer';\r\nimport SidePanel from './panel/SidePanel';\r\n\r\nexport default class LineUp extends ALineUp {\r\n  static readonly EVENT_SELECTION_CHANGED = ALineUp.EVENT_SELECTION_CHANGED;\r\n  static readonly EVENT_DIALOG_OPENED = ALineUp.EVENT_DIALOG_OPENED;\r\n  static readonly EVENT_DIALOG_CLOSED = ALineUp.EVENT_DIALOG_CLOSED;\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = ALineUp.EVENT_HIGHLIGHT_CHANGED;\r\n\r\n  private readonly renderer: EngineRenderer | null;\r\n  private readonly panel: SidePanel | null;\r\n\r\n  private readonly options = defaultOptions();\r\n\r\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ILineUpOptions> = {}) {\r\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\r\n\r\n    merge(this.options, options);\r\n\r\n    if (!this.isBrowserSupported) {\r\n      this.renderer = null;\r\n      this.panel = null;\r\n      return;\r\n    }\r\n\r\n    this.node.classList.add(cssClass());\r\n\r\n\r\n    this.renderer = new EngineRenderer(data, this.node, this.options);\r\n    if (this.options.sidePanel) {\r\n      this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\r\n        collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\r\n        hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures\r\n      });\r\n      this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\r\n      this.node.insertBefore(this.panel.node, this.node.firstChild);\r\n    } else {\r\n      this.panel = null;\r\n    }\r\n    this.forward(this.renderer, ...suffix('.main', EngineRenderer.EVENT_HIGHLIGHT_CHANGED, EngineRenderer.EVENT_DIALOG_OPENED, EngineRenderer.EVENT_DIALOG_CLOSED));\r\n  }\r\n\r\n  destroy() {\r\n    this.node.classList.remove(cssClass());\r\n    if (this.renderer) {\r\n      this.renderer.destroy();\r\n    }\r\n    if (this.panel) {\r\n      this.panel.destroy();\r\n    }\r\n    super.destroy();\r\n  }\r\n\r\n  update() {\r\n    if (this.renderer) {\r\n      this.renderer.update();\r\n    }\r\n  }\r\n\r\n  setDataProvider(data: DataProvider, dump?: any) {\r\n    super.setDataProvider(data, dump);\r\n    if (!this.renderer) {\r\n      return;\r\n    }\r\n    this.renderer.setDataProvider(data);\r\n    this.update();\r\n    if (this.panel) {\r\n      this.panel.update(this.renderer.ctx);\r\n    }\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean = true) {\r\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\r\n  }\r\n\r\n  getHighlight() {\r\n    return this.renderer ? this.renderer.getHighlight() : -1;\r\n  }\r\n\r\n  protected enableHighlightListening(enable: boolean) {\r\n    if (this.renderer) {\r\n      this.renderer.enableHighlightListening(enable);\r\n    }\r\n  }\r\n}\r\n","import {IGroupData, IGroupItem, isGroup} from '../../model';\r\nimport {groupEndLevel, ITopNGetter} from '../../provider/internal';\r\n\r\nexport interface IRule {\r\n  apply(data: (IGroupData | IGroupItem)[], availableHeight: number, selection: Set<number>, topNGetter: ITopNGetter): IRuleInstance;\r\n\r\n  levelOfDetail(item: IGroupData | IGroupItem, height: number): 'high' | 'low';\r\n}\r\n\r\nexport interface IRuleInstance {\r\n  item: number | ((item: IGroupItem) => number);\r\n  group: number | ((group: IGroupData) => number);\r\n  violation?: string;\r\n}\r\n\r\n\r\nexport function spaceFillingRule(config: {groupHeight: number, rowHeight: number, groupPadding: number}) {\r\n  function levelOfDetail(item: IGroupData | IGroupItem, height: number): 'high' | 'low' {\r\n    const group = isGroup(item);\r\n    const maxHeight = group ? config.groupHeight : config.rowHeight;\r\n    if (height >= maxHeight * 0.9) {\r\n      return 'high';\r\n    }\r\n    return 'low';\r\n  }\r\n\r\n  function itemHeight(data: (IGroupData | IGroupItem)[], availableHeight: number, selection: Set<number>, topNGetter: ITopNGetter) {\r\n    const visibleHeight = availableHeight - config.rowHeight - 5; // some padding for hover\r\n    const items = <IGroupItem[]>data.filter((d) => !isGroup(d));\r\n    const groups = data.length - items.length;\r\n    const selected = items.reduce((a, d) => a + (selection.has(d.dataIndex) ? 1 : 0), 0);\r\n    const unselected = items.length - selected;\r\n    const groupSeparators = items.reduce((a, d) => a + groupEndLevel(d, topNGetter), 0);\r\n\r\n    if (unselected <= 0) {\r\n      // doesn't matter since all are selected anyhow\r\n      return {height: config.rowHeight, violation: ''};\r\n    }\r\n    const available = visibleHeight - groups * config.groupHeight - groupSeparators * config.groupPadding - selected * config.rowHeight;\r\n\r\n    const height = Math.floor(available / unselected); // round to avoid sub pixel issues\r\n    if (height < 1) {\r\n      return {\r\n        height: 1,\r\n        violation: `Not possible to fit all rows on the screen. Set filters or aggregate groups to make it fit again.`\r\n      };\r\n    }\r\n    // clamp to max height\r\n    if (height > config.rowHeight) {\r\n      return {\r\n        height: config.rowHeight,\r\n        violation: ``\r\n      };\r\n    }\r\n    return {height, violation: ''};\r\n  }\r\n\r\n  return <IRule>{\r\n    apply: (data: (IGroupData | IGroupItem)[], availableHeight: number, selection: Set<number>, topNGetter: ITopNGetter) => {\r\n\r\n      const {violation, height} = itemHeight(data, availableHeight, selection, topNGetter);\r\n\r\n      const item = (item: IGroupItem) => {\r\n        if (selection.has(item.dataIndex)) {\r\n          return config.rowHeight;\r\n        }\r\n        return height;\r\n      };\r\n      return {item, group: config.groupHeight, violation};\r\n    },\r\n    levelOfDetail\r\n  };\r\n}\r\n","import {GridStyleManager} from 'lineupengine';\r\nimport {ILineUpOptions} from '../../config';\r\nimport {debounce, AEventDispatcher, IEventListener, suffix} from '../../internal';\r\nimport {IGroupData, IGroupItem, isGroup, Ranking, IGroup} from '../../model';\r\nimport {DataProvider} from '../../provider';\r\nimport {IRenderContext} from '../../renderer';\r\nimport {IEngineRankingContext} from '../EngineRanking';\r\nimport EngineRenderer from '../EngineRenderer';\r\nimport {IRankingHeaderContext, IRankingHeaderContextContainer} from '../interfaces';\r\nimport {IRule} from './rules';\r\nimport {ADialog} from '../dialogs';\r\n\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf TaggleRenderer\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n/**\r\n * emitted a dialog is opened\r\n * @asMemberOf TaggleRenderer\r\n * @param dialog the opened dialog\r\n * @event\r\n */\r\nexport declare function dialogOpened(dialog: ADialog): void;\r\n/**\r\n * emitted a dialog is closed\r\n * @asMemberOf TaggleRenderer\r\n * @param dialog the closed dialog\r\n * @param action the action how the dialog was closed\r\n * @event\r\n */\r\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\r\n\r\nexport interface ITaggleOptions {\r\n  violationChanged(rule: IRule, violation: string): void;\r\n\r\n  rowPadding: number;\r\n}\r\n\r\nexport default class TaggleRenderer extends AEventDispatcher {\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRenderer.EVENT_HIGHLIGHT_CHANGED;\r\n  static readonly EVENT_DIALOG_OPENED = EngineRenderer.EVENT_DIALOG_OPENED;\r\n  static readonly EVENT_DIALOG_CLOSED = EngineRenderer.EVENT_DIALOG_CLOSED;\r\n\r\n  private isDynamicLeafHeight: boolean = false;\r\n\r\n  private rule: IRule | null = null;\r\n  private levelOfDetail: ((rowIndex: number) => 'high' | 'low') | null = null;\r\n  private readonly resizeListener = () => debounce(() => this.update(), 100);\r\n  private readonly renderer: EngineRenderer;\r\n\r\n  private readonly options: Readonly<ITaggleOptions> = {\r\n    violationChanged: () => undefined,\r\n    rowPadding: 2\r\n  };\r\n\r\n  constructor(public data: DataProvider, parent: HTMLElement, options: (Partial<ITaggleOptions> & Readonly<ILineUpOptions>)) {\r\n    super();\r\n    Object.assign(this.options, options);\r\n\r\n    this.renderer = new EngineRenderer(data, parent, Object.assign({}, options, {\r\n      dynamicHeight: (data: (IGroupData | IGroupItem)[], ranking: Ranking) => {\r\n        const r = this.dynamicHeight(data, ranking);\r\n        if (r) {\r\n          return r;\r\n        }\r\n        return options.dynamicHeight ? options.dynamicHeight(data, ranking) : null;\r\n      },\r\n      levelOfDetail: (rowIndex: number) => this.levelOfDetail ? this.levelOfDetail(rowIndex) : 'high'\r\n    }));\r\n\r\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\r\n      if (this.isDynamicLeafHeight) {\r\n        this.update();\r\n      }\r\n    });\r\n    this.forward(this.renderer, ...suffix('.main', EngineRenderer.EVENT_HIGHLIGHT_CHANGED, EngineRenderer.EVENT_DIALOG_OPENED, EngineRenderer.EVENT_DIALOG_CLOSED));\r\n\r\n    window.addEventListener('resize', this.resizeListener, {\r\n      passive: true\r\n    });\r\n  }\r\n\r\n  get style(): GridStyleManager {\r\n    return this.renderer.style;\r\n  }\r\n\r\n  get ctx(): IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext {\r\n    return this.renderer.ctx;\r\n  }\r\n\r\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\r\n    this.renderer.pushUpdateAble(updateAble);\r\n  }\r\n\r\n  private dynamicHeight(data: (IGroupData | IGroupItem)[], ranking: Ranking) {\r\n    if (!this.rule) {\r\n      this.levelOfDetail = null;\r\n      return null;\r\n    }\r\n\r\n    const availableHeight = this.renderer ? this.renderer.node.querySelector('main')!.clientHeight : 100;\r\n    const topNGetter = (group: IGroup) => this.data.getTopNAggregated(ranking, group);\r\n    const instance = this.rule.apply(data, availableHeight, new Set(this.data.getSelection()), topNGetter);\r\n\r\n    this.isDynamicLeafHeight = typeof instance.item === 'function';\r\n\r\n    this.options.violationChanged(this.rule, instance.violation || '');\r\n\r\n    const height = (item: IGroupItem | IGroupData) => {\r\n      if (isGroup(item)) {\r\n        return typeof instance.group === 'number' ? instance.group : instance.group(item);\r\n      }\r\n      return typeof instance.item === 'number' ? instance.item : instance.item(item);\r\n    };\r\n\r\n    this.levelOfDetail = (rowIndex: number) => {\r\n      const item = data[rowIndex];\r\n      return this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\r\n    };\r\n\r\n    // padding is always 0 since included in height\r\n    // const padding = (item: IGroupData | IGroupItem | null) => {\r\n    //   if (!item) {\r\n    //     item = data[0];\r\n    //   }\r\n    //   const lod = this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\r\n    //   return lod === 'high' ? 0 : 0; // always 0 since\r\n    // };\r\n\r\n    return {\r\n      defaultHeight: typeof instance.item === 'number' ? instance.item : NaN,\r\n      height,\r\n      padding: 0\r\n    };\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([TaggleRenderer.EVENT_HIGHLIGHT_CHANGED, TaggleRenderer.EVENT_DIALOG_OPENED, TaggleRenderer.EVENT_DIALOG_CLOSED]);\r\n  }\r\n\r\n  on(type: typeof TaggleRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: typeof TaggleRenderer.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\r\n  on(type: typeof TaggleRenderer.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n\r\n  zoomOut() {\r\n    this.renderer.zoomOut();\r\n  }\r\n\r\n  zoomIn() {\r\n    this.renderer.zoomIn();\r\n  }\r\n\r\n  switchRule(rule: IRule | null) {\r\n    if (this.rule === rule) {\r\n      return;\r\n    }\r\n    this.rule = rule;\r\n    this.update();\r\n  }\r\n\r\n  destroy() {\r\n    this.renderer.destroy();\r\n    window.removeEventListener('resize', this.resizeListener);\r\n  }\r\n\r\n  update() {\r\n    this.renderer.update();\r\n  }\r\n\r\n  setDataProvider(data: DataProvider) {\r\n    if (this.data) {\r\n      this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, null);\r\n    }\r\n    this.data = data;\r\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\r\n      if (this.isDynamicLeafHeight) {\r\n        this.update();\r\n      }\r\n    });\r\n    this.renderer.setDataProvider(data);\r\n    this.update();\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\r\n    return this.renderer.setHighlight(dataIndex, scrollIntoView);\r\n  }\r\n\r\n  getHighlight() {\r\n    return this.renderer.getHighlight();\r\n  }\r\n\r\n  enableHighlightListening(enable: boolean) {\r\n    this.renderer.enableHighlightListening(enable);\r\n  }\r\n}\r\n","import {GridStyleManager} from 'lineupengine';\r\nimport {defaultOptions} from '../../config';\r\nimport {ITaggleOptions} from '../../config';\r\nimport {merge, suffix} from '../../internal';\r\nimport {DataProvider} from '../../provider';\r\nimport {cssClass, engineCssClass} from '../../styles';\r\nimport {ALineUp} from '../ALineUp';\r\nimport SidePanel from '../panel/SidePanel';\r\nimport {spaceFillingRule} from './rules';\r\nimport TaggleRenderer from './TaggleRenderer';\r\n\r\nexport default class Taggle extends ALineUp {\r\n  static readonly EVENT_SELECTION_CHANGED = ALineUp.EVENT_SELECTION_CHANGED;\r\n  static readonly EVENT_DIALOG_OPENED = ALineUp.EVENT_DIALOG_OPENED;\r\n  static readonly EVENT_DIALOG_CLOSED = ALineUp.EVENT_DIALOG_CLOSED;\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = ALineUp.EVENT_HIGHLIGHT_CHANGED;\r\n\r\n  private readonly spaceFilling: HTMLElement | null;\r\n  private readonly renderer: TaggleRenderer | null;\r\n  private readonly panel: SidePanel | null;\r\n\r\n  private readonly options = defaultOptions();\r\n\r\n\r\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ITaggleOptions> = {}) {\r\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\r\n    merge(this.options, options);\r\n    merge(this.options, {\r\n      violationChanged: (_rule: any, violation?: string) => this.setViolation(violation)\r\n    });\r\n\r\n    if (!this.isBrowserSupported) {\r\n      this.spaceFilling = null;\r\n      this.renderer = null;\r\n      this.panel = null;\r\n      return;\r\n    }\r\n\r\n    this.node.classList.add(cssClass(), cssClass('taggle'));\r\n\r\n    this.renderer = new TaggleRenderer(data, this.node, this.options);\r\n    this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\r\n      collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\r\n      hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures\r\n    });\r\n    this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\r\n    this.node.insertBefore(this.panel.node, this.node.firstChild);\r\n    {\r\n      this.panel.node.insertAdjacentHTML('afterbegin', `<div class=\"${cssClass('rule-button-chooser')} ${cssClass('feature-advanced')} ${cssClass('feature-ui')}\"><label>\r\n            <input type=\"checkbox\">\r\n            <span>Overview</span>\r\n            <div class=\"${cssClass('rule-violation')}\"></div>\r\n          </label></div>`);\r\n      const spaceFilling = spaceFillingRule(this.options);\r\n      this.spaceFilling = <HTMLElement>this.panel.node.querySelector(`.${cssClass('rule-button-chooser')}`)!;\r\n      const input = <HTMLInputElement>this.spaceFilling.querySelector('input');\r\n      input.onchange = () => {\r\n        const selected = this.spaceFilling!.classList.toggle(cssClass('chosen'));\r\n        self.setTimeout(() => {\r\n          this.updateLodRules(selected);\r\n          this.renderer!.switchRule(selected ? spaceFilling : null);\r\n        });\r\n      };\r\n      if (this.options.overviewMode) {\r\n        input.checked = true;\r\n        this.spaceFilling.classList.toggle(cssClass('chosen'));\r\n        this.updateLodRules(true);\r\n        this.renderer.switchRule(spaceFilling);\r\n      }\r\n    }\r\n    this.forward(this.renderer, ...suffix('.main', TaggleRenderer.EVENT_HIGHLIGHT_CHANGED, TaggleRenderer.EVENT_DIALOG_OPENED, TaggleRenderer.EVENT_DIALOG_CLOSED));\r\n  }\r\n\r\n  private updateLodRules(overviewMode: boolean) {\r\n    if (!this.renderer) {\r\n      return;\r\n    }\r\n    updateLodRules(this.renderer.style, overviewMode, this.options);\r\n  }\r\n\r\n  private setViolation(violation?: string) {\r\n    violation = violation || '';\r\n    if (this.spaceFilling) {\r\n      this.spaceFilling.classList.toggle(cssClass('violated'), Boolean(violation));\r\n      this.spaceFilling.querySelector(`.${cssClass('rule-violation')}`)!.innerHTML = violation.replace(/\\n/g, '<br>');\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.node.classList.remove(cssClass(), cssClass('taggle'));\r\n    if (this.renderer) {\r\n      this.renderer.destroy();\r\n    }\r\n    if (this.panel) {\r\n      this.panel.destroy();\r\n    }\r\n    super.destroy();\r\n  }\r\n\r\n  update() {\r\n    if (this.renderer) {\r\n      this.renderer.update();\r\n    }\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean = true) {\r\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\r\n  }\r\n\r\n  getHighlight() {\r\n    return this.renderer ? this.renderer.getHighlight() : -1;\r\n  }\r\n\r\n  protected enableHighlightListening(enable: boolean) {\r\n    if (this.renderer) {\r\n      this.renderer.enableHighlightListening(enable);\r\n    }\r\n  }\r\n\r\n  setDataProvider(data: DataProvider, dump?: any) {\r\n    super.setDataProvider(data, dump);\r\n    if (!this.renderer) {\r\n      return;\r\n    }\r\n    this.renderer.setDataProvider(data);\r\n    this.update();\r\n    this.panel!.update(this.renderer.ctx);\r\n  }\r\n}\r\n\r\nexport function updateLodRules(style: GridStyleManager, overviewMode: boolean, options: Readonly<ITaggleOptions>) {\r\n  if (!overviewMode) {\r\n    style.deleteRule('taggle_lod_rule');\r\n    style.deleteRule('lineup_rowPadding1');\r\n    style.deleteRule('lineup_rowPadding2');\r\n    return;\r\n  }\r\n\r\n  style.updateRule('taggle_lod_rule', `\r\n  .${engineCssClass('tr')}.${cssClass('low')}[data-agg=detail]:hover`, {\r\n    /* show regular height for hovered rows in low + medium LOD */\r\n    height: `${options.rowHeight}px !important`\r\n  });\r\n\r\n  style.updateRule('lineup_rowPadding1', `\r\n  .${engineCssClass('tr')}.${cssClass('low')}`, {\r\n      marginTop: '0'\r\n    });\r\n\r\n  // no margin for hovered low level row otherwise everything will be shifted down and the hover is gone again\r\n  // .${engineCssClass('tr')}.${cssClass('low')}:hover,\r\n\r\n  // padding in general and for hovered low detail rows + their afterwards\r\n  style.updateRule('lineup_rowPadding2', `\r\n  .${engineCssClass('tr')}.${cssClass('low')}.${engineCssClass('highlighted')},\r\n  .${engineCssClass('tr')}.${cssClass('selected')},\r\n  .${engineCssClass('tr')}.${cssClass('low')}:hover + .${engineCssClass('tr')}.${cssClass('low')},\r\n  .${engineCssClass('tr')}.${cssClass('low')}.${engineCssClass('highlighted')} + .${engineCssClass('tr')}.${cssClass('low')},\r\n  .${engineCssClass('tr')}.${cssClass('selected')} + .${engineCssClass('tr')}.${cssClass('low')}`, {\r\n      marginTop: `${options.rowPadding}px !important`\r\n    });\r\n}\r\n","import {IArrayDesc, IColumnDesc} from '../../model';\r\n\r\nexport default class ColumnBuilder<T extends IColumnDesc = IColumnDesc> {\r\n  protected readonly desc: T;\r\n\r\n  constructor(type: string, column: string) {\r\n    this.desc = <any>{column, type, label: column ? column[0].toUpperCase() + column.slice(1): type};\r\n  }\r\n\r\n  /**\r\n   * column label\r\n   */\r\n  label(label: string) {\r\n    this.desc.label = label;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * column summary text (subtitle)\r\n   */\r\n  summary(summary: string) {\r\n    this.desc.summary = summary;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * column description\r\n   */\r\n  description(description: string) {\r\n    this.desc.description = description;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the frozen state of this column, i.e is sticky to the left side when scrolling horizontally\r\n   */\r\n  frozen() {\r\n    this.desc.frozen = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify the renderer to used for this column\r\n   * @param {string} renderer within a cell\r\n   * @param {string} groupRenderer within an aggregated cell\r\n   * @param {string} summaryRenderer within the summary in the header and side panel\r\n   */\r\n  renderer(renderer?: string, groupRenderer?: string, summaryRenderer?: string) {\r\n    if (renderer) {\r\n      this.desc.renderer = renderer;\r\n    }\r\n    if (groupRenderer) {\r\n      this.desc.groupRenderer = groupRenderer;\r\n    }\r\n    if (summaryRenderer) {\r\n      this.desc.summaryRenderer = summaryRenderer;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify a custom additional attribute for the description\r\n   * @param {string} key the property key\r\n   * @param value its value\r\n   */\r\n  custom(key: string, value: any) {\r\n    (<any>this.desc)[key] = value;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the default width of the column\r\n   */\r\n  width(width: number) {\r\n    this.desc.width = width;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the column color in case of numerical columns\r\n   * @deprecated use colorMapping in the number case instead\r\n   */\r\n  color(_color: string) {\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * converts the column type to be an array type, supports only base types: boolean, categorical, date, number, and string\r\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\r\n   */\r\n  asArray(labels?: string[] | number) {\r\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\r\n    this.desc.type += 's';\r\n    const a = <IArrayDesc>this.desc;\r\n    if (Array.isArray(labels)) {\r\n      a.labels = labels;\r\n      a.dataLength = labels.length;\r\n    } else if (typeof labels === 'number') {\r\n      a.dataLength = labels;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * converts the column type to be a map type, supports only base types: categorical, date, number, and string\r\n   */\r\n  asMap() {\r\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\r\n    this.desc.type += 'Map';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * build the column description\r\n   */\r\n  build(_data: any[]): T {\r\n    return <any>this.desc;\r\n  }\r\n}\r\n\r\n/**\r\n * build a column of a given type\r\n * @param {string} type column type\r\n * @param {string} column column which contains the associated data\r\n * @returns {ColumnBuilder<IColumnDesc>}\r\n */\r\nexport function buildColumn(type: string, column: string) {\r\n  return new ColumnBuilder(type, column);\r\n}\r\n","import {IDynamicHeight, ITaggleOptions, ILivePreviewOptions} from '../config';\r\nimport Column, {IGroupData, IGroupItem, Ranking} from '../model';\r\nimport {ICellRendererFactory, ERenderMode} from '../renderer';\r\nimport {IToolbarAction, IToolbarDialogAddon} from '../ui';\r\n\r\n/**\r\n * builder for LineUp/Taggle instance\r\n */\r\nexport default class LineUpBuilder {\r\n  protected readonly options: Partial<ITaggleOptions> = {\r\n    renderers: {},\r\n    toolbarActions: {},\r\n    toolbarDialogAddons: {},\r\n    flags: {}\r\n  };\r\n\r\n  /**\r\n   * option to enable/disable animated transitions\r\n   * @default true\r\n   */\r\n  animated(enable: boolean) {\r\n    this.options.animated = enable;\r\n    return this;\r\n  }\r\n\r\n  livePreviews(options: Partial<ILivePreviewOptions>) {\r\n    this.options.livePreviews = options;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to rotate labels on demand in narrow columns\r\n   * @param rotation rotation in degrees\r\n   * @default 0 - disabled\r\n   */\r\n  labelRotation(rotation: number) {\r\n    this.options.labelRotation = rotation;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enable/disable the side panel\r\n   * @param {boolean} enable enable flag\r\n   * @param {boolean} collapsed whether collapsed by default\r\n   */\r\n  sidePanel(enable: boolean, collapsed: boolean = false) {\r\n    this.options.sidePanel = enable;\r\n    this.options.sidePanelCollapsed = collapsed;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * show the sorting and grouping hierarchy indicator in the side panel\r\n   * @param {boolean} enable enable flag\r\n   */\r\n  hierarchyIndicator(enable: boolean) {\r\n    this.options.hierarchyIndicator = enable;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to specify the default slope graph mode\r\n   * @default 'item'\r\n   */\r\n  defaultSlopeGraphMode(mode: 'item' | 'band') {\r\n    this.options.defaultSlopeGraphMode = mode;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enable/disable showing a summary (histogram, ...) in the header\r\n   * @default true\r\n   */\r\n  summaryHeader(enable: boolean) {\r\n    this.options.summaryHeader = enable;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enforce that the whole row is shown upon hover without overflow hidden\r\n   * @default false\r\n   */\r\n  expandLineOnHover(enable: boolean) {\r\n    this.options.expandLineOnHover = enable;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enable overview mode by default, just valid when building a Taggle instance\r\n   * @returns {this}\r\n   */\r\n  overviewMode() {\r\n    this.options.overviewMode = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to ignore unsupported browser check - at own risk\r\n   * @returns {this}\r\n   */\r\n  ignoreUnsupportedBrowser() {\r\n    this.options.ignoreUnsupportedBrowser = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register a new renderer factory function\r\n   * @param id the rederer id\r\n   * @param factory factory class implementing the renderer\r\n   */\r\n  registerRenderer(id: string, factory: ICellRendererFactory) {\r\n    this.options.renderers![id] = factory;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * custom function whether the given renderer should be allowed to render the give colum in the given mode\r\n   */\r\n  canRender(canRender: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean) {\r\n    this.options.canRender = canRender;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register another toolbar action which can be used within a model class\r\n   * @param id toolbar id\r\n   * @param action\r\n   */\r\n  registerToolbarAction(id: string, action: IToolbarAction) {\r\n    this.options.toolbarActions![id] = action;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register another toolbar action which can be sued within a model class\r\n   * @param id  dialog id\r\n   * @param addon addon description\r\n   */\r\n  registerToolbarDialogAddon(id: string, addon: IToolbarDialogAddon) {\r\n    this.options.toolbarDialogAddons![id] = addon;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * height and padding of a row\r\n   * @default 18 and 2\r\n   */\r\n  rowHeight(rowHeight: number, rowPadding: number = 2) {\r\n    this.options.rowHeight = rowHeight;\r\n    this.options.rowPadding = rowPadding;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * height and padding of an aggregated group in pixel\r\n   * @default 40 and 5\r\n   */\r\n  groupRowHeight(groupHeight: number, groupPadding: number = 5) {\r\n    this.options.groupHeight = groupHeight;\r\n    this.options.groupPadding = groupPadding;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * custom function to compute the height of a row (group or item)\r\n   * @param {(data: (IGroupItem | IGroupData)[], ranking: Ranking) => (IDynamicHeight | null)} callback\r\n   */\r\n  dynamicHeight(callback: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => (IDynamicHeight | null)) {\r\n    this.options.dynamicHeight = callback;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * disables advanced ranking features (sort by, group by, sorting hierarchy, ...)\r\n   */\r\n  disableAdvancedRankingFeatures() {\r\n    this.options.flags!.advancedRankingFeatures = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * disables advanced model features (add combine column, data mapping, edit pattern, ...)\r\n   */\r\n  disableAdvancedModelFeatures() {\r\n    this.options.flags!.advancedModelFeatures = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * disables advanced ui features (change visualization, color mapping)\r\n   */\r\n  disableAdvancedUIFeatures() {\r\n    this.options.flags!.advancedUIFeatures = false;\r\n    return this;\r\n  }\r\n}\r\n","import {\r\n  Column, CompositeColumn, Ranking, ReduceColumn, StackColumn,\r\n  createAggregateDesc, createGroupDesc, createImpositionBoxPlotDesc, createImpositionDesc, createImpositionsDesc,\r\n  createNestedDesc, createRankDesc, createReduceDesc, createScriptDesc, createSelectionDesc, createStackDesc,\r\n  EAdvancedSortMethod, IColumnDesc, ISortCriteria\r\n} from '../model';\r\nimport {DataProvider} from '../provider';\r\n\r\nexport interface IImposeColumnBuilder {\r\n  type: 'impose';\r\n  column: string;\r\n  label?: string;\r\n  colorColumn: string;\r\n}\r\n\r\nexport interface INestedBuilder {\r\n  type: 'nested';\r\n  label?: string;\r\n  columns: string[];\r\n}\r\n\r\nexport interface IWeightedSumBuilder {\r\n  type: 'weightedSum';\r\n  columns: string[];\r\n  label?: string;\r\n  weights: number[];\r\n}\r\n\r\nexport interface IReduceBuilder {\r\n  type: 'min' | 'max' | 'mean' | 'median';\r\n  columns: string[];\r\n  label?: string;\r\n}\r\n\r\nexport interface IScriptedBuilder {\r\n  type: 'script';\r\n  code: string;\r\n  columns: string[];\r\n  label?: string;\r\n}\r\n\r\n/**\r\n * builder for a ranking\r\n */\r\nexport class RankingBuilder {\r\n  private static readonly ALL_MAGIC_FLAG = '*';\r\n\r\n  private readonly columns: (string | {desc: IColumnDesc | ((data: DataProvider) => IColumnDesc), columns: string[], post?: (col: Column) => void })[] = [];\r\n  private readonly sort: {column: string, asc: boolean}[] = [];\r\n  private readonly groupSort: {column: string, asc: boolean}[] = [];\r\n  private readonly groups: string[] = [];\r\n\r\n  /**\r\n   * specify another sorting criteria\r\n   * @param {string} column the column name optionally with encoded sorting separated by colon, e.g. a:desc\r\n   * @param {boolean | \"asc\" | \"desc\"} asc ascending or descending order\r\n   */\r\n  sortBy(column: string, asc: boolean | 'asc' | 'desc' = true) {\r\n    if (column.includes(':')) {\r\n      // encoded sorting order\r\n      const index = column.indexOf(':');\r\n      asc = <'asc' | 'desc'>column.slice(index + 1);\r\n      column = column.slice(0, index);\r\n    }\r\n    this.sort.push({column, asc: asc === true || String(asc)[0] === 'a'});\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify grouping criteria\r\n   * @returns {this}\r\n   */\r\n  groupBy(...columns: (string | string[])[]) {\r\n    for (const col of columns) {\r\n      if (Array.isArray(col)) {\r\n        this.groups.push(...col);\r\n      } else {\r\n        this.groups.push(col);\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify another grouping sorting criteria\r\n   * @param {string} column the column name optionally with encoded sorting separated by colon, e.g. a:desc\r\n   * @param {boolean | \"asc\" | \"desc\"} asc ascending or descending order\r\n   */\r\n  groupSortBy(column: string, asc: boolean | 'asc' | 'desc' = true) {\r\n    if (column.includes(':')) {\r\n      // encoded sorting order\r\n      const index = column.indexOf(':');\r\n      asc = <'asc' | 'desc'>column.slice(index + 1);\r\n      column = column.slice(0, index);\r\n    }\r\n    this.groupSort.push({column, asc: asc === true || String(asc)[0] === 'a'});\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add another column to this ranking, identified by column name or label. magic names are used for special columns:\r\n   * <ul>\r\n   *     <li>'*' = all columns</li>\r\n   *     <li>'_*' = all support columns</li>\r\n   *     <li>'_aggregate' = aggregate column</li>\r\n   *     <li>'_selection' = selection column</li>\r\n   *     <li>'_group' = group column</li>\r\n   *     <li>'_rank' = rank column</li>\r\n   * </ul>\r\n   * In addition build objects for combined columns are supported.\r\n   * @param {string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder} column\r\n   */\r\n  column(column: string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder) {\r\n    if (typeof column === 'string') {\r\n      switch (column) {\r\n        case '_aggregate':\r\n          return this.aggregate();\r\n        case '_selection':\r\n          return this.selection();\r\n        case '_group':\r\n          return this.group();\r\n        case '_rank':\r\n          return this.rank();\r\n        case '_*':\r\n          return this.supportTypes();\r\n        case '*':\r\n          return this.allColumns();\r\n      }\r\n      this.columns.push(column);\r\n      return this;\r\n    }\r\n    const label = column.label || null;\r\n    // builder ish\r\n    switch (column.type) {\r\n      case 'impose':\r\n        return this.impose(label, column.column, column.colorColumn);\r\n      case 'min':\r\n      case 'max':\r\n      case 'median':\r\n      case 'mean':\r\n        console.assert(column.columns.length >= 2);\r\n        return this.reduce(label, <any>column.type, column.columns[0], column.columns[1], ...column.columns.slice(2));\r\n      case 'nested':\r\n        console.assert(column.columns.length >= 1);\r\n        return this.nested(label, column.columns[0], ... column.columns.slice(1));\r\n      case 'script':\r\n        return this.scripted(label, column.code, ...column.columns);\r\n      case 'weightedSum':\r\n        console.assert(column.columns.length >= 2);\r\n        console.assert(column.columns.length === column.weights.length);\r\n        const mixed: (string | number)[] = [];\r\n        column.columns.slice(2).forEach((c, i) => {\r\n          mixed.push(c);\r\n          mixed.push(column.weights[i + 2]);\r\n        });\r\n        return this.weightedSum(label, column.columns[0], column.weights[0], column.columns[1], column.weights[1], ...mixed);\r\n    }\r\n    console.error('invalid column type: ', column);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add an imposed column (numerical column colored by categorical column) to this ranking\r\n   * @param {string | null} label optional label\r\n   * @param {string} numberColumn numerical column reference\r\n   * @param {string} colorColumn categorical column reference\r\n   */\r\n  impose(label: string | null, numberColumn: string, colorColumn: string) {\r\n    this.columns.push({\r\n      desc: (data) => {\r\n        const base = data.getColumns().find((d) => d.label === numberColumn || (<any>d).column === numberColumn);\r\n        switch (base ? base.type : '') {\r\n          case 'boxplot':\r\n            return createImpositionBoxPlotDesc(label ? label : undefined);\r\n          case 'numbers':\r\n            return createImpositionsDesc(label ? label : undefined);\r\n          default:\r\n            return createImpositionDesc(label ? label : undefined);\r\n        }\r\n      },\r\n      columns: [numberColumn, colorColumn]\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a nested / group composite column\r\n   * @param {string | null} label optional label\r\n   * @param {string} column first element of the group enforcing not empty ones\r\n   * @param {string} columns additional columns\r\n   */\r\n  nested(label: string | null, column: string, ...columns: string[]) {\r\n    this.columns.push({\r\n      desc: createNestedDesc(label ? label : undefined),\r\n      columns: [column].concat(columns)\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {IColumnDesc} desc the composite column description\r\n   * @param {string} columns additional columns to add as children\r\n   */\r\n  composite(desc: IColumnDesc, ...columns: string[]) {\r\n    this.columns.push({\r\n      desc,\r\n      columns\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a weighted sum / stack column\r\n   * @param {string | null} label optional label\r\n   * @param {string} numberColumn1 the first numerical column\r\n   * @param {number} weight1 its weight (0..1)\r\n   * @param {string} numberColumn2 the second numerical column\r\n   * @param {number} weight2 its weight (0..1)\r\n   * @param {string | number} numberColumnAndWeights alternating column weight references\r\n   */\r\n  weightedSum(label: string | null, numberColumn1: string, weight1: number, numberColumn2: string, weight2: number, ...numberColumnAndWeights: (string | number)[]) {\r\n    const weights = [weight1, weight2].concat(<number[]>numberColumnAndWeights.filter((_, i) => i % 2 === 1));\r\n    this.columns.push({\r\n      desc: createStackDesc(label ? label : undefined),\r\n      columns: [numberColumn1, numberColumn2].concat(<string[]>numberColumnAndWeights.filter((_, i) => i % 2 === 0)),\r\n      post: (col) => {\r\n        (<StackColumn>col).setWeights(weights);\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add reducing column (min, max, median, mean, ...)\r\n   * @param {string | null} label optional label\r\n   * @param {EAdvancedSortMethod} operation operation to apply (min, max, median, mean, ...)\r\n   * @param {string} numberColumn1 first numerical column\r\n   * @param {string} numberColumn2 second numerical column\r\n   * @param {string} numberColumns additional numerical columns\r\n   */\r\n  reduce(label: string | null, operation: EAdvancedSortMethod, numberColumn1: string, numberColumn2: string, ...numberColumns: string[]) {\r\n    this.columns.push({\r\n      desc: createReduceDesc(label ? label : undefined),\r\n      columns: [numberColumn1, numberColumn2].concat(numberColumns),\r\n      post: (col) => {\r\n        (<ReduceColumn>col).setReduce(operation);\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a scripted / formula column\r\n   * @param {string | null} label optional label\r\n   * @param {string} code the JS code see ScriptColumn for details\r\n   * @param {string} numberColumns additional script columns\r\n   */\r\n  scripted(label: string | null, code: string, ...numberColumns: string[]) {\r\n    this.columns.push({\r\n      desc: Object.assign(createScriptDesc(label ? label : undefined), {script: code}),\r\n      columns: numberColumns\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a selection column for easier multi selections\r\n   */\r\n  selection() {\r\n    this.columns.push({\r\n      desc: createSelectionDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a group column to show the current group name\r\n   */\r\n  group() {\r\n    this.columns.push({\r\n      desc: createGroupDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add an aggregate column to this ranking to collapse/expand groups\r\n   */\r\n  aggregate() {\r\n    this.columns.push({\r\n      desc: createAggregateDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a ranking column\r\n   */\r\n  rank() {\r\n    this.columns.push({\r\n      desc: createRankDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add suporttypes (aggregate, rank, selection) to the ranking\r\n   */\r\n  supportTypes() {\r\n    return this.aggregate().rank().selection();\r\n  }\r\n\r\n  /**\r\n   * add all columns to this ranking\r\n   */\r\n  allColumns() {\r\n    this.columns.push(RankingBuilder.ALL_MAGIC_FLAG);\r\n    return this;\r\n  }\r\n\r\n  build(data: DataProvider): Ranking {\r\n    const r = data.pushRanking();\r\n    const cols = data.getColumns();\r\n\r\n    const findDesc = (c: string) => cols.find((d) => d.label === c || (<any>d).column === c);\r\n\r\n    const addColumn = (c: string) => {\r\n      const desc = findDesc(c);\r\n      if (desc) {\r\n        return data.push(r, desc) != null;\r\n      }\r\n      console.warn('invalid column: ', c);\r\n      return false;\r\n    };\r\n\r\n    this.columns.forEach((c) => {\r\n      if (c === RankingBuilder.ALL_MAGIC_FLAG) {\r\n        cols.forEach((col) => data.push(r, col));\r\n        return;\r\n      }\r\n      if (typeof c === 'string') {\r\n        addColumn(c);\r\n        return;\r\n      }\r\n      const col = data.create(typeof c.desc === 'function' ? c.desc(data) : c.desc)!;\r\n      r.push(col);\r\n      c.columns.forEach((ci) => {\r\n        const d = findDesc(ci);\r\n        const child = d ? data.create(d) : null;\r\n        if (!child) {\r\n          console.warn('invalid column: ', ci);\r\n          return;\r\n        }\r\n        (<CompositeColumn>col).push(child);\r\n      });\r\n      if (c.post) {\r\n        c.post(col);\r\n      }\r\n    });\r\n\r\n    const children = r.children;\r\n    {\r\n      const groups: Column[] = [];\r\n      this.groups.forEach((column) => {\r\n        const col = children.find((d) => d.desc.label === column || (<any>d).desc.column === column);\r\n        if (col) {\r\n          groups.push(col);\r\n          return;\r\n        }\r\n        const desc = findDesc(column);\r\n        if (!desc) {\r\n          console.warn('invalid group criteria column: ', column);\r\n          return;\r\n        }\r\n        const col2 = data.push(r, desc);\r\n        if (col2) {\r\n          groups.push(col2);\r\n          return;\r\n        }\r\n        console.warn('invalid group criteria column: ', column);\r\n      });\r\n      if (groups.length > 0) {\r\n        r.setGroupCriteria(groups);\r\n      }\r\n    }\r\n    {\r\n      const sorts: ISortCriteria[] = [];\r\n      this.sort.forEach(({column, asc}) => {\r\n        const col = children.find((d) => d.desc.label === column || (<any>d).desc.column === column);\r\n        if (col) {\r\n          sorts.push({col, asc});\r\n          return;\r\n        }\r\n        const desc = findDesc(column);\r\n        if (!desc) {\r\n          console.warn('invalid sort criteria column: ', column);\r\n          return;\r\n        }\r\n        const col2 = data.push(r, desc);\r\n        if (col2) {\r\n          sorts.push({col: col2, asc});\r\n          return;\r\n        }\r\n        console.warn('invalid sort criteria column: ', column);\r\n      });\r\n      if (sorts.length > 0) {\r\n        r.setSortCriteria(sorts);\r\n      }\r\n    }\r\n    {\r\n      const sorts: ISortCriteria[] = [];\r\n      this.groupSort.forEach(({column, asc}) => {\r\n        const col = children.find((d) => d.desc.label === column || (<any>d).desc.column === column);\r\n        if (col) {\r\n          sorts.push({col, asc});\r\n          return;\r\n        }\r\n        const desc = findDesc(column);\r\n        if (!desc) {\r\n          console.warn('invalid group sort criteria column: ', column);\r\n          return;\r\n        }\r\n        const col2 = data.push(r, desc);\r\n        if (col2) {\r\n          sorts.push({col: col2, asc});\r\n          return;\r\n        }\r\n        console.warn('invalid group sort criteria column: ', column);\r\n      });\r\n      if (sorts.length > 0) {\r\n        r.setGroupSortCriteria(sorts);\r\n      }\r\n    }\r\n    return r;\r\n  }\r\n}\r\n\r\n/**\r\n * creates a new instance of a ranking builder\r\n * @returns {RankingBuilder}\r\n */\r\nexport function buildRanking() {\r\n  return new RankingBuilder();\r\n}\r\n","import {ICategoricalColumnDesc, ICategory} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\nimport {cleanCategories} from '../../provider/utils';\r\nimport {resolveValue} from '../../internal';\r\n\r\nexport default class CategoricalColumnBuilder extends ColumnBuilder<ICategoricalColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('categorical', column);\r\n  }\r\n\r\n  /**\r\n   * converts this type to an ordinal column type, such that categories are mapped to numbers\r\n   */\r\n  asOrdinal() {\r\n    this.desc.type = 'ordinal';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify the categories of this categorical column\r\n   * @param {(string | Partial<ICategory>)[]} categories\r\n   */\r\n  categories(categories: (string | Partial<ICategory>)[]) {\r\n    this.desc.categories = categories;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * converts this type to a set column, i.e. multiple unique category in a value\r\n   * @param {string} separator optional separator separating a string value\r\n   */\r\n  asSet(separator?: string) {\r\n    if (separator) {\r\n      (<any>this.desc).separator = separator;\r\n    }\r\n    this.desc.type = 'set';\r\n    return this;\r\n  }\r\n\r\n  private derive(data: any[]) {\r\n    // derive categories\r\n    const categories = new Set<string>();\r\n    const isSet = this.desc.type === 'set';\r\n    const separator = (<any>this.desc).separator || ';';\r\n    const val = (vi: any) => {\r\n      if (typeof vi === 'string' && vi !== '') {\r\n        return vi;\r\n      }\r\n      if (vi != null && typeof vi.value === 'string' && vi.value !== '') {\r\n        return vi.value;\r\n      }\r\n      return null;\r\n    };\r\n    const col = (<any>this.desc).column;\r\n    data.forEach((d) => {\r\n      const v = resolveValue(d, col);\r\n      if (Array.isArray(v)) {\r\n        v.forEach((vi) => categories.add(val(vi)));\r\n      } else if (v != null && v !== '') {\r\n        const vs: string[] = isSet ? [v.toString()] : v.toString().split(separator);\r\n        vs.forEach((vi) => categories.add(val(vi)));\r\n      }\r\n    });\r\n    this.categories(cleanCategories(categories));\r\n  }\r\n\r\n  build(data: any[]): ICategoricalColumnDesc {\r\n    if (!this.desc.categories) {\r\n      this.derive(data);\r\n    }\r\n    return super.build(data);\r\n  }\r\n}\r\n\r\n/**\r\n * build a categorical column type\r\n * @param {string} column column which contains the associated data\r\n * @param {(string | Partial<ICategory>)[]} categories optional category definition\r\n * @returns {CategoricalColumnBuilder}\r\n */\r\nexport function buildCategoricalColumn(column: string, categories?: (string | Partial<ICategory>)[]) {\r\n  const r = new CategoricalColumnBuilder(column);\r\n  if (categories) {\r\n    r.categories(categories);\r\n  }\r\n  return r;\r\n}\r\n","import {min, max, resolveValue} from '../../internal';\r\nimport {EAdvancedSortMethod, ESortMethod, INumberColumnDesc, ITypedDump} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\nimport {IScriptMappingFunctionType} from '../../model/MappingFunction';\r\n\r\nexport default class NumberColumnBuilder extends ColumnBuilder<INumberColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('number', column);\r\n  }\r\n\r\n  /**\r\n   * defines the mapping for this number column to normalize the data\r\n   * @param {\"linear\" | \"sqrt\" | \"pow1.1\" | \"pow2\" | \"pow3\"} type mapping type\r\n   * @param {[number , number]} domain input data domain [min, max]\r\n   * @param {[number , number]} range optional output domain [0, 1]\r\n   */\r\n  mapping(type: 'linear' | 'sqrt' | 'pow1.1' | 'pow2' | 'pow3', domain: [number, number], range?: [number, number]) {\r\n    if (type === 'linear') {\r\n      this.desc.domain = domain;\r\n      if (range) {\r\n        this.desc.range = range;\r\n      }\r\n      return this;\r\n    }\r\n    this.desc.map = {\r\n      type, domain, range: range || [0, 1]\r\n    };\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the column color in case of numerical columns\r\n   * @deprecated use colorMapping instead\r\n   */\r\n  color(color: string) {\r\n    return this.colorMapping(color);\r\n  }\r\n\r\n  colorMapping(type: string | ((v: number)=>string) | ITypedDump) {\r\n    this.desc.colorMapping = type;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * d3-format to use for formatting\r\n   * @param format d3-format\r\n   */\r\n  numberFormat(format: string) {\r\n    this.desc.numberFormat = format;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * defines a script to normalize the data, see ScriptedMappingFunction for details\r\n   * @param {string} code the code to execute\r\n   * @param {[number , number]} domain the input data domain [min, max]\r\n   */\r\n  scripted(code: string | IScriptMappingFunctionType, domain: [number, number]) {\r\n    this.desc.map = {domain, code, type: 'script'};\r\n    return this;\r\n  }\r\n\r\n\r\n  /**\r\n   * @inheritDoc\r\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\r\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\r\n   */\r\n  asArray(labels?: string[] | number, sort?: EAdvancedSortMethod) {\r\n    if (sort) {\r\n      (<any>this.desc).sort = sort;\r\n    }\r\n    return super.asArray(labels);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\r\n   */\r\n  asMap(sort?: EAdvancedSortMethod) {\r\n    if (sort) {\r\n      (<any>this.desc).sort = sort;\r\n    }\r\n    return super.asMap();\r\n  }\r\n\r\n  /**\r\n   * converts type to a boxplot column type\r\n   * @param {ESortMethod} sort sorting criteria when sorting by this column\r\n   */\r\n  asBoxPlot(sort?: ESortMethod) {\r\n    if (sort) {\r\n      (<any>this.desc).sort = sort;\r\n    }\r\n    this.desc.type = 'boxplot';\r\n    return this;\r\n  }\r\n\r\n  private derive(data: any[]) {\r\n    const col = (<any>this.desc).column;\r\n\r\n    const asArray = (v: any, extra: string) => {\r\n      const vs: number[] = [];\r\n      (Array.isArray(v) ? v : [v]).forEach((vi) => {\r\n        if (typeof vi === 'number' && !isNaN(vi)) {\r\n          vs.push(vi);\r\n        }\r\n        if (vi != null && typeof vi.value === 'number' && !isNaN(vi.value)) {\r\n          vs.push(vi.value);\r\n        }\r\n        if (vi != null && typeof vi[extra] === 'number' && !isNaN(vi[extra])) {\r\n          vs.push(vi[extra]);\r\n        }\r\n      });\r\n      return vs;\r\n    };\r\n\r\n    const minv = min(data, (d) => {\r\n      const v = resolveValue(d, col);\r\n      const vs: number[] = asArray(v, 'min');\r\n      return vs.length === 0 ? Infinity : min(vs);\r\n    });\r\n    const maxv = max(data, (d) => {\r\n      const v = resolveValue(d, col);\r\n      const vs: number[] = asArray(v, 'max');\r\n      return vs.length === 0 ? -Infinity : max(vs);\r\n    });\r\n    return <[number, number]>[minv, maxv];\r\n  }\r\n\r\n\r\n  build(data: any[]): INumberColumnDesc {\r\n    if (!this.desc.map && !this.desc.domain) {\r\n      // derive domain\r\n      this.mapping('linear', this.derive(data));\r\n    } else {\r\n      const d = this.desc.domain || this.desc.map!.domain;\r\n      if (isNaN(d[0]) || isNaN(d[1])) {\r\n        const ext = this.derive(data);\r\n        if (isNaN(d[0])) {\r\n          d[0] = ext[0];\r\n        }\r\n        if (isNaN(d[1])) {\r\n          d[1] = ext[1];\r\n        }\r\n      }\r\n    }\r\n    return super.build(data);\r\n  }\r\n}\r\n\r\n/**\r\n * builds numerical column builder\r\n * @param {string} column column which contains the associated data\r\n * @param {[number , number]} domain domain (min, max) of this column\r\n * @returns {NumberColumnBuilder}\r\n */\r\nexport function buildNumberColumn(column: string, domain?: [number, number]) {\r\n  const r = new NumberColumnBuilder(column);\r\n  if (domain) {\r\n    r.mapping('linear', domain);\r\n  }\r\n  return r;\r\n}\r\n","import {EAlignment, ILinkColumnDesc} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\n\r\nexport default class StringColumnBuilder extends ColumnBuilder<ILinkColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('string', column);\r\n  }\r\n\r\n  /**\r\n   * makes the text editable within a cell and switches to the annotate type\r\n   */\r\n  editable() {\r\n    this.desc.type = 'annotate';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * changes the alignment of the column\r\n   */\r\n  alignment(align: EAlignment) {\r\n    this.desc.alignment = align;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * allow html text as values\r\n   */\r\n  html() {\r\n    this.desc.escape = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * provide a pattern with which the value will be wrapped, use <code>${value}</code> for the current and and <code>${item}</code> for the whole item\r\n   * @param {string} pattern pattern to apply\r\n   * @param {string[]} templates optional templates for patterns to provide in the edit pattern dialog\r\n   */\r\n  pattern(pattern: string, templates?: string[]) {\r\n    this.desc.type = 'link';\r\n    this.desc.pattern = pattern;\r\n    if (templates) {\r\n      this.desc.patternTemplates = templates;\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\n/**\r\n * builds a string column builder\r\n * @param {string} column column which contains the associated data\r\n * @returns {StringColumnBuilder}\r\n */\r\nexport function buildStringColumn(column: string) {\r\n  return new StringColumnBuilder(column);\r\n}\r\n","import {IDateColumnDesc} from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class DateColumnBuilder extends ColumnBuilder<IDateColumnDesc> {\n\n  constructor(column: string) {\n    super('date', column);\n  }\n\n  /**\n   * specify the format and parsing d3-time pattern to convert Date to strings and vise versa\n   * @param {string} format d3-time-format pattern\n   * @param {string} parse optional different parsing pattern\n   */\n  format(format: string, parse?: string) {\n    this.desc.dateFormat = format;\n    if (parse) {\n      this.desc.dateParse = parse;\n    }\n    return this;\n  }\n\n}\n\n/**\n * builds a date column builder\n * @param {string} column column which contains the associated data\n * @returns {DateColumnBuilder}\n */\nexport function buildDateColumn(column: string) {\n  return new DateColumnBuilder(column);\n}\n","import {IHierarchyColumnDesc, IPartialCategoryNode} from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class HierarchyColumnBuilder extends ColumnBuilder<IHierarchyColumnDesc> {\n\n  constructor(column: string) {\n    super('hierarchy', column);\n  }\n\n  /**\n   * specify the underlying hierarchy of this column\n   * @param {IPartialCategoryNode} hierarchy\n   * @param {string} hierarchySeparator specify the character to separate levels (default dot)\n   */\n  hierarchy(hierarchy: IPartialCategoryNode, hierarchySeparator?: string) {\n    this.desc.hierarchy = hierarchy;\n    if (hierarchySeparator) {\n      this.desc.hierarchySeparator = hierarchySeparator;\n    }\n    return this;\n  }\n\n  build(data: any[]): IHierarchyColumnDesc {\n    console.assert(Boolean(this.desc.hierarchy));\n    return super.build(data);\n  }\n}\n\n/**\n * build a hierarchical column builder\n * @param {string} column column which contains the associated data\n * @param {IPartialCategoryNode} hierarchy\n * @returns {HierarchyColumnBuilder}\n */\nexport function buildHierarchicalColumn(column: string, hierarchy?: IPartialCategoryNode) {\n  const r = new HierarchyColumnBuilder(column);\n  if (hierarchy) {\n    r.hierarchy(hierarchy);\n  }\n  return r;\n}\n","import {IActionColumnDesc, IAction, IGroupAction} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\n\r\nexport default class ActionsColumnBuilder extends ColumnBuilder<IActionColumnDesc> {\r\n\r\n  constructor() {\r\n    super('actions', '');\r\n  }\r\n\r\n  /**\r\n   * adds another action\r\n   * @param action the action\r\n   */\r\n  action(action: IAction) {\r\n    return this.actions([action]);\r\n  }\r\n\r\n  /**\r\n   * adds multiple actions\r\n   * @param actions list of actions\r\n   */\r\n  actions(actions: IAction[]) {\r\n    if (!this.desc.actions) {\r\n      this.desc.actions = [];\r\n    }\r\n    this.desc.actions!.push(...actions);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * adds another action that is shown in group rows\r\n   * @param action the action\r\n   */\r\n  groupAction(action: IGroupAction) {\r\n    return this.groupActions([action]);\r\n  }\r\n\r\n  /**\r\n   * add multiple group actions that are shown in group rows\r\n   * @param actions list of actions\r\n   */\r\n  groupActions(actions: IGroupAction[]) {\r\n    if (!this.desc.groupActions) {\r\n      this.desc.groupActions = [];\r\n    }\r\n    this.desc.groupActions!.push(...actions);\r\n    return this;\r\n  }\r\n}\r\n\r\n/**\r\n * builds a actions column builder\r\n * @returns {ActionsColumnBuilder}\r\n */\r\nexport function buildActionsColumn() {\r\n  return new ActionsColumnBuilder();\r\n}\r\n","import {IBooleanColumnDesc} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\n\r\nexport default class BooleanColumnBuilder extends ColumnBuilder<IBooleanColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('boolean', column);\r\n  }\r\n\r\n  trueMarker(marker: string) {\r\n    this.desc.trueMarker = marker;\r\n    return this;\r\n  }\r\n\r\n  falseMarker(marker: string) {\r\n    this.desc.falseMarker = marker;\r\n    return this;\r\n  }\r\n}\r\n\r\n/**\r\n * builds a boolean column builder\r\n * @param {string} column column which contains the associated data\r\n * @returns {BooleanColumnBuilder}\r\n */\r\nexport function buildBooleanColumn(column: string) {\r\n  return new BooleanColumnBuilder(column);\r\n}\r\n","import {IColumnDesc, IColumnConstructor} from '../model';\r\nimport {DataProvider, LocalDataProvider, deriveColors, deriveColumnDescriptions, IDataProviderOptions, ILocalDataProviderOptions, IAggregationStrategy} from '../provider';\r\nimport {LineUp, Taggle} from '../ui';\r\nimport ColumnBuilder from './column/ColumnBuilder';\r\nimport LineUpBuilder from './LineUpBuilder';\r\nimport {RankingBuilder} from './RankingBuilder';\r\n\r\nexport * from './column';\r\nexport * from './RankingBuilder';\r\n\r\n/**\r\n * builder for a LocalDataProvider along with LineUp configuration options\r\n */\r\nexport class DataBuilder extends LineUpBuilder {\r\n  private readonly columns: (IColumnDesc | ((data: any[]) => IColumnDesc))[] = [];\r\n  private readonly providerOptions: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {\r\n    columnTypes: {}\r\n  };\r\n\r\n  private readonly rankBuilders: ((data: DataProvider) => void)[] = [];\r\n  private _deriveColors: boolean = false;\r\n\r\n  constructor(private readonly data: object[]) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * use the schedulded task executor to asynchronously compute aggregations\r\n   */\r\n  scheduledTaskExecutor() {\r\n    this.providerOptions.taskExecutor = 'scheduled';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * when using a top-n strategy how many items should be shown\r\n   */\r\n  showTopN(n: number) {\r\n    this.providerOptions.showTopN = n;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * change the aggregation strategy that should be used when grouping by a column\r\n   */\r\n  aggregationStrategy(strategy: IAggregationStrategy) {\r\n    this.providerOptions.aggregationStrategy = strategy;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * allow just a single selection\r\n   */\r\n  singleSelection() {\r\n    this.providerOptions.singleSelection = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * filter all rankings by all filters in LineUp\r\n   */\r\n  filterGlobally() {\r\n    this.providerOptions.filterGlobally = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * triggers to derive the column descriptions for the given data\r\n   * @param {string} columns optional enforced order of columns\r\n   */\r\n  deriveColumns(...columns: (string | string[])[]) {\r\n    const cols = (<string[]>[]).concat(...columns);\r\n    for (const c of deriveColumnDescriptions(this.data, {columns: cols})) {\r\n      this.columns.push(c);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tirggers to assign colors for the given descriptions\r\n   */\r\n  deriveColors() {\r\n    this._deriveColors = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register another column type to this data provider\r\n   * @param {string} type unique type id\r\n   * @param {IColumnConstructor} clazz column class\r\n   */\r\n  registerColumnType(type: string, clazz: IColumnConstructor) {\r\n    this.providerOptions.columnTypes![type] = clazz;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * push another column description to this data provider\r\n   * @param {IColumnDesc | ColumnBuilder} column column description or builder instance\r\n   */\r\n  column(column: IColumnDesc | ColumnBuilder | ((data: any[]) => IColumnDesc)) {\r\n    this.columns.push(column instanceof ColumnBuilder ? column.build.bind(column) : column);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * restores a given ranking dump\r\n   * @param dump dump as created using '.dump()'\r\n   */\r\n  restore(dump: any) {\r\n    this.rankBuilders.push((data) => data.restore(dump));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add the default ranking (all columns) to this data provider\r\n   * @param {boolean} addSupportTypes add support types, too, default: true\r\n   */\r\n  defaultRanking(addSupportTypes: boolean = true) {\r\n    this.rankBuilders.push((data) => data.deriveDefault(addSupportTypes));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add another ranking to this data provider\r\n   * @param {((data: DataProvider) => void) | RankingBuilder} builder ranking builder\r\n   */\r\n  ranking(builder: ((data: DataProvider) => void) | RankingBuilder) {\r\n    this.rankBuilders.push(builder instanceof RankingBuilder ? builder.build.bind(builder) : builder);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * builds the data provider itself\r\n   * @returns {LocalDataProvider}\r\n   */\r\n  buildData() {\r\n    // last come survived separted by label to be able to override columns\r\n    const columns: IColumnDesc[] = [];\r\n    const contained = new Set<string>();\r\n    for (const col of this.columns) {\r\n      const c = typeof col === 'function' ? col(this.data) : col;\r\n      const key = `${c.type}@${c.label}`;\r\n      if (!contained.has(key)) {\r\n        columns.push(c);\r\n        contained.add(key);\r\n        continue;\r\n      }\r\n      const oldPos = columns.findIndex((d) => key === `${d.type}@${d.label}`);\r\n      columns.splice(oldPos, 1, c); // replace with new one\r\n    }\r\n    if (this._deriveColors) {\r\n      deriveColors(columns);\r\n    }\r\n    const r = new LocalDataProvider(this.data, columns, this.providerOptions);\r\n    if (this.rankBuilders.length === 0) {\r\n      this.defaultRanking();\r\n    }\r\n    this.rankBuilders.forEach((builder) => builder(r));\r\n    return r;\r\n  }\r\n\r\n  /**\r\n   * builds LineUp at the given parent DOM node\r\n   * @param {HTMLElement} node parent DOM node to attach\r\n   * @returns {LineUp}\r\n   */\r\n  build(node: HTMLElement) {\r\n    return new LineUp(node, this.buildData(), this.options);\r\n  }\r\n\r\n  /**\r\n   * builds Taggle at the given parent DOM node\r\n   * @param {HTMLElement} node parent DOM node to attach\r\n   * @returns {Taggle}\r\n   */\r\n  buildTaggle(node: HTMLElement) {\r\n    return new Taggle(node, this.buildData(), this.options);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * creates a new builder instance for the given data\r\n * @param {object[]} arr data to visualize\r\n * @returns {DataBuilder}\r\n */\r\nexport function builder(arr: object[]) {\r\n  return new DataBuilder(arr);\r\n}\r\n\r\n\r\n/**\r\n * build a new Taggle instance in the given node for the given data\r\n * @param {HTMLElement} node DOM node to attach to\r\n * @param {any[]} data data to visualize\r\n * @param {string[]} columns optional enforced column order\r\n * @returns {Taggle}\r\n */\r\nexport function asTaggle(node: HTMLElement, data: any[], ...columns: string[]): Taggle {\r\n  return builder(data)\r\n    .deriveColumns(columns)\r\n    .deriveColors()\r\n    .defaultRanking()\r\n    .buildTaggle(node);\r\n}\r\n\r\n/**\r\n * build a new LineUp instance in the given node for the given data\r\n * @param {HTMLElement} node DOM node to attach to\r\n * @param {any[]} data data to visualize\r\n * @param {string[]} columns optional enforced column order\r\n * @returns {LineUp}\r\n */\r\nexport function asLineUp(node: HTMLElement, data: any[], ...columns: string[]): LineUp {\r\n  return builder(data)\r\n    .deriveColumns(columns)\r\n    .deriveColors()\r\n    .defaultRanking()\r\n    .build(node);\r\n}\r\n","import {extent, resolveValue} from '../../internal';\r\nimport {IActionColumnDesc, IArrayDesc, IBooleanColumnDesc, ICategoricalColumnDesc, IColumnDesc, IDateColumnDesc, IHierarchyColumnDesc, ILinkColumnDesc, INumberColumnDesc} from '../../model';\r\nimport {IBuilderAdapterActionsColumnDescProps, IBuilderAdapterBooleanColumnDescProps, IBuilderAdapterCategoricalColumnDescProps, IBuilderAdapterColumnDescProps, IBuilderAdapterDateColumnDescProps, IBuilderAdapterHierarchyColumnDescProps, IBuilderAdapterNumberColumnDescProps, IBuilderAdapterStringColumnDescProps} from '.';\r\n\r\nexport function build<T extends IBuilderAdapterColumnDescProps>(props: T, _data?: any[]): IColumnDesc {\r\n  const {column} = props;\r\n  const desc = <any>{column, type: props.type, label: column ? column[0].toUpperCase() + column.slice(1) : props.type};\r\n\r\n  (<(keyof IBuilderAdapterColumnDescProps)[]>['label', 'description', 'frozen', 'width', 'renderer', 'groupRenderer', 'summaryRenderer', 'visible', 'fixed']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n\r\n  if (props.custom) { // merge custom attributes\r\n    Object.assign(desc, props.custom);\r\n  }\r\n\r\n  if (props.asMap) {\r\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\r\n    desc.type += 'Map';\r\n  }\r\n\r\n  if (props.asArray != null) {\r\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\r\n    desc.type += 's';\r\n    const a = <IArrayDesc>desc;\r\n    const labels = props.asArray;\r\n    if (Array.isArray(labels)) {\r\n      a.labels = labels;\r\n      a.dataLength = labels.length;\r\n    } else if (typeof labels === 'number') {\r\n      a.dataLength = labels;\r\n    }\r\n  }\r\n\r\n  return <any>desc;\r\n}\r\n\r\n\r\nexport function buildCategorical(props: IBuilderAdapterCategoricalColumnDescProps, data: any[]): ICategoricalColumnDesc {\r\n  const desc: any = build({...props, type: 'categorical'});\r\n\r\n  if (props.asOrdinal) {\r\n    desc.type = 'ordinal';\r\n  }\r\n  if (props.missingCategory) {\r\n    desc.missingCategory = props.missingCategory;\r\n  }\r\n  if (props.asSet) {\r\n    if (typeof props.asSet === 'string') {\r\n      (<any>desc).separator = props.asSet;\r\n    }\r\n    desc.type = 'set';\r\n  }\r\n\r\n\r\n  if (!props.categories) {\r\n    // derive categories\r\n    const categories = new Set(data.map((d) => <string>resolveValue(d, (<any>desc).column)));\r\n    desc.categories = Array.from(categories).sort();\r\n  } else {\r\n    desc.categories = props.categories;\r\n  }\r\n  return desc;\r\n}\r\n\r\nexport function buildDate(props: IBuilderAdapterDateColumnDescProps): IDateColumnDesc {\r\n  const desc: any = build({...props, type: 'date'});\r\n\r\n  (<(keyof IBuilderAdapterDateColumnDescProps)[]>['dateFormat', 'dateParse']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\nexport function buildHierarchy(props: Partial<IBuilderAdapterHierarchyColumnDescProps>): IHierarchyColumnDesc {\r\n  const desc: any = build({...(<any>props), type: 'hierarchy'});\r\n\r\n  (<(keyof IBuilderAdapterHierarchyColumnDescProps)[]>['hierarchy', 'hierarchySeparator']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\nexport function buildNumber(props: IBuilderAdapterNumberColumnDescProps, data: any[]): INumberColumnDesc {\r\n  const desc: any = build({...props, type: 'number'});\r\n\r\n  const domain = props.domain ? props.domain : <[number, number]>extent(data, (d) => <number>resolveValue(d, (<any>desc).column));\r\n\r\n  if (props.hasOwnProperty('color')) {\r\n    desc.colorMapping = props.color;\r\n  }\r\n  (<(keyof IBuilderAdapterNumberColumnDescProps)[]>['sort', 'colorMapping']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  if (props.scripted) {\r\n    desc.map = {domain, code: props.scripted, type: 'script'};\r\n  } else if (!props.mapping || props.mapping === 'linear') {\r\n    desc.domain = domain;\r\n    if (props.range) {\r\n      desc.range = props.range;\r\n    }\r\n  } else {\r\n    desc.map = {\r\n      type: props.mapping,\r\n      domain,\r\n      range: props.range || [0, 1]\r\n    };\r\n  }\r\n  return desc;\r\n}\r\n\r\nexport function buildString(props: IBuilderAdapterStringColumnDescProps): ILinkColumnDesc {\r\n  const desc: any = build({...props, type: 'string'});\r\n\r\n  (<(keyof IBuilderAdapterStringColumnDescProps)[]>['pattern', 'patternTemplate', 'alignment']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  if (props.editable) {\r\n    desc.type = 'annotate';\r\n  }\r\n  if (props.pattern) {\r\n    desc.type = 'link';\r\n  }\r\n  if (props.html) {\r\n    desc.escape = false;\r\n  }\r\n  return desc;\r\n}\r\n\r\n\r\nexport function buildBoolean(props: IBuilderAdapterBooleanColumnDescProps): IBooleanColumnDesc {\r\n  const desc: any = build({...props, type: 'boolean'});\r\n\r\n  (<(keyof IBuilderAdapterBooleanColumnDescProps)[]>['trueMarker', 'falseMarker']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\nexport function buildActions(props: IBuilderAdapterActionsColumnDescProps): IActionColumnDesc {\r\n  const desc: any = build({...props, type: 'actions'});\r\n\r\n  (<(keyof IBuilderAdapterActionsColumnDescProps)[]>['actions', 'groupActions']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\n","import {buildRanking as buildRankingImpl, INestedBuilder, IReduceBuilder, IScriptedBuilder, IWeightedSumBuilder} from '..';\r\nimport {Ranking} from '../../model';\r\nimport {LocalDataProvider} from '../../provider';\r\nimport {IBuilderAdapterImposeColumnProps, IBuilderAdapterNestedColumnProps, IBuilderAdapterRankingProps, IBuilderAdapterReduceColumnProps, IBuilderAdapterScriptColumnProps, IBuilderAdapterSupportColumnProps, IBuilderAdapterWeightedSumColumnProps} from '.';\r\n\r\n\r\n/*\r\n * build the column description\r\n */\r\nexport function buildRanking(props: IBuilderAdapterRankingProps, data: LocalDataProvider): Ranking {\r\n  const r = buildRankingImpl();\r\n\r\n  if (props.sortBy) {\r\n    const s = Array.isArray(props.sortBy) ? props.sortBy : [props.sortBy];\r\n    s.forEach((si) => {\r\n      if (typeof si === 'string') {\r\n        r.sortBy(si);\r\n      } else {\r\n        r.sortBy(si.column, si.asc);\r\n      }\r\n    });\r\n  }\r\n  if (props.groupBy) {\r\n    const s = Array.isArray(props.groupBy) ? props.groupBy : [props.groupBy];\r\n    r.groupBy(...s);\r\n  }\r\n  if (props.columns) {\r\n    props.columns.forEach((c) => r.column(c));\r\n  }\r\n  return r.build(data);\r\n}\r\n\r\nexport function buildGeneric(props: { column: '*' | string }) {\r\n  return props.column;\r\n}\r\n\r\nexport function buildImposeRanking(props: IBuilderAdapterImposeColumnProps) {\r\n  return <any>Object.assign({\r\n    type: 'impose'\r\n  }, props);\r\n}\r\n\r\n\r\nexport function buildNestedRanking(props: IBuilderAdapterNestedColumnProps, children: string[]) {\r\n  const r: INestedBuilder = {\r\n    type: 'nested',\r\n    columns: children\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\n\r\nexport function buildWeightedSumRanking(props: IBuilderAdapterWeightedSumColumnProps, children: { column: string, weight: number }[]) {\r\n  const r: IWeightedSumBuilder = {\r\n    type: 'weightedSum',\r\n    columns: children.map((d) => d.column),\r\n    weights: children.map((d) => d.weight)\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\nexport function buildReduceRanking(props: IBuilderAdapterReduceColumnProps, children: string[]) {\r\n  const r: IReduceBuilder = {\r\n    type: props.type,\r\n    columns: children\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\nexport function buildScriptRanking(props: IBuilderAdapterScriptColumnProps, children: string[]) {\r\n  const r: IScriptedBuilder = {\r\n    type: 'script',\r\n    code: props.code,\r\n    columns: children\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\nexport function buildSupportRanking(props: IBuilderAdapterSupportColumnProps) {\r\n  return `_${props.type}`;\r\n}\r\n\r\nexport function buildAllColumnsRanking() {\r\n  return '*';\r\n}\r\n","export {equal} from '../../internal';\r\n\r\nexport function isTypeInstance(clazz: any, superClass: any) {\r\n  let c = clazz;\r\n  while (c && c !== superClass) {\r\n    c = c.__proto__;\r\n  }\r\n  return c === superClass;\r\n}\r\n\r\nexport function pick<T extends object>(obj: T, keys: (keyof T)[]): Pick<T, keyof T> {\r\n  const r: Pick<T, keyof T> = <any>{};\r\n  keys.forEach((k) => {\r\n    if (obj.hasOwnProperty(k)) {\r\n      r[k] = obj[k];\r\n    }\r\n  });\r\n  return r;\r\n}\r\n\r\nexport function isSame<T extends object>(current: T, changed: (prop: keyof T) => boolean, props: (keyof T)[]) {\r\n  if (props.every((p) => !changed(p))) {\r\n    return null;\r\n  }\r\n  return pick(current, props);\r\n}\r\n","import {IBuilderAdapter, IBuilderAdapterProps, IBuilderAdapterRankingProps, IChangeDetecter} from '.';\r\nimport {IColumnDesc} from '../../model';\r\nimport {deriveColors, deriveColumnDescriptions, IDataProviderOptions, ILocalDataProviderOptions, LocalDataProvider} from '../../provider';\r\nimport {LineUp, Taggle} from '../../ui';\r\nimport {buildRanking} from './ranking';\r\nimport {equal, isSame, pick} from './utils';\r\n\r\n\r\nconst providerOptions: (keyof IDataProviderOptions | keyof ILocalDataProviderOptions)[] = ['singleSelection', 'filterGlobally', 'columnTypes', 'taskExecutor', 'jumpToSearchResult'];\r\nconst lineupOptions: (keyof IBuilderAdapterProps)[] = ['animated', 'sidePanel', 'sidePanelCollapsed', 'hierarchyIndicator', 'defaultSlopeGraphMode', 'summaryHeader', 'expandLineOnHover', 'overviewMode', 'renderers', 'canRender', 'toolbarActions', 'toolbarDialogAddons', 'rowHeight', 'rowPadding', 'groupHeight', 'groupPadding', 'dynamicHeight', 'labelRotation', 'ignoreUnsupportedBrowser', 'livePreviews'];\r\n\r\ninterface IRankingContext {\r\n  builders: IBuilderAdapterRankingProps[];\r\n  restore: any;\r\n  derive: boolean;\r\n  supportTypes: boolean;\r\n}\r\n\r\ninterface IColumnContext {\r\n  columns: IColumnDesc[];\r\n  deriveColumns: boolean;\r\n  deriveColumnNames: string[];\r\n  deriveColors: boolean;\r\n}\r\n\r\nexport class Adapter {\r\n  private data: LocalDataProvider | null = null;\r\n  private instance: LineUp | Taggle | null = null;\r\n\r\n  private prevRankings: IRankingContext | null = null;\r\n  private prevColumns: IColumnContext | null = null;\r\n  private prevHighlight: number | null = null;\r\n\r\n  private readonly onSelectionChanged = (indices: number[]) => {\r\n    if (this.props.onSelectionChanged && !equal(this.props.selection, indices)) {\r\n      this.props.onSelectionChanged(indices);\r\n    }\r\n  }\r\n\r\n  private readonly onHighlightChanged = (highlight: number) => {\r\n    const prev = this.prevHighlight != null ? this.prevHighlight : -1;\r\n    if (prev === highlight) {\r\n      return;\r\n    }\r\n    this.prevHighlight = highlight;\r\n    if (this.props.onHighlightChanged) {\r\n      this.props.onHighlightChanged(highlight);\r\n    }\r\n  }\r\n\r\n  constructor(private readonly adapter: IBuilderAdapter) {\r\n\r\n  }\r\n\r\n  private get props() {\r\n    return this.adapter.props();\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.data = this.buildProvider();\r\n    this.instance = this.adapter.createInstance(this.data, pick(this.props, lineupOptions));\r\n    this.instance.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\r\n  }\r\n\r\n  private resolveColumnDescs(data: any[]): IColumnContext {\r\n    const columns = this.adapter.columnDescs(data);\r\n    const deriveColumns = columns.length === 0 || Boolean(this.props.deriveColumns);\r\n    const deriveColumnNames = Array.isArray(this.props.deriveColumns) ? this.props.deriveColumns : [];\r\n    const deriveColors = Boolean(this.props.deriveColors);\r\n    return {\r\n      columns,\r\n      deriveColors,\r\n      deriveColumns,\r\n      deriveColumnNames\r\n    };\r\n  }\r\n\r\n  private resolveRankings(): IRankingContext {\r\n    const builders = this.adapter.rankingBuilders();\r\n\r\n    return {\r\n      builders,\r\n      restore: this.props.restore,\r\n      derive: (builders.length === 0 && !this.props.restore) || Boolean(this.props.defaultRanking),\r\n      supportTypes: this.props.defaultRanking !== 'noSupportTypes'\r\n    };\r\n  }\r\n\r\n  private buildColumns(data: any[], ctx: IColumnContext) {\r\n    this.prevColumns = ctx;\r\n    const columns = ctx.columns.map((d) => Object.assign({}, d)); // work on copy\r\n    if (ctx.deriveColumns) {\r\n      const labels = new Set(columns.map((d) => `${d.type}@${d.label}`));\r\n      const derived = deriveColumnDescriptions(data, {columns: ctx.deriveColumnNames});\r\n      for (const derive of derived) {\r\n        if (labels.has(`${derive.type}@${derive.label}`)) { // skip same name\r\n          continue;\r\n        }\r\n        columns.push(derive);\r\n      }\r\n    }\r\n    if (ctx.deriveColors) {\r\n      deriveColors(columns);\r\n    }\r\n    return columns;\r\n  }\r\n\r\n  private buildRankings(data: LocalDataProvider, rankings: IRankingContext) {\r\n    data.clearRankings();\r\n    this.prevRankings = rankings;\r\n    if (rankings.derive) {\r\n      data.deriveDefault(rankings.supportTypes);\r\n    }\r\n    if (rankings.restore) {\r\n      data.restore(rankings.restore);\r\n    }\r\n    rankings.builders.forEach((b) => buildRanking(b, data!));\r\n  }\r\n\r\n  private buildProvider() {\r\n    const columns = this.buildColumns(this.props.data, this.resolveColumnDescs(this.props.data));\r\n    const data = new LocalDataProvider(this.props.data, columns, pick(this.props, providerOptions));\r\n\r\n    this.buildRankings(data, this.resolveRankings());\r\n\r\n    data.setSelection(this.props.selection || []);\r\n    data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\r\n\r\n    return data;\r\n  }\r\n\r\n  private updateLineUp(changeDetector: IChangeDetecter, providerChanged: boolean) {\r\n    // check lineup instance properties\r\n    const changedLineUpOptions = isSame(this.props, changeDetector, lineupOptions);\r\n    if (!changedLineUpOptions) {\r\n      if (providerChanged) {\r\n        this.instance!.setDataProvider(this.data!);\r\n      }\r\n\r\n      if (providerChanged || (this.props.highlight != null && this.prevHighlight !== this.props.highlight)) {\r\n        this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\r\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, null);\r\n        this.instance!.setHighlight(this.prevHighlight);\r\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    // recreate lineup\r\n    if (this.instance) {\r\n      this.instance.destroy();\r\n    }\r\n    this.instance = this.adapter.createInstance(this.data!, changedLineUpOptions);\r\n\r\n    this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\r\n    this.instance!.setHighlight(this.prevHighlight);\r\n    this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\r\n    return true;\r\n  }\r\n\r\n  private updateProvider(changeDetector: IChangeDetecter) {\r\n    const changedProviderOptions = isSame(this.props, changeDetector, providerOptions);\r\n    if (changedProviderOptions || !this.data || changeDetector('data')) {\r\n      // big change start from scratch\r\n      this.data = this.buildProvider();\r\n      return true;\r\n    }\r\n\r\n    const rankings = this.resolveRankings();\r\n    const columns = this.resolveColumnDescs(this.props.data);\r\n    const columnsChanged = !equal(this.prevColumns, columns);\r\n    if (columnsChanged) {\r\n      const descs = this.buildColumns(this.props.data, columns);\r\n      this.data.clearColumns();\r\n      descs.forEach((d) => this.data!.pushDesc(d));\r\n    }\r\n\r\n    if (columnsChanged || !equal(rankings, this.prevRankings)) {\r\n      this.buildRankings(this.data, rankings);\r\n    }\r\n\r\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, null);\r\n    this.data.setSelection(this.props.selection || []);\r\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\r\n    return false;\r\n  }\r\n\r\n  componentDidUpdate(changeDetector: IChangeDetecter) {\r\n    const providerChanged = this.updateProvider(changeDetector);\r\n    this.updateLineUp(changeDetector, providerChanged);\r\n    // this.instance!.update();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.instance) {\r\n      this.instance.destroy();\r\n      this.instance = null;\r\n    }\r\n    this.data = null;\r\n  }\r\n}\r\n","\r\nimport {build, buildCategorical, buildDate, buildHierarchy, buildNumber, buildString, buildActions} from './column';\r\nimport {Adapter} from './lineup';\r\nimport {\r\n  buildAllColumnsRanking,\r\n  buildGeneric,\r\n  buildImposeRanking,\r\n  buildNestedRanking,\r\n  buildRanking,\r\n  buildReduceRanking,\r\n  buildScriptRanking,\r\n  buildSupportRanking,\r\n  buildWeightedSumRanking\r\n} from './ranking';\r\nimport {equal, isSame, isTypeInstance} from './utils';\r\n\r\nexport const builderAdapter = {\r\n  buildString,\r\n  buildNumber,\r\n  buildHierarchy,\r\n  buildDate,\r\n  buildCategorical,\r\n  buildActions,\r\n  build,\r\n  buildGeneric,\r\n  buildWeightedSumRanking,\r\n  buildSupportRanking,\r\n  buildScriptRanking,\r\n  buildReduceRanking,\r\n  buildRanking,\r\n  buildNestedRanking,\r\n  buildImposeRanking,\r\n  buildAllColumnsRanking,\r\n  equal,\r\n  isSame,\r\n  isTypeInstance,\r\n  Adapter\r\n};\r\n","import Column from './Column';\r\nimport ValueColumn from './ValueColumn';\r\nimport {IValueColumnDesc} from './interfaces';\r\n\r\nexport * from './annotations';\r\nexport {isMissingValue, isUnknown, FIRST_IS_NAN, FIRST_IS_MISSING, missingGroup} from './missing';\r\nexport * from './interfaces';\r\nexport * from './ICategoricalColumn';\r\nexport * from './INumberColumn';\r\nexport * from './IDateColumn';\r\nexport * from './IArrayColumn';\r\n\r\nexport {toCategories} from './internalCategorical';\r\n\r\nexport {ScaleMappingFunction, ScriptMappingFunction, mappingFunctions} from './MappingFunction';\r\nexport {DEFAULT_CATEGORICAL_COLOR_FUNCTION, ReplacmentColorMappingFunction} from './CategoricalColorMappingFunction';\r\nexport {CustomColorMappingFunction, DEFAULT_COLOR_FUNCTION, SequentialColorFunction, DivergentColorFunction, UnknownColorFunction, QuantizedColorFunction, SolidColorFunction} from './ColorMappingFunction';\r\n\r\nexport {default as ActionColumn} from './ActionColumn';\r\nexport * from './ActionColumn';\r\nexport {default as AggregateGroupColumn} from './AggregateGroupColumn';\r\nexport * from './AggregateGroupColumn';\r\nexport {default as AnnotateColumn} from './AnnotateColumn';\r\nexport * from './AnnotateColumn';\r\nexport {default as ArrayColumn} from './ArrayColumn';\r\nexport * from './ArrayColumn';\r\nexport {default as BooleanColumn} from './BooleanColumn';\r\nexport * from './BooleanColumn';\r\nexport {default as BooleansColumn} from './BooleansColumn';\r\nexport * from './BooleansColumn';\r\nexport {default as BoxPlotColumn} from './BoxPlotColumn';\r\nexport * from './BoxPlotColumn';\r\nexport {default as CategoricalColumn} from './CategoricalColumn';\r\nexport *from './CategoricalColumn';\r\nexport {default as CategoricalMapColumn} from './CategoricalMapColumn';\r\nexport * from './CategoricalMapColumn';\r\nexport {default as CategoricalsColumn} from './CategoricalsColumn';\r\nexport * from './CategoricalsColumn';\r\nexport {default, default as Column} from './Column';\r\n// no * export\r\nexport {default as CompositeColumn} from './CompositeColumn';\r\n// no * export\r\nexport {default as CompositeNumberColumn} from './CompositeNumberColumn';\r\nexport * from './CompositeNumberColumn';\r\nexport {default as DateColumn} from './DateColumn';\r\nexport * from './DateColumn';\r\nexport {default as DatesColumn} from './DatesColumn';\r\nexport * from './DatesColumn';\r\nexport {default as DatesMapColumn} from './DatesMapColumn';\r\nexport * from './DatesMapColumn';\r\nexport {default as GroupColumn} from './GroupColumn';\r\nexport *from './GroupColumn';\r\nexport {default as HierarchyColumn} from './HierarchyColumn';\r\nexport * from './HierarchyColumn';\r\nexport {default as ImpositionBoxPlotColumn} from './ImpositionBoxPlotColumn';\r\nexport * from './ImpositionBoxPlotColumn';\r\nexport {default as ImpositionCompositeColumn} from './ImpositionCompositeColumn';\r\nexport * from './ImpositionCompositeColumn';\r\nexport {default as ImpositionCompositesColumn} from './ImpositionCompositesColumn';\r\nexport * from './ImpositionCompositesColumn';\r\nexport {default as LinkColumn} from './LinkColumn';\r\nexport * from './LinkColumn';\r\nexport {default as LinkMapColumn} from './LinkMapColumn';\r\nexport * from './LinkMapColumn';\r\nexport {default as LinksColumn} from './LinksColumn';\r\nexport * from './LinksColumn';\r\nexport {default as MapColumn} from './MapColumn';\r\nexport * from './MapColumn';\r\nexport {default as MultiLevelCompositeColumn} from './MultiLevelCompositeColumn';\r\nexport * from './MultiLevelCompositeColumn';\r\nexport {default as NestedColumn} from './NestedColumn';\r\nexport * from './NestedColumn';\r\nexport {default as NumberColumn} from './NumberColumn';\r\nexport * from './NumberColumn';\r\nexport {default as NumberMapColumn} from './NumberMapColumn';\r\nexport * from './NumberMapColumn';\r\nexport {default as NumbersColumn} from './NumbersColumn';\r\nexport * from './NumbersColumn';\r\nexport {default as OrdinalColumn} from './OrdinalColumn';\r\nexport * from './OrdinalColumn';\r\nexport {default as RankColumn} from './RankColumn';\r\nexport * from './RankColumn';\r\nexport {default as Ranking, EDirtyReason} from './Ranking';\r\n// no * export\r\nexport {default as ReduceColumn} from './ReduceColumn';\r\nexport * from './ReduceColumn';\r\nexport {default as ScriptColumn} from './ScriptColumn';\r\nexport * from './ScriptColumn';\r\nexport {default as SelectionColumn} from './SelectionColumn';\r\nexport * from './SelectionColumn';\r\nexport {default as SetColumn} from './SetColumn';\r\nexport * from './SetColumn';\r\nexport {default as StackColumn} from './StackColumn';\r\nexport * from './StackColumn';\r\nexport {default as StringColumn} from './StringColumn';\r\nexport * from './StringColumn';\r\nexport {default as StringsColumn} from './StringsColumn';\r\nexport * from './StringsColumn';\r\nexport {default as StringMapColumn} from './StringMapColumn';\r\nexport * from './StringMapColumn';\r\nexport {default as ValueColumn} from './ValueColumn';\r\n// no * export\r\n\r\n\r\n/**\r\n * defines a new column type\r\n * @param name\r\n * @param functions\r\n * @returns {CustomColumn}\r\n */\r\nexport function defineColumn<T>(name: string, functions: any = {}): typeof Column {\r\n  class CustomColumn extends ValueColumn<T> {\r\n    constructor(id: string, desc: IValueColumnDesc<T>, ...args: any[]) {\r\n      super(id, desc);\r\n      if (typeof (this.init) === 'function') {\r\n        this.init(id, desc, ...args);\r\n      }\r\n    }\r\n\r\n    init(..._args: any[]) {\r\n      // dummy\r\n    }\r\n  }\r\n\r\n  CustomColumn.prototype.toString = () => name;\r\n  CustomColumn.prototype = Object.assign(CustomColumn.prototype, functions);\r\n\r\n  return CustomColumn;\r\n}\r\n","import Column, {IColumnDesc, IDataRow, Ranking, defaultGroup, IndicesArray, IOrderedGroup} from '../model';\r\nimport ACommonDataProvider from './ACommonDataProvider';\r\nimport {IDataProviderOptions} from './interfaces';\r\nimport {DirectRenderTasks} from './DirectRenderTasks';\r\nimport {IRenderTasks} from '../renderer';\r\n\r\n/**\r\n * interface what the server side has to provide\r\n */\r\nexport interface IServerData {\r\n  /**\r\n   * sort the dataset by the given description\r\n   * @param ranking\r\n   */\r\n  sort(ranking: Ranking): Promise<IndicesArray>;\r\n\r\n  /**\r\n   * returns a slice of the data array identified by a list of indices\r\n   * @param indices\r\n   */\r\n  view(indices: number[]): Promise<any[]>;\r\n\r\n  /**\r\n   * returns a sample of the values for a given column\r\n   * @param column\r\n   */\r\n  mappingSample(column: any): Promise<number[]>;\r\n\r\n  /**\r\n   * return the matching indices matching the given arguments\r\n   * @param search\r\n   * @param column\r\n   */\r\n  search(search: string | RegExp, column: any): Promise<number[]>;\r\n}\r\n\r\n\r\nexport interface IRemoteDataProviderOptions {\r\n  /**\r\n   * maximal cache size (unused at the moment)\r\n   */\r\n  maxCacheSize: number;\r\n}\r\n\r\nfunction createIndex2Pos(order: IndicesArray) {\r\n  const index2pos = <number[]>[];\r\n  for (let i = 0; i < order.length; ++i) {\r\n    index2pos[order[i]] = i + 1;\r\n  }\r\n  return index2pos;\r\n}\r\n\r\n/**\r\n * a remote implementation of the data provider\r\n */\r\nexport default class RemoteDataProvider extends ACommonDataProvider {\r\n  private readonly ooptions: IRemoteDataProviderOptions = {\r\n    maxCacheSize: 1000\r\n  };\r\n\r\n  private readonly cache = new Map<number, Promise<IDataRow>>();\r\n\r\n\r\n  constructor(private server: IServerData, columns: IColumnDesc[] = [], options: Partial<IRemoteDataProviderOptions & IDataProviderOptions> = {}) {\r\n    super(columns, options);\r\n    Object.assign(this.ooptions, options);\r\n  }\r\n\r\n  getTotalNumberOfRows() {\r\n    // TODO not correct\r\n    return this.cache.size;\r\n  }\r\n\r\n  getTaskExecutor(): IRenderTasks {\r\n    // FIXME\r\n    return new DirectRenderTasks([]);\r\n  }\r\n\r\n  sort(ranking: Ranking) : Promise<{groups: IOrderedGroup[], index2pos: IndicesArray}> | {groups: IOrderedGroup[], index2pos: IndicesArray} {\r\n    //use the server side to sort\r\n    return this.server.sort(ranking).then((order) => ({groups: [Object.assign({order}, defaultGroup)], index2pos: createIndex2Pos(order)}));\r\n  }\r\n\r\n  private loadFromServer(indices: number[]) {\r\n    return this.server.view(indices).then((view) => {\r\n      //enhance with the data index\r\n      return view.map((v, i) => {\r\n        const dataIndex = indices[i];\r\n        return {v, dataIndex};\r\n      });\r\n    });\r\n  }\r\n\r\n  view(indices: number[]): Promise<any[]> {\r\n    if (indices.length === 0) {\r\n      return Promise.resolve([]);\r\n    }\r\n    const base = this.fetch([indices])[0];\r\n    return Promise.all(base).then((rows) => rows.map((d) => d.v));\r\n  }\r\n\r\n\r\n  private computeMissing(orders: number[][]): number[] {\r\n    const union = new Set<number>();\r\n    const unionAdd = union.add.bind(union);\r\n    orders.forEach((order) => order.forEach(unionAdd));\r\n\r\n    // removed cached\r\n    this.cache.forEach((_v, k) => union.delete(k));\r\n\r\n    if ((this.cache.size + union.size) > this.ooptions.maxCacheSize) {\r\n      // clean up cache\r\n    }\r\n    // const maxLength = Math.max(...orders.map((o) => o.length));\r\n    return Array.from(union);\r\n  }\r\n\r\n  private loadInCache(missing: number[]) {\r\n    if (missing.length === 0) {\r\n      return;\r\n    }\r\n    // load data and map to rows;\r\n    const v = this.loadFromServer(missing);\r\n    missing.forEach((_m, i) => {\r\n      const dataIndex = missing[i];\r\n      this.cache.set(dataIndex, v.then((loaded) => ({v: loaded[i], i: dataIndex})));\r\n    });\r\n  }\r\n\r\n  fetch(orders: number[][]): Promise<IDataRow>[][] {\r\n    const toLoad = this.computeMissing(orders);\r\n    this.loadInCache(toLoad);\r\n\r\n    return orders.map((order) =>\r\n      order.map((i) => this.cache.get(i)!));\r\n  }\r\n\r\n  getRow(index: number) {\r\n    if (this.cache.has(index)) {\r\n      return this.cache.get(index)!;\r\n    }\r\n    this.loadInCache([index]);\r\n    return this.cache.get(index)!;\r\n  }\r\n\r\n\r\n  mappingSample(col: Column): Promise<number[]> {\r\n    return this.server.mappingSample((<any>col.desc).column);\r\n  }\r\n\r\n  searchAndJump(search: string | RegExp, col: Column) {\r\n    this.server.search(search, (<any>col.desc).column).then((indices) => {\r\n      this.jumpToNearest(indices);\r\n    });\r\n  }\r\n}\r\n","export {colorOf} from './impose';\r\nexport * from './interfaces';\r\nexport {renderMissingCanvas, renderMissingDOM} from './missing';\r\n\r\nimport {AAggregatedGroupRenderer} from './AAggregatedGroupRenderer';\r\nimport {ANumbersCellRenderer} from './ANumbersCellRenderer';\r\nimport ActionRenderer from './ActionRenderer';\r\nimport AggregateGroupRenderer from './AggregateGroupRenderer';\r\nimport AnnotationRenderer from './AnnotationRenderer';\r\nimport BarCellRenderer from './BarCellRenderer';\r\nimport BooleanCellRenderer from './BooleanCellRenderer';\r\nimport BoxplotCellRenderer from './BoxplotCellRenderer';\r\nimport BrightnessCellRenderer, {toHeatMapColor} from './BrightnessCellRenderer';\r\nimport CategoricalCellRenderer from './CategoricalCellRenderer';\r\nimport CategoricalHeatmapCellRenderer from './CategoricalHeatmapCellRenderer';\r\nimport CategoricalStackedDistributionlCellRenderer from './CategoricalStackedDistributionlCellRenderer';\r\nimport CircleCellRenderer from './CircleCellRenderer';\r\nimport DateCellRenderer from './DateCellRenderer';\r\nimport DateHistogramCellRenderer from './DateHistogramCellRenderer';\r\nimport {DefaultCellRenderer} from './DefaultCellRenderer';\r\nimport DotCellRenderer from './DotCellRenderer';\r\nimport GroupCellRenderer from './GroupCellRenderer';\r\nimport HeatmapCellRenderer from './HeatmapCellRenderer';\r\nimport HistogramCellRenderer from './HistogramCellRenderer';\r\nimport ImageCellRenderer from './ImageCellRenderer';\r\nimport InterleavingCellRenderer from './InterleavingCellRenderer';\r\nimport LinkCellRenderer from './LinkCellRenderer';\r\nimport LinkMapCellRenderer from './LinkMapCellRenderer';\r\nimport LoadingCellRenderer from './LoadingCellRenderer';\r\nimport MapBarCellRenderer from './MapBarCellRenderer';\r\nimport MultiLevelCellRenderer from './MultiLevelCellRenderer';\r\nimport RankCellRenderer from './RankCellRenderer';\r\nimport SelectionRenderer from './SelectionRenderer';\r\nimport SetCellRenderer from './SetCellRenderer';\r\nimport SparklineCellRenderer from './SparklineCellRenderer';\r\nimport StringCellRenderer from './StringCellRenderer';\r\nimport TableCellRenderer from './TableCellRenderer';\r\nimport UpSetCellRenderer from './UpSetCellRenderer';\r\nimport VerticalBarCellRenderer from './VerticalBarCellRenderer';\r\nimport {noRenderer, wideEnough, wideEnoughCat, adaptTextColorToBgColor, adaptDynamicColorToBgColor} from './utils';\r\n\r\nexport const rendererClasses = {\r\n  AAggregatedGroupRenderer,\r\n  ANumbersCellRenderer,\r\n  ActionRenderer,\r\n  AggregateGroupRenderer,\r\n  AnnotationRenderer,\r\n  BarCellRenderer,\r\n  BooleanCellRenderer,\r\n  BoxplotCellRenderer,\r\n  BrightnessCellRenderer,\r\n  CategoricalCellRenderer,\r\n  CategoricalHeatmapCellRenderer,\r\n  CategoricalStackedDistributionlCellRenderer,\r\n  CircleCellRenderer,\r\n  DateCellRenderer,\r\n  DateHistogramCellRenderer,\r\n  DefaultCellRenderer,\r\n  DotCellRenderer,\r\n  GroupCellRenderer,\r\n  HeatmapCellRenderer,\r\n  HistogramCellRenderer,\r\n  ImageCellRenderer,\r\n  InterleavingCellRenderer,\r\n  LinkCellRenderer,\r\n  LinkMapCellRenderer,\r\n  LoadingCellRenderer,\r\n  MapBarCellRenderer,\r\n  MultiLevelCellRenderer,\r\n  RankCellRenderer,\r\n  SelectionRenderer,\r\n  SetCellRenderer,\r\n  SparklineCellRenderer,\r\n  StringCellRenderer,\r\n  TableCellRenderer,\r\n  UpSetCellRenderer,\r\n  VerticalBarCellRenderer\r\n};\r\n\r\nexport const rendererUtils = {\r\n  toHeatMapColor,\r\n  noRenderer,\r\n  wideEnough,\r\n  wideEnoughCat,\r\n  adaptTextColorToBgColor,\r\n  adaptDynamicColorToBgColor,\r\n};\r\n","/**\r\n * main module of LineUp.js containing the main class and exposes all other modules\r\n */\r\n\r\nimport {IColumnDesc} from './model';\r\nimport {DataProvider, LocalDataProvider, ILocalDataProviderOptions} from './provider';\r\nimport {LineUp, Taggle} from './ui';\r\nimport {ILineUpOptions, ITaggleOptions} from './config';\r\n\r\n\r\nexport * from './builder';\r\nexport * from './config';\r\nexport * from './internal/mathInterfaces';\r\nexport * from './model';\r\nexport * from './provider';\r\nexport * from './renderer';\r\nexport * from './ui';\r\nexport {LineUp as default} from './ui';\r\n\r\n\r\nexport function createLocalDataProvider(data: any[], columns: IColumnDesc[], options: Partial<ILocalDataProviderOptions> = {}) {\r\n  return new LocalDataProvider(data, columns, options);\r\n}\r\n\r\n/**\r\n *\r\n * @param container the html element lineup should be built in\r\n * @param data {DataProvider} the data providier\r\n * @param config {Partial<ILineUpOptions>} lineup configuration overrides\r\n * @returns {LineUp} the created lineup instance\r\n */\r\nexport function createLineUp(container: HTMLElement, data: DataProvider, config: Partial<ILineUpOptions> = {}) {\r\n  return new LineUp(container, data, config);\r\n}\r\n\r\nexport function createTaggle(container: HTMLElement, data: DataProvider, config: Partial<ITaggleOptions> = {}) {\r\n  return new Taggle(container, data, config);\r\n}\r\n","export * from './';\r\nexport {default} from './';\r\nimport '!file-loader?name=schema.4.0.0.json!./provider/schema.json';\r\nimport './style.scss';\r\n\r\ndeclare const __VERSION__: string;\r\ndeclare const __BUILD_ID__: string;\r\ndeclare const __LICENSE__: string;\r\n\r\n/**\r\n * LineUp version\r\n * @type {string}\r\n */\r\nexport const version = __VERSION__;\r\n/**\r\n * LineUp unique build id\r\n * @type {string}\r\n */\r\nexport const buildId = __BUILD_ID__;\r\n/**\r\n * LineUp license type\r\n * @type {string}\r\n */\r\nexport const license = __LICENSE__;\r\n"],"sourceRoot":""}