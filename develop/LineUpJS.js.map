{"version":3,"sources":["webpack://LineUpJS/webpack/universalModuleDefinition","webpack://LineUpJS/./.yarn/cache/fast-deep-equal-npm-3.1.3-790edcfcf5-451526766b.zip/node_modules/fast-deep-equal/index.js","webpack://LineUpJS/./.yarn/cache/lodash.get-npm-4.4.2-7bda64ed87-447e575e3c.zip/node_modules/lodash.get/index.js","webpack://LineUpJS/./.yarn/cache/reflect-metadata-npm-0.1.13-c525998e20-629101e6c8.zip/node_modules/reflect-metadata/Reflect.js","webpack://LineUpJS/webpack/bootstrap","webpack://LineUpJS/webpack/runtime/compat get default export","webpack://LineUpJS/webpack/runtime/define property getters","webpack://LineUpJS/webpack/runtime/hasOwnProperty shorthand","webpack://LineUpJS/webpack/runtime/make namespace object","webpack://LineUpJS/./src/internal/interable.ts","webpack://LineUpJS/./src/internal/worker.ts","webpack://LineUpJS/./src/internal/math.ts","webpack://LineUpJS/./src/internal/utils.ts","webpack://LineUpJS/./.yarn/cache/d3-dispatch-npm-2.0.0-1417ab6cc8-6724fe8d32.zip/node_modules/d3-dispatch/src/dispatch.js","webpack://LineUpJS/./src/internal/AEventDispatcher.ts","webpack://LineUpJS/./src/model/annotations.ts","webpack://LineUpJS/./src/model/interfaces.ts","webpack://LineUpJS/./src/model/Column.ts","webpack://LineUpJS/./src/model/INumberColumn.ts","webpack://LineUpJS/./src/model/ValueColumn.ts","webpack://LineUpJS/./src/model/CompositeColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/colors.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/category10.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/Set3.js","webpack://LineUpJS/./src/internal/OrderedSet.ts","webpack://LineUpJS/./src/model/internal.ts","webpack://LineUpJS/./src/styles/index.ts","webpack://LineUpJS/./src/model/AggregateGroupColumn.ts","webpack://LineUpJS/./src/model/CategoricalColorMappingFunction.ts","webpack://LineUpJS/./src/model/missing.ts","webpack://LineUpJS/./src/model/internalCategorical.ts","webpack://LineUpJS/./src/model/CategoricalColumn.ts","webpack://LineUpJS/./src/model/SetColumn.ts","webpack://LineUpJS/./src/model/Ranking.ts","webpack://LineUpJS/./src/internal/debounce.ts","webpack://LineUpJS/./src/model/RankColumn.ts","webpack://LineUpJS/./src/model/SelectionColumn.ts","webpack://LineUpJS/./src/model/ActionColumn.ts","webpack://LineUpJS/./src/model/StringColumn.ts","webpack://LineUpJS/./src/model/AnnotateColumn.ts","webpack://LineUpJS/./src/model/BooleanColumn.ts","webpack://LineUpJS/./src/model/ArrayColumn.ts","webpack://LineUpJS/./src/model/BooleansColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatDecimal.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/exponent.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatSpecifier.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatPrefixAuto.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatRounded.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatTypes.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/identity.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/locale.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/defaultLocale.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatGroup.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatNumerals.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/formatTrim.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-3f7282474d.zip/node_modules/d3-array/src/ticks.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-3f7282474d.zip/node_modules/d3-array/src/ascending.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-3f7282474d.zip/node_modules/d3-array/src/bisector.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-3f7282474d.zip/node_modules/d3-array/src/bisect.js","webpack://LineUpJS/./.yarn/cache/d3-array-npm-2.12.1-104e51ecda-3f7282474d.zip/node_modules/d3-array/src/number.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-637e111598.zip/node_modules/d3-color/src/define.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-637e111598.zip/node_modules/d3-color/src/color.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/basis.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/constant.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/color.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/rgb.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/array.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/date.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/number.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/object.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/basisClosed.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/string.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/numberArray.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/value.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/round.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/number.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/continuous.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/constant.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/init.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/log.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/nice.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/linear.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/tickFormat.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/precisionPrefix.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/precisionRound.js","webpack://LineUpJS/./.yarn/cache/d3-format-npm-2.0.0-74628e435e-515b8c3c40.zip/node_modules/d3-format/src/precisionFixed.js","webpack://LineUpJS/./.yarn/cache/d3-scale-npm-3.3.0-6a8f0391dc-2a22d0f538.zip/node_modules/d3-scale/src/pow.js","webpack://LineUpJS/./src/model/MappingFunction.ts","webpack://LineUpJS/./src/model/internalNumber.ts","webpack://LineUpJS/./src/model/NumberColumn.ts","webpack://LineUpJS/./src/model/BoxPlotColumn.ts","webpack://LineUpJS/./src/model/MapColumn.ts","webpack://LineUpJS/./src/model/CategoricalMapColumn.ts","webpack://LineUpJS/./src/model/CategoricalsColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/interval.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/duration.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/utcWeek.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/utcDay.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/week.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/day.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/year.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/utcYear.js","webpack://LineUpJS/./.yarn/cache/d3-time-format-npm-3.0.0-0803464fb3-3e67e7eb5b.zip/node_modules/d3-time-format/src/locale.js","webpack://LineUpJS/./.yarn/cache/d3-time-format-npm-3.0.0-0803464fb3-3e67e7eb5b.zip/node_modules/d3-time-format/src/defaultLocale.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/month.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/hour.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/minute.js","webpack://LineUpJS/./.yarn/cache/d3-time-npm-2.1.1-73fdf673f7-4f90b2ba35.zip/node_modules/d3-time/src/second.js","webpack://LineUpJS/./src/model/internalDate.ts","webpack://LineUpJS/./src/model/DateColumn.ts","webpack://LineUpJS/./src/model/DatesColumn.ts","webpack://LineUpJS/./src/model/DatesMapColumn.ts","webpack://LineUpJS/./src/model/GroupColumn.ts","webpack://LineUpJS/./src/model/HierarchyColumn.ts","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/ramp.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-single/Blues.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-single/Greens.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-single/Greys.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-single/Oranges.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-single/Purples.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-single/Reds.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-637e111598.zip/node_modules/d3-color/src/math.js","webpack://LineUpJS/./.yarn/cache/d3-color-npm-2.0.0-e7f04a5d87-637e111598.zip/node_modules/d3-color/src/cubehelix.js","webpack://LineUpJS/./.yarn/cache/d3-interpolate-npm-2.0.1-7e198300b3-a996521ffa.zip/node_modules/d3-interpolate/src/cubehelix.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/rainbow.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/cubehelix.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/viridis.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlOrRd.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlOrBr.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/BuGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/BuPu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/GnBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/OrRd.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/PuBuGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/PuBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/PuRd.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/RdPu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlGnBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/sequential-multi/YlGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/BrBG.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/PRGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/PiYG.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/PuOr.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/RdBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/RdGy.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/RdYlBu.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/RdYlGn.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/diverging/Spectral.js","webpack://LineUpJS/./src/model/ColorMappingFunction.ts","webpack://LineUpJS/./src/model/ImpositionCompositeColumn.ts","webpack://LineUpJS/./src/model/NumbersColumn.ts","webpack://LineUpJS/./src/model/ImpositionBoxPlotColumn.ts","webpack://LineUpJS/./src/model/ImpositionCompositesColumn.ts","webpack://LineUpJS/./src/model/CompositeNumberColumn.ts","webpack://LineUpJS/./src/model/ReduceColumn.ts","webpack://LineUpJS/./src/model/StackColumn.ts","webpack://LineUpJS/./src/model/MultiLevelCompositeColumn.ts","webpack://LineUpJS/./src/model/NestedColumn.ts","webpack://LineUpJS/./src/model/NumberMapColumn.ts","webpack://LineUpJS/./src/model/OrdinalColumn.ts","webpack://LineUpJS/./src/model/ScriptColumn.ts","webpack://LineUpJS/./src/model/StringMapColumn.ts","webpack://LineUpJS/./src/model/StringsColumn.ts","webpack://LineUpJS/./src/model/LinkColumn.ts","webpack://LineUpJS/./src/model/LinkMapColumn.ts","webpack://LineUpJS/./src/model/LinksColumn.ts","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/abortAble.js","webpack://LineUpJS/./src/provider/interfaces.ts","webpack://LineUpJS/./src/internal/accessor.ts","webpack://LineUpJS/./src/provider/utils.ts","webpack://LineUpJS/./src/provider/internal.ts","webpack://LineUpJS/./src/provider/ADataProvider.ts","webpack://LineUpJS/./src/model/models.ts","webpack://LineUpJS/./src/provider/ACommonDataProvider.ts","webpack://LineUpJS/./src/provider/sort.ts","webpack://LineUpJS/./src/internal/scheduler.ts","webpack://LineUpJS/./src/provider/tasks.ts","webpack://LineUpJS/./src/provider/DirectRenderTasks.ts","webpack://LineUpJS/./src/model/IArrayColumn.ts","webpack://LineUpJS/./src/model/ICategoricalColumn.ts","webpack://LineUpJS/./src/model/IDateColumn.ts","webpack://LineUpJS/./src/provider/ScheduledTasks.ts","webpack://LineUpJS/./src/provider/LocalDataProvider.ts","webpack://LineUpJS/./src/renderer/interfaces.ts","webpack://LineUpJS/./src/constants.ts","webpack://LineUpJS/./src/renderer/utils.ts","webpack://LineUpJS/./src/renderer/ActionRenderer.ts","webpack://LineUpJS/./src/renderer/AggregateGroupRenderer.ts","webpack://LineUpJS/./src/ui/missing.ts","webpack://LineUpJS/./src/renderer/missing.ts","webpack://LineUpJS/./src/renderer/StringCellRenderer.ts","webpack://LineUpJS/./src/renderer/AnnotationRenderer.ts","webpack://LineUpJS/./src/renderer/impose.ts","webpack://LineUpJS/./src/renderer/BarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DefaultCellRenderer.ts","webpack://LineUpJS/./src/renderer/BooleanCellRenderer.ts","webpack://LineUpJS/./src/renderer/BoxplotCellRenderer.ts","webpack://LineUpJS/./src/renderer/BrightnessCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalHeatmapCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalStackedDistributionlCellRenderer.ts","webpack://LineUpJS/./src/renderer/CircleCellRenderer.ts","webpack://LineUpJS/./src/renderer/DotCellRenderer.ts","webpack://LineUpJS/./src/renderer/GroupCellRenderer.ts","webpack://LineUpJS/./src/renderer/ANumbersCellRenderer.ts","webpack://LineUpJS/./src/renderer/HeatmapCellRenderer.ts","webpack://LineUpJS/./.yarn/cache/popper.js-npm-1.16.1-a99192bd83-eb53806fb7.zip/node_modules/popper.js/dist/esm/popper.js","webpack://LineUpJS/./src/internal/merge.ts","webpack://LineUpJS/./src/ui/dialogs/ADialog.ts","webpack://LineUpJS/./src/ui/dialogs/APopup.ts","webpack://LineUpJS/./src/ui/dialogs/InputNumberDialog.ts","webpack://LineUpJS/./src/internal/drag.ts","webpack://LineUpJS/./src/renderer/histogram.ts","webpack://LineUpJS/./src/renderer/HistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/ImageCellRenderer.ts","webpack://LineUpJS/./src/renderer/AAggregatedGroupRenderer.ts","webpack://LineUpJS/./src/renderer/MultiLevelCellRenderer.ts","webpack://LineUpJS/./src/renderer/InterleavingCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkCellRenderer.ts","webpack://LineUpJS/./src/renderer/TableCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkMapCellRenderer.ts","webpack://LineUpJS/./src/renderer/LoadingCellRenderer.ts","webpack://LineUpJS/./src/renderer/MapBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/RankCellRenderer.ts","webpack://LineUpJS/./src/renderer/SelectionRenderer.ts","webpack://LineUpJS/./src/renderer/SetCellRenderer.ts","webpack://LineUpJS/./src/renderer/SparklineCellRenderer.ts","webpack://LineUpJS/./src/renderer/UpSetCellRenderer.ts","webpack://LineUpJS/./src/renderer/VerticalBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DateCellRenderer.ts","webpack://LineUpJS/./src/ui/dialogs/InputDateDialog.ts","webpack://LineUpJS/./src/renderer/DateHistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/renderers.ts","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/Accent.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/Dark2.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/Pastel1.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/Pastel2.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/Set1.js","webpack://LineUpJS/./.yarn/cache/d3-scale-chromatic-npm-2.0.0-75af9c90b0-83a6edc33e.zip/node_modules/d3-scale-chromatic/src/categorical/Set2.js","webpack://LineUpJS/./src/ui/dialogs/CategoricalColorMappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalMappingFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ChangeRendererDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ColorMappingDialog.ts","webpack://LineUpJS/./src/internal/dnd.ts","webpack://LineUpJS/./src/ui/toolbarResolvers.ts","webpack://LineUpJS/./src/ui/headerTooltip.ts","webpack://LineUpJS/./src/ui/dialogs/MoreColumnOptionsDialog.ts","webpack://LineUpJS/./src/ui/header.ts","webpack://LineUpJS/./src/ui/dialogs/CompositeChildrenDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CutOffHierarchyDialog.ts","webpack://LineUpJS/./src/ui/dialogs/DateFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/EditPatternDialog.ts","webpack://LineUpJS/./src/ui/dialogs/GroupDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingLineDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/NumberFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/utils.ts","webpack://LineUpJS/./src/ui/dialogs/ReduceDialog.ts","webpack://LineUpJS/./src/ui/dialogs/RenameDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ScriptEditDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SearchDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ShowTopNDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SortDialog.ts","webpack://LineUpJS/./src/ui/dialogs/StringFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/WeightsEditDialog.ts","webpack://LineUpJS/./src/ui/toolbar.ts","webpack://LineUpJS/./src/ui/dialogs/groupNumber.ts","webpack://LineUpJS/./src/ui/dialogs/groupString.ts","webpack://LineUpJS/./src/ui/dialogs/groupDate.ts","webpack://LineUpJS/./src/config.ts","webpack://LineUpJS/./.yarn/cache/detect-browser-npm-5.2.0-3064055ad6-8d25ed366c.zip/node_modules/detect-browser/es/index.js","webpack://LineUpJS/./src/browser.ts","webpack://LineUpJS/./src/ui/dialogs/DialogManager.ts","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/animation/index.js","webpack://LineUpJS/./src/ui/ALineUp.ts","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/animation/KeyFinder.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/internal/index.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/internal/scroll.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/logic.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/mixin/IMixin.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/styles/index.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/ARowRenderer.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/style/StyleManager.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/style/GridStyleManager.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/table/MultiTableRowRenderer.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/mixin/PrefetchMixin.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/table/internal/ACellAdapter.js","webpack://LineUpJS/./.yarn/cache/lineupengine-npm-2.4.0-996e7e3a29-ed093752c6.zip/node_modules/lineupengine/build/src/table/ACellTableSection.js","webpack://LineUpJS/./src/ui/animation.ts","webpack://LineUpJS/./src/ui/RenderColumn.ts","webpack://LineUpJS/./src/ui/MultiLevelRenderColumn.ts","webpack://LineUpJS/./src/ui/SelectionManager.ts","webpack://LineUpJS/./src/ui/EngineRanking.ts","webpack://LineUpJS/./src/ui/interfaces.ts","webpack://LineUpJS/./src/ui/SlopeGraph.ts","webpack://LineUpJS/./src/ui/EngineRenderer.ts","webpack://LineUpJS/./src/ui/domElementCache.ts","webpack://LineUpJS/./src/ui/dialogs/ChooseRankingDialog.ts","webpack://LineUpJS/./src/ui/panel/SearchBox.ts","webpack://LineUpJS/./src/ui/dialogs/RenameRankingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MoreRankingOptionsDialog.ts","webpack://LineUpJS/./src/ui/dialogs/AddonDialog.ts","webpack://LineUpJS/./src/ui/panel/Hierarchy.ts","webpack://LineUpJS/./src/ui/panel/SidePanelEntryVis.ts","webpack://LineUpJS/./src/ui/panel/SidePanelRanking.ts","webpack://LineUpJS/./src/ui/panel/SidePanel.ts","webpack://LineUpJS/./src/ui/LineUp.ts","webpack://LineUpJS/./src/ui/taggle/rules.ts","webpack://LineUpJS/./src/ui/taggle/TaggleRenderer.ts","webpack://LineUpJS/./src/ui/taggle/Taggle.ts","webpack://LineUpJS/./src/builder/column/ColumnBuilder.ts","webpack://LineUpJS/./src/builder/LineUpBuilder.ts","webpack://LineUpJS/./src/builder/RankingBuilder.ts","webpack://LineUpJS/./src/builder/column/CategoricalColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/NumberColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/StringColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/DateColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/HierarchyColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/ActionsColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/BooleanColumnBuilder.ts","webpack://LineUpJS/./src/builder/DataBuilder.ts","webpack://LineUpJS/./src/builder/adapter/column.ts","webpack://LineUpJS/./src/builder/adapter/ranking.ts","webpack://LineUpJS/./src/builder/adapter/utils.ts","webpack://LineUpJS/./src/builder/adapter/lineup.ts","webpack://LineUpJS/./src/model/index.ts","webpack://LineUpJS/./src/provider/RemoteDataProvider.ts","webpack://LineUpJS/./src/renderer/index.ts","webpack://LineUpJS/./src/index.ts","webpack://LineUpJS/./src/bundle.ts"],"names":["root","factory","exports","module","define","amd","globalThis","equal","a","b","constructor","length","i","keys","Array","isArray","RegExp","source","flags","valueOf","Object","prototype","toString","hasOwnProperty","call","key","uid","HASH_UNDEFINED","reIsDeepProp","reIsPlainProp","reLeadingDot","rePropName","reEscapeChar","reIsHostCtor","freeGlobal","global","freeSelf","self","Function","arrayProto","funcProto","objectProto","coreJsData","maskSrcKey","exec","IE_PROTO","funcToString","objectToString","reIsNative","replace","Symbol","splice","Map","getNative","nativeCreate","symbolProto","undefined","symbolToString","Hash","entries","index","this","clear","entry","set","ListCache","MapCache","assocIndexOf","array","value","other","getMapData","map","type","data","__data__","object","getValue","isObject","func","tag","isFunction","result","e","isHostObject","test","toSource","baseIsNative","has","get","pop","push","stringToPath","memoize","string","isSymbol","baseToString","match","number","quote","toKey","resolver","TypeError","memoized","args","arguments","apply","cache","Cache","isObjectLike","path","defaultValue","isKey","baseGet","Reflect","exporter","makeExporter","target","previous","defineProperty","configurable","writable","hasOwn","supportsSymbol","toPrimitiveSymbol","toPrimitive","iteratorSymbol","iterator","supportsCreate","create","supportsProto","__proto__","downLevel","HashMap","MakeDictionary","functionPrototype","getPrototypeOf","usePolyfill","process","env","_Map","cacheSentinel","arraySentinel","MapIterator","values","selector","_index","_keys","_values","_selector","next","done","throw","error","return","_cacheKey","_cacheIndex","enumerable","_find","delete","size","getKey","getEntry","insert","indexOf","_","CreateMapPolyfill","_Set","Set","_map","add","Metadata","WeakMap","rootKey","CreateUniqueKey","_key","table","GetOrCreateWeakMapTable","CreateUUID","FillRandomBytes","buffer","Math","random","Uint8Array","crypto","getRandomValues","msCrypto","offset","byte","toLowerCase","CreateWeakMapPolyfill","GetOrCreateMetadataMap","O","P","Create","targetMetadata","IsUndefined","metadataMap","OrdinaryHasMetadata","MetadataKey","OrdinaryHasOwnMetadata","parent","OrdinaryGetPrototypeOf","IsNull","OrdinaryGetMetadata","OrdinaryGetOwnMetadata","OrdinaryDefineOwnMetadata","MetadataValue","OrdinaryMetadataKeys","ownKeys","OrdinaryOwnMetadataKeys","parentKeys","_i","ownKeys_1","_a","parentKeys_1","obj","method","GetMethod","IsCallable","IsObject","GetIterator","k","IteratorStep","nextValue","IteratorClose","Type","x","ToPrimitive","input","PreferredType","hint","exoticToPrim","toString_1","toString_2","OrdinaryToPrimitive","ToPropertyKey","argument","ToString","IsArray","IsConstructor","V","f","proto","prototypeProto","__","decorators","propertyKey","attributes","decorated","decorator","DecorateConstructor","descriptor","DecorateProperty","metadataKey","metadataValue","IsPropertyKey","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","definition","o","prop","r","toStringTag","isSeqEmpty","seq","every","isIndicesAble","it","Uint16Array","Uint32Array","Float32Array","Int8Array","Int16Array","Int32Array","Float64Array","filters","_length","l","forEach","filter","callback","LazyFilter","concat","LazyMap1","outer","valid","v","some","reduce","initial","acc","j","mapV","map12","LazyMap2","ALazyMap","map23","LazyMap3","map34","iterable","_arr","from","arr","lazySeq","LazySeq","seqs","shift","s","MAX_WORKER_THREADS","max","navigator","hardwareConcurrency","blob","workers","cleanUpWorkerTimer","workerTaskCounter","cleanUpWorker","toFree","findIndex","tasks","worker","terminate","finishedTask","w","Worker","refs","checkOutWorker","clearTimeout","emptyWorker","find","setTimeout","pushStats","refData","refIndices","indices","Promise","resolve","receiver","msg","removeEventListener","stats","addEventListener","assign","postMessage","transferAbles","toResult","setRef","ref","broadCast","deleteRef","startsWith","deleteRefs","getNumberOfBins","ceil","log","LN2","min","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","extent","empty","fill","quantile","NaN","floor","median","slice","sort","pushAll","vs","boxplotBuilder","fixedLength","sum","missing","isNaN","pushAndSave","invalid","mean","count","whiskerHigh","whiskerLow","outlier","q1","q3","buildImpl","iqr","left","right","reversedOutliers","reverse","build","buildArr","numberStatsBuilder","domain","numberOfBins","hist","x0","binWidth","x1","bin1","binN","low","high","center","toBin","maxBin","computeGranularity","histGranularity","getFullYear","minYear","maxYear","Date","getTime","getMonth","getDate","setDate","setMonth","pushDateHist","dateStatsBuilder","template","byDay","templateHist","h","categoricalStatsBuilder","categories","m","cat","name","round","precision","scale","pow","similar","delta","abs","isPromiseLike","then","createIndexArray","dataSize","toIndexArray","maxDataIndex","joinIndexArrays","groups","total","createLike","g","asc","desc","sortComplex","comparators","lookup","dateValueCache2Value","categoricalValueCache2Value","sortWorkerMain","wself","resolveRefs","msgHandlers","sortOrders","order","dateStats","ii","categoricalStats","cats","numberStats","boxplotStats","evt","createWorkerBlob","sources","lastIndexOf","join","Blob","URL","createObjectURL","ai","fixCSS","id","node","lastChild","removeChild","arrs","getSortLabel","String","noop","dispatch","t","Error","Dispatch","parseTypenames","typenames","types","trim","split","c","on","typename","T","copy","that","suffix","prefix","p","events","createEventList","listenerEvents","listeners","forwarder","fireImpl","primaryType","origin","listener","listenersChanged","Boolean","_type","_active","fire","context","forward","unforward","supportType","for","category","SupportType","metadata","SortByDefault","isSortingAscByDefault","col","clazz","hasMetadata","label","featureLevel","categorical","date","composite","support","Categories","Category","getSortType","categoryOf","toolbar","dialogAddons","isSupportType","getMetadata","categoryOfDesc","models","ECompareValueType","defaultGroup","color","othersGroup","isGroup","item","group","isMultiLevelColumn","getCollapsed","DEFAULT_COLOR","width","renderer","groupRenderer","summaryRenderer","visible","summary","description","fixed","frozen","assignNewId","idGenerator","fqid","fqpath","Column","EVENT_WIDTH_CHANGED","EVENT_LABEL_CHANGED","EVENT_METADATA_CHANGED","EVENT_VISIBILITY_CHANGED","EVENT_SUMMARY_RENDERER_TYPE_CHANGED","EVENT_RENDERER_TYPE_CHANGED","EVENT_GROUP_RENDERER_TYPE_CHANGED","EVENT_DIRTY","EVENT_DIRTY_HEADER","EVENT_DIRTY_VALUES","EVENT_DIRTY_CACHES","getWidth","hide","setVisible","show","isVisible","getVisible","flatten","_levelsToGo","_padding","setWidth","setWidthImpl","setMetaData","bak","getMetaData","sortByMe","ascending","priority","findMyRanker","sortBy","groupByMe","toggleGrouping","isGroupedBy","getGroupCriteria","toggleMySorting","toggleSorting","isSortedByMeImpl","ranker","criterias","isSortedByMe","getSortCriteria","groupSortByMe","groupSortBy","toggleMyGroupSorting","toggleGroupSorting","isGroupSortedByMe","getGroupSortCriteria","removeMe","remove","attach","detach","insertAfterMe","insertAfter","dump","toDescRef","getRenderer","getGroupRenderer","getSummaryRenderer","restore","_factory","rendererType","getLabel","row","_row","getExportValue","format","getColor","toCompareValue","_valueCache","toCompareValueType","UINT8","toCompareGroupValue","_rows","toCompareGroupValueType","STRING","isFiltered","clearFilter","setRenderer","setGroupRenderer","setSummaryRenderer","markDirty","FLAT_ALL_COLUMNS","isMapAbleColumn","getMapping","isNumberColumn","getNumber","ESortMethod","EAdvancedSortMethod","isBoxPlotColumn","getBoxPlotData","isNumbersColumn","getNumbers","accessor","loaded","lazyLoaded","ValueColumn","EVENT_DATA_LOADED","isLoaded","getRaw","setLoaded","RENDERER_LOADING","_children","CompositeColumn","EVENT_FILTER_CHANGED","EVENT_ADD_COLUMN","EVENT_MOVE_COLUMN","EVENT_REMOVE_COLUMN","levelsToGo","padding","children","child","canJustAddNumbers","insertImpl","move","old","moveImpl","oldIndex","at","moveAfter","removeImpl","specifier","colors","list","addAll","console","assert","deleteAll","act","callbackfn","thisArg","integrateDefaults","defaults","typed","patternFunction","pattern","joinGroups","parents","gparents","unshift","subGroups","duplicateGroup","clone","isGroupParent","toGroupID","groupRoots","roots","MAX_COLORS","colorPool","mapIndices","everyIndices","forEachIndices","chooseUIntByDataLength","dataLength","UINT32","UINT16","styles","getStyle","COLUMN_PADDING","parseInt","FILTERED_OPACITY","parseFloat","DASH","height","UPSET","inactive","DOT","opacity","BOX_PLOT","box","stroke","AGGREGATE","strokeWidth","levelOffset","levelWidth","SLOPEGRAPH_WIDTH","CSS_PREFIX","RESIZE_SPACE","RESIZE_ANIMATION_DURATION","AGGREGATION_LEVEL_WIDTH","engineCssClass","ENGINE_CSS_PREFIX","aria","text","EAggregationState","createAggregateDesc","AggregateGroupColumn","EVENT_AGGREGATE","isAggregated","ranking","setAggregated","EXPAND","COLLAPSE","DEFAULT_CATEGORICAL_COLOR_FUNCTION","toJSON","eq","ReplacementColorMappingFunction","restoreCategoricalColorMapping","isMissingValue","isUnknown","FIRST_IS_MISSING","missingGroup","toCategory","nextColor","compareCategory","aNull","bNull","localeCompare","toCategories","isEmptyFilter","filterMissing","isEqualCategoricalFilter","al","arrayEquals","isCategoryIncluded","filterObj","includes","currentFilter","colorMapping","CategoricalColumn","EVENT_COLOR_MAPPING_CHANGED","getCategory","getCategories","getValues","getLabels","getMap","getMapLabel","getSet","iterCategory","categoricalColorMappingFunction","getColorMapping","setColorMapping","mapping","valueCache","getFilter","setFilter","was","FLOAT_ASC","rows","_group","mostFrequent","topCat","topCount","findMostFrequent","toGroupCompareCategoryValue","FLOAT","current","separator","SetColumn","getSortedSet","normalize","sv","getColors","mode","cardinality","EDirtyReason","sortCriteria","groupColumns","groupSortCriteria","columns","dirtyOrder","reason","Ranking","EVENT_DIRTY_ORDER","dirtyOrderSortDirty","SORT_CRITERIA_DIRTY","dirtyOrderGroupDirty","GROUP_CRITERIA_DIRTY","dirtyOrderGroupSortDirty","GROUP_SORT_CRITERIA_DIRTY","dirtyOrderFiltering","FILTER_CHANGED","index2pos","EVENT_GROUPS_CHANGED","EVENT_GROUP_CRITERIA_CHANGED","EVENT_GROUP_SORT_CRITERIA_CHANGED","EVENT_COLUMN_VISIBILITY_CHANGED","EVENT_SORT_CRITERIA_CHANGED","EVENT_ORDER_CHANGED","setLabel","setGroups","dirtyReason","oldGroups","unifyGroups","offsets","subarray","subs","gi","getRank","dataIndex","getOrder","getOrderLength","getGroups","getFlatGroups","traverse","sortColumn","help","setGroupCriteria","restoreSortCriteria","dumped","setSortCriteria","setGroupSortCriteria","getPrimarySortCriteria","toggleSortingLogic","newSort","defaultAsc","newGroupings","hierarchyLogic","groupBy","equalCriteria","COLUMN_SORT_DIRTY","triggerResort","column","cols","groupColumn","COLUMN_GROUP_DIRTY","autoAdaptAggregationColumn","targetWidth","COLUMN_GROUP_SORT_DIRTY","triggerGroupResort","sortCriterias","bakMulti","FORWARD_COLUMN_EVENTS","oldValue","newValue","reference","findByPath","isSortCriteria","sortCriteriaChanged","isGroupSortCriteria","groupSortCriteriaChanged","newGrouping","isGroupColumn","removed","idOrFilter","flatColumns","clearFilters","bi","debounce","timeToDelay","choose","tm","ctx","createRankDesc","RankColumn","createSelectionDesc","SelectionColumn","EVENT_SELECT","setValue","setImpl","setValues","setterAll","setter","toggleValue","BINARY","isSelected","SELECTED_GROUP","NOT_SELECTED_GROUP","createActionDesc","actions","groupActions","compare","ActionColumn","EAlignment","EStringGroupCriteriaType","currentGroupCriteria","alignment","escape","StringColumn","EVENT_GROUPING_CHANGED","groupCriteria","regex","FILTER_MISSING","ff","groupValue","annotations","AnnotateColumn","EVENT_VALUE_CHANGED","trueMarker","GROUP_TRUE","falseMarker","GROUP_FALSE","BooleanColumn","getCategoryOfBoolean","_dataLength","originalLabels","labels","_d","ArrayColumn","BooleansColumn","formatDecimalParts","toExponential","coefficient","prefixExponent","re","formatSpecifier","FormatSpecifier","align","sign","symbol","zero","comma","exponent","toFixed","toLocaleString","toPrecision","formatRounded","toUpperCase","formatPrefix","prefixes","locale","grouping","thousands","identity","substring","currencyPrefix","currency","currencySuffix","decimal","numerals","formatNumerals","percent","minus","nan","newFormat","formatTypes","formatType","maybeSuffix","valuePrefix","valueSuffix","valueNegative","out","i1","i0","formatTrim","charCodeAt","Infinity","e10","sqrt","e5","e2","start","stop","ticks","step","tickIncrement","isFinite","r0","r1","power","LN10","lo","hi","mid","ascendingComparator","ascendingBisect","bisector","bisectRight","extend","Color","darker","brighter","reI","reN","reP","reHex","reRgbInteger","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","color_formatHex","rgb","formatHex","color_formatRgb","formatRgb","rgbn","Rgb","rgba","hsla","rgbConvert","rgb_formatHex","hex","rgb_formatRgb","Hsl","hslConvert","hsl","hsl2rgb","m1","m2","basis","t1","v0","v1","v2","v3","t2","t3","channels","displayable","formatHsl","linear","nogamma","constant","rgbGamma","y","exponential","gamma","end","rgbSpline","spline","rgbBasis","genericArray","nb","na","setTime","reA","reB","am","bm","bs","lastIndex","q","one","ArrayBuffer","isView","DataView","unit","bimap","range","interpolate","d0","d1","polymap","bisect","clamp","unknown","transformer","transform","untransform","piecewise","output","rescale","invert","rangeRound","u","continuous","initRange","transformLog","transformExp","exp","transformLogn","transformExpn","pow10","reflect","loggish","logs","pows","base","E","log10","log2","logp","powp","z","tickFormat","nice","interval","linearish","step0","step1","tickStep","precisionPrefix","precisionRound","precisionFixed","prestep","maxIter","transformPow","transformSqrt","transformSquare","powish","toScale","isSame","fixDomain","getRange","ScaleMappingFunction","code","value_min","value_max","value_range","value_domain","mi","ma","ScriptMappingFunction","restoreMapping","mappingFunction","mappingFunctions","script","pow2","pow3","DEFAULT_FORMATTER","toCompareBoxPlotValue","getSortMethod","getBoxPlotNumber","getRawBoxPlotData","noNumberFilter","isEqualNumberFilter","isNumberIncluded","isDummyNumberFilter","restoreNumberFilter","filterAccuracy","numberFormat","currentGroupThresholds","groupSortMethod","original","colorMappingFunction","NumberColumn","getNumberFormat","stratifyThresholds","stratifyThreshholds","EVENT_MAPPING_CHANGED","EVENT_SORTMETHOD_CHANGED","raw","getRawValue","iterNumber","iterRawNumber","getRawNumber","sortMethod","getOriginalMapping","setMapping","getGroupThresholds","setGroupThresholds","threshold","thresholdIndex","setSortMethod","BoxPlotColumn","byKey","MapColumn","CategoricalMapColumn","parseValue","getCategoryMap","CategoricalsColumn","t0","newInterval","floori","offseti","field","durationSecond","durationMinute","durationHour","durationDay","durationWeek","utcWeekday","setUTCDate","getUTCDate","getUTCDay","setUTCHours","utcSunday","utcMonday","utcTuesday","utcWednesday","utcThursday","utcFriday","utcSaturday","utcDay","weekday","getDay","setHours","getTimezoneOffset","sunday","monday","tuesday","wednesday","thursday","friday","saturday","day","year","setFullYear","utcYear","setUTCMonth","setUTCFullYear","getUTCFullYear","localDate","H","M","S","L","utcDate","UTC","newDate","timeFormat","timeParse","pads","numberRe","percentRe","requoteRe","pad","requote","formatRe","names","formatLookup","parseWeekdayNumberSunday","parseWeekdayNumberMonday","parseWeekNumberSunday","U","parseWeekNumberISO","parseWeekNumberMonday","W","parseFullYear","parseYear","parseZone","Z","parseQuarter","parseMonthNumber","parseDayOfMonth","parseDayOfYear","parseHour24","parseMinutes","parseSeconds","parseMilliseconds","parseMicroseconds","parseLiteralPercent","parseUnixTimestamp","Q","parseUnixTimestampSeconds","formatDayOfMonth","formatHour24","getHours","formatHour12","formatDayOfYear","formatMilliseconds","getMilliseconds","formatMicroseconds","formatMonthNumber","formatMinutes","getMinutes","formatSeconds","getSeconds","formatWeekdayNumberMonday","formatWeekNumberSunday","dISO","formatWeekNumberISO","formatWeekdayNumberSunday","formatWeekNumberMonday","formatYear","formatYearISO","formatFullYear","formatFullYearISO","formatZone","formatUTCDayOfMonth","formatUTCHour24","getUTCHours","formatUTCHour12","formatUTCDayOfYear","formatUTCMilliseconds","getUTCMilliseconds","formatUTCMicroseconds","formatUTCMonthNumber","getUTCMonth","formatUTCMinutes","getUTCMinutes","formatUTCSeconds","getUTCSeconds","formatUTCWeekdayNumberMonday","dow","formatUTCWeekNumberSunday","UTCdISO","formatUTCWeekNumberISO","formatUTCWeekdayNumberSunday","formatUTCWeekNumberMonday","formatUTCYear","formatUTCYearISO","formatUTCFullYear","formatUTCFullYearISO","formatUTCZone","formatLiteralPercent","formatUnixTimestamp","formatUnixTimestampSeconds","locale_dateTime","dateTime","locale_date","locale_time","time","locale_periods","periods","locale_weekdays","days","locale_shortWeekdays","shortDays","locale_months","months","locale_shortMonths","shortMonths","periodRe","periodLookup","weekdayRe","weekdayLookup","shortWeekdayRe","shortWeekdayLookup","monthRe","monthLookup","shortMonthRe","shortMonthLookup","formats","utcFormats","parses","parseSpecifier","charAt","newParse","week","parse","X","utcFormat","utcParse","formatLocale","month","hour","minute","second","shiftFilterDateDay","setMinutes","setSeconds","setMilliseconds","toDateGroup","grouper","granularity","centuryP","circular","century","decadeP","decade","chooseAggregatedDate","dates","currentGrouper","dateFormat","DEFAULT_DATE_FORMAT","dateParse","DateColumn","getFormatter","iterDate","isDateIncluded","DOUBLE_ASC","getDateGrouper","setDateGrouper","EDateSort","DatesColumn","getDates","av","compute","DatesMapColumn","getDateMap","EGroupSortMethod","createGroupDesc","GroupColumn","COUNT","currentMaxDepth","currentLeaves","currentLeavesNameCache","currentLeavesPathCache","hierarchySeparator","hierarchy","initHierarchy","currentNode","computeLeaves","updateCaches","HierarchyColumn","EVENT_CUTOFF_CHANGED","maxDepth","cutOffNode","findName","getCutOff","setCutOff","leaves","visit","depth","resolveInnerNodes","queue","isHierarchical","deriveHierarchy","scheme","ramp","radians","PI","degrees","A","B","C","D","ED","EB","BC_DA","cubehelixConvert","Cubehelix","bl","atan2","cubehelix","hue","cubehelixGamma","cosh","cos","sinh","sin","cubehelixLong","warm","cool","ts","magma","inferno","plasma","SequentialColorFunction","FUNCTIONS","interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds","interpolateCool","interpolateCubehelixDefault","interpolateWarm","interpolatePlasma","interpolateMagma","interpolateViridis","interpolateInferno","interpolateYlOrRd","interpolateYlOrBr","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateRainbow","DivergentColorFunction","interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral","UnknownColorFunction","SolidColorFunction","steps","perStep","quantize","QuantizedColorFunction","CustomColorMappingFunction","DEFAULT_COLOR_FUNCTION","createImpositionDesc","ImpositionCompositeColumn","wrapper","rest","NumbersColumn","getRawNumbers","CENTER","createImpositionBoxPlotDesc","ImpositionBoxPlotColumn","createImpositionsDesc","ImpositionCompositesColumn","CompositeNumberColumn","createReduceDesc","ReduceColumn","selected","EVENT_REDUCE_CHANGED","getReduce","setReduce","createStackDesc","showNestedSummaries","collapsed","adaptChange","adaptWidthChange","StackColumn","weights","getWeights","EVENT_COLLAPSE_CHANGED","EVENT_WEIGHTS_CHANGED","EVENT_MULTI_LEVEL_CHANGED","setCollapsed","isShowNestedSummaries","weight","full","oldWeight","factor","widths","guess","setWeights","COLLAPSED_RENDERER","MultiLevelCompositeColumn","createNestedDesc","NestedColumn","NumberMapColumn","OrdinalColumn","DEFAULT_SCRIPT","createScriptDesc","allFactory","_all","byName","byID","byIndex","ScriptColumn","EVENT_SCRIPT_CHANGED","setScript","getScript","clean","raws","ColumnContext","ColumnWrapper","LazyColumnWrapper","getMapValue","StringMapColumn","StringsColumn","patternTemplates","LinkColumn","setPattern","EVENT_PATTERN_CHANGED","getPattern","getLink","href","transformValue","alt","getLinkMap","LinkMapColumn","LinksColumn","getLinks","ABORTED","thenFactory","loader","isAborted","abort","onfulfilled","_onrejected","loadedOrAborted","res","abortAble","aborted","aborter","race","abortAbleAll","all","values_1","isAbortAble","candidate","isAsyncUpdate","update","ready","SCHEMA_REF","isComplexAccessor","resolveValue","rowComplexGetter","rowGetter","rowGuessGetter","cleanCategories","isEmpty","deriveBaseType","options","warn","datePattern","treatAsCategorical","categoricalThreshold","deriveColumnDescriptions","config","first","existing","exclude","selectColumns","foundRow","primitive","vi","mapAll","vii","sameLength","hasDifferentSizes","deriveType","toLabel","deriveColors","exportRanking","opts","newline","header","quoteChar","verboseColumnHeaders","map2Object","rangeSelection","provider","rankingId","relIndex","ctrlKey","getRankings","selection","getSelection","nearest","distance","setSelection","isAlwaysShowingGroupStrategy","strategy","toItemMeta","relativeIndex","topN","groupParents","meta","prev","prevMeta","groupEndLevel","topNGetter","last","isSummaryGroup","toDirtyReason","UNKNOWN","SORT_CRITERIA_CHANGED","GROUP_CRITERIA_CHANGED","GROUP_SORT_CRITERIA_CHANGED","mergeDirtyOrderContext","currentReason","nextReason","combined","rankings","aggregations","columnTypes","colorMappingFunctionTypes","mappingFunctionTypes","singleSelection","showTopN","aggregationStrategy","propagateAggregationState","aggregate","annotate","boolean","booleans","boxplot","categoricalMap","categoricals","dateMap","imposition","impositionBoxPlot","impositions","nested","numbers","numberMap","ordinal","rank","stack","stringMap","strings","link","linkMap","links","quantized","custom","colorMappingFunctions","typeFactory","createTypeFactory","fromDescRef","fixDesc","instantiateColumn","typeName","createColorMappingFunction","getTypeFactory","ADataProvider","EVENT_DATA_CHANGED","EVENT_BUSY","EVENT_SHOWTOPN_CHANGED","EVENT_ADD_RANKING","EVENT_REMOVE_RANKING","EVENT_SELECTION_CHANGED","EVENT_ADD_DESC","EVENT_CLEAR_DESC","EVENT_JUMP_TO_NEAREST","EVENT_GROUP_AGGREGATION_CHANGED","pushRanking","cloneRanking","insertRanking","fireBusy","busy","takeSnapshot","hasString","hasColumn","toClone","FORWARD_RANKING_EVENTS","triggerReorder","paths","removeDuplicates","level","real","unifyParents","initAggregateState","removeRanking","cleanUpRanking","clearRankings","getFirstRanking","getLastRanking","ensureOneRanking","destroy","_ranking","nextId","select","deselect","selectAll","deselectAll","getAggregationState","setAggregationState","cleanDesc","dumpColumn","restoreColumn","bind","$schema","descRef","restoreRanking","object2Map","deriveDefault","addSupportType","getColumns","getTopNAggregated","EXPAND_TOP_N","setTopNAggregated","unaggregateParents","changed","getAggregationStrategy","changedParents","aggregateAllOf","aggregateAll","state","getShowTopN","setShowTopN","jumpToNearest","selectAllOf","clearSelection","toggleSelection","additional","selectedRows","view","exportTable","EVENT_REMOVE_DESC","injectAccessor","rankingIndex","nextRankingId","pushDesc","clearColumns","removeDesc","ignoreBeingUsed","findDesc","missingBinary","missingUInt16","missingUInt32","missingInt8","missingInt16","missingInt32","missingFloat","missingFloatAsc","missingString","toCompareLookUp","rawLength","INT8","INT16","INT32","DOUBLE","createSetter","missingCount","isSorting","valueCaches","criteria","ri","pushValues","free","ANOTHER_ROUND","oneShotIterator","calc","wrappee","onrejected","taskId","runTasks","deadline","task","didTimeout","timeRemaining","requestAnimationFrame","reSchedule","ww","requestIdleCallback","pushMulti","abortOrDummy","isAbortedOrDummy","abortAll","clearIdleCallback","onfullfilled","taskNow","TaskNow","taskLater","TaskLater","tasksAll","_joined","valueCacheData","byOrder","byOrderAcc","builder","orders","MultiIndices","currentChunkSize","chunkCounter","actOrder","builderForEach","resolveDomain","statsBuilder","dacc","setValueCacheData","name2index","categoricalValueCacheBuilder","dirtyColumn","sortDirect","lookups","setData","dirtyRanking","preCompute","preComputeData","preComputeCol","copyData2Summary","copyCache","fromPrefix","cacheKey","_singleCall","groupCompare","rg","groupRows","_col","groupExampleRows","groupBoxPlotStats","summaryBoxPlotStatsD","groupNumberStats","summaryNumberStatsD","groupCategoricalStats","summaryCategoricalStatsD","groupDateStats","summaryDateStatsD","summaryBoxPlotStats","summaryNumberStats","summaryCategoricalStats","summaryDateStats","cached","dataNumberStats","dataBoxPlotStats","dataCategoricalStats","dataDateStats","creator","dontCache","ARenderTasks","isMapColumn","endsWith","isArrayColumn","isCategoricalLikeColumn","isSetColumn","isCategoricalsColumn","isCategory","isDateColumn","isDatesColumn","WorkerTaskScheduler","checker","orderedGroups","multi","chainCopy","chainKey","chain","joined","canAbort","isValidCacheEntry","subTask","created","valueCacheKey","singleCall","indexArray","toTransfer","_data","ooptions","filterGlobally","jumpToSearchResult","taskExecutor","mapToDataRow","_dataRows","toRows","DirectRenderTasks","ScheduleRenderTasks","reorderAll","getTotalNumberOfRows","getTaskExecutor","dataChanged","clearData","appendData","trackRanking","addKey","removeKey","removeCol","addCol","resolveFilter","noSorting","createSorter","needsFiltering","needsGrouping","needsSorting","groupOrder","CompareLookup","pushGroup","groupKey","groupCaches","filterCaches","toGroup","fc","before","sortGroup","groupLookup","singleGroup","sortTask","groupSortTask","groupC","sortGroups","enforceSorting","groupIndices","reasons","needsGroupSorting","isSortedBy","isGroupedSortedBy","sortedGroups","viewRaw","viewRawRows","getRow","mappingSample","searchAndJump","search","ERenderMode","MIN_LABEL_WIDTH","noRenderer","setText","textContent","querySelectorAll","forEachChild","matchColumns","childElementCount","dataset","columnId","rendererId","idsAndRenderer","idAndRenderer","cnode","querySelector","asElement","classList","appendChild","innerHTML","wideEnough","wideEnoughCat","adaptColorCache","adaptTextColorToBgColor","bgColor","adaptDynamicColorToBgColor","title","adapt","style","innerText","span","ownerDocument","createElement","uniqueId","idCounter","exampleText","examples","multiLevelGridCSSClass","idPrefix","colorOf","canRender","SUMMARY","className","icon","ni","onclick","event","preventDefault","stopPropagation","action","createGroup","createSummary","matchNodes","addTopN","doc","renderGroups","isRow","isLeafGroup","alwaysShowGroup","isSummary","hasTopN","hasTopNStrategy","lastParent","isLastGroup","toggle","isCollapsed","isFirst","isShowAll","childTopN","nextState","isDummyGroup","render","fillStyle","fillRect","filterMissingMarkup","bakMissing","filterMissingNumberMarkup","findFilterMissing","getElementsByClassName","previousElementSibling","updateFilterMissingNumberMarkup","element","getElementsByTagName","disabled","lastElementChild","renderMissingValue","dashX","dashY","renderMissingDOM","renderMissingCanvas","interactiveSummary","form","isRegex","checked","onchange","oninput","onsubmit","actCol","_context","interactive","StringCellRenderer","firstElementChild","imposer","valueHint","renderValue","CELL","colWidth","bar","backgroundColor","groupTitle","summaryTitle","_mode","DefaultCellRenderer","BOXPLOT","MAPPED_BOXPLOT","sortedByMe","renderDOMBoxPlot","topPadding","strokeStyle","beginPath","rect","moveTo","lineTo","renderBoxPlot","isMissing","_interactive","mappedSummary","rawSummary","hasRange","computeLabel","whiskers","nextElementSibling","leftWhisker","rightWhisker","display","outliers","numOutliers","insertAdjacentElement","toHeatMapColor","valueColor","filterUpdate","interactiveHist","staticSummary","showLabels","bins","gHist","inner","gCount","relY","background","setCategoricalFilter","markFilter","bin","included","contained","parentElement","createContext","cellDimension","mover","offsetX","getContext","canvas","clearRect","onmousemove","onmouseleave","maps","toMostFrequentCategoricals","templateRows","stackedBar","selectedCol","gBins","flexGrow","getCanvasRenderer","pi2","radius","save","globalAlpha","arc","getDOMRenderer","dots","tmp","top","DotCellRenderer","formatter","seq1","seq2","ConcatSequence","concatSeq","_ctx","normalized","templateRow","ANumbersCellRenderer","_hist","isBrowser","window","document","timeoutDuration","longerTimeoutBrowsers","userAgent","fn","called","scheduled","functionToCheck","getStyleComputedProperty","property","nodeType","css","defaultView","getComputedStyle","getParentNode","nodeName","parentNode","host","getScrollParent","body","_getStyleComputedProp","overflow","overflowX","overflowY","getReferenceNode","referenceNode","isIE11","MSInputMethodContext","documentMode","isIE10","isIE","version","getOffsetParent","documentElement","noOffsetParent","offsetParent","getRoot","findCommonOffsetParent","element1","element2","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","createRange","setStart","setEnd","commonAncestorContainer","contains","element1root","getScroll","side","upperSide","html","scrollingElement","includeScroll","subtract","scrollTop","scrollLeft","modifier","bottom","getBordersSize","axis","sideA","sideB","getSize","computedStyle","getWindowSizes","classCallCheck","instance","Constructor","createClass","defineProperties","props","protoProps","staticProps","_extends","getClientRect","getBoundingClientRect","sizes","clientWidth","clientHeight","horizScrollbar","offsetWidth","vertScrollbar","offsetHeight","getOffsetRectRelativeToArbitraryNode","fixedPosition","isHTML","childrenRect","parentRect","scrollParent","borderTopWidth","borderLeftWidth","marginTop","marginLeft","getViewportOffsetRectRelativeToArtbitraryNode","excludeScroll","relativeOffset","innerWidth","innerHeight","isFixed","getFixedPositionOffsetParent","el","getBoundaries","popper","boundariesElement","boundaries","boundariesNode","_getWindowSizes","isPaddingNumber","getArea","_ref","computeAutoPlacement","placement","refRect","rects","sortedAreas","area","filteredAreas","_ref2","computedPlacement","variation","getReferenceOffsets","commonOffsetParent","getOuterSizes","marginBottom","marginRight","getOppositePlacement","hash","matched","getPopperOffsets","referenceOffsets","popperRect","popperOffsets","isHoriz","mainSide","secondarySide","measurement","secondaryMeasurement","check","runModifiers","modifiers","ends","cur","enabled","isDestroyed","arrowStyles","flipped","positionFixed","flip","originalPlacement","position","isCreated","onUpdate","onCreate","isModifierEnabled","modifierName","getSupportedPropertyName","upperProp","toCheck","removeAttribute","willChange","disableEventListeners","removeOnDestroy","getWindow","attachToScrollParents","scrollParents","isBody","passive","setupEventListeners","updateBound","scrollElement","eventsEnabled","enableEventListeners","scheduleUpdate","cancelAnimationFrame","isNumeric","setStyles","isFirefox","isModifierRequired","requestingName","requestedName","requesting","isRequired","_requesting","requested","placements","validPlacements","clockwise","counter","Defaults","basePlacement","shiftvariation","_data$offsets","isVertical","shiftOffsets","useHeight","fragments","frag","divider","splitRegex","ops","op","mergeWithPrevious","str","toValue","index2","parseOffset","preventOverflow","transformProp","popperStyles","primary","escapeWithReference","secondary","keepTogether","opSide","arrow","_data$offsets$arrow","arrowElement","len","sideCapitalized","altSide","arrowElementSize","popperMarginSide","popperBorderSide","sideValue","placementOpposite","flipOrder","behavior","refOffsets","overlapsRef","overflowsLeft","overflowsRight","overflowsTop","overflowsBottom","overflowsBoundaries","flippedVariationByRef","flipVariations","flippedVariationByContent","flipVariationsByContent","flippedVariation","getOppositeVariation","subtractLength","bound","computeStyle","legacyGpuAccelerationOption","gpuAcceleration","offsetParentRect","shouldRound","noRound","referenceWidth","popperWidth","isVariation","horizontalToInteger","verticalToInteger","getRoundedOffsets","devicePixelRatio","prefixedProperty","invertTop","invertLeft","applyStyle","setAttribute","onLoad","modifierOptions","Popper","_this","jquery","Utils","PopperUtils","merge","bKeys","dialogContext","attachment","currentTarget","manager","dialogManager","dialog","livePreview","popup","toggleDialog","cancelSubDialogs","autoClose","showLivePreviews","livePreviews","enableLivePreviews","submitter","submit","equals","appendDialogButtons","insertAdjacentHTML","open","removeLike","closest","auto","focus","reset","triggerSubmit","cancel","removeAboveLevel","checkValidity","findInput","cleanUp","triggerDialogClosed","ioptions","valueAsNumber","dragHandle","handle","container","onStart","onDrag","onEnd","minDelta","ueberElement","toContainerRelative","elem","clientLeft","handleShift","mouseMove","clientX","mouseUp","onmousedown","filteredColor","histogramTemplate","guessedBins","histogramUpdate","unfiltered","nodes","matchBins","mappingHintTemplate","mappingHintUpdate","filteredHistTemplate","filterMin","filterMax","formatRaw","initFilter","minHint","maxHint","minValue","parseRaw","maxValue","minImpl","edit","shiftKey","ondblclick","maxImpl","button","px","unpercent","getHistDOMRenderer","updateFilter","fContext","createFilterContext","createFilterInfo","dialogCtx","maxLevel","backgroundImage","src","image","Image","onload","single","aggregatedIndex","createData","stacked","GROUP","toWait","missingWeight","ci","cNode","gridColumnStart","stackShift","cr","translate","callbacks","sorted","aMissing","bMissing","numberCompare","medianIndex","AAggregatedGroupRenderer","rr","summaries","grouped","sample","dummyBin","groupedHist","LinkCellRenderer","createFixed","TableCellRenderer","example","createFixedGroup","groupByKey","LinkMapCellRenderer","fromTSpan","toTSpan","unselected","unchecked","createDOMContext","SetCellRenderer","posX","line","moveNext","yPos","repeat","matchRows","calculateSetPath","catindexes","UpSetCellRenderer","hasTrueValues","CANVAS_HEIGHT","tooltipPrefix","VerticalBarCellRenderer","xpos","chosen","valueAsDate","dummyDomain","now","defaultCellRenderer","renderers","brightness","catdistributionbar","circle","default","dot","heatmap","catheatmap","histogram","datehistogram","interleaving","loading","mapbars","sparkline","upset","verticalbar","sets","schemeCategory10","schemeAccent","schemeDark2","schemePastel1","schemePastel2","schemeSet1","schemeSet2","schemeSet3","updateStats","someMode","noFilter","joint","items","currentGroup","currentSummary","getPossibleRenderer","createTemplate","wrapped","gradient","isCustom","applyColor","s0","s1","dm1","toColor","content","toggles","customs","updateColor","updateSelectedColor","continuouos","continuouos2","quantized2","steps2","updateGradients","steppedGradient","di","stepSize","half","hasDnDType","available","dataTransfer","typesToCheck","dndTransferStorage","isEdgeDnD","updateDropEffect","dT","effectAllowed","copyDnD","dropEffect","mimeTypes","onDrop","onDragOver","canDrop","effect","getData","mime","sortActions","getFullToolbar","caches","toolbarIcon","getOwnMetadata","getAllToolbarActions","possible","resolveToolbarActions","getToolbar","advancedModelFeatures","featureCategory","advancedRankingFeatures","advancedUIFeatures","getToolbarDialogAddons","cacheAddon","toolbarAddons","getAllToolbarDialogAddons","resolveToolbarDialogAddons","actionCSSClass","addIconDOM","showLabel","isActionMode","setHighlightColumn","onClick","updateIconState","groupedBy","active","colId","addIcon","createToolbarMenuItems","createHeader","dragAble","mergeDropAble","rearrangeAble","resizeable","extraPrefix","extra","createShortcutMenuItems","toggleToolbarIcons","dragAbleColumn","resolveDrop","MIMETYPE_PREFIX","alternative","JSON","pushChild","mergeImpl","mergeWith","numberish","draginfo","toInsertParent","rearrangeDropAble","sizeHelper","currentFooterTransformation","originalWidth","dragWidth","updateHeader","minWidth","subLabel","typeCat","updateMoreDialogIcons","willAutoHide","shortcuts","hybrids","moreEntries","defaultVisibleClientWidth","rotated","scrollWidth","toggleRotatedHeader","availableWidth","shortCuts","moreIcon","needMore","onDragStart","draggable","payload","stringify","over","substr","createChildren","summaryNode","innerNodes","innerNodePaths","setCustomValidity","newNode","newNodeIndex","maxDepthText","handler","applyFilter","rerender","prepareRender","createDateFilter","templates","handlers","addon","append","updateDisabled","disable","elems","sortOrder","adapter","unnormalizeRaw","normalizeRaw","common","updated","openDialog","MappingLineDialog","handled","destroyed","trigger","mappingLines","mappingAdapter","updateLines","computeScale","rawDomain","scaleType","others","bb","MappingLine","copyMapping","createMappings","selectedIndex","patchedDomain","getAttribute","createNumberFilter","sortMethods","methods","checkbox","toInput","inputs","updateBar","distributeWeights","missingIndices","validWeights","buttons","reportValidity","ui","uiDialog","dialogClass","extraArgs","isAscByDefault","sortGroupBy","rename","_evt","removeAll","toggleCompressExpand","mcol","toolbarActions","vis","compress","expand","filterNumber","filterDate","filterString","filterCategorical","filterOrdinal","colorMapped","colorMappedCategorical","cutoff","editMapping","editPattern","editWeights","compositeContained","splitCombined","invertSelection","ss","uiSortMethod","toolbarDialogAddons","sortNumber","sortNumbers","sortBoxPlot","sortDates","groupNumber","isThreshold","thresholds","groupString","valueRadioButton","startsWithRadioButton","regexRadioButton","showOrHideTextarea","newType","groupDate","defaultOptions","labelRotation","summaryHeader","animated","expandLineOnHover","sidePanel","sidePanelCollapsed","hierarchyIndicator","defaultSlopeGraphMode","overviewMode","groupSort","onDialogBackgroundClick","rowHeight","groupHeight","groupPadding","rowPadding","levelOfDetail","customRowUpdate","dynamicHeight","disableFrozenColumns","ignoreUnsupportedBrowser","BrowserInfo","os","NodeInfo","platform","SearchBotDeviceInfo","bot","BotInfo","ReactNativeInfo","SEARCHBOT_OS_REGEX","userAgentRules","operatingSystemRules","parseUserAgent","ua","matchedRule","browser","uaMatch","matchUserAgent","versionParts","il","jl","__spreadArrays","createVersionParts","detectOS","searchBotMatch","getUnsupportedBrowserError","info","product","fVersion","escKeyListener","which","removeLast","openDialogs","DialogManager","EVENT_DIALOG_CLOSED","EVENT_DIALOG_OPENED","setHighlight","mask","clipPath","webkitClipPath","clearHighlight","takeDown","setUp","EAnimationMode","ignoreIncompatibleBrowser","highlightListeners","isBrowserSupported","ALineUp","EVENT_HIGHLIGHT_CHANGED","setDataProvider","dataIndices","enableHighlightListening","_enable","defaultPhases","delay","nodeY","actNode","animation","SHOW","HIDE","UPDATE_REMOVE","KeyFinder","lastFilled","key2index","exceptions","findValidStart","posByKey","pos","fillCacheTillKey","defaultRowHeight","fillCache","heightOf","exceptionsLookup","exceptionHeightOf","returnDefault","numberOfRows","positions","defaultMode","ScrollHandler","sync","timer","handleAnimationImpl","handleAnimation","handleTimeouts","asInfo","isWaiting","_b","addScroll","__le_scroller__","isScrollEventWaiting","scroller","EScrollResult","RowHeightException","nonUniformContext","rowHeights","actualDefaultRowHeight","mostFrequentValue","totalHeight","paddedHeight","between","heightExceptions","firstRowPos","endPos","y2","offset2","indexShift","offsetShift","shifted2","lastPos","heightExceptions_1","firstException","lastException","updateFrozen","oldLast","added","PREFIX","CSS_CLASS_LOADING","CSS_CLASS_FROZEN","CSS_CLASS_HIDDEN","CSS_CLASS_MULTI","CSS_CLASS_EVEN","CSS_CLASS_SHIFTED","CSS_CLASS_SCROLLBAR_TESTER","CSS_CLASS_TR","CSS_CLASS_TH","CSS_CLASS_TD","CSS_CLASS_SCROLLING","CSS_CLASS_ROW_ANIMATION","isLoadingCell","ARowRenderer","pool","loadingPool","forcedFirst","forcedLast","visibleFirstRowPos","scrollListener","lastScrollInfo","abortAnimation","async","minScrollDelta","mixins","scrollingHint","batchSize","striped","viewportOversize","createAdapter","MixinClass","fragment","createDocumentFragment","addMixin","addAtBeginning","to","addAtBottom","removeFromBeginning","removeFromBottom","updateOffset","bodyScroller","sizer","tagName","insertBefore","firstChild","init","isGoingDown","onScrolledVertically","recreate","removeScroll","updateRow","createRow","selectProxy","proxy","recycle","abortResult","replaceChild","ex","exceptionHeight","perform","toRecycle","forEachRow","inPlace","fromBeginning","nextSibling","previousSibling","updateSizer","setTransform","bodySizer","recreateAnimated","recreatePure","clearPool","previousKey","currentKey","rows_1","UPDATE","UPDATE_CREATE","nodeYCurrentHeight","nextPos","prevHeight","animate","phases","previousFinder","currentFinder","activeAnimation","currentTimer","actPhase","executePhase","phase","anim","run","offsetTop","dummyAnimation","previousHeight","currentHeight","curr","revalidate","shiftTop","scrollResult","onScrolledImpl","onScrolled","shiftLast","currentDelta","shiftFirst","currentFirstRow","NONE","toAdd","SOME","toAddBottom","ALL","SOME_TOP","SOME_BOTTOM","manipulate","toRecycle_1","anyElem","__transform__","assignStyles","plain","hyphen","setProperty","StyleManager","rules","testVerifyTimeout","createTextNode","verifySheet","sheet","cssRules","selectorText","deleteRule","rule","insertRule","cssRule","getSheetRule","addRule","updateRule","stored","extendStatics","setPrototypeOf","tableIds","tableId","thead","tbody","tr","th","td","tableCSSClasses","ids","_super","GridStyleManager","cssClasses","headerScroller","measureScrollbar","borderRight","frozenShift","selectors","updateColumns","ruleNames","cssSelectors","thStyles","tdStyles","MultiTableRowRenderer","htmlId","sections","columnPadding","cleanHTMLId","main","isGoingRight","onScrolledHorizontally","scrollEnd","headerFooter","bodyFooter","maxHeight","pushTable","extras","pushSeparator","section","widthChanged","PrefetchMixin","prefetchTimeout","cleanupTimeout","prefetchRows","cleanUpRows","prefetchDown","nextLast","prefetchUp","scrollOffset","scrollTotal","syncFrozen","triggerPrefetch","prefetchDownPossible","prefetchUpPossible","isLast","cleanUpTop","newFirst","cleanUpBottom","newLast","triggerCleanUp","ACellAdapter","mixinClasses","cellPool","visibleColumns","visibleFirstColumnPos","horizontallyShifted","columnAdapter","createColumnAdapter","columnMixins","columnFragment","leftShift","addColumnMixin","addColumnAtStart","addColumnAtEnd","removeColumnFromStart","removeColumnFromEnd","updateColumnOffset","onScrolledHorizontallyImpl","removeCellFromStart","recycleCell","removeCellFromEnd","removeFrozenCells","columnIndices","columnIndices_1","columnIndex","removeFrozenColumns","removeAllColumns","includingFrozen","removeAllCells","frozen_1","selectProxyCell","columnObj","pooled","updateCell","createCell","updateShiftedState","handleCellReady","selectCell","rowIndex","addCellAtStart","cell","insertFrozenCells","columnIndices_2","insertFrozenColumns","addCellAtEnd","updateHeaders","fragment_1","document_1","ids_1","firstColumnPos","id_1","mergeColumns","updateImpl","cell_1","byId","idNode","updateShiftedStates","shifted","headers","bodies","headers_1","bodies_1","headers_2","_c","bodies_2","shiftingChanged","ACellTableSection","LocalCell","mixinClass","hidden","onVisibilityChanged","updateShifts","_left","_visible","wasHidden","updateColumnWidths","oldLeft","toGroupLookup","item2groupIndex","group2firstItemIndex","singleRenderer","singleTemplate","cloneNode","singleId","groupTemplate","groupId","summaryTemplate","summaryId","hasSummaryLine","oldRenderer","currentRenderer","oldGroup","getGroup","chainAbortAble","renderCell","mapper","mapped","mc","updateNested","matchChildren","cc","updateWidthRule","gridTemplateColumns","sub","hr","showHint","startNode","elementFromPoint","clientY","endNode","xShift","yShift","SelectionManager","EVENT_SELECT_RANGE","startIndex","endIndex","sy","ey","MIN_DISTANCE","selectRange","updateState","selectedDataIndices","RankingEvents","EVENT_UPDATE_DATA","EVENT_RECREATE","PASSIVE","roptions","loadingCanvas","highlight","canvasPool","currentCanvasShift","currentCanvasWidth","canvasMouseHandler","hoveredRows","unhover","enter","leave","updateHoveredRow","EngineRanking","isCanvasRenderedRow","highlightHandler","delayedUpdate","updateBody","delayedUpdateAll","updateAll","delayedUpdateColumnWidths","shiftedIndex","createCol","reindex","disableListener","shiftedOld","_oldValue","renderCtx","currentRowHeight","uniformContext","createRenderer","visibility","updateCanvasRule","updateColumnSummaryFlag","_document","createCellHandled","initCellClasses","selectCanvas","rowFlags","rowany","__lu__","visibleRenderedWidth","pushLazyRedraw","renderRow","imageSmoothingEnabled","domColumns","renderCellImpl","visibleElements","firstDOM","updateCellImpl","updateCanvasCell","me","needDOM","updateHeaderOf","toRowMeta","agg","hoverLod","computedLod","wasLow","wasGroup","recycleCanvas","canvas2","updateCanvasBody","enable","hover","inplace","updateSelection","updateColumn","after","groupData","pushItem","ordered","gparent","rowContext","previousData","currentData","prevHelper","currHelper","currentRowIndex","referenceIndex","appearPosition","_previousFinder","previousRowIndex","removePosition","lineupAnimation","findNearest","lookFor","firstBeforePos","firstAfterPos","nearestPos","scrollIntoView","regular","posOf","scrollHeight","found","getHighlight","debounceUpdate","replacement","EMode","leftSlopes","rightSlopes","chosenSelectionOnly","ITEM","createElementNS","BAND","initHeader","scroll","icons","rebuild","leftRanking","leftContext","rightRanking","rightContext","prepareRightSlopes","computeSlopes","fakeGroups","padded","slopes","gr","heightPerRow","ItemSlope","fakeGroup","createFakeGroup","intersection","filterIndices","GroupSlope","chooseSelection","leftVisibleFirst","leftVisibleLast","rightVisibleFirst","rightVisibleLast","alreadyVisible","selectionLookup","updatePath","selectionSlopes","ownerSVGElement","matchLength","addPath","openDataIndices","slopeGraphs","updateAbles","zoomFactor","enabledHighlightListening","helper","EngineRenderer","chooseRenderer","chooseGroupRenderer","chooseSummaryRenderer","footer","toDisable","initProvider","zoomOut","updateZoomFactor","zoomIn","fontSize","pushUpdateAble","updateAble","takeDownProvider","addRanking","setHighlightToNearest","updateHist","updateUpdateAbles","updateRotatedHeaderState","slope","round2","defaultHeight","heightsFor","updateSlopeGraphs","formatItem","placeholder","onfocus","onblur","blur","onkeydown","handleKey","itemTemplate","buildDialog","li","isItem","onmouseenter","highlighted","click","highlightPrevious","highlightNext","SearchBox","SEARCH_ITEM_SELECTOR","filterResults","ul","allChildrenHidden","addons","groupAdder","groupSortAdder","sortAdder","renderSorting","renderGroupSorting","toColumn","addonKey","onChange","prevent","customize","addGroupAdder","addSortAdder","addGroupSortAdder","addAdder","adder","onSelect","used","summaryUpdater","recreateSummary","appendSummary","updateSummary","dropdown","updateHierarchy","updateList","isWrapper","additionalDescs","chooser","collapseable","descs","initChooser","changeDataStorage","panel","wrapDesc","updateChooser","createEntry","makeActive","updateRanking","resetButton","groupByType","SidePanel","spaceFillingRule","availableHeight","visibleHeight","groupSeparators","violation","itemHeight","isDynamicLeafHeight","resizeListener","violationChanged","TaggleRenderer","switchRule","_rule","setViolation","spaceFilling","updateLodRules","_color","asArray","asMap","buildColumn","ColumnBuilder","rotation","registerRenderer","registerToolbarAction","registerToolbarDialogAddon","groupRowHeight","disableAdvancedRankingFeatures","disableAdvancedModelFeatures","disableAdvancedUIFeatures","supportTypes","allColumns","impose","colorColumn","scripted","weightedSum","numberColumn","numberColumn1","weight1","numberColumn2","weight2","numberColumnAndWeights","post","operation","numberColumns","RankingBuilder","ALL_MAGIC_FLAG","addColumn","col2","buildRanking","asOrdinal","asSet","derive","isSet","val","buildCategoricalColumn","CategoricalColumnBuilder","asBoxPlot","ext","buildNumberColumn","NumberColumnBuilder","editable","buildStringColumn","StringColumnBuilder","buildDateColumn","DateColumnBuilder","buildHierarchicalColumn","HierarchyColumnBuilder","groupAction","buildActionsColumn","ActionsColumnBuilder","marker","buildBooleanColumn","BooleanColumnBuilder","providerOptions","rankBuilders","_deriveColors","scheduledTaskExecutor","multiSelection","deriveColumns","registerColumnType","defaultRanking","addSupportTypes","buildData","oldPos","buildTaggle","DataBuilder","asTaggle","asLineUp","buildCategorical","missingCategory","buildDate","buildHierarchy","buildNumber","buildString","buildBoolean","buildActions","si","buildGeneric","buildImposeRanking","buildNestedRanking","buildWeightedSumRanking","buildReduceRanking","buildScriptRanking","buildSupportRanking","buildAllColumnsRanking","isTypeInstance","superClass","pick","lineupOptions","prevRankings","prevColumns","prevHighlight","onSelectionChanged","onHighlightChanged","componentDidMount","buildProvider","createInstance","resolveColumnDescs","columnDescs","deriveColumnNames","resolveRankings","builders","rankingBuilders","buildColumns","buildRankings","updateLineUp","changeDetector","providerChanged","changedLineUpOptions","updateProvider","columnsChanged","componentDidUpdate","componentWillUnmount","defineColumn","functions","CustomColumn","createIndex2Pos","server","maxCacheSize","loadFromServer","fetch","computeMissing","union","unionAdd","_v","loadInCache","_m","toLoad","rendererClasses","ActionRenderer","AggregateGroupRenderer","AnnotationRenderer","BarCellRenderer","BooleanCellRenderer","BoxplotCellRenderer","BrightnessCellRenderer","CategoricalCellRenderer","CategoricalHeatmapCellRenderer","CategoricalStackedDistributionlCellRenderer","CircleCellRenderer","DateCellRenderer","DateHistogramCellRenderer","GroupCellRenderer","HeatmapCellRenderer","HistogramCellRenderer","ImageCellRenderer","InterleavingCellRenderer","LoadingCellRenderer","MapBarCellRenderer","MultiLevelCellRenderer","RankCellRenderer","SelectionRenderer","SparklineCellRenderer","rendererUtils","createLocalDataProvider","createLineUp","createTaggle","buildId","license"],"mappings":"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,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCEN,GAAe64B,GAVK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,0DACA1N,IAAIknB,KCIN,GAAe64B,GAZK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA1N,IAAIknB,KCEN,GAAe64B,GAZK,IAAIzjD,MAAM,GAAGoR,OAC/B,qBACA,2BACA,iCACA,uCACA,6CACA,mDACA,yDACA,+DACA,sEACA1N,IAA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","file":"LineUpJS.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LineUpJS\"] = factory();\n\telse\n\t\troot[\"LineUpJS\"] = factory();\n})(globalThis, function() {\nreturn ","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** `Object#toString` result references. */\nvar funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    symbolTag = '[object Symbol]';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/,\n    reLeadingDot = /^\\./,\n    rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    splice = arrayProto.splice;\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value) {\n  return isArray(value) ? value : stringToPath(value);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoize(function(string) {\n  string = toString(string);\n\n  var result = [];\n  if (reLeadingDot.test(string)) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, string) {\n    result.push(quote ? string.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result);\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Assign cache to `_.memoize`.\nmemoize.Cache = MapCache;\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nmodule.exports = get;\n","/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof global === \"object\" ? global :\n            typeof self === \"object\" ? self :\n                typeof this === \"object\" ? this :\n                    Function(\"return this;\")();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        else {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter);\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                if (typeof target[key] !== \"function\") {\n                    Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                }\n                if (previous)\n                    previous(key, value);\n            };\n        }\n    })(function (exporter) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var usePolyfill = typeof process === \"object\" && process.env && process.env[\"REFLECT_METADATA_USE_MAP_POLYFILL\"] === \"true\";\n        var _Map = !usePolyfill && typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = !usePolyfill && typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = !usePolyfill && typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        // [[Metadata]] internal slot\n        // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n        var Metadata = new _WeakMap();\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var metadataMap = GetOrCreateMetadataMap(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            if (!metadataMap.delete(metadataKey))\n                return false;\n            if (metadataMap.size > 0)\n                return true;\n            var targetMetadata = Metadata.get(target);\n            targetMetadata.delete(propertyKey);\n            if (targetMetadata.size > 0)\n                return true;\n            Metadata.delete(target);\n            return true;\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        function GetOrCreateMetadataMap(O, P, Create) {\n            var targetMetadata = Metadata.get(O);\n            if (IsUndefined(targetMetadata)) {\n                if (!Create)\n                    return undefined;\n                targetMetadata = new _Map();\n                Metadata.set(O, targetMetadata);\n            }\n            var metadataMap = targetMetadata.get(P);\n            if (IsUndefined(metadataMap)) {\n                if (!Create)\n                    return undefined;\n                metadataMap = new _Map();\n                targetMetadata.set(P, metadataMap);\n            }\n            return metadataMap;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            return ToBoolean(metadataMap.has(MetadataKey));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return undefined;\n            return metadataMap.get(MetadataKey);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n            metadataMap.set(MetadataKey, MetadataValue);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var keys = [];\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return keys;\n            var keysObj = metadataMap.keys();\n            var iterator = GetIterator(keysObj);\n            var k = 0;\n            while (true) {\n                var next = IteratorStep(iterator);\n                if (!next) {\n                    keys.length = k;\n                    return keys;\n                }\n                var nextValue = IteratorValue(next);\n                try {\n                    keys[k] = nextValue;\n                }\n                catch (e) {\n                    try {\n                        IteratorClose(iterator);\n                    }\n                    finally {\n                        throw e;\n                    }\n                }\n                k++;\n            }\n        }\n        // 6 ECMAScript Data Typ0es and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            return /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (key === this._cacheKey) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (this._cacheKey !== key) {\n                        this._cacheIndex = this._keys.indexOf(this._cacheKey = key);\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            return /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.values(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    if (typeof crypto !== \"undefined\")\n                        return crypto.getRandomValues(new Uint8Array(size));\n                    if (typeof msCrypto !== \"undefined\")\n                        return msCrypto.getRandomValues(new Uint8Array(size));\n                    return FillRandomBytes(new Uint8Array(size), size);\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122 § 4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export interface IForEachAble<T> extends Iterable<T> {\n  forEach(callback: (v: T, i: number) => void): void;\n}\n\n/**\n * @internal\n */\nexport function isForEachAble<T>(v: IForEachAble<T> | any): v is IForEachAble<T> {\n  return typeof v.forEach === 'function';\n}\n\n/**\n * generalized version of Array function similar to Scala ISeq\n */\nexport interface ISequence<T> extends IForEachAble<T> {\n  readonly length: number;\n  filter(callback: (v: T, i: number) => boolean): ISequence<T>;\n  map<U>(callback: (v: T, i: number) => U): ISequence<U>;\n\n  some(callback: (v: T, i: number) => boolean): boolean;\n  every(callback: (v: T, i: number) => boolean): boolean;\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U): U;\n}\n\n/**\n * @internal\n */\nexport function isSeqEmpty(seq: ISequence<any>) {\n  return seq.every(() => false); // more efficient than counting length\n}\n\n/**\n * helper function for faster access to avoid function calls\n * @internal\n */\nexport function isIndicesAble<T>(it: Iterable<T>): it is ArrayLike<T> & Iterable<T> {\n  return (\n    Array.isArray(it) ||\n    it instanceof Uint8Array ||\n    it instanceof Uint16Array ||\n    it instanceof Uint32Array ||\n    it instanceof Float32Array ||\n    it instanceof Int8Array ||\n    it instanceof Int16Array ||\n    it instanceof Int32Array ||\n    it instanceof Float64Array\n  );\n}\n\ndeclare type ISequenceBase<T> = ISequence<T> | (ArrayLike<T> & Iterable<T>);\n\n/**\n * sequence implementation that does the operation lazily on the fly\n */\nclass LazyFilter<T> implements ISequence<T> {\n  private _length = -1;\n\n  constructor(private readonly it: ISequenceBase<T>, private readonly filters: ((v: T, i: number) => boolean)[]) {}\n\n  get length() {\n    // cached\n    if (this._length >= 0) {\n      return this._length;\n    }\n    let l = 0;\n    this.forEach(() => l++);\n    this._length = l;\n    return l;\n  }\n\n  filter(callback: (v: T, i: number) => boolean): ISequence<T> {\n    // propagate filter\n    return new LazyFilter(this.it, this.filters.concat(callback));\n  }\n\n  map<U>(callback: (v: T, i: number) => U): ISequence<U> {\n    // create lazy map out of myself\n    return new LazyMap1(this, callback);\n  }\n\n  forEach(callback: (v: T, i: number) => void) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        callback(v, i);\n      }\n      return;\n    }\n\n    // iterator version\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      callback(v.value, valid++);\n      v = it.next();\n      i++;\n    }\n  }\n\n  [Symbol.iterator]() {\n    const it = this.it[Symbol.iterator]();\n    const next = () => {\n      let v = it.next();\n      let i = -1;\n      outer: while (!v.done) {\n        i++;\n        for (const f of this.filters) {\n          if (f(v.value, i)) {\n            continue;\n          }\n          // invalid go to next\n          v = it.next();\n          continue outer;\n        }\n        return v;\n      }\n      return v;\n    };\n    return { next };\n  }\n\n  some(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        if (callback(v, i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      if (callback(v.value, valid++)) {\n        return true;\n      }\n      v = it.next();\n      i++;\n    }\n    return false;\n  }\n\n  every(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        if (!callback(v, i)) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      if (!callback(v.value, valid++)) {\n        return false;\n      }\n      v = it.next();\n      i++;\n    }\n    return true;\n  }\n\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\n    if (isIndicesAble(this.it)) {\n      // fast array version\n      let acc = initial;\n      let j = 0;\n      outer: for (let i = 0; i < this.it.length; ++i) {\n        const v = this.it[i];\n        for (const f of this.filters) {\n          if (!f(v, i)) {\n            continue outer;\n          }\n        }\n        acc = callback(acc, v, j++);\n      }\n      return acc;\n    }\n\n    let valid = 0;\n    const it = this.it[Symbol.iterator]();\n    let v = it.next();\n    let i = 0;\n    let r = initial;\n    outer: while (!v.done) {\n      for (const f of this.filters) {\n        if (f(v.value, i)) {\n          continue;\n        }\n        v = it.next();\n        i++;\n        continue outer;\n      }\n      r = callback(r, v.value, valid++);\n      v = it.next();\n      i++;\n    }\n    return r;\n  }\n}\n\n/**\n * lazy mapping operation\n */\nabstract class ALazyMap<T, T2> implements ISequence<T2> {\n  constructor(protected readonly it: ISequenceBase<T>) {}\n\n  get length() {\n    return this.it.length;\n  }\n\n  filter(callback: (v: T2, i: number) => boolean): ISequence<T2> {\n    return new LazyFilter(this, [callback]);\n  }\n\n  abstract map<U>(callback: (v: T2, i: number) => U): ISequence<U>;\n  protected abstract mapV(v: T, i: number): T2;\n\n  forEach(callback: (v: T2, i: number) => void) {\n    if (isIndicesAble(this.it)) {\n      for (let i = 0; i < this.it.length; ++i) {\n        callback(this.mapV(this.it[i], i), i);\n      }\n      return;\n    }\n    const it = this.it[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      callback(this.mapV(v.value, i), i);\n    }\n  }\n\n  [Symbol.iterator]() {\n    const it = this.it[Symbol.iterator]();\n    let i = 0;\n    const next = () => {\n      const v = it.next();\n      if (v.done) {\n        return {\n          value: undefined as unknown as T2,\n          done: true,\n        };\n      }\n      const value = this.mapV(v.value, i);\n      i++;\n      return {\n        value,\n        done: false,\n      };\n    };\n    return { next };\n  }\n\n  some(callback: (v: T2, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      for (let i = 0; i < this.it.length; ++i) {\n        if (callback(this.mapV(this.it[i], i), i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    const it = this.it[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (callback(this.mapV(v.value, i), i)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  every(callback: (v: T2, i: number) => boolean) {\n    if (isIndicesAble(this.it)) {\n      for (let i = 0; i < this.it.length; ++i) {\n        if (!callback(this.mapV(this.it[i], i), i)) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    const it = this.it[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (!callback(this.mapV(v.value, i), i)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  reduce<U>(callback: (acc: U, v: T2, i: number) => U, initial: U) {\n    if (isIndicesAble(this.it)) {\n      let acc = initial;\n      for (let i = 0; i < this.it.length; ++i) {\n        acc = callback(acc, this.mapV(this.it[i], i), i);\n      }\n      return acc;\n    }\n\n    const it = this.it[Symbol.iterator]();\n    let acc = initial;\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      acc = callback(acc, this.mapV(v.value, i), i);\n    }\n    return acc;\n  }\n}\n\nclass LazyMap1<T1, T2> extends ALazyMap<T1, T2> implements ISequence<T2> {\n  constructor(it: ISequenceBase<T1>, protected readonly map12: (v: T1, i: number) => T2) {\n    super(it);\n  }\n\n  protected mapV(v: T1, i: number) {\n    return this.map12(v, i);\n  }\n\n  map<U>(callback: (v: T2, i: number) => U): ISequence<U> {\n    return new LazyMap2(this.it, this.map12, callback);\n  }\n}\n\nclass LazyMap2<T1, T2, T3> extends ALazyMap<T1, T3> implements ISequence<T3> {\n  constructor(\n    it: ISequenceBase<T1>,\n    private readonly map12: (v: T1, i: number) => T2,\n    private readonly map23: (v: T2, i: number) => T3\n  ) {\n    super(it);\n  }\n\n  map<U>(callback: (v: T3, i: number) => U): ISequence<U> {\n    return new LazyMap3(this.it, this.map12, this.map23, callback);\n  }\n\n  protected mapV(v: T1, i: number) {\n    return this.map23(this.map12(v, i), i);\n  }\n}\n\nclass LazyMap3<T1, T2, T3, T4> extends ALazyMap<T1, T4> implements ISequence<T4> {\n  constructor(\n    it: ISequenceBase<T1>,\n    private readonly map12: (v: T1, i: number) => T2,\n    private readonly map23: (v: T2, i: number) => T3,\n    private readonly map34: (v: T3, i: number) => T4\n  ) {\n    super(it);\n  }\n\n  map<U>(callback: (v: T4, i: number) => U): ISequence<U> {\n    const map1U = (v: T1, i: number) => callback(this.map34(this.map23(this.map12(v, i), i), i), i);\n    return new LazyMap1(this.it, map1U);\n  }\n\n  protected mapV(v: T1, i: number) {\n    return this.map34(this.map23(this.map12(v, i), i), i);\n  }\n}\n\nclass LazySeq<T> implements ISequence<T> {\n  private _arr: ISequenceBase<T> | null = null;\n\n  constructor(private readonly iterable: Iterable<T>) {}\n\n  get arr() {\n    if (this._arr) {\n      return this._arr;\n    }\n    if (isIndicesAble(this.iterable)) {\n      this._arr = this.iterable;\n    } else {\n      this._arr = Array.from(this.iterable);\n    }\n    return this._arr!;\n  }\n\n  [Symbol.iterator]() {\n    return this.iterable[Symbol.iterator]();\n  }\n\n  filter(callback: (v: T, i: number) => boolean) {\n    return new LazyFilter(this.arr, [callback]);\n  }\n\n  map<U>(callback: (v: T, i: number) => U) {\n    return new LazyMap1(this.arr, callback);\n  }\n\n  forEach(callback: (v: T, i: number) => void) {\n    if (isIndicesAble(this.iterable)) {\n      for (let i = 0; i < this.iterable.length; ++i) {\n        callback(this.iterable[i], i);\n      }\n      return;\n    }\n    const it = this[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      callback(v.value, i);\n    }\n  }\n\n  some(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.iterable)) {\n      for (let i = 0; i < this.iterable.length; ++i) {\n        if (callback(this.iterable[i], i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    const it = this[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (callback(v.value, i)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  every(callback: (v: T, i: number) => boolean) {\n    if (isIndicesAble(this.iterable)) {\n      for (let i = 0; i < this.iterable.length; ++i) {\n        if (!callback(this.iterable[i], i)) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    const it = this[Symbol.iterator]();\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      if (!callback(v.value, i)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\n    if (isIndicesAble(this.iterable)) {\n      let acc = initial;\n      for (let i = 0; i < this.iterable.length; ++i) {\n        acc = callback(acc, this.iterable[i], i);\n      }\n      return acc;\n    }\n\n    const it = this[Symbol.iterator]();\n    let acc = initial;\n    for (let v = it.next(), i = 0; !v.done; v = it.next(), i++) {\n      acc = callback(acc, v.value, i);\n    }\n    return acc;\n  }\n\n  get length() {\n    const it = this.iterable;\n    if (isIndicesAble(it)) {\n      return it.length;\n    }\n    if (it instanceof Set || it instanceof Map) {\n      return it.size;\n    }\n    return this.arr.length;\n  }\n}\n\n/**\n * @internal\n */\nexport function lazySeq<T>(iterable: Iterable<T>): ISequence<T> {\n  return new LazySeq(iterable);\n}\n\nclass ConcatSequence<T> implements ISequence<T> {\n  constructor(private readonly seqs: ISequence<ISequence<T>>) {\n    //\n  }\n\n  [Symbol.iterator]() {\n    const seqs = Array.from(this.seqs);\n    let it = seqs.shift()![Symbol.iterator]();\n    const next = (): { value: T; done: boolean } => {\n      const v = it.next();\n      if (!v.done) {\n        return v as { value: T; done: boolean };\n      }\n      if (seqs.length === 0) {\n        // last last\n        return v;\n      }\n      // next iterator and compute next element\n      it = seqs.shift()![Symbol.iterator]();\n      return next();\n    };\n    return { next };\n  }\n\n  filter(callback: (v: T, i: number) => boolean): ISequence<T> {\n    return new LazyFilter(this, [callback]);\n  }\n\n  map<U>(callback: (v: T, i: number) => U): ISequence<U> {\n    return new LazyMap1(this, callback);\n  }\n\n  forEach(callback: (v: T, i: number) => void) {\n    this.seqs.forEach((s) => s.forEach(callback));\n  }\n\n  some(callback: (v: T, i: number) => boolean) {\n    return this.seqs.some((s) => s.some(callback));\n  }\n\n  every(callback: (v: T, i: number) => boolean) {\n    return this.seqs.every((s) => s.every(callback));\n  }\n\n  reduce<U>(callback: (acc: U, v: T, i: number) => U, initial: U) {\n    return this.seqs.reduce((acc, s) => s.reduce(callback, acc), initial);\n  }\n\n  get length() {\n    return this.seqs.reduce((a, b) => a + b.length, 0);\n  }\n}\n\n/**\n * @internal\n */\nexport function concatSeq<T>(seqs: ISequence<ISequence<T>>): ISequence<T>;\nexport function concatSeq<T>(seq1: ISequence<T>, seq2: ISequence<T>, ...seqs: ISequence<T>[]): ISequence<T>;\nexport function concatSeq<T>(\n  seq1: ISequence<T>[] | ISequence<T>,\n  seq2?: ISequence<T>,\n  ...seqs: ISequence<T>[]\n): ISequence<T> {\n  if (seq2) {\n    return new ConcatSequence([seq1 as ISequence<T>, seq2].concat(seqs));\n  }\n  return new ConcatSequence(seq1 as ISequence<T>[]);\n}\n","import type {\n  IWorkerMessage,\n  INumberStatsMessageRequest,\n  IAdvancedBoxPlotData,\n  ICategoricalStatistics,\n  IDateStatistics,\n  IStatistics,\n  ICategoricalStatsMessageRequest,\n  IDateStatsMessageRequest,\n  IBoxPlotStatsMessageRequest,\n} from './';\nimport type { UIntTypedArray, IndicesArray } from '../model';\n\n/**\n * @internal\n */\nexport interface IPoorManWorkerScopeEventMap {\n  message: MessageEvent;\n  error: ErrorEvent;\n}\n\ndeclare type IPoorManTransferAble = ArrayBuffer | MessagePort | ImageBitmap;\n\n/**\n * @internal\n */\nexport interface IPoorManWorkerScope {\n  onmessage: ((this: IPoorManWorkerScope, ev: MessageEvent) => any) | null;\n  onerror: ((this: IPoorManWorkerScope, ev: ErrorEvent) => any) | null;\n  close(): void;\n  postMessage(message: any, transfer?: IPoorManTransferAble[]): void;\n  addEventListener<K extends keyof IPoorManWorkerScopeEventMap>(\n    type: K,\n    listener: (this: IPoorManWorkerScope, ev: IPoorManWorkerScopeEventMap[K]) => any,\n    options?: boolean | AddEventListenerOptions\n  ): void;\n  removeEventListener<K extends keyof IPoorManWorkerScopeEventMap>(\n    type: K,\n    listener: (this: IPoorManWorkerScope, ev: IPoorManWorkerScopeEventMap[K]) => any,\n    options?: boolean | AddEventListenerOptions\n  ): void;\n}\n\n// function workerMain(self: IPoorManWorkerScope) {\n//   self.addEventListener('message', (evt) => {\n//     self.postMessage(`Worker: ${evt.data} - Polo`);\n//   });\n// }\n\n/**\n * @internal\n */\nexport function toFunctionBody(f: () => any) {\n  const source = f.toString();\n  return source.slice(source.indexOf('{') + 1, source.lastIndexOf('}'));\n}\n\n/**\n * create a blob out of the given function or string\n * @internal\n */\nexport function createWorkerCodeBlob(fs: (string | (() => any))[]) {\n  const sources = fs.map((d) => d.toString()).join('\\n\\n');\n\n  const blob = new Blob([sources], { type: 'application/javascript' });\n  return URL.createObjectURL(blob);\n}\n\nconst MIN_WORKER_THREADS = 1;\nconst MAX_WORKER_THREADS = Math.max(navigator.hardwareConcurrency - 1, 1); // keep one for the ui\n\nconst THREAD_CLEANUP_TIME = 10000; // 10s\n\ninterface ITaskWorker {\n  /**\n   * worker index\n   */\n  index: number;\n  /**\n   * worker itself\n   */\n  worker: Worker;\n  /**\n   * set of active task numbers\n   */\n  tasks: Set<number>;\n  /**\n   * list of references that are stored on this worker\n   */\n  refs: Set<string>;\n}\n\n/**\n * task scheduler based on web worker\n * @internal\n */\nexport class WorkerTaskScheduler {\n  private readonly workers: ITaskWorker[] = [];\n  private cleanUpWorkerTimer = -1;\n  /**\n   * worker task id\n   */\n  private workerTaskCounter = 0;\n\n  constructor(private readonly blob: string) {\n    for (let i = 0; i < MIN_WORKER_THREADS; ++i) {\n      const w = new Worker(blob);\n      this.workers.push({ worker: w, tasks: new Set(), refs: new Set(), index: i });\n    }\n  }\n\n  terminate() {\n    this.workers.splice(0, this.workers.length).forEach((w) => w.worker.terminate());\n  }\n\n  private readonly cleanUpWorker = () => {\n    // delete workers when they are not needed anymore and empty\n    while (this.workers.length > MIN_WORKER_THREADS) {\n      const toFree = this.workers.findIndex((d) => d.tasks.size === 0);\n      if (toFree < 0) {\n        break;\n      }\n      const w = this.workers.splice(toFree, 1)[0]!;\n      w.worker.terminate();\n    }\n    // maybe reschedule\n    this.finishedTask();\n  };\n\n  private checkOutWorker() {\n    if (this.cleanUpWorkerTimer >= 0) {\n      clearTimeout(this.cleanUpWorkerTimer);\n      this.cleanUpWorkerTimer = -1;\n    }\n\n    const emptyWorker = this.workers.find((d) => d.tasks.size === 0);\n\n    if (emptyWorker) {\n      return emptyWorker;\n    }\n\n    if (this.workers.length >= MAX_WORKER_THREADS) {\n      // find the one with the fewest tasks\n      return this.workers.reduce(\n        (a, b) => (a == null || a.tasks.size > b.tasks.size ? b : a),\n        null as ITaskWorker | null\n      )!;\n    }\n\n    // create new one\n    const r: ITaskWorker = {\n      worker: new Worker(this.blob),\n      tasks: new Set<number>(),\n      refs: new Set(),\n      index: this.workers.length,\n    };\n    this.workers.push(r);\n    return r;\n  }\n\n  private finishedTask() {\n    if (this.cleanUpWorkerTimer === -1 && this.workers.length > MIN_WORKER_THREADS) {\n      this.cleanUpWorkerTimer = setTimeout(this.cleanUpWorker, THREAD_CLEANUP_TIME) as unknown as number;\n    }\n  }\n\n  pushStats(\n    type: 'numberStats',\n    args: Partial<INumberStatsMessageRequest>,\n    refData: string,\n    data: Float32Array,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<IStatistics>;\n  pushStats(\n    type: 'boxplotStats',\n    args: Partial<IBoxPlotStatsMessageRequest>,\n    refData: string,\n    data: Float32Array,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<IAdvancedBoxPlotData>;\n  pushStats(\n    type: 'categoricalStats',\n    args: Partial<ICategoricalStatsMessageRequest>,\n    refData: string,\n    data: UIntTypedArray,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<ICategoricalStatistics>;\n  pushStats(\n    type: 'dateStats',\n    args: Partial<IDateStatsMessageRequest>,\n    refData: string,\n    data: Float64Array,\n    refIndices?: string,\n    indices?: IndicesArray\n  ): Promise<IDateStatistics>;\n  pushStats(\n    type: 'numberStats' | 'boxplotStats' | 'categoricalStats' | 'dateStats',\n    args: any,\n    refData: string,\n    data: Float32Array | UIntTypedArray | Float64Array,\n    refIndices?: string,\n    indices?: IndicesArray\n  ) {\n    return new Promise((resolve) => {\n      const uid = this.workerTaskCounter++;\n      const { worker, tasks, refs } = this.checkOutWorker();\n\n      const receiver = (msg: MessageEvent) => {\n        const r = msg.data as IWorkerMessage;\n        if (r.uid !== uid || r.type !== type) {\n          return;\n        }\n        // console.log('worker', index, uid, 'finish', r);\n        worker.removeEventListener('message', receiver);\n        tasks.delete(uid);\n        this.finishedTask();\n        resolve((r as any).stats);\n      };\n\n      worker.addEventListener('message', receiver);\n\n      tasks.add(uid);\n\n      const msg: any = Object.assign(\n        {\n          type,\n          uid,\n          refData,\n          refIndices: refIndices || null,\n        },\n        args\n      );\n\n      if (!refData || !refs.has(refData)) {\n        // need to transfer to worker\n        msg.data = data;\n        if (refData) {\n          // save that this worker has this ref\n          refs.add(refData);\n        }\n        // console.log(index, 'set ref (i)', refData);\n      }\n      if (indices && (!refIndices || !refs.has(refIndices))) {\n        // need to transfer\n        msg.indices = indices!;\n        if (refIndices) {\n          refs.add(refIndices);\n        }\n        // console.log(index, 'set ref (i)', refIndices);\n      }\n      // console.log('worker', index, uid, msg);\n\n      worker.postMessage(msg);\n    });\n  }\n\n  push<M, R>(type: string, args: M, transferAbles: ArrayBuffer[]): Promise<R>;\n  push<M, R, T>(type: string, args: M, transferAbles: ArrayBuffer[], toResult: (r: R) => T): Promise<T>;\n  push<M, R, T>(type: string, args: M, transferAbles: ArrayBuffer[], toResult?: (r: R) => T): Promise<T> {\n    return new Promise<T>((resolve) => {\n      const uid = this.workerTaskCounter++;\n      const { worker, tasks } = this.checkOutWorker();\n\n      const receiver = (msg: MessageEvent) => {\n        const r = msg.data as IWorkerMessage;\n        if (r.uid !== uid || r.type !== type) {\n          return;\n        }\n        // console.log('worker', index, uid, 'finish', r);\n        worker.removeEventListener('message', receiver);\n        tasks.delete(uid);\n        this.finishedTask();\n        resolve(toResult ? toResult(r as any) : (r as any));\n      };\n\n      worker.addEventListener('message', receiver);\n      tasks.add(uid);\n      const msg = Object.assign(\n        {\n          type,\n          uid,\n        },\n        args\n      );\n      // console.log('worker', index, uid, msg);\n\n      worker.postMessage(msg, transferAbles);\n    });\n  }\n\n  setRef(ref: string, data: Float32Array | UIntTypedArray | Int32Array | Float64Array | IndicesArray) {\n    for (const w of this.workers) {\n      w.refs.add(ref);\n    }\n    this.broadCast('setRef', {\n      ref,\n      data,\n    });\n  }\n\n  deleteRef(ref: string, startsWith = false) {\n    const uid = this.workerTaskCounter++;\n    const msg = {\n      type: 'deleteRef',\n      uid,\n      ref,\n      startsWith,\n    };\n    for (const w of this.workers) {\n      // console.log(w.index, 'delete ref', ref, startsWith);\n      w.worker.postMessage(msg);\n      if (!startsWith) {\n        w.refs.delete(ref);\n        continue;\n      }\n      for (const r of Array.from(w.refs)) {\n        if (r.startsWith(ref)) {\n          w.refs.delete(r);\n        }\n      }\n    }\n  }\n\n  deleteRefs() {\n    const uid = this.workerTaskCounter++;\n    const msg = {\n      type: 'deleteRef',\n      uid,\n      ref: '',\n      startsWith: true,\n    };\n    for (const w of this.workers) {\n      // console.log(w.index, 'delete refs');\n      w.worker.postMessage(msg);\n      w.refs.clear();\n    }\n  }\n\n  broadCast<T>(type: string, args: T) {\n    const uid = this.workerTaskCounter++;\n    // don't store in tasks queue since there is no response\n    const msg = Object.assign(\n      {\n        type,\n        uid,\n      },\n      args\n    );\n    // console.log('broadcast', msg);\n    for (const w of this.workers) {\n      w.worker.postMessage(msg);\n    }\n  }\n}\n","import type { ICategory, IndicesArray, UIntTypedArray } from '../model';\nimport { IForEachAble, ISequence, isIndicesAble } from './interable';\nimport { createWorkerCodeBlob, IPoorManWorkerScope, toFunctionBody } from './worker';\nimport type {\n  IAdvancedBoxPlotData,\n  IStatistics,\n  INumberBin,\n  IDateBin,\n  IDateStatistics,\n  ICategoricalStatistics,\n  ICategoricalBin,\n  IDateHistGranularity,\n} from './mathInterfaces';\n\n/**\n * computes the optimal number of bins for a given array length\n * @internal\n * @param {number} length\n * @returns {number}\n */\nexport function getNumberOfBins(length: number) {\n  if (length === 0) {\n    return 1;\n  }\n  // as by default used in d3 the Sturges' formula\n  return Math.ceil(Math.log(length) / Math.LN2) + 1;\n}\n\n/**\n * @internal\n */\nexport function min(values: number[]): number;\nexport function min<T>(values: T[], acc: (v: T) => number): number;\nexport function min<T>(values: T[], acc?: (v: T) => number) {\n  let min = Number.POSITIVE_INFINITY;\n  for (const d of values) {\n    const v = acc ? acc(d) : (d as any as number);\n    if (v < min) {\n      min = v;\n    }\n  }\n  return min;\n}\n\n/**\n * @internal\n */\nexport function max(values: number[]): number;\nexport function max<T>(values: T[], acc: (v: T) => number): number;\nexport function max<T>(values: T[], acc?: (v: T) => number) {\n  let max = Number.NEGATIVE_INFINITY;\n  for (const d of values) {\n    const v = acc ? acc(d) : (d as any as number);\n    if (v > max) {\n      max = v;\n    }\n  }\n  return max;\n}\n\n/**\n * @internal\n */\nexport function extent(values: number[]): [number, number];\nexport function extent<T>(values: T[], acc: (v: T) => number): [number, number];\nexport function extent<T>(values: T[], acc?: (v: T) => number) {\n  let max = Number.NEGATIVE_INFINITY;\n  let min = Number.POSITIVE_INFINITY;\n  for (const d of values) {\n    const v = acc ? acc(d) : (d as any as number);\n    if (v < min) {\n      min = v;\n    }\n    if (v > max) {\n      max = v;\n    }\n  }\n  return [min, max];\n}\n\n/**\n * @internal\n */\nexport function range(length: number) {\n  const r: number[] = new Array(length);\n  for (let i = 0; i < length; ++i) {\n    r[i] = i;\n  }\n  return r;\n}\n\n/**\n * an empty range\n * @internal\n */\nexport function empty(length: number) {\n  const r: null[] = new Array(length);\n  r.fill(null);\n  return r;\n}\n\n/**\n * computes the X quantile assumes the values are sorted\n * @internal\n */\nexport function quantile(values: ArrayLike<number>, quantile: number, length = values.length) {\n  if (length === 0) {\n    return NaN;\n  }\n  const target = (length - 1) * quantile;\n  const index = Math.floor(target);\n  if (index === target) {\n    return values[index];\n  }\n  const v = values[index];\n  const vAfter = values[index + 1];\n  return v + (vAfter - v) * (target - index); // shift by change\n}\n\n/**\n * @internal\n */\nexport function median(values: number[]): number;\nexport function median<T>(values: T[], acc: (v: T) => number): number;\nexport function median<T>(values: T[], acc?: (v: T) => number) {\n  const arr = acc ? values.map(acc) : (values as any as number[]).slice();\n  arr.sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));\n  return quantile(arr, 0.5);\n}\n\nfunction pushAll<T>(push: (v: T) => void) {\n  return (vs: IForEachAble<T>) => {\n    if (!isIndicesAble(vs)) {\n      vs.forEach(push);\n      return;\n    }\n    // tslint:disable-next-line:prefer-for-of\n    for (let j = 0; j < vs.length; ++j) {\n      push(vs[j]);\n    }\n  };\n}\n\n/**\n * common interface for a builder pattern\n * @internal\n */\nexport interface IBuilder<T, R> {\n  /**\n   * push an entry\n   */\n  push(v: T): void;\n  /**\n   * push multiple values at once\n   */\n  pushAll(vs: IForEachAble<T>): void;\n\n  /**\n   * build the result\n   */\n  build(): R;\n}\n\n/**\n * @internal\n */\nexport function boxplotBuilder(\n  fixedLength?: number\n): IBuilder<number, IAdvancedBoxPlotData> & { buildArr: (s: Float32Array) => IAdvancedBoxPlotData } {\n  let min = Number.POSITIVE_INFINITY;\n  let max = Number.NEGATIVE_INFINITY;\n  let sum = 0;\n  let length = 0;\n  let missing = 0;\n\n  // if fixed size use the typed array else a regular array\n  const values: number[] = [];\n  const vs: Float32Array | null = fixedLength != null ? new Float32Array(fixedLength) : null;\n\n  const push = (v: number) => {\n    length += 1;\n    if (v == null || Number.isNaN(v)) {\n      missing += 1;\n      return;\n    }\n    if (v < min) {\n      min = v;\n    }\n    if (v > max) {\n      max = v;\n    }\n    sum += v;\n  };\n\n  const pushAndSave = (v: number) => {\n    push(v);\n    if (vs) {\n      vs[length] = v;\n    } else {\n      values.push(v);\n    }\n  };\n\n  const invalid = {\n    min: NaN,\n    max: NaN,\n    mean: NaN,\n    missing,\n    count: length,\n    whiskerHigh: NaN,\n    whiskerLow: NaN,\n    outlier: [],\n    median: NaN,\n    q1: NaN,\n    q3: NaN,\n  };\n\n  const buildImpl = (s: ArrayLike<number>) => {\n    const valid = length - missing;\n    const median = quantile(s, 0.5, valid)!;\n    const q1 = quantile(s, 0.25, valid)!;\n    const q3 = quantile(s, 0.75, valid)!;\n\n    const iqr = q3 - q1;\n    const left = q1 - 1.5 * iqr;\n    const right = q3 + 1.5 * iqr;\n\n    let outlier: number[] = [];\n    // look for the closest value which is bigger than the computed left\n    let whiskerLow = left;\n    // tslint:disable-next-line:prefer-for-of\n    for (let i = 0; i < valid; ++i) {\n      const v = s[i];\n      if (left < v) {\n        whiskerLow = v;\n        break;\n      }\n      // outlier\n      outlier.push(v);\n    }\n    // look for the closest value which is smaller than the computed right\n    let whiskerHigh = right;\n    const reversedOutliers: number[] = [];\n    for (let i = valid - 1; i >= 0; --i) {\n      const v = s[i];\n      if (v < right) {\n        whiskerHigh = v;\n        break;\n      }\n      // outlier\n      reversedOutliers.push(v);\n    }\n\n    outlier = outlier.concat(reversedOutliers.reverse());\n\n    return {\n      min,\n      max,\n      count: length,\n      missing,\n      mean: sum / valid,\n      whiskerHigh,\n      whiskerLow,\n      outlier,\n      median,\n      q1,\n      q3,\n    };\n  };\n\n  const build = () => {\n    const valid = length - missing;\n\n    if (valid === 0) {\n      return invalid;\n    }\n\n    const s = vs ? vs.sort() : Float32Array.from(values).sort();\n    return buildImpl(s);\n  };\n\n  const buildArr = (vs: Float32Array) => {\n    const s = vs.slice().sort();\n    // tslint:disable-next-line:prefer-for-of\n    for (let j = 0; j < vs.length; ++j) {\n      push(vs[j]);\n    }\n    // missing are the last\n    return buildImpl(s);\n  };\n\n  return {\n    push: pushAndSave,\n    build,\n    buildArr,\n    pushAll: pushAll(pushAndSave),\n  };\n}\n\n/**\n * @internal\n */\nexport function numberStatsBuilder(domain: [number, number], numberOfBins: number): IBuilder<number, IStatistics> {\n  const hist: INumberBin[] = [];\n\n  let x0 = domain[0];\n  const range = domain[1] - domain[0];\n  const binWidth = range / numberOfBins;\n  for (let i = 0; i < numberOfBins; ++i, x0 += binWidth) {\n    hist.push({\n      x0,\n      x1: x0 + binWidth,\n      count: 0,\n    });\n  }\n\n  const bin1 = domain[0] + binWidth;\n  const binN = domain[1] - binWidth;\n\n  const toBin = (v: number) => {\n    if (v < bin1) {\n      return 0;\n    }\n    if (v >= binN) {\n      return numberOfBins - 1;\n    }\n    if (numberOfBins === 3) {\n      return 1;\n    }\n    let low = 1;\n    let high = numberOfBins - 1;\n    // binary search\n    while (low < high) {\n      const center = Math.floor((high + low) / 2);\n      if (v < hist[center].x1) {\n        high = center;\n      } else {\n        low = center + 1;\n      }\n    }\n    return low;\n  };\n\n  // filter out NaN\n  let min = Number.POSITIVE_INFINITY;\n  let max = Number.NEGATIVE_INFINITY;\n  let sum = 0;\n  let length = 0;\n  let missing = 0;\n\n  const push = (v: number) => {\n    length += 1;\n    if (v == null || Number.isNaN(v)) {\n      missing += 1;\n      return;\n    }\n    if (v < min) {\n      min = v;\n    }\n    if (v > max) {\n      max = v;\n    }\n    sum += v;\n\n    hist[toBin(v)].count++;\n  };\n\n  const build = () => {\n    const valid = length - missing;\n    if (valid === 0) {\n      return {\n        count: missing,\n        missing,\n        min: NaN,\n        max: NaN,\n        mean: NaN,\n        hist,\n        maxBin: 0,\n      };\n    }\n    return {\n      count: length,\n      min,\n      max,\n      mean: sum / valid,\n      missing,\n      hist,\n      maxBin: hist.reduce((a, b) => Math.max(a, b.count), 0),\n    };\n  };\n\n  return { push, build, pushAll: pushAll(push) };\n}\n\n/**\n * guesses the histogram granularity to use based on min and max date\n */\nfunction computeGranularity(\n  min: Date | null,\n  max: Date | null\n): { histGranularity: IDateHistGranularity; hist: IDateBin[] } {\n  if (min == null || max == null) {\n    return { histGranularity: 'year', hist: [] };\n  }\n  const hist: IDateBin[] = [];\n\n  if (max.getFullYear() - min.getFullYear() >= 2) {\n    // more than two years difference\n    const minYear = min.getFullYear();\n    const maxYear = max.getFullYear();\n    for (let i = minYear; i <= maxYear; ++i) {\n      hist.push({\n        x0: new Date(i, 0, 1),\n        x1: new Date(i + 1, 0, 1),\n        count: 0,\n      });\n    }\n    return { hist, histGranularity: 'year' };\n  }\n\n  if (max.getTime() - min.getTime() <= 1000 * 60 * 60 * 24 * 31) {\n    // less than a month use day\n    let x0 = new Date(min.getFullYear(), min.getMonth(), min.getDate());\n    while (x0 <= max) {\n      const x1 = new Date(x0);\n      x1.setDate(x1.getDate() + 1);\n      hist.push({\n        x0,\n        x1,\n        count: 0,\n      });\n      x0 = x1;\n    }\n    return { hist, histGranularity: 'day' };\n  }\n\n  // by month\n  let x0 = new Date(min.getFullYear(), min.getMonth(), 1);\n  while (x0 <= max) {\n    const x1 = new Date(x0);\n    x1.setMonth(x1.getMonth() + 1);\n    hist.push({\n      x0,\n      x1,\n      count: 0,\n    });\n    x0 = x1;\n  }\n  return { hist, histGranularity: 'month' };\n}\n\nfunction pushDateHist(hist: IDateBin[], v: Date, count = 1) {\n  if (v < hist[0].x1) {\n    hist[0].count += count;\n    return;\n  }\n  const l = hist.length - 1;\n  if (v > hist[l].x0) {\n    hist[l].count += count;\n    return;\n  }\n  if (l === 2) {\n    hist[1].count += count;\n    return;\n  }\n\n  let low = 1;\n  let high = l;\n  // binary search\n  while (low < high) {\n    const center = Math.floor((high + low) / 2);\n    if (v < hist[center].x1) {\n      high = center;\n    } else {\n      low = center + 1;\n    }\n  }\n  hist[low].count += count;\n}\n/**\n * @internal\n */\nexport function dateStatsBuilder(template?: IDateStatistics): IBuilder<Date | null, IDateStatistics> {\n  let min: Date | null = null;\n  let max: Date | null = null;\n  let count = 0;\n  let missing = 0;\n\n  // yyyymmdd, count\n  const byDay = new Map<number, { x: Date; count: number }>();\n  const templateHist = template ? template.hist.map((d) => ({ x0: d.x0, x1: d.x1, count: 0 })) : null;\n\n  const push = (v: Date | null) => {\n    count += 1;\n    if (!v || v == null) {\n      missing += 1;\n      return;\n    }\n    if (min == null || v < min) {\n      min = v;\n    }\n    if (max == null || v > max) {\n      max = v;\n    }\n    if (templateHist) {\n      pushDateHist(templateHist, v, 1);\n      return;\n    }\n    const key = v.getFullYear() * 10000 + v.getMonth() * 100 + v.getDate();\n    if (byDay.has(key)) {\n      byDay.get(key)!.count++;\n    } else {\n      byDay.set(key, { count: 1, x: v });\n    }\n  };\n\n  const build = () => {\n    if (templateHist) {\n      return {\n        min,\n        max,\n        missing,\n        count,\n        maxBin: templateHist.reduce((acc, h) => Math.max(acc, h.count), 0),\n        hist: templateHist,\n        histGranularity: template!.histGranularity,\n      };\n    }\n    // copy template else derive\n    const { histGranularity, hist } = computeGranularity(min, max);\n\n    byDay.forEach((v) => pushDateHist(hist, v.x, v.count));\n\n    return {\n      min,\n      max,\n      missing,\n      count,\n      maxBin: hist.reduce((acc, h) => Math.max(acc, h.count), 0),\n      hist,\n      histGranularity,\n    };\n  };\n\n  return { push, build, pushAll: pushAll(push) };\n}\n\n/**\n * computes a categorical histogram\n * @param arr the data array\n * @param categories the list of known categories\n * @returns {{hist: {cat: string, y: number}[]}}\n * @internal\n */\nexport function categoricalStatsBuilder(\n  categories: { name: string }[]\n): IBuilder<{ name: string } | null, ICategoricalStatistics> {\n  const m = new Map<string, number>();\n  categories.forEach((cat) => m.set(cat.name, 0));\n\n  let missing = 0;\n  let count = 0;\n\n  const push = (v: ICategory | null) => {\n    count += 1;\n    if (v == null) {\n      missing += 1;\n    } else {\n      m.set(v.name, (m.get(v.name) || 0) + 1);\n    }\n  };\n\n  const build = () => {\n    const entries: ICategoricalBin[] = categories.map((d) => ({ cat: d.name, count: m.get(d.name)! }));\n    const maxBin = entries.reduce((a, b) => Math.max(a, b.count), Number.NEGATIVE_INFINITY);\n\n    return {\n      maxBin,\n      hist: entries,\n      count,\n      missing,\n    };\n  };\n\n  return { push, build, pushAll: pushAll(push) };\n}\n\n/**\n * round to the given commas similar to d3.round\n * @param {number} v\n * @param {number} precision\n * @returns {number}\n * @internal\n */\nexport function round(v: number, precision = 0) {\n  if (precision === 0) {\n    return Math.round(v);\n  }\n  const scale = Math.pow(10, precision);\n  return Math.round(v * scale) / scale;\n}\n\n/**\n * compares two number whether they are similar up to delta\n * @param {number} a first number\n * @param {number} b second number\n * @param {number} delta\n * @returns {boolean} a and b are similar\n * @internal\n */\nexport function similar(a: number, b: number, delta = 0.5) {\n  if (a === b) {\n    return true;\n  }\n  return Math.abs(a - b) < delta;\n}\n\n/**\n * @internal\n */\nexport function isPromiseLike<T>(value: any): value is PromiseLike<T> {\n  return value instanceof Promise || typeof value.then === 'function';\n}\n\n/**\n * @internal\n */\nexport function createIndexArray(length: number, dataSize = length) {\n  if (dataSize <= 255) {\n    return new Uint8Array(length);\n  }\n  if (dataSize <= 65535) {\n    return new Uint16Array(length);\n  }\n  return new Uint32Array(length);\n}\n\n/**\n * @internal\n */\nexport function toIndexArray(arr: ISequence<number> | IndicesArray, maxDataIndex?: number): UIntTypedArray {\n  if (arr instanceof Uint8Array || arr instanceof Uint16Array || arr instanceof Uint32Array) {\n    return arr.slice();\n  }\n  const l = maxDataIndex != null ? maxDataIndex : arr.length;\n  if (l <= 255) {\n    return Uint8Array.from(arr);\n  }\n  if (l <= 65535) {\n    return Uint16Array.from(arr);\n  }\n  return Uint32Array.from(arr);\n}\n\nfunction createLike(template: IndicesArray, total: number, maxDataIndex?: number) {\n  if (template instanceof Uint8Array) {\n    return new Uint8Array(total);\n  }\n  if (template instanceof Uint16Array) {\n    return new Uint16Array(total);\n  }\n  if (template instanceof Uint32Array) {\n    return new Uint32Array(total);\n  }\n  return createIndexArray(total, maxDataIndex);\n}\n\n/**\n * @internal\n */\nexport function joinIndexArrays(groups: IndicesArray[], maxDataIndex?: number) {\n  switch (groups.length) {\n    case 0:\n      return [];\n    case 1:\n      return groups[0];\n    default:\n      const total = groups.reduce((a, b) => a + b.length, 0);\n      const r = createLike(groups[0], total, maxDataIndex);\n      let shift = 0;\n      for (const g of groups) {\n        r.set(g, shift);\n        shift += g.length;\n      }\n      return r;\n  }\n}\n\nfunction asc(a: any, b: any) {\n  return a < b ? -1 : a > b ? 1 : 0;\n}\n\nfunction desc(a: any, b: any) {\n  return a < b ? 1 : a > b ? -1 : 0;\n}\n\nexport declare type ILookUpArray =\n  | Uint8Array\n  | Uint16Array\n  | Uint32Array\n  | Int8Array\n  | Int16Array\n  | Int32Array\n  | string[]\n  | Float32Array\n  | Float64Array;\n\n/**\n * sort the given index array based on the lookup array\n * @internal\n */\nexport function sortComplex(indices: UIntTypedArray | number[], comparators: { asc: boolean; lookup: ILookUpArray }[]) {\n  if (indices.length < 2) {\n    return indices;\n  }\n\n  switch (comparators.length) {\n    case 0:\n      // sort by indices\n      return indices.sort();\n    case 1:\n      const c = comparators[0]!.asc ? asc : desc;\n      const cLookup = comparators[0]!.lookup;\n      return indices.sort((a, b) => {\n        const r = c(cLookup[a]!, cLookup[b]!);\n        return r !== 0 ? r : a - b;\n      });\n    case 2:\n      const c1 = comparators[0]!.asc ? asc : desc;\n      const c1Lookup = comparators[0]!.lookup;\n      const c2 = comparators[1]!.asc ? asc : desc;\n      const c2Lookup = comparators[1]!.lookup;\n      return indices.sort((a, b) => {\n        let r = c1(c1Lookup[a], c1Lookup[b]);\n        r = r !== 0 ? r : c2(c2Lookup[a], c2Lookup[b]);\n        return r !== 0 ? r : a - b;\n      });\n    default:\n      const l = comparators.length;\n      const fs = comparators.map((d) => (d.asc ? asc : desc));\n      return indices.sort((a, b) => {\n        for (let i = 0; i < l; ++i) {\n          const l = comparators[i].lookup;\n          const r = fs[i](l[a], l[b]);\n          if (r !== 0) {\n            return r;\n          }\n        }\n        return a - b;\n      });\n  }\n}\n\n// note the whole worker thing is in this one file to be able to copy the code\n\n/**\n * base worker message\n * @internal\n */\nexport interface IWorkerMessage {\n  type: string;\n  uid: number;\n}\n\n/**\n * @internal\n */\nexport interface IStatsWorkerMessage extends IWorkerMessage {\n  /**\n   * reference key for the indices array\n   */\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  /**\n   * reference key for the data indices\n   */\n  refData: string;\n  data?: UIntTypedArray | Float32Array | Int32Array | Float64Array;\n}\n\n/**\n * @internal\n */\nexport interface ISortMessageRequest {\n  type: 'sort';\n  uid: number;\n\n  ref: string;\n  indices: UIntTypedArray;\n  sortOrders?: { asc: boolean; lookup: ILookUpArray }[];\n}\n\n/**\n * @internal\n */\nexport interface ISortMessageResponse {\n  type: 'sort';\n\n  ref: string;\n  order: IndicesArray;\n}\n\n/**\n * @internal\n */\nexport interface IDeleteRefMessageRequest {\n  type: 'deleteRef';\n\n  ref: string;\n  startsWith?: boolean;\n}\n\n/**\n * @internal\n */\nexport interface ISetRefMessageRequest {\n  type: 'setRef';\n  uid: number;\n\n  ref: string;\n  data: UIntTypedArray | Float32Array | Int32Array | Float64Array | null;\n}\n\n/**\n * @internal\n */\nexport interface IDateStatsMessageRequest {\n  type: 'dateStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: UIntTypedArray;\n\n  template?: IDateStatistics;\n}\n\n/**\n * @internal\n */\nexport interface IDateStatsMessageResponse {\n  type: 'dateStats';\n  uid: number;\n\n  stats: IDateStatistics;\n}\n\n/**\n * @internal\n */\nexport interface INumberStatsMessageRequest {\n  type: 'numberStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: Float32Array;\n\n  domain: [number, number];\n  numberOfBins: number;\n}\n\n/**\n * @internal\n */\nexport interface INumberStatsMessageResponse {\n  type: 'numberStats';\n  uid: number;\n\n  stats: IStatistics;\n}\n\n/**\n * @internal\n */\nexport interface IBoxPlotStatsMessageRequest {\n  type: 'boxplotStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: Float32Array;\n}\n\n/**\n * @internal\n */\nexport interface IBoxPlotStatsMessageResponse {\n  type: 'boxplotStats';\n  uid: number;\n\n  stats: IAdvancedBoxPlotData;\n}\n\n/**\n * @internal\n */\nexport interface ICategoricalStatsMessageRequest {\n  type: 'categoricalStats';\n  uid: number;\n\n  refIndices: string | null;\n  indices?: UIntTypedArray;\n\n  refData: string;\n  data?: UIntTypedArray;\n\n  categories: string[];\n}\n\n/**\n * @internal\n */\nexport interface ICategoricalStatsMessageResponse {\n  type: 'categoricalStats';\n  uid: number;\n\n  stats: ICategoricalStatistics;\n}\n\n/**\n * helper to build a value cache for dates, use dateValueCache2Value to convert back\n * @internal\n */\nexport function dateValueCacheBuilder(length: number) {\n  const vs = new Float64Array(length);\n  let i = 0;\n  return {\n    push: (d: Date | null) => (vs[i++] = d == null ? NaN : d.getTime()),\n    cache: vs,\n  };\n}\n\n/**\n * @internal\n */\nexport function dateValueCache2Value(v: number) {\n  return Number.isNaN(v) ? null : new Date(v);\n}\n\n/**\n * @internal\n */\nexport function categoricalValueCacheBuilder(length: number, categories: { name: string }[]) {\n  const vs = createIndexArray(length, categories.length + 1);\n  const name2index = new Map<string, number>();\n  for (let i = 0; i < categories.length; ++i) {\n    name2index.set(categories[i].name, i + 1); // shift by one for missing = 0\n  }\n  let i = 0;\n  return {\n    push: (d: { name: string } | null) => (vs[i++] = d == null ? 0 : name2index.get(d.name) || 0),\n    cache: vs,\n  };\n}\n\n/**\n * @internal\n */\nexport function categoricalValueCache2Value<T extends { name: string }>(v: number, categories: T[]) {\n  return v === 0 ? null : categories[v - 1];\n}\n\nfunction sortWorkerMain() {\n  // eslint-disable-next-line no-restricted-globals\n  const wself = self as any as IPoorManWorkerScope;\n\n  // stored refs to avoid duplicate copy\n  const refs = new Map<string, UIntTypedArray | Float32Array | Int32Array | Float64Array>();\n\n  const sort = (r: ISortMessageRequest) => {\n    if (r.sortOrders) {\n      sortComplex(r.indices, r.sortOrders);\n    }\n    const order = r.indices;\n\n    wself.postMessage(\n      {\n        type: r.type,\n        uid: r.uid,\n        ref: r.ref,\n        order,\n      } as ISortMessageResponse,\n      [r.indices.buffer]\n    );\n  };\n\n  const setRef = (r: ISetRefMessageRequest) => {\n    if (r.data) {\n      refs.set(r.ref, r.data);\n    } else {\n      refs.delete(r.ref);\n    }\n  };\n\n  const deleteRef = (r: IDeleteRefMessageRequest) => {\n    if (!r.startsWith) {\n      refs.delete(r.ref);\n      return;\n    }\n\n    for (const key of Array.from(refs.keys())) {\n      if (key.startsWith(r.ref)) {\n        refs.delete(key);\n      }\n    }\n  };\n\n  const resolveRefs = <T extends UIntTypedArray | Float32Array | Int32Array>(r: IStatsWorkerMessage) => {\n    // resolve refs or save the new data\n\n    const data: T = r.data ? (r.data as any as T) : (refs.get(r.refData)! as any as T);\n    const indices = r.indices ? r.indices : r.refIndices ? (refs.get(r.refIndices)! as UIntTypedArray) : undefined;\n    if (r.refData) {\n      refs.set(r.refData, data);\n    }\n    if (r.refIndices) {\n      refs.set(r.refIndices, indices!);\n    }\n    return { data, indices };\n  };\n\n  const dateStats = (r: IDateStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<Int32Array>(r);\n\n    const b = dateStatsBuilder(r.template);\n    if (indices) {\n      // tslint:disable-next-line:prefer-for-of\n      for (let ii = 0; ii < indices.length; ++ii) {\n        const v = data[indices[ii]];\n        b.push(dateValueCache2Value(v));\n      }\n    } else {\n      // tslint:disable-next-line:prefer-for-of\n      for (let i = 0; i < data.length; ++i) {\n        b.push(dateValueCache2Value(data[i]));\n      }\n    }\n    wself.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats: b.build(),\n    } as IDateStatsMessageResponse);\n  };\n\n  const categoricalStats = (r: ICategoricalStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<UIntTypedArray>(r);\n\n    const cats = r.categories.map((name) => ({ name }));\n    const b = categoricalStatsBuilder(cats);\n    if (indices) {\n      // tslint:disable-next-line:prefer-for-of\n      for (let ii = 0; ii < indices.length; ++ii) {\n        b.push(categoricalValueCache2Value(data[indices[ii]], cats));\n      }\n    } else {\n      // tslint:disable-next-line:prefer-for-of\n      for (let i = 0; i < data.length; ++i) {\n        b.push(categoricalValueCache2Value(data[i], cats));\n      }\n    }\n\n    wself.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats: b.build(),\n    } as ICategoricalStatsMessageResponse);\n  };\n\n  const numberStats = (r: INumberStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<Float32Array>(r);\n\n    const b = numberStatsBuilder(r.domain ?? [0, 1], r.numberOfBins);\n\n    if (indices) {\n      // tslint:disable-next-line:prefer-for-of\n      for (let ii = 0; ii < indices.length; ++ii) {\n        b.push(data[indices[ii]]);\n      }\n    } else {\n      // tslint:disable-next-line:prefer-for-of\n      for (let i = 0; i < data.length; ++i) {\n        b.push(data[i]);\n      }\n    }\n\n    wself.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats: b.build(),\n    } as INumberStatsMessageResponse);\n  };\n\n  const boxplotStats = (r: IBoxPlotStatsMessageRequest) => {\n    const { data, indices } = resolveRefs<Float32Array>(r);\n\n    const b = boxplotBuilder(indices ? indices.length : undefined);\n\n    let stats: IAdvancedBoxPlotData;\n    if (!indices) {\n      stats = b.buildArr(data);\n    } else {\n      // tslint:disable-next-line:prefer-for-of\n      for (let ii = 0; ii < indices.length; ++ii) {\n        b.push(data[indices[ii]]);\n      }\n      stats = b.build();\n    }\n\n    wself.postMessage({\n      type: r.type,\n      uid: r.uid,\n      stats,\n    } as IBoxPlotStatsMessageResponse);\n  };\n\n  // message type to handler function\n  const msgHandlers: { [key: string]: (r: any) => void } = {\n    sort,\n    setRef,\n    deleteRef,\n    dateStats,\n    categoricalStats,\n    numberStats,\n    boxplotStats,\n  };\n\n  wself.addEventListener('message', (evt) => {\n    const r = evt.data;\n    if (typeof r.uid !== 'number' || typeof r.type !== 'string') {\n      return;\n    }\n    const h = msgHandlers[r.type];\n    if (h) {\n      h(r);\n    }\n  });\n}\n\n/**\n * copy source code of a worker and create a blob out of it\n * to avoid webpack imports all the code functions need to be in this file\n * @internal\n */\nexport function createWorkerBlob() {\n  return createWorkerCodeBlob([\n    pushAll.toString(),\n    quantile.toString(),\n    numberStatsBuilder.toString(),\n    boxplotBuilder.toString(),\n    computeGranularity.toString(),\n    pushDateHist.toString(),\n    dateStatsBuilder.toString(),\n    categoricalStatsBuilder.toString(),\n    createIndexArray.toString(),\n    asc.toString(),\n    desc.toString(),\n    sortComplex.toString(),\n    dateValueCache2Value.toString(),\n    categoricalValueCache2Value.toString(),\n    toFunctionBody(sortWorkerMain),\n  ]);\n}\n","import * as equalImpl from 'fast-deep-equal';\n\n// keep here to have a \"real\" export for webpack not just interfaces\n\n/**\n * deep equal comparison\n */\nexport function equal(a: any, b: any): boolean {\n  const f = typeof equalImpl === 'function' ? equalImpl : (equalImpl as any).default;\n  return f(a, b);\n}\n\n/** @internal */\nexport function equalArrays<T>(a: T[], b: T[]) {\n  if (a.length !== b.length) {\n    return false;\n  }\n  return a.every((ai, i) => ai === b[i]);\n}\n\n/**\n * converts a given id to css compatible one\n * @param id\n * @return {string|void}\n * @internal\n */\nexport function fixCSS(id: string) {\n  return id.replace(/[\\s!#$%&'()*+,./:;<=>?@[\\\\\\]^`{|}~]+/g, '_'); //replace non css stuff to _\n}\n\n/**\n * clear node clearing\n * @param node\n * @internal\n */\nexport function clear<T extends Node>(node: T) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n  return node;\n}\n\n/**\n * @internal\n * to avoid [].concat(...) which doesn't work for large arrays\n * @param arrs\n */\nexport function concat<T>(arrs: (T[] | T)[]): T[] {\n  const r: T[] = [];\n  for (const a of arrs) {\n    if (!Array.isArray(a)) {\n      r.push(a);\n      continue;\n    }\n    for (const ai of a) {\n      r.push(ai);\n    }\n  }\n  return r;\n}\n\n/**\n * generates a label for the given sort method\n * @internal\n * @param method sort method\n */\nexport function getSortLabel(method: string) {\n  switch (method) {\n    case 'min':\n      return 'Minimum';\n    case 'max':\n      return 'Maximum';\n    case 'median':\n      return 'Median';\n    case 'mean':\n      return 'Mean';\n    case 'q1':\n      return '25% Quantile';\n    case 'q3':\n      return '75% Quantile';\n    default:\n      return String(method);\n  }\n}\n","var noop = {value: () => {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _) || /[\\s.]/.test(t)) throw new Error(\"illegal type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) args[i] = arguments[i + 2];\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","import { dispatch, Dispatch } from 'd3-dispatch';\n\n/**\n * helper function to suffix the given event types\n * @internal\n */\nexport function suffix(suffix: string, ...prefix: string[]) {\n  return prefix.map((p) => `${p}${suffix}`);\n}\n\nexport interface IEventContext {\n  /**\n   * who is sending this event\n   */\n  readonly source: AEventDispatcher;\n\n  /**\n   * who was sending this event in case of forwarding\n   */\n  readonly origin: AEventDispatcher;\n  /**\n   * the event type\n   */\n  readonly type: string;\n  /**\n   * in case of multi propagation the 'main' event type, aka the first one\n   */\n  readonly primaryType: string;\n  /**\n   * the arguments to the listener\n   */\n  readonly args: any[];\n}\n\nexport interface IEventListener {\n  (this: IEventContext, ...args: any[]): any;\n}\n\nexport interface IEventHandler {\n  on(type: string | string[], listener: IEventListener | null): this;\n}\n\nconst __DEBUG = false;\n\n/**\n * base class for event dispatching using d3 event mechanism, thus .suffix is supported for multiple registrations\n */\nexport default class AEventDispatcher implements IEventHandler {\n  private readonly listeners: Dispatch<any>;\n  private readonly listenerEvents: Set<string>;\n  private readonly forwarder: (...args: any[]) => void;\n\n  constructor() {\n    const events = this.createEventList();\n    this.listenerEvents = new Set(events);\n    this.listeners = dispatch(...events);\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.forwarder = function (this: IEventContext, ...args: any[]) {\n      that.fireImpl(this.type, this.primaryType, this.origin, ...args);\n    };\n  }\n\n  on(type: string | string[], listener: IEventListener | null): this {\n    if (Array.isArray(type)) {\n      type.forEach((d) => {\n        if (this.listenerEvents.has(d.split('.')[0])) {\n          this.listenersChanged(d, Boolean(listener!));\n          this.listeners.on(d, listener!);\n        } else if (__DEBUG && !d.includes('.')) {\n          console.warn(this, 'invalid event type', d);\n        }\n      });\n    } else if (this.listenerEvents.has((type as string).split('.')[0])) {\n      this.listenersChanged(type as string, Boolean(listener!));\n      this.listeners.on(type as string, listener!);\n    } else if (__DEBUG && !type.includes('.')) {\n      console.warn(this, 'invalid event type', type);\n    }\n    return this;\n  }\n\n  /**\n   * helper function that will be called upon a listener has changed\n   * @param _type event type\n   * @param _active registered or de registered\n   */\n  protected listenersChanged(_type: string, _active: boolean) {\n    // hook\n  }\n\n  /**\n   * return the list of events to be able to dispatch\n   * @return {Array} by default no events\n   */\n  protected createEventList(): string[] {\n    return [];\n  }\n\n  protected fire(type: string | string[], ...args: any[]) {\n    const primaryType = Array.isArray(type) ? type[0] : type;\n    this.fireImpl(type, primaryType, this, ...args);\n  }\n\n  private fireImpl(type: string | string[], primaryType: string, origin: AEventDispatcher, ...args: any[]) {\n    const fireImpl = (t: string) => {\n      if (!this.listenerEvents.has(t)) {\n        if (__DEBUG) {\n          console.warn(this, 'invalid event type', t);\n        }\n        return;\n      }\n      //local context per event, set a this argument\n      const context: IEventContext = {\n        source: this, //who is sending this event,\n        origin,\n        type: t, //the event type\n        primaryType, //in case of multi propagation the 'main' event type\n        args, //the arguments to the listener\n      };\n      this.listeners.apply(t, context, args);\n    };\n    if (Array.isArray(type)) {\n      type.forEach(fireImpl);\n    } else {\n      fireImpl(type as string);\n    }\n  }\n\n  /**\n   * forwards one or more events from a given dispatcher to the current one\n   * i.e. when one of the given events is fired in 'from' it will be forwarded to all my listeners\n   * @param {IEventHandler} from the event dispatcher to forward from\n   * @param {string[]} types the event types to forward\n   */\n  protected forward(from: IEventHandler, ...types: string[]) {\n    from.on(types, this.forwarder);\n  }\n\n  /**\n   * removes the forwarding declarations\n   * @param {IEventHandler} from the originated dispatcher\n   * @param {string[]} types event types to forward\n   */\n  protected unforward(from: IEventHandler, ...types: string[]) {\n    from.on(types, null);\n  }\n}\n","import 'reflect-metadata';\nimport type Column from './Column';\nimport type { IColumnDesc, IColumnConstructor } from './interfaces';\n\nconst supportType = Symbol.for('SupportType');\nconst category = Symbol.for('Category');\n\nexport function SupportType() {\n  return Reflect.metadata(supportType, true);\n}\n\nexport function SortByDefault(order: 'ascending' | 'descending' = 'ascending') {\n  if (order === 'descending') {\n    return Reflect.metadata(Symbol.for('sortDescendingByDefault'), true);\n  }\n  return (d: any) => d;\n}\n\nexport function isSortingAscByDefault(col: Column) {\n  const clazz = (col as any).constructor;\n  return !Reflect.hasMetadata(Symbol.for('sortDescendingByDefault'), clazz);\n}\n\nexport class Categories {\n  readonly string = { label: 'label', order: 1, name: 'string', featureLevel: 'basic' };\n  readonly categorical = { label: 'categorical', order: 2, name: 'categorical', featureLevel: 'basic' };\n  readonly number = { label: 'numerical', order: 3, name: 'number', featureLevel: 'basic' };\n  readonly date = { label: 'date', order: 4, name: 'date', featureLevel: 'basic' };\n  readonly array = { label: 'matrix', order: 5, name: 'array', featureLevel: 'advanced' };\n  readonly map = { label: 'map', order: 6, name: 'map', featureLevel: 'advanced' };\n  readonly composite = { label: 'combined', order: 7, name: 'composite', featureLevel: 'advanced' };\n  readonly support = { label: 'support', order: 8, name: 'support', featureLevel: 'advanced' };\n  readonly other = { label: 'others', order: 9, name: 'other', featureLevel: 'advanced' };\n}\n\nexport const categories = new Categories();\n\nexport function Category(cat: keyof Categories) {\n  return Reflect.metadata(category, cat);\n}\n\nexport function getSortType(col: Column): 'abc' | 'num' | undefined {\n  const cat = categoryOf(col);\n  const type = col.desc.type;\n  if (cat === categories.string || cat === categories.categorical) {\n    return 'abc';\n  }\n  if (cat === categories.number || type === 'rank' || isSortingAscByDefault(col)) {\n    return 'num';\n  }\n  const numbers = new Set(['rank', 'number', 'numbers', 'ordinal', 'boxplot', 'script', 'reduce', 'stack']);\n  return numbers.has(type) ? 'num' : undefined;\n}\n\nexport function toolbar(...keys: string[]) {\n  return Reflect.metadata(Symbol.for('toolbarIcon'), keys);\n}\n\nexport function dialogAddons(key: string, ...keys: string[]) {\n  return Reflect.metadata(Symbol.for(`toolbarDialogAddon${key}`), keys);\n}\n\nexport function isSupportType(col: Column) {\n  const clazz = (col as any).constructor;\n  return Reflect.hasMetadata(supportType, clazz);\n}\n\nexport interface IColumnCategory {\n  label: string;\n  name: string;\n  order: number;\n  featureLevel: 'basic' | 'advanced';\n}\n\nexport function categoryOf(col: IColumnConstructor | Column): IColumnCategory {\n  const cat = (Reflect.getMetadata(\n    category,\n    typeof col === 'function' ? col : Object.getPrototypeOf(col).constructor\n  ) ?? 'other') as keyof Categories;\n  return (categories[cat] ?? categories.other) as IColumnCategory;\n}\n\nexport function categoryOfDesc(\n  col: IColumnDesc | string,\n  models: { [key: string]: IColumnConstructor }\n): IColumnCategory {\n  const type = typeof col === 'string' ? col : col.type;\n  const clazz = models[type];\n  return clazz ? categoryOf(clazz) : (categories.other as IColumnCategory);\n}\n","import type Column from './Column';\nimport type Ranking from './Ranking';\nimport type CompositeColumn from './CompositeColumn';\nimport type { IColorMappingFunction, IMappingFunction } from './INumberColumn';\nimport type { ICategoricalColorMappingFunction, ICategory } from './ICategoricalColumn';\nimport type { IScriptMappingFunctionType } from './MappingFunction';\n\nexport interface IColumnConstructor {\n  new (id: string, desc: Readonly<IColumnDesc> & any, factory: ITypeFactory): Column;\n}\n\nexport interface IStyleColumn {\n  /**\n   * column description\n   */\n  description: string;\n\n  /**\n   * column summary line (subtitle)\n   */\n  summary: string;\n\n  /**\n   * color of this column\n   * @deprecated not used anymore\n   */\n  color: string;\n\n  /**\n   * frozen column\n   * @default isSupportType\n   */\n  frozen: boolean;\n\n  /**\n   * whether the column can be removed or not\n   * @default false\n   */\n  fixed: boolean;\n\n  /**\n   * default renderer to use\n   */\n  renderer: string;\n\n  /**\n   * default group renderer to use\n   */\n  groupRenderer: string;\n\n  /**\n   * default summary renderer to use\n   */\n  summaryRenderer: string;\n\n  /**\n   * initial width of the column\n   * @default 100 or 200 for strings\n   */\n  width: number;\n\n  /**\n   * is this column visible by default\n   * @default true\n   */\n  visible: boolean;\n}\n\nexport interface IColumnDesc extends Partial<IStyleColumn> {\n  /**\n   * label of the column\n   */\n  label: string;\n  /**\n   * the column type\n   */\n  type: string;\n}\n\nexport interface IValueColumnDesc<T> extends IColumnDesc {\n  /**\n   * is the data lazy loaded and not yet available\n   * @default false\n   */\n  lazyLoaded?: boolean;\n\n  /**\n   * value accessor of this column\n   * @param row the current row\n   * @param desc the description of this column\n   */\n  accessor?(row: IDataRow, desc: Readonly<IValueColumnDesc<T>>): T;\n}\n\nexport interface IFlatColumn {\n  readonly col: Column;\n  readonly offset: number;\n  readonly width: number;\n}\n\nexport interface IColumnParent {\n  remove(col: Column): boolean;\n\n  insert(col: Column, index?: number): Column | null;\n\n  insertAfter(col: Column, reference: Column): Column | null;\n\n  move(col: Column, index?: number): Column | null;\n\n  moveAfter(col: Column, reference: Column): Column | null;\n\n  findMyRanker(): Ranking | null;\n\n  readonly fqid: string;\n\n  indexOf(col: Column): number;\n\n  at(index: number): Column;\n\n  readonly fqpath: string;\n}\n\nexport interface IColumnMetaData {\n  label: string;\n  summary: string;\n  description: string;\n}\n\nexport declare type ICompareValue = string | number | null;\n\n/**\n * a data row for rendering\n */\nexport interface IDataRow {\n  /**\n   * the value\n   */\n  readonly v: any;\n  /**\n   * the underlying data index\n   */\n  readonly i: number;\n}\n\nexport interface IGroup {\n  name: string;\n  color: string;\n  parent?: Readonly<IGroupParent> | null;\n}\n\nexport declare type IndicesArray = (ReadonlyArray<number> | UIntTypedArray) & ArrayLike<number>;\n\nexport interface IOrderedGroup extends IGroup {\n  order: IndicesArray;\n}\n\nexport const defaultGroup: IGroup = {\n  name: 'Default',\n  color: 'gray',\n};\n\nexport const othersGroup: IGroup = {\n  name: 'Others',\n  color: 'gray',\n};\n\nexport interface IGroupParent extends IGroup {\n  subGroups: (Readonly<IGroupParent> | Readonly<IGroup>)[];\n}\n\nexport interface IGroupItem {\n  readonly dataIndex: number;\n  readonly group: Readonly<IOrderedGroup>;\n  readonly relativeIndex: number;\n}\n\nexport declare type IGroupData = Readonly<IOrderedGroup>;\n\nexport function isGroup(item: IGroupData | IGroupItem): item is IGroupData {\n  return item && (item as IGroupItem).group == null; // use .group as separator\n}\n\nexport declare type UIntTypedArray = Uint8Array | Uint16Array | Uint32Array;\n\nexport enum ECompareValueType {\n  BINARY,\n  COUNT, // count max to the number of rows\n  UINT8,\n  UINT16,\n  UINT32,\n  INT8,\n  INT16,\n  INT32,\n  FLOAT,\n  FLOAT_ASC,\n  DOUBLE,\n  DOUBLE_ASC,\n  STRING,\n}\n\nexport interface ITypedDump {\n  readonly type: string;\n  [key: string]: any;\n}\n\nexport interface IColumnDump {\n  id: string;\n  width?: number;\n  desc: any;\n  label?: string;\n  summary?: string;\n  renderer?: string;\n  /**\n   * @deprecated\n   */\n  rendererType?: string;\n  groupRenderer?: string;\n  summaryRenderer?: string;\n\n  // type specific\n  [key: string]: any;\n}\n\nexport interface IRankingDump {\n  /**\n   * columsn of this ranking\n   */\n  columns?: IColumnDump[];\n\n  /**\n   * sort criteria\n   */\n  sortCriteria?: { asc: boolean; sortBy: string }[];\n\n  /**\n   * group sort criteria\n   */\n  groupSortCriteria?: { asc: boolean; sortBy: string }[];\n\n  /**\n   * uids of group columns\n   */\n  groupColumns?: string[];\n\n  /**\n   * compatibility\n   * @deprecated\n   */\n  sortColumn?: { sortBy: string; asc: boolean };\n}\n\nexport interface ITypeFactory {\n  (dump: IColumnDump): Column;\n\n  colorMappingFunction(dump?: ITypedDump | string | ((v: number) => string)): IColorMappingFunction;\n  mappingFunction(dump?: ITypedDump | IScriptMappingFunctionType): IMappingFunction;\n  categoricalColorMappingFunction(\n    dump: ITypedDump | undefined,\n    categories: ICategory[]\n  ): ICategoricalColorMappingFunction;\n}\n\nexport interface IMultiLevelColumn extends CompositeColumn {\n  getCollapsed(): boolean;\n\n  setCollapsed(value: boolean): void;\n\n  /**\n   * whether to show nested summaries or not\n   */\n  isShowNestedSummaries(): boolean;\n}\n\nexport function isMultiLevelColumn(col: Column): col is IMultiLevelColumn {\n  return typeof (col as IMultiLevelColumn).getCollapsed === 'function';\n}\n\nexport interface ISortCriteria {\n  readonly col: Column;\n  readonly asc: boolean;\n}\n","import { AEventDispatcher, ISequence, similar, fixCSS, IEventListener } from '../internal';\nimport { isSortingAscByDefault } from './annotations';\nimport {\n  IColumnDump,\n  ISortCriteria,\n  defaultGroup,\n  ECompareValueType,\n  IColumnDesc,\n  IDataRow,\n  IGroup,\n  IColumnParent,\n  IColumnMetaData,\n  IFlatColumn,\n  ICompareValue,\n  ITypeFactory,\n} from './interfaces';\nimport type Ranking from './Ranking';\n\n/**\n * default color that should be used\n * @type {string}\n */\nexport const DEFAULT_COLOR = '#C1C1C1';\n\n/**\n * emitted when the width property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function widthChanged(previous: number, current: number): void;\n\n/**\n * emitted when the label property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function labelChanged(previous: string, current: string): void;\n\n/**\n * emitted when the meta data property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function metaDataChanged(previous: IColumnMetaData, current: IColumnMetaData): void;\n\n/**\n * emitted when state of the column is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirty(): void;\n\n/**\n * emitted when state of the column related to its header is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirtyHeader(): void;\n\n/**\n * emitted when state of the column related to its values is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirtyValues(): void;\n\n/**\n * emitted when state of the column related to cached values (hist, compare, ...) is dirty\n * @asMemberOf Column\n * @event\n */\nexport declare function dirtyCaches(): void;\n\n/**\n * emitted when the renderer type property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function rendererTypeChanged(previous: string, current: string): void;\n\n/**\n * emitted when the group renderer property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function groupRendererChanged(previous: string, current: string): void;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf Column\n * @event\n */\nexport declare function summaryRendererChanged(previous: string, current: string): void;\n\n/**\n * emitted when the visibility of this column changes\n * @asMemberOf Column\n * @event\n */\nexport declare function visibilityChanged(previous: boolean, current: boolean): void;\n\n/**\n * a column in LineUp\n */\nexport default class Column extends AEventDispatcher {\n  /**\n   * magic variable for showing all columns\n   * @type {number}\n   */\n  static readonly FLAT_ALL_COLUMNS = -1;\n\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\n  static readonly EVENT_LABEL_CHANGED = 'labelChanged';\n  static readonly EVENT_METADATA_CHANGED = 'metaDataChanged';\n  static readonly EVENT_DIRTY = 'dirty';\n  static readonly EVENT_DIRTY_HEADER = 'dirtyHeader';\n  static readonly EVENT_DIRTY_VALUES = 'dirtyValues';\n  static readonly EVENT_DIRTY_CACHES = 'dirtyCaches';\n  static readonly EVENT_RENDERER_TYPE_CHANGED = 'rendererTypeChanged';\n  static readonly EVENT_GROUP_RENDERER_TYPE_CHANGED = 'groupRendererChanged';\n  static readonly EVENT_SUMMARY_RENDERER_TYPE_CHANGED = 'summaryRendererChanged';\n  static readonly EVENT_VISIBILITY_CHANGED = 'visibilityChanged';\n\n  /**\n   * the id of this column\n   */\n  private uid: string;\n\n  /**\n   * width of the column\n   * @type {number}\n   * @private\n   */\n  private width = 100;\n\n  /**\n   * parent column of this column, set when added to a ranking or combined column\n   */\n  parent: Readonly<IColumnParent> | null = null;\n\n  private metadata: Readonly<IColumnMetaData>;\n  private renderer: string;\n  private groupRenderer: string;\n  private summaryRenderer: string;\n  private visible: boolean;\n\n  constructor(id: string, public readonly desc: Readonly<IColumnDesc>) {\n    super();\n    this.uid = fixCSS(id);\n    this.renderer = this.desc.renderer || this.desc.type;\n    this.groupRenderer = this.desc.groupRenderer || this.desc.type;\n    this.summaryRenderer = this.desc.summaryRenderer || this.desc.type;\n    this.width = this.desc.width != null && this.desc.width > 0 ? this.desc.width : 100;\n    this.visible = this.desc.visible !== false;\n\n    this.metadata = {\n      label: desc.label || this.id,\n      summary: desc.summary || '',\n      description: desc.description || '',\n    };\n  }\n\n  get fixed() {\n    return Boolean(this.desc.fixed);\n  }\n\n  get frozen() {\n    return Boolean(this.desc.frozen);\n  }\n\n  get id() {\n    return this.uid;\n  }\n\n  assignNewId(idGenerator: () => string) {\n    this.uid = fixCSS(idGenerator());\n  }\n\n  get label() {\n    return this.metadata.label;\n  }\n\n  get description() {\n    return this.metadata.description;\n  }\n\n  /**\n   * returns the fully qualified id i.e. path the parent\n   * @returns {string}\n   */\n  get fqid() {\n    return this.parent ? `${this.parent.fqid}_${this.id}` : this.id;\n  }\n\n  get fqpath() {\n    return this.parent ? `${this.parent.fqpath}@${this.parent.indexOf(this)}` : '';\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        Column.EVENT_WIDTH_CHANGED,\n        Column.EVENT_LABEL_CHANGED,\n        Column.EVENT_METADATA_CHANGED,\n        Column.EVENT_VISIBILITY_CHANGED,\n        Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\n        Column.EVENT_DIRTY,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n      ]);\n  }\n\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getWidth() {\n    return this.width;\n  }\n\n  hide() {\n    this.setVisible(false);\n  }\n\n  show() {\n    this.setVisible(true);\n  }\n\n  isVisible() {\n    return this.visible;\n  }\n\n  getVisible() {\n    return this.isVisible();\n  }\n\n  setVisible(value: boolean) {\n    if (this.visible === value) {\n      return;\n    }\n    this.fire(\n      [Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.visible,\n      (this.visible = value)\n    );\n  }\n\n  /**\n   * visitor pattern for flattening the columns\n   * @param {IFlatColumn} r the result array\n   * @param {number} offset left offset\n   * @param {number} _levelsToGo how many levels down\n   * @param {number} _padding padding between columns\n   * @returns {number} the used width by this column\n   */\n  flatten(r: IFlatColumn[], offset: number, _levelsToGo = 0, _padding = 0): number {\n    const w = this.getWidth();\n    r.push({ col: this, offset, width: w });\n    return w;\n  }\n\n  setWidth(value: number) {\n    if (similar(this.width, value, 0.5)) {\n      return;\n    }\n    this.fire(\n      [Column.EVENT_WIDTH_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.width,\n      (this.width = value)\n    );\n  }\n\n  setWidthImpl(value: number) {\n    this.width = value;\n  }\n\n  setMetaData(value: Readonly<IColumnMetaData>) {\n    if (\n      value.label === this.label &&\n      this.description === value.description &&\n      this.metadata.summary === value.summary\n    ) {\n      return;\n    }\n    const bak = this.getMetaData();\n    //copy to avoid reference\n    this.metadata = {\n      label: value.label,\n      summary: value.summary,\n      description: value.description,\n    };\n\n    this.fire(\n      [Column.EVENT_LABEL_CHANGED, Column.EVENT_METADATA_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n      bak,\n      this.getMetaData()\n    );\n  }\n\n  getMetaData(): Readonly<IColumnMetaData> {\n    return Object.assign({}, this.metadata);\n  }\n\n  /**\n   * triggers that the ranking is sorted by this column\n   * @param ascending ascending order?\n   * @param priority sorting priority\n   * @returns {boolean} was successful\n   */\n  sortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.sortBy(this, ascending, priority);\n    }\n    return false;\n  }\n\n  groupByMe(): boolean {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.toggleGrouping(this);\n    }\n    return false;\n  }\n\n  /**\n   *\n   * @return {number}\n   */\n  isGroupedBy(): number {\n    const r = this.findMyRanker();\n    if (!r) {\n      return -1;\n    }\n    return r.getGroupCriteria().indexOf(this);\n  }\n\n  /**\n   * toggles the sorting order of this column in the ranking\n   * @returns {boolean} was successful\n   */\n  toggleMySorting() {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.toggleSorting(this);\n    }\n    return false;\n  }\n\n  private isSortedByMeImpl(selector: (r: Ranking) => ISortCriteria[]): {\n    asc: 'asc' | 'desc' | undefined;\n    priority: number | undefined;\n  } {\n    const ranker = this.findMyRanker();\n    if (!ranker) {\n      return { asc: undefined, priority: undefined };\n    }\n    const criterias = selector(ranker);\n    const index = criterias.findIndex((c) => c.col === this);\n    if (index < 0) {\n      return { asc: undefined, priority: undefined };\n    }\n    return {\n      asc: criterias[index].asc ? 'asc' : 'desc',\n      priority: index,\n    };\n  }\n\n  isSortedByMe() {\n    return this.isSortedByMeImpl((r) => r.getSortCriteria());\n  }\n\n  groupSortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.groupSortBy(this, ascending, priority);\n    }\n    return false;\n  }\n\n  toggleMyGroupSorting() {\n    const r = this.findMyRanker();\n    if (r) {\n      return r.toggleGroupSorting(this);\n    }\n    return false;\n  }\n\n  isGroupSortedByMe() {\n    return this.isSortedByMeImpl((r) => r.getGroupSortCriteria());\n  }\n\n  /**\n   * removes the column from the ranking\n   * @returns {boolean} was successful\n   */\n  removeMe() {\n    if (this.fixed) {\n      return false;\n    }\n    if (this.parent) {\n      return this.parent.remove(this);\n    }\n    return false;\n  }\n\n  /**\n   * called when the columns added to a ranking\n   */\n  attach(parent: IColumnParent) {\n    this.parent = parent;\n  }\n\n  /**\n   * called when the column is removed from the ranking\n   */\n  detach() {\n    this.parent = null;\n  }\n\n  /**\n   * inserts the given column after itself\n   * @param col the column to insert\n   * @returns {boolean} was successful\n   */\n  insertAfterMe(col: Column) {\n    if (this.parent) {\n      return this.parent.insertAfter(col, this) != null;\n    }\n    return false;\n  }\n\n  /**\n   * finds the underlying ranking column\n   * @returns {Ranking|null} my current ranking\n   */\n  findMyRanker(): Ranking | null {\n    if (this.parent) {\n      return this.parent.findMyRanker();\n    }\n    return null;\n  }\n\n  /**\n   * dumps this column to JSON compatible format\n   * @param toDescRef helper mapping function\n   * @returns {any} dump of this column\n   */\n  dump(toDescRef: (desc: any) => any): any {\n    const r: IColumnDump = {\n      id: this.id,\n      desc: toDescRef(this.desc),\n      width: this.width,\n    };\n    if (this.label !== (this.desc.label || this.id)) {\n      r.label = this.label;\n    }\n    if (this.metadata.summary) {\n      r.summary = this.metadata.summary;\n    }\n    if (this.getRenderer() !== this.desc.type) {\n      r.renderer = this.getRenderer();\n    }\n    if (this.getGroupRenderer() !== this.desc.type) {\n      r.groupRenderer = this.getGroupRenderer();\n    }\n    if (this.getSummaryRenderer() !== this.desc.type) {\n      r.summaryRenderer = this.getSummaryRenderer();\n    }\n    return r;\n  }\n\n  /**\n   * restore the column content from a dump\n   * @param dump column dump\n   * @param _factory helper for creating columns\n   */\n  restore(dump: IColumnDump, _factory: ITypeFactory) {\n    this.uid = dump.id;\n    this.width = dump.width || this.width;\n    this.metadata = {\n      label: dump.label || this.label,\n      summary: dump.summary || '',\n      description: this.description,\n    };\n    if (dump.renderer || dump.rendererType) {\n      this.renderer = dump.renderer || dump.rendererType || this.renderer;\n    }\n    if (dump.groupRenderer) {\n      this.groupRenderer = dump.groupRenderer;\n    }\n    if (dump.summaryRenderer) {\n      this.summaryRenderer = dump.summaryRenderer;\n    }\n  }\n\n  /**\n   * return the label of a given row for the current column\n   * @param row the current row\n   * @return {string} the label of this column at the specified row\n   */\n  getLabel(row: IDataRow): string {\n    const v = this.getValue(row);\n    return v == null ? '' : String(v);\n  }\n\n  /**\n   * return the value of a given row for the current column\n   * @param _row the current row\n   * @return the value of this column at the specified row\n   */\n  getValue(_row: IDataRow): any | null {\n    return ''; //no value\n  }\n\n  /**\n   * returns the value to be used when exporting\n   * @param format format hint\n   */\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'text' ? this.getLabel(row) : this.getValue(row);\n  }\n\n  getColor(_row: IDataRow) {\n    return DEFAULT_COLOR;\n  }\n\n  toCompareValue(_row: IDataRow, _valueCache?: any): ICompareValue | ICompareValue[] {\n    return 0;\n  }\n\n  toCompareValueType(): ECompareValueType | ECompareValueType[] {\n    return ECompareValueType.UINT8;\n  }\n\n  /**\n   * group the given row into a bin/group\n   * @param _row\n   * @return {IGroup}\n   */\n  group(_row: IDataRow, _valueCache?: any): IGroup {\n    return Object.assign({}, defaultGroup);\n  }\n\n  toCompareGroupValue(\n    _rows: ISequence<IDataRow>,\n    group: IGroup,\n    _valueCache?: ISequence<any>\n  ): ICompareValue | ICompareValue[] {\n    return group.name.toLowerCase();\n  }\n\n  toCompareGroupValueType(): ECompareValueType | ECompareValueType[] {\n    return ECompareValueType.STRING;\n  }\n\n  /**\n   * flag whether any filter is applied\n   * @return {boolean}\n   */\n  isFiltered() {\n    return false;\n  }\n\n  /**\n   * clear the filter\n   * @return {boolean} whether the filtered needed to be reset\n   */\n  clearFilter() {\n    // hook to clear the filter\n    return false;\n  }\n\n  /**\n   * predicate whether the current row should be included\n   * @param row\n   * @return {boolean}\n   */\n  filter(row: IDataRow, _valueCache?: any) {\n    return row != null;\n  }\n\n  /**\n   * determines the renderer type that should be used to render this column. By default the same type as the column itself\n   * @return {string}\n   */\n  getRenderer(): string {\n    return this.renderer;\n  }\n\n  getGroupRenderer(): string {\n    return this.groupRenderer;\n  }\n\n  getSummaryRenderer(): string {\n    return this.summaryRenderer;\n  }\n\n  setRenderer(renderer: string) {\n    if (renderer === this.renderer) {\n      // nothing changes\n      return;\n    }\n    this.fire(\n      [Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.renderer,\n      (this.renderer = renderer)\n    );\n  }\n\n  setGroupRenderer(renderer: string) {\n    if (renderer === this.groupRenderer) {\n      // nothing changes\n      return;\n    }\n    this.fire(\n      [Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.groupRenderer,\n      (this.groupRenderer = renderer)\n    );\n  }\n\n  setSummaryRenderer(renderer: string) {\n    if (renderer === this.summaryRenderer) {\n      // nothing changes\n      return;\n    }\n    this.fire(\n      [Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n      this.summaryRenderer,\n      (this.summaryRenderer = renderer)\n    );\n  }\n\n  /**\n   * marks the header, values, or both as dirty such that the values are reevaluated\n   * @param type specify in more detail what is dirty, by default whole column\n   */\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\n    switch (type) {\n      case 'header':\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\n      case 'values':\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY]);\n      default:\n        return this.fire([\n          Column.EVENT_DIRTY_HEADER,\n          Column.EVENT_DIRTY_VALUES,\n          Column.EVENT_DIRTY_CACHES,\n          Column.EVENT_DIRTY,\n        ]);\n    }\n  }\n}\n","import type { IAdvancedBoxPlotData, IBoxPlotData, IForEachAble } from '../internal';\nimport Column from './Column';\nimport type { IArrayColumn } from './IArrayColumn';\nimport type { IColumnDesc, IDataRow, ITypedDump, ITypeFactory } from './interfaces';\n\nexport interface IColorMappingFunction {\n  apply(v: number): string;\n\n  toJSON(): ITypedDump | string;\n\n  clone(): IColorMappingFunction;\n\n  eq(other: IColorMappingFunction): boolean;\n}\n\nexport interface IColorMappingFunctionConstructor {\n  new (dump: ITypedDump | string, factory: ITypeFactory): IColorMappingFunction;\n}\n\nexport interface IMappingFunction {\n  //new(domain: number[]);\n\n  apply(v: number): number;\n\n  toJSON(): ITypedDump;\n\n  domain: number[];\n\n  clone(): IMappingFunction;\n\n  eq(other: IMappingFunction): boolean;\n\n  getRange(formatter: (v: number) => string): [string, string];\n}\n\nexport interface IMappingFunctionConstructor {\n  new (dump: ITypedDump): IMappingFunction;\n}\n\nexport interface IMapAbleDesc {\n  /**\n   * dump of mapping function\n   */\n  map?: ITypedDump;\n  /**\n   * either map or domain should be available\n   */\n  domain?: [number, number];\n  /**\n   * @default [0,1]\n   */\n  range?: [number, number];\n\n  /**\n   * @deprecated use colorMapping instead\n   */\n  color?: string;\n\n  /**\n   * color mapping\n   */\n  colorMapping?: string | ((v: number) => string) | ITypedDump;\n}\n\nexport interface IMapAbleColumn extends INumberColumn {\n  getOriginalMapping(): IMappingFunction;\n\n  getMapping(): IMappingFunction;\n\n  setMapping(mapping: IMappingFunction): void;\n\n  getColorMapping(): IColorMappingFunction;\n\n  setColorMapping(mapping: IColorMappingFunction): void;\n\n  getFilter(): INumberFilter;\n\n  setFilter(value: INumberFilter | null): void;\n\n  getRange(): [string, string];\n}\n\nexport function isMapAbleColumn(col: Column): col is IMapAbleColumn;\nexport function isMapAbleColumn(col: IColumnDesc): col is IMapAbleDesc & IColumnDesc;\nexport function isMapAbleColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as IMapAbleColumn).getMapping === 'function') ||\n    (!(col instanceof Column) &&\n      isNumberColumn(col) &&\n      ((col as IColumnDesc).type.startsWith('number') || (col as IColumnDesc).type.startsWith('boxplot')))\n  );\n}\n\nexport interface INumberColumn extends Column {\n  getNumber(row: IDataRow): number;\n\n  getRawNumber(row: IDataRow): number;\n\n  iterNumber(row: IDataRow): IForEachAble<number>;\n  iterRawNumber(row: IDataRow): IForEachAble<number>;\n\n  getNumberFormat(): (v: number) => string;\n}\n\nexport interface INumberDesc extends IMapAbleDesc {\n  /**\n   * d3 formatting option\n   * @default .3n\n   */\n  numberFormat?: string;\n\n  /**\n   * The accuracy defines the deviation of values to the applied filter boundary.\n   * Use an accuracy closer to 0 for columns with smaller numbers (e.g., 1e-9).\n   * @default 0.001\n   */\n  filterAccuracy?: number;\n}\n\n/**\n * checks whether the given column or description is a number column, i.e. the value is a number\n * @param col\n * @returns {boolean}\n */\nexport function isNumberColumn(col: Column): col is INumberColumn;\nexport function isNumberColumn(col: IColumnDesc): col is INumberDesc & IColumnDesc;\nexport function isNumberColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as INumberColumn).getNumber === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.match(/(number|stack|ordinal)/) != null)\n  );\n}\n\nexport enum ESortMethod {\n  min = 'min',\n  max = 'max',\n  median = 'median',\n  q1 = 'q1',\n  q3 = 'q3',\n}\n\nexport interface IBoxPlotColumn extends INumberColumn, IMapAbleColumn {\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null;\n\n  getMapping(): IMappingFunction;\n\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null;\n\n  getSortMethod(): string;\n\n  setSortMethod(sortMethod: string): void;\n}\n\nexport function isBoxPlotColumn(col: Column): col is IBoxPlotColumn {\n  return typeof (col as IBoxPlotColumn).getBoxPlotData === 'function';\n}\n\nexport enum EAdvancedSortMethod {\n  min = 'min',\n  max = 'max',\n  median = 'median',\n  q1 = 'q1',\n  q3 = 'q3',\n  mean = 'mean',\n}\n\nexport interface IAdvancedBoxPlotColumn extends IBoxPlotColumn {\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\n}\n\nexport interface INumbersColumn extends IAdvancedBoxPlotColumn, IArrayColumn<number> {\n  getNumbers(row: IDataRow): number[];\n\n  getRawNumbers(row: IDataRow): number[];\n}\n\nexport function isNumbersColumn(col: Column): col is INumbersColumn {\n  return isBoxPlotColumn(col) && typeof (col as INumbersColumn).getNumbers === 'function';\n}\n\nexport interface INumberFilter {\n  min: number;\n  max: number;\n  filterMissing: boolean;\n}\n","import Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  dirtyCaches,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n} from './Column';\nimport type { IValueColumnDesc, IDataRow, ITypeFactory } from './interfaces';\nimport type { IEventListener } from '../internal';\n\n/**\n * emitted when the data of this column has been loaded\n * @asMemberOf ValueColumn\n * @event\n */\nexport declare function dataLoaded(previous: boolean, current: boolean): void;\n\n/**\n * a column having an accessor to get the cell value\n */\nexport default class ValueColumn<T> extends Column {\n  static readonly EVENT_DATA_LOADED = 'dataLoaded';\n\n  static readonly RENDERER_LOADING = 'loading';\n\n  private readonly accessor: (row: IDataRow, desc: Readonly<IValueColumnDesc<T>>) => T;\n\n  /**\n   * is the data available\n   * @type {boolean}\n   */\n  private loaded: boolean;\n\n  constructor(id: string, desc: Readonly<IValueColumnDesc<T>>) {\n    super(id, desc);\n    //find accessor\n    this.accessor = desc.accessor! || (() => null);\n    this.loaded = desc.lazyLoaded !== true;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([ValueColumn.EVENT_DATA_LOADED]);\n  }\n\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getLabel(row: IDataRow) {\n    if (!this.isLoaded()) {\n      return '';\n    }\n    const v = this.getValue(row);\n    return v == null ? '' : String(v);\n  }\n\n  getRaw(row: IDataRow): T | null {\n    if (!this.isLoaded()) {\n      return null;\n    }\n    return this.accessor(row, this.desc);\n  }\n\n  getValue(row: IDataRow): T | null {\n    return this.getRaw(row);\n  }\n\n  isLoaded() {\n    return this.loaded;\n  }\n\n  setLoaded(loaded: boolean) {\n    if (this.loaded === loaded) {\n      return;\n    }\n    this.fire(\n      [\n        ValueColumn.EVENT_DATA_LOADED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.loaded,\n      (this.loaded = loaded)\n    );\n  }\n\n  getRenderer(): string {\n    if (!this.isLoaded()) {\n      return ValueColumn.RENDERER_LOADING;\n    }\n    return super.getRenderer();\n  }\n\n  /**\n   * patch the dump such that the loaded attribute is defined (for lazy loading columns)\n   * @param toDescRef\n   * @returns {any}\n   */\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.loaded = this.loaded;\n\n    if (!this.loaded && r.renderer === ValueColumn.RENDERER_LOADING) {\n      delete r.renderer;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    if (dump.loaded !== undefined) {\n      this.loaded = dump.loaded;\n    }\n    super.restore(dump, factory);\n  }\n}\n","import { suffix, IEventListener } from '../internal';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport { Category, toolbar } from './annotations';\nimport type { IDataRow, IColumnParent, IFlatColumn, ITypeFactory } from './interfaces';\nimport { isNumberColumn } from './INumberColumn';\nimport ValueColumn from './ValueColumn';\n\n/**\n * emitted when the filter property changes\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function filterChanged(previous: any | null, current: any | null): void;\n\n/**\n * emitted when a column has been added\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function addColumn(col: Column, index: number): void;\n\n/**\n * emitted when a column has been moved within this composite columm\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\n\n/**\n * emitted when a column has been removed\n * @asMemberOf CompositeColumn\n * @event\n */\nexport declare function removeColumn(col: Column, index: number): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('compositeContained', 'splitCombined')\n@Category('composite')\nexport default class CompositeColumn extends Column implements IColumnParent {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_ADD_COLUMN = 'addColumn';\n  static readonly EVENT_MOVE_COLUMN = 'moveColumn';\n  static readonly EVENT_REMOVE_COLUMN = 'removeColumn';\n\n  protected readonly _children: Column[] = [];\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        CompositeColumn.EVENT_FILTER_CHANGED,\n        CompositeColumn.EVENT_ADD_COLUMN,\n        CompositeColumn.EVENT_MOVE_COLUMN,\n        CompositeColumn.EVENT_REMOVE_COLUMN,\n      ]);\n  }\n\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  assignNewId(idGenerator: () => string) {\n    super.assignNewId(idGenerator);\n    this._children.forEach((c) => c.assignNewId(idGenerator));\n  }\n\n  get children() {\n    return this._children.slice();\n  }\n\n  get length() {\n    return this._children.length;\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    let w = 0;\n    //no more levels or just this one\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n      w = this.getWidth();\n      r.push({ col: this, offset, width: w });\n      if (levelsToGo === 0) {\n        return w;\n      }\n    }\n    //push children\n    this._children.forEach((c) => {\n      if (c.isVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n        c.flatten(r, offset, levelsToGo - 1, padding);\n      }\n    });\n    return w;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.children = this._children.map((d) => d.dump(toDescRef));\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    dump.children.forEach((child: any) => {\n      const c = factory(child);\n      if (c) {\n        this.push(c);\n      }\n    });\n    super.restore(dump, factory);\n  }\n\n  /**\n   * inserts a column at a the given position\n   * @param col\n   * @param index\n   * @returns {any}\n   */\n  insert(col: Column, index: number): Column | null {\n    if (!isNumberColumn(col) && this.canJustAddNumbers) {\n      //indicator it is a number type\n      return null;\n    }\n    this._children.splice(index, 0, col);\n    //listen and propagate events\n    return this.insertImpl(col, index);\n  }\n\n  move(col: Column, index: number): Column | null {\n    if (col.parent !== this) {\n      //not moving\n      return null;\n    }\n    const old = this._children.indexOf(col);\n    if (index === old) {\n      // no move needed\n      return col;\n    }\n    //delete first\n    this._children.splice(old, 1);\n    // adapt target index based on previous index, i.e shift by one\n    this._children.splice(old < index ? index - 1 : index, 0, col);\n    //listen and propagate events\n    return this.moveImpl(col, index, old);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    col.attach(this);\n    this.forward(\n      col,\n      ...suffix(\n        '.combine',\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n        CompositeColumn.EVENT_FILTER_CHANGED,\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED\n      )\n    );\n    this.fire(\n      [\n        CompositeColumn.EVENT_ADD_COLUMN,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      col,\n      index\n    );\n    return col;\n  }\n\n  protected moveImpl(col: Column, index: number, oldIndex: number) {\n    this.fire(\n      [\n        CompositeColumn.EVENT_MOVE_COLUMN,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\n      ],\n      col,\n      index,\n      oldIndex\n    );\n    return col;\n  }\n\n  push(col: Column) {\n    return this.insert(col, this._children.length);\n  }\n\n  at(index: number) {\n    return this._children[index];\n  }\n\n  indexOf(col: Column) {\n    return this._children.indexOf(col);\n  }\n\n  insertAfter(col: Column, ref: Column) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i + 1);\n  }\n\n  moveAfter(col: Column, ref: Column) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.move(col, i + 1);\n  }\n\n  remove(col: Column) {\n    const i = this._children.indexOf(col);\n    if (i < 0) {\n      return false;\n    }\n    this._children.splice(i, 1); //remove and deregister listeners\n    return this.removeImpl(col, i);\n  }\n\n  protected removeImpl(col: Column, index: number) {\n    col.detach();\n    this.unforward(\n      col,\n      ...suffix(\n        '.combine',\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n        CompositeColumn.EVENT_FILTER_CHANGED\n      )\n    );\n    this.fire(\n      [\n        CompositeColumn.EVENT_REMOVE_COLUMN,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      col,\n      index\n    );\n    return true;\n  }\n\n  isFiltered() {\n    return this._children.some((d) => d.isFiltered());\n  }\n\n  clearFilter() {\n    return this._children.map((d) => d.clearFilter()).some((d) => d);\n  }\n\n  filter(row: IDataRow) {\n    return this._children.every((d) => d.filter(row));\n  }\n\n  isLoaded(): boolean {\n    return this._children.every(\n      (c) =>\n        !(c instanceof ValueColumn || c instanceof CompositeColumn) ||\n        (c as ValueColumn<any> | CompositeColumn).isLoaded()\n    );\n  }\n\n  get canJustAddNumbers() {\n    return false;\n  }\n}\n","export default function(specifier) {\n  var n = specifier.length / 6 | 0, colors = new Array(n), i = 0;\n  while (i < n) colors[i] = \"#\" + specifier.slice(i * 6, ++i * 6);\n  return colors;\n}\n","import colors from \"../colors.js\";\n\nexport default colors(\"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f\");\n","/**\n * a set that preserves the insertion order\n * @internal\n */\nexport default class OrderedSet<T> implements Iterable<T> {\n  readonly [Symbol.toStringTag] = Symbol('OrderedSet');\n  private readonly set = new Set<T>();\n  private readonly list: T[] = [];\n\n  constructor(values: Iterable<T> = []) {\n    this.addAll(Array.isArray(values) ? values : Array.from(values));\n  }\n\n  get size() {\n    return this.set.size;\n  }\n\n  clear() {\n    this.set.clear();\n    this.list.splice(0, this.list.length);\n  }\n\n  addAll(values: T[]) {\n    values.forEach((v) => this.add(v));\n    return this;\n  }\n\n  add(value: T) {\n    if (this.set.has(value)) {\n      return this;\n    }\n    this.set.add(value);\n    this.list.push(value);\n    return this;\n  }\n\n  has(value: T) {\n    return this.set.has(value);\n  }\n\n  delete(value: T) {\n    const r = this.set.delete(value);\n    if (!r) {\n      return false;\n    }\n    const index = this.list.indexOf(value);\n    console.assert(index >= 0);\n    this.list.splice(index, 1);\n    return true;\n  }\n\n  deleteAll(values: T[]) {\n    return values.reduce((acc, act) => this.delete(act) && acc, true);\n  }\n\n  forEach(callbackfn: (value: T, value2: T, set: Set<T>) => void, thisArg?: any) {\n    this.list.forEach(function (this: any, v: T) {\n      callbackfn.call(this, v, v, this);\n    }, thisArg);\n  }\n\n  [Symbol.iterator]() {\n    return this.list[Symbol.iterator]();\n  }\n}\n","import { schemeCategory10, schemeSet3 } from 'd3-scale-chromatic';\nimport { OrderedSet } from '../internal';\nimport Column, { DEFAULT_COLOR } from './Column';\nimport { defaultGroup, ECompareValueType, IGroup, IGroupParent, IndicesArray, IOrderedGroup } from './interfaces';\n\n/** @internal */\nexport function integrateDefaults<T>(desc: T, defaults: Partial<T> = {}) {\n  Object.keys(defaults).forEach((key) => {\n    const typed = key as keyof T;\n    if (typeof desc[typed] === 'undefined') {\n      (desc as any)[typed] = defaults[typed];\n    }\n  });\n  return desc;\n}\n\n/** @internal */\nexport function patternFunction(pattern: string, ...args: string[]): (value: string) => string {\n  // eslint-disable-next-line no-new-func\n  return new Function(\n    'value',\n    ...args,\n    `\n  const escapedValue = encodeURIComponent(String(value));\n  return \\`${pattern}\\`;\n `\n  ) as any;\n}\n\n/** @internal */\nexport function joinGroups(groups: IGroup[]): IGroup {\n  if (groups.length === 0) {\n    return { ...defaultGroup }; //copy\n  }\n  if (groups.length === 1 && !groups[0].parent) {\n    return { ...groups[0] }; //copy\n  }\n  // create a chain\n  const parents: IGroupParent[] = [];\n  for (const group of groups) {\n    const gparents: IGroupParent[] = [];\n    let g = group;\n    while (g.parent) {\n      // add all parents of this groups\n      gparents.unshift(g.parent);\n      g = g.parent;\n    }\n    parents.push(...gparents);\n    parents.push(Object.assign({ subGroups: [] }, group));\n  }\n  parents.slice(1).forEach((g, i) => {\n    g.parent = parents[i];\n    g.name = `${parents[i].name} ∩ ${g.name}`;\n    g.color = g.color !== DEFAULT_COLOR ? g.color : g.parent.color;\n    parents[i].subGroups = [g];\n  });\n\n  return parents[parents.length - 1];\n}\n\nexport function duplicateGroup<T extends IOrderedGroup | IGroupParent>(group: T) {\n  const clone = Object.assign({}, group) as T;\n  delete (clone as IOrderedGroup).order;\n  if (isGroupParent(clone)) {\n    clone.subGroups = [];\n  }\n  if (clone.parent) {\n    clone.parent = duplicateGroup(clone.parent);\n    clone.parent!.subGroups.push(clone);\n  }\n  return clone;\n}\n\n/** @internal */\nexport function toGroupID(group: IGroup) {\n  return group.name;\n}\n\n/** @internal */\nexport function isOrderedGroup(g: IOrderedGroup | Readonly<IGroupParent>): g is IOrderedGroup {\n  return (g as IOrderedGroup).order != null;\n}\n\n/** @internal */\nfunction isGroupParent(g: IGroup | Readonly<IGroupParent>): g is IGroupParent {\n  return (g as IGroupParent).subGroups != null;\n}\n\n/**\n * unify the parents of the given groups by reusing the same group parent if possible\n * @param groups\n */\nexport function unifyParents<T extends IOrderedGroup>(groups: T[]) {\n  if (groups.length <= 1) {\n    return groups;\n  }\n\n  const toPath = (group: T) => {\n    const path: (IGroupParent | T)[] = [group];\n    let p = group.parent;\n    while (p) {\n      path.unshift(p);\n      p = p.parent;\n    }\n    return path;\n  };\n  const paths = groups.map(toPath);\n\n  const isSame = (a: IGroupParent, b: IGroupParent | T) => {\n    return b.name === a.name && b.parent === a.parent && isGroupParent(b) && b.subGroups.length > 0;\n  };\n\n  const removeDuplicates = (level: (IGroupParent | T)[], i: number) => {\n    const real: (IGroupParent | T)[] = [];\n    while (level.length > 0) {\n      const node = level.shift()!;\n      if (!isGroupParent(node) || node.subGroups.length === 0) {\n        // cannot share leaves\n        real.push(node);\n        continue;\n      }\n      const root = { ...node };\n      real.push(root);\n      // remove duplicates that directly follow\n      while (level.length > 0 && isSame(root, level[0]!)) {\n        root.subGroups.push(...(level.shift()! as IGroupParent).subGroups);\n      }\n      for (const child of root.subGroups) {\n        (child as IGroupParent | T).parent = root;\n      }\n      // cleanup children duplicates\n      root.subGroups = removeDuplicates(root.subGroups as (IGroupParent | T)[], i + 1);\n    }\n    return real;\n  };\n\n  removeDuplicates(\n    paths.map((p) => p[0]),\n    0\n  );\n\n  return groups;\n}\n\n/** @internal */\nexport function groupRoots(groups: IOrderedGroup[]) {\n  const roots = new OrderedSet<IOrderedGroup | Readonly<IGroupParent>>();\n  for (const group of groups) {\n    let root: IOrderedGroup | Readonly<IGroupParent> = group;\n    while (root.parent) {\n      root = root.parent;\n    }\n    roots.add(root);\n  }\n  return Array.from(roots);\n}\n\n/**\n * Traverse the tree of given groups in depth first search (DFS)\n *\n * @param groups Groups to traverse\n * @param f Function to check each group. Traversing subgroups can be stopped when returning `false`.\n *\n * @internal\n */\nexport function traverseGroupsDFS(groups: IOrderedGroup[], f: (v: IGroup | IGroupParent) => boolean | void) {\n  const traverse = (v: IGroup | IGroupParent) => {\n    if (f(v) === false) {\n      return;\n    }\n    if (isGroupParent(v)) {\n      v.subGroups.forEach(traverse);\n    }\n  };\n  const roots = groupRoots(groups);\n  roots.forEach(traverse);\n}\n\n// based on https://github.com/d3/d3-scale-chromatic#d3-scale-chromatic\nconst colors = schemeCategory10.concat(schemeSet3);\n\n/** @internal */\nexport const MAX_COLORS = colors.length;\n\n/** @internal */\nexport function colorPool() {\n  let act = 0;\n  return () => colors[act++ % colors.length];\n}\n\n/**\n * @internal\n */\nexport function mapIndices<T>(arr: IndicesArray, callback: (value: number, i: number) => T): T[] {\n  const r: T[] = [];\n  for (let i = 0; i < arr.length; ++i) {\n    r.push(callback(arr[i], i));\n  }\n  return r;\n}\n\n/**\n * @internal\n */\nexport function everyIndices(arr: IndicesArray, callback: (value: number, i: number) => boolean): boolean {\n  for (let i = 0; i < arr.length; ++i) {\n    if (!callback(arr[i], i)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * @internal\n */\nexport function filterIndices(arr: IndicesArray, callback: (value: number, i: number) => boolean): number[] {\n  const r: number[] = [];\n  for (let i = 0; i < arr.length; ++i) {\n    if (callback(arr[i], i)) {\n      r.push(arr[i]);\n    }\n  }\n  return r;\n}\n\n/**\n * @internal\n */\nexport function forEachIndices(arr: IndicesArray, callback: (value: number, i: number) => void) {\n  for (let i = 0; i < arr.length; ++i) {\n    callback(arr[i], i);\n  }\n}\n\n/**\n * @internal\n */\nexport function chooseUIntByDataLength(dataLength?: number | null) {\n  if (dataLength == null || (typeof dataLength !== 'number' && !Number.isNaN(dataLength))) {\n    return ECompareValueType.UINT32; // worst case\n  }\n  if (dataLength <= 255) {\n    return ECompareValueType.UINT8;\n  }\n  if (dataLength <= 65535) {\n    return ECompareValueType.UINT16;\n  }\n  return ECompareValueType.UINT32;\n}\n\nexport function getAllToolbarActions(col: Column) {\n  const actions = new OrderedSet<string>();\n\n  // walk up the prototype chain\n  let obj = col as any;\n  const toolbarIcon = Symbol.for('toolbarIcon');\n  do {\n    const m = Reflect.getOwnMetadata(toolbarIcon, obj.constructor) as string[];\n    if (m) {\n      for (const mi of m) {\n        actions.add(mi);\n      }\n    }\n    obj = Object.getPrototypeOf(obj);\n  } while (obj);\n  return Array.from(actions);\n}\n\nexport function getAllToolbarDialogAddons(col: Column, key: string) {\n  const actions = new OrderedSet<string>();\n\n  // walk up the prototype chain\n  let obj = col as any;\n  const symbol = Symbol.for(`toolbarDialogAddon${key}`);\n  do {\n    const m = Reflect.getOwnMetadata(symbol, obj.constructor) as string[];\n    if (m) {\n      for (const mi of m) {\n        actions.add(mi);\n      }\n    }\n    obj = Object.getPrototypeOf(obj);\n  } while (obj);\n  return Array.from(actions);\n}\n","const styles = new Map<string, string>();\n// {\n//   const r = /^[$]([\\w]+): ([\\w #.()'\\/,-]+)( !default)?;/gmi;\n//   const s = String(vars);\n\n//   let m: RegExpMatchArray | null = r.exec(s);\n//   while (m != null) {\n//     styles.set(m[1], m[2]);\n//     m = r.exec(s);\n//   }\n// }\n\n/** @internal */\nexport default function getStyle(key: string, defaultValue = '') {\n  if (key[0] === '$') {\n    key = key.slice(1);\n  }\n  if (styles.has(key)) {\n    return styles.get(key)!;\n  }\n  return defaultValue;\n}\n\n/** @internal */\nexport const COLUMN_PADDING = Number.parseInt(getStyle('lu_engine_grip_gap', '5px'), 10);\n/** @internal */\nexport const FILTERED_OPACITY = Number.parseFloat(getStyle('lu_filtered_opacity', '0.2'));\n/** @internal */\nexport const DASH = {\n  width: Number.parseInt(getStyle('lu_missing_dash_width', '3px'), 10),\n  height: Number.parseInt(getStyle('lu_missing_dash_height', '10px'), 10),\n  color: getStyle('lu_missing_dash_color', 'gray'),\n};\n/** @internal */\nexport const UPSET = {\n  color: getStyle('lu_renderer_upset_color'),\n  inactive: Number.parseFloat(getStyle('lu_renderer_upset_inactive_opacity', '0.1')),\n};\n/** @internal */\nexport const DOT = {\n  color: getStyle('lu_renderer_dot_color', 'gray'),\n  size: Number.parseInt(getStyle('lu_renderer_dot_size', '5px'), 10),\n  opacity: Number.parseFloat(getStyle('lu_renderer_dot_opacity', '0.5')),\n};\n/** @internal */\nexport const BOX_PLOT = {\n  box: getStyle('lu_renderer_boxplot_box', '#e0e0e0'),\n  stroke: getStyle('lu_renderer_boxplot_stroke', 'black'),\n  sort: getStyle('lu_renderer_boxplot_sort_indicator', '#ffa500'),\n  outlier: getStyle('lu_renderer_boxplot_outlier', '#e0e0e0'),\n};\n/** @internal */\nexport const AGGREGATE = {\n  width: Number.parseInt(getStyle('lu_aggregate_square_bracket_width', '4px'), 10),\n  strokeWidth: Number.parseInt(getStyle('lu_aggregate_square_bracket_stroke_width', '2px'), 10),\n  color: getStyle('lu_aggregate_square_bracket_stroke_color', '#000'),\n  levelOffset: Number.parseInt(getStyle('lu_aggregate_level_offset', '2px'), 10),\n  levelWidth: Number.parseInt(getStyle('lu_aggregate_level_width', '22px'), 10),\n};\n/** @internal */\nexport const SLOPEGRAPH_WIDTH = Number.parseInt(getStyle('lu_slope_width', '200px'), 10);\n/** @internal */\nexport const CANVAS_HEIGHT = 4;\n\n/** @internal */\nexport const CSS_PREFIX = getStyle('lu_css_prefix', 'lu');\n/** @internal */\nexport const ENGINE_CSS_PREFIX = 'le';\n\n/** @internal */\nexport const RESIZE_SPACE = Number.parseInt(getStyle('lu_engine_resize_space', '50px'), 10);\n/** @internal */\nexport const RESIZE_ANIMATION_DURATION = Number.parseInt(getStyle('lu_engine_resize_animation_duration', '1000ms'), 10);\n\n/** @internal */\nexport const AGGREGATION_LEVEL_WIDTH = Number.parseInt(getStyle('lu_aggregate_level_width', '22px'), 10);\n\n/** @internal */\nexport function cssClass(suffix?: string) {\n  return suffix ? `${CSS_PREFIX}-${suffix}` : CSS_PREFIX;\n}\n/** @internal */\nexport function engineCssClass(suffix?: string) {\n  return suffix ? `${ENGINE_CSS_PREFIX}-${suffix}` : ENGINE_CSS_PREFIX;\n}\n\n/** @internal */\nexport function aria(text: string) {\n  return `<span class=\"${cssClass('aria')}\" aria-hidden=\"true\">${text}</span>`;\n}\n","import { Category, SupportType, toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IGroup, IColumnDesc } from './interfaces';\nimport type Ranking from './Ranking';\nimport type { IEventListener } from '../internal';\nimport { integrateDefaults } from './internal';\nimport { AGGREGATION_LEVEL_WIDTH } from '../styles';\n\nexport enum EAggregationState {\n  COLLAPSE = 'collapse',\n  EXPAND = 'expand',\n  EXPAND_TOP_N = 'expand_top',\n}\n\n/**\n * factory for creating a description creating a rank column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createAggregateDesc(label = 'Aggregate Groups') {\n  return { type: 'aggregate', label, fixed: true };\n}\n\nexport interface IAggregateGroupColumnDesc extends IColumnDesc {\n  isAggregated(ranking: Ranking, group: IGroup): EAggregationState;\n\n  setAggregated(ranking: Ranking, group: IGroup, value: EAggregationState): void;\n}\n\n/**\n * emitted upon changing of the aggregate attribute\n * @param value -1 = no, 0 = fully aggregated, N = show top N\n * @asMemberOf AggregateGroupColumn\n * @event\n */\nexport declare function aggregate(ranking: Ranking, group: IGroup, value: boolean, state: EAggregationState): void;\n\n/**\n * a checkbox column for selections\n */\n@toolbar('setShowTopN', 'rename')\n@SupportType()\n@Category('support')\nexport default class AggregateGroupColumn extends Column {\n  static readonly EVENT_AGGREGATE = 'aggregate';\n\n  constructor(id: string, desc: Readonly<IAggregateGroupColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: AGGREGATION_LEVEL_WIDTH * 2,\n      })\n    );\n  }\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([AggregateGroupColumn.EVENT_AGGREGATE]);\n  }\n\n  on(type: typeof AggregateGroupColumn.EVENT_AGGREGATE, listener: typeof aggregate | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  isAggregated(group: IGroup) {\n    const ranking = this.findMyRanker()!;\n    if ((this.desc as IAggregateGroupColumnDesc).isAggregated) {\n      return (this.desc as IAggregateGroupColumnDesc).isAggregated(ranking, group);\n    }\n    return false;\n  }\n\n  setAggregated(group: IGroup, value: boolean | EAggregationState) {\n    const n: EAggregationState =\n      typeof value === 'boolean' ? (value ? EAggregationState.EXPAND : EAggregationState.COLLAPSE) : value;\n    const ranking = this.findMyRanker()!;\n    const current =\n      (this.desc as IAggregateGroupColumnDesc).isAggregated &&\n      (this.desc as IAggregateGroupColumnDesc).isAggregated(ranking, group);\n    if (current === n) {\n      return true;\n    }\n\n    if ((this.desc as IAggregateGroupColumnDesc).setAggregated) {\n      (this.desc as IAggregateGroupColumnDesc).setAggregated(ranking, group, n);\n    }\n    this.fire(AggregateGroupColumn.EVENT_AGGREGATE, ranking, group, n !== EAggregationState.COLLAPSE, n);\n    return false;\n  }\n}\n","import type { ICategory, ICategoricalColorMappingFunction } from './ICategoricalColumn';\nimport type { ITypedDump } from './interfaces';\nimport { DEFAULT_COLOR } from './Column';\n\nexport const DEFAULT_CATEGORICAL_COLOR_FUNCTION: ICategoricalColorMappingFunction = {\n  apply: (v) => (v ? v.color : DEFAULT_COLOR),\n  toJSON: () => null,\n  clone: () => DEFAULT_CATEGORICAL_COLOR_FUNCTION,\n  eq: (other) => other === DEFAULT_CATEGORICAL_COLOR_FUNCTION,\n};\n\nexport class ReplacementColorMappingFunction implements ICategoricalColorMappingFunction {\n  public readonly map: ReadonlyMap<string, string>;\n  constructor(map: Map<ICategory | string, string>) {\n    this.map = new Map(\n      Array.from(map.entries()).map(([k, v]) => [typeof k === 'string' ? k : k.name, v] as [string, string])\n    );\n  }\n\n  apply(v: ICategory) {\n    return this.map.has(v.name) ? this.map.get(v.name)! : DEFAULT_CATEGORICAL_COLOR_FUNCTION.apply(v);\n  }\n\n  toJSON() {\n    const r: any = {};\n    this.map.forEach((v, k) => (r[k] = v));\n    return {\n      type: 'replace',\n      map: r,\n    };\n  }\n\n  clone() {\n    return new ReplacementColorMappingFunction(new Map(this.map.entries()));\n  }\n\n  eq(other: ICategoricalColorMappingFunction): boolean {\n    if (!(other instanceof ReplacementColorMappingFunction)) {\n      return false;\n    }\n    if (other.map.size !== this.map.size) {\n      return false;\n    }\n    return Array.from(this.map.keys()).every((k) => this.map.get(k) === other.map.get(k));\n  }\n\n  static restore(dump: any, categories: ICategory[]) {\n    if (dump.type === 'replace') {\n      // new dump format\n      dump = dump.map;\n    }\n    const lookup = new Map(categories.map((d) => [d.name, d]));\n    const r = new Map<ICategory, string>();\n    for (const key of Object.keys(dump)) {\n      if (lookup.has(key)) {\n        r.set(lookup.get(key)!, dump[key]);\n      }\n    }\n    return new ReplacementColorMappingFunction(r);\n  }\n}\n\n/**\n * @internal\n */\nexport function restoreCategoricalColorMapping(\n  dump: ITypedDump | null | undefined,\n  categories: ICategory[]\n): ICategoricalColorMappingFunction {\n  if (!dump) {\n    return DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n  return ReplacementColorMappingFunction.restore(dump, categories);\n}\n","import type { IGroup } from './interfaces';\n\nexport function isMissingValue(v: any): boolean {\n  if (\n    v == null ||\n    v === undefined ||\n    v === '' ||\n    v === 'NA' ||\n    v === 'na' ||\n    v === 'Na' ||\n    v === 'nA' ||\n    v === 'NaN' ||\n    (typeof v === 'number' && Number.isNaN(v))\n  ) {\n    return true;\n  }\n  if (!Array.isArray(v)) {\n    return false;\n  }\n  for (const vi of v) {\n    if (!isMissingValue(vi)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isUnknown(v?: number | null) {\n  return v == null || v === undefined || Number.isNaN(v);\n}\n\nexport const FIRST_IS_NAN = -1;\nexport const FIRST_IS_MISSING = 1;\n\nexport const missingGroup: IGroup = {\n  name: 'Missing values',\n  color: 'gray',\n};\n","import { ISequence, isSeqEmpty, empty } from '../internal';\nimport { colorPool } from './internal';\nimport type {\n  ICategoricalColumn,\n  ICategoricalDesc,\n  ICategoricalFilter,\n  ICategoricalsColumn,\n  ICategory,\n  ISetCategoricalFilter,\n} from './ICategoricalColumn';\nimport { DEFAULT_COLOR } from './Column';\nimport type { ICompareValue, IDataRow } from './interfaces';\nimport { FIRST_IS_MISSING } from './missing';\n\n/** @internal */\nexport function toCategory(\n  cat: string | Partial<ICategory>,\n  value: number,\n  nextColor: () => string = () => DEFAULT_COLOR\n) {\n  if (typeof cat === 'string') {\n    //just the category value\n    return { name: cat, label: cat, color: nextColor(), value };\n  }\n  const name = cat.name == null ? String(cat.value) : cat.name;\n  return {\n    name,\n    label: cat.label || name,\n    color: cat.color || nextColor(),\n    value: cat.value != null ? cat.value : value,\n  };\n}\n\n/** @internal */\nexport function toCompareCategoryValue(v: ICategory | null) {\n  if (v == null) {\n    return NaN;\n  }\n  return v.value;\n}\n\nfunction findMostFrequent(\n  rows: ISequence<ICategory | null>,\n  valueCache?: ISequence<ICategory | null>\n): { cat: ICategory | null; count: number } {\n  const hist = new Map<ICategory | null, number>();\n\n  if (valueCache) {\n    valueCache.forEach((cat) => {\n      hist.set(cat, (hist.get(cat) || 0) + 1);\n    });\n  } else {\n    rows.forEach((cat) => {\n      hist.set(cat, (hist.get(cat) || 0) + 1);\n    });\n  }\n\n  if (hist.size === 0) {\n    return {\n      cat: null,\n      count: 0,\n    };\n  }\n  let topCat: ICategory | null = null;\n  let topCount = 0;\n  hist.forEach((count, cat) => {\n    if (count > topCount) {\n      topCat = cat;\n      topCount = count;\n    }\n  });\n  return {\n    cat: topCat,\n    count: topCount,\n  };\n}\n\n/** @internal */\nexport function toMostFrequentCategoricals(rows: ISequence<IDataRow>, col: ICategoricalsColumn): (ICategory | null)[] {\n  if (isSeqEmpty(rows)) {\n    return empty(col.dataLength!);\n  }\n  const maps = empty(col.dataLength!).map(() => new Map<ICategory | null, number>());\n  rows.forEach((row) => {\n    const vs = col.getCategories(row);\n    if (!vs) {\n      return;\n    }\n    for (let i = 0; i < maps.length; ++i) {\n      const hist = maps[i];\n      const cat = vs[i] || null;\n      hist.set(cat, (hist.get(cat) || 0) + 1);\n    }\n  });\n\n  return maps.map((hist) => {\n    if (hist.size === 0) {\n      return null;\n    }\n    let topCat: ICategory | null = null;\n    let topCount = 0;\n    hist.forEach((count, cat) => {\n      if (count > topCount) {\n        topCat = cat;\n        topCount = count;\n      }\n    });\n    return topCat;\n  });\n}\n\n/** @internal */\nexport function toGroupCompareCategoryValue(\n  rows: ISequence<IDataRow>,\n  col: ICategoricalColumn,\n  valueCache?: ISequence<ICategory | null>\n): ICompareValue[] {\n  if (isSeqEmpty(rows)) {\n    return [NaN, null];\n  }\n  const mostFrequent = findMostFrequent(\n    rows.map((d) => col.getCategory(d)),\n    valueCache\n  );\n  if (mostFrequent.cat == null) {\n    return [NaN, null];\n  }\n  return [mostFrequent.cat.value, mostFrequent.cat.name.toLowerCase()];\n}\n\n/** @internal */\nfunction compareCategory(a: ICategory | null, b: ICategory | null) {\n  const aNull = a == null || Number.isNaN(a.value);\n  const bNull = b == null || Number.isNaN(b.value);\n  if (aNull || a == null) {\n    return bNull ? 0 : FIRST_IS_MISSING;\n  }\n  if (bNull || b == null) {\n    return -FIRST_IS_MISSING;\n  }\n  if (a.value === b.value) {\n    return a.label.toLowerCase().localeCompare(b.label.toLowerCase());\n  }\n  return a.value - b.value;\n}\n\nexport function toCategories(desc: ICategoricalDesc) {\n  if (!desc.categories) {\n    return [];\n  }\n  const nextColor = colorPool();\n  const l = desc.categories.length - 1;\n  const cats = desc.categories.map((cat, i) => toCategory(cat, i / l, nextColor));\n  return cats.sort(compareCategory);\n}\n\n/** @internal */\nfunction isEmptyFilter(f: ICategoricalFilter | null) {\n  return f == null || (!f.filterMissing && (f.filter == null || f.filter === ''));\n}\n\n/** @internal */\nexport function isEqualCategoricalFilter(a: ICategoricalFilter | null, b: ICategoricalFilter | null) {\n  if (a === b) {\n    return true;\n  }\n  if (a == null || b == null) {\n    return isEmptyFilter(a) === isEmptyFilter(b);\n  }\n  if (\n    a.filterMissing !== b.filterMissing ||\n    typeof a.filter !== typeof b.filter ||\n    Array.isArray(a.filter) !== Array.isArray(b.filter)\n  ) {\n    return false;\n  }\n  if (Array.isArray(a.filter)) {\n    return arrayEquals(a.filter, b.filter as string[]);\n  }\n  return String(a.filter) === String(b.filter);\n}\n\n/** @internal */\nexport function isEqualSetCategoricalFilter(a: ISetCategoricalFilter | null, b: ISetCategoricalFilter | null) {\n  if (!isEqualCategoricalFilter(a, b)) {\n    return false;\n  }\n  const am = a && a.mode ? a.mode : 'every';\n  const bm = b && b.mode ? b.mode : 'every';\n  return am === bm;\n}\n\nfunction arrayEquals<T>(a: T[], b: T[]) {\n  const al = a != null ? a.length : 0;\n  const bl = b != null ? b.length : 0;\n  if (al !== bl) {\n    return false;\n  }\n  if (al === 0) {\n    return true;\n  }\n  return a.every((ai, i) => ai === b[i]);\n}\n\n/** @internal */\nexport function isCategoryIncluded(filter: ICategoricalFilter | null, category: ICategory | null) {\n  if (filter == null) {\n    return true;\n  }\n  if (category == null || Number.isNaN(category.value)) {\n    return !filter.filterMissing;\n  }\n  const filterObj = filter.filter;\n  if (Array.isArray(filterObj)) {\n    //array mode\n    return filterObj.includes(category.name);\n  }\n  if (typeof filterObj === 'string' && filterObj.length > 0) {\n    //search mode\n    return category.name.toLowerCase().includes(filterObj.toLowerCase());\n  }\n  if (filterObj instanceof RegExp) {\n    //regex match mode\n    return filterObj.test(category.name);\n  }\n  return true;\n}\n","import type { IEventListener, ISequence } from '../internal';\nimport { Category, toolbar } from './annotations';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport type {\n  ICategoricalColumn,\n  ICategoricalColumnDesc,\n  ICategoricalFilter,\n  ICategory,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport { IDataRow, IGroup, ICompareValue, ITypeFactory, ECompareValueType } from './interfaces';\nimport { missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  toCategories,\n  isCategoryIncluded,\n  isEqualCategoricalFilter,\n  toCompareCategoryValue,\n  toGroupCompareCategoryValue,\n} from './internalCategorical';\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf CategoricalColumn\n * @event\n */\nexport declare function colorMappingChanged_CC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf CategoricalColumn\n * @event\n */\nexport declare function filterChanged_CC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\n\n/**\n * column for categorical values\n */\n@toolbar(\n  'rename',\n  'clone',\n  'sort',\n  'sortBy',\n  'group',\n  'groupBy',\n  'sortGroupBy',\n  'filterCategorical',\n  'colorMappedCategorical'\n)\n@Category('categorical')\nexport default class CategoricalColumn extends ValueColumn<string> implements ICategoricalColumn {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n\n  readonly categories: ICategory[];\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n  /**\n   * set of categories to show\n   * @type {null}\n   * @private\n   */\n  private currentFilter: ICategoricalFilter | null = null;\n\n  constructor(id: string, desc: Readonly<ICategoricalColumnDesc>) {\n    super(id, desc);\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([CategoricalColumn.EVENT_FILTER_CHANGED, CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(type: typeof CategoricalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_CC | null): this;\n  on(type: typeof CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_CC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.name : null;\n  }\n\n  getCategory(row: IDataRow) {\n    const v = super.getValue(row);\n    if (!v) {\n      return null;\n    }\n    const vs = String(v);\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  getLabel(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.label : '';\n  }\n\n  getCategories(row: IDataRow) {\n    const v = this.getCategory(row);\n    return [v];\n  }\n\n  getValues(row: IDataRow) {\n    const v = this.getCategory(row);\n    return this.categories.map((d) => d === v);\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getValues(row).map(String);\n  }\n\n  getMap(row: IDataRow) {\n    const cats = this.categories;\n    return this.getValues(row).map((value, i) => ({ key: cats[i].label, value }));\n  }\n\n  getMapLabel(row: IDataRow) {\n    const cats = this.categories;\n    return this.getLabels(row).map((value, i) => ({ key: cats[i].label, value }));\n  }\n\n  getSet(row: IDataRow) {\n    const cat = this.getCategory(row);\n    const r = new Set<ICategory>();\n    if (cat) {\n      r.add(cat);\n    }\n    return r;\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.filter = this.currentFilter;\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n\n    if (typeof dump.filter === 'undefined') {\n      this.currentFilter = null;\n      return;\n    }\n    const bak = dump.filter;\n    if (typeof bak === 'string' || Array.isArray(bak)) {\n      this.currentFilter = { filter: bak, filterMissing: false };\n    } else {\n      this.currentFilter = bak;\n    }\n  }\n\n  getColor(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? this.colorMapping.apply(v) : DEFAULT_COLOR;\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow, valueCache?: any): boolean {\n    return isCategoryIncluded(this.currentFilter, valueCache !== undefined ? valueCache : this.getCategory(row));\n  }\n\n  getFilter() {\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(filter: ICategoricalFilter | null) {\n    if (isEqualCategoricalFilter(this.currentFilter, filter)) {\n      return;\n    }\n    this.fire(\n      [CategoricalColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = filter)\n    );\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  toCompareValue(row: IDataRow, valueCache?: any) {\n    return toCompareCategoryValue(valueCache !== undefined ? valueCache : this.getCategory(row));\n  }\n\n  toCompareValueType(): ECompareValueType {\n    return ECompareValueType.FLOAT_ASC;\n  }\n\n  group(row: IDataRow, valueCache?: any): IGroup {\n    const cat = valueCache !== undefined ? valueCache : this.getCategory(row);\n    if (!cat) {\n      return Object.assign({}, missingGroup);\n    }\n    return { name: cat.label, color: cat.color };\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): ICompareValue[] {\n    return toGroupCompareCategoryValue(rows, this, valueCache);\n  }\n\n  toCompareGroupValueType() {\n    return [ECompareValueType.FLOAT, ECompareValueType.STRING];\n  }\n\n  getGroupRenderer() {\n    const current = super.getGroupRenderer();\n    if (current === this.desc.type && this.isGroupedBy() >= 0) {\n      // still the default and the stratification criteria\n      return 'catdistributionbar';\n    }\n    return current;\n  }\n}\n","import { Category, toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  widthChanged,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport type { IArrayColumn } from './IArrayColumn';\nimport type {\n  ICategoricalDesc,\n  ISetCategoricalFilter,\n  ICategory,\n  ISetColumn,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport { IDataRow, ECompareValueType, IValueColumnDesc, IGroup, ITypeFactory } from './interfaces';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport { toCategories, isCategoryIncluded, isEqualSetCategoricalFilter } from './internalCategorical';\nimport { chooseUIntByDataLength, integrateDefaults } from './internal';\n\nexport interface ISetDesc extends ICategoricalDesc {\n  separator?: string;\n}\n\nexport declare type ISetColumnDesc = ISetDesc & IValueColumnDesc<string[]>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf SetColumn\n * @event\n */\nexport declare function colorMappingChanged_SSC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf SetColumn\n * @event\n */\nexport declare function filterChanged_SSC(\n  previous: ISetCategoricalFilter | null,\n  current: ISetCategoricalFilter | null\n): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterCategorical', 'colorMappedCategorical', 'group', 'groupBy')\n@Category('categorical')\nexport default class SetColumn extends ValueColumn<string[]> implements IArrayColumn<boolean>, ISetColumn {\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private readonly separator: RegExp;\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n  /**\n   * set of categories to show\n   * @type {null}\n   * @private\n   */\n  private currentFilter: ISetCategoricalFilter | null = null;\n\n  constructor(id: string, desc: Readonly<ISetColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'upset',\n        groupRenderer: 'upset',\n        summaryRenderer: 'categorical',\n      })\n    );\n    this.separator = new RegExp(desc.separator || ';');\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SetColumn.EVENT_COLOR_MAPPING_CHANGED, SetColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof SetColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_SSC | null): this;\n  on(type: typeof SetColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_SSC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  getValue(row: IDataRow): string[] | null {\n    const v = this.getSortedSet(row);\n    if (v.length === 0) {\n      return null;\n    }\n    return v.map((d) => d.name);\n  }\n\n  getLabel(row: IDataRow) {\n    return `(${this.getSortedSet(row)\n      .map((d) => d.label)\n      .join(',')})`;\n  }\n\n  private normalize(v: any) {\n    if (typeof v === 'string') {\n      return v.split(this.separator).map((s) => s.trim());\n    }\n    if (Array.isArray(v)) {\n      return v.map((v) => String(v).trim());\n    }\n    if (v instanceof Set) {\n      return Array.from(v).map(String);\n    }\n    return [];\n  }\n\n  getSet(row: IDataRow) {\n    const sv = this.normalize(super.getValue(row));\n    const r = new Set<ICategory>();\n    sv.forEach((n) => {\n      const cat = this.lookup.get(n);\n      if (cat) {\n        r.add(cat);\n      }\n    });\n    return r;\n  }\n\n  getSortedSet(row: IDataRow) {\n    return Array.from(this.getSet(row)).sort((a, b) =>\n      a.value === b.value ? a.label.localeCompare(b.label) : a.value - b.value\n    );\n  }\n\n  getCategories(row: IDataRow) {\n    return this.getSortedSet(row);\n  }\n\n  getColors(row: IDataRow) {\n    return this.getSortedSet(row).map((d) => this.colorMapping.apply(d));\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  getValues(row: IDataRow) {\n    const s = this.getSet(row);\n    return this.categories.map((d) => s.has(d));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getValues(row).map(String);\n  }\n\n  getMap(row: IDataRow) {\n    return this.getSortedSet(row).map((d) => ({ key: d.label, value: true }));\n  }\n\n  getMapLabel(row: IDataRow) {\n    return this.getSortedSet(row).map((d) => ({ key: d.label, value: 'true' }));\n  }\n\n  iterCategory(row: IDataRow) {\n    const r = this.getSet(row);\n    if (r.size > 0) {\n      return Array.from(r);\n    }\n    return [null];\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.filter = this.currentFilter;\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n    if (!('filter' in dump)) {\n      this.currentFilter = null;\n      return;\n    }\n    const bak = dump.filter;\n    if (typeof bak === 'string' || Array.isArray(bak)) {\n      this.currentFilter = { filter: bak, filterMissing: false, mode: 'some' };\n    } else {\n      this.currentFilter = bak;\n    }\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow): boolean {\n    if (!this.currentFilter) {\n      return true;\n    }\n    const v = Array.from(this.getSet(row));\n    if (v.length === 0) {\n      return isCategoryIncluded(this.currentFilter, null);\n    }\n    if (this.currentFilter.mode === 'every') {\n      return v.every((s) => isCategoryIncluded(this.currentFilter, s));\n    }\n    return v.some((s) => isCategoryIncluded(this.currentFilter, s));\n  }\n\n  getFilter(): ISetCategoricalFilter | null {\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(filter: ISetCategoricalFilter | null) {\n    if (isEqualSetCategoricalFilter(this.currentFilter, filter)) {\n      return;\n    }\n    this.fire(\n      [CategoricalColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = filter)\n    );\n  }\n\n  clearFilter() {\n    return CategoricalColumn.prototype.clearFilter.call(this);\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getSet(row);\n\n    const vs = [v.size];\n    for (const cat of this.categories) {\n      vs.push(v.has(cat) ? 1 : 0);\n    }\n    return vs;\n  }\n\n  toCompareValueType() {\n    return [chooseUIntByDataLength(this.categories.length)].concat(this.categories.map(() => ECompareValueType.BINARY));\n  }\n\n  group(row: IDataRow): IGroup {\n    const v = this.getSet(row);\n    const cardinality = v.size;\n    const categories = this.categories.filter((c) => v.has(c));\n\n    // by cardinality and then by intersection\n\n    const g: IGroup = {\n      name: categories.length === 0 ? 'None' : categories.map((d) => d.name).join(', '),\n      color: categories.length === 1 ? categories[0].color : DEFAULT_COLOR,\n    };\n\n    g.parent = {\n      name: `#${cardinality}`,\n      color: DEFAULT_COLOR,\n      subGroups: [g],\n    };\n\n    return g;\n  }\n}\n","import { equalArrays, fixCSS, IEventListener, suffix, joinIndexArrays, AEventDispatcher } from '../internal';\nimport { isSortingAscByDefault } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  labelChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport CompositeColumn from './CompositeColumn';\nimport {\n  IRankingDump,\n  defaultGroup,\n  IndicesArray,\n  IOrderedGroup,\n  IDataRow,\n  IColumnParent,\n  IFlatColumn,\n  ISortCriteria,\n  UIntTypedArray,\n  IGroupParent,\n  ITypeFactory,\n  IGroup,\n} from './interfaces';\nimport { groupRoots, traverseGroupsDFS } from './internal';\nimport AggregateGroupColumn from './AggregateGroupColumn';\nimport SetColumn from './SetColumn';\nimport { AGGREGATION_LEVEL_WIDTH } from '../styles';\n\nexport enum EDirtyReason {\n  UNKNOWN = 'unknown',\n  FILTER_CHANGED = 'filter',\n  SORT_CRITERIA_CHANGED = 'sort_changed',\n  SORT_CRITERIA_DIRTY = 'sort_dirty',\n  GROUP_CRITERIA_CHANGED = 'group_changed',\n  GROUP_CRITERIA_DIRTY = 'group_dirty',\n  GROUP_SORT_CRITERIA_CHANGED = 'group_sort_changed',\n  GROUP_SORT_CRITERIA_DIRTY = 'group_sort_dirty',\n}\n\n/**\n * emitted when a column has been added\n * @asMemberOf Ranking\n * @event\n */\nexport declare function addColumn(col: Column, index: number): void;\n\n/**\n * emitted when a column has been moved within this composite column\n * @asMemberOf Ranking\n * @event\n */\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\n\n/**\n * emitted when a column has been removed\n * @asMemberOf Ranking\n * @event\n */\nexport declare function removeColumn(col: Column, index: number): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function sortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function groupCriteriaChanged(previous: Column[], current: Column[]): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function groupSortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\n/**\n * emitted when the sort criteria property changes\n * @asMemberOf Ranking\n * @event\n */\nexport declare function dirtyOrder(reason?: EDirtyReason[]): void;\n/**\n * @asMemberOf Ranking\n * @event\n */\nexport declare function orderChanged(\n  previous: number[],\n  current: number[],\n  previousGroups: IOrderedGroup[],\n  currentGroups: IOrderedGroup[],\n  dirtyReason: EDirtyReason[]\n): void;\n/**\n * @asMemberOf Ranking\n * @event\n */\nexport declare function groupsChanged(\n  previous: number[],\n  current: number[],\n  previousGroups: IOrderedGroup[],\n  currentGroups: IOrderedGroup[]\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function filterChanged(previous: any | null, current: any | null): void;\n/**\n * a ranking\n */\nexport default class Ranking extends AEventDispatcher implements IColumnParent {\n  static readonly EVENT_WIDTH_CHANGED = Column.EVENT_WIDTH_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_LABEL_CHANGED = Column.EVENT_LABEL_CHANGED;\n  static readonly EVENT_ADD_COLUMN = CompositeColumn.EVENT_ADD_COLUMN;\n  static readonly EVENT_MOVE_COLUMN = CompositeColumn.EVENT_MOVE_COLUMN;\n  static readonly EVENT_REMOVE_COLUMN = CompositeColumn.EVENT_REMOVE_COLUMN;\n  static readonly EVENT_DIRTY = Column.EVENT_DIRTY;\n  static readonly EVENT_DIRTY_HEADER = Column.EVENT_DIRTY_HEADER;\n  static readonly EVENT_DIRTY_VALUES = Column.EVENT_DIRTY_VALUES;\n  static readonly EVENT_DIRTY_CACHES = Column.EVENT_DIRTY_CACHES;\n  static readonly EVENT_COLUMN_VISIBILITY_CHANGED = Column.EVENT_VISIBILITY_CHANGED;\n  static readonly EVENT_SORT_CRITERIA_CHANGED = 'sortCriteriaChanged';\n  static readonly EVENT_GROUP_CRITERIA_CHANGED = 'groupCriteriaChanged';\n  static readonly EVENT_GROUP_SORT_CRITERIA_CHANGED = 'groupSortCriteriaChanged';\n  static readonly EVENT_DIRTY_ORDER = 'dirtyOrder';\n  static readonly EVENT_ORDER_CHANGED = 'orderChanged';\n  static readonly EVENT_GROUPS_CHANGED = 'groupsChanged';\n\n  private static readonly FORWARD_COLUMN_EVENTS = suffix(\n    '.ranking',\n    Column.EVENT_VISIBILITY_CHANGED,\n    Column.EVENT_DIRTY_VALUES,\n    Column.EVENT_DIRTY_CACHES,\n    Column.EVENT_DIRTY_HEADER,\n    Column.EVENT_DIRTY,\n    Column.EVENT_VISIBILITY_CHANGED,\n    Ranking.EVENT_FILTER_CHANGED\n  );\n  private static readonly COLUMN_GROUP_SORT_DIRTY = suffix(\n    '.groupOrder',\n    Column.EVENT_DIRTY_CACHES,\n    'sortMethodChanged'\n  );\n  private static readonly COLUMN_SORT_DIRTY = suffix('.order', Column.EVENT_DIRTY_CACHES);\n  private static readonly COLUMN_GROUP_DIRTY = suffix('.group', Column.EVENT_DIRTY_CACHES, 'groupingChanged');\n\n  private label: string;\n\n  private readonly sortCriteria: ISortCriteria[] = [];\n  private readonly groupColumns: Column[] = [];\n  private readonly groupSortCriteria: ISortCriteria[] = [];\n\n  /**\n   * columns of this ranking\n   * @type {Array}\n   * @private\n   */\n  private readonly columns: Column[] = [];\n\n  readonly dirtyOrder = (reason?: EDirtyReason[]) => {\n    this.fire([Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], reason);\n  };\n  private readonly dirtyOrderSortDirty = () => this.dirtyOrder([EDirtyReason.SORT_CRITERIA_DIRTY]);\n  private readonly dirtyOrderGroupDirty = () => this.dirtyOrder([EDirtyReason.GROUP_CRITERIA_DIRTY]);\n  private readonly dirtyOrderGroupSortDirty = () => this.dirtyOrder([EDirtyReason.GROUP_SORT_CRITERIA_DIRTY]);\n  private readonly dirtyOrderFiltering = () => this.dirtyOrder([EDirtyReason.FILTER_CHANGED]);\n\n  /**\n   * the current ordering as an sorted array of indices\n   * @type {Array}\n   */\n  private groups: IOrderedGroup[] = [Object.assign({ order: [] as number[] }, defaultGroup)];\n  private order: IndicesArray = [];\n  private index2pos: IndicesArray = [];\n\n  constructor(public id: string) {\n    super();\n    this.id = fixCSS(id);\n    this.label = `Ranking ${id.startsWith('rank') ? id.slice(4) : id}`;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        Ranking.EVENT_WIDTH_CHANGED,\n        Ranking.EVENT_FILTER_CHANGED,\n        Ranking.EVENT_LABEL_CHANGED,\n        Ranking.EVENT_GROUPS_CHANGED,\n        Ranking.EVENT_ADD_COLUMN,\n        Ranking.EVENT_REMOVE_COLUMN,\n        Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n        Ranking.EVENT_MOVE_COLUMN,\n        Ranking.EVENT_DIRTY,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY_CACHES,\n        Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_COLUMN_VISIBILITY_CHANGED,\n        Ranking.EVENT_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_ORDER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof Ranking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Ranking.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof Ranking.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Ranking.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof Ranking.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof Ranking.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Ranking.EVENT_COLUMN_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: typeof Ranking.EVENT_SORT_CRITERIA_CHANGED, listener: typeof sortCriteriaChanged | null): this;\n  on(type: typeof Ranking.EVENT_GROUP_CRITERIA_CHANGED, listener: typeof groupCriteriaChanged | null): this;\n  on(type: typeof Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, listener: typeof groupSortCriteriaChanged | null): this;\n  on(type: typeof Ranking.EVENT_DIRTY_ORDER, listener: typeof dirtyOrder | null): this;\n  on(type: typeof Ranking.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\n  on(type: typeof Ranking.EVENT_GROUPS_CHANGED, listener: typeof groupsChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  assignNewId(idGenerator: () => string) {\n    this.id = fixCSS(idGenerator());\n    this.columns.forEach((c) => c.assignNewId(idGenerator));\n  }\n\n  getLabel() {\n    return this.label;\n  }\n\n  setLabel(value: string) {\n    if (value === this.label) {\n      return;\n    }\n    this.fire(Ranking.EVENT_LABEL_CHANGED, this.label, (this.label = value));\n  }\n\n  setGroups(groups: IOrderedGroup[], index2pos: IndicesArray, dirtyReason: EDirtyReason[]) {\n    const old = this.order;\n    const oldGroups = this.groups;\n    this.groups = groups;\n    this.index2pos = index2pos;\n    this.order = joinIndexArrays(groups.map((d) => d.order));\n    // replace with subarrays to save memory\n    if (groups.length > 1) {\n      this.unifyGroups(groups);\n    } else if (groups.length === 1) {\n      // propagate to the top\n      let p = groups[0].parent;\n      while (p) {\n        (p as any as IOrderedGroup).order = this.order;\n        p = p.parent;\n      }\n    }\n    this.fire(\n      [Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_GROUPS_CHANGED, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      old,\n      this.order,\n      oldGroups,\n      groups,\n      dirtyReason\n    );\n  }\n\n  private unifyGroups(groups: IOrderedGroup[]) {\n    let offset = 0;\n    const order = this.order as UIntTypedArray;\n    const offsets = new Map<\n      Readonly<IGroupParent> | IOrderedGroup,\n      {\n        offset: number;\n        size: number;\n      }\n    >();\n    for (const group of groups) {\n      const size = group.order.length;\n      group.order = order.subarray(offset, offset + size);\n      offsets.set(group, { offset, size });\n      offset += size;\n    }\n    // propagate also to the top with views\n    const roots = groupRoots(groups);\n    const resolve = (\n      g: Readonly<IGroupParent> | IOrderedGroup\n    ): {\n      offset: number;\n      size: number;\n    } => {\n      if (offsets.has(g)) {\n        // leaf\n        return offsets.get(g)!;\n      }\n      const subs = (g as IGroupParent).subGroups.map((gi) => resolve(gi as Readonly<IGroupParent> | IOrderedGroup));\n      const offset = subs.length > 0 ? subs[0].offset : 0;\n      const size = subs.reduce((a, b) => a + b.size, 0);\n      const r = { offset, size };\n      offsets.set(g, r);\n      (g as any as IOrderedGroup).order = order.subarray(offset, offset + size);\n      return r;\n    };\n    for (const root of roots) {\n      resolve(root);\n    }\n  }\n\n  getRank(dataIndex: number) {\n    if (dataIndex < 0 || dataIndex > this.index2pos.length) {\n      return -1;\n    }\n    const v = this.index2pos[dataIndex];\n    return v != null && !Number.isNaN(v) && v > 0 ? v : -1;\n  }\n\n  getOrder() {\n    return this.order;\n  }\n\n  getOrderLength() {\n    return this.order.length;\n  }\n\n  getGroups() {\n    return this.groups.slice();\n  }\n\n  /**\n   * Returns the flat group tree in depth first search (DFS).\n   */\n  getFlatGroups() {\n    const r: Readonly<IGroup | IGroupParent>[] = [];\n    traverseGroupsDFS(this.groups, (v) => {\n      r.push(v);\n    });\n    return r;\n  }\n\n  dump(toDescRef: (desc: any) => any): IRankingDump {\n    const r: IRankingDump = {};\n    r.columns = this.columns.map((d) => d.dump(toDescRef));\n    r.sortCriteria = this.sortCriteria.map((s) => ({ asc: s.asc, sortBy: s.col!.id }));\n    r.groupSortCriteria = this.groupSortCriteria.map((s) => ({ asc: s.asc, sortBy: s.col!.id }));\n    r.groupColumns = this.groupColumns.map((d) => d.id);\n    return r;\n  }\n\n  restore(dump: IRankingDump, factory: ITypeFactory) {\n    this.clear();\n    (dump.columns || []).forEach((child: any) => {\n      const c = factory(child);\n      if (c) {\n        this.push(c);\n      }\n    });\n    // compatibility case\n    if (dump.sortColumn && dump.sortColumn.sortBy) {\n      const help = this.columns.find((d) => d.id === dump.sortColumn!.sortBy);\n      if (help) {\n        this.sortBy(help, dump.sortColumn.asc);\n      }\n    }\n    if (dump.groupColumns) {\n      const groupColumns = dump.groupColumns\n        .map((id: string) => this.columns.find((d) => d.id === id))\n        .filter((d) => d != null) as Column[];\n      this.setGroupCriteria(groupColumns);\n    }\n\n    const restoreSortCriteria = (dumped: any) => {\n      return dumped\n        .map((s: { asc: boolean; sortBy: string }) => {\n          return {\n            asc: s.asc,\n            col: this.columns.find((d) => d.id === s.sortBy) || null,\n          };\n        })\n        .filter((s: any) => s.col);\n    };\n\n    if (dump.sortCriteria) {\n      this.setSortCriteria(restoreSortCriteria(dump.sortCriteria));\n    }\n\n    if (dump.groupSortCriteria) {\n      this.setGroupSortCriteria(restoreSortCriteria(dump.groupSortCriteria));\n    }\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    let acc = offset; // + this.getWidth() + padding;\n    if (levelsToGo > 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n      this.columns.forEach((c) => {\n        if (c.getVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n          acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\n        }\n      });\n    }\n    return acc - offset;\n  }\n\n  getPrimarySortCriteria(): ISortCriteria | null {\n    if (this.sortCriteria.length === 0) {\n      return null;\n    }\n    return this.sortCriteria[0];\n  }\n\n  getSortCriteria(): ISortCriteria[] {\n    return this.sortCriteria.map((d) => Object.assign({}, d));\n  }\n\n  getGroupSortCriteria(): ISortCriteria[] {\n    return this.groupSortCriteria.map((d) => Object.assign({}, d));\n  }\n\n  toggleSorting(col: Column) {\n    return this.setSortCriteria(this.toggleSortingLogic(col, this.sortCriteria));\n  }\n\n  private toggleSortingLogic(col: Column, sortCriteria: ISortCriteria[]) {\n    const newSort = sortCriteria.slice();\n    const current = newSort.findIndex((d) => d.col === col);\n    const defaultAsc = isSortingAscByDefault(col);\n\n    if (current < 0) {\n      newSort.splice(0, newSort.length, { col, asc: defaultAsc });\n    } else if (newSort[current].asc === defaultAsc) {\n      // asc -> desc, or desc -> asc\n      newSort.splice(current, 1, { col, asc: !defaultAsc });\n    } else {\n      // remove\n      newSort.splice(current, 1);\n    }\n    return newSort;\n  }\n\n  toggleGrouping(col: Column) {\n    const old = this.groupColumns.indexOf(col);\n    if (old >= 0) {\n      const newGroupings = this.groupColumns.slice();\n      newGroupings.splice(old, 1);\n      return this.setGroupCriteria(newGroupings);\n    }\n    return this.setGroupCriteria([col]);\n  }\n\n  getGroupCriteria() {\n    return this.groupColumns.slice();\n  }\n\n  /**\n   * replaces, moves, or remove the given column in the sorting hierarchy\n   * @param col {Column}\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\n   */\n  sortBy(col: Column, ascending = false, priority = 0) {\n    if (col.findMyRanker() !== this) {\n      return false; //not one of mine\n    }\n    return this.setSortCriteria(\n      this.hierarchyLogic(\n        this.sortCriteria,\n        this.sortCriteria.findIndex((d) => d.col === col),\n        { col, asc: ascending },\n        priority\n      )\n    );\n  }\n\n  /**\n   * replaces, moves, or remove the given column in the group sorting hierarchy\n   * @param col {Column}\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\n   */\n  groupSortBy(col: Column, ascending = false, priority = 0) {\n    if (col.findMyRanker() !== this) {\n      return false; //not one of mine\n    }\n    return this.setGroupSortCriteria(\n      this.hierarchyLogic(\n        this.groupSortCriteria,\n        this.groupSortCriteria.findIndex((d) => d.col === col),\n        { col, asc: ascending },\n        priority\n      )\n    );\n  }\n\n  private hierarchyLogic<T>(entries: T[], index: number, entry: T, priority: number) {\n    entries = entries.slice();\n    if (index >= 0) {\n      // move at the other position\n      entries.splice(index, 1);\n      if (priority >= 0) {\n        entries.splice(Math.min(priority, entries.length), 0, entry);\n      }\n    } else if (priority >= 0) {\n      entries[Math.min(priority, entries.length)] = entry;\n    }\n    return entries;\n  }\n\n  /**\n   * replaces, moves, or remove the given column in the grouping hierarchy\n   * @param col {Column}\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\n   */\n  groupBy(col: Column, priority = 0): boolean {\n    if (col.findMyRanker() !== this) {\n      return false; //not one of mine\n    }\n    return this.setGroupCriteria(this.hierarchyLogic(this.groupColumns, this.groupColumns.indexOf(col), col, priority));\n  }\n\n  setSortCriteria(value: ISortCriteria | ISortCriteria[]) {\n    const values = Array.isArray(value) ? value.slice() : [value];\n    const bak = this.sortCriteria.slice();\n\n    if (equalCriteria(values, bak)) {\n      return false;\n    }\n\n    // update listener\n    bak.forEach((d) => {\n      d.col.on(Ranking.COLUMN_SORT_DIRTY, null!);\n    });\n\n    values.forEach((d) => {\n      d.col.on(Ranking.COLUMN_SORT_DIRTY, this.dirtyOrderSortDirty);\n    });\n    this.sortCriteria.splice(0, this.sortCriteria.length, ...values.slice());\n    this.triggerResort(bak);\n    return true;\n  }\n\n  setGroupCriteria(column: Column[] | Column) {\n    const cols = Array.isArray(column) ? column : [column];\n\n    if (equalArrays(this.groupColumns, cols)) {\n      return true; //same\n    }\n    this.groupColumns.forEach((groupColumn) => {\n      groupColumn.on(Ranking.COLUMN_GROUP_DIRTY, null);\n    });\n\n    const bak = this.groupColumns.slice();\n    this.groupColumns.splice(0, this.groupColumns.length, ...cols);\n\n    this.groupColumns.forEach((groupColumn) => {\n      groupColumn.on(Ranking.COLUMN_GROUP_DIRTY, this.dirtyOrderGroupDirty);\n    });\n\n    this.fire(\n      [\n        Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY_CACHES,\n        Ranking.EVENT_DIRTY,\n      ],\n      bak,\n      this.getGroupCriteria()\n    );\n\n    this.autoAdaptAggregationColumn();\n\n    return true;\n  }\n\n  private autoAdaptAggregationColumn() {\n    // set column auto adds two levels\n    const length = this.groupColumns.reduce((acc, c) => acc + (c instanceof SetColumn ? 2 : 1), 0);\n    const col = this.children.find((d) => d instanceof AggregateGroupColumn);\n    if (!col) {\n      return;\n    }\n    const targetWidth = length * AGGREGATION_LEVEL_WIDTH;\n    if (targetWidth > col.getWidth()) {\n      col.setWidth(targetWidth);\n    }\n  }\n\n  toggleGroupSorting(col: Column) {\n    return this.setGroupSortCriteria(this.toggleSortingLogic(col, this.groupSortCriteria));\n  }\n\n  setGroupSortCriteria(value: ISortCriteria | ISortCriteria[]) {\n    const values = Array.isArray(value) ? value.slice() : [value];\n    const bak = this.groupSortCriteria.slice();\n\n    if (equalCriteria(values, bak)) {\n      return false;\n    }\n\n    bak.forEach((d) => {\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, null!);\n    });\n\n    values.forEach((d) => {\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, this.dirtyOrderGroupSortDirty);\n    });\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length, ...values.slice());\n    this.triggerGroupResort(bak);\n    return true;\n  }\n\n  private triggerGroupResort(bak: ISortCriteria | ISortCriteria[] | null) {\n    const sortCriterias = this.getGroupSortCriteria();\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\n    this.fire(\n      [\n        Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY,\n      ],\n      bakMulti,\n      sortCriterias\n    );\n  }\n\n  private triggerResort(bak: ISortCriteria | ISortCriteria[] | null) {\n    const sortCriterias = this.getSortCriteria();\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\n    this.fire(\n      [\n        Ranking.EVENT_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY,\n      ],\n      bakMulti,\n      sortCriterias\n    );\n  }\n\n  get children() {\n    return this.columns.slice();\n  }\n\n  get length() {\n    return this.columns.length;\n  }\n\n  insert(col: Column, index: number = this.columns.length) {\n    this.columns.splice(index, 0, col);\n    col.attach(this);\n    this.forward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\n    col.on(`${Ranking.EVENT_FILTER_CHANGED}.order`, this.dirtyOrderFiltering);\n    col.on(`${Column.EVENT_VISIBILITY_CHANGED}.ranking`, (oldValue, newValue) =>\n      this.fire(\n        [\n          Ranking.EVENT_COLUMN_VISIBILITY_CHANGED,\n          Ranking.EVENT_DIRTY_HEADER,\n          Ranking.EVENT_DIRTY_VALUES,\n          Ranking.EVENT_DIRTY,\n        ],\n        col,\n        oldValue,\n        newValue\n      )\n    );\n\n    this.fire(\n      [Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      col,\n      index\n    );\n\n    if (col.isFiltered()) {\n      this.dirtyOrderFiltering();\n    }\n    return col;\n  }\n\n  move(col: Column, index: number = this.columns.length) {\n    if (col.parent !== this) {\n      // not a move operation!\n      console.error('invalid move operation: ', col);\n      return null;\n    }\n    const old = this.columns.indexOf(col);\n    if (index === old) {\n      // no move needed\n      return col;\n    }\n    //delete first\n    this.columns.splice(old, 1);\n    // adapt target index based on previous index, i.e shift by one\n    this.columns.splice(old < index ? index - 1 : index, 0, col);\n\n    this.fire(\n      [Ranking.EVENT_MOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      col,\n      index,\n      old\n    );\n    return col;\n  }\n\n  moveAfter(col: Column, reference: Column) {\n    const i = this.columns.indexOf(reference);\n    if (i < 0) {\n      return null;\n    }\n    return this.move(col, i + 1);\n  }\n\n  get fqpath() {\n    return '';\n  }\n\n  findByPath(fqpath: string): Column {\n    let p: IColumnParent | Column = this as any;\n    const indices = fqpath.split('@').map(Number).slice(1); //ignore the first entry = ranking\n    while (indices.length > 0) {\n      const i = indices.shift()!;\n      p = (p as IColumnParent).at(i);\n    }\n    return p as Column;\n  }\n\n  indexOf(col: Column) {\n    return this.columns.indexOf(col);\n  }\n\n  at(index: number) {\n    return this.columns[index];\n  }\n\n  insertAfter(col: Column, ref: Column) {\n    const i = this.columns.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i + 1);\n  }\n\n  push(col: Column) {\n    return this.insert(col);\n  }\n\n  remove(col: Column) {\n    const i = this.columns.indexOf(col);\n    if (i < 0) {\n      return false;\n    }\n\n    this.unforward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\n\n    const isSortCriteria = this.sortCriteria.findIndex((d) => d.col === col);\n    const sortCriteriaChanged = isSortCriteria >= 0;\n    if (sortCriteriaChanged) {\n      this.sortCriteria.splice(isSortCriteria, 1);\n    }\n\n    const isGroupSortCriteria = this.groupSortCriteria.findIndex((d) => d.col === col);\n    const groupSortCriteriaChanged = isGroupSortCriteria >= 0;\n    if (groupSortCriteriaChanged) {\n      this.groupSortCriteria.splice(isGroupSortCriteria, 1);\n    }\n\n    let newGrouping: Column[] | null = null;\n    const isGroupColumn = this.groupColumns.indexOf(col);\n    if (isGroupColumn >= 0) {\n      // was my grouping criteria\n      newGrouping = this.groupColumns.slice();\n      newGrouping.splice(isGroupColumn, 1);\n    }\n\n    col.detach();\n    this.columns.splice(i, 1);\n\n    this.fire(\n      [Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY],\n      col,\n      i\n    );\n\n    if (newGrouping) {\n      this.setGroupCriteria(newGrouping);\n    } else if (sortCriteriaChanged) {\n      this.triggerResort(null);\n    } else if (groupSortCriteriaChanged) {\n      this.triggerGroupResort(null);\n    } else if (col.isFiltered()) {\n      this.dirtyOrderFiltering();\n    }\n\n    return true;\n  }\n\n  clear() {\n    if (this.columns.length === 0) {\n      return;\n    }\n    this.sortCriteria.forEach((d) => {\n      d.col.on(`${Column.EVENT_DIRTY_CACHES}.order`, null!);\n    });\n    this.sortCriteria.splice(0, this.sortCriteria.length);\n    this.groupSortCriteria.forEach((d) => {\n      d.col.on(Ranking.COLUMN_GROUP_SORT_DIRTY, null!);\n    });\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length);\n\n    this.groupColumns.forEach((d) => {\n      d.on(Ranking.COLUMN_GROUP_DIRTY, null!);\n    });\n    this.groupColumns.splice(0, this.groupColumns.length);\n\n    this.columns.forEach((col) => {\n      this.unforward(col, ...Ranking.FORWARD_COLUMN_EVENTS);\n      col.detach();\n    });\n    const removed = this.columns.splice(0, this.columns.length);\n    this.fire(\n      [\n        Ranking.EVENT_REMOVE_COLUMN,\n        Ranking.EVENT_DIRTY_ORDER,\n        Ranking.EVENT_DIRTY_HEADER,\n        Ranking.EVENT_DIRTY_VALUES,\n        Ranking.EVENT_DIRTY,\n      ],\n      removed\n    );\n  }\n\n  get flatColumns(): Column[] {\n    const r: IFlatColumn[] = [];\n    this.flatten(r, 0, Column.FLAT_ALL_COLUMNS);\n    return r.map((d) => d.col);\n  }\n\n  find(idOrFilter: string | ((col: Column) => boolean)) {\n    const filter = typeof idOrFilter === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\n    const r = this.flatColumns;\n    for (const v of r) {\n      if (filter(v)) {\n        return v;\n      }\n    }\n    return null;\n  }\n\n  isFiltered() {\n    return this.columns.some((d) => d.isFiltered());\n  }\n\n  filter(row: IDataRow) {\n    return this.columns.every((d) => d.filter(row));\n  }\n\n  clearFilters() {\n    return this.columns.map((d) => d.clearFilter()).some((d) => d);\n  }\n\n  findMyRanker() {\n    return this;\n  }\n\n  get fqid() {\n    return this.id;\n  }\n\n  /**\n   * marks the header, values, or both as dirty such that the values are reevaluated\n   * @param type specify in more detail what is dirty, by default whole column\n   */\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\n    switch (type) {\n      case 'header':\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\n      case 'values':\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY]);\n      default:\n        return this.fire([\n          Column.EVENT_DIRTY_HEADER,\n          Column.EVENT_DIRTY_VALUES,\n          Column.EVENT_DIRTY_CACHES,\n          Column.EVENT_DIRTY,\n        ]);\n    }\n  }\n}\n\nfunction equalCriteria(a: ISortCriteria[], b: ISortCriteria[]) {\n  if (a.length !== b.length) {\n    return false;\n  }\n  return a.every((ai, i) => {\n    const bi = b[i];\n    return ai.col === bi.col && ai.asc === bi.asc;\n  });\n}\n","/**\n * @internal\n */\nexport interface IDebounceContext {\n  /**\n   * aka this\n   */\n  self: any;\n  args: any[];\n}\n\n/**\n * create a delayed call, can be called multiple times but only the last one at most delayed by timeToDelay will be executed\n * @param {(...args: any[]) => void} callback the callback to call\n * @param {number} timeToDelay delay the call in milliseconds\n * @param choose optional function to merge call context\n * @return {(...args: any[]) => any} a function that can be called with the same interface as the callback but delayed\n * @internal\n */\nexport default function debounce(\n  callback: (...args: any[]) => void,\n  timeToDelay = 100,\n  choose?: (current: IDebounceContext, next: IDebounceContext) => IDebounceContext\n) {\n  let tm = -1;\n  let ctx: IDebounceContext | null = null;\n\n  return function (this: any, ...args: any[]) {\n    if (tm >= 0) {\n      clearTimeout(tm);\n      tm = -1;\n    }\n\n    const next = { self: this, args };\n    // compute current context\n    ctx = ctx && choose ? choose(ctx, next) : next;\n\n    tm = setTimeout(() => {\n      console.assert(ctx != null);\n      callback.apply(ctx!.self, ctx!.args);\n      ctx = null;\n    }, timeToDelay) as unknown as number;\n  };\n}\n","import { Category, SupportType } from './annotations';\nimport Column from './Column';\nimport type { IDataRow, IColumnDesc } from './interfaces';\nimport { integrateDefaults } from './internal';\n\n/**\n * factory for creating a description creating a rank column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createRankDesc(label = 'Rank') {\n  return { type: 'rank', label };\n}\n\n/**\n * a rank column\n */\n@SupportType()\n@Category('support')\nexport default class RankColumn extends Column {\n  constructor(id: string, desc: IColumnDesc) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 50,\n      })\n    );\n  }\n\n  getLabel(row: IDataRow) {\n    return String(this.getValue(row));\n  }\n\n  getRaw(row: IDataRow) {\n    const ranking = this.findMyRanker();\n    if (!ranking) {\n      return -1;\n    }\n    return ranking.getRank(row.i);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getRaw(row);\n    return r === -1 ? null : r;\n  }\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n}\n","import { Category, SupportType, toolbar } from './annotations';\nimport { IndicesArray, IDataRow, IGroup, ECompareValueType, IValueColumnDesc } from './interfaces';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { integrateDefaults } from './internal';\n\n/**\n * factory for creating a description creating a rank column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createSelectionDesc(label = 'Selection Checkboxes') {\n  return { type: 'selection', label, fixed: true };\n}\n\nexport interface ISelectionColumnDesc extends IValueColumnDesc<boolean> {\n  /**\n   * setter for selecting/deselecting the given row\n   */\n  setter(index: number, value: boolean): void;\n\n  /**\n   * setter for selecting/deselecting the given row\n   */\n  setterAll(indices: IndicesArray, value: boolean): void;\n}\n\n/**\n * emitted when rows are selected\n * @asMemberOf SelectionColumn\n * @param dataIndex the (de)seleced row\n * @param value true if selected else false\n * @param dataIndices in case of multiple rows are selected\n * @event\n */\nexport declare function select_SC(dataIndex: number, value: boolean, dataIndices?: IndicesArray): void;\n\n/**\n * a checkbox column for selections\n */\n@SupportType()\n@toolbar('sort', 'sortBy', 'group', 'groupBy', 'invertSelection')\n@Category('support')\nexport default class SelectionColumn extends ValueColumn<boolean> {\n  private static SELECTED_GROUP: IGroup = {\n    name: 'Selected',\n    color: 'orange',\n  };\n  private static NOT_SELECTED_GROUP: IGroup = {\n    name: 'Unselected',\n    color: 'gray',\n  };\n  static readonly EVENT_SELECT = 'select';\n\n  constructor(id: string, desc: Readonly<ISelectionColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 20,\n      })\n    );\n  }\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SelectionColumn.EVENT_SELECT]);\n  }\n\n  on(type: typeof SelectionColumn.EVENT_SELECT, listener: typeof select_SC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  setValue(row: IDataRow, value: boolean) {\n    const old = this.getValue(row);\n    if (old === value) {\n      return true;\n    }\n    return this.setImpl(row, value);\n  }\n\n  setValues(rows: IndicesArray, value: boolean) {\n    if (rows.length === 0) {\n      return false;\n    }\n    if ((this.desc as ISelectionColumnDesc).setterAll) {\n      (this.desc as ISelectionColumnDesc).setterAll(rows, value);\n    }\n    this.fire(SelectionColumn.EVENT_SELECT, rows[0], value, rows);\n    return true;\n  }\n\n  private setImpl(row: IDataRow, value: boolean) {\n    if ((this.desc as ISelectionColumnDesc).setter) {\n      (this.desc as ISelectionColumnDesc).setter(row.i, value);\n    }\n    this.fire(SelectionColumn.EVENT_SELECT, row.i, value);\n    return true;\n  }\n\n  toggleValue(row: IDataRow) {\n    const old = this.getValue(row);\n    this.setImpl(row, !old);\n    return !old;\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row) === true;\n    return v ? 1 : 0;\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.BINARY;\n  }\n\n  group(row: IDataRow) {\n    const isSelected = this.getValue(row);\n    return Object.assign({}, isSelected ? SelectionColumn.SELECTED_GROUP : SelectionColumn.NOT_SELECTED_GROUP);\n  }\n}\n","import { Category, SupportType } from './annotations';\nimport type { IDataRow, IColumnDesc, IGroup } from './interfaces';\nimport Column from './Column';\n\nexport interface IAction {\n  name: string;\n  icon?: string;\n  className?: string;\n\n  action(row: IDataRow): void;\n}\n\nexport interface IGroupAction {\n  name: string;\n  icon?: string;\n  className?: string;\n\n  action(group: IGroup, rows: IDataRow[]): void;\n}\n\n/**\n * utility for creating an action description with optional label\n * @param label\n * @param actions\n * @param groupActions\n * @returns {{type: string, label: string}}\n */\nexport function createActionDesc(\n  label = 'actions',\n  actions: Readonly<IAction>[] = [],\n  groupActions: Readonly<IGroupAction>[] = []\n) {\n  return { type: 'actions', label, actions, groupActions, fixed: true };\n}\n\nexport interface IActionDesc {\n  actions?: Readonly<IAction>[];\n  groupActions?: Readonly<IGroupAction>[];\n}\n\nexport declare type IActionColumnDesc = IColumnDesc & IActionDesc;\n\n/**\n * a default column with no values\n */\n@SupportType()\n@Category('support')\nexport default class ActionColumn extends Column {\n  readonly actions: IAction[];\n  readonly groupActions: IGroupAction[];\n\n  constructor(id: string, desc: Readonly<IActionColumnDesc>) {\n    super(id, desc);\n\n    this.actions = desc.actions || [];\n    this.groupActions = desc.groupActions || [];\n  }\n\n  getLabel() {\n    return '';\n  }\n\n  getValue() {\n    return '';\n  }\n\n  compare() {\n    return 0; //can't compare\n  }\n}\n","import { Category, toolbar, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport {\n  defaultGroup,\n  IDataRow,\n  IGroup,\n  ECompareValueType,\n  IValueColumnDesc,\n  othersGroup,\n  ITypeFactory,\n} from './interfaces';\nimport { missingGroup, isMissingValue } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport { equal, IEventListener, ISequence, isSeqEmpty } from '../internal';\nimport { integrateDefaults } from './internal';\n\nexport enum EAlignment {\n  left = 'left',\n  center = 'center',\n  right = 'right',\n}\n\nexport enum EStringGroupCriteriaType {\n  value = 'value',\n  startsWith = 'startsWith',\n  regex = 'regex',\n}\n\nexport interface IStringGroupCriteria {\n  type: EStringGroupCriteriaType;\n  values: (string | RegExp)[];\n}\n\nexport interface IStringDesc {\n  /**\n   * column alignment: left, center, right\n   * @default left\n   */\n  alignment?: EAlignment;\n\n  /**\n   * escape html tags\n   */\n  escape?: boolean;\n}\n\nexport declare type IStringColumnDesc = IStringDesc & IValueColumnDesc<string>;\n\nexport interface IStringFilter {\n  filter: string | RegExp | null;\n  filterMissing: boolean;\n}\n\n/**\n * emitted when the filter property changes\n * @asMemberOf StringColumn\n * @event\n */\nexport declare function filterChanged_SC(previous: string | RegExp | null, current: string | RegExp | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf StringColumn\n * @event\n */\nexport declare function groupingChanged_SC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'search', 'groupBy', 'sortGroupBy', 'filterString')\n@dialogAddons('group', 'groupString')\n@Category('string')\nexport default class StringColumn extends ValueColumn<string> {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\n\n  //magic key for filtering missing ones\n  private static readonly FILTER_MISSING = '__FILTER_MISSING';\n  private currentFilter: IStringFilter | null = null;\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  private currentGroupCriteria: IStringGroupCriteria = {\n    type: EStringGroupCriteriaType.startsWith,\n    values: [],\n  };\n\n  constructor(id: string, desc: Readonly<IStringColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([StringColumn.EVENT_GROUPING_CHANGED, StringColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_SC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_SC | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow): string | null {\n    const v: any = super.getValue(row);\n    return isMissingValue(v) ? null : String(v);\n  }\n\n  getLabel(row: IDataRow) {\n    return this.getValue(row) || '';\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    if (this.currentFilter instanceof RegExp) {\n      r.filter = `REGEX:${(this.currentFilter as RegExp).source}`;\n    } else {\n      r.filter = this.currentFilter;\n    }\n    if (this.currentGroupCriteria) {\n      const { type, values } = this.currentGroupCriteria;\n      r.groupCriteria = {\n        type,\n        values: values.map((value) =>\n          value instanceof RegExp && type === EStringGroupCriteriaType.regex ? value.source : value\n        ),\n      };\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.filter) {\n      const filter = dump.filter;\n      if (typeof filter === 'string') {\n        // compatibility case\n        if (filter.startsWith('REGEX:')) {\n          this.currentFilter = {\n            filter: new RegExp(filter.slice(6), 'm'),\n            filterMissing: false,\n          };\n        } else if (filter === StringColumn.FILTER_MISSING) {\n          this.currentFilter = {\n            filter: null,\n            filterMissing: true,\n          };\n        } else {\n          this.currentFilter = {\n            filter,\n            filterMissing: false,\n          };\n        }\n      } else {\n        this.currentFilter = {\n          filter:\n            filter.filter && (filter.filter as string).startsWith('REGEX:')\n              ? new RegExp(filter.slice(6), 'm')\n              : filter.filter || '',\n          filterMissing: filter.filterMissing === true,\n        };\n      }\n    } else {\n      this.currentFilter = null;\n    }\n\n    // tslint:disable-next-line: early-exit\n    if (dump.groupCriteria) {\n      const { type, values } = dump.groupCriteria as IStringGroupCriteria;\n      this.currentGroupCriteria = {\n        type,\n        values: values.map((value) =>\n          type === EStringGroupCriteriaType.regex ? new RegExp(value as string, 'm') : value\n        ),\n      };\n    }\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow) {\n    if (!this.isFiltered()) {\n      return true;\n    }\n    const r = this.getLabel(row);\n    const filter = this.currentFilter!;\n    const ff = filter.filter;\n\n    if (r == null || r.trim() === '') {\n      return !filter.filterMissing;\n    }\n    if (!ff) {\n      return true;\n    }\n    if (ff instanceof RegExp) {\n      return r !== '' && r.match(ff) != null; // You can not use RegExp.test(), because of https://stackoverflow.com/a/6891667\n    }\n    return r !== '' && r.toLowerCase().includes(ff.toLowerCase());\n  }\n\n  getFilter() {\n    return this.currentFilter;\n  }\n\n  setFilter(filter: IStringFilter | null) {\n    if (filter === this.currentFilter) {\n      return;\n    }\n    const current = this.currentFilter || { filter: null, filterMissing: false };\n    const target = filter || { filter: null, filterMissing: false };\n    if (\n      current.filterMissing === target.filterMissing &&\n      (current.filter === target.filter ||\n        (current.filter instanceof RegExp &&\n          target.filter instanceof RegExp &&\n          current.filter.source === target.filter.source))\n    ) {\n      return;\n    }\n    this.fire(\n      [StringColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = filter)\n    );\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  getGroupCriteria(): IStringGroupCriteria {\n    return this.currentGroupCriteria;\n  }\n\n  setGroupCriteria(value: IStringGroupCriteria) {\n    if (equal(this.currentGroupCriteria, value) || value == null) {\n      return;\n    }\n    const bak = this.getGroupCriteria();\n    this.currentGroupCriteria = value;\n    this.fire([StringColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\n  }\n\n  group(row: IDataRow): IGroup {\n    if (this.getValue(row) == null) {\n      return Object.assign({}, missingGroup);\n    }\n\n    if (!this.currentGroupCriteria) {\n      return Object.assign({}, othersGroup);\n    }\n    const value = this.getLabel(row);\n\n    if (!value) {\n      return Object.assign({}, missingGroup);\n    }\n\n    const { type, values } = this.currentGroupCriteria;\n    if (type === EStringGroupCriteriaType.value) {\n      return {\n        name: value,\n        color: defaultGroup.color,\n      };\n    }\n    if (type === EStringGroupCriteriaType.startsWith) {\n      for (const groupValue of values) {\n        if (typeof groupValue !== 'string' || !value.startsWith(groupValue)) {\n          continue;\n        }\n        return {\n          name: groupValue,\n          color: defaultGroup.color,\n        };\n      }\n      return Object.assign({}, othersGroup);\n    }\n    for (const groupValue of values) {\n      if (!(groupValue instanceof RegExp) || !groupValue.test(value)) {\n        continue;\n      }\n      return {\n        name: groupValue.source,\n        color: defaultGroup.color,\n      };\n    }\n    return Object.assign({}, othersGroup);\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row);\n    return v === '' || v == null ? null : v.toLowerCase();\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.STRING;\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>) {\n    if (isSeqEmpty(rows)) {\n      return null;\n    }\n    // take the smallest one\n    if (valueCache) {\n      return valueCache.reduce((acc, v) => (acc == null || v < acc ? v : acc), null as null | string);\n    }\n    return rows.reduce((acc, d) => {\n      const v = this.getValue(d);\n      return acc == null || (v != null && v < acc) ? v : acc;\n    }, null as null | string);\n  }\n\n  toCompareGroupValueType() {\n    return ECompareValueType.STRING;\n  }\n}\n","import Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport StringColumn from './StringColumn';\nimport type { IEventListener } from '../internal';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\n\n/**\n * emitted when the filter property changes\n * @asMemberOf AnnotateColumn\n * @event\n */\nexport declare function filterChanged_AC(previous: string | RegExp | null, current: string | RegExp | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf AnnotateColumn\n * @event\n */\nexport declare function groupingChanged_AC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\n\n/**\n * emitted when the value of a row changes\n * @asMemberOf AnnotateColumn\n * @event\n */\nexport declare function valueChanged(dataIndex: number, previous: string, current: string): void;\n\n/**\n * a string column in which the values can be edited locally\n */\nexport default class AnnotateColumn extends StringColumn {\n  static readonly EVENT_VALUE_CHANGED = 'valueChanged';\n\n  private readonly annotations = new Map<number, string>();\n\n  protected createEventList() {\n    return super.createEventList().concat([AnnotateColumn.EVENT_VALUE_CHANGED]);\n  }\n\n  on(type: typeof AnnotateColumn.EVENT_VALUE_CHANGED, listener: typeof valueChanged | null): this;\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_AC | null): this;\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_AC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    if (this.annotations.has(row.i)) {\n      return this.annotations.get(row.i)!;\n    }\n    return super.getValue(row);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.annotations = {};\n    this.annotations.forEach((v, k) => {\n      r.annotations[k] = v;\n    });\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (!dump.annotations) {\n      return;\n    }\n    Object.keys(dump.annotations).forEach((k) => {\n      this.annotations.set(Number(k), dump.annotations[k]);\n    });\n  }\n\n  setValue(row: IDataRow, value: string) {\n    const old = this.getValue(row);\n    if (old === value) {\n      return true;\n    }\n    if (value === '' || value == null) {\n      this.annotations.delete(row.i);\n    } else {\n      this.annotations.set(row.i, value);\n    }\n    this.fire(\n      [AnnotateColumn.EVENT_VALUE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY],\n      row.i,\n      old,\n      value\n    );\n    return true;\n  }\n}\n","import { Category, toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type {\n  ICategoricalColumn,\n  ICategory,\n  ICategoricalColorMappingFunction,\n  ICategoricalFilter,\n} from './ICategoricalColumn';\nimport { IDataRow, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport type { IEventListener } from '../internal';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport { integrateDefaults } from './internal';\nimport { missingGroup } from './missing';\nimport { isCategoryIncluded, isEqualCategoricalFilter } from './internalCategorical';\n\nexport interface IBooleanDesc {\n  /**\n   * string to show for true\n   * @default ✓\n   */\n  trueMarker?: string;\n  /**\n   * string to show for false\n   * @default (empty)\n   */\n  falseMarker?: string;\n}\n\nexport declare type IBooleanColumnDesc = IValueColumnDesc<boolean> & IBooleanDesc;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf BooleanColumn\n * @event\n */\nexport declare function colorMappingChanged_BC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf BooleanColumn\n * @event\n */\nexport declare function filterChanged_BC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'groupBy', 'filterCategorical', 'colorMappedCategorical')\n@Category('categorical')\nexport default class BooleanColumn extends ValueColumn<boolean> implements ICategoricalColumn {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n\n  static readonly GROUP_TRUE = { name: 'True', color: '#444444' };\n  static readonly GROUP_FALSE = { name: 'False', color: '#dddddd' };\n\n  private currentFilter: ICategoricalFilter | null = null;\n\n  private colorMapping: ICategoricalColorMappingFunction;\n  readonly categories: ICategory[];\n\n  constructor(id: string, desc: Readonly<IBooleanColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 30,\n        renderer: 'categorical',\n        groupRenderer: 'categorical',\n        summaryRenderer: 'categorical',\n      })\n    );\n    this.categories = [\n      {\n        name: desc.trueMarker ?? '✓',\n        color: BooleanColumn.GROUP_TRUE.color,\n        label: BooleanColumn.GROUP_TRUE.name,\n        value: 0,\n      },\n      {\n        name: desc.falseMarker ?? '',\n        color: BooleanColumn.GROUP_FALSE.color,\n        label: BooleanColumn.GROUP_FALSE.name,\n        value: 1,\n      },\n    ];\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([BooleanColumn.EVENT_COLOR_MAPPING_CHANGED, BooleanColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof BooleanColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_BC | null): this;\n  on(type: typeof BooleanColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  getValue(row: IDataRow) {\n    const v: any = super.getValue(row);\n    if (typeof v === 'undefined' || v == null) {\n      return null;\n    }\n    return v === true || v === 'true' || v === 'yes' || v === 'x';\n  }\n\n  getCategoryOfBoolean(v: boolean | null) {\n    return v == null ? null : this.categories[v ? 0 : 1];\n  }\n\n  getCategory(row: IDataRow) {\n    const v = this.getValue(row);\n    return v == null ? null : this.categories[v ? 0 : 1];\n  }\n\n  getCategories(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  getColor(row: IDataRow) {\n    return CategoricalColumn.prototype.getColor.call(this, row);\n  }\n\n  getLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabel.call(this, row);\n  }\n\n  getLabels(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabels.call(this, row);\n  }\n\n  getValues(row: IDataRow) {\n    return CategoricalColumn.prototype.getValues.call(this, row);\n  }\n\n  getMap(row: IDataRow) {\n    return CategoricalColumn.prototype.getMap.call(this, row);\n  }\n\n  getMapLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\n  }\n\n  getSet(row: IDataRow) {\n    const v = this.getValue(row);\n    const r = new Set<ICategory>();\n    if (v != null) {\n      r.add(this.categories[v ? 0 : 1]);\n    }\n    return r;\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    if (this.currentFilter != null) {\n      r.filter = this.currentFilter;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n    if (typeof dump.filter === 'boolean') {\n      this.currentFilter = {\n        filter: [this.getCategoryOfBoolean(dump.filter)!.name],\n        filterMissing: false,\n      };\n    } else if (typeof dump.filter !== 'undefined') {\n      this.currentFilter = dump.filter;\n    }\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow) {\n    return isCategoryIncluded(this.currentFilter, this.getCategory(row));\n  }\n\n  getFilter() {\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(filter: boolean | null | ICategoricalFilter) {\n    const f: ICategoricalFilter | null =\n      typeof filter === 'boolean'\n        ? { filter: [this.getCategoryOfBoolean(filter)!.name], filterMissing: false }\n        : filter;\n    if (isEqualCategoricalFilter(this.currentFilter, f)) {\n      return;\n    }\n    this.fire(\n      [BooleanColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.currentFilter,\n      (this.currentFilter = f)\n    );\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row);\n    if (v == null) {\n      return NaN;\n    }\n    return v ? 1 : 0;\n  }\n\n  toCompareValueType(): ECompareValueType {\n    return ECompareValueType.BINARY;\n  }\n\n  group(row: IDataRow) {\n    const v = this.getValue(row);\n    if (v == null) {\n      return Object.assign({}, missingGroup);\n    }\n    return Object.assign({}, v ? BooleanColumn.GROUP_TRUE : BooleanColumn.GROUP_FALSE);\n  }\n}\n","import { Category } from './annotations';\nimport ValueColumn from './ValueColumn';\nimport { empty } from '../internal';\nimport type { IArrayColumn, IArrayDesc } from './IArrayColumn';\nimport type { IDataRow, IValueColumnDesc } from './interfaces';\n\nexport interface IArrayColumnDesc<T> extends IArrayDesc, IValueColumnDesc<T[]> {\n  // dummy\n}\n\n@Category('array')\nexport default class ArrayColumn<T> extends ValueColumn<T[]> implements IArrayColumn<T> {\n  private readonly _dataLength: number | null;\n\n  private readonly originalLabels: string[];\n\n  constructor(id: string, desc: Readonly<IArrayColumnDesc<T>>) {\n    super(id, desc);\n    this._dataLength = desc.dataLength == null || Number.isNaN(desc.dataLength) ? null : desc.dataLength;\n    this.originalLabels =\n      desc.labels || empty(this._dataLength == null ? 0 : this._dataLength).map((_d, i) => `Column ${i}`);\n  }\n\n  get labels() {\n    return this.originalLabels;\n  }\n\n  get dataLength() {\n    return this._dataLength;\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getValues(row);\n    return r.every((d) => d === null) ? null : r;\n  }\n\n  getValues(row: IDataRow) {\n    const r = super.getValue(row);\n    return r == null ? [] : r;\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getValues(row).map(String);\n  }\n\n  getLabel(row: IDataRow): string {\n    const v = this.getLabels(row);\n    if (v.length === 0) {\n      return '';\n    }\n    return v.toString();\n  }\n\n  getMap(row: IDataRow) {\n    const labels = this.labels;\n    return this.getValues(row).map((value, i) => ({ key: labels[i], value }));\n  }\n\n  getMapLabel(row: IDataRow) {\n    const labels = this.labels;\n    return this.getLabels(row).map((value, i) => ({ key: labels[i], value }));\n  }\n}\n","import ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type { ISetColumn, ICategoricalColorMappingFunction } from './ICategoricalColumn';\nimport type { IDataRow, ITypeFactory, ECompareValueType } from './interfaces';\nimport CategoricalColumn from './CategoricalColumn';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport type ValueColumn from './ValueColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport {\n  DEFAULT_COLOR,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { IEventListener } from '../internal';\nimport { chooseUIntByDataLength, integrateDefaults } from './internal';\nimport { toCategory } from './internalCategorical';\nimport { toolbar } from './annotations';\n\nexport declare type IBooleansColumnDesc = IArrayColumnDesc<boolean>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf BooleansColumn\n * @event\n */\nexport declare function colorMappingChanged_BCS(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy')\nexport default class BooleansColumn extends ArrayColumn<boolean> implements ISetColumn {\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<IBooleansColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'upset',\n      })\n    );\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  get categories() {\n    return this.labels.map((d, i) => toCategory(d, i));\n  }\n\n  getSet(row: IDataRow) {\n    const vs = this.getValues(row);\n    return new Set(this.categories.filter((_, i) => vs[i]));\n  }\n\n  toCompareValue(row: IDataRow) {\n    const v = this.getValue(row);\n    if (v == null) {\n      return NaN;\n    }\n    return v.reduce((a, b) => a + (b ? 1 : 0), 0);\n  }\n\n  toCompareValueType(): ECompareValueType {\n    return chooseUIntByDataLength(this.dataLength);\n  }\n\n  getCategories(row: IDataRow) {\n    const categories = this.categories;\n    return super.getValues(row).map((v, i) => {\n      return v ? categories[i]! : null;\n    });\n  }\n\n  iterCategory(row: IDataRow) {\n    return this.getCategories(row);\n  }\n\n  getColors(row: IDataRow) {\n    return this.getCategories(row).map((d) => (d ? this.colorMapping.apply(d) : DEFAULT_COLOR));\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([BooleansColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(type: typeof BooleansColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n  }\n}\n","export default function(x) {\n  return Math.abs(x = Math.round(x)) >= 1e21\n      ? x.toLocaleString(\"en\").replace(/,/g, \"\")\n      : x.toString(10);\n}\n\n// Computes the decimal coefficient and exponent of the specified number x with\n// significant digits p, where x is positive and p is in [1, 21] or undefined.\n// For example, formatDecimalParts(1.23) returns [\"123\", 0].\nexport function formatDecimalParts(x, p) {\n  if ((i = (x = p ? x.toExponential(p - 1) : x.toExponential()).indexOf(\"e\")) < 0) return null; // NaN, ±Infinity\n  var i, coefficient = x.slice(0, i);\n\n  // The string returned by toExponential either has the form \\d\\.\\d+e[-+]\\d+\n  // (e.g., 1.2e+3) or the form \\de[-+]\\d+ (e.g., 1e+3).\n  return [\n    coefficient.length > 1 ? coefficient[0] + coefficient.slice(2) : coefficient,\n    +x.slice(i + 1)\n  ];\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x) {\n  return x = formatDecimalParts(Math.abs(x)), x ? x[1] : NaN;\n}\n","// [[fill]align][sign][symbol][0][width][,][.precision][~][type]\nvar re = /^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;\n\nexport default function formatSpecifier(specifier) {\n  if (!(match = re.exec(specifier))) throw new Error(\"invalid format: \" + specifier);\n  var match;\n  return new FormatSpecifier({\n    fill: match[1],\n    align: match[2],\n    sign: match[3],\n    symbol: match[4],\n    zero: match[5],\n    width: match[6],\n    comma: match[7],\n    precision: match[8] && match[8].slice(1),\n    trim: match[9],\n    type: match[10]\n  });\n}\n\nformatSpecifier.prototype = FormatSpecifier.prototype; // instanceof\n\nexport function FormatSpecifier(specifier) {\n  this.fill = specifier.fill === undefined ? \" \" : specifier.fill + \"\";\n  this.align = specifier.align === undefined ? \">\" : specifier.align + \"\";\n  this.sign = specifier.sign === undefined ? \"-\" : specifier.sign + \"\";\n  this.symbol = specifier.symbol === undefined ? \"\" : specifier.symbol + \"\";\n  this.zero = !!specifier.zero;\n  this.width = specifier.width === undefined ? undefined : +specifier.width;\n  this.comma = !!specifier.comma;\n  this.precision = specifier.precision === undefined ? undefined : +specifier.precision;\n  this.trim = !!specifier.trim;\n  this.type = specifier.type === undefined ? \"\" : specifier.type + \"\";\n}\n\nFormatSpecifier.prototype.toString = function() {\n  return this.fill\n      + this.align\n      + this.sign\n      + this.symbol\n      + (this.zero ? \"0\" : \"\")\n      + (this.width === undefined ? \"\" : Math.max(1, this.width | 0))\n      + (this.comma ? \",\" : \"\")\n      + (this.precision === undefined ? \"\" : \".\" + Math.max(0, this.precision | 0))\n      + (this.trim ? \"~\" : \"\")\n      + this.type;\n};\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport var prefixExponent;\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1],\n      i = exponent - (prefixExponent = Math.max(-8, Math.min(8, Math.floor(exponent / 3))) * 3) + 1,\n      n = coefficient.length;\n  return i === n ? coefficient\n      : i > n ? coefficient + new Array(i - n + 1).join(\"0\")\n      : i > 0 ? coefficient.slice(0, i) + \".\" + coefficient.slice(i)\n      : \"0.\" + new Array(1 - i).join(\"0\") + formatDecimalParts(x, Math.max(0, p + i - 1))[0]; // less than 1y!\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1];\n  return exponent < 0 ? \"0.\" + new Array(-exponent).join(\"0\") + coefficient\n      : coefficient.length > exponent + 1 ? coefficient.slice(0, exponent + 1) + \".\" + coefficient.slice(exponent + 1)\n      : coefficient + new Array(exponent - coefficient.length + 2).join(\"0\");\n}\n","import formatDecimal from \"./formatDecimal.js\";\nimport formatPrefixAuto from \"./formatPrefixAuto.js\";\nimport formatRounded from \"./formatRounded.js\";\n\nexport default {\n  \"%\": (x, p) => (x * 100).toFixed(p),\n  \"b\": (x) => Math.round(x).toString(2),\n  \"c\": (x) => x + \"\",\n  \"d\": formatDecimal,\n  \"e\": (x, p) => x.toExponential(p),\n  \"f\": (x, p) => x.toFixed(p),\n  \"g\": (x, p) => x.toPrecision(p),\n  \"o\": (x) => Math.round(x).toString(8),\n  \"p\": (x, p) => formatRounded(x * 100, p),\n  \"r\": formatRounded,\n  \"s\": formatPrefixAuto,\n  \"X\": (x) => Math.round(x).toString(16).toUpperCase(),\n  \"x\": (x) => Math.round(x).toString(16)\n};\n","export default function(x) {\n  return x;\n}\n","import exponent from \"./exponent.js\";\nimport formatGroup from \"./formatGroup.js\";\nimport formatNumerals from \"./formatNumerals.js\";\nimport formatSpecifier from \"./formatSpecifier.js\";\nimport formatTrim from \"./formatTrim.js\";\nimport formatTypes from \"./formatTypes.js\";\nimport {prefixExponent} from \"./formatPrefixAuto.js\";\nimport identity from \"./identity.js\";\n\nvar map = Array.prototype.map,\n    prefixes = [\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"µ\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"];\n\nexport default function(locale) {\n  var group = locale.grouping === undefined || locale.thousands === undefined ? identity : formatGroup(map.call(locale.grouping, Number), locale.thousands + \"\"),\n      currencyPrefix = locale.currency === undefined ? \"\" : locale.currency[0] + \"\",\n      currencySuffix = locale.currency === undefined ? \"\" : locale.currency[1] + \"\",\n      decimal = locale.decimal === undefined ? \".\" : locale.decimal + \"\",\n      numerals = locale.numerals === undefined ? identity : formatNumerals(map.call(locale.numerals, String)),\n      percent = locale.percent === undefined ? \"%\" : locale.percent + \"\",\n      minus = locale.minus === undefined ? \"−\" : locale.minus + \"\",\n      nan = locale.nan === undefined ? \"NaN\" : locale.nan + \"\";\n\n  function newFormat(specifier) {\n    specifier = formatSpecifier(specifier);\n\n    var fill = specifier.fill,\n        align = specifier.align,\n        sign = specifier.sign,\n        symbol = specifier.symbol,\n        zero = specifier.zero,\n        width = specifier.width,\n        comma = specifier.comma,\n        precision = specifier.precision,\n        trim = specifier.trim,\n        type = specifier.type;\n\n    // The \"n\" type is an alias for \",g\".\n    if (type === \"n\") comma = true, type = \"g\";\n\n    // The \"\" type, and any invalid type, is an alias for \".12~g\".\n    else if (!formatTypes[type]) precision === undefined && (precision = 12), trim = true, type = \"g\";\n\n    // If zero fill is specified, padding goes after sign and before digits.\n    if (zero || (fill === \"0\" && align === \"=\")) zero = true, fill = \"0\", align = \"=\";\n\n    // Compute the prefix and suffix.\n    // For SI-prefix, the suffix is lazily computed.\n    var prefix = symbol === \"$\" ? currencyPrefix : symbol === \"#\" && /[boxX]/.test(type) ? \"0\" + type.toLowerCase() : \"\",\n        suffix = symbol === \"$\" ? currencySuffix : /[%p]/.test(type) ? percent : \"\";\n\n    // What format function should we use?\n    // Is this an integer type?\n    // Can this type generate exponential notation?\n    var formatType = formatTypes[type],\n        maybeSuffix = /[defgprs%]/.test(type);\n\n    // Set the default precision if not specified,\n    // or clamp the specified precision to the supported range.\n    // For significant precision, it must be in [1, 21].\n    // For fixed precision, it must be in [0, 20].\n    precision = precision === undefined ? 6\n        : /[gprs]/.test(type) ? Math.max(1, Math.min(21, precision))\n        : Math.max(0, Math.min(20, precision));\n\n    function format(value) {\n      var valuePrefix = prefix,\n          valueSuffix = suffix,\n          i, n, c;\n\n      if (type === \"c\") {\n        valueSuffix = formatType(value) + valueSuffix;\n        value = \"\";\n      } else {\n        value = +value;\n\n        // Determine the sign. -0 is not less than 0, but 1 / -0 is!\n        var valueNegative = value < 0 || 1 / value < 0;\n\n        // Perform the initial formatting.\n        value = isNaN(value) ? nan : formatType(Math.abs(value), precision);\n\n        // Trim insignificant zeros.\n        if (trim) value = formatTrim(value);\n\n        // If a negative value rounds to zero after formatting, and no explicit positive sign is requested, hide the sign.\n        if (valueNegative && +value === 0 && sign !== \"+\") valueNegative = false;\n\n        // Compute the prefix and suffix.\n        valuePrefix = (valueNegative ? (sign === \"(\" ? sign : minus) : sign === \"-\" || sign === \"(\" ? \"\" : sign) + valuePrefix;\n        valueSuffix = (type === \"s\" ? prefixes[8 + prefixExponent / 3] : \"\") + valueSuffix + (valueNegative && sign === \"(\" ? \")\" : \"\");\n\n        // Break the formatted value into the integer “value” part that can be\n        // grouped, and fractional or exponential “suffix” part that is not.\n        if (maybeSuffix) {\n          i = -1, n = value.length;\n          while (++i < n) {\n            if (c = value.charCodeAt(i), 48 > c || c > 57) {\n              valueSuffix = (c === 46 ? decimal + value.slice(i + 1) : value.slice(i)) + valueSuffix;\n              value = value.slice(0, i);\n              break;\n            }\n          }\n        }\n      }\n\n      // If the fill character is not \"0\", grouping is applied before padding.\n      if (comma && !zero) value = group(value, Infinity);\n\n      // Compute the padding.\n      var length = valuePrefix.length + value.length + valueSuffix.length,\n          padding = length < width ? new Array(width - length + 1).join(fill) : \"\";\n\n      // If the fill character is \"0\", grouping is applied after padding.\n      if (comma && zero) value = group(padding + value, padding.length ? width - valueSuffix.length : Infinity), padding = \"\";\n\n      // Reconstruct the final output based on the desired alignment.\n      switch (align) {\n        case \"<\": value = valuePrefix + value + valueSuffix + padding; break;\n        case \"=\": value = valuePrefix + padding + value + valueSuffix; break;\n        case \"^\": value = padding.slice(0, length = padding.length >> 1) + valuePrefix + value + valueSuffix + padding.slice(length); break;\n        default: value = padding + valuePrefix + value + valueSuffix; break;\n      }\n\n      return numerals(value);\n    }\n\n    format.toString = function() {\n      return specifier + \"\";\n    };\n\n    return format;\n  }\n\n  function formatPrefix(specifier, value) {\n    var f = newFormat((specifier = formatSpecifier(specifier), specifier.type = \"f\", specifier)),\n        e = Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3,\n        k = Math.pow(10, -e),\n        prefix = prefixes[8 + e / 3];\n    return function(value) {\n      return f(k * value) + prefix;\n    };\n  }\n\n  return {\n    format: newFormat,\n    formatPrefix: formatPrefix\n  };\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var format;\nexport var formatPrefix;\n\ndefaultLocale({\n  thousands: \",\",\n  grouping: [3],\n  currency: [\"$\", \"\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  format = locale.format;\n  formatPrefix = locale.formatPrefix;\n  return locale;\n}\n","export default function(grouping, thousands) {\n  return function(value, width) {\n    var i = value.length,\n        t = [],\n        j = 0,\n        g = grouping[0],\n        length = 0;\n\n    while (i > 0 && g > 0) {\n      if (length + g + 1 > width) g = Math.max(1, width - length);\n      t.push(value.substring(i -= g, i + g));\n      if ((length += g + 1) > width) break;\n      g = grouping[j = (j + 1) % grouping.length];\n    }\n\n    return t.reverse().join(thousands);\n  };\n}\n","export default function(numerals) {\n  return function(value) {\n    return value.replace(/[0-9]/g, function(i) {\n      return numerals[+i];\n    });\n  };\n}\n","// Trims insignificant zeros, e.g., replaces 1.2000k with 1.2k.\nexport default function(s) {\n  out: for (var n = s.length, i = 1, i0 = -1, i1; i < n; ++i) {\n    switch (s[i]) {\n      case \".\": i0 = i1 = i; break;\n      case \"0\": if (i0 === 0) i0 = i; i1 = i; break;\n      default: if (!+s[i]) break out; if (i0 > 0) i0 = 0; break;\n    }\n  }\n  return i0 > 0 ? s.slice(0, i0) + s.slice(i1 + 1) : s;\n}\n","var e10 = Math.sqrt(50),\n    e5 = Math.sqrt(10),\n    e2 = Math.sqrt(2);\n\nexport default function(start, stop, count) {\n  var reverse,\n      i = -1,\n      n,\n      ticks,\n      step;\n\n  stop = +stop, start = +start, count = +count;\n  if (start === stop && count > 0) return [start];\n  if (reverse = stop < start) n = start, start = stop, stop = n;\n  if ((step = tickIncrement(start, stop, count)) === 0 || !isFinite(step)) return [];\n\n  if (step > 0) {\n    let r0 = Math.round(start / step), r1 = Math.round(stop / step);\n    if (r0 * step < start) ++r0;\n    if (r1 * step > stop) --r1;\n    ticks = new Array(n = r1 - r0 + 1);\n    while (++i < n) ticks[i] = (r0 + i) * step;\n  } else {\n    step = -step;\n    let r0 = Math.round(start * step), r1 = Math.round(stop * step);\n    if (r0 / step < start) ++r0;\n    if (r1 / step > stop) --r1;\n    ticks = new Array(n = r1 - r0 + 1);\n    while (++i < n) ticks[i] = (r0 + i) / step;\n  }\n\n  if (reverse) ticks.reverse();\n\n  return ticks;\n}\n\nexport function tickIncrement(start, stop, count) {\n  var step = (stop - start) / Math.max(0, count),\n      power = Math.floor(Math.log(step) / Math.LN10),\n      error = step / Math.pow(10, power);\n  return power >= 0\n      ? (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1) * Math.pow(10, power)\n      : -Math.pow(10, -power) / (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1);\n}\n\nexport function tickStep(start, stop, count) {\n  var step0 = Math.abs(stop - start) / Math.max(0, count),\n      step1 = Math.pow(10, Math.floor(Math.log(step0) / Math.LN10)),\n      error = step0 / step1;\n  if (error >= e10) step1 *= 10;\n  else if (error >= e5) step1 *= 5;\n  else if (error >= e2) step1 *= 2;\n  return stop < start ? -step1 : step1;\n}\n","export default function(a, b) {\n  return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","import ascending from \"./ascending.js\";\n\nexport default function(f) {\n  let delta = f;\n  let compare = f;\n\n  if (f.length === 1) {\n    delta = (d, x) => f(d) - x;\n    compare = ascendingComparator(f);\n  }\n\n  function left(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    while (lo < hi) {\n      const mid = (lo + hi) >>> 1;\n      if (compare(a[mid], x) < 0) lo = mid + 1;\n      else hi = mid;\n    }\n    return lo;\n  }\n\n  function right(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    while (lo < hi) {\n      const mid = (lo + hi) >>> 1;\n      if (compare(a[mid], x) > 0) hi = mid;\n      else lo = mid + 1;\n    }\n    return lo;\n  }\n\n  function center(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    const i = left(a, x, lo, hi - 1);\n    return i > lo && delta(a[i - 1], x) > -delta(a[i], x) ? i - 1 : i;\n  }\n\n  return {left, center, right};\n}\n\nfunction ascendingComparator(f) {\n  return (d, x) => ascending(f(d), x);\n}\n","import ascending from \"./ascending.js\";\nimport bisector from \"./bisector.js\";\nimport number from \"./number.js\";\n\nconst ascendingBisect = bisector(ascending);\nexport const bisectRight = ascendingBisect.right;\nexport const bisectLeft = ascendingBisect.left;\nexport const bisectCenter = bisector(number).center;\nexport default bisectRight;\n","export default function(x) {\n  return x === null ? NaN : +x;\n}\n\nexport function* numbers(values, valueof) {\n  if (valueof === undefined) {\n    for (let value of values) {\n      if (value != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  }\n}\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy: function(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return \"#\" + hex(this.r) + hex(this.g) + hex(this.b);\n}\n\nfunction rgb_formatRgb() {\n  var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n  return (a === 1 ? \"rgb(\" : \"rgba(\")\n      + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n      + (a === 1 ? \")\" : \", \" + a + \")\");\n}\n\nfunction hex(value) {\n  value = Math.max(0, Math.min(255, Math.round(value) || 0));\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"hsl(\" : \"hsla(\")\n        + (this.h || 0) + \", \"\n        + (this.s || 0) * 100 + \"%, \"\n        + (this.l || 0) * 100 + \"%\"\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export function basis(t1, v0, v1, v2, v3) {\n  var t2 = t1 * t1, t3 = t2 * t1;\n  return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n      + (4 - 6 * t2 + 3 * t3) * v1\n      + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n      + t3 * v3) / 6;\n}\n\nexport default function(values) {\n  var n = values.length - 1;\n  return function(t) {\n    var i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n),\n        v1 = values[i],\n        v2 = values[i + 1],\n        v0 = i > 0 ? values[i - 1] : 2 * v1 - v2,\n        v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","import value from \"./value.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  return (isNumberArray(b) ? numberArray : genericArray)(a, b);\n}\n\nexport function genericArray(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b = +b, function(t) {\n    return d.setTime(a * (1 - t) + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import value from \"./value.js\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import {basis} from \"./basis.js\";\n\nexport default function(values) {\n  var n = values.length;\n  return function(t) {\n    var i = Math.floor(((t %= 1) < 0 ? ++t : t) * n),\n        v0 = values[(i + n - 1) % n],\n        v1 = values[i % n],\n        v2 = values[(i + 1) % n],\n        v3 = values[(i + 2) % n];\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","export default function(a, b) {\n  if (!b) b = [];\n  var n = a ? Math.min(b.length, a.length) : 0,\n      c = b.slice(),\n      i;\n  return function(t) {\n    for (i = 0; i < n; ++i) c[i] = a[i] * (1 - t) + b[i] * t;\n    return c;\n  };\n}\n\nexport function isNumberArray(x) {\n  return ArrayBuffer.isView(x) && !(x instanceof DataView);\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb.js\";\nimport {genericArray} from \"./array.js\";\nimport date from \"./date.js\";\nimport number from \"./number.js\";\nimport object from \"./object.js\";\nimport string from \"./string.js\";\nimport constant from \"./constant.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : isNumberArray(b) ? numberArray\n      : Array.isArray(b) ? genericArray\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return Math.round(a * (1 - t) + b * t);\n  };\n}\n","export default function number(x) {\n  return +x;\n}\n","import {bisect} from \"d3-array\";\nimport {interpolate as interpolateValue, interpolateNumber, interpolateRound} from \"d3-interpolate\";\nimport constant from \"./constant.js\";\nimport number from \"./number.js\";\n\nvar unit = [0, 1];\n\nexport function identity(x) {\n  return x;\n}\n\nfunction normalize(a, b) {\n  return (b -= (a = +a))\n      ? function(x) { return (x - a) / b; }\n      : constant(isNaN(b) ? NaN : 0.5);\n}\n\nfunction clamper(a, b) {\n  var t;\n  if (a > b) t = a, a = b, b = t;\n  return function(x) { return Math.max(a, Math.min(b, x)); };\n}\n\n// normalize(a, b)(x) takes a domain value x in [a,b] and returns the corresponding parameter t in [0,1].\n// interpolate(a, b)(t) takes a parameter t in [0,1] and returns the corresponding range value x in [a,b].\nfunction bimap(domain, range, interpolate) {\n  var d0 = domain[0], d1 = domain[1], r0 = range[0], r1 = range[1];\n  if (d1 < d0) d0 = normalize(d1, d0), r0 = interpolate(r1, r0);\n  else d0 = normalize(d0, d1), r0 = interpolate(r0, r1);\n  return function(x) { return r0(d0(x)); };\n}\n\nfunction polymap(domain, range, interpolate) {\n  var j = Math.min(domain.length, range.length) - 1,\n      d = new Array(j),\n      r = new Array(j),\n      i = -1;\n\n  // Reverse descending domains.\n  if (domain[j] < domain[0]) {\n    domain = domain.slice().reverse();\n    range = range.slice().reverse();\n  }\n\n  while (++i < j) {\n    d[i] = normalize(domain[i], domain[i + 1]);\n    r[i] = interpolate(range[i], range[i + 1]);\n  }\n\n  return function(x) {\n    var i = bisect(domain, x, 1, j) - 1;\n    return r[i](d[i](x));\n  };\n}\n\nexport function copy(source, target) {\n  return target\n      .domain(source.domain())\n      .range(source.range())\n      .interpolate(source.interpolate())\n      .clamp(source.clamp())\n      .unknown(source.unknown());\n}\n\nexport function transformer() {\n  var domain = unit,\n      range = unit,\n      interpolate = interpolateValue,\n      transform,\n      untransform,\n      unknown,\n      clamp = identity,\n      piecewise,\n      output,\n      input;\n\n  function rescale() {\n    var n = Math.min(domain.length, range.length);\n    if (clamp !== identity) clamp = clamper(domain[0], domain[n - 1]);\n    piecewise = n > 2 ? polymap : bimap;\n    output = input = null;\n    return scale;\n  }\n\n  function scale(x) {\n    return x == null || isNaN(x = +x) ? unknown : (output || (output = piecewise(domain.map(transform), range, interpolate)))(transform(clamp(x)));\n  }\n\n  scale.invert = function(y) {\n    return clamp(untransform((input || (input = piecewise(range, domain.map(transform), interpolateNumber)))(y)));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain = Array.from(_, number), rescale()) : domain.slice();\n  };\n\n  scale.range = function(_) {\n    return arguments.length ? (range = Array.from(_), rescale()) : range.slice();\n  };\n\n  scale.rangeRound = function(_) {\n    return range = Array.from(_), interpolate = interpolateRound, rescale();\n  };\n\n  scale.clamp = function(_) {\n    return arguments.length ? (clamp = _ ? true : identity, rescale()) : clamp !== identity;\n  };\n\n  scale.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, rescale()) : interpolate;\n  };\n\n  scale.unknown = function(_) {\n    return arguments.length ? (unknown = _, scale) : unknown;\n  };\n\n  return function(t, u) {\n    transform = t, untransform = u;\n    return rescale();\n  };\n}\n\nexport default function continuous() {\n  return transformer()(identity, identity);\n}\n","export default function constants(x) {\n  return function() {\n    return x;\n  };\n}\n","export function initRange(domain, range) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.range(domain); break;\n    default: this.range(range).domain(domain); break;\n  }\n  return this;\n}\n\nexport function initInterpolator(domain, interpolator) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: {\n      if (typeof domain === \"function\") this.interpolator(domain);\n      else this.range(domain);\n      break;\n    }\n    default: {\n      this.domain(domain);\n      if (typeof interpolator === \"function\") this.interpolator(interpolator);\n      else this.range(interpolator);\n      break;\n    }\n  }\n  return this;\n}\n","import {ticks} from \"d3-array\";\nimport {format} from \"d3-format\";\nimport nice from \"./nice.js\";\nimport {copy, transformer} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\n\nfunction transformLog(x) {\n  return Math.log(x);\n}\n\nfunction transformExp(x) {\n  return Math.exp(x);\n}\n\nfunction transformLogn(x) {\n  return -Math.log(-x);\n}\n\nfunction transformExpn(x) {\n  return -Math.exp(-x);\n}\n\nfunction pow10(x) {\n  return isFinite(x) ? +(\"1e\" + x) : x < 0 ? 0 : x;\n}\n\nfunction powp(base) {\n  return base === 10 ? pow10\n      : base === Math.E ? Math.exp\n      : function(x) { return Math.pow(base, x); };\n}\n\nfunction logp(base) {\n  return base === Math.E ? Math.log\n      : base === 10 && Math.log10\n      || base === 2 && Math.log2\n      || (base = Math.log(base), function(x) { return Math.log(x) / base; });\n}\n\nfunction reflect(f) {\n  return function(x) {\n    return -f(-x);\n  };\n}\n\nexport function loggish(transform) {\n  var scale = transform(transformLog, transformExp),\n      domain = scale.domain,\n      base = 10,\n      logs,\n      pows;\n\n  function rescale() {\n    logs = logp(base), pows = powp(base);\n    if (domain()[0] < 0) {\n      logs = reflect(logs), pows = reflect(pows);\n      transform(transformLogn, transformExpn);\n    } else {\n      transform(transformLog, transformExp);\n    }\n    return scale;\n  }\n\n  scale.base = function(_) {\n    return arguments.length ? (base = +_, rescale()) : base;\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain(_), rescale()) : domain();\n  };\n\n  scale.ticks = function(count) {\n    var d = domain(),\n        u = d[0],\n        v = d[d.length - 1],\n        r;\n\n    if (r = v < u) i = u, u = v, v = i;\n\n    var i = logs(u),\n        j = logs(v),\n        p,\n        k,\n        t,\n        n = count == null ? 10 : +count,\n        z = [];\n\n    if (!(base % 1) && j - i < n) {\n      i = Math.floor(i), j = Math.ceil(j);\n      if (u > 0) for (; i <= j; ++i) {\n        for (k = 1, p = pows(i); k < base; ++k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      } else for (; i <= j; ++i) {\n        for (k = base - 1, p = pows(i); k >= 1; --k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      }\n      if (z.length * 2 < n) z = ticks(u, v, n);\n    } else {\n      z = ticks(i, j, Math.min(j - i, n)).map(pows);\n    }\n\n    return r ? z.reverse() : z;\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    if (specifier == null) specifier = base === 10 ? \".0e\" : \",\";\n    if (typeof specifier !== \"function\") specifier = format(specifier);\n    if (count === Infinity) return specifier;\n    if (count == null) count = 10;\n    var k = Math.max(1, base * count / scale.ticks().length); // TODO fast estimate?\n    return function(d) {\n      var i = d / pows(Math.round(logs(d)));\n      if (i * base < base - 0.5) i *= base;\n      return i <= k ? specifier(d) : \"\";\n    };\n  };\n\n  scale.nice = function() {\n    return domain(nice(domain(), {\n      floor: function(x) { return pows(Math.floor(logs(x))); },\n      ceil: function(x) { return pows(Math.ceil(logs(x))); }\n    }));\n  };\n\n  return scale;\n}\n\nexport default function log() {\n  var scale = loggish(transformer()).domain([1, 10]);\n\n  scale.copy = function() {\n    return copy(scale, log()).base(scale.base());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n","export default function nice(domain, interval) {\n  domain = domain.slice();\n\n  var i0 = 0,\n      i1 = domain.length - 1,\n      x0 = domain[i0],\n      x1 = domain[i1],\n      t;\n\n  if (x1 < x0) {\n    t = i0, i0 = i1, i1 = t;\n    t = x0, x0 = x1, x1 = t;\n  }\n\n  domain[i0] = interval.floor(x0);\n  domain[i1] = interval.ceil(x1);\n  return domain;\n}\n","import {ticks, tickIncrement} from \"d3-array\";\nimport continuous, {copy} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\nimport tickFormat from \"./tickFormat.js\";\n\nexport function linearish(scale) {\n  var domain = scale.domain;\n\n  scale.ticks = function(count) {\n    var d = domain();\n    return ticks(d[0], d[d.length - 1], count == null ? 10 : count);\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    var d = domain();\n    return tickFormat(d[0], d[d.length - 1], count == null ? 10 : count, specifier);\n  };\n\n  scale.nice = function(count) {\n    if (count == null) count = 10;\n\n    var d = domain();\n    var i0 = 0;\n    var i1 = d.length - 1;\n    var start = d[i0];\n    var stop = d[i1];\n    var prestep;\n    var step;\n    var maxIter = 10;\n\n    if (stop < start) {\n      step = start, start = stop, stop = step;\n      step = i0, i0 = i1, i1 = step;\n    }\n    \n    while (maxIter-- > 0) {\n      step = tickIncrement(start, stop, count);\n      if (step === prestep) {\n        d[i0] = start\n        d[i1] = stop\n        return domain(d);\n      } else if (step > 0) {\n        start = Math.floor(start / step) * step;\n        stop = Math.ceil(stop / step) * step;\n      } else if (step < 0) {\n        start = Math.ceil(start * step) / step;\n        stop = Math.floor(stop * step) / step;\n      } else {\n        break;\n      }\n      prestep = step;\n    }\n\n    return scale;\n  };\n\n  return scale;\n}\n\nexport default function linear() {\n  var scale = continuous();\n\n  scale.copy = function() {\n    return copy(scale, linear());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return linearish(scale);\n}\n","import {tickStep} from \"d3-array\";\nimport {format, formatPrefix, formatSpecifier, precisionFixed, precisionPrefix, precisionRound} from \"d3-format\";\n\nexport default function tickFormat(start, stop, count, specifier) {\n  var step = tickStep(start, stop, count),\n      precision;\n  specifier = formatSpecifier(specifier == null ? \",f\" : specifier);\n  switch (specifier.type) {\n    case \"s\": {\n      var value = Math.max(Math.abs(start), Math.abs(stop));\n      if (specifier.precision == null && !isNaN(precision = precisionPrefix(step, value))) specifier.precision = precision;\n      return formatPrefix(specifier, value);\n    }\n    case \"\":\n    case \"e\":\n    case \"g\":\n    case \"p\":\n    case \"r\": {\n      if (specifier.precision == null && !isNaN(precision = precisionRound(step, Math.max(Math.abs(start), Math.abs(stop))))) specifier.precision = precision - (specifier.type === \"e\");\n      break;\n    }\n    case \"f\":\n    case \"%\": {\n      if (specifier.precision == null && !isNaN(precision = precisionFixed(step))) specifier.precision = precision - (specifier.type === \"%\") * 2;\n      break;\n    }\n  }\n  return format(specifier);\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, value) {\n  return Math.max(0, Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3 - exponent(Math.abs(step)));\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, max) {\n  step = Math.abs(step), max = Math.abs(max) - step;\n  return Math.max(0, exponent(max) - exponent(step)) + 1;\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step) {\n  return Math.max(0, -exponent(Math.abs(step)));\n}\n","import {linearish} from \"./linear.js\";\nimport {copy, identity, transformer} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\n\nfunction transformPow(exponent) {\n  return function(x) {\n    return x < 0 ? -Math.pow(-x, exponent) : Math.pow(x, exponent);\n  };\n}\n\nfunction transformSqrt(x) {\n  return x < 0 ? -Math.sqrt(-x) : Math.sqrt(x);\n}\n\nfunction transformSquare(x) {\n  return x < 0 ? -x * x : x * x;\n}\n\nexport function powish(transform) {\n  var scale = transform(identity, identity),\n      exponent = 1;\n\n  function rescale() {\n    return exponent === 1 ? transform(identity, identity)\n        : exponent === 0.5 ? transform(transformSqrt, transformSquare)\n        : transform(transformPow(exponent), transformPow(1 / exponent));\n  }\n\n  scale.exponent = function(_) {\n    return arguments.length ? (exponent = +_, rescale()) : exponent;\n  };\n\n  return linearish(scale);\n}\n\nexport default function pow() {\n  var scale = powish(transformer());\n\n  scale.copy = function() {\n    return copy(scale, pow()).exponent(scale.exponent());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n\nexport function sqrt() {\n  return pow.apply(null, arguments).exponent(0.5);\n}\n","import { scaleLinear, scaleLog, scalePow, scaleSqrt } from 'd3-scale';\nimport { similar } from '../internal';\nimport type { ITypeFactory, ITypedDump } from './interfaces';\nimport type { IMappingFunction, IMapAbleDesc, IMappingFunctionConstructor } from './INumberColumn';\n\n/**\n * interface of a d3 scale\n */\nexport interface IScale {\n  (v: number): number;\n\n  invert(r: number): number;\n\n  domain(): number[];\n\n  domain(domain: number[]): this;\n\n  range(): number[];\n\n  range(range: number[]): this;\n}\n\nfunction toScale(type = 'linear'): IScale {\n  switch (type) {\n    case 'log':\n      return scaleLog().clamp(true);\n    case 'sqrt':\n      return scaleSqrt().clamp(true);\n    case 'pow1.1':\n      return scalePow().exponent(1.1).clamp(true);\n    case 'pow2':\n      return scalePow().exponent(2).clamp(true);\n    case 'pow3':\n      return scalePow().exponent(3).clamp(true);\n    default:\n      return scaleLinear().clamp(true);\n  }\n}\n\nfunction isSame(a: number[], b: number[]) {\n  if (a.length !== b.length) {\n    return false;\n  }\n  return a.every((ai, i) => similar(ai, b[i], 0.0001));\n}\n\nfunction fixDomain(domain: number[], type: string) {\n  if (type === 'log' && domain[0] === 0) {\n    domain[0] = 0.0000001; //0 is bad\n  }\n  return domain;\n}\n\n/**\n * a mapping function based on a d3 scale (linear, sqrt, log)\n */\nexport class ScaleMappingFunction implements IMappingFunction {\n  private s: IScale;\n  private readonly type: string;\n\n  constructor();\n  constructor(dump: ITypedDump);\n  constructor(domain: number[], type: string, range: number[]);\n  constructor(domain: ITypedDump | number[] = [0, 1], type = 'linear', range: number[] = [0, 1]) {\n    if (!domain || Array.isArray(domain)) {\n      this.type = type;\n      this.s = toScale(type)\n        .domain(fixDomain((domain as number[]) ?? [0, 1], this.type))\n        .range(range);\n    } else {\n      const dump = domain;\n      this.type = dump.type;\n      this.s = toScale(dump.type).domain(dump.domain).range(dump.range);\n    }\n  }\n\n  get domain() {\n    return this.s.domain();\n  }\n\n  set domain(domain: number[]) {\n    this.s.domain(fixDomain(domain, this.type));\n  }\n\n  get range() {\n    return this.s.range();\n  }\n\n  set range(range: number[]) {\n    this.s.range(range);\n  }\n\n  getRange(format: (v: number) => string): [string, string] {\n    return [format(this.invert(0)), format(this.invert(1))];\n  }\n\n  apply(v: number): number {\n    return this.s(v);\n  }\n\n  invert(r: number) {\n    return this.s.invert(r);\n  }\n\n  get scaleType() {\n    return this.type;\n  }\n\n  toJSON() {\n    return {\n      type: this.type,\n      domain: this.domain,\n      range: this.range,\n    };\n  }\n\n  eq(other: IMappingFunction): boolean {\n    if (!(other instanceof ScaleMappingFunction)) {\n      return false;\n    }\n    const that = other as ScaleMappingFunction;\n    return that.type === this.type && isSame(this.domain, that.domain) && isSame(this.range, that.range);\n  }\n\n  clone() {\n    return new ScaleMappingFunction(this.domain, this.type, this.range);\n  }\n}\n\nexport interface IScriptMappingFunctionContext {\n  value_min: number;\n  value_max: number;\n  value_range: number;\n  value_domain: number[];\n  linear(v: number, min: number, max: number): number;\n}\n\nexport interface IScriptMappingFunctionType {\n  (this: IScriptMappingFunctionContext, value: number): number;\n}\n\n/**\n * a mapping function based on a custom user function using 'value' as the current value\n */\nexport class ScriptMappingFunction implements IMappingFunction {\n  private readonly f: IScriptMappingFunctionType;\n  public domain: number[];\n  public readonly code: string;\n\n  constructor();\n  constructor(dump: ITypedDump);\n  constructor(domain: number[], code?: string | IScriptMappingFunctionType);\n  constructor(\n    domain: ITypedDump | number[] = [0, 1],\n    code: string | IScriptMappingFunctionType = 'return this.linear(value,this.value_min,this.value_max);'\n  ) {\n    if (!domain || Array.isArray(domain)) {\n      this.domain = (domain as number[]) ?? [0, 1];\n    } else {\n      const dump = domain;\n      this.domain = dump.domain;\n      code = dump.code;\n    }\n    this.code = typeof code === 'string' ? code : code.toString();\n    // eslint-disable-next-line no-new-func\n    this.f = typeof code === 'function' ? code : (new Function('value', code) as any);\n  }\n\n  getRange(): [string, string] {\n    return ['?', '?'];\n  }\n\n  apply(v: number): number {\n    const min = this.domain[0],\n      max = this.domain[this.domain.length - 1];\n    const r = this.f.call(\n      {\n        value_min: min,\n        value_max: max,\n        value_range: max - min,\n        value_domain: this.domain.slice(),\n        linear: (v: number, mi: number, ma: number) => (v - mi) / (ma - mi),\n      },\n      v\n    );\n\n    if (typeof r === 'number') {\n      return Math.max(Math.min(r, 1), 0);\n    }\n    return NaN;\n  }\n\n  toJSON() {\n    return {\n      type: 'script',\n      code: this.code,\n      domain: this.domain,\n    };\n  }\n\n  eq(other: IMappingFunction): boolean {\n    if (!(other instanceof ScriptMappingFunction)) {\n      return false;\n    }\n    const that = other as ScriptMappingFunction;\n    return that.code === this.code || that.f === this.f;\n  }\n\n  clone() {\n    return new ScriptMappingFunction(this.domain, this.f);\n  }\n}\n\n/**\n * @internal\n */\nexport function createMappingFunction(types: { [key: string]: IMappingFunctionConstructor }) {\n  return (dump: ITypedDump | IScriptMappingFunctionType): IMappingFunction => {\n    if (typeof dump === 'function') {\n      return new ScriptMappingFunction([0, 1], dump);\n    }\n    if (!dump || !dump.type) {\n      return new ScaleMappingFunction();\n    }\n    const type = types[dump.type];\n    if (!type) {\n      console.warn('invalid mapping type dump', dump);\n      return new ScaleMappingFunction(dump.domain || [0, 1], 'linear', dump.range || [0, 1]);\n    }\n    return new type(dump);\n  };\n}\n\n/** @internal */\nexport function restoreMapping(desc: IMapAbleDesc, factory: ITypeFactory): IMappingFunction {\n  if (desc.map) {\n    return factory.mappingFunction(desc.map);\n  }\n  return new ScaleMappingFunction(desc.domain || [0, 1], 'linear', desc.range || [0, 1]);\n}\n\nexport function mappingFunctions() {\n  return {\n    script: ScriptMappingFunction,\n    linear: ScaleMappingFunction,\n    log: ScaleMappingFunction,\n    'pow1.1': ScaleMappingFunction,\n    pow2: ScaleMappingFunction,\n    pow3: ScaleMappingFunction,\n  };\n}\n","import { format } from 'd3-format';\nimport { IBoxPlotData, similar, ISequence, IAdvancedBoxPlotData, boxplotBuilder } from '../internal';\nimport type { IDataRow } from './interfaces';\nimport type { IBoxPlotColumn, INumberFilter, INumberColumn } from './INumberColumn';\nimport { FIRST_IS_NAN } from './missing';\n\n/** @internal */\nexport const DEFAULT_FORMATTER = format('.3n');\n\n/** @internal */\nexport function compareBoxPlot(col: IBoxPlotColumn, a: IDataRow, b: IDataRow) {\n  const aVal = col.getBoxPlotData(a);\n  const bVal = col.getBoxPlotData(b);\n  const method = col.getSortMethod() as keyof IBoxPlotData;\n  if (aVal == null) {\n    return bVal == null ? 0 : FIRST_IS_NAN;\n  }\n  if (bVal == null) {\n    return FIRST_IS_NAN * -1;\n  }\n  return numberCompare(aVal[method] as number, bVal[method] as number);\n}\n\nexport function toCompareBoxPlotValue(col: IBoxPlotColumn, row: IDataRow) {\n  const v = col.getBoxPlotData(row);\n  const method = col.getSortMethod() as keyof IBoxPlotData;\n  return v == null ? NaN : (v[method] as number);\n}\n\nexport function getBoxPlotNumber(col: IBoxPlotColumn, row: IDataRow, mode: 'raw' | 'normalized'): number {\n  const data = mode === 'normalized' ? col.getBoxPlotData(row) : col.getRawBoxPlotData(row);\n  if (data == null) {\n    return NaN;\n  }\n  return data[col.getSortMethod() as keyof IBoxPlotData] as number;\n}\n/**\n * save number comparison\n * @param a\n * @param b\n * @param aMissing\n * @param bMissing\n * @return {number}\n * @internal\n */\nexport function numberCompare(a: number | null, b: number | null, aMissing = false, bMissing = false) {\n  aMissing = aMissing || a == null || Number.isNaN(a);\n  bMissing = bMissing || b == null || Number.isNaN(b);\n  if (aMissing) {\n    //NaN are smaller\n    return bMissing ? 0 : FIRST_IS_NAN;\n  }\n  if (bMissing) {\n    return FIRST_IS_NAN * -1;\n  }\n  return a! - b!;\n}\n\n/** @internal */\nexport function noNumberFilter() {\n  return { min: Number.NEGATIVE_INFINITY, max: Number.POSITIVE_INFINITY, filterMissing: false };\n}\n\n/** @internal */\nexport function isEqualNumberFilter(a: INumberFilter, b: INumberFilter, delta = 0.001) {\n  return similar(a.min, b.min, delta) && similar(a.max, b.max, delta) && a.filterMissing === b.filterMissing;\n}\n\n/** @internal */\nexport function isNumberIncluded(filter: INumberFilter | null, value: number) {\n  if (!filter) {\n    return true;\n  }\n  if (Number.isNaN(value)) {\n    return !filter.filterMissing;\n  }\n  return !((isFinite(filter.min) && value < filter.min) || (isFinite(filter.max) && value > filter.max));\n}\n\n/** @internal */\nexport function isDummyNumberFilter(filter: INumberFilter) {\n  return !filter.filterMissing && !isFinite(filter.min) && !isFinite(filter.max);\n}\n\n/** @internal */\nexport function restoreNumberFilter(v: INumberFilter): INumberFilter {\n  return {\n    min: v.min != null && isFinite(v.min) ? v.min : Number.NEGATIVE_INFINITY,\n    max: v.max != null && isFinite(v.max) ? v.max : Number.POSITIVE_INFINITY,\n    filterMissing: v.filterMissing,\n  };\n}\n\n/** @internal */\nexport function medianIndex(rows: ISequence<IDataRow>, col: INumberColumn) {\n  //return the median row\n  const data = rows.map((r, i) => ({ r, i, v: col.getNumber(r) }));\n  const sorted = Array.from(data.filter((r) => !Number.isNaN(r.v))).sort((a, b) => numberCompare(a.v, b.v));\n  const index = sorted[Math.floor(sorted.length / 2.0)];\n  if (index === undefined) {\n    return { index: 0, row: sorted[0]!.r }; //error case\n  }\n  return { index: index.i, row: index.r };\n}\n\n/** @internal */\nexport function toCompareGroupValue(\n  rows: ISequence<IDataRow>,\n  col: INumberColumn,\n  sortMethod: keyof IAdvancedBoxPlotData,\n  valueCache?: ISequence<number>\n) {\n  const b = boxplotBuilder();\n  if (valueCache) {\n    b.pushAll(valueCache);\n  } else {\n    b.pushAll(rows.map((d) => col.getNumber(d)));\n  }\n  const vs = b.build();\n  return vs[sortMethod] as number;\n}\n","import { format } from 'd3-format';\nimport { equalArrays, IEventListener, ISequence } from '../internal';\nimport { Category, dialogAddons, SortByDefault, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport { IDataRow, IGroup, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport {\n  INumberColumn,\n  EAdvancedSortMethod,\n  INumberDesc,\n  INumberFilter,\n  IMappingFunction,\n  IColorMappingFunction,\n  IMapAbleColumn,\n} from './INumberColumn';\nimport { restoreMapping, ScaleMappingFunction } from './MappingFunction';\nimport { isMissingValue, isUnknown, missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  noNumberFilter,\n  isDummyNumberFilter,\n  restoreNumberFilter,\n  toCompareGroupValue,\n  isEqualNumberFilter,\n  isNumberIncluded,\n} from './internalNumber';\nimport { integrateDefaults } from './internal';\n\nexport declare type INumberColumnDesc = INumberDesc & IValueColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function mappingChanged_NC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function colorMappingChanged_NC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function filterChanged_NC(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function sortMethodChanged_NC(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf NumberColumn\n * @event\n */\nexport declare function groupingChanged_NC(previous: number[], current: number[]): void;\n\n/**\n * a number column mapped from an original input scale to an output range\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'groupBy', 'sortGroupBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sortGroup', 'sortNumber')\n@dialogAddons('group', 'groupNumber')\n@Category('number')\n@SortByDefault('descending')\nexport default class NumberColumn extends ValueColumn<number> implements INumberColumn, IMapAbleColumn {\n  static readonly EVENT_MAPPING_CHANGED = 'mappingChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\n\n  private mapping: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  private original: IMappingFunction;\n\n  /**\n   * currently active filter\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  /**\n   * The accuracy defines the deviation of values to the applied filter boundary.\n   * Use an accuracy closer to 0 for columns with smaller numbers (e.g., 1e-9).\n   * @private\n   */\n  private readonly filterAccuracy: number = 0.001;\n\n  private readonly numberFormat: (n: number) => string = format('.2f');\n\n  private currentGroupThresholds: number[] = [];\n  private groupSortMethod: EAdvancedSortMethod = EAdvancedSortMethod.median;\n\n  constructor(id: string, desc: INumberColumnDesc, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'histogram',\n      })\n    );\n\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n\n    if (desc.filterAccuracy) {\n      this.filterAccuracy = desc.filterAccuracy;\n    }\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    r.filter = isDummyNumberFilter(this.currentFilter) ? null : this.currentFilter;\n    r.groupSortMethod = this.groupSortMethod;\n    if (this.currentGroupThresholds) {\n      r.stratifyThresholds = this.currentGroupThresholds;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.map) {\n      this.mapping = factory.mappingFunction(dump.map);\n    } else if (dump.domain) {\n      this.mapping = new ScaleMappingFunction(dump.domain, 'linear', dump.range || [0, 1]);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n    if (dump.groupSortMethod) {\n      this.groupSortMethod = dump.groupSortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.stratifyThresholds) {\n      this.currentGroupThresholds = dump.stratifyThresholds;\n    }\n    if (dump.stratifyThreshholds) {\n      this.currentGroupThresholds = dump.stratifyThreshholds;\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        NumberColumn.EVENT_MAPPING_CHANGED,\n        NumberColumn.EVENT_COLOR_MAPPING_CHANGED,\n        NumberColumn.EVENT_FILTER_CHANGED,\n        NumberColumn.EVENT_SORTMETHOD_CHANGED,\n        NumberColumn.EVENT_GROUPING_CHANGED,\n      ]);\n  }\n\n  on(type: typeof NumberColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NC | null): this;\n  on(type: typeof NumberColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_NC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getLabel(row: IDataRow) {\n    if ((this.desc as any).numberFormat) {\n      const raw = this.getRawValue(row);\n      //if a dedicated format and a number use the formatter in any case\n      if (Number.isNaN(raw)) {\n        return 'NaN';\n      }\n      if (!isFinite(raw)) {\n        return raw.toString();\n      }\n      return this.numberFormat(raw);\n    }\n    const v = super.getValue(row);\n    //keep non number if it is not a number else convert using formatter\n    if (typeof v === 'number') {\n      return this.numberFormat(+v);\n    }\n    return String(v);\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawValue(row: IDataRow) {\n    const v: any = super.getValue(row);\n    if (isMissingValue(v)) {\n      return NaN;\n    }\n    return +v;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getNumber(row);\n    if (Number.isNaN(v)) {\n      return null;\n    }\n    return v;\n  }\n\n  getNumber(row: IDataRow) {\n    const v = this.getRawValue(row);\n    if (Number.isNaN(v)) {\n      return NaN;\n    }\n    return this.mapping.apply(v);\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getRawNumber(row: IDataRow) {\n    return this.getRawValue(row);\n  }\n\n  toCompareValue(row: IDataRow, valueCache?: any) {\n    return valueCache != null ? valueCache : this.getNumber(row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): number {\n    return toCompareGroupValue(rows, this, this.groupSortMethod, valueCache);\n  }\n\n  toCompareGroupValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        NumberColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    const v = this.getNumber(row);\n    if (Number.isNaN(v)) {\n      return DEFAULT_COLOR;\n    }\n    return this.colorMapping.apply(v);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        NumberColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return !isDummyNumberFilter(this.currentFilter);\n  }\n\n  getFilter(): INumberFilter {\n    return Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    value = value || { min: Number.NEGATIVE_INFINITY, max: Number.POSITIVE_INFINITY, filterMissing: false };\n    if (isEqualNumberFilter(value, this.currentFilter, this.filterAccuracy)) {\n      return;\n    }\n    const bak = this.getFilter();\n    this.currentFilter.min = isUnknown(value.min) ? Number.NEGATIVE_INFINITY : value.min;\n    this.currentFilter.max = isUnknown(value.max) ? Number.POSITIVE_INFINITY : value.max;\n    this.currentFilter.filterMissing = value.filterMissing;\n    this.fire(\n      [NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      bak,\n      this.getFilter()\n    );\n  }\n\n  /**\n   * filter the current row if any filter is set\n   * @param row\n   * @returns {boolean}\n   */\n  filter(row: IDataRow) {\n    return isNumberIncluded(this.currentFilter, this.getRawNumber(row));\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  getGroupThresholds() {\n    return this.currentGroupThresholds.slice();\n  }\n\n  setGroupThresholds(value: number[]) {\n    if (equalArrays(this.currentGroupThresholds, value)) {\n      return;\n    }\n    const bak = this.getGroupThresholds();\n    this.currentGroupThresholds = value.slice();\n    this.fire([NumberColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\n  }\n\n  group(row: IDataRow): IGroup {\n    const value = this.getRawNumber(row);\n    if (Number.isNaN(value)) {\n      return Object.assign({}, missingGroup);\n    }\n\n    let threshold = this.currentGroupThresholds;\n    if (threshold.length === 0) {\n      // default threshold\n      const d = this.mapping.domain;\n      threshold = [(d[1] - d[0]) / 2];\n    }\n\n    const thresholdIndex = threshold.findIndex((t) => value <= t);\n    // group by thresholds / bins\n    switch (thresholdIndex) {\n      case -1:\n        //bigger than the last threshold\n        return {\n          name: `${this.label} > ${this.numberFormat(threshold[threshold.length - 1])}`,\n          color: this.colorMapping.apply(1),\n        };\n      case 0:\n        //smallest\n        return {\n          name: `${this.label} <= ${this.numberFormat(threshold[0])}`,\n          color: this.colorMapping.apply(0),\n        };\n      default:\n        return {\n          name: `${this.numberFormat(threshold[thresholdIndex - 1])} <= ${this.label} <= ${this.numberFormat(\n            threshold[thresholdIndex]\n          )}`,\n          color: this.colorMapping.apply(\n            this.mapping.apply((threshold[thresholdIndex - 1] + threshold[thresholdIndex]) / 2)\n          ),\n        };\n    }\n  }\n\n  getSortMethod() {\n    return this.groupSortMethod;\n  }\n\n  setSortMethod(sortMethod: EAdvancedSortMethod) {\n    if (this.groupSortMethod === sortMethod) {\n      return;\n    }\n    this.fire([NumberColumn.EVENT_SORTMETHOD_CHANGED], this.groupSortMethod, (this.groupSortMethod = sortMethod));\n    // sort by me if not already sorted by me\n    if (!this.isGroupSortedByMe().asc) {\n      this.toggleMyGroupSorting();\n    }\n  }\n}\n","import { format } from 'd3-format';\nimport type { IBoxPlotData, IEventListener } from '../internal';\nimport { Category, dialogAddons, SortByDefault, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport { IDataRow, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport {\n  ESortMethod,\n  IBoxPlotColumn,\n  INumberDesc,\n  INumberFilter,\n  IColorMappingFunction,\n  IMappingFunction,\n} from './INumberColumn';\nimport { restoreMapping } from './MappingFunction';\nimport NumberColumn from './NumberColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  DEFAULT_FORMATTER,\n  noNumberFilter,\n  toCompareBoxPlotValue,\n  getBoxPlotNumber,\n  isDummyNumberFilter,\n  restoreNumberFilter,\n} from './internalNumber';\n\nexport interface IBoxPlotDesc extends INumberDesc {\n  sort?: ESortMethod;\n}\n\nexport declare type IBoxPlotColumnDesc = IBoxPlotDesc & IValueColumnDesc<IBoxPlotData>;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function sortMethodChanged_BPC(previous: ESortMethod, current: ESortMethod): void;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function mappingChanged_BPC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function colorMappingChanged_BPC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf BoxPlotColumn\n * @event\n */\nexport declare function filterChanged_BPC(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortBoxPlot')\n@Category('array')\n@SortByDefault('descending')\nexport default class BoxPlotColumn extends ValueColumn<IBoxPlotData> implements IBoxPlotColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\n\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\n\n  private sort: ESortMethod;\n\n  private mapping: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n\n  private original: Readonly<IMappingFunction>;\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<IBoxPlotColumnDesc>, factory: ITypeFactory) {\n    super(id, desc);\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n\n    this.sort = desc.sort || ESortMethod.min;\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  toCompareValue(row: IDataRow): number {\n    return toCompareBoxPlotValue(this, row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    return this.getValue(row);\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    return this.getRawValue(row);\n  }\n\n  getRawValue(row: IDataRow) {\n    return super.getValue(row);\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getRawValue(row);\n    if (v == null) {\n      return null;\n    }\n    const r: IBoxPlotData = {\n      min: this.mapping.apply(v.min),\n      max: this.mapping.apply(v.max),\n      median: this.mapping.apply(v.median),\n      q1: this.mapping.apply(v.q1),\n      q3: this.mapping.apply(v.q3),\n    };\n    if (v.outlier) {\n      Object.assign(r, {\n        outlier: v.outlier.map((d) => this.mapping.apply(d)),\n      });\n    }\n    if (v.whiskerLow != null) {\n      Object.assign(r, {\n        whiskerLow: this.mapping.apply(v.whiskerLow),\n      });\n    }\n    if (v.whiskerHigh != null) {\n      Object.assign(r, {\n        whiskerHigh: this.mapping.apply(v.whiskerHigh),\n      });\n    }\n    return r;\n  }\n\n  getNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'normalized');\n  }\n\n  getRawNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'raw');\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getLabel(row: IDataRow): string {\n    const v = this.getRawValue(row);\n    if (v == null) {\n      return '';\n    }\n    const f = this.numberFormat;\n    return `BoxPlot(min = ${f(v.min)}, q1 = ${f(v.q1)}, median = ${f(v.median)}, q3 = ${f(v.q3)}, max = ${f(v.max)})`;\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: ESortMethod) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire(BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, this.sort, (this.sort = sort));\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        BoxPlotColumn.EVENT_SORTMETHOD_CHANGED,\n        BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED,\n        BoxPlotColumn.EVENT_MAPPING_CHANGED,\n        BoxPlotColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_BPC | null): this;\n  on(type: typeof BoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_BPC | null): this;\n  on(type: typeof BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_BPC | null): this;\n  on(type: typeof BoxPlotColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_BPC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        BoxPlotColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { Category } from './annotations';\nimport type { IKeyValue, IMapColumn } from './IArrayColumn';\nimport type { IDataRow, IValueColumnDesc } from './interfaces';\nimport ValueColumn from './ValueColumn';\nimport { integrateDefaults } from './internal';\n\nexport type IMapColumnDesc<T> = IValueColumnDesc<IKeyValue<T>[]>;\n\n@Category('map')\nexport default class MapColumn<T> extends ValueColumn<IKeyValue<T>[]> implements IMapColumn<T> {\n  constructor(id: string, desc: Readonly<IMapColumnDesc<T>>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getMap(row);\n    return r.length === 0 ? null : r;\n  }\n\n  getLabels(row: IDataRow): IKeyValue<string>[] {\n    const v = this.getMap(row);\n    return v.map(({ key, value }) => ({ key, value: String(value) }));\n  }\n\n  getMap(row: IDataRow) {\n    return toKeyValue<T>(super.getValue(row));\n  }\n\n  getMapLabel(row: IDataRow) {\n    return this.getLabels(row);\n  }\n\n  getLabel(row: IDataRow) {\n    const v = this.getLabels(row);\n    return `{${v.map(({ key, value }) => `${key}: ${value}`).join(', ')}}`;\n  }\n}\n\nfunction byKey(a: IKeyValue<any>, b: IKeyValue<any>) {\n  if (a === b) {\n    return 0;\n  }\n  return a.key.localeCompare(b.key);\n}\n\nfunction toKeyValue<T>(v?: Map<string, T> | { [key: string]: T } | IKeyValue<T>[]): IKeyValue<T>[] {\n  if (!v) {\n    return [];\n  }\n  if (v instanceof Map) {\n    return Array.from(v.entries())\n      .map(([key, value]) => ({ key, value }))\n      .sort(byKey);\n  }\n  if (Array.isArray(v)) {\n    return v; // keep original order\n  }\n  // object\n  return Object.keys(v)\n    .map((key) => ({ key, value: v[key] }))\n    .sort(byKey);\n}\n","import type {\n  ICategoricalDesc,\n  ICategory,\n  ICategoricalLikeColumn,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport CategoricalColumn from './CategoricalColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport {\n  DEFAULT_COLOR,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { IEventListener } from '../internal';\nimport { toolbar } from './annotations';\nimport { toCategories } from './internalCategorical';\n\nexport declare type ICategoricalMapColumnDesc = ICategoricalDesc & IMapColumnDesc<string | null>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf CategoricalMapColumn\n * @event\n */\nexport declare function colorMappingChanged_CMC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n@toolbar('rename', 'colorMappedCategorical')\nexport default class CategoricalMapColumn extends MapColumn<string | null> implements ICategoricalLikeColumn {\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<ICategoricalMapColumnDesc>) {\n    super(id, desc);\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n  protected createEventList() {\n    return super.createEventList().concat([CategoricalMapColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof CategoricalMapColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_CMC | null\n  ): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  private parseValue(v: any) {\n    if (!v) {\n      return null;\n    }\n    const vs = String(v);\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n  }\n\n  getCategoryMap(row: IDataRow) {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: this.parseValue(value),\n    }));\n  }\n\n  getCategories(row: IDataRow) {\n    return this.getCategoryMap(row).map((d) => d.value);\n  }\n\n  getColors(row: IDataRow) {\n    return this.getCategoryMap(row).map(({ key, value }) => ({\n      key,\n      value: value ? this.colorMapping.apply(value) : DEFAULT_COLOR,\n    }));\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getCategoryMap(row);\n    return r.length === 0\n      ? null\n      : r.map(({ key, value }) => ({\n          key,\n          value: value ? value.name : null,\n        }));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getCategoryMap(row).map(({ key, value }) => ({\n      key,\n      value: value ? value.label : '',\n    }));\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n  }\n\n  iterCategory(row: IDataRow) {\n    return this.getCategories(row);\n  }\n}\n","import ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type {\n  ICategoricalDesc,\n  ICategory,\n  ICategoricalColorMappingFunction,\n  ICategoricalsColumn,\n} from './ICategoricalColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type Column from './Column';\nimport {\n  DEFAULT_COLOR,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IEventListener } from '../internal';\nimport { toCategories } from './internalCategorical';\n\nexport declare type ICategoricalsColumnDesc = ICategoricalDesc & IArrayColumnDesc<string | null>;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf CategoricalsColumn\n * @event\n */\nexport declare function colorMappingChanged_CCS(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'colorMappedCategorical')\nexport default class CategoricalsColumn extends ArrayColumn<string | null> implements ICategoricalsColumn {\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<ICategoricalsColumnDesc>) {\n    super(id, desc);\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([CategoricalsColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof CategoricalsColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_CCS | null\n  ): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getCategories(row: IDataRow) {\n    return super.getValues(row).map((v) => {\n      if (!v) {\n        return null;\n      }\n      const vs = String(v);\n      return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n    });\n  }\n\n  getColors(row: IDataRow) {\n    return this.getCategories(row).map((d) => (d ? this.colorMapping.apply(d) : DEFAULT_COLOR));\n  }\n\n  iterCategory(row: IDataRow) {\n    return this.getCategories(row);\n  }\n\n  getValues(row: IDataRow) {\n    return this.getCategories(row).map((v) => (v ? v.name : null));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getCategories(row).map((v) => (v ? v.label : ''));\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n  }\n}\n","var t0 = new Date,\n    t1 = new Date;\n\nexport default function newInterval(floori, offseti, count, field) {\n\n  function interval(date) {\n    return floori(date = arguments.length === 0 ? new Date : new Date(+date)), date;\n  }\n\n  interval.floor = function(date) {\n    return floori(date = new Date(+date)), date;\n  };\n\n  interval.ceil = function(date) {\n    return floori(date = new Date(date - 1)), offseti(date, 1), floori(date), date;\n  };\n\n  interval.round = function(date) {\n    var d0 = interval(date),\n        d1 = interval.ceil(date);\n    return date - d0 < d1 - date ? d0 : d1;\n  };\n\n  interval.offset = function(date, step) {\n    return offseti(date = new Date(+date), step == null ? 1 : Math.floor(step)), date;\n  };\n\n  interval.range = function(start, stop, step) {\n    var range = [], previous;\n    start = interval.ceil(start);\n    step = step == null ? 1 : Math.floor(step);\n    if (!(start < stop) || !(step > 0)) return range; // also handles Invalid Date\n    do range.push(previous = new Date(+start)), offseti(start, step), floori(start);\n    while (previous < start && start < stop);\n    return range;\n  };\n\n  interval.filter = function(test) {\n    return newInterval(function(date) {\n      if (date >= date) while (floori(date), !test(date)) date.setTime(date - 1);\n    }, function(date, step) {\n      if (date >= date) {\n        if (step < 0) while (++step <= 0) {\n          while (offseti(date, -1), !test(date)) {} // eslint-disable-line no-empty\n        } else while (--step >= 0) {\n          while (offseti(date, +1), !test(date)) {} // eslint-disable-line no-empty\n        }\n      }\n    });\n  };\n\n  if (count) {\n    interval.count = function(start, end) {\n      t0.setTime(+start), t1.setTime(+end);\n      floori(t0), floori(t1);\n      return Math.floor(count(t0, t1));\n    };\n\n    interval.every = function(step) {\n      step = Math.floor(step);\n      return !isFinite(step) || !(step > 0) ? null\n          : !(step > 1) ? interval\n          : interval.filter(field\n              ? function(d) { return field(d) % step === 0; }\n              : function(d) { return interval.count(0, d) % step === 0; });\n    };\n  }\n\n  return interval;\n}\n","export const durationSecond = 1000;\nexport const durationMinute = durationSecond * 60;\nexport const durationHour = durationMinute * 60;\nexport const durationDay = durationHour * 24;\nexport const durationWeek = durationDay * 7;\nexport const durationMonth = durationDay * 30;\nexport const durationYear = durationDay * 365;\n","import interval from \"./interval.js\";\nimport {durationWeek} from \"./duration.js\";\n\nfunction utcWeekday(i) {\n  return interval(function(date) {\n    date.setUTCDate(date.getUTCDate() - (date.getUTCDay() + 7 - i) % 7);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCDate(date.getUTCDate() + step * 7);\n  }, function(start, end) {\n    return (end - start) / durationWeek;\n  });\n}\n\nexport var utcSunday = utcWeekday(0);\nexport var utcMonday = utcWeekday(1);\nexport var utcTuesday = utcWeekday(2);\nexport var utcWednesday = utcWeekday(3);\nexport var utcThursday = utcWeekday(4);\nexport var utcFriday = utcWeekday(5);\nexport var utcSaturday = utcWeekday(6);\n\nexport var utcSundays = utcSunday.range;\nexport var utcMondays = utcMonday.range;\nexport var utcTuesdays = utcTuesday.range;\nexport var utcWednesdays = utcWednesday.range;\nexport var utcThursdays = utcThursday.range;\nexport var utcFridays = utcFriday.range;\nexport var utcSaturdays = utcSaturday.range;\n","import interval from \"./interval.js\";\nimport {durationDay} from \"./duration.js\";\n\nvar utcDay = interval(function(date) {\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCDate(date.getUTCDate() + step);\n}, function(start, end) {\n  return (end - start) / durationDay;\n}, function(date) {\n  return date.getUTCDate() - 1;\n});\n\nexport default utcDay;\nexport var utcDays = utcDay.range;\n","import interval from \"./interval.js\";\nimport {durationMinute, durationWeek} from \"./duration.js\";\n\nfunction weekday(i) {\n  return interval(function(date) {\n    date.setDate(date.getDate() - (date.getDay() + 7 - i) % 7);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setDate(date.getDate() + step * 7);\n  }, function(start, end) {\n    return (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationWeek;\n  });\n}\n\nexport var sunday = weekday(0);\nexport var monday = weekday(1);\nexport var tuesday = weekday(2);\nexport var wednesday = weekday(3);\nexport var thursday = weekday(4);\nexport var friday = weekday(5);\nexport var saturday = weekday(6);\n\nexport var sundays = sunday.range;\nexport var mondays = monday.range;\nexport var tuesdays = tuesday.range;\nexport var wednesdays = wednesday.range;\nexport var thursdays = thursday.range;\nexport var fridays = friday.range;\nexport var saturdays = saturday.range;\n","import interval from \"./interval.js\";\nimport {durationDay, durationMinute} from \"./duration.js\";\n\nvar day = interval(\n  date => date.setHours(0, 0, 0, 0),\n  (date, step) => date.setDate(date.getDate() + step),\n  (start, end) => (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationDay,\n  date => date.getDate() - 1\n);\n\nexport default day;\nexport var days = day.range;\n","import interval from \"./interval.js\";\n\nvar year = interval(function(date) {\n  date.setMonth(0, 1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setFullYear(date.getFullYear() + step);\n}, function(start, end) {\n  return end.getFullYear() - start.getFullYear();\n}, function(date) {\n  return date.getFullYear();\n});\n\n// An optimized implementation for this simple case.\nyear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setFullYear(Math.floor(date.getFullYear() / k) * k);\n    date.setMonth(0, 1);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setFullYear(date.getFullYear() + step * k);\n  });\n};\n\nexport default year;\nexport var years = year.range;\n","import interval from \"./interval.js\";\n\nvar utcYear = interval(function(date) {\n  date.setUTCMonth(0, 1);\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCFullYear(date.getUTCFullYear() + step);\n}, function(start, end) {\n  return end.getUTCFullYear() - start.getUTCFullYear();\n}, function(date) {\n  return date.getUTCFullYear();\n});\n\n// An optimized implementation for this simple case.\nutcYear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setUTCFullYear(Math.floor(date.getUTCFullYear() / k) * k);\n    date.setUTCMonth(0, 1);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCFullYear(date.getUTCFullYear() + step * k);\n  });\n};\n\nexport default utcYear;\nexport var utcYears = utcYear.range;\n","import {\n  timeDay,\n  timeSunday,\n  timeMonday,\n  timeThursday,\n  timeYear,\n  utcDay,\n  utcSunday,\n  utcMonday,\n  utcThursday,\n  utcYear\n} from \"d3-time\";\n\nfunction localDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(-1, d.m, d.d, d.H, d.M, d.S, d.L);\n    date.setFullYear(d.y);\n    return date;\n  }\n  return new Date(d.y, d.m, d.d, d.H, d.M, d.S, d.L);\n}\n\nfunction utcDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(Date.UTC(-1, d.m, d.d, d.H, d.M, d.S, d.L));\n    date.setUTCFullYear(d.y);\n    return date;\n  }\n  return new Date(Date.UTC(d.y, d.m, d.d, d.H, d.M, d.S, d.L));\n}\n\nfunction newDate(y, m, d) {\n  return {y: y, m: m, d: d, H: 0, M: 0, S: 0, L: 0};\n}\n\nexport default function formatLocale(locale) {\n  var locale_dateTime = locale.dateTime,\n      locale_date = locale.date,\n      locale_time = locale.time,\n      locale_periods = locale.periods,\n      locale_weekdays = locale.days,\n      locale_shortWeekdays = locale.shortDays,\n      locale_months = locale.months,\n      locale_shortMonths = locale.shortMonths;\n\n  var periodRe = formatRe(locale_periods),\n      periodLookup = formatLookup(locale_periods),\n      weekdayRe = formatRe(locale_weekdays),\n      weekdayLookup = formatLookup(locale_weekdays),\n      shortWeekdayRe = formatRe(locale_shortWeekdays),\n      shortWeekdayLookup = formatLookup(locale_shortWeekdays),\n      monthRe = formatRe(locale_months),\n      monthLookup = formatLookup(locale_months),\n      shortMonthRe = formatRe(locale_shortMonths),\n      shortMonthLookup = formatLookup(locale_shortMonths);\n\n  var formats = {\n    \"a\": formatShortWeekday,\n    \"A\": formatWeekday,\n    \"b\": formatShortMonth,\n    \"B\": formatMonth,\n    \"c\": null,\n    \"d\": formatDayOfMonth,\n    \"e\": formatDayOfMonth,\n    \"f\": formatMicroseconds,\n    \"g\": formatYearISO,\n    \"G\": formatFullYearISO,\n    \"H\": formatHour24,\n    \"I\": formatHour12,\n    \"j\": formatDayOfYear,\n    \"L\": formatMilliseconds,\n    \"m\": formatMonthNumber,\n    \"M\": formatMinutes,\n    \"p\": formatPeriod,\n    \"q\": formatQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatSeconds,\n    \"u\": formatWeekdayNumberMonday,\n    \"U\": formatWeekNumberSunday,\n    \"V\": formatWeekNumberISO,\n    \"w\": formatWeekdayNumberSunday,\n    \"W\": formatWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatYear,\n    \"Y\": formatFullYear,\n    \"Z\": formatZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var utcFormats = {\n    \"a\": formatUTCShortWeekday,\n    \"A\": formatUTCWeekday,\n    \"b\": formatUTCShortMonth,\n    \"B\": formatUTCMonth,\n    \"c\": null,\n    \"d\": formatUTCDayOfMonth,\n    \"e\": formatUTCDayOfMonth,\n    \"f\": formatUTCMicroseconds,\n    \"g\": formatUTCYearISO,\n    \"G\": formatUTCFullYearISO,\n    \"H\": formatUTCHour24,\n    \"I\": formatUTCHour12,\n    \"j\": formatUTCDayOfYear,\n    \"L\": formatUTCMilliseconds,\n    \"m\": formatUTCMonthNumber,\n    \"M\": formatUTCMinutes,\n    \"p\": formatUTCPeriod,\n    \"q\": formatUTCQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatUTCSeconds,\n    \"u\": formatUTCWeekdayNumberMonday,\n    \"U\": formatUTCWeekNumberSunday,\n    \"V\": formatUTCWeekNumberISO,\n    \"w\": formatUTCWeekdayNumberSunday,\n    \"W\": formatUTCWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatUTCYear,\n    \"Y\": formatUTCFullYear,\n    \"Z\": formatUTCZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var parses = {\n    \"a\": parseShortWeekday,\n    \"A\": parseWeekday,\n    \"b\": parseShortMonth,\n    \"B\": parseMonth,\n    \"c\": parseLocaleDateTime,\n    \"d\": parseDayOfMonth,\n    \"e\": parseDayOfMonth,\n    \"f\": parseMicroseconds,\n    \"g\": parseYear,\n    \"G\": parseFullYear,\n    \"H\": parseHour24,\n    \"I\": parseHour24,\n    \"j\": parseDayOfYear,\n    \"L\": parseMilliseconds,\n    \"m\": parseMonthNumber,\n    \"M\": parseMinutes,\n    \"p\": parsePeriod,\n    \"q\": parseQuarter,\n    \"Q\": parseUnixTimestamp,\n    \"s\": parseUnixTimestampSeconds,\n    \"S\": parseSeconds,\n    \"u\": parseWeekdayNumberMonday,\n    \"U\": parseWeekNumberSunday,\n    \"V\": parseWeekNumberISO,\n    \"w\": parseWeekdayNumberSunday,\n    \"W\": parseWeekNumberMonday,\n    \"x\": parseLocaleDate,\n    \"X\": parseLocaleTime,\n    \"y\": parseYear,\n    \"Y\": parseFullYear,\n    \"Z\": parseZone,\n    \"%\": parseLiteralPercent\n  };\n\n  // These recursive directive definitions must be deferred.\n  formats.x = newFormat(locale_date, formats);\n  formats.X = newFormat(locale_time, formats);\n  formats.c = newFormat(locale_dateTime, formats);\n  utcFormats.x = newFormat(locale_date, utcFormats);\n  utcFormats.X = newFormat(locale_time, utcFormats);\n  utcFormats.c = newFormat(locale_dateTime, utcFormats);\n\n  function newFormat(specifier, formats) {\n    return function(date) {\n      var string = [],\n          i = -1,\n          j = 0,\n          n = specifier.length,\n          c,\n          pad,\n          format;\n\n      if (!(date instanceof Date)) date = new Date(+date);\n\n      while (++i < n) {\n        if (specifier.charCodeAt(i) === 37) {\n          string.push(specifier.slice(j, i));\n          if ((pad = pads[c = specifier.charAt(++i)]) != null) c = specifier.charAt(++i);\n          else pad = c === \"e\" ? \" \" : \"0\";\n          if (format = formats[c]) c = format(date, pad);\n          string.push(c);\n          j = i + 1;\n        }\n      }\n\n      string.push(specifier.slice(j, i));\n      return string.join(\"\");\n    };\n  }\n\n  function newParse(specifier, Z) {\n    return function(string) {\n      var d = newDate(1900, undefined, 1),\n          i = parseSpecifier(d, specifier, string += \"\", 0),\n          week, day;\n      if (i != string.length) return null;\n\n      // If a UNIX timestamp is specified, return it.\n      if (\"Q\" in d) return new Date(d.Q);\n      if (\"s\" in d) return new Date(d.s * 1000 + (\"L\" in d ? d.L : 0));\n\n      // If this is utcParse, never use the local timezone.\n      if (Z && !(\"Z\" in d)) d.Z = 0;\n\n      // The am-pm flag is 0 for AM, and 1 for PM.\n      if (\"p\" in d) d.H = d.H % 12 + d.p * 12;\n\n      // If the month was not specified, inherit from the quarter.\n      if (d.m === undefined) d.m = \"q\" in d ? d.q : 0;\n\n      // Convert day-of-week and week-of-year to day-of-year.\n      if (\"V\" in d) {\n        if (d.V < 1 || d.V > 53) return null;\n        if (!(\"w\" in d)) d.w = 1;\n        if (\"Z\" in d) {\n          week = utcDate(newDate(d.y, 0, 1)), day = week.getUTCDay();\n          week = day > 4 || day === 0 ? utcMonday.ceil(week) : utcMonday(week);\n          week = utcDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getUTCFullYear();\n          d.m = week.getUTCMonth();\n          d.d = week.getUTCDate() + (d.w + 6) % 7;\n        } else {\n          week = localDate(newDate(d.y, 0, 1)), day = week.getDay();\n          week = day > 4 || day === 0 ? timeMonday.ceil(week) : timeMonday(week);\n          week = timeDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getFullYear();\n          d.m = week.getMonth();\n          d.d = week.getDate() + (d.w + 6) % 7;\n        }\n      } else if (\"W\" in d || \"U\" in d) {\n        if (!(\"w\" in d)) d.w = \"u\" in d ? d.u % 7 : \"W\" in d ? 1 : 0;\n        day = \"Z\" in d ? utcDate(newDate(d.y, 0, 1)).getUTCDay() : localDate(newDate(d.y, 0, 1)).getDay();\n        d.m = 0;\n        d.d = \"W\" in d ? (d.w + 6) % 7 + d.W * 7 - (day + 5) % 7 : d.w + d.U * 7 - (day + 6) % 7;\n      }\n\n      // If a time zone is specified, all fields are interpreted as UTC and then\n      // offset according to the specified time zone.\n      if (\"Z\" in d) {\n        d.H += d.Z / 100 | 0;\n        d.M += d.Z % 100;\n        return utcDate(d);\n      }\n\n      // Otherwise, all fields are in local time.\n      return localDate(d);\n    };\n  }\n\n  function parseSpecifier(d, specifier, string, j) {\n    var i = 0,\n        n = specifier.length,\n        m = string.length,\n        c,\n        parse;\n\n    while (i < n) {\n      if (j >= m) return -1;\n      c = specifier.charCodeAt(i++);\n      if (c === 37) {\n        c = specifier.charAt(i++);\n        parse = parses[c in pads ? specifier.charAt(i++) : c];\n        if (!parse || ((j = parse(d, string, j)) < 0)) return -1;\n      } else if (c != string.charCodeAt(j++)) {\n        return -1;\n      }\n    }\n\n    return j;\n  }\n\n  function parsePeriod(d, string, i) {\n    var n = periodRe.exec(string.slice(i));\n    return n ? (d.p = periodLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseShortWeekday(d, string, i) {\n    var n = shortWeekdayRe.exec(string.slice(i));\n    return n ? (d.w = shortWeekdayLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseWeekday(d, string, i) {\n    var n = weekdayRe.exec(string.slice(i));\n    return n ? (d.w = weekdayLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseShortMonth(d, string, i) {\n    var n = shortMonthRe.exec(string.slice(i));\n    return n ? (d.m = shortMonthLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseMonth(d, string, i) {\n    var n = monthRe.exec(string.slice(i));\n    return n ? (d.m = monthLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\n  }\n\n  function parseLocaleDateTime(d, string, i) {\n    return parseSpecifier(d, locale_dateTime, string, i);\n  }\n\n  function parseLocaleDate(d, string, i) {\n    return parseSpecifier(d, locale_date, string, i);\n  }\n\n  function parseLocaleTime(d, string, i) {\n    return parseSpecifier(d, locale_time, string, i);\n  }\n\n  function formatShortWeekday(d) {\n    return locale_shortWeekdays[d.getDay()];\n  }\n\n  function formatWeekday(d) {\n    return locale_weekdays[d.getDay()];\n  }\n\n  function formatShortMonth(d) {\n    return locale_shortMonths[d.getMonth()];\n  }\n\n  function formatMonth(d) {\n    return locale_months[d.getMonth()];\n  }\n\n  function formatPeriod(d) {\n    return locale_periods[+(d.getHours() >= 12)];\n  }\n\n  function formatQuarter(d) {\n    return 1 + ~~(d.getMonth() / 3);\n  }\n\n  function formatUTCShortWeekday(d) {\n    return locale_shortWeekdays[d.getUTCDay()];\n  }\n\n  function formatUTCWeekday(d) {\n    return locale_weekdays[d.getUTCDay()];\n  }\n\n  function formatUTCShortMonth(d) {\n    return locale_shortMonths[d.getUTCMonth()];\n  }\n\n  function formatUTCMonth(d) {\n    return locale_months[d.getUTCMonth()];\n  }\n\n  function formatUTCPeriod(d) {\n    return locale_periods[+(d.getUTCHours() >= 12)];\n  }\n\n  function formatUTCQuarter(d) {\n    return 1 + ~~(d.getUTCMonth() / 3);\n  }\n\n  return {\n    format: function(specifier) {\n      var f = newFormat(specifier += \"\", formats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    parse: function(specifier) {\n      var p = newParse(specifier += \"\", false);\n      p.toString = function() { return specifier; };\n      return p;\n    },\n    utcFormat: function(specifier) {\n      var f = newFormat(specifier += \"\", utcFormats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    utcParse: function(specifier) {\n      var p = newParse(specifier += \"\", true);\n      p.toString = function() { return specifier; };\n      return p;\n    }\n  };\n}\n\nvar pads = {\"-\": \"\", \"_\": \" \", \"0\": \"0\"},\n    numberRe = /^\\s*\\d+/, // note: ignores next directive\n    percentRe = /^%/,\n    requoteRe = /[\\\\^$*+?|[\\]().{}]/g;\n\nfunction pad(value, fill, width) {\n  var sign = value < 0 ? \"-\" : \"\",\n      string = (sign ? -value : value) + \"\",\n      length = string.length;\n  return sign + (length < width ? new Array(width - length + 1).join(fill) + string : string);\n}\n\nfunction requote(s) {\n  return s.replace(requoteRe, \"\\\\$&\");\n}\n\nfunction formatRe(names) {\n  return new RegExp(\"^(?:\" + names.map(requote).join(\"|\") + \")\", \"i\");\n}\n\nfunction formatLookup(names) {\n  return new Map(names.map((name, i) => [name.toLowerCase(), i]));\n}\n\nfunction parseWeekdayNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.w = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekdayNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.u = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.U = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberISO(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.V = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.W = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseFullYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 4));\n  return n ? (d.y = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.y = +n[0] + (+n[0] > 68 ? 1900 : 2000), i + n[0].length) : -1;\n}\n\nfunction parseZone(d, string, i) {\n  var n = /^(Z)|([+-]\\d\\d)(?::?(\\d\\d))?/.exec(string.slice(i, i + 6));\n  return n ? (d.Z = n[1] ? 0 : -(n[2] + (n[3] || \"00\")), i + n[0].length) : -1;\n}\n\nfunction parseQuarter(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.q = n[0] * 3 - 3, i + n[0].length) : -1;\n}\n\nfunction parseMonthNumber(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.m = n[0] - 1, i + n[0].length) : -1;\n}\n\nfunction parseDayOfMonth(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseDayOfYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.m = 0, d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseHour24(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.H = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMinutes(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.M = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.S = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMilliseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.L = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMicroseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 6));\n  return n ? (d.L = Math.floor(n[0] / 1000), i + n[0].length) : -1;\n}\n\nfunction parseLiteralPercent(d, string, i) {\n  var n = percentRe.exec(string.slice(i, i + 1));\n  return n ? i + n[0].length : -1;\n}\n\nfunction parseUnixTimestamp(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.Q = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseUnixTimestampSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.s = +n[0], i + n[0].length) : -1;\n}\n\nfunction formatDayOfMonth(d, p) {\n  return pad(d.getDate(), p, 2);\n}\n\nfunction formatHour24(d, p) {\n  return pad(d.getHours(), p, 2);\n}\n\nfunction formatHour12(d, p) {\n  return pad(d.getHours() % 12 || 12, p, 2);\n}\n\nfunction formatDayOfYear(d, p) {\n  return pad(1 + timeDay.count(timeYear(d), d), p, 3);\n}\n\nfunction formatMilliseconds(d, p) {\n  return pad(d.getMilliseconds(), p, 3);\n}\n\nfunction formatMicroseconds(d, p) {\n  return formatMilliseconds(d, p) + \"000\";\n}\n\nfunction formatMonthNumber(d, p) {\n  return pad(d.getMonth() + 1, p, 2);\n}\n\nfunction formatMinutes(d, p) {\n  return pad(d.getMinutes(), p, 2);\n}\n\nfunction formatSeconds(d, p) {\n  return pad(d.getSeconds(), p, 2);\n}\n\nfunction formatWeekdayNumberMonday(d) {\n  var day = d.getDay();\n  return day === 0 ? 7 : day;\n}\n\nfunction formatWeekNumberSunday(d, p) {\n  return pad(timeSunday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction dISO(d) {\n  var day = d.getDay();\n  return (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n}\n\nfunction formatWeekNumberISO(d, p) {\n  d = dISO(d);\n  return pad(timeThursday.count(timeYear(d), d) + (timeYear(d).getDay() === 4), p, 2);\n}\n\nfunction formatWeekdayNumberSunday(d) {\n  return d.getDay();\n}\n\nfunction formatWeekNumberMonday(d, p) {\n  return pad(timeMonday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction formatYear(d, p) {\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatYearISO(d, p) {\n  d = dISO(d);\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatFullYear(d, p) {\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatFullYearISO(d, p) {\n  var day = d.getDay();\n  d = (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatZone(d) {\n  var z = d.getTimezoneOffset();\n  return (z > 0 ? \"-\" : (z *= -1, \"+\"))\n      + pad(z / 60 | 0, \"0\", 2)\n      + pad(z % 60, \"0\", 2);\n}\n\nfunction formatUTCDayOfMonth(d, p) {\n  return pad(d.getUTCDate(), p, 2);\n}\n\nfunction formatUTCHour24(d, p) {\n  return pad(d.getUTCHours(), p, 2);\n}\n\nfunction formatUTCHour12(d, p) {\n  return pad(d.getUTCHours() % 12 || 12, p, 2);\n}\n\nfunction formatUTCDayOfYear(d, p) {\n  return pad(1 + utcDay.count(utcYear(d), d), p, 3);\n}\n\nfunction formatUTCMilliseconds(d, p) {\n  return pad(d.getUTCMilliseconds(), p, 3);\n}\n\nfunction formatUTCMicroseconds(d, p) {\n  return formatUTCMilliseconds(d, p) + \"000\";\n}\n\nfunction formatUTCMonthNumber(d, p) {\n  return pad(d.getUTCMonth() + 1, p, 2);\n}\n\nfunction formatUTCMinutes(d, p) {\n  return pad(d.getUTCMinutes(), p, 2);\n}\n\nfunction formatUTCSeconds(d, p) {\n  return pad(d.getUTCSeconds(), p, 2);\n}\n\nfunction formatUTCWeekdayNumberMonday(d) {\n  var dow = d.getUTCDay();\n  return dow === 0 ? 7 : dow;\n}\n\nfunction formatUTCWeekNumberSunday(d, p) {\n  return pad(utcSunday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction UTCdISO(d) {\n  var day = d.getUTCDay();\n  return (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n}\n\nfunction formatUTCWeekNumberISO(d, p) {\n  d = UTCdISO(d);\n  return pad(utcThursday.count(utcYear(d), d) + (utcYear(d).getUTCDay() === 4), p, 2);\n}\n\nfunction formatUTCWeekdayNumberSunday(d) {\n  return d.getUTCDay();\n}\n\nfunction formatUTCWeekNumberMonday(d, p) {\n  return pad(utcMonday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction formatUTCYear(d, p) {\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCYearISO(d, p) {\n  d = UTCdISO(d);\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCFullYear(d, p) {\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCFullYearISO(d, p) {\n  var day = d.getUTCDay();\n  d = (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCZone() {\n  return \"+0000\";\n}\n\nfunction formatLiteralPercent() {\n  return \"%\";\n}\n\nfunction formatUnixTimestamp(d) {\n  return +d;\n}\n\nfunction formatUnixTimestampSeconds(d) {\n  return Math.floor(+d / 1000);\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var timeFormat;\nexport var timeParse;\nexport var utcFormat;\nexport var utcParse;\n\ndefaultLocale({\n  dateTime: \"%x, %X\",\n  date: \"%-m/%-d/%Y\",\n  time: \"%-I:%M:%S %p\",\n  periods: [\"AM\", \"PM\"],\n  days: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n  shortDays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n  months: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n  shortMonths: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  timeFormat = locale.format;\n  timeParse = locale.parse;\n  utcFormat = locale.utcFormat;\n  utcParse = locale.utcParse;\n  return locale;\n}\n","import interval from \"./interval.js\";\n\nvar month = interval(function(date) {\n  date.setDate(1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setMonth(date.getMonth() + step);\n}, function(start, end) {\n  return end.getMonth() - start.getMonth() + (end.getFullYear() - start.getFullYear()) * 12;\n}, function(date) {\n  return date.getMonth();\n});\n\nexport default month;\nexport var months = month.range;\n","import interval from \"./interval.js\";\nimport {durationHour, durationMinute, durationSecond} from \"./duration.js\";\n\nvar hour = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond - date.getMinutes() * durationMinute);\n}, function(date, step) {\n  date.setTime(+date + step * durationHour);\n}, function(start, end) {\n  return (end - start) / durationHour;\n}, function(date) {\n  return date.getHours();\n});\n\nexport default hour;\nexport var hours = hour.range;\n","import interval from \"./interval.js\";\nimport {durationMinute, durationSecond} from \"./duration.js\";\n\nvar minute = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond);\n}, function(date, step) {\n  date.setTime(+date + step * durationMinute);\n}, function(start, end) {\n  return (end - start) / durationMinute;\n}, function(date) {\n  return date.getMinutes();\n});\n\nexport default minute;\nexport var minutes = minute.range;\n","import interval from \"./interval.js\";\nimport {durationSecond} from \"./duration.js\";\n\nvar second = interval(function(date) {\n  date.setTime(date - date.getMilliseconds());\n}, function(date, step) {\n  date.setTime(+date + step * durationSecond);\n}, function(start, end) {\n  return (end - start) / durationSecond;\n}, function(date) {\n  return date.getUTCSeconds();\n});\n\nexport default second;\nexport var seconds = second.range;\n","import { timeDay, timeHour, timeMinute, timeMonth, timeSecond, timeWeek } from 'd3-time';\nimport { timeFormat } from 'd3-time-format';\nimport { equal, ISequence, isSeqEmpty } from '../internal';\nimport type { INumberFilter } from './INumberColumn';\nimport { isNumberIncluded } from './internalNumber';\nimport type { IDateColumn, IDateGrouper } from './IDateColumn';\nimport type { IDataRow } from './interfaces';\n\n/** @internal */\nexport {\n  isDummyNumberFilter as isDummyDateFilter,\n  isEqualNumberFilter as isEqualDateFilter,\n  noNumberFilter as noDateFilter,\n  restoreNumberFilter as restoreDateFilter,\n} from './internalNumber';\n\n/** @internal */\nexport function isDateIncluded(filter: INumberFilter | null, value: Date | null) {\n  if (!filter) {\n    return true;\n  }\n  if (value == null || !(value instanceof Date)) {\n    return !filter.filterMissing;\n  }\n  return isNumberIncluded(filter, value!.getTime());\n}\n\n/**\n * shifts the given date such that it is on 23:59:59, or 00:00:00\n * @internal\n */\nexport function shiftFilterDateDay(date: number, type: 'min' | 'max') {\n  const d = new Date(date);\n  if (type === 'max') {\n    d.setHours(23);\n    d.setMinutes(59);\n    d.setSeconds(59);\n    d.setMilliseconds(999);\n  } else {\n    d.setHours(0);\n    d.setMinutes(0);\n    d.setSeconds(0);\n    d.setMilliseconds(0);\n  }\n  return d.getTime();\n}\n\n/**\n * @internal\n */\nexport function defaultDateGrouper(): IDateGrouper {\n  return { granularity: 'month', circular: false };\n}\n\n/**\n * @internal\n */\nexport function isDefaultDateGrouper(grouper: IDateGrouper) {\n  return equal(defaultDateGrouper(), grouper);\n}\n\n/**\n * convert the given date to the desired grouper\n * @internal\n */\nexport function toDateGroup(grouper: IDateGrouper, value: Date): { value: number; name: string } {\n  switch (grouper.granularity) {\n    case 'century':\n      const centuryP = Math.floor(value.getFullYear() / 100);\n      if (grouper.circular) {\n        const century = centuryP % 10;\n        return {\n          value: century,\n          name: `*${century}00`,\n        };\n      }\n      return {\n        value: centuryP,\n        name: `${centuryP}00`,\n      };\n    case 'decade':\n      const decadeP = Math.floor(value.getFullYear() / 10);\n      if (grouper.circular) {\n        const decade = decadeP % 10;\n        return {\n          value: decade,\n          name: `**${decade}0`,\n        };\n      }\n      return {\n        value: decadeP,\n        name: `${decadeP}0`,\n      };\n    case 'year':\n      if (grouper.circular) {\n        const year = value.getFullYear() % 10;\n        return {\n          value: year,\n          name: `***${year}`,\n        };\n      }\n      return {\n        value: value.getFullYear(),\n        name: String(value.getFullYear()),\n      };\n    case 'month':\n      if (grouper.circular) {\n        return {\n          value: value.getMonth(),\n          name: timeFormat('%B')(value),\n        };\n      }\n      return {\n        value: timeMonth(value).getTime(),\n        name: timeFormat('%B %Y')(value),\n      };\n    case 'week':\n      if (grouper.circular) {\n        return {\n          value: value.getMonth(),\n          name: timeFormat('%W')(value),\n        };\n      }\n      return {\n        value: timeWeek(value).getTime(),\n        name: timeFormat('%W %Y')(value),\n      };\n    case 'day_of_week':\n      if (grouper.circular) {\n        return {\n          value: value.getDay(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeDay(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'day_of_month':\n      if (grouper.circular) {\n        return {\n          value: value.getDate(),\n          name: timeFormat('%d')(value),\n        };\n      }\n      return {\n        value: timeDay(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'day_of_year':\n      if (grouper.circular) {\n        // %j = day of year\n        const v = timeFormat('%j')(value);\n        return {\n          value: Number.parseInt(v, 10),\n          name: v,\n        };\n      }\n      return {\n        value: timeDay(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'hour':\n      if (grouper.circular) {\n        return {\n          value: value.getHours(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeHour(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'minute':\n      if (grouper.circular) {\n        return {\n          value: value.getMinutes(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeMinute(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n    case 'second':\n      if (grouper.circular) {\n        return {\n          value: value.getSeconds(),\n          name: timeFormat('%A')(value),\n        };\n      }\n      return {\n        value: timeSecond(value).getTime(),\n        name: timeFormat('%x')(value),\n      };\n  }\n}\n\n/**\n * @internal\n */\nexport function chooseAggregatedDate(\n  rows: ISequence<IDataRow>,\n  grouper: IDateGrouper | null,\n  col: IDateColumn,\n  valueCache?: ISequence<Date | null>\n): { value: number | null; name: string } {\n  const vs = (valueCache ? valueCache : rows.map((d) => col.getDate(d))).filter(\n    (d) => d instanceof Date\n  ) as ISequence<Date>;\n  if (isSeqEmpty(vs)) {\n    return { value: null, name: '' };\n  }\n  const median = trueMedian(vs.map((d) => d.getTime()))!;\n  if (!grouper) {\n    return { value: median, name: new Date(median).toString() };\n  }\n  return toDateGroup(grouper, new Date(median));\n}\n\nfunction trueMedian(dates: ISequence<number>) {\n  // to avoid interpolating between the centers do it manually\n  const s = Float64Array.from(dates);\n  if (s.length === 1) {\n    return s[0];\n  }\n\n  s.sort();\n  return s[Math.floor(s.length / 2)];\n}\n","import { timeFormat, timeParse } from 'd3-time-format';\nimport { ISequence, equal, IEventListener } from '../internal';\nimport { Category, dialogAddons, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport type { IDateColumn, IDateDesc, IDateFilter, IDateGrouper } from './IDateColumn';\nimport { defaultGroup, IDataRow, IGroup, ECompareValueType, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport { isMissingValue, isUnknown, missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport {\n  noDateFilter,\n  defaultDateGrouper,\n  isDummyDateFilter,\n  isDefaultDateGrouper,\n  restoreDateFilter,\n  isEqualDateFilter,\n  isDateIncluded,\n  toDateGroup,\n  chooseAggregatedDate,\n} from './internalDate';\nimport { integrateDefaults } from './internal';\n\nexport declare type IDateColumnDesc = IValueColumnDesc<Date> & IDateDesc;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf DateColumn\n * @event\n */\nexport declare function filterChanged_DC(previous: IDateFilter | null, current: IDateFilter | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf DateColumn\n * @event\n */\nexport declare function groupingChanged_DC(previous: IDateGrouper | null, current: IDateGrouper | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'groupBy', 'sortGroupBy', 'filterDate')\n@dialogAddons('group', 'groupDate')\n@Category('date')\nexport default class DateColumn extends ValueColumn<Date> implements IDateColumn {\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\n\n  static readonly DEFAULT_DATE_FORMAT = '%x';\n\n  private readonly format: (date: Date | null) => string;\n  private readonly parse: (date: string) => Date | null;\n\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: IDateFilter = noDateFilter();\n  private currentGrouper: IDateGrouper = defaultDateGrouper();\n\n  constructor(id: string, desc: Readonly<IDateColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        groupRenderer: 'datehistogram',\n        summaryRenderer: 'datehistogram',\n      })\n    );\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.format = (v) => (v instanceof Date ? f(v) : '');\n    this.parse = desc.dateParse\n      ? timeParse(desc.dateParse)\n      : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n  }\n\n  getFormatter() {\n    return this.format;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.filter = isDummyDateFilter(this.currentFilter) ? null : this.currentFilter;\n    if (this.currentGrouper && !isDefaultDateGrouper(this.currentGrouper)) {\n      r.grouper = this.currentGrouper;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.filter) {\n      this.currentFilter = restoreDateFilter(dump.filter);\n    }\n    if (dump.grouper) {\n      this.currentGrouper = dump.grouper;\n    }\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([DateColumn.EVENT_FILTER_CHANGED, DateColumn.EVENT_GROUPING_CHANGED]);\n  }\n\n  on(type: typeof DateColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DC | null): this;\n  on(type: typeof DateColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_DC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow): Date | null {\n    return this.getDate(row);\n  }\n\n  getDate(row: IDataRow) {\n    const v = super.getValue(row);\n    if (isMissingValue(v)) {\n      return null;\n    }\n    if (v instanceof Date) {\n      return v;\n    }\n    return this.parse(String(v));\n  }\n\n  iterDate(row: IDataRow) {\n    return [this.getDate(row)];\n  }\n\n  getLabel(row: IDataRow) {\n    const v = this.getValue(row);\n    return this.format(v);\n  }\n\n  isFiltered() {\n    return !isDummyDateFilter(this.currentFilter);\n  }\n\n  clearFilter() {\n    const was = this.isFiltered();\n    this.setFilter(null);\n    return was;\n  }\n\n  getFilter(): IDateFilter {\n    return Object.assign({}, this.currentFilter);\n  }\n\n  setFilter(value: IDateFilter | null) {\n    value = value || { min: Number.NEGATIVE_INFINITY, max: Number.POSITIVE_INFINITY, filterMissing: false };\n    if (isEqualDateFilter(value, this.currentFilter)) {\n      return;\n    }\n    const bak = this.getFilter();\n    this.currentFilter.min = isUnknown(value.min) ? Number.NEGATIVE_INFINITY : value.min;\n    this.currentFilter.max = isUnknown(value.max) ? Number.POSITIVE_INFINITY : value.max;\n    this.currentFilter.filterMissing = value.filterMissing;\n    this.fire([DateColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getFilter());\n  }\n\n  /**\n   * filter the current row if any filter is set\n   * @param row\n   * @returns {boolean}\n   */\n  filter(row: IDataRow, valueCache?: any) {\n    return isDateIncluded(this.currentFilter, valueCache !== undefined ? valueCache : this.getDate(row));\n  }\n\n  toCompareValue(row: IDataRow, valueCache?: any) {\n    const v = valueCache !== undefined ? valueCache : this.getValue(row);\n    if (!(v instanceof Date)) {\n      return NaN;\n    }\n    return v.getTime();\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.DOUBLE_ASC;\n  }\n\n  getDateGrouper() {\n    return Object.assign({}, this.currentGrouper);\n  }\n\n  setDateGrouper(value: IDateGrouper) {\n    if (equal(this.currentGrouper, value)) {\n      return;\n    }\n    const bak = this.getDateGrouper();\n    this.currentGrouper = Object.assign({}, value);\n    this.fire([DateColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\n  }\n\n  group(row: IDataRow, valueCache?: any): IGroup {\n    const v = valueCache !== undefined ? valueCache : this.getDate(row);\n    if (!v || !(v instanceof Date)) {\n      return Object.assign({}, missingGroup);\n    }\n    if (!this.currentGrouper) {\n      return Object.assign({}, defaultGroup);\n    }\n    const g = toDateGroup(this.currentGrouper, v);\n    return {\n      name: g.name,\n      color: DEFAULT_COLOR,\n    };\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, _group: IGroup, valueCache?: ISequence<any>): number {\n    const v = chooseAggregatedDate(rows, this.currentGrouper, this, valueCache).value;\n    return v == null ? NaN : v;\n  }\n\n  toCompareGroupValueType() {\n    return ECompareValueType.DOUBLE_ASC;\n  }\n}\n","import { timeFormat, timeParse } from 'd3-time-format';\nimport { median, min, max, IEventListener } from '../internal';\nimport { dialogAddons, toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDateDesc, IDatesColumn, IDateFilter } from './IDateColumn';\nimport { IDataRow, ECompareValueType, ITypeFactory } from './interfaces';\nimport { isMissingValue } from './missing';\nimport DateColumn from './DateColumn';\nimport { noDateFilter, isDummyDateFilter, restoreDateFilter } from './internalDate';\nimport { chooseUIntByDataLength, integrateDefaults } from './internal';\n\nexport enum EDateSort {\n  min = 'min',\n  max = 'max',\n  median = 'median',\n}\n\nexport interface IDatesDesc extends IDateDesc {\n  sort?: EDateSort;\n}\n\nexport declare type IDatesColumnDesc = IDatesDesc & IArrayColumnDesc<Date>;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf DatesColumn\n * @event\n */\nexport declare function sortMethodChanged_DCS(previous: EDateSort, current: EDateSort): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf DatesColumn\n * @event\n */\nexport declare function filterChanged_DCS(previous: IDateFilter | null, current: IDateFilter | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterDate')\n@dialogAddons('sort', 'sortDates')\nexport default class DatesColumn extends ArrayColumn<Date | null> implements IDatesColumn {\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\n\n  private readonly format: (date: Date | null) => string;\n  private readonly parse: (date: string) => Date | null;\n  private sort: EDateSort;\n  private currentFilter: IDateFilter = noDateFilter();\n\n  constructor(id: string, desc: Readonly<IDatesColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'datehistogram',\n        groupRenderer: 'datehistogram',\n        summaryRenderer: 'datehistogram',\n      })\n    );\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.format = (v) => (v instanceof Date ? f(v) : '');\n    this.parse = desc.dateParse\n      ? timeParse(desc.dateParse)\n      : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.sort = desc.sort || EDateSort.median;\n  }\n\n  getFormatter() {\n    return this.format;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([DatesColumn.EVENT_SORTMETHOD_CHANGED, DatesColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof DatesColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_DCS | null): this;\n  on(type: typeof DatesColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow): (Date | null)[] | null {\n    const r = this.getDates(row);\n    return r.every((d) => d == null) ? null : r;\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getDates(row).map((v) => (v instanceof Date ? this.format(v) : ''));\n  }\n\n  getDates(row: IDataRow): (Date | null)[] {\n    return super.getValues(row).map((v) => {\n      if (isMissingValue(v)) {\n        return null;\n      }\n      if (v instanceof Date) {\n        return v;\n      }\n      return this.parse(String(v));\n    });\n  }\n\n  getDate(row: IDataRow) {\n    const av = this.getDates(row).filter(Boolean);\n    if (av.length === 0) {\n      return null;\n    }\n    return new Date(compute(av, this.sort));\n  }\n\n  iterDate(row: IDataRow) {\n    return this.getDates(row);\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EDateSort) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire([DatesColumn.EVENT_SORTMETHOD_CHANGED], this.sort, (this.sort = sort));\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreDateFilter(dump.filter);\n    }\n  }\n\n  toCompareValue(row: IDataRow) {\n    const vs = this.getDates(row).filter(Boolean);\n    if (!vs) {\n      return [0, 0];\n    }\n    return [vs.length, compute(vs, this.sort)];\n  }\n\n  toCompareValueType() {\n    return [chooseUIntByDataLength(this.dataLength), ECompareValueType.DOUBLE_ASC];\n  }\n\n  isFiltered() {\n    return DateColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): IDateFilter {\n    return DateColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: IDateFilter | null) {\n    DateColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return DateColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return DateColumn.prototype.clearFilter.call(this);\n  }\n}\n\nfunction compute(arr: Date[], sort: EDateSort) {\n  switch (sort) {\n    case EDateSort.min:\n      return min(arr, (d) => d.getTime())!;\n    case EDateSort.max:\n      return max(arr, (d) => d.getTime())!;\n    case EDateSort.median:\n      return median(arr, (d) => d.getTime())!;\n  }\n}\n","import { timeFormat, timeParse } from 'd3-time-format';\nimport type { IDateColumn, IDateFilter } from './IDateColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { isMissingValue } from './missing';\nimport DatesColumn, { EDateSort, IDatesDesc } from './DatesColumn';\nimport DateColumn from './DateColumn';\nimport { dialogAddons, toolbar } from './annotations';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { noDateFilter, isDummyDateFilter, restoreDateFilter } from './internalDate';\nimport { integrateDefaults } from './internal';\n\nexport declare type IDateMapColumnDesc = IDatesDesc & IMapColumnDesc<Date | null>;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf DatesMapColumn\n * @event\n */\nexport declare function sortMethodChanged_DMC(previous: EDateSort, current: EDateSort): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf DatesMapColumn\n * @event\n */\nexport declare function filterChanged_DMC(previous: IDateFilter | null, current: IDateFilter | null): void;\n\n@toolbar('rename', 'filterDate')\n@dialogAddons('sort', 'sortDates')\nexport default class DatesMapColumn extends MapColumn<Date | null> implements IDateColumn {\n  static readonly EVENT_SORTMETHOD_CHANGED = DatesColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\n\n  private readonly format: (date: Date | null) => string;\n  private readonly parse: (date: string) => Date | null;\n  private sort: EDateSort;\n  private currentFilter: IDateFilter = noDateFilter();\n\n  constructor(id: string, desc: Readonly<IDateMapColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'default',\n      })\n    );\n    const f = timeFormat(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.format = (v) => (v instanceof Date ? f(v) : '');\n    this.parse = desc.dateParse\n      ? timeParse(desc.dateParse)\n      : timeParse(desc.dateFormat || DateColumn.DEFAULT_DATE_FORMAT);\n    this.sort = desc.sort || EDateSort.median;\n  }\n\n  getFormatter() {\n    return this.format;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([DatesMapColumn.EVENT_SORTMETHOD_CHANGED, DatesMapColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof DatesMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_DMC | null): this;\n  on(type: typeof DatesMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_DMC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  private parseValue(v: any) {\n    if (isMissingValue(v)) {\n      return null;\n    }\n    if (v instanceof Date) {\n      return v;\n    }\n    return this.parse(String(v));\n  }\n\n  getDateMap(row: IDataRow) {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: this.parseValue(value),\n    }));\n  }\n\n  iterDate(row: IDataRow) {\n    return this.getDates(row);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getDateMap(row);\n\n    return r.every((d) => d == null) ? null : r;\n  }\n\n  getLabels(row: IDataRow): IKeyValue<string>[] {\n    return this.getDateMap(row).map(({ key, value }) => ({\n      key,\n      value: value instanceof Date ? this.format(value) : '',\n    }));\n  }\n\n  getDates(row: IDataRow): (Date | null)[] {\n    return this.getDateMap(row).map((v) => v.value);\n  }\n\n  getDate(row: IDataRow) {\n    return DatesColumn.prototype.getDate.call(this, row);\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EDateSort) {\n    return DatesColumn.prototype.setSortMethod.call(this, sort);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreDateFilter(dump.filter);\n    }\n  }\n\n  isFiltered() {\n    return DateColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): IDateFilter {\n    return DateColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: IDateFilter | null) {\n    DateColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return DateColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return DateColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { Category, SupportType, toolbar, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport { IDataRow, IGroup, ECompareValueType } from './interfaces';\nimport { missingGroup } from './missing';\nimport type { IEventListener, ISequence } from '../internal';\n\nexport function createGroupDesc(label = 'Group Name') {\n  return { type: 'group', label };\n}\n\nexport enum EGroupSortMethod {\n  name = 'name',\n  count = 'count',\n}\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf GroupColumn\n * @event\n */\nexport declare function sortMethodChanged(previous: EGroupSortMethod, current: EGroupSortMethod): void;\n\n@SupportType()\n@toolbar('rename', 'sortGroupBy')\n@dialogAddons('sortGroup', 'sortGroups')\n@Category('support')\nexport default class GroupColumn extends Column {\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\n\n  private groupSortMethod: EGroupSortMethod = EGroupSortMethod.name;\n\n  get frozen() {\n    return this.desc.frozen !== false;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([GroupColumn.EVENT_SORTMETHOD_CHANGED]);\n  }\n\n  on(type: typeof GroupColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getLabel() {\n    return '';\n  }\n\n  getValue() {\n    return '';\n  }\n\n  getSortMethod() {\n    return this.groupSortMethod;\n  }\n\n  setSortMethod(sortMethod: EGroupSortMethod) {\n    if (this.groupSortMethod === sortMethod) {\n      return;\n    }\n    this.fire(GroupColumn.EVENT_SORTMETHOD_CHANGED, this.groupSortMethod, (this.groupSortMethod = sortMethod));\n    // sort by me if not already sorted by me\n    if (!this.isGroupSortedByMe().asc) {\n      this.toggleMyGroupSorting();\n    }\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    if (this.groupSortMethod === 'count') {\n      return rows.length;\n    }\n    return group.name === missingGroup.name ? null : group.name.toLowerCase();\n  }\n\n  toCompareGroupValueType() {\n    return this.groupSortMethod === 'count' ? ECompareValueType.COUNT : ECompareValueType.STRING;\n  }\n}\n","import { Category, toolbar } from './annotations';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  dirtyCaches,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  DEFAULT_COLOR,\n} from './Column';\nimport type { ICategoricalColumn, ICategory, ICategoricalColorMappingFunction } from './ICategoricalColumn';\nimport type { IDataRow, IGroup, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport { colorPool, integrateDefaults } from './internal';\nimport { missingGroup } from './missing';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener } from '../internal';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\n\nexport interface ICategoryNode extends ICategory {\n  children: Readonly<ICategoryNode>[];\n}\n\nexport interface IPartialCategoryNode extends Partial<ICategory> {\n  children: IPartialCategoryNode[];\n}\n\nexport interface IHierarchyDesc {\n  hierarchy: IPartialCategoryNode;\n  hierarchySeparator?: string;\n}\n\nexport declare type IHierarchyColumnDesc = IHierarchyDesc & IValueColumnDesc<string>;\n\nexport interface ICategoryInternalNode extends ICategory {\n  path: string;\n  children: Readonly<ICategoryInternalNode>[];\n}\n\nexport interface ICutOffNode {\n  node: Readonly<ICategoryInternalNode>;\n  maxDepth: number;\n}\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf HierarchyColumn\n * @event\n */\nexport declare function colorMappingChanged_HC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the cut off property changes\n * @asMemberOf HierarchyColumn\n * @event\n */\nexport declare function cutOffChanged(previous: ICutOffNode, current: ICutOffNode): void;\n\n/**\n * column for hierarchical categorical values\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'cutoff', 'group', 'groupBy', 'colorMappedCategorical')\n@Category('categorical')\nexport default class HierarchyColumn extends ValueColumn<string> implements ICategoricalColumn {\n  static readonly EVENT_CUTOFF_CHANGED = 'cutOffChanged';\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\n\n  private readonly hierarchySeparator: string;\n  readonly hierarchy: Readonly<ICategoryInternalNode>;\n\n  private currentNode: Readonly<ICategoryInternalNode>;\n  private currentMaxDepth = Number.POSITIVE_INFINITY;\n  private currentLeaves: Readonly<ICategoryInternalNode>[] = [];\n  private readonly currentLeavesNameCache = new Map<string, Readonly<ICategoryInternalNode>>();\n  private readonly currentLeavesPathCache = new Map<string, Readonly<ICategoryInternalNode>>();\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  constructor(id: string, desc: Readonly<IHierarchyColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'categorical',\n      })\n    );\n    this.hierarchySeparator = desc.hierarchySeparator || '.';\n    this.hierarchy = this.initHierarchy(desc.hierarchy);\n    this.currentNode = this.hierarchy;\n    this.currentLeaves = computeLeaves(this.currentNode, this.currentMaxDepth);\n    this.updateCaches();\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  private initHierarchy(root: IPartialCategoryNode) {\n    const colors = colorPool();\n    const s = this.hierarchySeparator;\n    const add = (prefix: string, node: IPartialCategoryNode): ICategoryInternalNode => {\n      const name = node.name == null ? String(node.value) : node.name;\n      const children = (node.children || []).map((child: IPartialCategoryNode | string): ICategoryInternalNode => {\n        if (typeof child === 'string') {\n          const path = prefix + child;\n          return {\n            path,\n            name: child,\n            label: path,\n            color: colors(),\n            value: 0,\n            children: [],\n          };\n        }\n        const r = add(`${prefix}${name}${s}`, child);\n        if (!r.color) {\n          //hack to inject the next color\n          (r as any).color = colors();\n        }\n        return r;\n      });\n      const path = prefix + name;\n      const label = node.label ? node.label : path;\n      return { path, name, children, label, color: node.color!, value: 0 };\n    };\n    return add('', root);\n  }\n\n  get categories() {\n    return this.currentLeaves;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([HierarchyColumn.EVENT_COLOR_MAPPING_CHANGED, HierarchyColumn.EVENT_CUTOFF_CHANGED]);\n  }\n\n  on(type: typeof HierarchyColumn.EVENT_CUTOFF_CHANGED, listener: typeof cutOffChanged | null): this;\n  on(type: typeof HierarchyColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_HC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.colorMapping = this.colorMapping.toJSON();\n    if (isFinite(this.currentMaxDepth)) {\n      r.maxDepth = this.currentMaxDepth;\n    }\n    if (this.currentNode !== this.hierarchy) {\n      r.cutOffNode = this.currentNode.path;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    this.colorMapping = factory.categoricalColorMappingFunction(dump.colorMapping, this.categories);\n    if (typeof dump.maxDepth !== 'undefined') {\n      this.currentMaxDepth = dump.maxDepth;\n    }\n    if (typeof dump.cutOffNode !== 'undefined') {\n      const path = dump.cutOffNode.split(this.hierarchySeparator);\n      let node: Readonly<ICategoryInternalNode> | null = this.hierarchy;\n\n      const findName = (act: string) => {\n        return (d: { name: string }) => d.name === act;\n      };\n\n      let act = path.shift();\n      while (act && node) {\n        if (node.name !== act) {\n          node = null;\n          break;\n        }\n        const next = path.shift();\n        if (!next) {\n          break;\n        }\n        act = next;\n        node = node.children.find(findName(act)) || null;\n      }\n      this.currentNode = node || this.hierarchy;\n    }\n\n    if (typeof dump.maxDepth !== 'undefined' || typeof dump.cutOffNode !== 'undefined') {\n      this.currentLeaves = computeLeaves(this.currentNode, this.currentMaxDepth);\n      this.updateCaches();\n    }\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  getCutOff(): ICutOffNode {\n    return {\n      node: this.currentNode,\n      maxDepth: this.currentMaxDepth,\n    };\n  }\n\n  setCutOff(value: ICutOffNode) {\n    const maxDepth = value.maxDepth == null ? Number.POSITIVE_INFINITY : value.maxDepth;\n    if (this.currentNode === value.node && this.currentMaxDepth === maxDepth) {\n      return;\n    }\n    const bak = this.getCutOff();\n    this.currentNode = value.node;\n    this.currentMaxDepth = maxDepth;\n    this.currentLeaves = computeLeaves(value.node, maxDepth);\n    this.updateCaches();\n    this.fire(\n      [HierarchyColumn.EVENT_CUTOFF_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      bak,\n      this.getCutOff()\n    );\n  }\n\n  getCategory(row: IDataRow) {\n    let v = super.getValue(row);\n    if (v == null || v === '') {\n      return null;\n    }\n    v = v.trim();\n    if (this.currentLeavesNameCache.has(v)) {\n      return this.currentLeavesNameCache.get(v)!;\n    }\n    if (this.currentLeavesPathCache.has(v)) {\n      return this.currentLeavesPathCache.get(v)!;\n    }\n    return (\n      this.currentLeaves.find((n) => {\n        //direct hit or is a child of it\n        return n.path === v || n.name === v || v!.startsWith(n.path + this.hierarchySeparator);\n      }) || null\n    );\n  }\n\n  get dataLength() {\n    return this.currentLeaves.length;\n  }\n\n  get labels() {\n    return this.currentLeaves.map((d) => d.label);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.name : null;\n  }\n\n  getCategories(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  getLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabel.call(this, row);\n  }\n\n  getColor(row: IDataRow) {\n    return CategoricalColumn.prototype.getColor.call(this, row);\n  }\n\n  getLabels(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabels.call(this, row);\n  }\n\n  getValues(row: IDataRow) {\n    return CategoricalColumn.prototype.getValues.call(this, row);\n  }\n\n  getMap(row: IDataRow) {\n    return CategoricalColumn.prototype.getMap.call(this, row);\n  }\n\n  getMapLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\n  }\n\n  getSet(row: IDataRow) {\n    return CategoricalColumn.prototype.getSet.call(this, row);\n  }\n\n  toCompareValue(row: IDataRow) {\n    return CategoricalColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return CategoricalColumn.prototype.toCompareValueType.call(this);\n  }\n\n  group(row: IDataRow): IGroup {\n    const base = this.getCategory(row);\n    if (!base) {\n      return Object.assign({}, missingGroup);\n    }\n    return { name: base.label, color: base.color };\n  }\n\n  private updateCaches() {\n    this.currentLeavesPathCache.clear();\n    this.currentLeavesNameCache.clear();\n\n    this.currentLeaves.forEach((n) => {\n      this.currentLeavesPathCache.set(n.path, n);\n      this.currentLeavesNameCache.set(n.name, n);\n    });\n  }\n}\n\nfunction computeLeaves(node: ICategoryInternalNode, maxDepth = Number.POSITIVE_INFINITY) {\n  const leaves: ICategoryInternalNode[] = [];\n  //depth first\n  const visit = (node: ICategoryInternalNode, depth: number) => {\n    //hit or end\n    if (depth >= maxDepth || node.children.length === 0) {\n      leaves.push(node);\n    } else {\n      // go down\n      node.children.forEach((c) => visit(c, depth + 1));\n    }\n  };\n  visit(node, 0);\n  return leaves;\n}\n\nexport function resolveInnerNodes(node: ICategoryInternalNode) {\n  //breath first\n  const queue: ICategoryInternalNode[] = [node];\n  let index = 0;\n  while (index < queue.length) {\n    const next = queue[index++];\n    for (const n of next.children) {\n      queue.push(n);\n    }\n  }\n  return queue;\n}\n\nexport function isHierarchical(categories: (string | Partial<ICategory>)[]) {\n  if (categories.length === 0 || typeof categories[0] === 'string') {\n    return false;\n  }\n  // check if any has a given parent name\n  return categories.some((c) => (c as any).parent != null);\n}\n\nexport function deriveHierarchy(categories: (Partial<ICategory> & { parent: string | null })[]) {\n  const lookup = new Map<string, ICategoryNode>();\n  categories.forEach((c) => {\n    const p = c.parent || '';\n    // set and fill up proxy\n    const item = Object.assign(\n      {\n        children: [],\n        label: c.name!,\n        name: c.name!,\n        color: DEFAULT_COLOR,\n        value: 0,\n      } as ICategoryNode,\n      lookup.get(c.name!) || {},\n      c\n    );\n    lookup.set(c.name!, item);\n\n    if (!lookup.has(p)) {\n      // create proxy\n      lookup.set(p, { name: p, children: [], label: p, value: 0, color: DEFAULT_COLOR });\n    }\n    lookup.get(p)!.children.push(item);\n  });\n  const root = lookup.get('')!;\n  console.assert(root !== undefined, 'hierarchy with no root');\n  if (root.children.length === 1) {\n    return root.children[0];\n  }\n  return root;\n}\n","import {interpolateRgbBasis} from \"d3-interpolate\";\n\nexport default scheme => interpolateRgbBasis(scheme[scheme.length - 1]);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"deebf79ecae13182bd\",\n  \"eff3ffbdd7e76baed62171b5\",\n  \"eff3ffbdd7e76baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5e0a1d99b31a354\",\n  \"edf8e9bae4b374c476238b45\",\n  \"edf8e9bae4b374c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"f0f0f0bdbdbd636363\",\n  \"f7f7f7cccccc969696525252\",\n  \"f7f7f7cccccc969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee6cefdae6be6550d\",\n  \"feeddefdbe85fd8d3cd94701\",\n  \"feeddefdbe85fd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"efedf5bcbddc756bb1\",\n  \"f2f0f7cbc9e29e9ac86a51a3\",\n  \"f2f0f7cbc9e29e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee0d2fc9272de2d26\",\n  \"fee5d9fcae91fb6a4acb181d\",\n  \"fee5d9fcae91fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d\"\n).map(colors);\n\nexport default ramp(scheme);\n","export const radians = Math.PI / 180;\nexport const degrees = 180 / Math.PI;\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color.js\";\nimport {degrees, radians} from \"./math.js\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * degrees - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * radians,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","import {cubehelix as colorCubehelix} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction cubehelix(hue) {\n  return (function cubehelixGamma(y) {\n    y = +y;\n\n    function cubehelix(start, end) {\n      var h = hue((start = colorCubehelix(start)).h, (end = colorCubehelix(end)).h),\n          s = color(start.s, end.s),\n          l = color(start.l, end.l),\n          opacity = color(start.opacity, end.opacity);\n      return function(t) {\n        start.h = h(t);\n        start.s = s(t);\n        start.l = l(Math.pow(t, y));\n        start.opacity = opacity(t);\n        return start + \"\";\n      };\n    }\n\n    cubehelix.gamma = cubehelixGamma;\n\n    return cubehelix;\n  })(1);\n}\n\nexport default cubehelix(hue);\nexport var cubehelixLong = cubehelix(color);\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport var warm = interpolateCubehelixLong(cubehelix(-100, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nexport var cool = interpolateCubehelixLong(cubehelix(260, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nvar c = cubehelix();\n\nexport default function(t) {\n  if (t < 0 || t > 1) t -= Math.floor(t);\n  var ts = Math.abs(t - 0.5);\n  c.h = 360 * t - 100;\n  c.s = 1.5 - 1.5 * ts;\n  c.l = 0.8 - 0.9 * ts;\n  return c + \"\";\n}\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport default interpolateCubehelixLong(cubehelix(300, 0.5, 0.0), cubehelix(-240, 0.5, 1.0));\n","import colors from \"../colors.js\";\n\nfunction ramp(range) {\n  var n = range.length;\n  return function(t) {\n    return range[Math.max(0, Math.min(n - 1, Math.floor(t * n)))];\n  };\n}\n\nexport default ramp(colors(\"44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725\"));\n\nexport var magma = ramp(colors(\"00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf\"));\n\nexport var inferno = ramp(colors(\"00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4\"));\n\nexport var plasma = ramp(colors(\"0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921\"));\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ffeda0feb24cf03b20\",\n  \"ffffb2fecc5cfd8d3ce31a1c\",\n  \"ffffb2fecc5cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fff7bcfec44fd95f0e\",\n  \"ffffd4fed98efe9929cc4c02\",\n  \"ffffd4fed98efe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5f999d8c92ca25f\",\n  \"edf8fbb2e2e266c2a4238b45\",\n  \"edf8fbb2e2e266c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e0ecf49ebcda8856a7\",\n  \"edf8fbb3cde38c96c688419d\",\n  \"edf8fbb3cde38c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e0f3dba8ddb543a2ca\",\n  \"f0f9e8bae4bc7bccc42b8cbe\",\n  \"f0f9e8bae4bc7bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee8c8fdbb84e34a33\",\n  \"fef0d9fdcc8afc8d59d7301f\",\n  \"fef0d9fdcc8afc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ece2f0a6bddb1c9099\",\n  \"f6eff7bdc9e167a9cf02818a\",\n  \"f6eff7bdc9e167a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ece7f2a6bddb2b8cbe\",\n  \"f1eef6bdc9e174a9cf0570b0\",\n  \"f1eef6bdc9e174a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e7e1efc994c7dd1c77\",\n  \"f1eef6d7b5d8df65b0ce1256\",\n  \"f1eef6d7b5d8df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fde0ddfa9fb5c51b8a\",\n  \"feebe2fbb4b9f768a1ae017e\",\n  \"feebe2fbb4b9f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"edf8b17fcdbb2c7fb8\",\n  \"ffffcca1dab441b6c4225ea8\",\n  \"ffffcca1dab441b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"f7fcb9addd8e31a354\",\n  \"ffffccc2e69978c679238443\",\n  \"ffffccc2e69978c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"d8b365f5f5f55ab4ac\",\n  \"a6611adfc27d80cdc1018571\",\n  \"a6611adfc27df5f5f580cdc1018571\",\n  \"8c510ad8b365f6e8c3c7eae55ab4ac01665e\",\n  \"8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e\",\n  \"8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e\",\n  \"8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e\",\n  \"5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30\",\n  \"5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"af8dc3f7f7f77fbf7b\",\n  \"7b3294c2a5cfa6dba0008837\",\n  \"7b3294c2a5cff7f7f7a6dba0008837\",\n  \"762a83af8dc3e7d4e8d9f0d37fbf7b1b7837\",\n  \"762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837\",\n  \"762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837\",\n  \"762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837\",\n  \"40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b\",\n  \"40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e9a3c9f7f7f7a1d76a\",\n  \"d01c8bf1b6dab8e1864dac26\",\n  \"d01c8bf1b6daf7f7f7b8e1864dac26\",\n  \"c51b7de9a3c9fde0efe6f5d0a1d76a4d9221\",\n  \"c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221\",\n  \"c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221\",\n  \"c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221\",\n  \"8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419\",\n  \"8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"998ec3f7f7f7f1a340\",\n  \"5e3c99b2abd2fdb863e66101\",\n  \"5e3c99b2abd2f7f7f7fdb863e66101\",\n  \"542788998ec3d8daebfee0b6f1a340b35806\",\n  \"542788998ec3d8daebf7f7f7fee0b6f1a340b35806\",\n  \"5427888073acb2abd2d8daebfee0b6fdb863e08214b35806\",\n  \"5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806\",\n  \"2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08\",\n  \"2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62f7f7f767a9cf\",\n  \"ca0020f4a58292c5de0571b0\",\n  \"ca0020f4a582f7f7f792c5de0571b0\",\n  \"b2182bef8a62fddbc7d1e5f067a9cf2166ac\",\n  \"b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac\",\n  \"b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac\",\n  \"b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac\",\n  \"67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061\",\n  \"67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62ffffff999999\",\n  \"ca0020f4a582bababa404040\",\n  \"ca0020f4a582ffffffbababa404040\",\n  \"b2182bef8a62fddbc7e0e0e09999994d4d4d\",\n  \"b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d\",\n  \"b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d\",\n  \"b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d\",\n  \"67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a\",\n  \"67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91bfdb\",\n  \"d7191cfdae61abd9e92c7bb6\",\n  \"d7191cfdae61ffffbfabd9e92c7bb6\",\n  \"d73027fc8d59fee090e0f3f891bfdb4575b4\",\n  \"d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4\",\n  \"d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4\",\n  \"d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4\",\n  \"a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695\",\n  \"a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91cf60\",\n  \"d7191cfdae61a6d96a1a9641\",\n  \"d7191cfdae61ffffbfa6d96a1a9641\",\n  \"d73027fc8d59fee08bd9ef8b91cf601a9850\",\n  \"d73027fc8d59fee08bffffbfd9ef8b91cf601a9850\",\n  \"d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850\",\n  \"d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850\",\n  \"a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837\",\n  \"a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf99d594\",\n  \"d7191cfdae61abdda42b83ba\",\n  \"d7191cfdae61ffffbfabdda42b83ba\",\n  \"d53e4ffc8d59fee08be6f59899d5943288bd\",\n  \"d53e4ffc8d59fee08bffffbfe6f59899d5943288bd\",\n  \"d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd\",\n  \"d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd\",\n  \"9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2\",\n  \"9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2\"\n).map(colors);\n\nexport default ramp(scheme);\n","import {\n  interpolateBlues,\n  interpolateGreens,\n  interpolateGreys,\n  interpolateOranges,\n  interpolatePurples,\n  interpolateReds,\n  interpolateCool,\n  interpolateCubehelixDefault,\n  interpolateWarm,\n  interpolatePlasma,\n  interpolateMagma,\n  interpolateViridis,\n  interpolateInferno,\n  interpolateYlOrRd,\n  interpolateYlOrBr,\n  interpolateBuGn,\n  interpolateBuPu,\n  interpolateGnBu,\n  interpolateOrRd,\n  interpolatePuBuGn,\n  interpolatePuBu,\n  interpolatePuRd,\n  interpolateRdPu,\n  interpolateYlGnBu,\n  interpolateYlGn,\n  interpolateRainbow,\n  interpolateBrBG,\n  interpolatePRGn,\n  interpolatePiYG,\n  interpolatePuOr,\n  interpolateRdBu,\n  interpolateRdGy,\n  interpolateRdYlBu,\n  interpolateRdYlGn,\n  interpolateSpectral,\n} from 'd3-scale-chromatic';\nimport { equal } from '../internal';\nimport { scaleLinear } from 'd3-scale';\nimport { DEFAULT_COLOR } from './Column';\nimport type { ITypedDump, ITypeFactory } from './interfaces';\nimport type { IColorMappingFunction, IColorMappingFunctionConstructor } from './INumberColumn';\n\nexport class SequentialColorFunction implements IColorMappingFunction {\n  public static readonly FUNCTIONS: { [key: string]: (v: number) => string } = {\n    interpolateBlues,\n    interpolateGreens,\n    interpolateGreys,\n    interpolateOranges,\n    interpolatePurples,\n    interpolateReds,\n    interpolateCool,\n    interpolateCubehelixDefault,\n    interpolateWarm,\n    interpolatePlasma,\n    interpolateMagma,\n    interpolateViridis,\n    interpolateInferno,\n    interpolateYlOrRd,\n    interpolateYlOrBr,\n    interpolateBuGn,\n    interpolateBuPu,\n    interpolateGnBu,\n    interpolateOrRd,\n    interpolatePuBuGn,\n    interpolatePuBu,\n    interpolatePuRd,\n    interpolateRdPu,\n    interpolateYlGnBu,\n    interpolateYlGn,\n    interpolateRainbow,\n  };\n\n  public readonly apply: (v: number) => string;\n\n  constructor(public readonly name: string) {\n    this.apply = SequentialColorFunction.FUNCTIONS[name] || interpolateBlues;\n  }\n\n  toJSON() {\n    return this.name;\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof SequentialColorFunction && other.name === this.name;\n  }\n}\n\nexport class DivergentColorFunction implements IColorMappingFunction {\n  public static readonly FUNCTIONS: { [key: string]: (v: number) => string } = {\n    interpolateBrBG,\n    interpolatePRGn,\n    interpolatePiYG,\n    interpolatePuOr,\n    interpolateRdBu,\n    interpolateRdGy,\n    interpolateRdYlBu,\n    interpolateRdYlGn,\n    interpolateSpectral,\n  };\n\n  public readonly apply: (v: number) => string;\n\n  constructor(public readonly name: string) {\n    this.apply = DivergentColorFunction.FUNCTIONS[name] || interpolateBlues;\n  }\n\n  toJSON() {\n    return this.name;\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof DivergentColorFunction && other.name === this.name;\n  }\n}\n\nexport class UnknownColorFunction implements IColorMappingFunction {\n  constructor(public readonly apply: (v: number) => string) {}\n\n  toJSON() {\n    return this.apply.toString();\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof UnknownColorFunction && other.apply === this.apply;\n  }\n}\n\nexport class SolidColorFunction implements IColorMappingFunction {\n  constructor(public readonly color: string) {}\n\n  apply() {\n    return this.color;\n  }\n\n  toJSON() {\n    return this.color;\n  }\n\n  clone() {\n    return this; // no clone needed since not parameterized\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof SolidColorFunction && other.color === this.color;\n  }\n}\n\nexport class QuantizedColorFunction implements IColorMappingFunction {\n  public readonly base: IColorMappingFunction;\n  public readonly steps: number;\n\n  constructor(dump: ITypedDump, factory: ITypeFactory);\n  constructor(base: IColorMappingFunction, steps: number);\n  constructor(base: IColorMappingFunction | ITypedDump, steps: number | ITypeFactory) {\n    if (typeof (base as any).apply === 'function') {\n      this.base = base as IColorMappingFunction;\n      this.steps = steps == null ? 5 : (steps as number);\n    } else {\n      const dump = base as ITypedDump;\n      this.base = (steps as ITypeFactory).colorMappingFunction(dump.base);\n      this.steps = dump.steps;\n    }\n  }\n\n  apply(v: number) {\n    return this.base.apply(quantize(v, this.steps));\n  }\n\n  toJSON() {\n    return {\n      type: 'quantized',\n      base: this.base.toJSON(),\n      steps: this.steps,\n    };\n  }\n\n  clone(): QuantizedColorFunction {\n    return new QuantizedColorFunction(this.base.clone(), this.steps);\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof QuantizedColorFunction && other.base.eq(this.base) && other.steps === this.steps;\n  }\n}\n\nexport class CustomColorMappingFunction implements IColorMappingFunction {\n  private readonly scale = scaleLinear<string>();\n  public readonly entries: { value: number; color: string }[];\n\n  constructor(dump: ITypedDump);\n  constructor(entries: { value: number; color: string }[]);\n  constructor(entries: ITypedDump | { value: number; color: string }[]) {\n    this.entries = Array.isArray(entries) ? entries : entries.entries;\n    this.scale\n      .domain(this.entries.map((d) => d.value))\n      .range(this.entries.map((d) => d.color))\n      .clamp(true);\n  }\n\n  apply(v: number) {\n    return this.scale(v);\n  }\n\n  toJSON() {\n    return {\n      type: 'custom',\n      entries: this.entries,\n    };\n  }\n\n  clone() {\n    return new CustomColorMappingFunction(this.entries.slice());\n  }\n\n  eq(other: IColorMappingFunction): boolean {\n    return other instanceof CustomColorMappingFunction && equal(this.entries, other.entries);\n  }\n}\n\n/**\n * @internal\n */\nexport function quantize(v: number, steps: number) {\n  const perStep = 1 / steps;\n  if (v <= perStep) {\n    return 0;\n  }\n  if (v >= 1 - perStep) {\n    return 1;\n  }\n  for (let acc = 0; acc < 1; acc += perStep) {\n    if (v < acc) {\n      return acc - perStep / 2; // center\n    }\n  }\n  return v;\n}\n\nexport function colorMappingFunctions() {\n  const types: any = {\n    [DEFAULT_COLOR]: SolidColorFunction,\n    quantized: QuantizedColorFunction,\n    custom: CustomColorMappingFunction,\n  };\n  for (const key of Object.keys(SequentialColorFunction.FUNCTIONS)) {\n    types[key] = SequentialColorFunction;\n  }\n  for (const key of Object.keys(DivergentColorFunction.FUNCTIONS)) {\n    types[key] = DivergentColorFunction;\n  }\n  return types;\n}\n\nexport const DEFAULT_COLOR_FUNCTION = new SolidColorFunction(DEFAULT_COLOR);\n\n/**\n * @internal\n */\nexport function createColorMappingFunction(\n  types: { [type: string]: IColorMappingFunctionConstructor },\n  factory: ITypeFactory\n) {\n  return (dump: ITypedDump | string | ((v: number) => string)): IColorMappingFunction => {\n    if (!dump) {\n      return DEFAULT_COLOR_FUNCTION;\n    }\n    if (typeof dump === 'function') {\n      return new UnknownColorFunction(dump);\n    }\n    const typeName = typeof dump === 'string' ? dump : dump.type;\n    const type = types[typeName];\n    if (type) {\n      return new type(dump, factory);\n    }\n    if (Array.isArray(dump)) {\n      return new CustomColorMappingFunction(dump);\n    }\n    return new SolidColorFunction(dump.toString());\n  };\n}\n","import { suffix, IEventListener, ISequence } from '../internal';\nimport { toolbar, SortByDefault } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport {\n  isNumberColumn,\n  INumberColumn,\n  isMapAbleColumn,\n  IColorMappingFunction,\n  IMappingFunction,\n  IMapAbleColumn,\n  INumberFilter,\n} from './INumberColumn';\nimport NumberColumn from './NumberColumn';\nimport { DEFAULT_FORMATTER, noNumberFilter } from './internalNumber';\nimport { ScaleMappingFunction } from './MappingFunction';\nimport { DEFAULT_COLOR_FUNCTION } from './ColorMappingFunction';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createImpositionDesc(label = 'Imposition') {\n  return { type: 'imposition', label };\n}\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ImpositionCompositeColumn\n * @event\n */\nexport declare function mappingChanged_ICC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ImpositionCompositeColumn\n * @event\n */\nexport declare function colorMappingChanged_ICC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@SortByDefault('descending')\nexport default class ImpositionCompositeColumn extends CompositeColumn implements INumberColumn, IMapAbleColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'number',\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'histogram',\n      })\n    );\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Imposition' || c.length === 0) {\n      return l;\n    }\n    if (c.length === 1) {\n      return c[0].label;\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\n  }\n\n  private get wrapper(): INumberColumn | null {\n    return (this._children.find(isNumberColumn) as INumberColumn) ?? null;\n  }\n\n  private get rest() {\n    const w = this.wrapper;\n    return this._children.filter((d) => d !== w);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_ICC | null\n  ): this;\n  on(type: typeof ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_ICC | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getLabel(row: IDataRow) {\n    const c = this._children;\n    if (c.length === 0) {\n      return '';\n    }\n    if (c.length === 1) {\n      return c[0].getLabel(row);\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`).join(', ')})`;\n  }\n\n  getColor(row: IDataRow) {\n    const c = this._children;\n    switch (c.length) {\n      case 0:\n        return DEFAULT_COLOR;\n      case 1:\n        return c[0].getColor(row);\n      default:\n        return this.rest[0].getColor(row);\n    }\n  }\n\n  getNumberFormat() {\n    const w = this.wrapper;\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\n  }\n\n  getValue(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValue(row) : NaN;\n  }\n\n  getNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumber(row) : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumber(row) : NaN;\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getRawNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        label: this.getLabel(row),\n        color: this.getColor(row),\n        value,\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getMapping() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getMapping() : new ScaleMappingFunction();\n  }\n\n  getOriginalMapping() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getOriginalMapping() : new ScaleMappingFunction();\n  }\n\n  setMapping(mapping: IMappingFunction): void {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.setMapping(mapping) : undefined;\n  }\n\n  getColorMapping() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.setColorMapping(mapping) : undefined;\n  }\n\n  getFilter() {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getFilter() : noNumberFilter();\n  }\n\n  setFilter(value: INumberFilter | null): void {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.setFilter(value) : undefined;\n  }\n\n  getRange(): [string, string] {\n    const w = this.wrapper;\n    return w && isMapAbleColumn(w) ? w.getRange() : ['0', '1'];\n  }\n\n  toCompareValue(row: IDataRow) {\n    return NumberColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return NumberColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return NumberColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return NumberColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  insert(col: Column, index: number): Column | null {\n    if (this._children.length === 1 && !this.wrapper && !isNumberColumn(col)) {\n      // at least one has to be a number column\n      return null;\n    }\n    if (this._children.length >= 2) {\n      // limit to two\n      return null;\n    }\n    return super.insert(col, index);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    if (isNumberColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.insertImpl(col, index);\n  }\n\n  protected removeImpl(child: Column, index: number) {\n    if (isNumberColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.removeImpl(child, index);\n  }\n}\n","import { format } from 'd3-format';\nimport { boxplotBuilder, IAdvancedBoxPlotData, IEventListener } from '../internal';\nimport { dialogAddons, SortByDefault, toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport type { IArrayDesc } from './IArrayColumn';\nimport { IDataRow, ECompareValueType, ITypeFactory } from './interfaces';\nimport {\n  DEFAULT_FORMATTER,\n  getBoxPlotNumber,\n  isDummyNumberFilter,\n  noNumberFilter,\n  restoreNumberFilter,\n  toCompareBoxPlotValue,\n} from './internalNumber';\nimport {\n  EAdvancedSortMethod,\n  IColorMappingFunction,\n  IMappingFunction,\n  INumberDesc,\n  INumberFilter,\n  INumbersColumn,\n} from './INumberColumn';\nimport { restoreMapping } from './MappingFunction';\nimport { isMissingValue } from './missing';\nimport NumberColumn from './NumberColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport { integrateDefaults } from './internal';\n\nexport interface INumbersDesc extends IArrayDesc, INumberDesc {\n  readonly sort?: EAdvancedSortMethod;\n}\n\nexport declare type INumbersColumnDesc = INumbersDesc & IArrayColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function mappingChanged_NCS(previous: IMappingFunction, current: IMappingFunction): void;\n/**\n * emitted when the color mapping property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function colorMappingChanged_NCS(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function sortMethodChanged_NCS(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumbersColumn\n * @event\n */\nexport declare function filterChanged_NCS(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortNumbers')\n@SortByDefault('descending')\nexport default class NumbersColumn extends ArrayColumn<number> implements INumbersColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\n\n  static readonly CENTER = 0;\n\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\n\n  private sort: EAdvancedSortMethod;\n  private mapping: IMappingFunction;\n  private original: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<INumbersColumnDesc>, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(\n        desc,\n        Object.assign(\n          {\n            renderer: 'heatmap',\n            groupRenderer: 'heatmap',\n            summaryRenderer: 'histogram',\n          },\n          desc.dataLength != null && !Number.isNaN(desc.dataLength)\n            ? {\n                // better initialize the default with based on the data length\n                width: Math.min(Math.max(100, desc.dataLength! * 10), 500),\n              }\n            : {}\n        )\n      )\n    );\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n\n    this.sort = desc.sort || EAdvancedSortMethod.median;\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  toCompareValue(row: IDataRow): number {\n    return toCompareBoxPlotValue(this, row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getRawNumbers(row: IDataRow) {\n    return this.getRawValue(row);\n  }\n\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d) ? NaN : this.mapping.apply(d));\n    }\n    return b.build();\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d) ? NaN : d);\n    }\n    return b.build();\n  }\n\n  getNumbers(row: IDataRow) {\n    return this.getValues(row);\n  }\n\n  getNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'normalized');\n  }\n\n  getRawNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'raw');\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getValues(row);\n    return v.every(Number.isNaN) ? null : v;\n  }\n\n  getValues(row: IDataRow) {\n    return this.getRawValue(row).map((d) => (Number.isNaN(d) ? NaN : this.mapping.apply(d)));\n  }\n\n  iterNumber(row: IDataRow) {\n    const v = this.getNumbers(row);\n    if (v.every(Number.isNaN)) {\n      // missing row\n      return [NaN];\n    }\n    return v;\n  }\n\n  iterRawNumber(row: IDataRow) {\n    const v = this.getRawNumbers(row);\n    if (v.every(Number.isNaN)) {\n      // missing row\n      return [NaN];\n    }\n    return v;\n  }\n\n  getRawValue(row: IDataRow) {\n    const r = super.getRaw(row);\n    return r == null ? [] : r.map((d) => (isMissingValue(d) ? NaN : +d));\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getRawValue(row).map(this.numberFormat);\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EAdvancedSortMethod) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire(\n      [\n        NumbersColumn.EVENT_SORTMETHOD_CHANGED,\n        NumberColumn.EVENT_DIRTY_HEADER,\n        NumberColumn.EVENT_DIRTY_VALUES,\n        NumbersColumn.EVENT_DIRTY_CACHES,\n        NumberColumn.EVENT_DIRTY,\n      ],\n      this.sort,\n      (this.sort = sort)\n    );\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        NumbersColumn.EVENT_COLOR_MAPPING_CHANGED,\n        NumbersColumn.EVENT_MAPPING_CHANGED,\n        NumbersColumn.EVENT_SORTMETHOD_CHANGED,\n        NumbersColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NCS | null): this;\n  on(type: typeof NumbersColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NCS | null): this;\n  on(type: typeof NumbersColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NCS | null): this;\n  on(type: typeof NumbersColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        NumbersColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        NumbersColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { suffix, IBoxPlotData, ISequence, IEventListener } from '../internal';\nimport { toolbar, SortByDefault, dialogAddons } from './annotations';\nimport BoxPlotColumn from './BoxPlotColumn';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport {\n  ESortMethod,\n  IBoxPlotColumn,\n  INumberFilter,\n  isBoxPlotColumn,\n  IMappingFunction,\n  IColorMappingFunction,\n  isMapAbleColumn,\n} from './INumberColumn';\nimport { ScaleMappingFunction } from './MappingFunction';\nimport NumbersColumn from './NumbersColumn';\nimport { DEFAULT_COLOR_FUNCTION } from './ColorMappingFunction';\nimport { DEFAULT_FORMATTER, noNumberFilter } from './internalNumber';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createImpositionBoxPlotDesc(label = 'Imposition') {\n  return { type: 'impositions', label };\n}\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ImpositionBoxPlotColumn\n * @event\n */\nexport declare function mappingChanged_IPBC(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ImpositionBoxPlotColumn\n * @event\n */\nexport declare function colorMappingChanged_IPBC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortBoxPlot')\n@SortByDefault('descending')\nexport default class ImpositionBoxPlotColumn extends CompositeColumn implements IBoxPlotColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'boxplot',\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'boxplot',\n      })\n    );\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Imposition' || c.length === 0) {\n      return l;\n    }\n    if (c.length === 1) {\n      return c[0].label;\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\n  }\n\n  private get wrapper(): IBoxPlotColumn | null {\n    return this._children.find(isBoxPlotColumn) ?? null;\n  }\n\n  private get rest() {\n    const w = this.wrapper;\n    return this._children.filter((d) => d !== w);\n  }\n\n  getLabel(row: IDataRow) {\n    const c = this._children;\n    if (c.length === 0) {\n      return '';\n    }\n    if (c.length === 1) {\n      return c[0].getLabel(row);\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\n  }\n\n  getColor(row: IDataRow) {\n    const c = this._children;\n    switch (c.length) {\n      case 0:\n        return DEFAULT_COLOR;\n      case 1:\n        return c[0].getColor(row);\n      default:\n        return this.rest[0].getColor(row);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED]);\n  }\n\n  on(\n    type: typeof ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_IPBC | null\n  ): this;\n  on(type: typeof ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_IPBC | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getNumberFormat() {\n    const w = this.wrapper;\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\n  }\n\n  getValue(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValue(row) : null;\n  }\n\n  getNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumber(row) : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumber(row) : NaN;\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getRawNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        label: this.getLabel(row),\n        color: this.getColor(row),\n        value,\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getBoxPlotData(row) : null;\n  }\n\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getRawBoxPlotData(row) : null;\n  }\n\n  getMapping() {\n    const w = this.wrapper;\n    return w ? w.getMapping() : new ScaleMappingFunction();\n  }\n\n  getOriginalMapping() {\n    const w = this.wrapper;\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\n  }\n\n  getSortMethod() {\n    const w = this.wrapper;\n    return w ? w.getSortMethod() : ESortMethod.min;\n  }\n\n  setSortMethod(value: ESortMethod) {\n    const w = this.wrapper;\n    return w ? w.setSortMethod(value) : undefined;\n  }\n\n  setMapping(mapping: IMappingFunction): void {\n    const w = this.wrapper;\n    return w ? w.setMapping(mapping) : undefined;\n  }\n\n  getColorMapping() {\n    const w = this.wrapper;\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    const w = this.wrapper;\n    return w ? w.setColorMapping(mapping) : undefined;\n  }\n\n  getFilter() {\n    const w = this.wrapper;\n    return w ? w.getFilter() : noNumberFilter();\n  }\n\n  setFilter(value: INumberFilter | null): void {\n    const w = this.wrapper;\n    return w ? w.setFilter(value) : undefined;\n  }\n\n  getRange(): [string, string] {\n    const w = this.wrapper;\n    return w ? w.getRange() : ['0', '1'];\n  }\n\n  toCompareValue(row: IDataRow) {\n    return BoxPlotColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return BoxPlotColumn.prototype.toCompareValueType.call(this);\n  }\n\n  group(row: IDataRow) {\n    return BoxPlotColumn.prototype.group.call(this, row);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return BoxPlotColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return BoxPlotColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  insert(col: Column, index: number): Column | null {\n    if (this._children.length === 1 && !this.wrapper && !isBoxPlotColumn(col)) {\n      // at least one has to be a number column\n      return null;\n    }\n    if (this._children.length >= 2) {\n      // limit to two\n      return null;\n    }\n    return super.insert(col, index);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    if (isBoxPlotColumn(col)) {\n      this.forward(\n        col,\n        ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED)\n      );\n    } else if (isMapAbleColumn(col)) {\n      this.forward(col, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.insertImpl(col, index);\n  }\n\n  protected removeImpl(child: Column, index: number) {\n    if (isBoxPlotColumn(child)) {\n      this.unforward(\n        child,\n        ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED)\n      );\n    } else if (isMapAbleColumn(child)) {\n      this.unforward(child, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.removeImpl(child, index);\n  }\n}\n","import { suffix, IEventListener, IAdvancedBoxPlotData } from '../internal';\nimport { toolbar, dialogAddons, SortByDefault } from './annotations';\nimport type Column from './Column';\nimport {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport {\n  EAdvancedSortMethod,\n  INumberFilter,\n  INumbersColumn,\n  isNumbersColumn,\n  IMappingFunction,\n  IColorMappingFunction,\n  isMapAbleColumn,\n} from './INumberColumn';\nimport { ScaleMappingFunction } from './MappingFunction';\nimport NumbersColumn from './NumbersColumn';\nimport { DEFAULT_COLOR_FUNCTION } from './ColorMappingFunction';\nimport { DEFAULT_FORMATTER, noNumberFilter } from './internalNumber';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createImpositionsDesc(label = 'Imposition') {\n  return { type: 'impositions', label };\n}\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ImpositionCompositesColumn\n * @event\n */\nexport declare function mappingChanged_ICCS(previous: IMappingFunction, current: IMappingFunction): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ImpositionCompositesColumn\n * @event\n */\nexport declare function colorMappingChanged_ICCS(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortNumbers')\n@SortByDefault('descending')\nexport default class ImpositionCompositesColumn extends CompositeColumn implements INumbersColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'numbers',\n        groupRenderer: 'numbers',\n        summaryRenderer: 'histogram',\n      })\n    );\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Imposition' || c.length === 0) {\n      return l;\n    }\n    if (c.length === 1) {\n      return c[0].label;\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.label : '?'} (${rest.map((c) => c.label).join(', ')})`;\n  }\n\n  private get wrapper(): INumbersColumn | null {\n    return (this._children.find(isNumbersColumn) as INumbersColumn) || null;\n  }\n\n  private get rest() {\n    const w = this.wrapper;\n    return this._children.filter((d) => d !== w);\n  }\n\n  getLabel(row: IDataRow) {\n    const c = this._children;\n    if (c.length === 0) {\n      return '';\n    }\n    if (c.length === 1) {\n      return c[0].getLabel(row);\n    }\n    const w = this.wrapper;\n    const rest = this.rest;\n    return `${w ? w.getLabel(row) : '?'} (${rest.map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\n  }\n\n  getColor(row: IDataRow) {\n    const c = this._children;\n    switch (c.length) {\n      case 0:\n        return DEFAULT_COLOR;\n      case 1:\n        return c[0].getColor(row);\n      default:\n        return this.rest[0].getColor(row);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ImpositionCompositesColumn.EVENT_MAPPING_CHANGED,\n        ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED,\n      ]);\n  }\n\n  on(\n    type: typeof ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED,\n    listener: typeof colorMappingChanged_ICCS | null\n  ): this;\n  on(type: typeof ImpositionCompositesColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_ICCS | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  get labels() {\n    const w = this.wrapper;\n    return w ? w.labels : [];\n  }\n\n  get dataLength() {\n    const w = this.wrapper;\n    return w ? w.dataLength : null;\n  }\n\n  getNumberFormat() {\n    const w = this.wrapper;\n    return w ? w.getNumberFormat() : DEFAULT_FORMATTER;\n  }\n\n  getValue(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValue(row) : [];\n  }\n\n  getNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumber(row) : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumber(row) : NaN;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getRawNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        label: this.getLabels(row),\n        color: this.getColor(row),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getNumbers(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getNumbers(row) : [];\n  }\n\n  getRawNumbers(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getRawNumbers(row) : [];\n  }\n\n  iterNumber(row: IDataRow) {\n    return this.getNumbers(row);\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return this.getRawNumbers(row);\n  }\n\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getBoxPlotData(row) : null;\n  }\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const w = this.wrapper;\n    return w ? w.getRawBoxPlotData(row) : null;\n  }\n\n  getMapping() {\n    const w = this.wrapper;\n    return w ? w.getMapping() : new ScaleMappingFunction();\n  }\n\n  getOriginalMapping() {\n    const w = this.wrapper;\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\n  }\n\n  getSortMethod() {\n    const w = this.wrapper;\n    return w ? w.getSortMethod() : EAdvancedSortMethod.min;\n  }\n\n  setSortMethod(value: EAdvancedSortMethod) {\n    const w = this.wrapper;\n    return w ? w.setSortMethod(value) : undefined;\n  }\n\n  setMapping(mapping: IMappingFunction): void {\n    const w = this.wrapper;\n    return w ? w.setMapping(mapping) : undefined;\n  }\n\n  getColorMapping() {\n    const w = this.wrapper;\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    const w = this.wrapper;\n    return w ? w.setColorMapping(mapping) : undefined;\n  }\n\n  getFilter() {\n    const w = this.wrapper;\n    return w ? w.getFilter() : noNumberFilter();\n  }\n\n  setFilter(value: INumberFilter | null): void {\n    const w = this.wrapper;\n    return w ? w.setFilter(value) : undefined;\n  }\n\n  getRange(): [string, string] {\n    const w = this.wrapper;\n    return w ? w.getRange() : ['0', '1'];\n  }\n\n  getMap(row: IDataRow): IKeyValue<number>[] {\n    const w = this.wrapper;\n    return w ? w.getMap(row) : [];\n  }\n\n  getMapLabel(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getMapLabel(row) : [];\n  }\n\n  getLabels(row: IDataRow): string[] {\n    const w = this.wrapper;\n    return w ? w.getLabels(row) : [];\n  }\n\n  getValues(row: IDataRow) {\n    const w = this.wrapper;\n    return w ? w.getValues(row) : [];\n  }\n\n  toCompareValue(row: IDataRow) {\n    return NumbersColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return NumbersColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: IDataRow[], group: IGroup) {\n    return NumbersColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return NumbersColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  insert(col: Column, index: number): Column | null {\n    if (this._children.length === 1 && !this.wrapper && !isNumbersColumn(col)) {\n      // at least one has to be a number column\n      return null;\n    }\n    if (this._children.length >= 2) {\n      // limit to two\n      return null;\n    }\n    return super.insert(col, index);\n  }\n\n  protected insertImpl(col: Column, index: number) {\n    if (isNumbersColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(col)) {\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.insertImpl(col, index);\n  }\n\n  protected removeImpl(child: Column, index: number) {\n    if (isNumbersColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\n    }\n    if (isMapAbleColumn(child)) {\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\n    }\n    return super.removeImpl(child, index);\n  }\n}\n","import { format } from 'd3-format';\nimport CompositeColumn from './CompositeColumn';\nimport type { IDataRow, IGroup, IColumnDesc } from './interfaces';\nimport { isMissingValue } from './missing';\nimport NumberColumn from './NumberColumn';\nimport { SortByDefault, toolbar } from './annotations';\nimport type { ISequence } from '../internal';\nimport type { INumberColumn } from './INumberColumn';\n\nexport interface ICompositeNumberDesc extends IColumnDesc {\n  /**\n   * d3 format number Format\n   * @default 0.3n\n   */\n  numberFormat?: string;\n}\n\nexport declare type ICompositeNumberColumnDesc = ICompositeNumberDesc & IColumnDesc;\n\n/**\n * implementation of a combine column, standard operations how to select\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'groupBy')\n@SortByDefault('descending')\nexport default class CompositeNumberColumn extends CompositeColumn implements INumberColumn {\n  private readonly numberFormat: (n: number) => string = format('.3n');\n\n  constructor(id: string, desc: Readonly<ICompositeNumberColumnDesc>) {\n    super(id, desc);\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  getLabel(row: IDataRow) {\n    if (!this.isLoaded()) {\n      return '';\n    }\n    const v = this.getValue(row);\n    //keep non number if it is not a number else convert using formatter\n    return String(typeof v === 'number' && !Number.isNaN(v) && isFinite(v) ? this.numberFormat(v) : v);\n  }\n\n  getValue(row: IDataRow) {\n    if (!this.isLoaded()) {\n      return null;\n    }\n    //weighted sum\n    const v = this.compute(row);\n    if (isMissingValue(v)) {\n      return null;\n    }\n    return v;\n  }\n\n  protected compute(_row: IDataRow) {\n    return NaN;\n  }\n\n  getNumber(row: IDataRow) {\n    const r = this.getValue(row);\n    return r == null ? NaN : r;\n  }\n\n  getRawNumber(row: IDataRow) {\n    return this.getNumber(row);\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  toCompareValue(row: IDataRow) {\n    return NumberColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return NumberColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return NumberColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return NumberColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  getRenderer(): string {\n    return NumberColumn.prototype.getRenderer.call(this);\n  }\n}\n","import { median, quantile, IEventListener } from '../internal';\nimport { toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n  DEFAULT_COLOR,\n} from './Column';\nimport type CompositeColumn from './CompositeColumn';\nimport type { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport CompositeNumberColumn, { ICompositeNumberColumnDesc } from './CompositeNumberColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { EAdvancedSortMethod } from './INumberColumn';\nimport { integrateDefaults } from './internal';\n\n/**\n *  factory for creating a description creating a max column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createReduceDesc(label = 'Reduce') {\n  return { type: 'reduce', label };\n}\n\nexport interface IReduceDesc {\n  readonly reduce?: EAdvancedSortMethod;\n}\n\nexport declare type IReduceColumnDesc = IReduceDesc & ICompositeNumberColumnDesc;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ReduceColumn\n * @event\n */\nexport declare function reduceChanged(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * combines multiple columns by using the maximal value\n */\n@toolbar('reduce')\nexport default class ReduceColumn extends CompositeNumberColumn {\n  static readonly EVENT_REDUCE_CHANGED = 'reduceChanged';\n\n  private reduce: EAdvancedSortMethod;\n\n  constructor(id: string, desc: Readonly<IReduceColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'interleaving',\n        groupRenderer: 'interleaving',\n        summaryRenderer: 'interleaving',\n      })\n    );\n    this.reduce = desc.reduce || EAdvancedSortMethod.max;\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    if (l !== 'Reduce') {\n      return l;\n    }\n    return `${this.reduce[0].toUpperCase()}${this.reduce.slice(1)}(${this.children.map((d) => d.label).join(', ')})`;\n  }\n\n  getColor(row: IDataRow) {\n    //compute the index of the maximal one\n    const c = this._children;\n    if (\n      c.length === 0 ||\n      this.reduce === EAdvancedSortMethod.q1 ||\n      this.reduce === EAdvancedSortMethod.q3 ||\n      this.reduce === EAdvancedSortMethod.mean\n    ) {\n      return DEFAULT_COLOR;\n    }\n    const v = this.compute(row);\n    const selected = c.find((c) => c.getValue(row) === v);\n    return selected ? selected.getColor(row) : DEFAULT_COLOR;\n  }\n\n  protected compute(row: IDataRow) {\n    const vs = this._children.map((d) => d.getValue(row)).filter((d) => !Number.isNaN(d));\n    if (vs.length === 0) {\n      return NaN;\n    }\n    switch (this.reduce) {\n      case EAdvancedSortMethod.mean:\n        return vs.reduce((a, b) => a + b, 0) / vs.length;\n      case EAdvancedSortMethod.max:\n        return vs.reduce((a, b) => Math.max(a, b), Number.NEGATIVE_INFINITY);\n      case EAdvancedSortMethod.min:\n        return vs.reduce((a, b) => Math.min(a, b), Number.POSITIVE_INFINITY);\n      case EAdvancedSortMethod.median:\n        return median(vs)!;\n      case EAdvancedSortMethod.q1:\n        return quantile(\n          vs.sort((a, b) => a - b),\n          0.25\n        )!;\n      case EAdvancedSortMethod.q3:\n        return quantile(\n          vs.sort((a, b) => a - b),\n          0.75\n        )!;\n    }\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([ReduceColumn.EVENT_REDUCE_CHANGED]);\n  }\n\n  on(type: typeof ReduceColumn.EVENT_REDUCE_CHANGED, listener: typeof reduceChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  getReduce() {\n    return this.reduce;\n  }\n\n  setReduce(reduce: EAdvancedSortMethod) {\n    if (this.reduce === reduce) {\n      return;\n    }\n    this.fire(\n      [ReduceColumn.EVENT_REDUCE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY],\n      this.reduce,\n      (this.reduce = reduce)\n    );\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.reduce = this.reduce;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    this.reduce = dump.reduce || this.reduce;\n    super.restore(dump, factory);\n  }\n\n  get canJustAddNumbers() {\n    return true;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n}\n","import { round, IEventListener, similar } from '../internal';\nimport { toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type CompositeColumn from './CompositeColumn';\nimport type { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport CompositeNumberColumn, { ICompositeNumberDesc } from './CompositeNumberColumn';\nimport type { IDataRow, IFlatColumn, IMultiLevelColumn, ITypeFactory } from './interfaces';\nimport { integrateDefaults } from './internal';\n\n/**\n * factory for creating a description creating a stacked column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createStackDesc(label = 'Weighted Sum', showNestedSummaries = true): IStackColumnColumnDesc {\n  return { type: 'stack', label, showNestedSummaries };\n}\n\n/**\n * emitted when the collapse property changes\n * @asMemberOf StackColumn\n * @event\n */\nexport declare function collapseChanged(previous: boolean, current: boolean): void;\n\n/**\n * emitted when the weights change\n * @asMemberOf StackColumn\n * @event\n */\nexport declare function weightsChanged(previous: number[], current: number[]): void;\n\n/**\n * emitted when the ratios between the children changes\n * @asMemberOf StackColumn\n * @event\n */\nexport declare function nestedChildRatio(previous: number[], current: number[]): void;\n\nexport declare type IStackColumnColumnDesc = ICompositeNumberDesc & {\n  /**\n   * show nested summaries\n   * @default true\n   */\n  showNestedSummaries?: boolean;\n};\n\n/**\n * implementation of the stacked column\n */\n@toolbar('editWeights', 'compress', 'expand')\nexport default class StackColumn extends CompositeNumberColumn implements IMultiLevelColumn {\n  static readonly EVENT_COLLAPSE_CHANGED = 'collapseChanged';\n  static readonly EVENT_WEIGHTS_CHANGED = 'weightsChanged';\n  static readonly EVENT_MULTI_LEVEL_CHANGED = 'nestedChildRatio';\n\n  static readonly COLLAPSED_RENDERER = 'number';\n\n  private readonly adaptChange: (old: number, newValue: number) => void;\n\n  /**\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\n   * @type {boolean}\n   * @private\n   */\n  private collapsed = false;\n\n  constructor(id: string, desc: IStackColumnColumnDesc) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'stack',\n        groupRenderer: 'stack',\n        summaryRenderer: 'stack',\n      })\n    );\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.adaptChange = function (this: { source: Column }, oldValue, newValue) {\n      that.adaptWidthChange(this.source, oldValue, newValue);\n    };\n  }\n\n  get label() {\n    const l = super.getMetaData().label;\n    const c = this._children;\n    if (l !== 'Weighted Sum' || c.length === 0) {\n      return l;\n    }\n    const weights = this.getWeights();\n    return c.map((c, i) => `${c.label} (${round(100 * weights[i], 1)}%)`).join(' + ');\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        StackColumn.EVENT_COLLAPSE_CHANGED,\n        StackColumn.EVENT_WEIGHTS_CHANGED,\n        StackColumn.EVENT_MULTI_LEVEL_CHANGED,\n      ]);\n  }\n\n  on(type: typeof StackColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged | null): this;\n  on(type: typeof StackColumn.EVENT_WEIGHTS_CHANGED, listener: typeof weightsChanged | null): this;\n  on(type: typeof StackColumn.EVENT_MULTI_LEVEL_CHANGED, listener: typeof nestedChildRatio | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setCollapsed(value: boolean) {\n    if (this.collapsed === value) {\n      return;\n    }\n    this.fire(\n      [StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.collapsed,\n      (this.collapsed = value)\n    );\n  }\n\n  getCollapsed() {\n    return this.collapsed;\n  }\n\n  isShowNestedSummaries() {\n    return (this.desc as IStackColumnColumnDesc).showNestedSummaries !== false;\n  }\n\n  get canJustAddNumbers() {\n    return true;\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    let self = null;\n    const children =\n      levelsToGo <= Column.FLAT_ALL_COLUMNS ? this._children : this._children.filter((c) => c.isVisible());\n    //no more levels or just this one\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\n      let w = this.getWidth();\n      if (!this.collapsed) {\n        w += (children.length - 1) * padding;\n      }\n      r.push((self = { col: this, offset, width: w }));\n      if (levelsToGo === 0) {\n        return w;\n      }\n    }\n    //push children\n    let acc = offset;\n    children.forEach((c) => {\n      acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\n    });\n    if (self) {\n      //nesting my even increase my width\n      self.width = acc - offset - padding;\n    }\n    return acc - offset - padding;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.collapsed = this.collapsed;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    this.collapsed = dump.collapsed === true;\n    super.restore(dump, factory);\n  }\n\n  /**\n   * inserts a column at a the given position\n   */\n  insert(col: Column, index: number, weight = NaN) {\n    if (!Number.isNaN(weight)) {\n      col.setWidth((weight / (1 - weight)) * this.getWidth());\n    }\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\n    //increase my width\n    super.setWidth(this.length === 0 ? col.getWidth() : this.getWidth() + col.getWidth());\n\n    return super.insert(col, index);\n  }\n\n  push(col: Column, weight = NaN) {\n    return this.insert(col, this.length, weight);\n  }\n\n  insertAfter(col: Column, ref: Column, weight = NaN) {\n    const i = this.indexOf(ref);\n    if (i < 0) {\n      return null;\n    }\n    return this.insert(col, i + 1, weight);\n  }\n\n  /**\n   * adapts weights according to an own width change\n   * @param col\n   * @param oldValue\n   * @param newValue\n   */\n  private adaptWidthChange(col: Column, oldValue: number, newValue: number) {\n    if (similar(oldValue, newValue, 0.5)) {\n      return;\n    }\n    const bak = this.getWeights();\n    const full = this.getWidth(),\n      change = (newValue - oldValue) / full;\n    const oldWeight = oldValue / full;\n    const factor = (1 - oldWeight - change) / (1 - oldWeight);\n    const widths = this._children.map((c) => {\n      if (c === col) {\n        //c.weight += change;\n        return newValue;\n      }\n      const guess = c.getWidth() * factor;\n      const w = Number.isNaN(guess) || guess < 1 ? 0 : guess;\n      c.setWidthImpl(w);\n      return w;\n    });\n    //adapt width if needed\n    super.setWidth(widths.reduce((a, b) => a + b, 0));\n\n    this.fire(\n      [\n        StackColumn.EVENT_WEIGHTS_CHANGED,\n        StackColumn.EVENT_MULTI_LEVEL_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      bak,\n      this.getWeights()\n    );\n  }\n\n  getWeights() {\n    const w = this.getWidth();\n    return this._children.map((d) => d.getWidth() / w);\n  }\n\n  setWeights(weights: number[]) {\n    const bak = this.getWeights();\n    const delta = weights.length - this.length;\n    let s: number;\n    if (delta < 0) {\n      s = weights.reduce((p, a) => p + a, 0);\n      if (s <= 1) {\n        for (let i = 0; i < -delta; ++i) {\n          weights.push((1 - s) * (1 / -delta));\n        }\n      } else if (s <= 100) {\n        for (let i = 0; i < -delta; ++i) {\n          weights.push((100 - s) * (1 / -delta));\n        }\n      }\n    }\n    weights = weights.slice(0, this.length);\n    s = weights.reduce((p, a) => p + a, 0) / this.getWidth();\n    weights = weights.map((d) => d / s);\n\n    this._children.forEach((c, i) => {\n      c.setWidthImpl(weights[i]);\n    });\n    this.fire(\n      [\n        StackColumn.EVENT_WEIGHTS_CHANGED,\n        StackColumn.EVENT_MULTI_LEVEL_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      bak,\n      weights\n    );\n  }\n\n  removeImpl(child: Column, index: number) {\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\n    return super.removeImpl(child, index);\n  }\n\n  setWidth(value: number) {\n    const factor = value / this.getWidth();\n    this._children.forEach((child) => {\n      //disable since we change it\n      child.setWidthImpl(child.getWidth() * factor);\n    });\n    super.setWidth(value);\n  }\n\n  protected compute(row: IDataRow) {\n    const w = this.getWidth();\n    return this._children.reduce((acc, d) => acc + d.getValue(row) * (d.getWidth() / w), 0);\n  }\n\n  getRenderer() {\n    if (this.getCollapsed() && this.isLoaded()) {\n      return StackColumn.COLLAPSED_RENDERER;\n    }\n    return super.getRenderer();\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n}\n","import { similar, IEventListener } from '../internal';\nimport { toolbar } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport CompositeColumn, { addColumn, filterChanged, moveColumn, removeColumn } from './CompositeColumn';\nimport type { IDataRow, IColumnDesc, IFlatColumn, IMultiLevelColumn, ITypeFactory } from './interfaces';\nimport { integrateDefaults } from './internal';\nimport StackColumn from './StackColumn';\n\n/**\n * emitted when the collapse property changes\n * @asMemberOf MultiLevelCompositeColumn\n * @event\n */\nexport declare function collapseChanged_MC(previous: boolean, current: boolean): void;\n\n/**\n * emitted when the ratios between the children changes\n * @asMemberOf MultiLevelCompositeColumn\n * @event\n */\nexport declare function nestedChildRatio_MC(previous: number, current: number): void;\n\nexport declare type IMultiLevelCompositeColumnDesc = IColumnDesc & {\n  /**\n   * show nested summaries\n   * @default true\n   */\n  showNestedSummaries?: boolean;\n};\n\n@toolbar('compress', 'expand')\nexport default class MultiLevelCompositeColumn extends CompositeColumn implements IMultiLevelColumn {\n  static readonly EVENT_COLLAPSE_CHANGED = StackColumn.EVENT_COLLAPSE_CHANGED;\n  static readonly EVENT_MULTI_LEVEL_CHANGED = StackColumn.EVENT_MULTI_LEVEL_CHANGED;\n\n  static readonly COLLAPSED_RENDERER = 'default';\n\n  private readonly adaptChange: (old: number, newValue: number) => void;\n\n  /**\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\n   * @type {boolean}\n   * @private\n   */\n  private collapsed = false;\n\n  constructor(id: string, desc: Readonly<IMultiLevelCompositeColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        summaryRenderer: 'nested',\n      })\n    );\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.adaptChange = function (old, newValue) {\n      that.adaptWidthChange(old, newValue);\n    };\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED]);\n  }\n\n  on(type: typeof MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged_MC | null): this;\n  on(\n    type: typeof MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED,\n    listener: typeof nestedChildRatio_MC | null\n  ): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setCollapsed(value: boolean) {\n    if (this.collapsed === value) {\n      return;\n    }\n    this.fire(\n      [StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.collapsed,\n      (this.collapsed = value)\n    );\n  }\n\n  getCollapsed() {\n    return this.collapsed;\n  }\n\n  isShowNestedSummaries() {\n    return (this.desc as IMultiLevelCompositeColumnDesc).showNestedSummaries !== false;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.collapsed = this.collapsed;\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    this.collapsed = dump.collapsed === true;\n    super.restore(dump, factory);\n  }\n\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\n    return StackColumn.prototype.flatten.call(this, r, offset, levelsToGo, padding);\n  }\n\n  /**\n   * inserts a column at a the given position\n   * @param col\n   * @param index\n   */\n  insert(col: Column, index: number) {\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\n    //increase my width\n    super.setWidth(this.length === 0 ? col.getWidth() : this.getWidth() + col.getWidth());\n\n    return super.insert(col, index);\n  }\n\n  /**\n   * adapts weights according to an own width change\n   * @param oldValue\n   * @param newValue\n   */\n  private adaptWidthChange(oldValue: number, newValue: number) {\n    if (similar(oldValue, newValue, 0.5)) {\n      return;\n    }\n    const act = this.getWidth();\n    const next = act + (newValue - oldValue);\n    this.fire(\n      [MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n      act,\n      next\n    );\n    super.setWidth(next);\n  }\n\n  removeImpl(child: Column, index: number) {\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\n    return super.removeImpl(child, index);\n  }\n\n  setWidth(value: number) {\n    const act = this.getWidth();\n    const factor = value / act;\n    this._children.forEach((child) => {\n      //disable since we change it\n      child.setWidthImpl(child.getWidth() * factor);\n    });\n    if (!similar(act, value, 0.5)) {\n      this.fire(\n        [MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY],\n        act,\n        value\n      );\n    }\n    super.setWidth(value);\n  }\n\n  getRenderer() {\n    if (this.getCollapsed()) {\n      return MultiLevelCompositeColumn.COLLAPSED_RENDERER;\n    }\n    return super.getRenderer();\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n}\n","import type { IDataRow, ECompareValueType } from './interfaces';\nimport MultiLevelCompositeColumn, { IMultiLevelCompositeColumnDesc } from './MultiLevelCompositeColumn';\nimport { concat } from '../internal';\nimport { toolbar } from './annotations';\n\n/**\n * factory for creating a description creating a mean column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createNestedDesc(label = 'Nested', showNestedSummaries = true): IMultiLevelCompositeColumnDesc {\n  return { type: 'nested', label, showNestedSummaries };\n}\n\n/**\n * a nested column is a composite column where the sorting order is determined by the nested ordering of the children\n * i.e., sort by the first child if equal sort by the second child,...\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy')\nexport default class NestedColumn extends MultiLevelCompositeColumn {\n  toCompareValue(row: IDataRow) {\n    return concat(this.children.map((d) => d.toCompareValue(row)));\n  }\n\n  toCompareValueType(): ECompareValueType[] {\n    return concat(this.children.map((d) => d.toCompareValueType()));\n  }\n\n  getLabel(row: IDataRow) {\n    return this.children.map((d) => d.getLabel(row)).join(';');\n  }\n\n  getValue(row: IDataRow) {\n    return this.children.map((d) => d.getValue(row)).join(';');\n  }\n}\n","import { toolbar, SortByDefault, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport { IDataRow, ECompareValueType, ITypeFactory } from './interfaces';\nimport {\n  EAdvancedSortMethod,\n  IAdvancedBoxPlotColumn,\n  INumberDesc,\n  INumberFilter,\n  IMappingFunction,\n  IColorMappingFunction,\n} from './INumberColumn';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { restoreMapping } from './MappingFunction';\nimport { isMissingValue } from './missing';\nimport NumberColumn from './NumberColumn';\nimport { IEventListener, IAdvancedBoxPlotData, boxplotBuilder } from '../internal';\nimport { format } from 'd3-format';\nimport {\n  DEFAULT_FORMATTER,\n  noNumberFilter,\n  toCompareBoxPlotValue,\n  getBoxPlotNumber,\n  isDummyNumberFilter,\n  restoreNumberFilter,\n} from './internalNumber';\nimport { integrateDefaults } from './internal';\n\nexport interface INumberMapDesc extends INumberDesc {\n  readonly sort?: EAdvancedSortMethod;\n}\n\nexport declare type INumberMapColumnDesc = INumberMapDesc & IMapColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function mappingChanged_NMC(previous: IMappingFunction, current: IMappingFunction): void;\n/**\n * emitted when the color mapping property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function colorMappingChanged_NMC(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the sort method property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function sortMethodChanged_NMC(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf NumberMapColumn\n * @event\n */\nexport declare function filterChanged_NMC(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n@toolbar('rename', 'filterNumber', 'colorMapped', 'editMapping')\n@dialogAddons('sort', 'sortNumbers')\n@SortByDefault('descending')\nexport default class NumberMapColumn extends MapColumn<number> implements IAdvancedBoxPlotColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\n\n  private readonly numberFormat: (n: number) => string = DEFAULT_FORMATTER;\n\n  private sort: EAdvancedSortMethod;\n  private mapping: IMappingFunction;\n  private original: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<INumberMapColumnDesc>, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'mapbars',\n      })\n    );\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n    this.sort = desc.sort || EAdvancedSortMethod.median;\n\n    if (desc.numberFormat) {\n      this.numberFormat = format(desc.numberFormat);\n    }\n  }\n\n  getNumberFormat() {\n    return this.numberFormat;\n  }\n\n  toCompareValue(row: IDataRow): number {\n    return toCompareBoxPlotValue(this, row);\n  }\n\n  toCompareValueType() {\n    return ECompareValueType.FLOAT;\n  }\n\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d.value) ? NaN : this.mapping.apply(d.value));\n    }\n    return b.build();\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.numberFormat);\n  }\n\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\n    const data = this.getRawValue(row);\n    if (data == null) {\n      return null;\n    }\n\n    const b = boxplotBuilder();\n    for (const d of data) {\n      b.push(isMissingValue(d.value) ? NaN : d.value);\n    }\n    return b.build();\n  }\n\n  getNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'normalized');\n  }\n\n  getRawNumber(row: IDataRow): number {\n    return getBoxPlotNumber(this, row, 'raw');\n  }\n\n  iterNumber(row: IDataRow) {\n    const r = this.getValue(row);\n    return r ? r.map((d) => d.value) : [NaN];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    const r = this.getRawValue(row);\n    return r ? r.map((d) => d.value) : [NaN];\n  }\n\n  getValue(row: IDataRow) {\n    const values = this.getRawValue(row);\n    return values.length === 0\n      ? null\n      : values.map(({ key, value }) => ({ key, value: isMissingValue(value) ? NaN : this.mapping.apply(value) }));\n  }\n\n  getRawValue(row: IDataRow): IKeyValue<number>[] {\n    const r = super.getValue(row);\n    return r == null ? [] : r;\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\n  }\n\n  getLabels(row: IDataRow) {\n    const v = this.getRawValue(row);\n    return v.map(({ key, value }) => ({ key, value: this.numberFormat(value) }));\n  }\n\n  getSortMethod() {\n    return this.sort;\n  }\n\n  setSortMethod(sort: EAdvancedSortMethod) {\n    if (this.sort === sort) {\n      return;\n    }\n    this.fire([NumberMapColumn.EVENT_SORTMETHOD_CHANGED], this.sort, (this.sort = sort));\n    // sort by me if not already sorted by me\n    if (!this.isSortedByMe().asc) {\n      this.sortByMe();\n    }\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    r.sortMethod = this.getSortMethod();\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n    if (dump.sortMethod) {\n      this.sort = dump.sortMethod;\n    }\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED,\n        NumberMapColumn.EVENT_MAPPING_CHANGED,\n        NumberMapColumn.EVENT_SORTMETHOD_CHANGED,\n        NumberMapColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_NMC | null): this;\n  on(type: typeof NumberMapColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_NMC | null): this;\n  on(type: typeof NumberMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged_NMC | null): this;\n  on(type: typeof NumberMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_NMC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [NumberMapColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { equalArrays, extent, IEventListener } from '../internal';\nimport { Category, toolbar } from './annotations';\nimport { DEFAULT_CATEGORICAL_COLOR_FUNCTION } from './CategoricalColorMappingFunction';\nimport CategoricalColumn from './CategoricalColumn';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport type {\n  ICategoricalColumn,\n  ICategoricalDesc,\n  ICategoricalFilter,\n  ICategory,\n  ICategoricalColorMappingFunction,\n} from './ICategoricalColumn';\nimport type { IDataRow, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport NumberColumn from './NumberColumn';\nimport type { INumberColumn } from './INumberColumn';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport { toCategories } from './internalCategorical';\nimport { DEFAULT_FORMATTER } from './internalNumber';\nimport { integrateDefaults } from './internal';\n\nexport declare type IOrdinalColumnDesc = ICategoricalDesc & IValueColumnDesc<number>;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf OrdinalColumn\n * @event\n */\nexport declare function mappingChanged_OC(previous: number[], current: number[]): void;\n\n/**\n * emitted when the color mapping property changes\n * @asMemberOf OrdinalColumn\n * @event\n */\nexport declare function colorMappingChanged_OC(\n  previous: ICategoricalColorMappingFunction,\n  current: ICategoricalColorMappingFunction\n): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf OrdinalColumn\n * @event\n */\nexport declare function filterChanged_OC(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\n\n/**\n * similar to a categorical column but the categories are mapped to numbers\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'group', 'filterOrdinal', 'colorMappedCategorical')\n@Category('categorical')\nexport default class OrdinalColumn extends ValueColumn<number> implements INumberColumn, ICategoricalColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = CategoricalColumn.EVENT_COLOR_MAPPING_CHANGED;\n\n  readonly categories: ICategory[];\n\n  private colorMapping: ICategoricalColorMappingFunction;\n\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\n\n  private currentFilter: ICategoricalFilter | null = null;\n\n  constructor(id: string, desc: Readonly<IOrdinalColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'number',\n        groupRenderer: 'boxplot',\n      })\n    );\n    this.categories = toCategories(desc);\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\n    this.colorMapping = DEFAULT_CATEGORICAL_COLOR_FUNCTION;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        OrdinalColumn.EVENT_COLOR_MAPPING_CHANGED,\n        OrdinalColumn.EVENT_MAPPING_CHANGED,\n        OrdinalColumn.EVENT_FILTER_CHANGED,\n      ]);\n  }\n\n  on(type: typeof OrdinalColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged_OC | null): this;\n  on(type: typeof OrdinalColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged_OC | null): this;\n  on(type: typeof OrdinalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_OC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getNumberFormat() {\n    return DEFAULT_FORMATTER;\n  }\n\n  get dataLength() {\n    return this.categories.length;\n  }\n\n  get labels() {\n    return this.categories.map((d) => d.label);\n  }\n\n  getValue(row: IDataRow) {\n    const v = this.getNumber(row);\n    return Number.isNaN(v) ? null : v;\n  }\n\n  getCategory(row: IDataRow) {\n    const v = super.getValue(row);\n    if (!v) {\n      return null;\n    }\n    const vs = String(v);\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : null;\n  }\n\n  getCategories(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterCategory(row: IDataRow) {\n    return [this.getCategory(row)];\n  }\n\n  iterNumber(row: IDataRow) {\n    return [this.getNumber(row)];\n  }\n\n  iterRawNumber(row: IDataRow) {\n    return [this.getRawNumber(row)];\n  }\n\n  getColor(row: IDataRow) {\n    return CategoricalColumn.prototype.getColor.call(this, row);\n  }\n\n  getLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabel.call(this, row);\n  }\n\n  getLabels(row: IDataRow) {\n    return CategoricalColumn.prototype.getLabels.call(this, row);\n  }\n\n  getValues(row: IDataRow) {\n    return CategoricalColumn.prototype.getValues.call(this, row);\n  }\n\n  getMap(row: IDataRow) {\n    return CategoricalColumn.prototype.getMap.call(this, row);\n  }\n\n  getMapLabel(row: IDataRow) {\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\n  }\n\n  getSet(row: IDataRow) {\n    return CategoricalColumn.prototype.getSet.call(this, row);\n  }\n\n  getNumber(row: IDataRow) {\n    const v = this.getCategory(row);\n    return v ? v.value : NaN;\n  }\n\n  getRawNumber(row: IDataRow) {\n    return this.getNumber(row);\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      const value = this.getNumber(row);\n      if (Number.isNaN(value)) {\n        return null;\n      }\n      return {\n        name: this.getLabel(row),\n        value,\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = CategoricalColumn.prototype.dump.call(this, toDescRef);\n    r.mapping = this.getMapping();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    CategoricalColumn.prototype.restore.call(this, dump, factory);\n    if (dump.mapping) {\n      this.setMapping(dump.mapping);\n    }\n  }\n\n  getMapping() {\n    return this.categories.map((d) => d.value);\n  }\n\n  setMapping(mapping: number[]) {\n    const r = extent(mapping);\n    mapping = mapping.map((d) => (d - r[0]!) / (r[1]! - r[0]!));\n    const bak = this.getMapping();\n    if (equalArrays(bak, mapping)) {\n      return;\n    }\n    this.categories.forEach((d, i) => (d.value = mapping[i] || 0));\n    this.fire(\n      [\n        OrdinalColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      bak,\n      this.getMapping()\n    );\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: ICategoricalColorMappingFunction) {\n    return CategoricalColumn.prototype.setColorMapping.call(this, mapping);\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow): boolean {\n    return CategoricalColumn.prototype.filter.call(this, row);\n  }\n\n  group(row: IDataRow) {\n    return CategoricalColumn.prototype.group.call(this, row);\n  }\n\n  getFilter() {\n    return this.currentFilter;\n  }\n\n  setFilter(filter: ICategoricalFilter | null) {\n    return CategoricalColumn.prototype.setFilter.call(this, filter);\n  }\n\n  clearFilter() {\n    return CategoricalColumn.prototype.clearFilter.call(this);\n  }\n\n  toCompareValue(row: IDataRow) {\n    return CategoricalColumn.prototype.toCompareValue.call(this, row);\n  }\n\n  toCompareValueType() {\n    return CategoricalColumn.prototype.toCompareValueType.call(this);\n  }\n\n  getRenderer(): string {\n    return NumberColumn.prototype.getRenderer.call(this);\n  }\n}\n","import NumberColumn from './NumberColumn';\nimport type { IEventListener } from '../internal';\nimport { SortByDefault, toolbar } from './annotations';\nimport Column, {\n  dirty,\n  dirtyCaches,\n  dirtyHeader,\n  dirtyValues,\n  groupRendererChanged,\n  labelChanged,\n  metaDataChanged,\n  rendererTypeChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  widthChanged,\n} from './Column';\nimport type { addColumn, moveColumn, removeColumn } from './CompositeColumn';\nimport type CompositeColumn from './CompositeColumn';\nimport CompositeNumberColumn, { ICompositeNumberDesc } from './CompositeNumberColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { isDummyNumberFilter, noNumberFilter, restoreNumberFilter } from './internalNumber';\nimport {\n  IColorMappingFunction,\n  IMapAbleColumn,\n  IMapAbleDesc,\n  IMappingFunction,\n  INumberFilter,\n  isNumberColumn,\n} from './INumberColumn';\nimport { restoreMapping } from './MappingFunction';\nimport { integrateDefaults } from './internal';\n\nconst DEFAULT_SCRIPT = `let s = 0;\ncol.forEach((c) => s += c.v);\nreturn s / col.length`;\n\n/**\n * factory for creating a description creating a mean column\n * @param label\n * @returns {{type: string, label: string}}\n */\nexport function createScriptDesc(label = 'script') {\n  return { type: 'script', label, script: DEFAULT_SCRIPT };\n}\n\nfunction wrapWithContext(code: string) {\n  let clean = code.trim();\n  if (!clean.includes('return')) {\n    clean = `return (${clean});`;\n  }\n  return `\n  const max = function(arr) { return Math.max.apply(Math, arr); };\n  const min = function(arr) { return Math.min.apply(Math, arr); };\n  const extent = function(arr) { return [min(arr), max(arr)]; };\n  const clamp = function(v, minValue, maxValue) { return v < minValue ? minValue : (v > maxValue ? maxValue : v); };\n  const normalize = function(v, minMax, max) {\n    if (Array.isArray(minMax)) {\n      minMax = minMax[0];\n      max = minMax[1];\n    }\n    return (v - minMax) / (max - minMax);\n  };\n  const denormalize = function(v, minMax, max) {\n    if (Array.isArray(minMax)) {\n      minMax = minMax[0];\n      max = minMax[1];\n    }\n    return v * (max - minMax) + minMax;\n  };\n  const linear = function(v, source, target) {\n    target = target || [0, 1];\n    return denormalize(normalize(v, source), target);\n  };\n  const v = (function custom() {\n    ${clean}\n  })();\n\n  return typeof v === 'number' ? v : NaN`;\n}\n\ninterface IColumnWrapper {\n  v: any;\n  raw: number | null;\n  type: string;\n  name: string;\n  id: string;\n}\n\n/**\n * wrapper class for simpler column accessing\n */\nclass ColumnWrapper implements IColumnWrapper {\n  constructor(private readonly c: Column, public readonly v: any, public readonly raw: number | null) {}\n\n  get type() {\n    return this.c.desc.type;\n  }\n\n  get name() {\n    return this.c.getMetaData().label;\n  }\n\n  get id() {\n    return this.c.id;\n  }\n}\n\nclass LazyColumnWrapper implements IColumnWrapper {\n  constructor(private readonly c: Column, private readonly row: IDataRow) {}\n\n  get type() {\n    return this.c.desc.type;\n  }\n\n  get name() {\n    return this.c.getMetaData().label;\n  }\n\n  get id() {\n    return this.c.id;\n  }\n\n  get v() {\n    return this.c.getValue(this.row);\n  }\n\n  get raw() {\n    return isNumberColumn(this.c) ? this.c.getRawNumber(this.row) : null;\n  }\n}\n\n/**\n * helper context for accessing columns within a scripted columns\n */\nclass ColumnContext {\n  private readonly lookup = new Map<string, IColumnWrapper>();\n  private _all: ColumnContext | null = null;\n\n  constructor(private readonly children: IColumnWrapper[], private readonly allFactory?: () => ColumnContext) {\n    children.forEach((c) => {\n      this.lookup.set(`ID@${c.id}`, c);\n      this.lookup.set(`ID@${c.id.toLowerCase()}`, c);\n      this.lookup.set(`NAME@${c.name}`, c);\n      this.lookup.set(`NAME@${c.name.toLowerCase()}`, c);\n    });\n  }\n\n  /**\n   * get a column by name\n   * @param {string} name\n   * @return {IColumnWrapper}\n   */\n  byName(name: string) {\n    return this.lookup.get(`NAME@${name}`);\n  }\n\n  /**\n   * get a column by id\n   * @param {string} id\n   * @return {IColumnWrapper}\n   */\n  byID(id: string) {\n    return this.lookup.get(`ID@${id}`);\n  }\n\n  /**\n   * get a column by index\n   * @param {number} index\n   * @return {IColumnWrapper}\n   */\n  byIndex(index: number) {\n    return this.children[index];\n  }\n\n  forEach(callback: (c: IColumnWrapper, index: number) => void) {\n    return this.children.forEach(callback);\n  }\n\n  /**\n   * number of columns\n   * @return {number}\n   */\n  get length() {\n    return this.children.length;\n  }\n\n  /**\n   * get the all context, i.e one with all columns of this ranking\n   * @return {ColumnContext}\n   */\n  get all() {\n    if (this._all == null) {\n      this._all = this.allFactory ? this.allFactory() : null;\n    }\n    return this._all!;\n  }\n}\n\nexport interface IScriptDesc extends ICompositeNumberDesc, IMapAbleDesc {\n  /**\n   * the function to use, it has two parameters: children (current children) and values (their row values)\n   * @default 'return Math.max.apply(Math,values)'\n   */\n  script?: string;\n}\n\nexport declare type IScriptColumnDesc = IScriptDesc;\n\n/**\n * emitted when the script property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function scriptChanged(previous: string, current: string): void;\n\n/**\n * emitted when the mapping property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function mappingChanged(previous: IMappingFunction, current: IMappingFunction): void;\n/**\n * emitted when the color mapping property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function colorMappingChanged(previous: IColorMappingFunction, current: IColorMappingFunction): void;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf ScriptColumn\n * @event\n */\nexport declare function filterChanged(previous: INumberFilter | null, current: INumberFilter | null): void;\n\n/**\n * column combiner which uses a custom JavaScript function to combined the values\n * The script itself can be any valid JavaScript code. It will be embedded in a function.\n * Therefore the last statement has to return a value.\n *\n * In case of a single line statement the code piece statement <code>return</code> will be automatically prefixed.\n *\n * The function signature is: <br><code>(row: any, index: number, children: Column[], values: any[], raws: (number|null)[]) => number</code>\n *  <dl>\n *    <dt>param: <code>row</code></dt>\n *    <dd>the row in the dataset to compute the value for</dd>\n *    <dt>param: <code>index</code></dt>\n *    <dd>the index of the row</dd>\n *    <dt>param: <code>children</code></dt>\n *    <dd>the list of LineUp columns that are part of this ScriptColumn</dd>\n *    <dt>param: <code>values</code></dt>\n *    <dd>the computed value of each column (see <code>children</code>) for the current row</dd>\n *    <dt>param: <code>raws</code></dt>\n *    <dd>similar to <code>values</code>. Numeric columns return by default the normalized value, this array gives access to the original \"raw\" values before mapping is applied</dd>\n *    <dt>returns:</dt>\n *    <dd>the computed number <strong>in the range [0, 1] or NaN</strong></dd>\n *  </dl>\n *\n * In addition to the standard JavaScript functions and objects (Math, ...) a couple of utility functions are available: </p>\n * <dl>\n *    <dt><code>max(arr: number[]) => number</code></dt>\n *    <dd>computes the maximum of the given array of numbers</dd>\n *    <dt><code>min(arr: number[]) => number</code></dt>\n *    <dd>computes the minimum of the given array of numbers</dd>\n *    <dt><code>extent(arr: number[]) => [number, number]</code></dt>\n *    <dd>computes both minimum and maximum and returning an array with the first element the minimum and the second the maximum</dd>\n *    <dt><code>clamp(v: number, min: number, max: number) => number</code></dt>\n *    <dd>ensures that the given value is within the given min/max value</dd>\n *    <dt><code>normalize(v: number, min: number, max: number) => number</code></dt>\n *    <dd>normalizes the given value <code>(v - min) / (max - min)</code></dd>\n *    <dt><code>denormalize(v: number, min: number, max: number) => number</code></dt>\n *    <dd>inverts a normalized value <code>v * (max - min) + min</code></dd>\n *    <dt><code>linear(v: number, input: [number, number], output: [number, number]) => number</code></dt>\n *    <dd>performs a linear mapping from input domain to output domain both given as an array of [min, max] values. <code>denormalize(normalize(v, input[0], input[1]), output[0], output[1])</code></dd>\n *  </dl>\n */\n@toolbar('script', 'filterNumber', 'colorMapped', 'editMapping')\n@SortByDefault('descending')\nexport default class ScriptColumn extends CompositeNumberColumn implements IMapAbleColumn {\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\n  static readonly EVENT_SCRIPT_CHANGED = 'scriptChanged';\n  static readonly DEFAULT_SCRIPT = DEFAULT_SCRIPT;\n\n  private script = ScriptColumn.DEFAULT_SCRIPT;\n  private f: (children, values: number[], raws: any[], col: ColumnContext, row: any, index: number) => number | null =\n    null;\n  private mapping: IMappingFunction;\n  private original: IMappingFunction;\n  private colorMapping: IColorMappingFunction;\n  /**\n   * currently active filter\n   * @type {{min: number, max: number}}\n   * @private\n   */\n  private currentFilter: INumberFilter = noNumberFilter();\n\n  constructor(id: string, desc: Readonly<IScriptColumnDesc>, factory: ITypeFactory) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        renderer: 'number',\n        groupRenderer: 'boxplot',\n        summaryRenderer: 'histogram',\n      })\n    );\n    this.script = desc.script || this.script;\n    this.mapping = restoreMapping(desc, factory);\n    this.original = this.mapping.clone();\n    this.colorMapping = factory.colorMappingFunction(desc.colorMapping || desc.color);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ScriptColumn.EVENT_SCRIPT_CHANGED,\n        ScriptColumn.EVENT_COLOR_MAPPING_CHANGED,\n        ScriptColumn.EVENT_MAPPING_CHANGED,\n      ]);\n  }\n\n  on(type: typeof ScriptColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\n  on(type: typeof ScriptColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\n  on(type: typeof ScriptColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof ScriptColumn.EVENT_SCRIPT_CHANGED, listener: typeof scriptChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setScript(script: string) {\n    if (this.script === script) {\n      return;\n    }\n    this.f = null;\n    this.fire(\n      [ScriptColumn.EVENT_SCRIPT_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_CACHES, Column.EVENT_DIRTY],\n      this.script,\n      (this.script = script)\n    );\n  }\n\n  getScript() {\n    return this.script;\n  }\n\n  dump(toDescRef: (desc: any) => any) {\n    const r = super.dump(toDescRef);\n    r.script = this.script;\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\n    r.map = this.mapping.toJSON();\n    r.colorMapping = this.colorMapping.toJSON();\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    super.restore(dump, factory);\n\n    this.script = dump.script || this.script;\n    if (dump.filter) {\n      this.currentFilter = restoreNumberFilter(dump.filter);\n    }\n    if (dump.map || dump.domain) {\n      this.mapping = restoreMapping(dump.map, factory);\n    }\n    if (dump.colorMapping) {\n      this.colorMapping = factory.colorMappingFunction(dump.colorMapping);\n    }\n  }\n\n  protected compute(row: IDataRow) {\n    if (this.f == null) {\n      // eslint-disable-next-line no-new-func\n      this.f = new Function('children', 'values', 'raws', 'col', 'row', 'index', wrapWithContext(this.script)) as any;\n    }\n    const children = this._children;\n    const values = this._children.map((d) => d.getValue(row));\n    const raws = this._children.map((d) => (isNumberColumn(d) ? d.getRawNumber(row) : null)) as number[];\n    const col = new ColumnContext(\n      children.map((c, i) => new ColumnWrapper(c, values[i], raws[i])),\n      () => {\n        const cols = this.findMyRanker()!.flatColumns; // all except myself\n        return new ColumnContext(cols.map((c) => new LazyColumnWrapper(c, row)));\n      }\n    );\n    return this.f.call(this, children, values, raws, col, row.v, row.i);\n  }\n\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\n    if (format === 'json') {\n      return {\n        value: this.getRawNumber(row),\n        children: this.children.map((d) => d.getExportValue(row, format)),\n      };\n    }\n    return super.getExportValue(row, format);\n  }\n\n  getRange() {\n    return this.mapping.getRange(this.getNumberFormat());\n  }\n\n  getOriginalMapping() {\n    return this.original.clone();\n  }\n\n  getMapping() {\n    return this.mapping.clone();\n  }\n\n  setMapping(mapping: IMappingFunction) {\n    if (this.mapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        ScriptColumn.EVENT_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.mapping.clone(),\n      (this.mapping = mapping)\n    );\n  }\n\n  getColor(row: IDataRow) {\n    return NumberColumn.prototype.getColor.call(this, row);\n  }\n\n  getColorMapping() {\n    return this.colorMapping.clone();\n  }\n\n  setColorMapping(mapping: IColorMappingFunction) {\n    if (this.colorMapping.eq(mapping)) {\n      return;\n    }\n    this.fire(\n      [\n        ScriptColumn.EVENT_COLOR_MAPPING_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.colorMapping.clone(),\n      (this.colorMapping = mapping)\n    );\n  }\n\n  isFiltered() {\n    return NumberColumn.prototype.isFiltered.call(this);\n  }\n\n  getFilter(): INumberFilter {\n    return NumberColumn.prototype.getFilter.call(this);\n  }\n\n  setFilter(value: INumberFilter | null) {\n    NumberColumn.prototype.setFilter.call(this, value);\n  }\n\n  filter(row: IDataRow) {\n    return NumberColumn.prototype.filter.call(this, row);\n  }\n\n  clearFilter() {\n    return NumberColumn.prototype.clearFilter.call(this);\n  }\n}\n","import { toolbar } from './annotations';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDataRow } from './interfaces';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport { EAlignment, IStringDesc } from './StringColumn';\nimport type { IEventListener } from '../internal';\nimport { isMissingValue } from './missing';\nimport { integrateDefaults } from './internal';\n\nexport declare type IStringMapColumnDesc = IStringDesc & IMapColumnDesc<string>;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'search')\nexport default class StringMapColumn extends MapColumn<string> {\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  constructor(id: string, desc: Readonly<IStringMapColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n        renderer: 'map',\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n  }\n\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getMapValue(row);\n    return r.every((d) => d.value === '') ? null : r;\n  }\n\n  getMapValue(row: IDataRow) {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: isMissingValue(value) ? '' : String(value),\n    }));\n  }\n}\n","import { toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type { IDataRow } from './interfaces';\nimport { EAlignment, IStringDesc } from './StringColumn';\nimport { isMissingValue } from './missing';\nimport { integrateDefaults } from './internal';\n\nexport declare type IStringsColumnDesc = IStringDesc & IArrayColumnDesc<string>;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'search')\nexport default class StringsColumn extends ArrayColumn<string> {\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  constructor(id: string, desc: Readonly<IStringsColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n  }\n\n  getValues(row: IDataRow) {\n    return super.getValues(row).map((v) => {\n      return isMissingValue(v) ? '' : String(v);\n    });\n  }\n}\n","import { Category, toolbar, dialogAddons } from './annotations';\nimport Column, {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { IDataRow, IGroup, IValueColumnDesc, ITypeFactory } from './interfaces';\nimport { patternFunction, integrateDefaults } from './internal';\nimport type { dataLoaded } from './ValueColumn';\nimport ValueColumn from './ValueColumn';\nimport type { IEventListener, ISequence } from '../internal';\nimport { IStringDesc, EAlignment, IStringGroupCriteria, EStringGroupCriteriaType, IStringFilter } from './StringColumn';\nimport StringColumn from './StringColumn';\n\nexport interface ILinkDesc extends IStringDesc {\n  /**\n   * replacement pattern, use use <code>${value}</code> for the current value, <code>${escapedValue}</code> for an url safe value and <code>${item}</code> for the whole item\n   */\n  pattern?: string;\n\n  /**\n   * optional list of pattern templates\n   */\n  patternTemplates?: string[];\n}\n\nexport interface ILink {\n  alt: string;\n  href: string;\n}\n\nexport declare type ILinkColumnDesc = ILinkDesc & IValueColumnDesc<string | ILink>;\n\n/**\n * emitted when the filter property changes\n * @asMemberOf LinkColumn\n * @event\n */\nexport declare function filterChanged_LC(previous: string | RegExp | null, current: string | RegExp | null): void;\n\n/**\n * emitted when the grouping property changes\n * @asMemberOf LinkColumn\n * @event\n */\nexport declare function groupingChanged_LC(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf LinkColumn\n * @event\n */\nexport declare function patternChanged_LC(previous: string, current: string): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'clone', 'sort', 'sortBy', 'search', 'groupBy', 'filterString', 'editPattern')\n@dialogAddons('group', 'groupString')\n@Category('string')\nexport default class LinkColumn extends ValueColumn<string | ILink> {\n  static readonly EVENT_FILTER_CHANGED = StringColumn.EVENT_FILTER_CHANGED;\n  static readonly EVENT_GROUPING_CHANGED = StringColumn.EVENT_GROUPING_CHANGED;\n  static readonly EVENT_PATTERN_CHANGED = 'patternChanged';\n\n  private pattern: string;\n  private patternFunction: (value: string, raw: any) => string | null = null;\n  readonly patternTemplates: string[];\n\n  private currentFilter: string | RegExp | null = null;\n  private currentGroupCriteria: IStringGroupCriteria = {\n    type: EStringGroupCriteriaType.startsWith,\n    values: [],\n  };\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n\n  constructor(id: string, desc: Readonly<ILinkColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(\n        desc,\n        Object.assign(\n          {\n            width: 200,\n          },\n          desc.pattern\n            ? {\n                renderer: 'link',\n                groupRenderer: 'link',\n              }\n            : {}\n        )\n      )\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n\n    this.pattern = desc.pattern || '';\n    this.patternTemplates = desc.patternTemplates || [];\n  }\n\n  setPattern(pattern: string) {\n    if (pattern === this.pattern) {\n      return;\n    }\n    this.patternFunction = null; // reset cache\n    this.fire(\n      [\n        LinkColumn.EVENT_PATTERN_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_DIRTY_VALUES,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_DIRTY,\n      ],\n      this.pattern,\n      (this.pattern = pattern)\n    );\n  }\n\n  getPattern() {\n    return this.pattern;\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([LinkColumn.EVENT_PATTERN_CHANGED, LinkColumn.EVENT_GROUPING_CHANGED, LinkColumn.EVENT_FILTER_CHANGED]);\n  }\n\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LC | null): this;\n  on(type: typeof LinkColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged_LC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof LinkColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged_LC | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const l = this.getLink(row);\n    return l == null ? null : l.href;\n  }\n\n  getLink(row: IDataRow): ILink | null {\n    const v: string | null | ILink = super.getValue(row);\n    return this.transformValue(v, row);\n  }\n\n  private transformValue(v: any, row: IDataRow) {\n    if (v == null || v === '') {\n      return null;\n    }\n    if (typeof v === 'string') {\n      if (!this.pattern) {\n        return {\n          alt: v,\n          href: v,\n        };\n      }\n      if (!this.patternFunction) {\n        this.patternFunction = patternFunction(this.pattern, 'item');\n      }\n      return {\n        alt: v,\n        href: this.patternFunction.call(this, v, row.v),\n      };\n    }\n    return v;\n  }\n\n  getLabel(row: IDataRow) {\n    const l = this.getLink(row);\n    return l == null ? '' : l.alt;\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = StringColumn.prototype.dump.call(this, toDescRef);\n    if (this.pattern !== (this.desc as any).pattern) {\n      r.pattern = this.pattern;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    StringColumn.prototype.restore.call(this, dump, factory);\n    if (dump.pattern) {\n      this.pattern = dump.pattern;\n    }\n  }\n\n  isFiltered() {\n    return this.currentFilter != null;\n  }\n\n  filter(row: IDataRow) {\n    return StringColumn.prototype.filter.call(this, row);\n  }\n\n  getFilter() {\n    return this.currentFilter;\n  }\n\n  setFilter(filter: IStringFilter) {\n    return StringColumn.prototype.setFilter.call(this, filter);\n  }\n\n  clearFilter() {\n    return StringColumn.prototype.clearFilter.call(this);\n  }\n\n  getGroupCriteria() {\n    return this.currentGroupCriteria;\n  }\n\n  setGroupCriteria(value: IStringGroupCriteria) {\n    return StringColumn.prototype.setGroupCriteria.call(this, value);\n  }\n\n  toCompareValue(a: IDataRow) {\n    return StringColumn.prototype.toCompareValue.call(this, a);\n  }\n\n  toCompareValueType() {\n    return StringColumn.prototype.toCompareValueType.call(this);\n  }\n\n  toCompareGroupValue(rows: ISequence<IDataRow>, group: IGroup) {\n    return StringColumn.prototype.toCompareGroupValue.call(this, rows, group);\n  }\n\n  toCompareGroupValueType() {\n    return StringColumn.prototype.toCompareGroupValueType.call(this);\n  }\n\n  group(row: IDataRow): IGroup {\n    return StringColumn.prototype.group.call(this, row);\n  }\n}\n","import { toolbar } from './annotations';\nimport type Column from './Column';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { patternFunction, integrateDefaults } from './internal';\nimport MapColumn, { IMapColumnDesc } from './MapColumn';\nimport LinkColumn, { ILinkDesc } from './LinkColumn';\nimport type { IEventListener } from '../internal';\nimport { EAlignment } from './StringColumn';\nimport type { IKeyValue } from './IArrayColumn';\nimport type { ILink } from './LinkColumn';\n\nexport declare type ILinkMapColumnDesc = ILinkDesc & IMapColumnDesc<string>;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf LinkMapColumn\n * @event\n */\nexport declare function patternChanged_LMC(previous: string, current: string): void;\n\n/**\n * a string column with optional alignment\n */\n@toolbar('rename', 'search', 'editPattern')\nexport default class LinkMapColumn extends MapColumn<string> {\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n  private pattern: string;\n  private patternFunction: (value: string, raw: any, key: string) => string | null = null;\n  readonly patternTemplates: string[];\n\n  constructor(id: string, desc: Readonly<ILinkMapColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n        renderer: 'map',\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n    this.pattern = desc.pattern ?? '';\n    this.patternTemplates = desc.patternTemplates ?? [];\n  }\n\n  setPattern(pattern: string) {\n    LinkColumn.prototype.setPattern.call(this, pattern);\n  }\n\n  getPattern() {\n    return this.pattern;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([LinkColumn.EVENT_PATTERN_CHANGED]);\n  }\n\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LMC | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValue(row: IDataRow) {\n    const r = this.getLinkMap(row);\n    return r.every((d) => d.value == null)\n      ? null\n      : r.map(({ key, value }) => ({\n          key,\n          value: value ? value.href : '',\n        }));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getLinkMap(row).map(({ key, value }) => ({\n      key,\n      value: value ? value.alt : '',\n    }));\n  }\n\n  getLinkMap(row: IDataRow): IKeyValue<ILink>[] {\n    return super.getMap(row).map(({ key, value }) => ({\n      key,\n      value: this.transformValue(value, row, key),\n    }));\n  }\n\n  private transformValue(v: any, row: IDataRow, key: string) {\n    if (v == null || v === '') {\n      return null;\n    }\n    if (typeof v === 'string') {\n      if (!this.pattern) {\n        return {\n          alt: v,\n          href: v,\n        };\n      }\n      if (!this.patternFunction) {\n        this.patternFunction = patternFunction(this.pattern, 'item', 'key');\n      }\n      return {\n        alt: v,\n        href: this.patternFunction.call(this, v, row.v, key),\n      };\n    }\n    return v;\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    if (this.pattern !== (this.desc as any).pattern) {\n      r.pattern = this.pattern;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    if (dump.pattern) {\n      this.pattern = dump.pattern;\n    }\n    super.restore(dump, factory);\n  }\n}\n","import { toolbar } from './annotations';\nimport ArrayColumn, { IArrayColumnDesc } from './ArrayColumn';\nimport type {\n  widthChanged,\n  labelChanged,\n  metaDataChanged,\n  dirty,\n  dirtyHeader,\n  dirtyValues,\n  rendererTypeChanged,\n  groupRendererChanged,\n  summaryRendererChanged,\n  visibilityChanged,\n  dirtyCaches,\n} from './Column';\nimport type Column from './Column';\nimport type { dataLoaded } from './ValueColumn';\nimport type ValueColumn from './ValueColumn';\nimport type { IDataRow, ITypeFactory } from './interfaces';\nimport { patternFunction, integrateDefaults } from './internal';\nimport { EAlignment } from './StringColumn';\nimport type { IEventListener } from '../internal';\nimport LinkColumn, { ILink, ILinkDesc } from './LinkColumn';\n\nexport declare type ILinksColumnDesc = ILinkDesc & IArrayColumnDesc<string | ILink>;\n\n/**\n * emitted when the pattern property changes\n * @asMemberOf LinksColumn\n * @event\n */\nexport declare function patternChanged_LCS(previous: string, current: string): void;\n\n@toolbar('rename', 'search', 'editPattern')\nexport default class LinksColumn extends ArrayColumn<string | ILink> {\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\n\n  readonly alignment: EAlignment;\n  readonly escape: boolean;\n  private pattern: string;\n  private patternFunction: (value: string, raw: any, index: number) => string | null = null;\n  readonly patternTemplates: string[];\n\n  constructor(id: string, desc: Readonly<ILinksColumnDesc>) {\n    super(\n      id,\n      integrateDefaults(desc, {\n        width: 200,\n      })\n    );\n    this.alignment = desc.alignment ?? EAlignment.left;\n    this.escape = desc.escape !== false;\n    this.pattern = desc.pattern ?? '';\n    this.patternTemplates = desc.patternTemplates ?? [];\n  }\n\n  setPattern(pattern: string) {\n    return LinkColumn.prototype.setPattern.call(this, pattern);\n  }\n\n  getPattern() {\n    return this.pattern;\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([LinksColumn.EVENT_PATTERN_CHANGED]);\n  }\n\n  on(type: typeof LinksColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged_LCS | null): this;\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof Column.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type as any, listener);\n  }\n\n  getValues(row: IDataRow) {\n    return this.getLinks(row).map((d) => (d ? d.href : ''));\n  }\n\n  getLabels(row: IDataRow) {\n    return this.getLinks(row).map((d) => (d ? d.alt : ''));\n  }\n\n  private transformValue(v: any, row: IDataRow, i: number) {\n    if (v == null || v === '') {\n      return null;\n    }\n    if (typeof v === 'string') {\n      if (!this.pattern) {\n        return {\n          alt: v,\n          href: v,\n        };\n      }\n      if (!this.patternFunction) {\n        this.patternFunction = patternFunction(this.pattern, 'item', 'index');\n      }\n      return {\n        alt: v,\n        href: this.patternFunction.call(this, v, row.v, i),\n      };\n    }\n    return v;\n  }\n\n  getLinks(row: IDataRow): ILink[] {\n    return super.getValues(row).map((v, i) => {\n      return this.transformValue(v, row, i);\n    });\n  }\n\n  dump(toDescRef: (desc: any) => any): any {\n    const r = super.dump(toDescRef);\n    if (this.pattern !== (this.desc as any).pattern) {\n      r.pattern = this.pattern;\n    }\n    return r;\n  }\n\n  restore(dump: any, factory: ITypeFactory) {\n    if (dump.pattern) {\n      this.pattern = dump.pattern;\n    }\n    super.restore(dump, factory);\n  }\n}\n","var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nexport function isPromiseLike(p) {\r\n    return p != null && p && typeof p.then === 'function';\r\n}\r\n/**\r\n * the symbol returned when the promise was aborted\r\n */\r\nexport var ABORTED = Symbol('aborted');\r\nfunction thenFactory(loader, isAborted, abort) {\r\n    function then(onfulfilled, _onrejected) {\r\n        var fullfiller = loader.then(function (loaded) {\r\n            var loadedOrAborted = isAborted() ? ABORTED : loaded;\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            var res = onfulfilled ? onfulfilled(loadedOrAborted) : loadedOrAborted;\r\n            if (isPromiseLike(res)) {\r\n                return res.then(function (r) {\r\n                    return isAborted() ? ABORTED : r;\r\n                });\r\n            }\r\n            return isAborted() ? ABORTED : res;\r\n        });\r\n        return {\r\n            then: thenFactory(fullfiller, isAborted, abort),\r\n            abort: abort,\r\n            isAborted: isAborted,\r\n        };\r\n    }\r\n    return then;\r\n}\r\n/**\r\n * abort able Promise wrapper, returns a promise which can be aborted, and trying to avoid executing therefore the wrapped promise\r\n * @param {Promise<T>} loader\r\n * @returns {any}\r\n */\r\nexport default function abortAble(loader) {\r\n    var aborted = null;\r\n    var isAborted = function () { return aborted === null; };\r\n    var aborter = new Promise(function (resolve) {\r\n        aborted = resolve;\r\n    });\r\n    var abort = function () {\r\n        if (aborted == null) {\r\n            return;\r\n        }\r\n        aborted(ABORTED);\r\n        aborted = null;\r\n    };\r\n    var race = Promise.race([aborter, loader]);\r\n    return {\r\n        then: thenFactory(race, isAborted, abort),\r\n        abort: abort,\r\n        isAborted: isAborted,\r\n    };\r\n}\r\nexport function abortAbleFetch(input, init) {\r\n    var controller = new AbortController();\r\n    var race = new Promise(function (resolve, reject) {\r\n        var r = fetch(input, __assign({ signal: controller.signal }, (init || {})));\r\n        r.then(resolve);\r\n        r.catch(function (error) {\r\n            if (error instanceof DOMException) {\r\n                resolve(ABORTED);\r\n            }\r\n            else {\r\n                reject(error);\r\n            }\r\n        });\r\n    });\r\n    var abort = controller.abort.bind(controller);\r\n    var isAborted = function () { return controller.signal.aborted; };\r\n    return {\r\n        then: thenFactory(race, isAborted, abort),\r\n        abort: abort,\r\n        isAborted: isAborted,\r\n    };\r\n}\r\n/**\r\n * similar to Promise.all but for abortAble\r\n */\r\nexport function abortAbleAll(values) {\r\n    var loader = Promise.all(values);\r\n    var aborted = null;\r\n    var isAborted = function () { return aborted === null; };\r\n    var aborter = new Promise(function (resolve) {\r\n        aborted = resolve;\r\n    });\r\n    var abort = function () {\r\n        if (aborted == null) {\r\n            return;\r\n        }\r\n        aborted(ABORTED);\r\n        for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\r\n            var v = values_1[_i];\r\n            if (isAbortAble(v)) {\r\n                v.abort();\r\n            }\r\n        }\r\n        aborted = null;\r\n    };\r\n    var race = Promise.race([aborter, loader]);\r\n    return {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        then: thenFactory(race, isAborted, abort),\r\n        abort: abort,\r\n        isAborted: isAborted,\r\n    };\r\n}\r\n/**\r\n * checked whether the given argument is an abortable Promise\r\n * @param {IAbortAblePromise<any> | any} candidate\r\n * @returns {boolean}\r\n */\r\nexport function isAbortAble(candidate) {\r\n    return (candidate != null &&\r\n        candidate &&\r\n        typeof candidate.then === 'function' &&\r\n        typeof candidate.abort === 'function');\r\n}\r\nexport function isAsyncUpdate(update) {\r\n    return update !== undefined && update !== null && update && isAbortAble(update.ready);\r\n}\r\n/**\r\n * similar to Promise.resolve\r\n */\r\nexport function abortAbleResolveNow(value) {\r\n    function then(onfulfilled, _onrejected) {\r\n        var res = onfulfilled ? onfulfilled(value) : value;\r\n        if (isAbortAble(res)) {\r\n            return res;\r\n        }\r\n        if (isPromiseLike(res)) {\r\n            return abortAble(res);\r\n        }\r\n        return {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            then: abortAbleResolveNow(res),\r\n            abort: function () { return undefined; },\r\n            isAborted: function () { return false; },\r\n        };\r\n    }\r\n    return {\r\n        then: then,\r\n        abort: function () { return undefined; },\r\n        isAborted: function () { return false; },\r\n    };\r\n}\r\n//# sourceMappingURL=abortAble.js.map","import type {\n  Column,\n  Ranking,\n  IColumnConstructor,\n  IColumnDesc,\n  IGroup,\n  IndicesArray,\n  IDataRow,\n  IRankingDump,\n  EAggregationState,\n  IColorMappingFunctionConstructor,\n  IMappingFunctionConstructor,\n  ITypeFactory,\n} from '../model';\nimport type { AEventDispatcher, ISequence } from '../internal';\nimport type { IRenderTasks } from '../renderer';\nimport type { IAbortAblePromise as IAbortAblePromiseImpl } from 'lineupengine';\n\nexport { ABORTED } from 'lineupengine';\nexport declare type IAbortAblePromise<T> = IAbortAblePromiseImpl<T>;\n\nexport declare type IAggregationStrategy = 'group' | 'item' | 'group+item' | 'group+top+item' | 'group+item+top';\n\nexport interface IDataProviderOptions {\n  columnTypes: { [columnType: string]: IColumnConstructor };\n  colorMappingFunctionTypes: { [colorMappingFunctionType: string]: IColorMappingFunctionConstructor };\n  mappingFunctionTypes: { [mappingFunctionType: string]: IMappingFunctionConstructor };\n\n  /**\n   * allow just single selected rows\n   * @default: false\n   */\n  singleSelection: boolean;\n\n  /**\n   * show top N rows as sample rows\n   * @default 10\n   */\n  showTopN: number;\n\n  /**\n   * aggregation strategy to show upon grouping, see also showTopN\n   * @default 'item'\n   */\n  aggregationStrategy: IAggregationStrategy;\n\n  /**\n   * whether to propagate a collapse operation to its children\n   * @default true\n   */\n  propagateAggregationState: boolean;\n}\n\nexport interface IDataProvider extends AEventDispatcher {\n  readonly columnTypes: { [columnType: string]: IColumnConstructor };\n\n  getTotalNumberOfRows(): number;\n\n  getTaskExecutor(): IRenderTasks;\n\n  getTypeFactory(): ITypeFactory;\n\n  takeSnapshot(col: Column): void;\n\n  selectAllOf(ranking: Ranking): void;\n\n  getSelection(): number[];\n\n  setSelection(dataIndices: IndicesArray): void;\n\n  toggleSelection(i: number, additional?: boolean): boolean;\n\n  isSelected(i: number): boolean;\n\n  removeRanking(ranking: Ranking): void;\n\n  ensureOneRanking(): void;\n\n  find(id: string): Column | null;\n\n  clone(col: Column): Column;\n\n  create(desc: IColumnDesc): Column | null;\n\n  toDescRef(desc: IColumnDesc): any;\n\n  fromDescRef(ref: any): IColumnDesc;\n\n  mappingSample(col: Column): Promise<ISequence<number>> | ISequence<number>;\n\n  searchAndJump(search: string | RegExp, col: Column): void;\n\n  getRankings(): Ranking[];\n\n  getFirstRanking(): Ranking | null;\n  getLastRanking(): Ranking;\n\n  getColumns(): IColumnDesc[];\n\n  getAggregationStrategy(): IAggregationStrategy;\n\n  isAggregated(ranking: Ranking, group: IGroup): boolean;\n\n  setAggregationState(ranking: Ranking, group: IGroup, state: EAggregationState): void;\n\n  getAggregationState(ranking: Ranking, group: IGroup): EAggregationState;\n\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean | number | EAggregationState, groups?: IGroup[]): void;\n\n  getTopNAggregated(ranking: Ranking, group: IGroup): number;\n\n  setTopNAggregated(ranking: Ranking, group: IGroup, value: number): void;\n\n  setShowTopN(value: number): void;\n  getShowTopN(): number;\n\n  getRow(dataIndex: number): Promise<IDataRow> | IDataRow;\n\n  clearFilters(): void;\n}\n\nexport const SCHEMA_REF = `https://lineup.js.org/develop/schema.4.0.0.json`;\n\nexport interface IDataProviderDump {\n  $schema?: string;\n  /**\n   * base for generating new uids\n   */\n  uid?: number;\n\n  /**\n   * current selection\n   */\n  selection?: number[];\n\n  /**\n   * list of aggregated group paths\n   */\n  aggregations?: string[] | { [key: string]: number };\n  /**\n   * ranking dumps\n   */\n  rankings?: IRankingDump[];\n\n  /**\n   * custom show top N setting\n   */\n  showTopN?: number;\n}\n\nexport interface IDeriveOptions {\n  /**\n   * maximal percentage of unique values to be treated as a categorical column\n   */\n  categoricalThreshold: number | ((unique: number, total: number) => boolean);\n\n  columns: string[];\n\n  /**\n   * date pattern to check for string matching them\n   * @default %x\n   */\n  datePattern: string | string[];\n}\n\nexport interface IExportOptions {\n  /**\n   * export separator, default: '\\t'\n   */\n  separator: string;\n  /**\n   * new line character, default: '\\n'\n   */\n  newline: string;\n  /**\n   * should a header be generated, default: true\n   */\n  header: boolean;\n  /**\n   * quote strings, default: false\n   */\n  quote: boolean;\n  /**\n   * quote string to use, default: '\"'\n   */\n  quoteChar: string;\n  /**\n   * filter specific column types, default: exclude all support types (selection, action, rank)\n   * @param col the column description to filter\n   */\n  filter: (col: Column) => boolean; //!isSupportType\n\n  /**\n   * whether the description should be part of the column header\n   */\n  verboseColumnHeaders: boolean;\n}\n","import type { IDataRow } from '../model';\nimport get from 'lodash.get';\n\n/**\n * @internal\n */\nexport function isComplexAccessor(column: any) {\n  // something like a.b or a[4]\n  return typeof column === 'string' && (column.includes('.') || column.includes('['));\n}\n\n/**\n * @internal\n */\nexport function resolveValue(value: any, column: string | number) {\n  if (value != null && value.hasOwnProperty(column)) {\n    // well complex but a direct hit\n    return value[column];\n  }\n  return get(value, column);\n}\n\n/**\n * @internal\n */\nexport function rowComplexGetter(row: IDataRow, desc: any) {\n  return resolveValue(row.v, desc.column);\n}\n\n/**\n * simple row getter\n * @internal\n */\nexport function rowGetter(row: IDataRow, desc: any) {\n  return row.v[desc.column];\n}\n\n/**\n * @internal\n */\nexport function rowGuessGetter(row: IDataRow, desc: any) {\n  const column = desc.column;\n  if (isComplexAccessor(column)) {\n    return rowComplexGetter(row, desc);\n  }\n  return rowGetter(row, desc);\n}\n","import { Ranking, isNumberColumn, Column, IColumnDesc, isSupportType, isMapAbleColumn, DEFAULT_COLOR } from '../model';\nimport { colorPool, MAX_COLORS } from '../model/internal';\nimport { concat, equal, extent, range, resolveValue } from '../internal';\nimport { timeParse } from 'd3-time-format';\nimport type { IDataProvider, IDeriveOptions, IExportOptions } from './interfaces';\n\n/**\n * @internal\n */\nexport function cleanCategories(categories: Set<string>) {\n  // remove missing values\n  categories.delete(null);\n  categories.delete(undefined);\n  categories.delete('');\n  categories.delete('NA');\n  categories.delete('NaN');\n  categories.delete('na');\n\n  return Array.from(categories).map(String).sort();\n}\n\nfunction hasDifferentSizes(data: any[][]) {\n  if (data.length === 0) {\n    return false;\n  }\n  const base = data[0].length;\n\n  return data.some((d) => d != null && base !== (Array.isArray(d) ? d.length : -1));\n}\n\nfunction isEmpty(v: any) {\n  return (\n    v == null ||\n    (Array.isArray(v) && v.length === 0) ||\n    (v instanceof Set && v.size === 0) ||\n    (v instanceof Map && v.size === 0) ||\n    equal({}, v)\n  );\n}\n\nfunction deriveBaseType(value: any, all: () => any[], column: number | string, options: IDeriveOptions) {\n  if (value == null) {\n    console.warn('cannot derive from null value for column: ', column);\n    return null;\n  }\n  // primitive\n  if (typeof value === 'number') {\n    return {\n      type: 'number',\n      domain: extent(all()),\n    };\n  }\n  if (typeof value === 'boolean') {\n    return {\n      type: 'boolean',\n    };\n  }\n\n  if (value instanceof Date) {\n    return {\n      type: 'date',\n    };\n  }\n  const formats = Array.isArray(options.datePattern) ? options.datePattern : [options.datePattern];\n  for (const format of formats) {\n    const dateParse = timeParse(format);\n    if (dateParse(value) == null) {\n      continue;\n    }\n    return {\n      type: 'date',\n      dateParse: format,\n    };\n  }\n  const treatAsCategorical =\n    typeof options.categoricalThreshold === 'function'\n      ? options.categoricalThreshold\n      : (u: number, t: number) => u < t * (options.categoricalThreshold as number);\n\n  if (typeof value === 'string') {\n    //maybe a categorical\n    const values = all();\n    const categories = new Set(values);\n    if (treatAsCategorical(categories.size, values.length)) {\n      return {\n        type: 'categorical',\n        categories: cleanCategories(categories),\n      };\n    }\n    return {\n      type: 'string',\n    };\n  }\n\n  if (typeof value === 'object' && value.alt != null && value.href != null) {\n    return {\n      type: 'link',\n    };\n  }\n\n  return null;\n}\n\nfunction deriveType(\n  label: string,\n  value: any,\n  column: number | string,\n  all: () => any[],\n  options: IDeriveOptions\n): IColumnDesc {\n  const base: any = {\n    type: 'string',\n    label,\n    column,\n  };\n\n  const primitive = deriveBaseType(value, all, column, options);\n  if (primitive != null) {\n    return Object.assign(base, primitive);\n  }\n\n  // set\n  if (value instanceof Set) {\n    const cats = new Set<string>();\n    for (const value of all()) {\n      if (!(value instanceof Set)) {\n        continue;\n      }\n      value.forEach((vi) => {\n        cats.add(String(vi));\n      });\n    }\n    return Object.assign(base, {\n      type: 'set',\n      categories: cleanCategories(cats),\n    });\n  }\n\n  // map\n  if (value instanceof Map) {\n    const first = Array.from(value.values()).find((d) => !isEmpty(d));\n    const mapAll = () => {\n      const r: any[] = [];\n      for (const vi of all()) {\n        if (!(vi instanceof Map)) {\n          continue;\n        }\n        vi.forEach((vii) => {\n          if (!isEmpty(vii)) {\n            r.push(vii);\n          }\n        });\n      }\n      return r;\n    };\n    const p = deriveBaseType(first, mapAll, column, options);\n    return Object.assign(base, p || {}, {\n      type: p ? `${p.type}Map` : 'stringMap',\n    });\n  }\n\n  // array\n  if (Array.isArray(value)) {\n    const values = all();\n    const sameLength = !hasDifferentSizes(values);\n    if (sameLength) {\n      base.dataLength = value.length;\n    }\n    const first = value.find((v) => !isEmpty(v));\n    const p = deriveBaseType(first, () => concat(values).filter((d) => !isEmpty(d)), column, options);\n    if (p && p.type === 'categorical' && !sameLength) {\n      return Object.assign(base, p, {\n        type: 'set',\n      });\n    }\n    if (p || isEmpty(first)) {\n      return Object.assign(base, p || {}, {\n        type: p ? `${p.type}s` : 'strings',\n      });\n    }\n\n    if (typeof first === 'object' && first.key != null && first.value != null) {\n      // key,value pair map\n      const mapAll = () => {\n        const r: any[] = [];\n        for (const vi of values) {\n          if (!Array.isArray(vi)) {\n            continue;\n          }\n          for (const vii of vi) {\n            if (!isEmpty(vii)) {\n              r.push(vii);\n            }\n          }\n        }\n        return r;\n      };\n      const p = deriveBaseType(first.value, mapAll, column, options);\n      return Object.assign(base, p || {}, {\n        type: p ? `${p.type}Map` : 'stringMap',\n      });\n    }\n  }\n\n  // check boxplot\n  const bs = ['min', 'max', 'median', 'q1', 'q3'];\n  if (value !== null && typeof value === 'object' && bs.every((b) => typeof value[b] === 'number')) {\n    //  boxplot\n    const vs = all();\n    return Object.assign(base, {\n      type: 'boxplot',\n      domain: [\n        vs.reduce((a, b) => Math.min(a, b.min), Number.POSITIVE_INFINITY),\n        vs.reduce((a, b) => Math.max(a, b.max), Number.NEGATIVE_INFINITY),\n      ],\n    });\n  }\n\n  if (value !== null && typeof value === 'object') {\n    // object map\n    const first = Object.keys(value)\n      .map((k) => value[k])\n      .filter((d) => !isEmpty(d));\n    const mapAll = () => {\n      const r: any[] = [];\n      for (const vi of all()) {\n        if (vi == null) {\n          continue;\n        }\n        Object.keys(vi).forEach((k) => {\n          const vii = vi[k];\n          if (!isEmpty(vii)) {\n            r.push(vii);\n          }\n        });\n      }\n      return r;\n    };\n    const p = deriveBaseType(first, mapAll, column, options);\n    return Object.assign(base, p || {}, {\n      type: p ? `${p.type}Map` : 'stringMap',\n    });\n  }\n\n  console.log('cannot infer type of column:', column);\n  //unknown type\n  return base;\n}\n\nfunction selectColumns(existing: string[], columns: string[]) {\n  const allNots = columns.every((d) => d.startsWith('-'));\n  if (!allNots) {\n    return columns;\n  }\n  // negate case, exclude columns that are given using -notation\n  const exclude = new Set(columns);\n  return existing.filter((d) => !exclude.has(`-${d}`));\n}\n\nfunction toLabel(key: string | number) {\n  if (typeof key === 'number') {\n    return `Col ${key + 1}`;\n  }\n  key = key.trim();\n  if (key.length === 0) {\n    return 'Unknown';\n  }\n  return key\n    .split(/[\\s]+/gm)\n    .map((k) => (k.length === 0 ? k : `${k[0]!.toUpperCase()}${k.slice(1)}`))\n    .join(' ');\n}\n\nexport function deriveColumnDescriptions(data: any[], options: Partial<IDeriveOptions> = {}) {\n  const config = Object.assign(\n    {\n      categoricalThreshold: (u: number, n: number) => u <= MAX_COLORS && u < n * 0.7, //70% unique and less equal to 22 categories\n      columns: [],\n      datePattern: ['%x', '%Y-%m-%d', '%Y-%m-%dT%H:%M:%S.%LZ'],\n    },\n    options\n  );\n\n  const r: IColumnDesc[] = [];\n  if (data.length === 0) {\n    // no data to derive something from\n    return r;\n  }\n\n  const first = data[0];\n  const columns: (number | string)[] = Array.isArray(first)\n    ? range(first.length)\n    : config.columns.length > 0\n    ? selectColumns(Object.keys(first), config.columns)\n    : Object.keys(first);\n\n  return columns.map((key) => {\n    let v = resolveValue(first, key);\n    if (isEmpty(v)) {\n      // cannot derive something from null try other rows\n      const foundRow = data.find((row) => !isEmpty(resolveValue(row, key)));\n      v = foundRow ? foundRow[key] : null;\n    }\n    return deriveType(\n      toLabel(key),\n      v,\n      key,\n      () => data.map((d) => resolveValue(d, key)).filter((d) => !isEmpty(d)),\n      config\n    );\n  });\n}\n\n/**\n * assigns colors to columns if they are numbers and not yet defined\n * @param columns\n * @returns {IColumnDesc[]}\n */\nexport function deriveColors(columns: IColumnDesc[]) {\n  const colors = colorPool();\n  columns.forEach((col: IColumnDesc) => {\n    if (isMapAbleColumn(col)) {\n      col.colorMapping = col.colorMapping || col.color || colors() || DEFAULT_COLOR;\n    }\n  });\n  return columns;\n}\n\n/**\n * utility to export a ranking to a table with the given separator\n * @param ranking\n * @param data\n * @param options\n * @returns {Promise<string>}\n */\nexport function exportRanking(ranking: Ranking, data: any[], options: Partial<IExportOptions> = {}) {\n  const opts: IExportOptions = Object.assign(\n    {\n      separator: '\\t',\n      newline: '\\n',\n      header: true,\n      quote: false,\n      quoteChar: '\"',\n      filter: (c: Column) => !isSupportType(c),\n      verboseColumnHeaders: false,\n    },\n    options\n  );\n\n  //optionally quote not numbers\n  const escape = new RegExp(`[${opts.quoteChar}]`, 'g');\n\n  function quote(v: any, c?: Column) {\n    const l = String(v);\n    if ((opts.quote || l.indexOf('\\n') >= 0) && (!c || !isNumberColumn(c))) {\n      return `${opts.quoteChar}${l.replace(escape, opts.quoteChar + opts.quoteChar)}${opts.quoteChar}`;\n    }\n    return l;\n  }\n\n  const columns = ranking.flatColumns.filter((c) => opts.filter(c));\n  const order = ranking.getOrder();\n\n  const r: string[] = [];\n  if (opts.header) {\n    r.push(\n      columns\n        .map((d) => quote(`${d.label}${opts.verboseColumnHeaders && d.description ? `\\n${d.description}` : ''}`))\n        .join(opts.separator)\n    );\n  }\n  data.forEach((row, i) => {\n    r.push(columns.map((c) => quote(c.getExportValue({ v: row, i: order[i] }, 'text'), c)).join(opts.separator));\n  });\n  return r.join(opts.newline);\n}\n\n/** @internal */\nexport function map2Object<T>(map: Map<string, T>) {\n  const r: { [key: string]: T } = {};\n  map.forEach((v, k) => (r[k] = v));\n  return r;\n}\n\n/** @internal */\nexport function object2Map<T>(obj: { [key: string]: T }) {\n  const r = new Map<string, T>();\n  for (const k of Object.keys(obj)) {\n    r.set(k, obj[k]);\n  }\n  return r;\n}\n\n/** @internal */\nexport function rangeSelection(\n  provider: IDataProvider,\n  rankingId: string,\n  dataIndex: number,\n  relIndex: number,\n  ctrlKey: boolean\n) {\n  const ranking = provider.getRankings().find((d) => d.id === rankingId);\n  if (!ranking) {\n    // no known reference\n    return false;\n  }\n  const selection = provider.getSelection();\n  if (selection.length === 0 || selection.includes(dataIndex)) {\n    return false; // no other or deselect\n  }\n  const order = ranking.getOrder();\n  const lookup = new Map(Array.from(order).map((d, i) => [d, i]));\n  const distances = selection.map((d) => {\n    const index = lookup.has(d) ? lookup.get(d)! : Number.POSITIVE_INFINITY;\n    return { s: d, index, distance: Math.abs(relIndex - index) };\n  });\n  const nearest = distances.sort((a, b) => a.distance - b.distance)[0]!;\n  if (!isFinite(nearest.distance)) {\n    return false; // all outside\n  }\n  if (!ctrlKey) {\n    selection.splice(0, selection.length);\n    selection.push(nearest.s);\n  }\n  if (nearest.index < relIndex) {\n    for (let i = nearest.index + 1; i <= relIndex; ++i) {\n      selection.push(order[i]);\n    }\n  } else {\n    for (let i = relIndex; i <= nearest.index; ++i) {\n      selection.push(order[i]);\n    }\n  }\n  provider.setSelection(selection);\n  return true;\n}\n","import type { IAggregationStrategy } from './interfaces';\nimport { IOrderedGroup, IGroup, IGroupParent, IGroupData, IGroupItem, isGroup, EAggregationState } from '../model';\n\nexport function isAlwaysShowingGroupStrategy(strategy: IAggregationStrategy) {\n  return strategy === 'group+item' || strategy === 'group+item+top' || strategy === 'group+top+item';\n}\n\nexport function hasTopNStrategy(strategy: IAggregationStrategy) {\n  return strategy === 'group+item+top' || strategy === 'group+top+item';\n}\n\nexport function convertAggregationState(state: boolean | number | EAggregationState, topN: number) {\n  if (typeof state === 'boolean') {\n    return state ? 0 : -1;\n  }\n  if (state === EAggregationState.COLLAPSE) {\n    return 0;\n  }\n  if (state === EAggregationState.EXPAND) {\n    return -1;\n  }\n  if (state === EAggregationState.EXPAND_TOP_N) {\n    return topN;\n  }\n  return state;\n}\n\nexport declare type IGroupMeta = 'first' | 'last' | 'first last' | null;\n\nexport function toItemMeta(relativeIndex: number, group: IOrderedGroup, topN: number): IGroupMeta {\n  if (relativeIndex === 0) {\n    return group.order.length === 1 ? 'first last' : 'first';\n  }\n  if (relativeIndex === group.order.length - 1 || (topN > 0 && relativeIndex === topN - 1)) {\n    return 'last';\n  }\n  return null;\n}\n\nexport function groupParents(group: IGroup, meta: IGroupMeta) {\n  const parents: { group: IGroup; meta: IGroupMeta }[] = [{ group, meta }];\n\n  let prev = group;\n  let prevMeta = meta;\n  let parent: IGroupParent | undefined | null = group.parent;\n\n  while (parent) {\n    if (parent.subGroups.length === 1 && prevMeta === 'first last') {\n      meta = 'first last';\n    } else if (parent.subGroups[0] === prev && (prevMeta === 'first last' || prevMeta === 'first')) {\n      meta = 'first';\n    } else if (\n      parent.subGroups[parent.subGroups.length - 1] === prev &&\n      (prevMeta === 'last' || prevMeta === 'first last')\n    ) {\n      meta = 'last';\n    } else {\n      meta = null;\n    }\n    parents.unshift({ group: parent, meta });\n\n    prev = parent;\n    prevMeta = meta;\n    parent = parent.parent;\n  }\n  return parents;\n}\n\nexport interface ITopNGetter {\n  (item: IGroup): number;\n}\n\n/**\n * number of group levels this items ends\n */\nexport function groupEndLevel(item: IGroupData | IGroupItem, topNGetter: ITopNGetter) {\n  const group: IGroup = isGroup(item) ? item : item.group;\n  const last = isGroup(item) ? 'first last' : toItemMeta(item.relativeIndex, item.group, topNGetter(group));\n  if (last !== 'last' && last !== 'first last') {\n    return 0;\n  }\n\n  let prev = group;\n  let parent: IGroupParent | undefined | null = group.parent;\n  let i = 1;\n\n  while (parent) {\n    if (!(parent.subGroups.length === 1 || parent.subGroups[parent.subGroups.length - 1] === prev)) {\n      // not last of group - end\n      return i;\n    }\n    ++i;\n    prev = parent;\n    parent = parent.parent;\n  }\n\n  return i;\n}\n\nexport function isSummaryGroup(group: IGroup, strategy: IAggregationStrategy, topNGetter: ITopNGetter) {\n  const topN = topNGetter(group);\n  return isAlwaysShowingGroupStrategy(strategy) && topN !== 0;\n}\n\nexport function toRowMeta(\n  item: IGroupData | IGroupItem,\n  strategy: IAggregationStrategy,\n  topNGetter: ITopNGetter\n): string | null {\n  if (isGroup(item)) {\n    if (isSummaryGroup(item, strategy, topNGetter)) {\n      return 'first';\n    }\n    const level = groupEndLevel(item, topNGetter);\n    if (level === 0) {\n      return 'first';\n    }\n    return `first last${level === 1 ? '' : level - 1}`;\n  }\n\n  const last = toItemMeta(item.relativeIndex, item.group, topNGetter(item.group));\n  if (last == null) {\n    return null;\n  }\n  const level = groupEndLevel(item, topNGetter);\n  if (level === 0) {\n    return null;\n  }\n  return `last${level === 1 ? '' : level - 1}`;\n}\n","import {\n  AEventDispatcher,\n  debounce,\n  ISequence,\n  OrderedSet,\n  IDebounceContext,\n  IEventListener,\n  suffix,\n  IEventContext,\n} from '../internal';\nimport {\n  Column,\n  IColumnConstructor,\n  Ranking,\n  AggregateGroupColumn,\n  createAggregateDesc,\n  IAggregateGroupColumnDesc,\n  isSupportType,\n  EDirtyReason,\n  RankColumn,\n  createRankDesc,\n  createSelectionDesc,\n  IColumnDesc,\n  IDataRow,\n  IGroup,\n  IndicesArray,\n  IOrderedGroup,\n  ISelectionColumnDesc,\n  EAggregationState,\n  IColumnDump,\n  IRankingDump,\n  IColorMappingFunctionConstructor,\n  IMappingFunctionConstructor,\n  ITypeFactory,\n} from '../model';\nimport { models } from '../model/models';\nimport { forEachIndices, everyIndices, toGroupID, unifyParents } from '../model/internal';\nimport { IDataProvider, IDataProviderDump, IDataProviderOptions, SCHEMA_REF, IExportOptions } from './interfaces';\nimport { exportRanking, map2Object, object2Map } from './utils';\nimport type { IRenderTasks } from '../renderer';\nimport { restoreCategoricalColorMapping } from '../model/CategoricalColorMappingFunction';\nimport { createColorMappingFunction, colorMappingFunctions } from '../model/ColorMappingFunction';\nimport { createMappingFunction, mappingFunctions } from '../model/MappingFunction';\nimport { convertAggregationState } from './internal';\n\n/**\n * emitted when a column has been added\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function addColumn(col: Column, index: number): void;\n\n/**\n * emitted when a column has been moved within this composite column\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\n\n/**\n * emitted when a column has been removed\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function removeColumn(col: Column, index: number): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function orderChanged(\n  previous: number[],\n  current: number[],\n  previousGroups: IOrderedGroup[],\n  currentGroups: IOrderedGroup[],\n  dirtyReason: EDirtyReason[]\n): void;\n\n/**\n * emitted when state of the column is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirty(): void;\n\n/**\n * emitted when state of the column related to its header is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirtyHeader(): void;\n\n/**\n * emitted when state of the column related to its values is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirtyValues(): void;\n\n/**\n * emitted when state of the column related to cached values (hist, compare, ...) is dirty\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function dirtyCaches(): void;\n\n/**\n * emitted when the data changes\n * @asMemberOf ADataProvider\n * @param rows the new data rows\n * @event\n */\nexport declare function dataChanged(rows: IDataRow[]): void;\n\n/**\n * emitted when the selection changes\n * @asMemberOf ADataProvider\n * @param dataIndices the selected data indices\n * @event\n */\nexport declare function selectionChanged(dataIndices: number[]): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function addRanking(ranking: Ranking, index: number): void;\n/**\n * @asMemberOf ADataProvider\n * @param ranking if null all rankings are removed else just the specific one\n * @event\n */\nexport declare function removeRanking(ranking: Ranking | null, index: number): void;\n\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function addDesc(desc: IColumnDesc): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function removeDesc(desc: IColumnDesc): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function clearDesc(): void;\n\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function showTopNChanged(previous: number, current: number): void;\n\n/**\n * emitted when the selection changes\n * @asMemberOf ADataProvider\n * @param dataIndices the selected data indices\n * @event\n */\nexport declare function jumpToNearest(dataIndices: number[]): void;\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function aggregate(\n  ranking: Ranking,\n  group: IGroup | IGroup[],\n  previousTopN: number | number[],\n  currentTopN: number | number[]\n): void;\n\n/**\n * @asMemberOf ADataProvider\n * @event\n */\nexport declare function busy(busy: boolean): void;\n\nfunction toDirtyReason(ctx: IEventContext) {\n  const primary = ctx.primaryType;\n  switch (primary || '') {\n    case Ranking.EVENT_DIRTY_ORDER:\n      return ctx.args[0] || [EDirtyReason.UNKNOWN];\n    case Ranking.EVENT_SORT_CRITERIA_CHANGED:\n      return [EDirtyReason.SORT_CRITERIA_CHANGED];\n    case Ranking.EVENT_GROUP_CRITERIA_CHANGED:\n      return [EDirtyReason.GROUP_CRITERIA_CHANGED];\n    case Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED:\n      return [EDirtyReason.GROUP_SORT_CRITERIA_CHANGED];\n    default:\n      return [EDirtyReason.UNKNOWN];\n  }\n}\n\nfunction mergeDirtyOrderContext(current: IDebounceContext, next: IDebounceContext) {\n  const currentReason = toDirtyReason(current.self);\n  const nextReason = toDirtyReason(next.self);\n  const combined = new Set(currentReason);\n  for (const r of nextReason) {\n    combined.add(r);\n  }\n  const args = [Array.from(combined)];\n  return {\n    self: {\n      primaryType: Ranking.EVENT_DIRTY_ORDER,\n      args,\n    },\n    args,\n  };\n}\n\n/**\n * a basic data provider holding the data and rankings\n */\nabstract class ADataProvider extends AEventDispatcher implements IDataProvider {\n  static readonly EVENT_SELECTION_CHANGED = 'selectionChanged';\n  static readonly EVENT_DATA_CHANGED = 'dataChanged';\n  static readonly EVENT_ADD_COLUMN = Ranking.EVENT_ADD_COLUMN;\n  static readonly EVENT_MOVE_COLUMN = Ranking.EVENT_MOVE_COLUMN;\n  static readonly EVENT_REMOVE_COLUMN = Ranking.EVENT_REMOVE_COLUMN;\n  static readonly EVENT_ADD_RANKING = 'addRanking';\n  static readonly EVENT_REMOVE_RANKING = 'removeRanking';\n  static readonly EVENT_DIRTY = Ranking.EVENT_DIRTY;\n  static readonly EVENT_DIRTY_HEADER = Ranking.EVENT_DIRTY_HEADER;\n  static readonly EVENT_DIRTY_VALUES = Ranking.EVENT_DIRTY_VALUES;\n  static readonly EVENT_DIRTY_CACHES = Ranking.EVENT_DIRTY_CACHES;\n  static readonly EVENT_ORDER_CHANGED = Ranking.EVENT_ORDER_CHANGED;\n  static readonly EVENT_SHOWTOPN_CHANGED = 'showTopNChanged';\n  static readonly EVENT_ADD_DESC = 'addDesc';\n  static readonly EVENT_CLEAR_DESC = 'clearDesc';\n  static readonly EVENT_REMOVE_DESC = 'removeDesc';\n  static readonly EVENT_JUMP_TO_NEAREST = 'jumpToNearest';\n  static readonly EVENT_GROUP_AGGREGATION_CHANGED = AggregateGroupColumn.EVENT_AGGREGATE;\n  static readonly EVENT_BUSY = 'busy';\n\n  private static readonly FORWARD_RANKING_EVENTS = suffix(\n    '.provider',\n    Ranking.EVENT_ADD_COLUMN,\n    Ranking.EVENT_REMOVE_COLUMN,\n    Ranking.EVENT_DIRTY,\n    Ranking.EVENT_DIRTY_HEADER,\n    Ranking.EVENT_MOVE_COLUMN,\n    Ranking.EVENT_ORDER_CHANGED,\n    Ranking.EVENT_DIRTY_VALUES,\n    Ranking.EVENT_DIRTY_CACHES\n  );\n\n  /**\n   * all rankings\n   * @type {Array}\n   * @private\n   */\n  private readonly rankings: Ranking[] = [];\n\n  /**\n   * the current selected indices\n   * @type {OrderedSet}\n   */\n  private readonly selection = new OrderedSet<number>();\n\n  //Map<ranking.id@group.name, -1=expand,0=collapse,N=topN>\n  private readonly aggregations = new Map<string, number>(); // not part of = show all\n\n  private uid = 0;\n  private readonly typeFactory: ITypeFactory;\n\n  private readonly options: Readonly<IDataProviderOptions> = {\n    columnTypes: {},\n    colorMappingFunctionTypes: {},\n    mappingFunctionTypes: {},\n    singleSelection: false,\n    showTopN: 10,\n    aggregationStrategy: 'item',\n    propagateAggregationState: true,\n  };\n\n  /**\n   * lookup map of a column type to its column implementation\n   */\n  readonly columnTypes: { [columnType: string]: IColumnConstructor };\n  readonly colorMappingFunctionTypes: { [colorMappingFunctionType: string]: IColorMappingFunctionConstructor };\n  readonly mappingFunctionTypes: { [mappingFunctionType: string]: IMappingFunctionConstructor };\n\n  private showTopN: number;\n\n  constructor(options: Partial<IDataProviderOptions> = {}) {\n    super();\n    Object.assign(this.options, options);\n    this.columnTypes = Object.assign(models(), this.options.columnTypes);\n    this.colorMappingFunctionTypes = Object.assign(colorMappingFunctions(), this.options.colorMappingFunctionTypes);\n    this.mappingFunctionTypes = Object.assign(mappingFunctions(), this.options.mappingFunctionTypes);\n    this.showTopN = this.options.showTopN;\n\n    this.typeFactory = this.createTypeFactory();\n  }\n\n  private createTypeFactory() {\n    const factory = ((d: IColumnDump) => {\n      const desc = this.fromDescRef(d.desc);\n      if (!desc || !desc.type) {\n        console.warn('cannot restore column dump', d);\n        return new Column(d.id || '', d.desc || {});\n      }\n      this.fixDesc(desc);\n      const type = this.columnTypes[desc.type];\n      if (type == null) {\n        console.warn('invalid column type in column dump using column', d);\n        return new Column(d.id || '', desc);\n      }\n      const c = this.instantiateColumn(type, '', desc, this.typeFactory);\n      c.restore(d, factory);\n      return c;\n    }) as ITypeFactory;\n    factory.colorMappingFunction = createColorMappingFunction(this.colorMappingFunctionTypes, factory);\n    factory.mappingFunction = createMappingFunction(this.mappingFunctionTypes);\n    factory.categoricalColorMappingFunction = restoreCategoricalColorMapping;\n    return factory;\n  }\n\n  getTypeFactory() {\n    return this.typeFactory;\n  }\n\n  /**\n   * events:\n   *  * column changes: addColumn, removeColumn\n   *  * ranking changes: addRanking, removeRanking\n   *  * dirty: dirty, dirtyHeder, dirtyValues\n   *  * selectionChanged\n   * @returns {string[]}\n   */\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ADataProvider.EVENT_DATA_CHANGED,\n        ADataProvider.EVENT_BUSY,\n        ADataProvider.EVENT_SHOWTOPN_CHANGED,\n        ADataProvider.EVENT_ADD_COLUMN,\n        ADataProvider.EVENT_REMOVE_COLUMN,\n        ADataProvider.EVENT_MOVE_COLUMN,\n        ADataProvider.EVENT_ADD_RANKING,\n        ADataProvider.EVENT_REMOVE_RANKING,\n        ADataProvider.EVENT_DIRTY,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY_CACHES,\n        ADataProvider.EVENT_ORDER_CHANGED,\n        ADataProvider.EVENT_SELECTION_CHANGED,\n        ADataProvider.EVENT_ADD_DESC,\n        ADataProvider.EVENT_CLEAR_DESC,\n        ADataProvider.EVENT_JUMP_TO_NEAREST,\n        ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED,\n      ]);\n  }\n\n  on(type: typeof ADataProvider.EVENT_BUSY, listener: typeof busy | null): this;\n  on(type: typeof ADataProvider.EVENT_DATA_CHANGED, listener: typeof dataChanged | null): this;\n  on(type: typeof ADataProvider.EVENT_SHOWTOPN_CHANGED, listener: typeof showTopNChanged | null): this;\n  on(type: typeof ADataProvider.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\n  on(type: typeof ADataProvider.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\n  on(type: typeof ADataProvider.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\n  on(type: typeof ADataProvider.EVENT_ADD_RANKING, listener: typeof addRanking | null): this;\n  on(type: typeof ADataProvider.EVENT_REMOVE_RANKING, listener: typeof removeRanking | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY, listener: typeof dirty | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\n  on(type: typeof ADataProvider.EVENT_DIRTY_CACHES, listener: typeof dirtyCaches | null): this;\n  on(type: typeof ADataProvider.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\n  on(type: typeof ADataProvider.EVENT_ADD_DESC, listener: typeof addDesc | null): this;\n  on(type: typeof ADataProvider.EVENT_REMOVE_DESC, listener: typeof removeDesc | null): this;\n  on(type: typeof ADataProvider.EVENT_CLEAR_DESC, listener: typeof clearDesc | null): this;\n  on(type: typeof ADataProvider.EVENT_JUMP_TO_NEAREST, listener: typeof jumpToNearest | null): this;\n  on(type: typeof ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, listener: typeof aggregate | null): this;\n  on(type: typeof ADataProvider.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  abstract getTotalNumberOfRows(): number;\n\n  /**\n   * returns a list of all known column descriptions\n   * @returns {Array}\n   */\n  abstract getColumns(): IColumnDesc[];\n\n  abstract getTaskExecutor(): IRenderTasks;\n\n  /**\n   * adds a new ranking\n   * @param existing an optional existing ranking to clone\n   * @return the new ranking\n   */\n  pushRanking(existing?: Ranking): Ranking {\n    const r = this.cloneRanking(existing);\n\n    this.insertRanking(r);\n    return r;\n  }\n\n  protected fireBusy(busy: boolean) {\n    this.fire(ADataProvider.EVENT_BUSY, busy);\n  }\n\n  takeSnapshot(col: Column): Ranking {\n    this.fireBusy(true);\n    const r = this.cloneRanking();\n    const ranking = col.findMyRanker();\n    // by convention copy all support types and the first string column\n    let hasString = col.desc.type === 'string';\n    let hasColumn = false;\n    const toClone = !ranking\n      ? [col]\n      : ranking.children.filter((c) => {\n          if (c === col) {\n            hasColumn = true;\n            return true;\n          }\n          if (!hasString && c.desc.type === 'string') {\n            hasString = true;\n            return true;\n          }\n          return isSupportType(c);\n        });\n\n    if (!hasColumn) {\n      // maybe a nested one thus not in the top level\n      toClone.push(col);\n    }\n\n    toClone.forEach((c) => {\n      const clone = this.clone(c);\n      r.push(clone);\n      if (c === col) {\n        clone.sortByMe();\n      }\n    });\n    this.insertRanking(r);\n    this.fireBusy(false);\n    return r;\n  }\n\n  insertRanking(r: Ranking, index = this.rankings.length) {\n    this.rankings.splice(index, 0, r);\n    this.forward(r, ...ADataProvider.FORWARD_RANKING_EVENTS);\n    //delayed reordering per ranking\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    r.on(\n      `${Ranking.EVENT_DIRTY_ORDER}.provider`,\n      debounce(\n        function (this: IEventContext) {\n          that.triggerReorder(r, toDirtyReason(this));\n        },\n        100,\n        mergeDirtyOrderContext\n      )\n    );\n    this.fire(\n      [\n        ADataProvider.EVENT_ADD_RANKING,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY,\n      ],\n      r,\n      index\n    );\n    this.triggerReorder(r);\n  }\n\n  private triggerReorder(ranking: Ranking, dirtyReason?: EDirtyReason[]) {\n    this.fireBusy(true);\n    const reason = dirtyReason || [EDirtyReason.UNKNOWN];\n    Promise.resolve(this.sort(ranking, reason)).then(({ groups, index2pos }) => {\n      if (ranking.getGroupSortCriteria().length === 0) {\n        groups = unifyParents(groups);\n      }\n      this.initAggregateState(ranking, groups);\n      ranking.setGroups(groups, index2pos, reason);\n      this.fireBusy(false);\n    });\n  }\n\n  /**\n   * removes a ranking from this data provider\n   * @param ranking\n   * @returns {boolean}\n   */\n  removeRanking(ranking: Ranking) {\n    const i = this.rankings.indexOf(ranking);\n    if (i < 0) {\n      return false;\n    }\n    this.unforward(ranking, ...ADataProvider.FORWARD_RANKING_EVENTS);\n    this.rankings.splice(i, 1);\n    ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\n    this.cleanUpRanking(ranking);\n    this.fire(\n      [\n        ADataProvider.EVENT_REMOVE_RANKING,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY,\n      ],\n      ranking,\n      i\n    );\n    return true;\n  }\n\n  /**\n   * removes all rankings\n   */\n  clearRankings() {\n    this.rankings.forEach((ranking) => {\n      this.unforward(ranking, ...ADataProvider.FORWARD_RANKING_EVENTS);\n      ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\n      this.cleanUpRanking(ranking);\n    });\n    // clear\n    this.rankings.splice(0, this.rankings.length);\n    this.fire(\n      [\n        ADataProvider.EVENT_REMOVE_RANKING,\n        ADataProvider.EVENT_DIRTY_HEADER,\n        ADataProvider.EVENT_DIRTY_VALUES,\n        ADataProvider.EVENT_DIRTY,\n      ],\n      null,\n      -1\n    );\n  }\n\n  clearFilters() {\n    this.rankings.forEach((ranking) => ranking.clearFilters());\n  }\n\n  /**\n   * returns a list of all current rankings\n   * @returns {Ranking[]}\n   */\n  getRankings() {\n    return this.rankings.slice();\n  }\n\n  /**\n   * returns the last ranking for quicker access\n   * @returns {Ranking}\n   */\n  getFirstRanking() {\n    return this.rankings[0] || null;\n  }\n\n  /**\n   * returns the last ranking for quicker access\n   * @returns {Ranking}\n   */\n  getLastRanking() {\n    return this.rankings[this.rankings.length - 1];\n  }\n\n  ensureOneRanking() {\n    if (this.rankings.length === 0) {\n      const r = this.pushRanking();\n      this.push(r, createRankDesc());\n    }\n  }\n\n  destroy() {\n    // dummy\n  }\n\n  /**\n   * hook method for cleaning up a ranking\n   * @param _ranking\n   */\n  cleanUpRanking(_ranking: Ranking) {\n    // dummy\n  }\n\n  /**\n   * abstract method for cloning a ranking\n   * @param existing\n   * @returns {null}\n   */\n  abstract cloneRanking(existing?: Ranking): Ranking;\n\n  /**\n   * adds a column to a ranking described by its column description\n   * @param ranking the ranking to add the column to\n   * @param desc the description of the column\n   * @return {Column} the newly created column or null\n   */\n  push(ranking: Ranking, desc: IColumnDesc): Column | null {\n    const r = this.create(desc);\n    if (r) {\n      ranking.push(r);\n      return r;\n    }\n    return null;\n  }\n\n  /**\n   * adds a column to a ranking described by its column description\n   * @param ranking the ranking to add the column to\n   * @param index the position to insert the column\n   * @param desc the description of the column\n   * @return {Column} the newly created column or null\n   */\n  insert(ranking: Ranking, index: number, desc: IColumnDesc) {\n    const r = this.create(desc);\n    if (r) {\n      ranking.insert(r, index);\n      return r;\n    }\n    return null;\n  }\n\n  /**\n   * creates a new unique id for a column\n   * @returns {string}\n   */\n  private nextId() {\n    return `col${this.uid++}`;\n  }\n\n  private fixDesc(desc: IColumnDesc) {\n    //hacks for provider dependent descriptors\n    if (desc.type === 'selection') {\n      (desc as ISelectionColumnDesc).accessor = (row: IDataRow) => this.isSelected(row.i);\n      (desc as ISelectionColumnDesc).setter = (index: number, value: boolean) =>\n        value ? this.select(index) : this.deselect(index);\n      (desc as ISelectionColumnDesc).setterAll = (indices: IndicesArray, value: boolean) =>\n        value ? this.selectAll(indices) : this.deselectAll(indices);\n    } else if (desc.type === 'aggregate') {\n      (desc as IAggregateGroupColumnDesc).isAggregated = (ranking: Ranking, group: IGroup) =>\n        this.getAggregationState(ranking, group);\n      (desc as IAggregateGroupColumnDesc).setAggregated = (ranking: Ranking, group: IGroup, value: EAggregationState) =>\n        this.setAggregationState(ranking, group, value);\n    }\n    return desc;\n  }\n\n  protected cleanDesc(desc: IColumnDesc) {\n    //hacks for provider dependent descriptors\n    if (desc.type === 'selection') {\n      delete (desc as ISelectionColumnDesc).accessor;\n      delete (desc as ISelectionColumnDesc).setter;\n      delete (desc as ISelectionColumnDesc).setterAll;\n    } else if (desc.type === 'aggregate') {\n      delete (desc as IAggregateGroupColumnDesc).isAggregated;\n      delete (desc as IAggregateGroupColumnDesc).setAggregated;\n    }\n    return desc;\n  }\n\n  /**\n   * creates an internal column model out of the given column description\n   * @param desc\n   * @returns {Column} the new column or null if it can't be created\n   */\n  create(desc: IColumnDesc): Column | null {\n    this.fixDesc(desc);\n    //find by type and instantiate\n    const type = this.columnTypes[desc.type];\n    if (type) {\n      return this.instantiateColumn(type, this.nextId(), desc, this.typeFactory);\n    }\n    return null;\n  }\n\n  protected instantiateColumn(type: IColumnConstructor, id: string, desc: IColumnDesc, typeFactory: ITypeFactory) {\n    return new type(id, desc, typeFactory);\n  }\n\n  /**\n   * clones a column by dumping and restoring\n   * @param col\n   * @returns {Column}\n   */\n  clone(col: Column) {\n    const dump = this.dumpColumn(col);\n    return this.restoreColumn(dump);\n  }\n\n  /**\n   * restores a column from a dump\n   * @param dump\n   * @returns {Column}\n   */\n  restoreColumn(dump: any): Column {\n    const c = this.typeFactory(dump);\n    c.assignNewId(this.nextId.bind(this));\n    return c;\n  }\n\n  /**\n   * finds a column in all rankings returning the first match\n   * @param idOrFilter by id or by a filter function\n   * @returns {Column}\n   */\n  find(idOrFilter: string | ((col: Column) => boolean)): Column | null {\n    //convert to function\n    const filter = typeof idOrFilter === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\n\n    for (const ranking of this.rankings) {\n      const r = ranking.find(filter);\n      if (r) {\n        return r;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * dumps this whole provider including selection and the rankings\n   * @returns {{uid: number, selection: number[], rankings: *[]}}\n   */\n  dump(): IDataProviderDump {\n    return {\n      $schema: SCHEMA_REF,\n      uid: this.uid,\n      selection: this.getSelection(),\n      aggregations: map2Object(this.aggregations),\n      rankings: this.rankings.map((r) => r.dump(this.toDescRef.bind(this))),\n      showTopN: this.showTopN,\n    };\n  }\n\n  /**\n   * dumps a specific column\n   */\n  dumpColumn(col: Column): IColumnDump {\n    return col.dump(this.toDescRef.bind(this));\n  }\n\n  /**\n   * for better dumping describe reference, by default just return the description\n   */\n  toDescRef(desc: any): any {\n    return desc;\n  }\n\n  /**\n   * inverse operation of toDescRef\n   */\n  fromDescRef(descRef: any): any {\n    return descRef;\n  }\n\n  restoreRanking(dump: IRankingDump) {\n    const ranking = this.cloneRanking();\n    ranking.restore(dump, this.typeFactory);\n    const idGenerator = this.nextId.bind(this);\n    ranking.children.forEach((c) => c.assignNewId(idGenerator));\n    return ranking;\n  }\n\n  restore(dump: IDataProviderDump) {\n    //clean old\n    this.clearRankings();\n\n    //restore selection\n    this.uid = dump.uid || 0;\n    if (dump.selection) {\n      dump.selection.forEach((s: number) => this.selection.add(s));\n    }\n    if (dump.showTopN != null) {\n      this.showTopN = dump.showTopN;\n    }\n    if (dump.aggregations) {\n      this.aggregations.clear();\n      if (Array.isArray(dump.aggregations)) {\n        dump.aggregations.forEach((a: string) => this.aggregations.set(a, 0));\n      } else {\n        object2Map(dump.aggregations).forEach((v, k) => this.aggregations.set(k, v));\n      }\n    }\n\n    //restore rankings\n    if (dump.rankings) {\n      dump.rankings.forEach((r: any) => {\n        const ranking = this.cloneRanking();\n        ranking.restore(r, this.typeFactory);\n        //if no rank column add one\n        if (!ranking.children.some((d) => d instanceof RankColumn)) {\n          ranking.insert(this.create(createRankDesc())!, 0);\n        }\n        this.insertRanking(ranking);\n      });\n    }\n\n    //assign new ids\n    const idGenerator = this.nextId.bind(this);\n    this.rankings.forEach((r) => {\n      r.children.forEach((c) => c.assignNewId(idGenerator));\n    });\n  }\n\n  abstract findDesc(ref: string): IColumnDesc | null;\n\n  /**\n   * generates a default ranking by using all column descriptions ones\n   */\n  deriveDefault(addSupportType = true) {\n    const r = this.pushRanking();\n    if (addSupportType) {\n      r.push(this.create(createAggregateDesc())!);\n      r.push(this.create(createRankDesc())!);\n      if (this.options.singleSelection !== true) {\n        r.push(this.create(createSelectionDesc())!);\n      }\n    }\n    this.getColumns().forEach((col) => {\n      const c = this.create(col);\n      if (!c || isSupportType(c)) {\n        return;\n      }\n      r.push(c);\n    });\n    return r;\n  }\n\n  isAggregated(ranking: Ranking, group: IGroup) {\n    return this.getTopNAggregated(ranking, group) >= 0;\n  }\n\n  getAggregationState(ranking: Ranking, group: IGroup) {\n    const n = this.getTopNAggregated(ranking, group);\n    return n < 0 ? EAggregationState.EXPAND : n === 0 ? EAggregationState.COLLAPSE : EAggregationState.EXPAND_TOP_N;\n  }\n\n  setAggregated(ranking: Ranking, group: IGroup | IGroup[], value: boolean) {\n    return this.setAggregationState(ranking, group, value ? EAggregationState.COLLAPSE : EAggregationState.EXPAND);\n  }\n\n  setAggregationState(ranking: Ranking, group: IGroup | IGroup[], value: EAggregationState) {\n    this.setTopNAggregated(\n      ranking,\n      group,\n      value === EAggregationState.COLLAPSE ? 0 : value === EAggregationState.EXPAND_TOP_N ? this.showTopN : -1\n    );\n  }\n\n  getTopNAggregated(ranking: Ranking, group: IGroup) {\n    let g: IGroup | undefined | null = group;\n    while (g) {\n      const key = `${ranking.id}@${toGroupID(g)}`;\n      if (this.aggregations.has(key)) {\n        // propagate to leaf\n        const v = this.aggregations.get(key)!;\n        if (this.options.propagateAggregationState && group !== g) {\n          this.aggregations.set(`${ranking.id}@${toGroupID(group)}`, v);\n        }\n        return v;\n      }\n      g = g.parent;\n    }\n    return -1;\n  }\n\n  private unaggregateParents(ranking: Ranking, group: IGroup) {\n    let g: IGroup | undefined | null = group.parent;\n    let changed = false;\n    while (g) {\n      changed = this.aggregations.delete(`${ranking.id}@${toGroupID(g)}`) || changed;\n      g = g.parent;\n    }\n    return changed;\n  }\n\n  getAggregationStrategy() {\n    return this.options.aggregationStrategy;\n  }\n\n  private initAggregateState(ranking: Ranking, groups: IGroup[]) {\n    let initial = -1;\n    switch (this.getAggregationStrategy()) {\n      case 'group':\n        initial = 0;\n        break;\n      case 'item':\n      case 'group+item':\n      case 'group+item+top':\n        initial = -1;\n        break;\n      case 'group+top+item':\n        initial = this.showTopN;\n        break;\n    }\n\n    for (const group of groups) {\n      const key = `${ranking.id}@${toGroupID(group)}`;\n      if (!this.aggregations.has(key) && initial >= 0) {\n        this.aggregations.set(key, initial);\n      }\n    }\n  }\n\n  setTopNAggregated(ranking: Ranking, group: IGroup | IGroup[], value: number | number[]) {\n    const groups = Array.isArray(group) ? group : [group];\n    const changed: IGroup[] = [];\n    const previous: number[] = [];\n\n    let changedParents = false;\n\n    for (let i = 0; i < groups.length; i++) {\n      const group = groups[i];\n      const target = typeof value === 'number' ? value : value[i];\n      changedParents = this.unaggregateParents(ranking, group) || changedParents;\n      const current = this.getTopNAggregated(ranking, group);\n      if (current === target) {\n        continue;\n      }\n      changed.push(group);\n      previous.push(current);\n      const key = `${ranking.id}@${toGroupID(group)}`;\n      if (target >= 0) {\n        this.aggregations.set(key, target);\n      } else {\n        this.aggregations.delete(key);\n      }\n    }\n    if (!changedParents && changed.length === 0) {\n      // no change\n      return;\n    }\n    if (!Array.isArray(group)) {\n      // single change\n      this.fire(\n        [ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY],\n        ranking,\n        group,\n        previous.length === 0 ? value : previous[0],\n        value\n      );\n    } else {\n      this.fire(\n        [ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY],\n        ranking,\n        group,\n        previous,\n        value\n      );\n    }\n  }\n\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean | number | EAggregationState, groups = ranking.getGroups()) {\n    const value = convertAggregationState(aggregateAll, this.showTopN);\n    this.setTopNAggregated(ranking, groups, value);\n  }\n\n  getShowTopN() {\n    return this.showTopN;\n  }\n\n  setShowTopN(value: number) {\n    if (this.showTopN === value) {\n      return;\n    }\n    // update entries\n    for (const [k, v] of Array.from(this.aggregations.entries())) {\n      if (v === this.showTopN) {\n        this.aggregations.set(k, value);\n      }\n    }\n    this.fire(\n      [ADataProvider.EVENT_SHOWTOPN_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY],\n      this.showTopN,\n      (this.showTopN = value)\n    );\n  }\n\n  /**\n   * sorts the given ranking and eventually return a ordering of the data items\n   * @param ranking\n   * @return {Promise<any>}\n   */\n  abstract sort(\n    ranking: Ranking,\n    dirtyReason: EDirtyReason[]\n  ):\n    | Promise<{ groups: IOrderedGroup[]; index2pos: IndicesArray }>\n    | { groups: IOrderedGroup[]; index2pos: IndicesArray };\n\n  /**\n   * returns a view in the order of the given indices\n   * @param indices\n   * @return {Promise<any>}\n   */\n  abstract view(indices: ArrayLike<number>): Promise<any[]> | any[];\n\n  abstract getRow(index: number): Promise<IDataRow> | IDataRow;\n\n  /**\n   * returns a data sample used for the mapping editor\n   * @param col\n   * @return {Promise<any>}\n   */\n  abstract mappingSample(col: Column): Promise<ISequence<number>> | ISequence<number>;\n\n  /**\n   * is the given row selected\n   * @param index\n   * @return {boolean}\n   */\n  isSelected(index: number) {\n    return this.selection.has(index);\n  }\n\n  /**\n   * also select the given row\n   * @param index\n   */\n  select(index: number) {\n    if (this.selection.has(index)) {\n      return; //no change\n    }\n    if (this.options.singleSelection === true && this.selection.size > 0) {\n      this.selection.clear();\n    }\n    this.selection.add(index);\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  /**\n   * hook for selecting elements matching the given arguments\n   * @param search\n   * @param col\n   */\n  abstract searchAndJump(search: string | RegExp, col: Column): void;\n\n  jumpToNearest(indices: number[]) {\n    if (indices.length === 0) {\n      return;\n    }\n    this.fire(ADataProvider.EVENT_JUMP_TO_NEAREST, indices);\n  }\n\n  /**\n   * also select all the given rows\n   * @param indices\n   */\n  selectAll(indices: IndicesArray) {\n    if (everyIndices(indices, (i) => this.selection.has(i))) {\n      return; //no change\n    }\n    if (this.options.singleSelection === true) {\n      this.selection.clear();\n      if (indices.length > 0) {\n        this.selection.add(indices[0]);\n      }\n    } else {\n      forEachIndices(indices, (index) => {\n        this.selection.add(index);\n      });\n    }\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  selectAllOf(ranking: Ranking) {\n    this.setSelection(Array.from(ranking.getOrder()));\n  }\n\n  /**\n   * set the selection to the given rows\n   * @param indices\n   */\n  setSelection(indices: number[]) {\n    if (indices.length === 0) {\n      return this.clearSelection();\n    }\n    if (this.selection.size === indices.length && indices.every((i) => this.selection.has(i))) {\n      return; //no change\n    }\n    this.selection.clear();\n    this.selectAll(indices);\n  }\n\n  /**\n   * toggles the selection of the given data index\n   * @param index\n   * @param additional just this element or all\n   * @returns {boolean} whether the index is currently selected\n   */\n  toggleSelection(index: number, additional = false) {\n    if (this.isSelected(index)) {\n      if (additional) {\n        this.deselect(index);\n      } else {\n        this.clearSelection();\n      }\n      return false;\n    }\n    if (additional) {\n      this.select(index);\n    } else {\n      this.setSelection([index]);\n    }\n    return true;\n  }\n\n  /**\n   * deselect the given row\n   * @param index\n   */\n  deselect(index: number) {\n    if (!this.selection.has(index)) {\n      return; //no change\n    }\n    this.selection.delete(index);\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  /**\n   * also select all the given rows\n   * @param indices\n   */\n  deselectAll(indices: IndicesArray) {\n    if (everyIndices(indices, (i) => !this.selection.has(i))) {\n      return; //no change\n    }\n    forEachIndices(indices, (index) => {\n      this.selection.delete(index);\n    });\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\n  }\n\n  /**\n   * returns a promise containing the selected rows\n   * @return {Promise<any[]>}\n   */\n  selectedRows(): Promise<any[]> | any[] {\n    if (this.selection.size === 0) {\n      return [];\n    }\n    return this.view(this.getSelection());\n  }\n\n  /**\n   * returns the currently selected indices\n   * @returns {Array}\n   */\n  getSelection() {\n    return Array.from(this.selection);\n  }\n\n  /**\n   * clears the selection\n   */\n  clearSelection() {\n    if (this.selection.size === 0) {\n      return; //no change\n    }\n    this.selection.clear();\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, [], false);\n  }\n\n  /**\n   * utility to export a ranking to a table with the given separator\n   * @param ranking\n   * @param options\n   * @returns {Promise<string>}\n   */\n  exportTable(ranking: Ranking, options: Partial<IExportOptions> = {}) {\n    return Promise.resolve(this.view(ranking.getOrder())).then((data) => exportRanking(ranking, data, options));\n  }\n}\n\nexport default ADataProvider;\n","import {\n  ActionColumn,\n  AggregateGroupColumn,\n  AnnotateColumn,\n  BooleanColumn,\n  BooleansColumn,\n  BoxPlotColumn,\n  CategoricalColumn,\n  CategoricalMapColumn,\n  CategoricalsColumn,\n  DateColumn,\n  DatesColumn,\n  DatesMapColumn,\n  GroupColumn,\n  HierarchyColumn,\n  ImpositionBoxPlotColumn,\n  ImpositionCompositeColumn,\n  ImpositionCompositesColumn,\n  LinkColumn,\n  LinkMapColumn,\n  LinksColumn,\n  NestedColumn,\n  NumberColumn,\n  NumberMapColumn,\n  NumbersColumn,\n  OrdinalColumn,\n  RankColumn,\n  ReduceColumn,\n  ScriptColumn,\n  SelectionColumn,\n  SetColumn,\n  StackColumn,\n  StringColumn,\n  StringMapColumn,\n  StringsColumn,\n} from './';\n\n/**\n * a map of all known column types\n */\nexport function models() {\n  return {\n    actions: ActionColumn,\n    aggregate: AggregateGroupColumn,\n    annotate: AnnotateColumn,\n    boolean: BooleanColumn,\n    booleans: BooleansColumn,\n    boxplot: BoxPlotColumn,\n    categorical: CategoricalColumn,\n    categoricalMap: CategoricalMapColumn,\n    categoricals: CategoricalsColumn,\n    date: DateColumn,\n    dateMap: DatesMapColumn,\n    dates: DatesColumn,\n    group: GroupColumn,\n    hierarchy: HierarchyColumn,\n    imposition: ImpositionCompositeColumn,\n    impositionBoxPlot: ImpositionBoxPlotColumn,\n    impositions: ImpositionCompositesColumn,\n    reduce: ReduceColumn,\n    nested: NestedColumn,\n    number: NumberColumn,\n    numbers: NumbersColumn,\n    numberMap: NumberMapColumn,\n    ordinal: OrdinalColumn,\n    rank: RankColumn,\n    script: ScriptColumn,\n    selection: SelectionColumn,\n    set: SetColumn,\n    stack: StackColumn,\n    string: StringColumn,\n    stringMap: StringMapColumn,\n    strings: StringsColumn,\n    link: LinkColumn,\n    linkMap: LinkMapColumn,\n    links: LinksColumn,\n  };\n}\n","import { IColumnDesc, Ranking } from '../model';\nimport ADataProvider from './ADataProvider';\nimport type { IDataProviderDump, IDataProviderOptions } from './interfaces';\nimport { isComplexAccessor, rowGetter, rowComplexGetter, rowGuessGetter } from '../internal';\n\nfunction injectAccessor(d: any) {\n  d.accessor = d.accessor || (d.column ? (isComplexAccessor(d.column) ? rowComplexGetter : rowGetter) : rowGuessGetter);\n  d.label = d.label || d.column;\n  return d;\n}\n\n/**\n * common base implementation of a DataProvider with a fixed list of column descriptions\n */\nabstract class ACommonDataProvider extends ADataProvider {\n  private rankingIndex = 0;\n\n  constructor(private columns: IColumnDesc[] = [], options: Partial<IDataProviderOptions> = {}) {\n    super(options);\n    //generate the accessor\n    columns.forEach(injectAccessor);\n  }\n\n  cloneRanking(existing?: Ranking) {\n    const id = this.nextRankingId();\n    const clone = new Ranking(id);\n\n    if (existing) {\n      //copy the ranking of the other one\n      //TODO better cloning\n      existing.children.forEach((child) => {\n        this.push(clone, child.desc);\n      });\n    }\n\n    return clone;\n  }\n\n  /**\n   * adds another column description to this data provider\n   * @param column\n   */\n  pushDesc(column: IColumnDesc) {\n    injectAccessor(column);\n    this.columns.push(column);\n    this.fire(ADataProvider.EVENT_ADD_DESC, column);\n  }\n\n  clearColumns() {\n    this.clearRankings();\n    this.columns.splice(0, this.columns.length);\n    this.fire(ADataProvider.EVENT_CLEAR_DESC);\n  }\n\n  /**\n   * Remove the given column description from the data provider.\n   * Column descriptions that are in use (i.e., has column instances in a ranking) cannot be removed by default.\n   * Skip the check by setting the `ignoreBeingUsed` parameter to `true`.\n   *\n   * @param column Column description\n   * @param ignoreBeingUsed Flag whether to ignore the usage of the column descriptions in rankings\n   */\n  removeDesc(column: IColumnDesc, ignoreBeingUsed = false): boolean {\n    const i = this.columns.indexOf(column);\n    if (i < 0) {\n      return false;\n    }\n    const isUsed = ignoreBeingUsed\n      ? false\n      : this.getRankings().some((d) => d.flatColumns.some((c) => c.desc === column));\n    if (isUsed) {\n      return false;\n    }\n    this.columns.splice(i, 1);\n    this.fire(ADataProvider.EVENT_REMOVE_DESC, column);\n    return true;\n  }\n\n  getColumns(): IColumnDesc[] {\n    return this.columns.slice();\n  }\n\n  findDesc(ref: string) {\n    return this.columns.filter((c) => (c as any).column === ref)[0];\n  }\n\n  /**\n   * identify by the tuple type@columnname\n   * @param desc\n   * @returns {string}\n   */\n  toDescRef(desc: any): any {\n    return typeof desc.column !== 'undefined' ? `${desc.type}@${desc.column}` : this.cleanDesc(Object.assign({}, desc));\n  }\n\n  fromDescRef(descRef: any): any {\n    if (typeof descRef === 'string') {\n      return this.columns.find((d: any) => `${d.type}@${d.column}` === descRef || d.type === descRef);\n    }\n    const existing = this.columns.find(\n      (d) => descRef.column === (d as any).column && descRef.label === d.label && descRef.type === d.type\n    );\n    if (existing) {\n      return existing;\n    }\n    return descRef;\n  }\n\n  restore(dump: IDataProviderDump) {\n    super.restore(dump);\n    this.rankingIndex = 1 + Math.max(...this.getRankings().map((r) => +r.id.substring(4)));\n  }\n\n  nextRankingId() {\n    return `rank${this.rankingIndex++}`;\n  }\n}\n\nexport default ACommonDataProvider;\n","import { createIndexArray, ILookUpArray } from '../internal';\nimport {\n  FIRST_IS_MISSING,\n  FIRST_IS_NAN,\n  ECompareValueType,\n  ICompareValue,\n  Column,\n  UIntTypedArray,\n  Ranking,\n  IDataRow,\n} from '../model';\n\nconst missingUInt8 = FIRST_IS_MISSING > 0 ? 255 : 0;\nconst missingBinary = missingUInt8;\nconst missingUInt16 = FIRST_IS_MISSING > 0 ? 65535 : 0; // max or 0\nconst missingUInt32 = FIRST_IS_MISSING > 0 ? 4294967295 : 0; // max or 0\nconst missingInt8 = FIRST_IS_MISSING > 0 ? 127 : -128; // max or min\nconst missingInt16 = FIRST_IS_MISSING > 0 ? 32767 : -32768; // max or min\nconst missingInt32 = FIRST_IS_MISSING > 0 ? 2147483647 : -2147483648; // max or min\nconst missingFloat = FIRST_IS_NAN > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\nconst missingFloatAsc = FIRST_IS_MISSING > 0 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY;\nconst missingString = FIRST_IS_MISSING > 0 ? '\\uffff' : '\\u0000'; // first or last character\n\nfunction chooseMissingByLength(length: number) {\n  if (length <= 255) {\n    return missingBinary;\n  }\n  if (length <= 65535) {\n    return missingUInt16;\n  }\n  return missingUInt32;\n}\n\nfunction toCompareLookUp(rawLength: number, type: ECompareValueType): ILookUpArray {\n  switch (type) {\n    case ECompareValueType.COUNT:\n      return createIndexArray(rawLength + 1);\n    case ECompareValueType.BINARY:\n    case ECompareValueType.UINT8:\n      return new Uint8Array(rawLength);\n    case ECompareValueType.UINT16:\n      return new Uint16Array(rawLength);\n    case ECompareValueType.UINT32:\n      return new Uint32Array(rawLength);\n    case ECompareValueType.INT8:\n      return new Int8Array(rawLength);\n    case ECompareValueType.INT16:\n      return new Int16Array(rawLength);\n    case ECompareValueType.INT32:\n      return new Int32Array(rawLength);\n    case ECompareValueType.STRING:\n      return [] as string[];\n    case ECompareValueType.FLOAT_ASC:\n    case ECompareValueType.FLOAT:\n      return new Float32Array(rawLength);\n    case ECompareValueType.DOUBLE_ASC:\n    case ECompareValueType.DOUBLE:\n      return new Float64Array(rawLength);\n  }\n}\n\nfunction createSetter(\n  type: ECompareValueType,\n  lookup: ILookUpArray,\n  missingCount: number\n): (index: number, v: ICompareValue) => void {\n  switch (type) {\n    case ECompareValueType.BINARY: // just 0 or 1 -> convert to 0=Number.NEGATIVE_INFINITY 1 2 255=Number.POSITIVE_INFINITY\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingBinary : (v as number) + 1);\n    case ECompareValueType.COUNT: // uint32\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingCount : (v as number) + 1);\n    case ECompareValueType.UINT8: // shift by one to have 0 for -Inf\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt8 : (v as number) + 1);\n    case ECompareValueType.UINT16: // shift by one to have 0 for -Inf\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt16 : (v as number) + 1);\n    case ECompareValueType.UINT32: // shift by one to have 0 for -Inf\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt32 : (v as number) + 1);\n    case ECompareValueType.INT8:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt8 : (v as number));\n    case ECompareValueType.INT16:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt16 : (v as number));\n    case ECompareValueType.INT32:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingInt32 : (v as number));\n    case ECompareValueType.STRING:\n      return (index, v) => (lookup[index] = v == null || v === '' ? missingString : v);\n    case ECompareValueType.FLOAT:\n    case ECompareValueType.DOUBLE:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingFloat : v);\n    case ECompareValueType.FLOAT_ASC:\n    case ECompareValueType.DOUBLE_ASC:\n      return (index, v) => (lookup[index] = v == null || Number.isNaN(v as number) ? missingFloatAsc : v);\n  }\n}\n\nexport class CompareLookup {\n  private readonly criteria: { col: Column; valueCache?(dataIndex: number): any }[] = [];\n  private readonly data: {\n    asc: boolean;\n    v: ECompareValueType;\n    lookup: ILookUpArray;\n    setter: (dataIndex: number, value: ICompareValue) => void;\n  }[] = [];\n\n  constructor(\n    rawLength: number,\n    isSorting: boolean,\n    ranking: Ranking,\n    valueCaches?: (col: Column) => undefined | ((i: number) => any)\n  ) {\n    const missingCount = chooseMissingByLength(rawLength + 1); // + 1 for the value shift to have 0 as start\n\n    for (const c of isSorting ? ranking.getSortCriteria() : ranking.getGroupSortCriteria()) {\n      const v = isSorting ? c.col.toCompareValueType() : c.col.toCompareGroupValueType();\n      const valueCache = valueCaches ? valueCaches(c.col) : undefined;\n      this.criteria.push({ col: c.col, valueCache });\n      if (!Array.isArray(v)) {\n        const lookup = toCompareLookUp(rawLength, v);\n        this.data.push({ asc: c.asc, v, lookup, setter: createSetter(v, lookup, missingCount) });\n        continue;\n      }\n      for (const vi of v) {\n        const lookup = toCompareLookUp(rawLength, vi);\n        this.data.push({ asc: c.asc, v: vi, lookup, setter: createSetter(vi, lookup, missingCount) });\n      }\n    }\n\n    if (isSorting) {\n      return;\n    }\n\n    {\n      const v = ECompareValueType.STRING;\n      const lookup = toCompareLookUp(rawLength, v);\n      this.data.push({ asc: true, v, lookup, setter: createSetter(v, lookup, missingCount) });\n    }\n  }\n\n  get sortOrders() {\n    return this.data.map((d) => ({ asc: d.asc, lookup: d.lookup }));\n  }\n\n  get transferAbles() {\n    // so a typed array\n    return this.data\n      .map((d) => d.lookup)\n      .filter((d): d is UIntTypedArray | Float32Array => !Array.isArray(d))\n      .map((d) => d.buffer);\n  }\n\n  push(row: IDataRow) {\n    let i = 0;\n    for (const c of this.criteria) {\n      const r = c.col.toCompareValue(row, c.valueCache ? c.valueCache(row.i) : undefined);\n      if (!Array.isArray(r)) {\n        this.data[i++].setter(row.i, r);\n        continue;\n      }\n      for (const ri of r) {\n        this.data[i++].setter(row.i, ri);\n      }\n    }\n  }\n\n  pushValues(dataIndex: number, vs: ICompareValue[]) {\n    for (let i = 0; i < vs.length; ++i) {\n      this.data[i].setter(dataIndex, vs[i]);\n    }\n  }\n\n  free() {\n    // free up to save memory\n    this.data.splice(0, this.data.length);\n  }\n}\n","import { IAbortAblePromise, ABORTED, IAbortAblePromiseBase } from 'lineupengine';\nexport { ABORTED } from 'lineupengine';\n\n/**\n * @internal\n */\nexport interface IPoorManIdleDeadline {\n  didTimeout: boolean;\n  timeRemaining(): number;\n}\n\n/**\n * helper since not part of the typings\n * @internal\n */\nexport interface IPoorManIdleCallback {\n  requestIdleCallback(callback: (deadline: IPoorManIdleDeadline) => void, options?: { timeout: number }): number;\n\n  clearIdleCallback(callbackId: number): void;\n}\n\n/**\n * @internal\n */\nexport interface ITask<T> {\n  /**\n   * external task id\n   */\n  id: string;\n  /**\n   * iterator for the incremental task, return null for another round\n   */\n  it: Iterator<T | PromiseLike<T> | null>;\n  /**\n   * function to the resolve the resulting promise\n   */\n  resolve(r: T | PromiseLike<T> | symbol): void;\n  /**\n   * the resulting promise\n   */\n  result: PromiseLike<T | symbol>;\n\n  /**\n   * aborts this task\n   */\n  abort: () => void;\n\n  isAborted: boolean;\n}\n\n/**\n * iterator result for another round\n * @internal\n */\nexport const ANOTHER_ROUND = {\n  value: null,\n  done: false,\n};\n\n/**\n * iterator for just one entry\n * @internal\n */\nexport function oneShotIterator<T>(calc: () => T): Iterator<T> {\n  return {\n    next: () => ({ done: true, value: calc() }),\n  };\n}\n\nfunction thenFactory<T>(wrappee: PromiseLike<T>, abort: () => void, isAborted: () => boolean) {\n  function then<TResult1 = T | symbol, TResult2 = never>(\n    onfulfilled?: ((value: T | symbol) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n    onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null\n  ): IAbortAblePromiseBase<TResult1 | TResult2> {\n    const r = wrappee.then(onfulfilled, onrejected);\n    return {\n      then: thenFactory(r, abort, isAborted) as any,\n      abort,\n      isAborted,\n    };\n  }\n  return then;\n}\n\n/**\n * task scheduler for running tasks in idle callbacks\n * @internal\n */\nexport default class TaskScheduler {\n  private tasks: ITask<any>[] = [];\n  // idle callback id\n  private taskId = -1;\n\n  private runTasks = (deadline: IPoorManIdleDeadline) => {\n    // while more tasks and not timed out\n    while (this.tasks.length > 0 && (deadline.didTimeout || deadline.timeRemaining() > 0)) {\n      const task = this.tasks.shift()!;\n\n      let r = task.it.next();\n      // call next till done or ran out of time\n      while (!r.done && (deadline.didTimeout || deadline.timeRemaining() > 0)) {\n        r = task.it.next();\n      }\n\n      if (r.done) {\n        // resolve async\n        requestAnimationFrame(() => task.resolve(r.value));\n      } else {\n        // reschedule again\n        this.tasks.unshift(task);\n      }\n    }\n\n    this.taskId = -1;\n    this.reSchedule();\n  };\n\n  private reSchedule() {\n    if (this.tasks.length === 0 || this.taskId > -1) {\n      return;\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    const ww = self as any as IPoorManIdleCallback;\n    if (ww.requestIdleCallback) {\n      this.taskId = ww.requestIdleCallback(this.runTasks);\n    } else {\n      this.taskId = setTimeout(this.runTasks, 1) as unknown as number;\n    }\n  }\n\n  /**\n   * pushes a task with multi hops using an iterator\n   * @param id task id\n   * @param it iterator to execute\n   */\n  pushMulti<T>(id: string, it: Iterator<T | PromiseLike<T> | null>, abortAble = true): IAbortAblePromise<T> {\n    // abort task with the same id\n    const abort = () => {\n      const index = this.tasks.findIndex((d) => d.id === id);\n      if (index < 0) {\n        return; // too late or none\n      }\n      const task = this.tasks[index];\n      this.tasks.splice(index, 1);\n\n      task.isAborted = true;\n      task.resolve(ABORTED);\n    };\n\n    {\n      // abort existing\n      const index = this.tasks.findIndex((d) => d.id === id);\n      if (index >= 0) {\n        const task = this.tasks[index];\n        task.abort();\n      }\n    }\n\n    let resolve: (value: T | symbol) => void;\n\n    const p = new Promise<T | symbol>((r) => {\n      // called during constructor\n      resolve = r;\n    });\n\n    const task: ITask<T> = {\n      id,\n      it,\n      result: p,\n      abort,\n      isAborted: false,\n      resolve: resolve!,\n    };\n    const isAborted = () => task.isAborted;\n\n    this.tasks.push(task);\n\n    this.reSchedule();\n\n    const abortOrDummy = abortAble ? abort : () => undefined;\n    const isAbortedOrDummy = abortAble ? isAborted : () => false;\n\n    return {\n      then: thenFactory(p, abortOrDummy, isAbortedOrDummy),\n      abort: abortOrDummy,\n      isAborted: isAbortedOrDummy,\n    };\n  }\n\n  /**\n   * pushes a simple task\n   * @param id task id\n   * @param calc task function\n   */\n  push<T>(id: string, calc: () => T | PromiseLike<T>): IAbortAblePromise<T> {\n    return this.pushMulti(id, oneShotIterator(calc));\n  }\n\n  /**\n   * abort a task with the given id\n   * @param id task id\n   */\n  abort(id: string) {\n    const index = this.tasks.findIndex((d) => d.id === id);\n    if (index < 0) {\n      return false; // too late or none\n    }\n    const task = this.tasks[index];\n    task.abort();\n    return true;\n  }\n\n  abortAll(filter: (task: ITask<any>) => boolean) {\n    const abort = this.tasks.filter(filter);\n    if (abort.length === 0) {\n      return;\n    }\n    this.tasks = this.tasks.filter((d) => !filter(d));\n    for (const task of abort) {\n      task.resolve(ABORTED);\n      task.abort();\n    }\n  }\n\n  clear() {\n    if (this.taskId === -1) {\n      return;\n    }\n    // eslint-disable-next-line no-restricted-globals\n    const ww = self as any as IPoorManIdleCallback;\n    if (ww.requestIdleCallback) {\n      ww.clearIdleCallback(this.taskId);\n    } else {\n      clearTimeout(this.taskId);\n    }\n    this.taskId = -1;\n\n    this.tasks.splice(0, this.tasks.length).forEach((d) => {\n      d.resolve(ABORTED);\n      d.abort();\n    });\n  }\n}\n","import { abortAbleAll, IAbortAblePromise } from 'lineupengine';\nimport { ANOTHER_ROUND } from '../internal/scheduler';\nimport {\n  IForEachAble,\n  lazySeq,\n  boxplotBuilder,\n  categoricalStatsBuilder,\n  categoricalValueCacheBuilder,\n  dateStatsBuilder,\n  dateValueCacheBuilder,\n  IAdvancedBoxPlotData,\n  ICategoricalStatistics,\n  IDateStatistics,\n  IStatistics,\n  numberStatsBuilder,\n  dateValueCache2Value,\n  categoricalValueCache2Value,\n  joinIndexArrays,\n  IBuilder,\n  ISequence,\n} from '../internal';\nimport {\n  CategoricalColumn,\n  Column,\n  ICompareValue,\n  DateColumn,\n  ICategoricalLikeColumn,\n  IDataRow,\n  IDateColumn,\n  IGroup,\n  ImpositionCompositeColumn,\n  IndicesArray,\n  INumberColumn,\n  NumberColumn,\n  OrdinalColumn,\n  Ranking,\n  UIntTypedArray,\n  ICategory,\n  isMapAbleColumn,\n} from '../model';\nimport type { IRenderTask, IRenderTasks } from '../renderer';\nimport type { CompareLookup } from './sort';\n\n/**\n * a render task that is already resolved\n */\nexport class TaskNow<T> implements IRenderTask<T> {\n  constructor(public readonly v: T) {}\n\n  then<U = void>(onfullfilled: (value: T) => U) {\n    return onfullfilled(this.v);\n  }\n}\n\n/**\n * factory function for\n */\nexport function taskNow<T>(v: T) {\n  return new TaskNow(v);\n}\n\n/**\n * a render task based on an abortable promise\n */\nexport class TaskLater<T> implements IRenderTask<T> {\n  constructor(public readonly v: IAbortAblePromise<T>) {}\n\n  then<U = void>(onfullfilled: (value: T | symbol) => U): IAbortAblePromise<U> {\n    return this.v.then(onfullfilled);\n  }\n}\n\nexport function taskLater<T>(v: IAbortAblePromise<T>) {\n  return new TaskLater(v);\n}\n\n/**\n * similar to Promise.all\n */\nexport function tasksAll<T>(tasks: IRenderTask<T>[]): IRenderTask<T[]> {\n  if (tasks.every((t) => t instanceof TaskNow)) {\n    return taskNow(tasks.map((d) => (d as TaskNow<T>).v));\n  }\n  return taskLater(abortAbleAll((tasks as (TaskNow<T> | TaskLater<T>)[]).map((d) => d.v)));\n}\n\nexport interface IRenderTaskExecutor extends IRenderTasks {\n  setData(data: IDataRow[]): void;\n\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group'): void;\n  dirtyRanking(ranking: Ranking, type: 'data' | 'summary' | 'group'): void;\n\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray): IRenderTask<ICompareValue[]>;\n\n  preCompute(ranking: Ranking, groups: { rows: IndicesArray; group: IGroup }[], maxDataIndex: number): void;\n  preComputeCol(col: Column): void;\n  preComputeData(ranking: Ranking): void;\n  copyData2Summary(ranking: Ranking): void;\n  copyCache(col: Column, from: Column): void;\n\n  sort(\n    ranking: Ranking,\n    group: IGroup,\n    indices: IndicesArray,\n    singleCall: boolean,\n    maxDataIndex: number,\n    lookups?: CompareLookup\n  ): Promise<IndicesArray>;\n\n  terminate(): void;\n\n  valueCache(col: Column): undefined | ((dataIndex: number) => any);\n}\n\nexport class MultiIndices {\n  private _joined: IndicesArray | null = null;\n\n  constructor(public readonly indices: IndicesArray[], private readonly maxDataIndex: number) {}\n\n  get joined() {\n    if (this.indices.length === 1) {\n      return this.indices[0];\n    }\n    if (this.indices.length === 0) {\n      return new Uint8Array(0);\n    }\n    if (this._joined) {\n      return this._joined;\n    }\n    return (this._joined = joinIndexArrays(this.indices, this.maxDataIndex));\n  }\n}\n\n/**\n * number of data points to build per iteration / chunk\n */\nconst CHUNK_SIZE = 100;\n\nexport class ARenderTasks {\n  protected readonly valueCacheData = new Map<string, Float32Array | UIntTypedArray | Int32Array | Float64Array>();\n\n  protected readonly byIndex = (i: number) => this.data[i];\n\n  constructor(protected data: IDataRow[] = []) {}\n\n  protected byOrder(indices: IndicesArray): ISequence<IDataRow> {\n    return lazySeq(indices).map(this.byIndex);\n  }\n\n  protected byOrderAcc<T>(indices: IndicesArray, acc: (row: IDataRow) => T) {\n    return lazySeq(indices).map((i) => acc(this.data[i]));\n  }\n\n  /**\n   * builder factory to create an iterator that can be used to schedule\n   * @param builder the builder to use\n   * @param order the order to iterate over\n   * @param acc the accessor to get the value out of the data\n   * @param build optional build mapper\n   */\n  private builder<T, BR, B extends { push: (v: T) => void; build: () => BR }, R = BR>(\n    builder: B,\n    order: IndicesArray | null | MultiIndices,\n    acc: (dataIndex: number) => T,\n    build?: (r: BR) => R\n  ): Iterator<R | null> {\n    let i = 0;\n\n    // no indices given over the whole data\n    const nextData = (currentChunkSize: number = CHUNK_SIZE) => {\n      let chunkCounter = currentChunkSize;\n      const data = this.data;\n      for (; i < data.length && chunkCounter > 0; ++i, --chunkCounter) {\n        builder.push(acc(i));\n      }\n      if (i < data.length) {\n        // need another round\n        return ANOTHER_ROUND;\n      }\n      // done\n      return {\n        done: true,\n        value: build ? build(builder.build()) : (builder.build() as unknown as R),\n      };\n    };\n\n    let o = 0;\n    const orders = order instanceof MultiIndices ? order.indices : [order];\n\n    const nextOrder = (currentChunkSize: number = CHUNK_SIZE) => {\n      let chunkCounter = currentChunkSize;\n\n      while (o < orders.length) {\n        const actOrder = orders[o]!;\n        for (; i < actOrder.length && chunkCounter > 0; ++i, --chunkCounter) {\n          builder.push(acc(actOrder[i]));\n        }\n        if (i < actOrder.length) {\n          // need another round\n          return ANOTHER_ROUND;\n        }\n        // done with this order\n        o++;\n        i = 0;\n      }\n      return {\n        done: true,\n        value: build ? build(builder.build()) : (builder.build() as unknown as R),\n      };\n    };\n    return { next: order == null ? nextData : nextOrder };\n  }\n\n  private builderForEach<T, BR, B extends { pushAll: (v: IForEachAble<T>) => void; build: () => BR }, R = BR>(\n    builder: B,\n    order: IndicesArray | null | MultiIndices,\n    acc: (dataIndex: number) => IForEachAble<T>,\n    build?: (r: BR) => R\n  ): Iterator<R | null> {\n    return this.builder(\n      {\n        push: builder.pushAll,\n        build: builder.build,\n      },\n      order,\n      acc,\n      build\n    );\n  }\n\n  protected boxplotBuilder<R = IAdvancedBoxPlotData>(\n    order: IndicesArray | null | MultiIndices,\n    col: INumberColumn,\n    raw?: boolean,\n    build?: (stat: IAdvancedBoxPlotData) => R\n  ) {\n    const b = boxplotBuilder();\n    return this.numberStatsBuilder(b, order, col, raw, build);\n  }\n\n  protected resolveDomain(col: INumberColumn, raw: boolean): [number, number] {\n    const domain = raw && isMapAbleColumn(col) ? col.getMapping().domain : [0, 1];\n    return [domain[0], domain[domain.length - 1]];\n  }\n\n  protected statsBuilder<R = IStatistics>(\n    order: IndicesArray | null | MultiIndices,\n    col: INumberColumn,\n    numberOfBins: number,\n    raw?: boolean,\n    build?: (stat: IStatistics) => R\n  ) {\n    const b = numberStatsBuilder(this.resolveDomain(col, raw ?? false), numberOfBins);\n    return this.numberStatsBuilder(b, order, col, raw, build);\n  }\n\n  private numberStatsBuilder<R, B extends IBuilder<number, BR>, BR>(\n    b: B,\n    order: IndicesArray | null | MultiIndices,\n    col: INumberColumn,\n    raw?: boolean,\n    build?: (stat: BR) => R\n  ) {\n    if (col instanceof NumberColumn || col instanceof OrdinalColumn || col instanceof ImpositionCompositeColumn) {\n      const key = raw ? `${col.id}:r` : col.id;\n      const dacc: (i: number) => number = raw\n        ? (i) => col.getRawNumber(this.data[i])\n        : (i) => col.getNumber(this.data[i]);\n\n      if (order == null && !this.valueCacheData.has(key)) {\n        // build and valueCache\n        const vs = new Float32Array(this.data.length);\n        let i = 0;\n        return this.builder(\n          {\n            push: (v) => {\n              b.push(v);\n              vs[i++] = v;\n            },\n            build: () => {\n              this.setValueCacheData(key, vs);\n              return b.build();\n            },\n          },\n          null,\n          dacc,\n          build\n        );\n      }\n\n      const cache = this.valueCacheData.get(key);\n      const acc: (i: number) => number = cache ? (i) => cache[i] : dacc;\n      return this.builder(b, order, acc, build);\n    }\n    const acc: (i: number) => IForEachAble<number> = raw\n      ? (i) => col.iterRawNumber(this.data[i])\n      : (i) => col.iterNumber(this.data[i]);\n    return this.builderForEach(b, order, acc, build);\n  }\n\n  protected dateStatsBuilder<R = IDateStatistics>(\n    order: IndicesArray | null | MultiIndices,\n    col: IDateColumn,\n    template?: IDateStatistics,\n    build?: (stat: IDateStatistics) => R\n  ) {\n    const b = dateStatsBuilder(template);\n    if (col instanceof DateColumn) {\n      if (order == null) {\n        // build and valueCache\n        const vs = dateValueCacheBuilder(this.data.length);\n        return this.builder(\n          {\n            push: (v) => {\n              b.push(v);\n              vs.push(v);\n            },\n            build: () => {\n              this.setValueCacheData(col.id, vs.cache);\n              return b.build();\n            },\n          },\n          null,\n          (i: number) => col.getDate(this.data[i]),\n          build\n        );\n      }\n      const cache = this.valueCacheData.get(col.id);\n      const acc: (i: number) => Date | null = cache\n        ? (i) => dateValueCache2Value(cache[i])\n        : (i) => col.getDate(this.data[i]);\n      return this.builder(b, order, acc, build);\n    }\n    return this.builderForEach(b, order, (i: number) => col.iterDate(this.data[i]), build);\n  }\n\n  protected categoricalStatsBuilder<R = ICategoricalStatistics>(\n    order: IndicesArray | null | MultiIndices,\n    col: ICategoricalLikeColumn,\n    build?: (stat: ICategoricalStatistics) => R\n  ) {\n    const b = categoricalStatsBuilder(col.categories);\n    if (col instanceof CategoricalColumn || col instanceof OrdinalColumn) {\n      if (order == null) {\n        // build and valueCache\n        const vs = categoricalValueCacheBuilder(this.data.length, col.categories);\n        return this.builder(\n          {\n            push: (v) => {\n              b.push(v);\n              vs.push(v);\n            },\n            build: () => {\n              this.setValueCacheData(col.id, vs.cache);\n              return b.build();\n            },\n          },\n          null,\n          (i: number) => col.getCategory(this.data[i]),\n          build\n        );\n      }\n      const cache = this.valueCacheData.get(col.id);\n      const acc: (i: number) => ICategory | null = cache\n        ? (i) => categoricalValueCache2Value(cache[i], col.categories)\n        : (i) => col.getCategory(this.data[i]);\n      return this.builder(b, order, acc, build);\n    }\n    return this.builderForEach(b, order, (i: number) => col.iterCategory(this.data[i]), build);\n  }\n\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group') {\n    if (type !== 'data') {\n      return;\n    }\n    this.valueCacheData.delete(col.id);\n    this.valueCacheData.delete(`${col.id}:r`);\n  }\n\n  protected setValueCacheData(key: string, value: Float32Array | UIntTypedArray | Int32Array | Float64Array | null) {\n    if (value == null) {\n      this.valueCacheData.delete(key);\n    } else {\n      this.valueCacheData.set(key, value);\n    }\n  }\n\n  valueCache(col: Column) {\n    const v = this.valueCacheData.get(col.id);\n    if (!v) {\n      return undefined;\n    }\n    if (col instanceof DateColumn) {\n      return (dataIndex: number) => dateValueCache2Value(v[dataIndex]);\n    }\n    if (col instanceof CategoricalColumn || col instanceof OrdinalColumn) {\n      return (dataIndex: number) => categoricalValueCache2Value(v[dataIndex], col.categories);\n    }\n    return (dataIndex: number) => v[dataIndex];\n  }\n}\n","import type {\n  IDataRow,\n  Ranking,\n  IndicesArray,\n  IGroup,\n  IOrderedGroup,\n  INumberColumn,\n  IDateColumn,\n  ICategoricalLikeColumn,\n  ICompareValue,\n} from '../model';\nimport type Column from '../model';\nimport { ARenderTasks, IRenderTaskExecutor, taskNow } from './tasks';\nimport { ISequence, toIndexArray, sortComplex, getNumberOfBins } from '../internal';\nimport type { CompareLookup } from './sort';\nimport type { IRenderTask } from '../renderer';\n\n/**\n * @internal\n */\nexport function sortDirect(indices: IndicesArray, maxDataIndex: number, lookups?: CompareLookup) {\n  const order = toIndexArray(indices, maxDataIndex);\n  if (lookups) {\n    sortComplex(order, lookups.sortOrders);\n  }\n  return order;\n}\n\n/**\n * @internal\n */\nexport class DirectRenderTasks extends ARenderTasks implements IRenderTaskExecutor {\n  protected readonly cache = new Map<string, any>();\n\n  setData(data: IDataRow[]) {\n    this.data = data;\n    this.cache.clear();\n    this.valueCacheData.clear();\n  }\n\n  dirtyColumn(col: Column, type: 'data' | 'summary' | 'group') {\n    super.dirtyColumn(col, type);\n\n    if (type === 'group') {\n      return; // not cached\n    }\n    this.cache.delete(`${col.id}:summary`);\n    this.cache.delete(`${col.id}:summary:raw`);\n    this.cache.delete(`${col.id}:summary:b`);\n    this.cache.delete(`${col.id}:summary:braw`);\n\n    if (type === 'summary') {\n      return;\n    }\n    this.cache.delete(`${col.id}:data`);\n    this.cache.delete(`${col.id}:data:raw`);\n    this.cache.delete(`${col.id}:data:b`);\n    this.cache.delete(`${col.id}:data:braw`);\n  }\n\n  dirtyRanking(ranking: Ranking, type: 'data' | 'summary' | 'group') {\n    for (const col of ranking.flatColumns) {\n      this.dirtyColumn(col, type);\n    }\n  }\n\n  preCompute() {\n    // dummy\n  }\n\n  preComputeData() {\n    // dummy\n  }\n\n  preComputeCol() {\n    // dummy\n  }\n\n  copyData2Summary() {\n    // dummy\n  }\n\n  copyCache(col: Column, from: Column) {\n    const fromPrefix = `${from.id}:`;\n\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      if (!key.startsWith(fromPrefix)) {\n        continue;\n      }\n      const cacheKey = `${col.id}:${key.slice(fromPrefix.length)}`;\n      this.cache.set(cacheKey, this.cache.get(key)!);\n    }\n  }\n\n  sort(\n    _ranking: Ranking,\n    _group: IGroup,\n    indices: IndicesArray,\n    _singleCall: boolean,\n    maxDataIndex: number,\n    lookups?: CompareLookup\n  ) {\n    return Promise.resolve(sortDirect(indices, maxDataIndex, lookups));\n  }\n\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray): IRenderTask<ICompareValue[]> {\n    const rg = ranking.getGroupSortCriteria();\n    if (rg.length === 0) {\n      return taskNow([group.name.toLowerCase()]);\n    }\n    const o = this.byOrder(rows);\n    const vs: ICompareValue[] = [];\n    for (const s of rg) {\n      const r = s.col.toCompareGroupValue(o, group);\n      if (Array.isArray(r)) {\n        vs.push(...r);\n      } else {\n        vs.push(r);\n      }\n    }\n    vs.push(group.name.toLowerCase());\n    return taskNow(vs);\n  }\n\n  groupRows<T>(\n    _col: Column,\n    group: IOrderedGroup,\n    _key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T> {\n    return taskNow(compute(this.byOrder(group.order)));\n  }\n\n  groupExampleRows<T>(\n    _col: Column,\n    group: IOrderedGroup,\n    _key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T> {\n    return taskNow(compute(this.byOrder(group.order.slice(0, 5))));\n  }\n\n  groupBoxPlotStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    const { summary, data } = this.summaryBoxPlotStatsD(col, raw);\n    return taskNow({\n      group: this.boxplotBuilder(group.order, col, raw).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  groupNumberStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    const { summary, data } = this.summaryNumberStatsD(col, raw);\n    return taskNow({\n      group: this.statsBuilder(group.order, col, summary.hist.length, raw).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  groupCategoricalStats(col: Column & ICategoricalLikeColumn, group: IOrderedGroup) {\n    const { summary, data } = this.summaryCategoricalStatsD(col);\n    return taskNow({\n      group: this.categoricalStatsBuilder(group.order, col).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  groupDateStats(col: Column & IDateColumn, group: IOrderedGroup) {\n    const { summary, data } = this.summaryDateStatsD(col);\n    return taskNow({\n      group: this.dateStatsBuilder(group.order, col, summary).next(Number.POSITIVE_INFINITY as any).value!,\n      summary,\n      data,\n    });\n  }\n\n  summaryBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\n    return taskNow(this.summaryBoxPlotStatsD(col, raw));\n  }\n\n  summaryNumberStats(col: Column & INumberColumn, raw?: boolean) {\n    return taskNow(this.summaryNumberStatsD(col, raw));\n  }\n\n  summaryCategoricalStats(col: Column & ICategoricalLikeColumn) {\n    return taskNow(this.summaryCategoricalStatsD(col));\n  }\n\n  summaryDateStats(col: Column & IDateColumn) {\n    return taskNow(this.summaryDateStatsD(col));\n  }\n\n  private summaryNumberStatsD(col: Column & INumberColumn, raw?: boolean) {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataNumberStats(col, raw);\n        return {\n          summary: this.statsBuilder(order, col, data.hist.length, raw).next(Number.POSITIVE_INFINITY as any).value!,\n          data,\n        };\n      },\n      raw ? ':raw' : '',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private summaryBoxPlotStatsD(col: Column & INumberColumn, raw?: boolean) {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataBoxPlotStats(col, raw);\n        return { summary: this.boxplotBuilder(order, col, raw).next(Number.POSITIVE_INFINITY as any).value!, data };\n      },\n      raw ? ':braw' : ':b',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private summaryCategoricalStatsD(col: Column & ICategoricalLikeColumn) {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataCategoricalStats(col);\n        return {\n          summary: this.categoricalStatsBuilder(order, col).next(Number.POSITIVE_INFINITY as any).value!,\n          data,\n        };\n      },\n      '',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private summaryDateStatsD(col: Column & IDateColumn) {\n    const ranking = col.findMyRanker();\n    return this.cached(\n      'summary',\n      col,\n      () => {\n        const order = ranking ? ranking.getOrder() : [];\n        const data = this.dataDateStats(col);\n        return {\n          summary: this.dateStatsBuilder(order, col, data).next(Number.POSITIVE_INFINITY as any).value!,\n          data,\n        };\n      },\n      '',\n      ranking && ranking.getOrderLength() === 0\n    );\n  }\n\n  private cached<T>(prefix: string, col: Column, creator: () => T, suffix = '', dontCache = false): T {\n    const key = `${col.id}:${prefix}${suffix}`;\n    if (this.cache.has(key)) {\n      return this.cache.get(key)!;\n    }\n    const s = creator();\n    if (!dontCache) {\n      this.cache.set(key, s);\n    }\n    return s;\n  }\n\n  dataBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\n    return this.cached(\n      'data',\n      col,\n      () => this.boxplotBuilder(null, col, raw).next(Number.POSITIVE_INFINITY as any).value!,\n      raw ? ':braw' : ':b'\n    );\n  }\n\n  dataNumberStats(col: Column & INumberColumn, raw?: boolean) {\n    return this.cached(\n      'data',\n      col,\n      () =>\n        this.statsBuilder(null, col, getNumberOfBins(this.data.length), raw).next(Number.POSITIVE_INFINITY as any)\n          .value!,\n      raw ? ':raw' : ''\n    );\n  }\n\n  dataCategoricalStats(col: Column & ICategoricalLikeColumn) {\n    return this.cached(\n      'data',\n\n      col,\n\n      () => this.categoricalStatsBuilder(null, col).next(Number.POSITIVE_INFINITY as any).value!\n    );\n  }\n\n  dataDateStats(col: Column & IDateColumn) {\n    return this.cached(\n      'data',\n      col,\n      () => this.dateStatsBuilder(null, col).next(Number.POSITIVE_INFINITY as any).value!\n    );\n  }\n\n  terminate() {\n    this.cache.clear();\n  }\n}\n","import Column from './Column';\nimport type { IDataRow, IColumnDesc } from './interfaces';\n\nexport interface IArrayDesc {\n  dataLength?: number;\n  labels?: string[];\n}\n\nexport interface IKeyValue<T> {\n  key: string;\n  value: T;\n}\n\nexport interface IMapColumn<T> extends Column {\n  getMap(row: IDataRow): IKeyValue<T>[];\n\n  getMapLabel(row: IDataRow): IKeyValue<string>[];\n}\n\nexport function isMapColumn(col: Column): col is IMapColumn<any>;\nexport function isMapColumn(col: IColumnDesc): boolean;\nexport function isMapColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column &&\n      typeof (col as IMapColumn<any>).getMap === 'function' &&\n      typeof (col as IMapColumn<any>).getMapLabel === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.endsWith('Map'))\n  );\n}\n\nexport interface IArrayColumn<T> extends IMapColumn<T> {\n  readonly labels: string[];\n  readonly dataLength: number | null;\n\n  getLabels(row: IDataRow): string[];\n\n  getValues(row: IDataRow): T[];\n}\n\nexport function isArrayColumn(col: Column): col is IArrayColumn<any>;\nexport function isArrayColumn(col: IColumnDesc): col is IArrayDesc & IColumnDesc;\nexport function isArrayColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column &&\n      typeof (col as IArrayColumn<any>).getLabels === 'function' &&\n      typeof (col as IArrayColumn<any>).getValues === 'function' &&\n      isMapColumn(col)) ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.endsWith('s') && (col as IColumnDesc).type !== 'actions')\n  );\n}\n","import type { IForEachAble } from '../internal';\nimport Column from './Column';\nimport { IArrayColumn, isArrayColumn } from './IArrayColumn';\nimport type { IValueColumnDesc, IColumnDesc, IDataRow, ITypedDump } from './interfaces';\n\nexport interface ICategoricalDesc {\n  categories: (string | Partial<ICategory>)[];\n}\n\nexport declare type ICategoricalColumnDesc = IValueColumnDesc<string> & ICategoricalDesc;\n\nexport interface ICategoricalColorMappingFunction {\n  apply(v: ICategory): string;\n\n  toJSON(): ITypedDump | null;\n\n  clone(): ICategoricalColorMappingFunction;\n\n  eq(other: ICategoricalColorMappingFunction): boolean;\n}\n\nexport interface ICategoricalColorMappingFunctionConstructor {\n  new (dump: ITypedDump): ICategoricalColorMappingFunction;\n}\n\nexport interface ICategoricalLikeColumn extends Column {\n  readonly categories: ICategory[];\n\n  getColorMapping(): ICategoricalColorMappingFunction;\n  setColorMapping(mapping: ICategoricalColorMappingFunction): void;\n\n  iterCategory(row: IDataRow): IForEachAble<ICategory | null>;\n\n  getCategories(row: IDataRow): (ICategory | null)[];\n}\n\nexport function isCategoricalLikeColumn(col: Column): col is ICategoricalLikeColumn {\n  return (\n    typeof (col as ICategoricalLikeColumn).categories !== 'undefined' &&\n    typeof (col as ICategoricalLikeColumn).iterCategory === 'function'\n  );\n}\n\nexport interface ISetColumn extends IArrayColumn<boolean>, ICategoricalLikeColumn {\n  getSet(row: IDataRow): Set<ICategory>;\n}\n\nexport function isSetColumn(col: Column): col is ISetColumn {\n  return isCategoricalLikeColumn(col) && typeof (col as ISetColumn).getSet === 'function';\n}\n\nexport interface ICategoricalColumn extends ISetColumn {\n  getCategory(row: IDataRow): ICategory | null;\n}\n\nexport interface ICategory {\n  readonly name: string;\n\n  /**\n   * optional label of this category (the one to render)\n   */\n  readonly label: string;\n  /**\n   * category color\n   * @default next in d3 color 10 range\n   */\n  readonly color: string;\n\n  value: number;\n}\n/**\n * checks whether the given column or description is a categorical column, i.e. the value is a list of categories\n * @param col\n * @returns {boolean}\n */\nexport function isCategoricalColumn(col: Column): col is ICategoricalColumn;\nexport function isCategoricalColumn(col: IColumnDesc): col is ICategoricalColumnDesc & IColumnDesc;\nexport function isCategoricalColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as ICategoricalColumn).getCategory === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.match(/(categorical|ordinal|hierarchy)/) != null)\n  );\n}\n\nexport declare type ICategoricalsColumn = ICategoricalLikeColumn & IArrayColumn<string | null>;\n\nexport function isCategoricalsColumn(col: Column): col is ICategoricalsColumn {\n  return isCategoricalLikeColumn(col) && isArrayColumn(col) && !isSetColumn(col);\n}\n\nexport interface ICategoricalFilter {\n  filter: string[] | string | RegExp;\n  filterMissing: boolean;\n}\n\nexport interface ISetCategoricalFilter extends ICategoricalFilter {\n  mode?: 'every' | 'some';\n}\n\nexport function isCategory(v: any): v is ICategory {\n  return (\n    typeof v.name === 'string' &&\n    typeof v.label === 'string' &&\n    typeof v.color === 'string' &&\n    typeof v.value === 'number'\n  );\n}\n","import type { IForEachAble } from '../internal';\nimport Column from './Column';\nimport type { IColumnDesc, IDataRow } from './interfaces';\nimport type { INumberFilter } from './INumberColumn';\nimport type { IArrayColumn } from './IArrayColumn';\n\nexport interface IDateColumn extends Column {\n  getFormatter(): (v: Date | null) => string;\n\n  getDate(row: IDataRow): Date | null;\n\n  iterDate(row: IDataRow): IForEachAble<Date | null>;\n\n  getFilter(): IDateFilter;\n  setFilter(value: IDateFilter | null): void;\n}\n\nexport interface IDatesColumn extends IDateColumn, IArrayColumn<Date | null> {\n  getDates(row: IDataRow): (Date | null)[];\n}\n\nexport interface IDateDesc {\n  /**\n   * d3 formatting option\n   * @default %x\n   */\n  dateFormat?: string;\n\n  /**\n   * d3 formation option\n   * @dfeault dateFormat\n   */\n  dateParse?: string;\n}\n\n/**\n * checks whether the given column or description is a date column, i.e. the value is a date\n * @param col\n * @returns {boolean}\n */\nexport function isDateColumn(col: Column): col is IDateColumn;\nexport function isDateColumn(col: IColumnDesc): col is IDateDesc & IColumnDesc;\nexport function isDateColumn(col: Column | IColumnDesc) {\n  return (\n    (col instanceof Column && typeof (col as IDateColumn).getDate === 'function') ||\n    (!(col instanceof Column) && (col as IColumnDesc).type.startsWith('date'))\n  );\n}\n\nexport function isDatesColumn(col: Column): col is IDatesColumn {\n  return typeof (col as IDatesColumn).getDates === 'function';\n}\n\nexport declare type IDateFilter = INumberFilter;\n\nexport declare type IDateGranularity =\n  | 'century'\n  | 'decade'\n  | 'year'\n  | 'month'\n  | 'week'\n  | 'day_of_week'\n  | 'day_of_month'\n  | 'day_of_year'\n  | 'hour'\n  | 'minute'\n  | 'second';\n\nexport interface IDateGrouper {\n  /**\n   * granularity level for the grouping\n   */\n  granularity: IDateGranularity;\n  /**\n   * whether circular occurrences should be in the same bin\n   * e.g. granularity = month\n   * circular: 01.2018 == 01.2017\n   * not circular: 01.2018 != 01.2017\n   */\n  circular: boolean;\n}\n","import { abortAble } from 'lineupengine';\nimport {\n  getNumberOfBins,\n  IAdvancedBoxPlotData,\n  ICategoricalStatistics,\n  IDateStatistics,\n  ISequence,\n  ISortMessageResponse,\n  IStatistics,\n  lazySeq,\n  toIndexArray,\n  WorkerTaskScheduler,\n  createWorkerBlob,\n} from '../internal';\nimport TaskScheduler, { ABORTED, oneShotIterator } from '../internal/scheduler';\nimport Column, {\n  ICategoricalLikeColumn,\n  ICompareValue,\n  IDataRow,\n  IDateColumn,\n  IGroup,\n  IndicesArray,\n  INumberColumn,\n  IOrderedGroup,\n  isCategoricalLikeColumn,\n  isDateColumn,\n  isNumberColumn,\n  Ranking,\n  UIntTypedArray,\n} from '../model';\nimport type { IRenderTask } from '../renderer';\nimport { sortDirect } from './DirectRenderTasks';\nimport type { CompareLookup } from './sort';\nimport { ARenderTasks, IRenderTaskExecutor, MultiIndices, taskLater, TaskLater, taskNow, TaskNow } from './tasks';\n\nexport class ScheduleRenderTasks extends ARenderTasks implements IRenderTaskExecutor {\n  private readonly cache = new Map<string, IRenderTask<any>>();\n  private readonly tasks = new TaskScheduler();\n  private readonly workers = new WorkerTaskScheduler(createWorkerBlob());\n\n  setData(data: IDataRow[]) {\n    this.data = data;\n    this.cache.clear();\n    this.tasks.clear();\n    this.valueCacheData.clear();\n    this.workers.deleteRefs();\n  }\n\n  dirtyColumn(col: Column, type: 'data' | 'group' | 'summary') {\n    super.dirtyColumn(col, type);\n    // order designed such that first groups, then summaries, then data is deleted\n\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      // data = all\n      // summary = summary + group\n      // group = group only\n      if (\n        (type === 'data' && key.startsWith(`${col.id}:`)) ||\n        (type === 'summary' && key.startsWith(`${col.id}:b:summary:`)) ||\n        key.startsWith(`${col.id}:a:group`)\n      ) {\n        this.cache.delete(key);\n        this.tasks.abort(key);\n      }\n    }\n\n    if (type !== 'data') {\n      return;\n    }\n\n    this.valueCacheData.delete(col.id);\n    this.workers.deleteRef(col.id);\n  }\n\n  dirtyRanking(ranking: Ranking, type: 'data' | 'group' | 'summary') {\n    const cols = ranking.flatColumns;\n\n    let checker: ((key: string) => boolean)[];\n    switch (type) {\n      case 'group':\n        checker = cols.map((col) => (key: string) => key.startsWith(`${col.id}:a:group`));\n        break;\n      case 'summary':\n        checker = cols.map(\n          (col) => (key: string) => key.startsWith(`${col.id}:b:summary`) || key.startsWith(`${col.id}:a:group`)\n        );\n        break;\n      case 'data':\n      default:\n        checker = cols.map((col) => (key: string) => key.startsWith(`${col.id}:`));\n        break;\n    }\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      if (checker.some((f) => f(key))) {\n        this.cache.delete(key);\n        this.tasks.abort(key);\n      }\n    }\n    // group compare tasks\n    this.tasks.abortAll((t) => t.id.startsWith(`r${ranking.id}:`));\n\n    // delete remote caches\n    this.workers.deleteRef(ranking.id, true);\n\n    if (type !== 'data') {\n      return;\n    }\n\n    for (const col of cols) {\n      super.dirtyColumn(col, type);\n      this.workers.deleteRef(col.id);\n    }\n  }\n\n  preCompute(ranking: Ranking, groups: { rows: IndicesArray; group: IGroup }[], maxDataIndex: number) {\n    if (groups.length === 0) {\n      return;\n    }\n    const cols = ranking.flatColumns;\n    if (groups.length === 1) {\n      const { group, rows } = groups[0];\n      const multi = new MultiIndices([rows], maxDataIndex);\n      for (const col of cols) {\n        if (isCategoricalLikeColumn(col)) {\n          this.summaryCategoricalStats(col, multi);\n        } else if (isNumberColumn(col)) {\n          this.summaryNumberStats(col, false, multi);\n          this.summaryNumberStats(col, true, multi);\n        } else if (isDateColumn(col)) {\n          this.summaryDateStats(col, multi);\n        } else {\n          continue;\n        }\n        // copy from summary to group and create proper structure\n        this.chainCopy(\n          `${col.id}:a:group:${group.name}`,\n          this.cache.get(`${col.id}:b:summary`)!,\n          (v: { summary: any; data: any }) => ({ group: v.summary, summary: v.summary, data: v.data })\n        );\n        if (isNumberColumn(col)) {\n          this.chainCopy(\n            `${col.id}:a:group:${group.name}:raw`,\n            this.cache.get(`${col.id}:b:summary:raw`)!,\n            (v: { summary: any; data: any }) => ({ group: v.summary, summary: v.summary, data: v.data })\n          );\n        }\n      }\n      return;\n    }\n\n    const orderedGroups = groups.map(({ rows, group }) => Object.assign({ order: rows }, group));\n    const full = new MultiIndices(\n      groups.map((d) => d.rows),\n      maxDataIndex\n    );\n    for (const col of cols) {\n      if (isCategoricalLikeColumn(col)) {\n        this.summaryCategoricalStats(col, full);\n        for (const g of orderedGroups) {\n          this.groupCategoricalStats(col, g);\n        }\n      } else if (isDateColumn(col)) {\n        this.summaryDateStats(col, full);\n        for (const g of orderedGroups) {\n          this.groupDateStats(col, g);\n        }\n      } else if (isNumberColumn(col)) {\n        this.summaryNumberStats(col, false, full);\n        this.summaryNumberStats(col, true, full);\n        for (const g of orderedGroups) {\n          this.groupNumberStats(col, g, false);\n          this.groupNumberStats(col, g, true);\n        }\n      }\n    }\n  }\n\n  preComputeData(ranking: Ranking) {\n    for (const col of ranking.flatColumns) {\n      if (isCategoricalLikeColumn(col)) {\n        this.dataCategoricalStats(col);\n      } else if (isNumberColumn(col)) {\n        this.dataNumberStats(col, false);\n        this.dataNumberStats(col, true);\n      } else if (isDateColumn(col)) {\n        this.dataDateStats(col);\n      }\n    }\n  }\n\n  preComputeCol(col: Column) {\n    const ranking = col.findMyRanker();\n\n    if (isCategoricalLikeColumn(col)) {\n      this.dataCategoricalStats(col);\n      if (!ranking) {\n        return;\n      }\n      this.summaryCategoricalStats(col);\n      for (const group of ranking.getGroups()) {\n        this.groupCategoricalStats(col, group);\n      }\n      return;\n    }\n\n    if (isNumberColumn(col)) {\n      this.dataNumberStats(col, false);\n      this.dataNumberStats(col, true);\n\n      if (!ranking) {\n        return;\n      }\n      this.summaryNumberStats(col, false);\n      this.summaryNumberStats(col, true);\n      for (const group of ranking.getGroups()) {\n        this.groupNumberStats(col, group, false);\n        this.groupNumberStats(col, group, true);\n      }\n      return;\n    }\n\n    if (!isDateColumn(col)) {\n      return;\n    }\n\n    this.dataDateStats(col);\n\n    if (!ranking) {\n      return;\n    }\n    this.summaryDateStats(col);\n    for (const group of ranking.getGroups()) {\n      this.groupDateStats(col, group);\n    }\n  }\n\n  copyData2Summary(ranking: Ranking) {\n    for (const col of ranking.flatColumns) {\n      if (isCategoricalLikeColumn(col)) {\n        this.dataCategoricalStats(col);\n      } else if (isNumberColumn(col)) {\n        this.dataNumberStats(col, false);\n        this.dataNumberStats(col, true);\n      } else if (isDateColumn(col)) {\n        this.dataDateStats(col);\n      } else {\n        continue;\n      }\n      // copy from data to summary and create proper structure\n      this.chainCopy(`${col.id}:b:summary`, this.cache.get(`${col.id}:c:data`)!, (data: any) => ({\n        summary: data,\n        data,\n      }));\n      if (isNumberColumn(col)) {\n        this.chainCopy(`${col.id}:b:summary:raw`, this.cache.get(`${col.id}:c:data:raw`)!, (data: any) => ({\n          summary: data,\n          data,\n        }));\n      }\n    }\n  }\n\n  copyCache(col: Column, from: Column) {\n    const fromPrefix = `${from.id}:`;\n\n    for (const key of Array.from(this.cache.keys()).sort()) {\n      if (!key.startsWith(fromPrefix)) {\n        continue;\n      }\n      const chainKey = `${col.id}:${key.slice(fromPrefix.length)}`;\n      this.chainCopy(chainKey, this.cache.get(key)!, (data: any) => data);\n    }\n  }\n\n  groupCompare(ranking: Ranking, group: IGroup, rows: IndicesArray) {\n    return taskLater(\n      this.tasks.push(`r${ranking.id}:${group.name}`, () => {\n        const rg = ranking.getGroupSortCriteria();\n        if (rg.length === 0) {\n          return [group.name.toLowerCase()];\n        }\n        const o = this.byOrder(rows);\n        const vs: ICompareValue[] = [];\n        for (const s of rg) {\n          const cache = this.valueCache(s.col);\n          const r = s.col.toCompareGroupValue(o, group, cache ? lazySeq(rows).map((d) => cache(d)) : undefined);\n          if (Array.isArray(r)) {\n            vs.push(...r);\n          } else {\n            vs.push(r);\n          }\n        }\n        vs.push(group.name.toLowerCase());\n        return vs;\n      })\n    );\n  }\n\n  groupRows<T>(col: Column, group: IOrderedGroup, key: string, compute: (rows: ISequence<IDataRow>) => T) {\n    return this.cached(\n      `${col.id}:a:group:${group.name}:${key}`,\n      true,\n      oneShotIterator(() => compute(this.byOrder(group.order)))\n    );\n  }\n\n  groupExampleRows<T>(_col: Column, group: IOrderedGroup, _key: string, compute: (rows: ISequence<IDataRow>) => T) {\n    return taskNow(compute(this.byOrder(group.order.slice(0, 5))));\n  }\n\n  groupBoxPlotStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    return this.chain(\n      `${col.id}:a:group:${group.name}${raw ? ':braw' : ':b'}`,\n      this.summaryBoxPlotStats(col, raw),\n      ({ summary, data }) => {\n        const ranking = col.findMyRanker()!;\n        const key = raw ? `${col.id}:r` : col.id;\n        if (this.valueCacheData.has(key) && group.order.length > 0) {\n          // web worker version\n          return () =>\n            this.workers\n              .pushStats(\n                'boxplotStats',\n                {},\n                key,\n                this.valueCacheData.get(key) as Float32Array,\n                `${ranking.id}:${group.name}`,\n                group.order\n              )\n              .then((group) => ({ group, summary, data }));\n        }\n        return this.boxplotBuilder(group.order, col, raw, (group) => ({ group, summary, data }));\n      }\n    );\n  }\n\n  groupNumberStats(col: Column & INumberColumn, group: IOrderedGroup, raw?: boolean) {\n    return this.chain(\n      `${col.id}:a:group:${group.name}${raw ? ':raw' : ''}`,\n      this.summaryNumberStats(col, raw),\n      ({ summary, data }) => {\n        const ranking = col.findMyRanker()!;\n        const key = raw ? `${col.id}:r` : col.id;\n        if (this.valueCacheData.has(key) && group.order.length > 0) {\n          // web worker version\n          return () =>\n            this.workers\n              .pushStats(\n                'numberStats',\n                { numberOfBins: summary.hist.length, domain: this.resolveDomain(col, raw) },\n                key,\n                this.valueCacheData.get(key) as Float32Array,\n                `${ranking.id}:${group.name}`,\n                group.order\n              )\n              .then((group) => ({ group, summary, data }));\n        }\n        return this.statsBuilder(group.order, col, summary.hist.length, raw, (group) => ({\n          group,\n          summary,\n          data,\n        }));\n      }\n    );\n  }\n\n  groupCategoricalStats(col: Column & ICategoricalLikeColumn, group: IOrderedGroup) {\n    return this.chain(`${col.id}:a:group:${group.name}`, this.summaryCategoricalStats(col), ({ summary, data }) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id) && group.order.length > 0) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'categoricalStats',\n              { categories: col.categories.map((d) => d.name) },\n              col.id,\n              this.valueCacheData.get(col.id) as UIntTypedArray,\n              `${ranking.id}:${group.name}`,\n              group.order\n            )\n            .then((group) => ({ group, summary, data }));\n      }\n      return this.categoricalStatsBuilder(group.order, col, (group) => ({ group, summary, data }));\n    });\n  }\n\n  groupDateStats(col: Column & IDateColumn, group: IOrderedGroup) {\n    const key = `${col.id}:a:group:${group.name}`;\n    return this.chain(key, this.summaryDateStats(col), ({ summary, data }) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id) && group.order.length > 0) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'dateStats',\n              { template: summary },\n              col.id,\n              this.valueCacheData.get(col.id) as Float64Array,\n              `${ranking.id}:${group.name}`,\n              group.order\n            )\n            .then((group) => ({ group, summary, data }));\n      }\n      return this.dateStatsBuilder(group.order, col, summary, (group) => ({ group, summary, data }));\n    });\n  }\n\n  summaryBoxPlotStats(col: Column & INumberColumn, raw?: boolean, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary${raw ? ':braw' : ':b'}`, this.dataBoxPlotStats(col, raw), (data) => {\n      const ranking = col.findMyRanker()!;\n      const key = raw ? `${col.id}:r` : col.id;\n      if (this.valueCacheData.has(key)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'boxplotStats',\n              {},\n              key,\n              this.valueCacheData.get(key) as Float32Array,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.boxplotBuilder(order ? order : ranking.getOrder(), col, raw, (summary) => ({ summary, data }));\n    });\n  }\n\n  summaryNumberStats(col: Column & INumberColumn, raw?: boolean, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary${raw ? ':raw' : ''}`, this.dataNumberStats(col, raw), (data) => {\n      const ranking = col.findMyRanker()!;\n      const key = raw ? `${col.id}:r` : col.id;\n      if (this.valueCacheData.has(key)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'numberStats',\n              { numberOfBins: data.hist.length, domain: this.resolveDomain(col, raw) },\n              key,\n              this.valueCacheData.get(key) as Float32Array,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.statsBuilder(order ? order : ranking.getOrder(), col, data.hist.length, raw, (summary) => ({\n        summary,\n        data,\n      }));\n    });\n  }\n\n  summaryCategoricalStats(col: Column & ICategoricalLikeColumn, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary`, this.dataCategoricalStats(col), (data) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'categoricalStats',\n              { categories: col.categories.map((d) => d.name) },\n              col.id,\n              this.valueCacheData.get(col.id) as UIntTypedArray,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.categoricalStatsBuilder(order ? order : ranking.getOrder(), col, (summary) => ({ summary, data }));\n    });\n  }\n\n  summaryDateStats(col: Column & IDateColumn, order?: MultiIndices) {\n    return this.chain(`${col.id}:b:summary`, this.dataDateStats(col), (data) => {\n      const ranking = col.findMyRanker()!;\n      if (this.valueCacheData.has(col.id)) {\n        // web worker version\n        return () =>\n          this.workers\n            .pushStats(\n              'dateStats',\n              { template: data },\n              col.id,\n              this.valueCacheData.get(col.id) as Float64Array,\n              ranking.id,\n              order ? order.joined : ranking.getOrder()\n            )\n            .then((summary) => ({ summary, data }));\n      }\n      return this.dateStatsBuilder(order ? order : ranking.getOrder(), col, data, (summary) => ({ summary, data }));\n    });\n  }\n\n  private cached<T>(key: string, canAbort: boolean, it: Iterator<T | null> | (() => Promise<T>)): IRenderTask<T> {\n    const dontCache = this.data.length === 0;\n\n    if (this.isValidCacheEntry(key) && !dontCache) {\n      return this.cache.get(key)!;\n    }\n\n    const task = typeof it === 'function' ? abortAble(it()) : this.tasks.pushMulti(key, it, canAbort);\n    const s = taskLater(task);\n    if (!dontCache) {\n      this.cache.set(key, s);\n    }\n    task.then((r) => {\n      if (this.cache.get(key) !== s) {\n        return;\n      }\n      if (typeof r === 'symbol') {\n        this.cache.delete(key);\n      } else {\n        this.cache.set(key, taskNow(r));\n      }\n    });\n    return s;\n  }\n\n  private chain<T, U>(\n    key: string,\n    task: IRenderTask<T>,\n    creator: (data: T) => Iterator<U | null> | (() => Promise<U>)\n  ): IRenderTask<U> {\n    if (this.isValidCacheEntry(key)) {\n      return this.cache.get(key)!;\n    }\n    if (task instanceof TaskNow) {\n      if (typeof task.v === 'symbol') {\n        // aborted\n        return taskNow(ABORTED);\n      }\n      return this.cached(key, true, creator(task.v));\n    }\n\n    const v = (task as TaskLater<T>).v;\n    const subTask = v.then((data) => {\n      if (typeof data === 'symbol') {\n        return ABORTED;\n      }\n      const created = creator(data);\n      if (typeof created === 'function') {\n        // promise\n        return created();\n      }\n      return this.tasks.pushMulti(key, created);\n    });\n    const s = taskLater(subTask);\n    this.cache.set(key, s);\n    subTask.then((r) => {\n      if (this.cache.get(key) !== s) {\n        return;\n      }\n      if (typeof r === 'symbol') {\n        this.cache.delete(key);\n      } else {\n        this.cache.set(key, taskNow(r));\n      }\n    });\n    return s;\n  }\n\n  private isValidCacheEntry(key: string) {\n    if (!this.cache.has(key)) {\n      return false;\n    }\n    const v = this.cache.get(key);\n    // not an aborted task\n    return !(v instanceof TaskNow && typeof v.v === 'symbol') && !(v instanceof TaskLater && v.v.isAborted());\n  }\n\n  private chainCopy<T, U>(key: string, task: IRenderTask<T>, creator: (data: T) => U): IRenderTask<U> {\n    if (this.isValidCacheEntry(key)) {\n      return this.cache.get(key)!;\n    }\n    if (task instanceof TaskNow) {\n      if (typeof task.v === 'symbol') {\n        // aborted\n        return taskNow(ABORTED);\n      }\n      const subTask = taskNow(creator(task.v));\n      this.cache.set(key, subTask);\n      return subTask;\n    }\n\n    const v = (task as TaskLater<T>).v;\n    const subTask = v.then((data) => {\n      if (typeof data === 'symbol') {\n        return ABORTED;\n      }\n      return creator(data);\n    });\n    const s = taskLater(subTask);\n    this.cache.set(key, s);\n    subTask.then((r) => {\n      if (this.cache.get(key) !== s) {\n        return;\n      }\n      if (typeof r === 'symbol') {\n        this.cache.delete(key);\n      } else {\n        this.cache.set(key, taskNow(r));\n      }\n    });\n    return s;\n  }\n\n  dataBoxPlotStats(col: Column & INumberColumn, raw?: boolean) {\n    const key = `${col.id}:c:data${raw ? ':braw' : ':b'}`;\n    const valueCacheKey = raw ? `${col.id}:r` : col.id;\n    if (this.valueCacheData.has(valueCacheKey) && this.data.length > 0) {\n      // use webworker\n      return this.cached(key, false, () =>\n        this.workers.pushStats(\n          'boxplotStats',\n          {},\n          valueCacheKey,\n          this.valueCacheData.get(valueCacheKey)! as Float32Array\n        )\n      );\n    }\n    return this.cached(key, false, this.boxplotBuilder<IAdvancedBoxPlotData>(null, col, raw));\n  }\n\n  dataNumberStats(col: Column & INumberColumn, raw?: boolean) {\n    return this.cached(\n      `${col.id}:c:data${raw ? ':raw' : ''}`,\n      false,\n      this.statsBuilder<IStatistics>(null, col, getNumberOfBins(this.data.length), raw)\n    );\n  }\n\n  dataCategoricalStats(col: Column & ICategoricalLikeColumn) {\n    return this.cached(`${col.id}:c:data`, false, this.categoricalStatsBuilder<ICategoricalStatistics>(null, col));\n  }\n\n  dataDateStats(col: Column & IDateColumn) {\n    return this.cached(`${col.id}:c:data`, false, this.dateStatsBuilder<IDateStatistics>(null, col));\n  }\n\n  sort(\n    ranking: Ranking,\n    group: IGroup,\n    indices: IndicesArray,\n    singleCall: boolean,\n    maxDataIndex: number,\n    lookups?: CompareLookup\n  ) {\n    if (!lookups || indices.length < 1000) {\n      // no thread needed\n      const order = sortDirect(indices, maxDataIndex, lookups);\n      return Promise.resolve(order);\n    }\n\n    const indexArray = toIndexArray(indices, maxDataIndex);\n    const toTransfer = [indexArray.buffer];\n\n    if (singleCall) {\n      // can transfer otherwise need to copy\n      toTransfer.push(...lookups.transferAbles);\n    }\n\n    return this.workers.push(\n      'sort',\n      {\n        ref: `${ranking.id}:${group.name}`,\n        indices: indexArray,\n        sortOrders: lookups.sortOrders,\n      },\n      toTransfer,\n      (r: ISortMessageResponse) => r.order\n    );\n  }\n\n  terminate() {\n    this.workers.terminate();\n    this.cache.clear();\n    this.valueCacheData.clear();\n  }\n}\n","import { createIndexArray, sortComplex, ISequence, lazySeq, IEventContext } from '../internal';\nimport {\n  Column,\n  EDirtyReason,\n  Ranking,\n  defaultGroup,\n  IColumnDesc,\n  ICompareValue,\n  IDataRow,\n  IGroup,\n  IndicesArray,\n  INumberColumn,\n  IOrderedGroup,\n  CompositeColumn,\n} from '../model';\nimport ACommonDataProvider from './ACommonDataProvider';\nimport ADataProvider from './ADataProvider';\nimport type { IDataProviderOptions } from './interfaces';\nimport { CompareLookup } from './sort';\nimport type { IRenderTaskExecutor } from './tasks';\nimport { DirectRenderTasks } from './DirectRenderTasks';\nimport { ScheduleRenderTasks } from './ScheduledTasks';\nimport { joinGroups, mapIndices, duplicateGroup } from '../model/internal';\n\nexport interface ILocalDataProviderOptions {\n  /**\n   * whether the filter should be applied to all rankings regardless where they are\n   * default: false\n   */\n  filterGlobally: boolean;\n  /**\n   * jump to search results such that they are visible\n   * default: false\n   */\n  jumpToSearchResult: boolean;\n\n  /**\n   * specify the task executor to use direct = no delay, scheduled = run when idle\n   */\n  taskExecutor: 'direct' | 'scheduled';\n}\n\ninterface ISortHelper {\n  group: IGroup;\n  rows: IndicesArray;\n}\n\n/**\n * a data provider based on an local array\n */\nexport default class LocalDataProvider extends ACommonDataProvider {\n  private readonly ooptions: ILocalDataProviderOptions = {\n    /**\n     * whether the filter should be applied to all rankings regardless where they are\n     */\n    filterGlobally: false,\n\n    jumpToSearchResult: false,\n\n    taskExecutor: 'direct',\n  };\n\n  private readonly reorderAll: () => void;\n\n  private _dataRows: IDataRow[];\n  private filter: ((row: IDataRow) => boolean) | null = null;\n  private readonly tasks: IRenderTaskExecutor;\n\n  constructor(\n    private _data: any[],\n    columns: IColumnDesc[] = [],\n    options: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {}\n  ) {\n    super(columns, options);\n    Object.assign(this.ooptions, options);\n    this._dataRows = toRows(_data);\n    this.tasks = this.ooptions.taskExecutor === 'direct' ? new DirectRenderTasks() : new ScheduleRenderTasks();\n    this.tasks.setData(this._dataRows);\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.reorderAll = function (this: { source?: Ranking; type: string }) {\n      //fire for all other rankings a dirty order event, too\n      const ranking = this.source;\n      const type = this.type;\n      for (const r of that.getRankings()) {\n        if (r !== ranking) {\n          r.dirtyOrder(type === Ranking.EVENT_FILTER_CHANGED ? [EDirtyReason.FILTER_CHANGED] : [EDirtyReason.UNKNOWN]);\n        }\n      }\n    };\n  }\n\n  /**\n   * set a globally applied filter to all data without changing the data source itself\n   * @param {((row: IDataRow) => boolean) | null} filter\n   */\n  setFilter(filter: ((row: IDataRow) => boolean) | null) {\n    this.filter = filter;\n    this.reorderAll.call({ type: Ranking.EVENT_FILTER_CHANGED });\n  }\n\n  getFilter() {\n    return this.filter;\n  }\n\n  getTotalNumberOfRows() {\n    return this.data.length;\n  }\n\n  getTaskExecutor() {\n    return this.tasks;\n  }\n\n  get data() {\n    return this._data;\n  }\n\n  destroy() {\n    super.destroy();\n    this.tasks.terminate();\n  }\n\n  /**\n   * replaces the dataset rows with a new one\n   * @param data\n   */\n  setData(data: any[]) {\n    this._data = data;\n    this._dataRows = toRows(data);\n    this.dataChanged();\n  }\n\n  private dataChanged() {\n    this.tasks.setData(this._dataRows);\n\n    for (const ranking of this.getRankings()) {\n      this.tasks.preComputeData(ranking);\n    }\n\n    this.fire(ADataProvider.EVENT_DATA_CHANGED, this._dataRows);\n    this.reorderAll.call({ type: Ranking.EVENT_FILTER_CHANGED });\n  }\n\n  clearData() {\n    this.setData([]);\n  }\n\n  /**\n   * append rows to the dataset\n   * @param data\n   */\n  appendData(data: any[]) {\n    for (const d of data) {\n      this._data.push(d);\n      this._dataRows.push({ v: d, i: this._dataRows.length });\n    }\n    this.dataChanged();\n  }\n\n  cloneRanking(existing?: Ranking) {\n    const ranking = super.cloneRanking(existing);\n\n    if (this.ooptions.filterGlobally) {\n      ranking.on(`${Ranking.EVENT_FILTER_CHANGED}.reorderAll`, this.reorderAll);\n    }\n\n    this.trackRanking(ranking, existing);\n    return ranking;\n  }\n\n  private trackRanking(ranking: Ranking, existing?: Ranking) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    ranking.on(`${Column.EVENT_DIRTY_CACHES}.cache`, function (this: IEventContext) {\n      let col: any = this.origin;\n      while (col instanceof Column) {\n        // console.log(col.label, 'dirty data');\n        that.tasks.dirtyColumn(col, 'data');\n        that.tasks.preComputeCol(col);\n        col = col.parent;\n      }\n    });\n\n    const cols = ranking.flatColumns;\n    const addKey = `${Ranking.EVENT_ADD_COLUMN}.cache`;\n    const removeKey = `${Ranking.EVENT_REMOVE_COLUMN}.cache`;\n\n    const removeCol = (col: Column) => {\n      this.tasks.dirtyColumn(col, 'data');\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, null);\n        col.on(removeKey, null);\n      }\n    };\n\n    const addCol = (col: Column) => {\n      this.tasks.preComputeCol(col);\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, addCol);\n        col.on(removeKey, removeCol);\n      }\n    };\n\n    ranking.on(addKey, addCol);\n    ranking.on(removeKey, removeCol);\n    for (const col of cols) {\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, addCol);\n        col.on(removeKey, removeCol);\n      }\n    }\n\n    if (existing) {\n      const copy = existing.flatColumns;\n      for (let i = 0; i < cols.length; ++i) {\n        this.tasks.copyCache(cols[i], copy[i]);\n      }\n    }\n\n    this.tasks.preComputeData(ranking);\n  }\n\n  cleanUpRanking(ranking: Ranking) {\n    if (this.ooptions.filterGlobally) {\n      ranking.on(`${Ranking.EVENT_FILTER_CHANGED}.reorderAll`, null);\n    }\n\n    const cols = ranking.flatColumns;\n    const addKey = `${Ranking.EVENT_ADD_COLUMN}.cache`;\n    const removeKey = `${Ranking.EVENT_REMOVE_COLUMN}.cache`;\n    ranking.on(addKey, null);\n    ranking.on(removeKey, null);\n    for (const col of cols) {\n      if (col instanceof CompositeColumn) {\n        col.on(addKey, null);\n        col.on(removeKey, null);\n      }\n    }\n\n    this.tasks.dirtyRanking(ranking, 'data');\n\n    super.cleanUpRanking(ranking);\n  }\n\n  private resolveFilter(ranking: Ranking) {\n    //do the optional filtering step\n    const filter: (Column | ((d: IDataRow) => boolean))[] = [];\n\n    if (this.ooptions.filterGlobally) {\n      for (const r of this.getRankings()) {\n        if (r.isFiltered()) {\n          filter.push(...r.flatColumns.filter((d) => d.isFiltered()));\n        }\n      }\n    } else if (ranking.isFiltered()) {\n      filter.push(...ranking.flatColumns.filter((d) => d.isFiltered()));\n    }\n\n    if (this.filter) {\n      filter.push(this.filter);\n    }\n    return filter;\n  }\n\n  private noSorting(ranking: Ranking) {\n    // initial no sorting required just index mapping\n    const l = this._data.length;\n    const order = createIndexArray(l, l - 1);\n    const index2pos = order.slice();\n    for (let i = 0; i < l; ++i) {\n      order[i] = i;\n      index2pos[i] = i + 1; // shift since default is 0\n    }\n\n    this.tasks.preCompute(ranking, [{ rows: order, group: defaultGroup }], l - 1);\n    return { groups: [Object.assign({ order }, defaultGroup)], index2pos };\n  }\n\n  private createSorter(\n    ranking: Ranking,\n    filter: (Column | ((d: IDataRow) => boolean))[],\n    needsFiltering: boolean,\n    needsGrouping: boolean,\n    needsSorting: boolean\n  ) {\n    const groups = new Map<string, ISortHelper>();\n    const groupOrder: ISortHelper[] = [];\n    let maxDataIndex = -1;\n\n    const groupCriteria = ranking.getGroupCriteria();\n    const lookups = needsSorting\n      ? new CompareLookup(this._data.length, true, ranking, this.tasks.valueCache.bind(this.tasks))\n      : undefined;\n\n    const pushGroup = (group: IGroup, r: IDataRow) => {\n      const groupKey = group.name.toLowerCase();\n      if (groups.has(groupKey)) {\n        (groups.get(groupKey)!.rows as number[]).push(r.i);\n        return;\n      }\n      const s = { group, rows: [r.i] };\n      groups.set(groupKey, s);\n      groupOrder.push(s);\n    };\n\n    const groupCaches = groupCriteria.map((c) => this.tasks.valueCache(c));\n    const filterCaches = filter.map((c) => (typeof c === 'function' ? undefined : this.tasks.valueCache(c)));\n\n    const toGroup =\n      groupCriteria.length === 1\n        ? (r: IDataRow) => joinGroups([groupCriteria[0].group(r, groupCaches[0] ? groupCaches[0]!(r.i) : undefined)])\n        : (r: IDataRow) =>\n            joinGroups(groupCriteria.map((c, i) => c.group(r, groupCaches[i] ? groupCaches[i]!(r.i) : undefined)));\n\n    if (needsFiltering) {\n      // filter, group, sort\n      outer: for (const r of this._dataRows) {\n        for (let f = 0; f < filter.length; ++f) {\n          const fc = filter[f];\n          const c = filterCaches[f];\n          if ((typeof fc === 'function' && !fc(r)) || (fc instanceof Column && !fc.filter(r, c ? c(r.i) : undefined))) {\n            continue outer;\n          }\n        }\n        if (maxDataIndex < r.i) {\n          maxDataIndex = r.i;\n        }\n        if (lookups) {\n          lookups.push(r);\n        }\n        pushGroup(toGroup(r), r);\n      }\n\n      // some default sorting\n      groupOrder.sort((a, b) => a.group.name.toLowerCase().localeCompare(b.group.name.toLowerCase()));\n      return { maxDataIndex, lookups, groupOrder };\n    }\n\n    // reuse the existing groups\n\n    for (const before of ranking.getGroups()) {\n      const order = before.order;\n      if (!needsGrouping) {\n        const clone = duplicateGroup(before);\n        // reuse in full\n        groupOrder.push({ group: clone, rows: order });\n\n        if (!lookups) {\n          maxDataIndex = (order as readonly number[]).reduce((a, b) => Math.max(a, b), maxDataIndex);\n          continue;\n        }\n        // sort\n        // tslint:disable-next-line:prefer-for-of\n        for (let o = 0; o < order.length; ++o) {\n          const i = order[o];\n          if (maxDataIndex < i) {\n            maxDataIndex = i;\n          }\n          lookups.push(this._dataRows[i]);\n        }\n        continue;\n      }\n\n      // group, [sort]\n      // tslint:disable-next-line:prefer-for-of\n      for (let o = 0; o < order.length; ++o) {\n        const i = order[o];\n        if (maxDataIndex < i) {\n          maxDataIndex = i;\n        }\n        const r = this._dataRows[i];\n        if (lookups) {\n          lookups.push(r);\n        }\n        pushGroup(toGroup(r), r);\n      }\n    }\n\n    if (needsGrouping) {\n      // some default sorting\n      groupOrder.sort((a, b) => a.group.name.toLowerCase().localeCompare(b.group.name.toLowerCase()));\n    }\n    return { maxDataIndex, lookups, groupOrder };\n  }\n\n  private sortGroup(\n    g: ISortHelper,\n    i: number,\n    ranking: Ranking,\n    lookups: CompareLookup | undefined,\n    groupLookup: CompareLookup | undefined,\n    singleGroup: boolean,\n    maxDataIndex: number\n  ): Promise<IOrderedGroup> {\n    const group = g.group;\n\n    const sortTask = this.tasks.sort(ranking, group, g.rows, singleGroup, maxDataIndex, lookups);\n\n    // compute sort group value as task\n    const groupSortTask = groupLookup\n      ? this.tasks.groupCompare(ranking, group, g.rows).then((r) => r)\n      : ([] as ICompareValue[]);\n\n    // trigger task for groups to compute for this group\n\n    return Promise.all([sortTask, groupSortTask]).then(([order, groupC]) => {\n      if (groupLookup && Array.isArray(groupC)) {\n        groupLookup.pushValues(i, groupC);\n      }\n      return Object.assign(group, { order });\n    });\n  }\n\n  private sortGroups(groups: IOrderedGroup[], groupLookup: CompareLookup | undefined, enforceSorting: boolean) {\n    // sort groups\n    if (groupLookup) {\n      const groupIndices = groups.map((_, i) => i);\n      sortComplex(groupIndices, groupLookup.sortOrders);\n      return groupIndices.map((i) => groups[i]);\n    }\n    if (enforceSorting) {\n      // create a default sorting\n      return groups.sort((a, b) => a.name.localeCompare(b.name));\n    }\n    return groups;\n  }\n\n  private index2pos(groups: IOrderedGroup[], maxDataIndex: number) {\n    const total = groups.reduce((a, b) => a + b.order.length, 1);\n    const index2pos = createIndexArray(maxDataIndex + 1, total);\n    let offset = 1;\n    for (const g of groups) {\n      // tslint:disable-next-line\n      for (let i = 0; i < g.order.length; i++, offset++) {\n        index2pos[g.order[i]] = offset;\n      }\n    }\n\n    return { groups, index2pos };\n  }\n\n  sort(ranking: Ranking, dirtyReason: EDirtyReason[]) {\n    const reasons = new Set(dirtyReason);\n\n    if (this._data.length === 0) {\n      return { groups: [], index2pos: [] };\n    }\n\n    // console.log(dirtyReason);\n\n    const filter = this.resolveFilter(ranking);\n\n    const needsFiltering = reasons.has(EDirtyReason.UNKNOWN) || reasons.has(EDirtyReason.FILTER_CHANGED);\n    const needsGrouping =\n      needsFiltering ||\n      reasons.has(EDirtyReason.GROUP_CRITERIA_CHANGED) ||\n      reasons.has(EDirtyReason.GROUP_CRITERIA_DIRTY);\n    const needsSorting =\n      needsGrouping || reasons.has(EDirtyReason.SORT_CRITERIA_CHANGED) || reasons.has(EDirtyReason.SORT_CRITERIA_DIRTY);\n    const needsGroupSorting =\n      needsGrouping ||\n      reasons.has(EDirtyReason.GROUP_SORT_CRITERIA_CHANGED) ||\n      reasons.has(EDirtyReason.GROUP_SORT_CRITERIA_DIRTY);\n\n    if (needsFiltering) {\n      this.tasks.dirtyRanking(ranking, 'summary');\n    } else if (needsGrouping) {\n      this.tasks.dirtyRanking(ranking, 'group');\n    }\n    // otherwise the summary and group summaries should still be valid\n\n    if (filter.length === 0) {\n      // all rows so summary = data\n      this.tasks.copyData2Summary(ranking);\n    }\n\n    const isGroupedBy = ranking.getGroupCriteria().length > 0;\n    const isSortedBy = ranking.getSortCriteria().length > 0;\n    const isGroupedSortedBy = ranking.getGroupSortCriteria().length > 0;\n\n    if (!isGroupedBy && !isSortedBy && filter.length === 0) {\n      return this.noSorting(ranking);\n    }\n\n    const { maxDataIndex, lookups, groupOrder } = this.createSorter(\n      ranking,\n      filter,\n      needsFiltering,\n      needsGrouping,\n      needsSorting\n    );\n\n    if (groupOrder.length === 0) {\n      return { groups: [], index2pos: [] };\n    }\n\n    this.tasks.preCompute(ranking, groupOrder, maxDataIndex);\n\n    if (groupOrder.length === 1) {\n      const g = groupOrder[0]!;\n\n      // not required if: group sort criteria changed -> lookups will be none\n      return this.sortGroup(g, 0, ranking, lookups, undefined, true, maxDataIndex).then((group) => {\n        return this.index2pos([group], maxDataIndex);\n      });\n    }\n\n    const groupLookup =\n      isGroupedSortedBy && needsGroupSorting ? new CompareLookup(groupOrder.length, false, ranking) : undefined;\n\n    return Promise.all(\n      groupOrder.map((g, i) => {\n        // not required if: group sort criteria changed -> lookups will be none\n        return this.sortGroup(g, i, ranking, lookups, groupLookup, false, maxDataIndex);\n      })\n    ).then((groups) => {\n      // not required if: sort criteria changed -> groupLookup will be none\n      const sortedGroups = this.sortGroups(groups, groupLookup, needsGroupSorting);\n      return this.index2pos(sortedGroups, maxDataIndex);\n    });\n  }\n\n  private readonly mapToDataRow = (i: number) => {\n    if (i < 0 || i >= this._dataRows.length) {\n      return { i, v: {} };\n    }\n    return this._dataRows[i];\n  };\n\n  viewRaw(indices: IndicesArray) {\n    return mapIndices(indices, (i) => this._data[i] || {});\n  }\n\n  viewRawRows(indices: IndicesArray) {\n    return mapIndices(indices, this.mapToDataRow);\n  }\n\n  getRow(index: number) {\n    return this._dataRows[index];\n  }\n\n  seq(indices: IndicesArray) {\n    return lazySeq(indices).map(this.mapToDataRow);\n  }\n\n  view(indices: IndicesArray) {\n    return this.viewRaw(indices);\n  }\n\n  mappingSample(col: INumberColumn): ISequence<number> {\n    const MAX_SAMPLE = 120; //at most 120 sample lines\n    const l = this._dataRows.length;\n    if (l <= MAX_SAMPLE) {\n      return lazySeq(this._dataRows).map((v) => col.getRawNumber(v));\n    }\n    //randomly select 500 elements\n    const indices = new Set<number>();\n\n    for (let i = 0; i < MAX_SAMPLE; ++i) {\n      let j = Math.floor(Math.random() * (l - 1));\n      while (indices.has(j)) {\n        j = Math.floor(Math.random() * (l - 1));\n      }\n      indices.add(j);\n    }\n    return lazySeq(Array.from(indices)).map((i) => col.getRawNumber(this._dataRows[i]));\n  }\n\n  searchAndJump(search: string | RegExp, col: Column) {\n    //case insensitive search\n    search = typeof search === 'string' ? search.toLowerCase() : search;\n    const f =\n      typeof search === 'string'\n        ? (v: string) => v.toLowerCase().indexOf(search as string) >= 0\n        : (search as RegExp).test.bind(search);\n    const indices: number[] = [];\n    for (let i = 0; i < this._dataRows.length; ++i) {\n      if (f(col.getLabel(this._dataRows[i]))) {\n        indices.push(i);\n      }\n    }\n    this.jumpToNearest(indices);\n  }\n}\n\nfunction toRows(data: any[]) {\n  return data.map((v, i) => ({ v, i }));\n}\n","import type { IAbortAblePromise } from 'lineupengine';\nimport type { Column, IDataRow, IOrderedGroup, INumberColumn, ICategoricalLikeColumn, IDateColumn } from '../model';\nimport type { IDataProvider } from '../provider';\nimport type DialogManager from '../ui/dialogs/DialogManager';\nimport type {\n  ISequence,\n  IDateStatistics,\n  ICategoricalStatistics,\n  IAdvancedBoxPlotData,\n  IStatistics,\n} from '../internal';\n\nexport interface IImposer {\n  color?(row: IDataRow | null, valueHint?: number): string | null;\n}\n\nexport declare type IRenderCallback = (ctx: CanvasRenderingContext2D) => void;\n\n/**\n * a cell renderer for rendering a cell of specific column\n */\nexport interface ICellRenderer {\n  /**\n   * template as a basis for the update\n   */\n  readonly template: string;\n\n  /**\n   * update a given node (create using the template) with the given data\n   * @param node the node to update\n   * @param d the data item\n   * @param i the order relative index\n   * @param group the group this row is part of\n   */\n  update(node: HTMLElement, d: IDataRow, i: number, group: IOrderedGroup): void | IAbortAblePromise<void> | null;\n\n  /**\n   * render a low detail canvas row\n   * @return true if a dom element is needed\n   */\n  render?(\n    ctx: CanvasRenderingContext2D,\n    d: IDataRow,\n    i: number,\n    group: IOrderedGroup\n  ): void | IAbortAblePromise<IRenderCallback> | boolean | null;\n}\n\n/**\n * a cell renderer for rendering a cell of specific column\n */\nexport interface IGroupCellRenderer {\n  /**\n   * template as a basis for the update\n   */\n  readonly template: string;\n\n  /**\n   * update a given node (create using the template) with the given data\n   * @param node the node to update\n   * @param group the group to render\n   */\n  update(node: HTMLElement, group: IOrderedGroup): void | IAbortAblePromise<void> | null;\n}\n\nexport interface ISummaryRenderer {\n  /**\n   * template as a basis for the update\n   */\n  readonly template: string;\n\n  update(node: HTMLElement): void | IAbortAblePromise<void> | null;\n}\n\nexport interface IRenderTask<T> {\n  then<U = void>(onfullfilled: (value: T | symbol) => U): U | IAbortAblePromise<U>;\n}\n\nexport interface IRenderTasks {\n  groupRows<T>(\n    col: Column,\n    group: IOrderedGroup,\n    key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T>;\n  groupExampleRows<T>(\n    col: Column,\n    group: IOrderedGroup,\n    key: string,\n    compute: (rows: ISequence<IDataRow>) => T\n  ): IRenderTask<T>;\n\n  groupBoxPlotStats(\n    col: Column & INumberColumn,\n    group: IOrderedGroup,\n    raw?: boolean\n  ): IRenderTask<{ group: IAdvancedBoxPlotData; summary: IAdvancedBoxPlotData; data: IAdvancedBoxPlotData }>;\n  groupNumberStats(\n    col: Column & INumberColumn,\n    group: IOrderedGroup,\n    raw?: boolean\n  ): IRenderTask<{ group: IStatistics; summary: IStatistics; data: IStatistics }>;\n  groupCategoricalStats(\n    col: Column & ICategoricalLikeColumn,\n    group: IOrderedGroup\n  ): IRenderTask<{ group: ICategoricalStatistics; summary: ICategoricalStatistics; data: ICategoricalStatistics }>;\n  groupDateStats(\n    col: Column & IDateColumn,\n    group: IOrderedGroup\n  ): IRenderTask<{ group: IDateStatistics; summary: IDateStatistics; data: IDateStatistics }>;\n\n  summaryBoxPlotStats(\n    col: Column & INumberColumn,\n    raw?: boolean\n  ): IRenderTask<{ summary: IAdvancedBoxPlotData; data: IAdvancedBoxPlotData }>;\n  summaryNumberStats(\n    col: Column & INumberColumn,\n    raw?: boolean\n  ): IRenderTask<{ summary: IStatistics; data: IStatistics }>;\n  summaryCategoricalStats(\n    col: Column & ICategoricalLikeColumn\n  ): IRenderTask<{ summary: ICategoricalStatistics; data: ICategoricalStatistics }>;\n  summaryDateStats(col: Column & IDateColumn): IRenderTask<{ summary: IDateStatistics; data: IDateStatistics }>;\n}\n\n/**\n * context for rendering, wrapped as an object for easy extensibility\n */\nexport interface IRenderContext {\n  readonly tasks: IRenderTasks;\n  /**\n   * render a column\n   * @param col\n   */\n  renderer(col: Column, imposer?: IImposer): ICellRenderer;\n\n  /**\n   * render a column\n   * @param col\n   */\n  groupRenderer(col: Column, imposer?: IImposer): IGroupCellRenderer;\n\n  summaryRenderer(co: Column, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\n\n  /**\n   * prefix used for all generated id names\n   */\n  readonly idPrefix: string;\n\n  asElement(html: string): HTMLElement;\n\n  colWidth(col: Column): number;\n\n  readonly provider: IDataProvider;\n  readonly dialogManager: DialogManager;\n}\n\nexport enum ERenderMode {\n  CELL,\n  GROUP,\n  SUMMARY,\n}\n\nexport interface ICellRendererFactory {\n  readonly title: string;\n  readonly groupTitle?: string;\n  readonly summaryTitle?: string;\n\n  canRender(col: Column, mode: ERenderMode): boolean;\n\n  create?(col: Column, context: IRenderContext, imposer?: IImposer): ICellRenderer;\n\n  createGroup?(col: Column, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer;\n\n  createSummary?(col: Column, context: IRenderContext, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\n}\n","/**\n * number of bins before switching to dense mode\n * @internal\n */\nexport const DENSE_HISTOGRAM = 19;\n/**\n * minimal width of a column to show the label in the header\n * @internal\n */\nexport const MIN_LABEL_WIDTH = 30;\n/**\n * number of milliseconds to wait before a hovered canvas row will be replaced with a DOM one\n * @type {number}\n * @internal\n */\nexport const HOVER_DELAY_SHOW_DETAIL = 500;\n\nexport const GUESSED_ROW_HEIGHT = 18;\nexport const GUESSES_GROUP_HEIGHT = 40;\n","import { MIN_LABEL_WIDTH } from '../constants';\nimport { Column, IArrayColumn, IDataRow, ICategoricalLikeColumn, isMapAbleColumn, DEFAULT_COLOR } from '../model';\nimport { hsl } from 'd3-color';\nimport { cssClass } from '../styles';\nimport type { ISequence } from '../internal';\nimport type { IRenderContext } from './interfaces';\n\n/** @internal */\nexport function noop() {\n  // no op\n}\n\nexport const noRenderer = {\n  template: `<div></div>`,\n  update: noop as () => void,\n};\n\n/** @internal */\nexport function setText<T extends Node>(node: T, text?: string): T {\n  if (text === undefined) {\n    return node;\n  }\n  //no performance boost if setting the text node directly\n  //const textNode = <Text>node.firstChild;\n  //if (textNode == null) {\n  //  node.appendChild(node.ownerDocument!.createTextNode(text));\n  //} else {\n  //  textNode.data = text;\n  //}\n  if (node.textContent !== text) {\n    node.textContent = text;\n  }\n  return node;\n}\n\n/**\n * for each item matching the selector execute the callback\n * @param node\n * @param selector\n * @param callback\n * @internal\n */\nexport function forEach<T extends Element>(node: Element, selector: string, callback: (d: T, i: number) => void) {\n  Array.from(node.querySelectorAll<T>(selector)).forEach(callback);\n}\n\n/** @internal */\nexport function forEachChild<T extends Element>(node: Element, callback: (d: T, i: number) => void) {\n  (Array.from(node.children) as T[]).forEach(callback);\n}\n\n/**\n * matches the columns and the dom nodes representing them\n * @param {HTMLElement} node row\n * @param columns columns to check\n * @internal\n */\nexport function matchColumns(\n  node: HTMLElement,\n  columns: { column: Column; template: string; rendererId: string }[],\n  ctx: IRenderContext\n) {\n  if (node.childElementCount === 0) {\n    // initial call fast method\n    node.innerHTML = columns.map((c) => c.template).join('');\n    const children = Array.from(node.children);\n    columns.forEach((col, i) => {\n      const cnode = children[i] as HTMLElement;\n      // set attribute for finding again\n      cnode.dataset.columnId = col.column.id;\n      // store current renderer\n      cnode.dataset.renderer = col.rendererId;\n      cnode.classList.add(cssClass(`renderer-${col.rendererId}`));\n    });\n    return;\n  }\n\n  function matches(c: { column: Column; rendererId: string }, i: number) {\n    //do both match?\n    const n = node.children[i] as HTMLElement;\n    return n != null && n.dataset.columnId === c.column.id && n.dataset.renderer === c.rendererId;\n  }\n\n  if (columns.every(matches)) {\n    return; //nothing to do\n  }\n\n  const idsAndRenderer = new Set(columns.map((c) => `${c.column.id}@${c.rendererId}`));\n  //remove all that are not existing anymore\n  forEachChild(node, (n: HTMLElement) => {\n    const id = n.dataset.columnId;\n    const renderer = n.dataset.renderer;\n    const idAndRenderer = `${id}@${renderer}`;\n    if (!idsAndRenderer.has(idAndRenderer)) {\n      node.removeChild(n);\n    }\n  });\n  columns.forEach((col) => {\n    let cnode = node.querySelector<HTMLElement>(`[data-column-id=\"${col.column.id}\"]`);\n    if (!cnode) {\n      cnode = ctx.asElement(col.template);\n      cnode.dataset.columnId = col.column.id;\n      cnode.dataset.renderer = col.rendererId;\n      cnode.classList.add(cssClass(`renderer-${col.rendererId}`));\n    }\n    node.appendChild(cnode);\n  });\n}\n\nexport function wideEnough(col: IArrayColumn<any>, length: number = col.labels.length) {\n  const w = col.getWidth();\n  return w / length > MIN_LABEL_WIDTH; // at least 30 pixel\n}\n\nexport function wideEnoughCat(col: ICategoricalLikeColumn) {\n  const w = col.getWidth();\n  return w / col.categories.length > MIN_LABEL_WIDTH; // at least 30 pixel\n}\n\n// side effect\nconst adaptColorCache: { [bg: string]: string } = {};\n/**\n * Adapts the text color for a given background color\n * @param {string} bgColor as `#ff0000`\n * @returns {string} returns `black` or `white` for best contrast\n */\nexport function adaptTextColorToBgColor(bgColor: string): string {\n  const bak = adaptColorCache[bgColor];\n  if (bak) {\n    return bak;\n  }\n  return (adaptColorCache[bgColor] = hsl(bgColor).l > 0.5 ? 'black' : 'white');\n}\n\n/**\n *\n * Adapts the text color for a given background color\n * @param {HTMLElement} node the node containing the text\n * @param {string} bgColor as `#ff0000`\n * @param {string} title the title to render\n * @param {number} width for which percentages of the cell this background applies (0..1)\n */\nexport function adaptDynamicColorToBgColor(node: HTMLElement, bgColor: string, title: string, width: number) {\n  const adapt = adaptTextColorToBgColor(bgColor);\n  if (width <= 0.05 || adapt === 'black' || width > 0.9) {\n    // almost empty or full\n    node.style.color = adapt === 'black' || width <= 0.05 ? null : adapt; // null = black\n    // node.classList.remove('lu-gradient-text');\n    // node.style.backgroundImage = null;\n    return;\n  }\n\n  node.style.color = null;\n  node.innerText = title;\n\n  const span = node.ownerDocument!.createElement('span');\n  span.classList.add(cssClass('gradient-text'));\n  span.style.color = adapt;\n  span.innerText = title;\n  node.appendChild(span);\n}\n\n/** @internal */\nexport const uniqueId: (prefix: string) => string = (function () {\n  // side effect but just within the function itself, so good for the library\n  let idCounter = 0;\n  return (prefix: string) => `${prefix}${(idCounter++).toString(36)}`;\n})();\n\nconst NUM_EXAMPLE_VALUES = 5;\n\n/** @internal */\nexport function exampleText(col: Column, rows: ISequence<IDataRow>) {\n  const examples: string[] = [];\n  rows.every((row) => {\n    if (col.getValue(row) == null) {\n      return true;\n    }\n    const v = col.getLabel(row);\n    examples.push(v);\n    return examples.length < NUM_EXAMPLE_VALUES;\n  });\n  if (examples.length === 0) {\n    return '';\n  }\n  return `${examples.join(', ')}${examples.length < rows.length ? ', ...' : ''}`;\n}\n\n/** @internal */\nexport function multiLevelGridCSSClass(idPrefix: string, column: Column) {\n  return cssClass(`stacked-${idPrefix}-${column.id}`);\n}\n\n/** @internal */\nexport function colorOf(col: Column) {\n  if (isMapAbleColumn(col)) {\n    return col.getColorMapping().apply(0);\n  }\n  return DEFAULT_COLOR;\n}\n","import { IDataRow, IOrderedGroup, ActionColumn, Column } from '../model';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { forEachChild, noRenderer } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class ActionRenderer implements ICellRendererFactory {\n  readonly title = 'Default';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof ActionColumn && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: ActionColumn): ICellRenderer {\n    const actions = col.actions;\n    return {\n      template: `<div class=\"${cssClass('actions')} ${cssClass('hover-only')}\">${actions\n        .map((a) => `<span title='${a.name}' class='${a.className || ''}'>${a.icon || ''}</span>`)\n        .join('')}</div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\n          ni.onclick = function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            setTimeout(() => actions[i].action(d), 1); // async\n          };\n        });\n      },\n    };\n  }\n\n  createGroup(col: ActionColumn, context: IRenderContext): IGroupCellRenderer {\n    const actions = col.groupActions;\n    return {\n      template: `<div class=\"${cssClass('actions')} ${cssClass('hover-only')}\">${actions\n        .map((a) => `<span title='${a.name}' class='${a.className || ''}'>${a.icon || ''}</span>`)\n        .join('')}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\n          ni.onclick = function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            context.tasks\n              .groupRows(col, group, 'identity', (r) => r)\n              .then((rows) => {\n                if (typeof rows === 'symbol') {\n                  return;\n                }\n                setTimeout(() => actions[i].action(group, Array.from(rows)), 1); // async\n              });\n          };\n        });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import {\n  IDataRow,\n  Column,\n  AggregateGroupColumn,\n  EAggregationState,\n  IOrderedGroup,\n  IGroupParent,\n  IGroup,\n  defaultGroup,\n} from '../model';\nimport { AGGREGATE, CANVAS_HEIGHT, cssClass } from '../styles';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport type { IDataProvider } from '../provider';\nimport {\n  groupParents,\n  toItemMeta,\n  isAlwaysShowingGroupStrategy,\n  hasTopNStrategy,\n  isSummaryGroup,\n} from '../provider/internal';\nimport { clear } from '../internal';\n\nfunction preventDefault(event: Event) {\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction matchNodes(node: HTMLElement, length: number, clazz = 'agg-level', addTopN = false) {\n  const doc = node.ownerDocument!;\n  const children = Array.from(node.children) as HTMLElement[];\n  if (addTopN) {\n    // top N buttons\n    length = length + 1;\n  }\n\n  // add missing\n  for (let i = children.length; i < length; ++i) {\n    const child = doc.createElement('div');\n    child.classList.add(cssClass(clazz));\n    children.push(child);\n    node.appendChild(child);\n  }\n  // remove too many\n  for (const r of children.splice(length, children.length - length)) {\n    r.remove();\n  }\n  if (addTopN) {\n    const last = children[children.length - 1];\n    last.classList.remove(cssClass(clazz));\n    last.classList.add(cssClass('agg-all'));\n  }\n  return children;\n}\n\nfunction renderGroups(\n  node: HTMLElement,\n  group: IOrderedGroup,\n  relativeIndex: number,\n  col: AggregateGroupColumn,\n  provider: IDataProvider\n) {\n  const strategy = provider.getAggregationStrategy();\n  const ranking = col.findMyRanker()!;\n  const topNGetter = (group: IGroup) => provider.getTopNAggregated(ranking, group);\n\n  const isRow = relativeIndex >= 0;\n  const isLeafGroup =\n    !(group as any as IGroupParent).subGroups || (group as any as IGroupParent).subGroups.length === 0;\n\n  const alwaysShowGroup = isAlwaysShowingGroupStrategy(strategy);\n  const isSummary = !isRow && isSummaryGroup(group, strategy, topNGetter);\n  const hasTopN = isSummary && isLeafGroup && hasTopNStrategy(strategy);\n\n  const parents = groupParents(\n    group,\n    relativeIndex >= 0 ? toItemMeta(relativeIndex, group, provider.getTopNAggregated(ranking, group)) : 'first last'\n  );\n  const children = matchNodes(node, parents.length, 'agg-level', hasTopN);\n\n  const lastParent = parents.length - 1;\n\n  for (let i = 0; i < parents.length; ++i) {\n    const parent = parents[i];\n    const child = children[i];\n    const state = provider.getAggregationState(ranking, parent.group);\n    const isLastGroup = i === lastParent;\n    child.dataset.level = String(parents.length - 1 - i); // count backwards\n\n    if (alwaysShowGroup && (isRow || i < lastParent)) {\n      // inner or last\n      if (!isSummary && (parent.meta === 'last' || parent.meta === 'first last')) {\n        child.dataset.meta = 'last';\n      } else {\n        delete child.dataset.meta;\n      }\n      child.classList.toggle(cssClass('agg-inner'), isRow && isLastGroup);\n      child.classList.remove(cssClass('agg-expand'), cssClass('agg-collapse'));\n      child.title = '';\n      delete child.onclick;\n      continue;\n    }\n\n    const isCollapsed = state === EAggregationState.COLLAPSE;\n    const isFirst = parent.meta === 'first' || parent.meta === 'first last';\n    const isShowAll = state === EAggregationState.EXPAND;\n    const childTopN = hasTopN && isLastGroup ? children[parents.length] : null;\n\n    let meta = parent.meta;\n    if (isSummary && parent.meta === 'first last') {\n      meta = 'first';\n    }\n\n    if (meta) {\n      child.dataset.meta = meta;\n    } else {\n      delete child.dataset.meta;\n    }\n\n    child.classList.toggle(cssClass('agg-expand'), isFirst);\n    child.classList.toggle(cssClass('agg-collapse'), isCollapsed);\n    child.title = isFirst ? (isCollapsed ? 'Expand Group' : 'Collapse Group') : '';\n\n    if (!isFirst) {\n      delete child.onclick;\n    } else {\n      child.onclick = (evt) => {\n        preventDefault(evt);\n        let nextState: EAggregationState;\n        switch (strategy) {\n          case 'group+top+item':\n            nextState =\n              state === EAggregationState.COLLAPSE ? EAggregationState.EXPAND_TOP_N : EAggregationState.COLLAPSE;\n            break;\n          case 'group':\n          case 'item':\n          case 'group+item':\n          case 'group+item+top':\n          default:\n            nextState = state === EAggregationState.COLLAPSE ? EAggregationState.EXPAND : EAggregationState.COLLAPSE;\n            break;\n        }\n        col.setAggregated(parent.group, nextState);\n      };\n    }\n\n    if (!childTopN) {\n      continue;\n    }\n    childTopN.dataset.level = String(i); // count upwards\n    childTopN.classList.toggle(cssClass('agg-compress'), isShowAll);\n    childTopN.title = isShowAll ? `Show Top ${provider.getShowTopN()} Only` : 'Show All';\n    childTopN.onclick = (evt) => {\n      preventDefault(evt);\n      col.setAggregated(\n        parent.group,\n        state === EAggregationState.EXPAND ? EAggregationState.EXPAND_TOP_N : EAggregationState.EXPAND\n      );\n    };\n  }\n}\n\nfunction isDummyGroup(group: IGroup) {\n  return group.parent == null && group.name === defaultGroup.name;\n}\n\nexport default class AggregateGroupRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column): boolean {\n    return col instanceof AggregateGroupColumn;\n  }\n\n  create(col: AggregateGroupColumn, context: IRenderContext): ICellRenderer {\n    return {\n      template: `<div></div>`,\n      update(node: HTMLElement, _row: IDataRow, i: number, group: IOrderedGroup) {\n        if (isDummyGroup(group)) {\n          clear(node);\n          return;\n        }\n        renderGroups(node, group, i, col, context.provider);\n      },\n      render(ctx: CanvasRenderingContext2D, _row: IDataRow, i: number, group: IOrderedGroup) {\n        if (isDummyGroup(group)) {\n          return undefined;\n        }\n        const parents = groupParents(\n          group,\n          toItemMeta(i, group, context.provider.getTopNAggregated(col.findMyRanker()!, group))\n        );\n        ctx.fillStyle = AGGREGATE.color;\n        for (let i = 0; i < parents.length; ++i) {\n          ctx.fillRect(AGGREGATE.levelWidth * i + AGGREGATE.levelOffset, 0, AGGREGATE.strokeWidth, CANVAS_HEIGHT);\n        }\n        return parents.some((d) => d.meta != null);\n      },\n    };\n  }\n\n  createGroup(col: AggregateGroupColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div><div class=\"${cssClass('agg-level')}\"></div></div>`,\n      update(node: HTMLElement, group: IOrderedGroup) {\n        renderGroups(node, group, -1, col, context.provider);\n      },\n    };\n  }\n\n  createSummary(col: AggregateGroupColumn, context: IRenderContext): ISummaryRenderer {\n    return {\n      template: `<div></div>`,\n      update: (node: HTMLElement) => {\n        const ranking = col.findMyRanker()!;\n        const groups = ranking.getGroups();\n        if (groups.length === 1 && groups[0].name === defaultGroup.name) {\n          clear(node);\n          return;\n        }\n\n        const gparents = groups.map((group) => groupParents(group, 'first last'));\n\n        const max = gparents.reduce((a, b) => Math.max(a, b.length), Number.NEGATIVE_INFINITY);\n        const children = matchNodes(node, max, 'agg-expand');\n\n        for (let i = 0; i < max; ++i) {\n          const child = children[i];\n          const subGroups = gparents.map((d) => (d[i] ? d[i].group : null)).filter((d) => d != null) as IOrderedGroup[];\n\n          const isCollapsed = subGroups.every(\n            (d) => context.provider.getAggregationState(ranking, d) === EAggregationState.COLLAPSE\n          );\n\n          child.classList.toggle(cssClass('agg-collapse'), isCollapsed);\n          child.title = isCollapsed ? 'Expand All Groups' : 'Collapse All Groups';\n\n          child.onclick = (evt) => {\n            preventDefault(evt);\n            context.provider.aggregateAllOf(\n              ranking,\n              isCollapsed ? EAggregationState.EXPAND : EAggregationState.COLLAPSE,\n              subGroups\n            );\n          };\n        }\n      },\n    };\n  }\n}\n","import { cssClass } from '../styles';\n\n/** @internal */\nexport const filterMissingText = 'Filter rows containing missing values';\n\n/** @internal */\nexport function filterMissingMarkup(bakMissing: boolean) {\n  return `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''}>\n    <span class=\"${cssClass('filter-missing')}\">${filterMissingText}</span>\n  </label>`;\n}\n\n/** @internal */\nexport function filterMissingNumberMarkup(bakMissing: boolean, count: number) {\n  return `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''} ${count === 0 ? 'disabled' : ''}>\n    <span class=\"${cssClass('filter-missing')} ${\n    count === 0 ? cssClass('disabled') : ''\n  }\">Filter ${count} missing value rows</span>\n  </label>`;\n}\n\n/** @internal */\nexport function findFilterMissing(node: HTMLElement) {\n  return (node.getElementsByClassName(cssClass('filter-missing'))[0]! as HTMLElement)\n    .previousElementSibling! as HTMLInputElement;\n}\n\n/** @internal */\nexport function updateFilterMissingNumberMarkup(element: HTMLElement, count: number) {\n  const checked = element.getElementsByTagName('input')![0];\n  checked.disabled = count === 0;\n  element.lastElementChild!.classList.toggle(cssClass('disabled'), count === 0);\n  element.lastElementChild!.textContent = `Filter ${count} missing value rows`;\n}\n","import { Column, IDataRow, isMissingValue } from '../model';\nimport { CANVAS_HEIGHT, DASH, cssClass } from '../styles';\n\nexport function renderMissingValue(ctx: CanvasRenderingContext2D, width: number, height: number, x = 0, y = 0) {\n  const dashX = Math.max(0, x + (width - DASH.width) / 2); // center horizontally\n  const dashY = Math.max(0, y + (height - DASH.height) / 2); // center vertically\n  ctx.fillStyle = DASH.color;\n  ctx.fillRect(dashX, dashY, Math.min(width, DASH.width), Math.min(height, DASH.height));\n}\n\nexport function renderMissingDOM(node: HTMLElement, col: Column, d: IDataRow) {\n  const missing = isMissingValue(col.getValue(d));\n  node.classList.toggle(cssClass('missing'), missing);\n  return missing;\n}\n\nexport function renderMissingCanvas(\n  ctx: CanvasRenderingContext2D,\n  col: Column,\n  d: IDataRow,\n  width: number,\n  x = 0,\n  y = 0\n) {\n  const missing = isMissingValue(col.getValue(d));\n  if (missing) {\n    renderMissingValue(ctx, width, CANVAS_HEIGHT, x, y);\n  }\n  return missing;\n}\n","import { StringColumn, Column, IDataRow, IOrderedGroup, IStringFilter } from '../model';\nimport { filterMissingMarkup, findFilterMissing } from '../ui/missing';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { setText, exampleText } from './utils';\nimport { cssClass } from '../styles';\nimport { debounce } from '../internal';\n\n/**\n * renders a string with additional alignment behavior\n * one instance factory shared among strings\n */\nexport default class StringCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column): boolean {\n    return col instanceof StringColumn;\n  }\n\n  create(col: StringColumn): ICellRenderer {\n    const align = col.alignment || 'left';\n    return {\n      template: `<div${align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''}> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        if (col.escape) {\n          setText(n, col.getLabel(d));\n        } else {\n          n.innerHTML = col.getLabel(d);\n        }\n        n.title = n.textContent!;\n      },\n    };\n  }\n\n  createGroup(col: StringColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupExampleRows(col, group, 'string', (rows) => exampleText(col, rows))\n          .then((text) => {\n            if (typeof text === 'symbol') {\n              return;\n            }\n            n.classList.toggle(cssClass('missing'), !text);\n            if (col.escape) {\n              setText(n, text);\n            } else {\n              n.innerHTML = text;\n              n.title = text;\n            }\n          });\n      },\n    };\n  }\n\n  private static interactiveSummary(col: StringColumn, node: HTMLElement) {\n    const form = node as HTMLFormElement;\n    const filterMissing = findFilterMissing(node);\n    const input = node.querySelector<HTMLInputElement>('input[type=\"text\"]');\n    const isRegex = node.querySelector<HTMLInputElement>('input[type=\"checkbox\"]');\n\n    const update = () => {\n      const valid = input.value.trim();\n      if (valid.length <= 0) {\n        const filter = filterMissing.checked ? { filter: null, filterMissing: filterMissing.checked } : null;\n        col.setFilter(filter);\n        return;\n      }\n      col.setFilter({\n        filter: isRegex.checked ? new RegExp(input.value) : input.value,\n        filterMissing: filterMissing.checked,\n      });\n    };\n\n    filterMissing.onchange = update;\n    input.onchange = update;\n    input.oninput = debounce(update, 100);\n    isRegex.onchange = update;\n    form.onsubmit = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      update();\n      return false;\n    };\n\n    return (actCol: StringColumn) => {\n      col = actCol;\n      const f = col.getFilter() || { filter: null, filterMissing: false };\n      const bak = f.filter;\n      filterMissing.checked = f.filterMissing;\n      input.value = bak instanceof RegExp ? bak.source : bak || '';\n      isRegex.checked = bak instanceof RegExp;\n    };\n  }\n\n  createSummary(col: StringColumn, _context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    if (!interactive) {\n      return {\n        template: `<div></div>`,\n        update: (node: HTMLElement) => {\n          const filter = col.getFilter();\n          node.textContent = toString(filter);\n        },\n      };\n    }\n    const f = col.getFilter() || { filter: null, filterMissing: false };\n    const bak = f.filter || '';\n    let update: (col: StringColumn) => void;\n    return {\n      template: `<form><input type=\"text\" placeholder=\"Filter ${col.desc.label}...\" autofocus value=\"${\n        bak instanceof RegExp ? bak.source : bak\n      }\">\n          <label class=\"${cssClass('checkbox')}\">\n            <input type=\"checkbox\" ${bak instanceof RegExp ? 'checked=\"checked\"' : ''}>\n            <span>Use regular expressions</span>\n          </label>\n          ${filterMissingMarkup(f.filterMissing)}</form>`,\n      update: (node: HTMLElement) => {\n        if (!update) {\n          update = StringCellRenderer.interactiveSummary(col, node);\n        }\n        update(col);\n      },\n    };\n  }\n}\n\nfunction toString(filter: IStringFilter | null) {\n  if (filter == null || !filter.filter) {\n    return '';\n  }\n  if (filter.filter instanceof RegExp) {\n    return filter.filter.source;\n  }\n  return filter.filter;\n}\n","import { IDataRow, AnnotateColumn, Column } from '../model';\nimport StringCellRenderer from './StringCellRenderer';\nimport { cssClass } from '../styles';\nimport type { ICellRenderer } from './interfaces';\n\nexport default class AnnotationRenderer extends StringCellRenderer {\n  readonly title: string = 'Default';\n\n  canRender(col: Column) {\n    return super.canRender(col) && col instanceof AnnotateColumn;\n  }\n\n  create(col: AnnotateColumn): ICellRenderer {\n    return {\n      template: `<div>\n        <span></span>\n        <input class=\"${cssClass('hover-only')} ${cssClass('annotate-input')}\">\n       </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const label = n.firstElementChild! as HTMLElement;\n        const input = n.lastElementChild! as HTMLInputElement;\n        input.onchange = () => {\n          label.textContent = input.value;\n          col.setValue(d, input.value);\n        };\n        input.onclick = (event) => {\n          event.stopPropagation();\n        };\n        label.textContent = input.value = col.getLabel(d);\n      },\n    };\n  }\n}\n","import { Column, isMapAbleColumn, IDataRow, DEFAULT_COLOR } from '../model';\nimport type { IImposer } from './interfaces';\n\nexport function colorOf(col: Column, row: IDataRow | null, imposer?: IImposer, valueHint?: number) {\n  if (imposer && imposer.color) {\n    return imposer.color(row, valueHint);\n  }\n  if (!row) {\n    if (isMapAbleColumn(col)) {\n      return col.getColorMapping().apply(valueHint != null ? valueHint : 0);\n    }\n    return DEFAULT_COLOR;\n  }\n  return col.getColor(row);\n}\n","import { round } from '../internal';\nimport { Column, isNumbersColumn, IDataRow, INumberColumn, isNumberColumn, DEFAULT_COLOR } from '../model';\nimport { setText, adaptDynamicColorToBgColor, noRenderer } from './utils';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\n\nexport default class BarCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Bar';\n\n  /**\n   * flag to always render the value\n   * @type {boolean}\n   */\n\n  constructor(private readonly renderValue: boolean = false) {}\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return mode === ERenderMode.CELL && isNumberColumn(col) && !isNumbersColumn(col);\n  }\n\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = context.colWidth(col);\n    return {\n      template: `<div title=\"\">\n          <div class=\"${cssClass('bar-label')}\" style='background-color: ${DEFAULT_COLOR}'>\n            <span ${this.renderValue ? '' : `class=\"${cssClass('hover-only')}\"`}></span>\n          </div>\n        </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        const value = col.getNumber(d);\n        const missing = renderMissingDOM(n, col, d);\n        const w = Number.isNaN(value) ? 0 : round(value * 100, 2);\n        const title = col.getLabel(d);\n        n.title = title;\n\n        const bar = n.firstElementChild! as HTMLElement;\n        bar.style.width = missing ? '100%' : `${w}%`;\n        const color = colorOf(col, d, imposer, value);\n        bar.style.backgroundColor = missing ? null : color;\n        setText(bar.firstElementChild!, title);\n        const item = bar.firstElementChild! as HTMLElement;\n        setText(item, title);\n        adaptDynamicColorToBgColor(item, color || DEFAULT_COLOR, title, w / 100);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        const value = col.getNumber(d);\n        ctx.fillStyle = colorOf(col, d, imposer, value) || DEFAULT_COLOR;\n        const w = width * value;\n        ctx.fillRect(0, 0, Number.isNaN(w) ? 0 : w, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { Column, IDataRow } from '../model';\nimport type {\n  ERenderMode,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\n\n/**\n * default renderer instance rendering the value as a text\n */\nexport class DefaultCellRenderer implements ICellRendererFactory {\n  title = 'String';\n  groupTitle = 'None';\n  summaryTitle = 'None';\n\n  canRender(_col: Column, _mode: ERenderMode): boolean {\n    return true;\n  }\n\n  create(col: Column): ICellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const l = col.getLabel(d);\n        setText(n, l);\n        n.title = l;\n      },\n    };\n  }\n\n  createGroup(_col: Column): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, BooleanColumn } from '../model';\nimport { DefaultCellRenderer } from './DefaultCellRenderer';\nimport { ERenderMode, ICellRenderer } from './interfaces';\nimport { cssClass } from '../styles';\n\nexport default class BooleanCellRenderer extends DefaultCellRenderer {\n  readonly title: string = 'Default';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof BooleanColumn && mode === ERenderMode.CELL;\n  }\n\n  create(col: Column): ICellRenderer {\n    const r = super.create(col);\n    (r as any).template = `<div class=\"${cssClass('center')}\"> </div>`;\n    return r;\n  }\n}\n","import { IBoxPlotData, IAdvancedBoxPlotData, round } from '../internal';\nimport {\n  NumberColumn,\n  IBoxPlotColumn,\n  INumberColumn,\n  isBoxPlotColumn,\n  Column,\n  IDataRow,\n  isNumberColumn,\n  isMapAbleColumn,\n  IOrderedGroup,\n} from '../model';\nimport { BOX_PLOT, CANVAS_HEIGHT, DOT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas } from './missing';\nimport { tasksAll } from '../provider';\n\nconst BOXPLOT = `<div title=\"\">\n  <div class=\"${cssClass('boxplot-whisker')}\">\n    <div class=\"${cssClass('boxplot-box')}\"></div>\n    <div class=\"${cssClass('boxplot-median')}\"></div>\n    <div class=\"${cssClass('boxplot-mean')}\"></div>\n  </div>\n</div>`;\n\nconst MAPPED_BOXPLOT = `<div title=\"\">\n  <div class=\"${cssClass('boxplot-whisker')}\">\n    <div class=\"${cssClass('boxplot-box')}\"></div>\n    <div class=\"${cssClass('boxplot-median')}\"></div>\n    <div class=\"${cssClass('boxplot-mean')}\"></div>\n  </div>\n  <span class=\"${cssClass('mapping-hint')}\"></span><span class=\"${cssClass('mapping-hint')}\"></span>\n</div>`;\n\n/** @internal */\nexport function computeLabel(col: INumberColumn, v: IBoxPlotData | IAdvancedBoxPlotData) {\n  if (v == null) {\n    return '';\n  }\n  const f = col.getNumberFormat();\n  const mean =\n    (v as IAdvancedBoxPlotData).mean != null ? `mean = ${f((v as IAdvancedBoxPlotData).mean)} (dashed line)\\n` : '';\n  return `min = ${f(v.min)}\\nq1 = ${f(v.q1)}\\nmedian = ${f(v.median)}\\n${mean}q3 = ${f(v.q3)}\\nmax = ${f(v.max)}`;\n}\n\nexport default class BoxplotCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Box Plot';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (isBoxPlotColumn(col) && mode === ERenderMode.CELL) || (isNumberColumn(col) && mode !== ERenderMode.CELL);\n  }\n\n  create(col: IBoxPlotColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const sortMethod = col.getSortMethod() as keyof IBoxPlotData;\n    const sortedByMe = col.isSortedByMe().asc !== undefined;\n    const width = context.colWidth(col);\n    return {\n      template: BOXPLOT,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const data = col.getBoxPlotData(d);\n        n.classList.toggle(cssClass('missing'), !data);\n        if (!data) {\n          return;\n        }\n        const label = col.getRawBoxPlotData(d)!;\n        renderDOMBoxPlot(col, n, data!, label, sortedByMe ? sortMethod : '', colorOf(col, d, imposer));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n\n        // Rectangle\n        const data = col.getBoxPlotData(d);\n        if (!data) {\n          return;\n        }\n\n        const scaled = {\n          min: data.min * width,\n          median: data.median * width,\n          mean: (data as IAdvancedBoxPlotData).mean != null ? (data as IAdvancedBoxPlotData).mean * width : undefined,\n          q1: data.q1 * width,\n          q3: data.q3 * width,\n          max: data.max * width,\n          outlier: data.outlier ? data.outlier.map((d) => d * width) : undefined,\n          whiskerLow: data.whiskerLow != null ? data.whiskerLow * width : undefined,\n          whiskerHigh: data.whiskerHigh != null ? data.whiskerHigh * width : undefined,\n        };\n        renderBoxPlot(ctx, scaled, sortedByMe ? sortMethod : '', colorOf(col, d, imposer), CANVAS_HEIGHT, 0);\n      },\n    };\n  }\n\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const sort = col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined ? col.getSortMethod() : '';\n    return {\n      template: BOXPLOT,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return tasksAll([\n          context.tasks.groupBoxPlotStats(col, group, false),\n          context.tasks.groupBoxPlotStats(col, group, true),\n        ]).then((data) => {\n          if (typeof data === 'symbol') {\n            return;\n          }\n          // render\n          const isMissing =\n            data == null ||\n            data[0] == null ||\n            data[0].group.count === 0 ||\n            data[0].group.count === data[0].group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          renderDOMBoxPlot(col, n, data[0].group, data[1].group, sort, colorOf(col, null, imposer));\n        });\n      },\n    };\n  }\n\n  createSummary(\n    col: INumberColumn,\n    context: IRenderContext,\n    _interactive: boolean,\n    imposer?: IImposer\n  ): ISummaryRenderer {\n    return {\n      template: isMapAbleColumn(col) ? MAPPED_BOXPLOT : BOXPLOT,\n      update: (n: HTMLElement) => {\n        return tasksAll([\n          context.tasks.summaryBoxPlotStats(col, false),\n          context.tasks.summaryBoxPlotStats(col, true),\n        ]).then((data) => {\n          if (typeof data === 'symbol') {\n            return;\n          }\n          const isMissing =\n            data == null ||\n            data[0] == null ||\n            data[0].summary.count === 0 ||\n            data[0].summary.count === data[0].summary.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          const mappedSummary = data[0].summary;\n          const rawSummary = data[1].summary;\n          const sort =\n            col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined ? col.getSortMethod() : '';\n\n          if (isMapAbleColumn(col)) {\n            const range = col.getRange();\n            Array.from(n.getElementsByTagName('span')).forEach((d: HTMLElement, i) => (d.textContent = range[i]));\n          }\n\n          renderDOMBoxPlot(col, n, mappedSummary, rawSummary, sort, colorOf(col, null, imposer), isMapAbleColumn(col));\n        });\n      },\n    };\n  }\n}\n\nfunction renderDOMBoxPlot(\n  col: INumberColumn,\n  n: HTMLElement,\n  data: IBoxPlotData | IAdvancedBoxPlotData,\n  label: IBoxPlotData | IAdvancedBoxPlotData,\n  sort: string,\n  color: string | null,\n  hasRange = false\n) {\n  n.title = computeLabel(col, label);\n\n  const whiskers = n.firstElementChild as HTMLElement;\n  const box = whiskers.firstElementChild as HTMLElement;\n  const median = box.nextElementSibling as HTMLElement;\n  const mean = whiskers.lastElementChild as HTMLElement;\n\n  const leftWhisker =\n    data.whiskerLow != null ? data.whiskerLow : Math.max(data.q1 - 1.5 * (data.q3 - data.q1), data.min);\n  const rightWhisker =\n    data.whiskerHigh != null ? data.whiskerHigh : Math.min(data.q3 + 1.5 * (data.q3 - data.q1), data.max);\n  whiskers.style.left = `${round(leftWhisker * 100, 2)}%`;\n  const range = rightWhisker - leftWhisker;\n  whiskers.style.width = `${round(range * 100, 2)}%`;\n\n  //relative within the whiskers\n  box.style.left = `${round(((data.q1 - leftWhisker) / range) * 100, 2)}%`;\n  box.style.width = `${round(((data.q3 - data.q1) / range) * 100, 2)}%`;\n  box.style.backgroundColor = color;\n\n  //relative within the whiskers\n  median.style.left = `${round(((data.median - leftWhisker) / range) * 100, 2)}%`;\n  if ((data as IAdvancedBoxPlotData).mean != null) {\n    mean.style.left = `${round((((data as IAdvancedBoxPlotData).mean - leftWhisker) / range) * 100, 2)}%`;\n    mean.style.display = null;\n  } else {\n    mean.style.display = 'none';\n  }\n\n  // match lengths\n  const outliers = Array.from(n.children).slice(1, hasRange ? -2 : undefined) as HTMLElement[];\n  const numOutliers = data.outlier ? data.outlier.length : 0;\n  outliers.splice(numOutliers, outliers.length - numOutliers).forEach((v) => v.remove());\n\n  whiskers.dataset.sort = sort;\n\n  if (!data.outlier || numOutliers === 0) {\n    return;\n  }\n\n  for (let i = outliers.length; i < numOutliers; ++i) {\n    const p = n.ownerDocument!.createElement('div');\n    p.classList.add(cssClass('boxplot-outlier'));\n    outliers.unshift(p);\n    whiskers.insertAdjacentElement('afterend', p);\n  }\n  data.outlier.forEach((v, i) => {\n    delete outliers[i].dataset.sort;\n    outliers[i].style.left = `${round(v * 100, 2)}%`;\n  });\n\n  if (sort === 'min' && data.outlier[0] <= leftWhisker) {\n    // first outliers is the min\n    whiskers.dataset.sort = '';\n    outliers[0].dataset.sort = 'min';\n    if (outliers.length > 1) {\n      // append at the end of the DOM to be on top\n      outliers[outliers.length - 1].insertAdjacentElement('afterend', outliers[0]);\n    }\n  } else if (sort === 'max' && data.outlier[outliers.length - 1] >= rightWhisker) {\n    // last outlier is the max\n    whiskers.dataset.sort = '';\n    outliers[outliers.length - 1].dataset.sort = 'max';\n  }\n}\n\nfunction renderBoxPlot(\n  ctx: CanvasRenderingContext2D,\n  box: IBoxPlotData,\n  sort: string,\n  color: string | null,\n  height: number,\n  topPadding: number\n) {\n  const left = box.whiskerLow != null ? box.whiskerLow : Math.max(box.q1 - 1.5 * (box.q3 - box.q1), box.min);\n  const right = box.whiskerHigh != null ? box.whiskerHigh : Math.min(box.q3 + 1.5 * (box.q3 - box.q1), box.max);\n\n  ctx.fillStyle = color || BOX_PLOT.box;\n  ctx.strokeStyle = BOX_PLOT.stroke;\n  ctx.beginPath();\n  ctx.rect(box.q1, 0, box.q3 - box.q1, height);\n  ctx.fill();\n  ctx.stroke();\n\n  //Line\n  const bottomPos = height - topPadding;\n  const middlePos = height / 2;\n\n  ctx.beginPath();\n  ctx.moveTo(left, middlePos);\n  ctx.lineTo(box.q1, middlePos);\n  ctx.moveTo(left, topPadding);\n  ctx.lineTo(left, bottomPos);\n  ctx.moveTo(box.median, 0);\n  ctx.lineTo(box.median, height);\n  ctx.moveTo(box.q3, middlePos);\n  ctx.lineTo(right, middlePos);\n  ctx.moveTo(right, topPadding);\n  ctx.lineTo(right, bottomPos);\n  ctx.stroke();\n  ctx.fill();\n\n  if (sort !== '') {\n    ctx.strokeStyle = BOX_PLOT.sort;\n    ctx.beginPath();\n    ctx.moveTo(box[sort as keyof IBoxPlotData] as number, topPadding);\n    ctx.lineTo(box[sort as keyof IBoxPlotData] as number, height - topPadding);\n    ctx.stroke();\n    ctx.fill();\n  }\n\n  if (!box.outlier) {\n    return;\n  }\n  ctx.fillStyle = BOX_PLOT.outlier;\n  box.outlier.forEach((v) => {\n    // currently dots with 3px\n    ctx.fillRect(Math.max(v - DOT.size / 2, 0), middlePos - DOT.size / 2, DOT.size, DOT.size);\n  });\n}\n","import { hsl } from 'd3-color';\nimport {\n  Column,\n  isNumbersColumn,\n  IDataRow,\n  INumberColumn,\n  isNumberColumn,\n  isMapAbleColumn,\n  DEFAULT_COLOR,\n  SolidColorFunction,\n} from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\n\nexport function toHeatMapColor(v: number | null, row: IDataRow, col: INumberColumn, imposer?: IImposer) {\n  if (v == null || Number.isNaN(v)) {\n    v = 1; // max = brightest\n  }\n  if (imposer || !isMapAbleColumn(col)) {\n    //hsl space encoding, encode in lightness\n    const color = hsl(colorOf(col, row, imposer, v) || DEFAULT_COLOR);\n    color.l = 1 - v; // largest value = darkest color\n    return color.toString();\n  }\n  const map = col.getColorMapping();\n  const valueColor = map.apply(v);\n  if (map instanceof SolidColorFunction) {\n    //hsl space encoding, encode in lightness\n    const color = hsl(valueColor);\n    color.l = 1 - v; // largest value = darkest color\n    return color.toString();\n  }\n  // some custom logic that maps to another value\n  return valueColor;\n}\n\nexport default class BrightnessCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Brightness';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\n  }\n\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = context.colWidth(col);\n    return {\n      template: `<div title=\"\">\n        <div class=\"${cssClass('cat-color')}\" style=\"background-color: ${DEFAULT_COLOR}\"></div><div class=\"${cssClass(\n        'cat-label'\n      )}\"> </div>\n      </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const missing = renderMissingDOM(n, col, d);\n        n.title = col.getLabel(d);\n        (n.firstElementChild! as HTMLDivElement).style.backgroundColor = missing\n          ? null\n          : toHeatMapColor(col.getNumber(d), d, col, imposer);\n        setText(n.lastElementChild!, n.title);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        ctx.fillStyle = toHeatMapColor(col.getNumber(d), d, col, imposer);\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { DENSE_HISTOGRAM } from '../constants';\nimport { ICategoricalStatistics, round } from '../internal';\nimport {\n  OrdinalColumn,\n  isCategoricalColumn,\n  isCategoricalLikeColumn,\n  ICategoricalLikeColumn,\n  ICategory,\n  Column,\n  CategoricalColumn,\n  ICategoricalColumn,\n  IDataRow,\n  IOrderedGroup,\n  SetColumn,\n  BooleanColumn,\n} from '../model';\nimport { CANVAS_HEIGHT, cssClass, FILTERED_OPACITY } from '../styles';\nimport { filterMissingNumberMarkup, updateFilterMissingNumberMarkup } from '../ui/missing';\nimport {\n  IRenderContext,\n  ICellRendererFactory,\n  ERenderMode,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { setText, wideEnough, forEach } from './utils';\nimport { color } from 'd3-color';\n\n/** @internal */\nexport declare type HasCategoricalFilter = CategoricalColumn | OrdinalColumn | SetColumn | BooleanColumn;\n\nexport default class CategoricalCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Color';\n  readonly groupTitle: string = 'Histogram';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isCategoricalLikeColumn(col) && (mode !== ERenderMode.CELL || isCategoricalColumn(col));\n  }\n\n  create(col: ICategoricalColumn, context: IRenderContext): ICellRenderer {\n    const width = context.colWidth(col);\n    return {\n      template: `<div>\n        <div class=\"${cssClass('cat-color')}\"></div><div class=\"${cssClass('cat-label')}\"></div>\n      </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const v = col.getCategory(d);\n        (n.firstElementChild! as HTMLDivElement).style.backgroundColor = v ? col.getColor(d) : null;\n        setText(n.lastElementChild! as HTMLSpanElement, col.getLabel(d));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        const v = col.getCategory(d);\n        ctx.fillStyle = v ? col.getColor(d) : '';\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(col: ICategoricalLikeColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, update } = hist(col, false);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          update(n, r.group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalLikeColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    return col instanceof CategoricalColumn ||\n      col instanceof OrdinalColumn ||\n      col instanceof SetColumn ||\n      col instanceof BooleanColumn\n      ? interactiveSummary(col, context, interactive)\n      : staticSummary(col, context, interactive);\n  }\n}\n\nfunction staticSummary(col: ICategoricalLikeColumn, context: IRenderContext, interactive: boolean) {\n  const { template, update } = hist(col, interactive);\n  return {\n    template: `${template}</div>`,\n    update: (n: HTMLElement) => {\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, r.summary);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(col: HasCategoricalFilter, context: IRenderContext, interactive: boolean) {\n  const { template, update } = hist(col, interactive || wideEnough(col));\n  let filterUpdate: (missing: number, col: HasCategoricalFilter) => void;\n  return {\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0) : ''}</div>`,\n    update: (n: HTMLElement) => {\n      n.classList.toggle(cssClass('histogram-i'), interactive);\n\n      if (!filterUpdate) {\n        filterUpdate = interactiveHist(col, n);\n      }\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n        filterUpdate(interactive && data ? data.missing : summary ? summary.missing : 0, col);\n\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, summary, interactive ? data : undefined);\n      });\n    },\n  };\n}\n\nfunction hist(col: ICategoricalLikeColumn, showLabels: boolean) {\n  const mapping = col.getColorMapping();\n  const bins = col.categories\n    .map(\n      (c) =>\n        `<div class=\"${cssClass('histogram-bin')}\" title=\"${c.label}: 0\" data-cat=\"${c.name}\" ${\n          showLabels ? `data-title=\"${c.label}\"` : ''\n        }><div style=\"height: 0; background-color: ${mapping.apply(c)}\"></div></div>`\n    )\n    .join('');\n  const template = `<div class=\"${cssClass('histogram')} ${\n    col.categories.length! > DENSE_HISTOGRAM ? cssClass('dense') : ''\n  }\">${bins}`; // no closing div to be able to append things\n\n  return {\n    template,\n    update: (n: HTMLElement, hist: ICategoricalStatistics, gHist?: ICategoricalStatistics) => {\n      const mapping = col.getColorMapping();\n\n      const selected = col.categories.map((d) => {\n        const c = color(mapping.apply(d))!;\n        c.opacity = FILTERED_OPACITY;\n        return c.toString();\n      });\n\n      const maxBin = gHist ? gHist.maxBin : hist.maxBin;\n      forEach(n, '[data-cat]', (d: HTMLElement, i) => {\n        const cat = col.categories[i];\n        const { count } = hist.hist[i];\n        const inner = d.firstElementChild! as HTMLElement;\n        if (gHist) {\n          const { count: gCount } = gHist.hist[i];\n          d.title = `${cat.label}: ${count} of ${gCount}`;\n          inner.style.height = `${round((gCount * 100) / maxBin, 2)}%`;\n          const relY = 100 - round((count * 100) / gCount, 2);\n          inner.style.background =\n            relY === 0\n              ? mapping.apply(cat)\n              : relY === 100\n              ? selected[i]\n              : `linear-gradient(${selected[i]} ${relY}%, ${mapping.apply(cat)} ${relY}%, ${mapping.apply(cat)} 100%)`;\n        } else {\n          d.title = `${col.categories[i].label}: ${count}`;\n          const inner = d.firstElementChild! as HTMLElement;\n          inner.style.height = `${Math.round((count * 100) / maxBin)}%`;\n          inner.style.background = mapping.apply(cat);\n        }\n      });\n    },\n  };\n}\n\nfunction setCategoricalFilter(col: HasCategoricalFilter, filter: string | RegExp | string[], filterMissing: boolean) {\n  if (col instanceof SetColumn) {\n    const f = col.getFilter();\n    const mode = f ? f.mode : undefined;\n    col.setFilter({\n      filter,\n      filterMissing,\n      mode,\n    });\n  } else {\n    col.setFilter({\n      filter,\n      filterMissing,\n    });\n  }\n}\n\n/** @internal */\nexport function interactiveHist(col: HasCategoricalFilter, node: HTMLElement) {\n  const bins = Array.from(node.querySelectorAll<HTMLElement>('[data-cat]'));\n\n  const markFilter = (bin: HTMLElement, cat: ICategory, value: boolean) => {\n    // update filter highlight eagerly for better user feedback\n    const inner = bin.firstElementChild! as HTMLElement;\n    const base = col.getColorMapping().apply(cat);\n    if (value) {\n      inner.style.background = base;\n      return;\n    }\n    const c = color(base)!;\n    c.opacity = FILTERED_OPACITY;\n    inner.style.background = c.toString();\n  };\n\n  bins.forEach((bin, i) => {\n    const cat = col.categories[i];\n\n    bin.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      // toggle filter\n      const old = col.getFilter();\n      if (old == null || !Array.isArray(old.filter)) {\n        // deselect\n        markFilter(bin, cat, false);\n        const included = col.categories.slice();\n        included.splice(i, 1);\n        setCategoricalFilter(\n          col,\n          included.map((d) => d.name),\n          old ? old.filterMissing : false\n        );\n        return;\n      }\n      const filter = old.filter.slice();\n      const contained = filter.indexOf(cat.name);\n      if (contained >= 0) {\n        // remove\n        filter.splice(contained, 1);\n        markFilter(bin, cat, false);\n      } else {\n        // readd\n        filter.push(cat.name);\n        markFilter(bin, cat, true);\n      }\n      if (!old.filterMissing && filter.length === col.categories.length) {\n        // dummy filter\n        col.setFilter(null);\n        return;\n      }\n      setCategoricalFilter(col, filter, old.filterMissing);\n    };\n  });\n\n  const filterMissing = node.getElementsByTagName('input')[0]!;\n\n  if (filterMissing) {\n    filterMissing.onchange = () => {\n      // toggle filter\n      const v = filterMissing.checked;\n      const old = col.getFilter();\n      if (old == null) {\n        if (v) {\n          setCategoricalFilter(\n            col,\n            col.categories.map((d) => d.name),\n            v\n          );\n        } else {\n          col.setFilter(null);\n        }\n      } else if (!v && Array.isArray(old.filter) && old.filter.length === col.categories.length) {\n        // dummy\n        col.setFilter(null);\n      } else {\n        setCategoricalFilter(col, old.filter, v);\n      }\n    };\n  }\n\n  return (missing: number, actCol: HasCategoricalFilter) => {\n    col = actCol;\n    const f = col.getFilter();\n    if (filterMissing) {\n      filterMissing.checked = f != null && f.filterMissing;\n      updateFilterMissingNumberMarkup(filterMissing.parentElement, missing);\n    }\n  };\n}\n","import { Column, ICategoricalsColumn, ICategory, IDataRow, IOrderedGroup, isCategoricalsColumn } from '../model';\nimport { toMostFrequentCategoricals } from '../model/internalCategorical';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport type {\n  ICellRendererFactory,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingDOM, renderMissingValue } from './missing';\nimport { noop, wideEnough } from './utils';\nimport { GUESSED_ROW_HEIGHT } from '../constants';\n\nexport default class CategoricalHeatmapCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Heatmap';\n\n  canRender(col: Column): boolean {\n    return isCategoricalsColumn(col) && Boolean(col.dataLength);\n  }\n\n  private createContext(col: ICategoricalsColumn, context: IRenderContext) {\n    const width = context.colWidth(col);\n    const cellDimension = width / col.dataLength!;\n    const labels = col.labels;\n    const render = (ctx: CanvasRenderingContext2D, data: (ICategory | null)[], height: number) => {\n      data.forEach((d: ICategory | null, j: number) => {\n        const x = j * cellDimension;\n        if (d == null) {\n          renderMissingValue(ctx, cellDimension, height, x, 0);\n          return;\n        }\n        ctx.fillStyle = d.color;\n        ctx.fillRect(x, 0, cellDimension, height);\n      });\n    };\n    return {\n      template: `<canvas height=\"${GUESSED_ROW_HEIGHT}\" title=\"\"></canvas>`,\n      render,\n      width,\n      mover: (n: HTMLElement, values: string[]) => (evt: MouseEvent) => {\n        const percent = evt.offsetX / width;\n        const index = Math.max(0, Math.min(col.dataLength! - 1, Math.floor(percent * (col.dataLength! - 1) + 0.5)));\n        n.title = `${labels[index]}: ${values[index]}`;\n      },\n    };\n  }\n\n  create(col: ICategoricalsColumn, context: IRenderContext): ICellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context);\n\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n        ctx.canvas.width = width;\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        n.onmousemove = mover(n, col.getLabels(d));\n        n.onmouseleave = () => (n.title = '');\n        render(ctx, col.getCategories(d), GUESSED_ROW_HEIGHT);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        render(ctx, col.getCategories(d), CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(col: ICategoricalsColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context);\n\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, this.title, (rows) => toMostFrequentCategoricals(rows, col))\n          .then((data) => {\n            if (typeof data === 'symbol') {\n              return;\n            }\n            const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n            ctx.canvas.width = width;\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n            const isMissing = !data || data.length === 0 || data.every((d) => d == null);\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n            n.onmousemove = mover(\n              n,\n              data.map((d) => (d ? d.label : 'missing'))\n            );\n            n.onmouseleave = () => (n.title = '');\n            render(ctx, data, GUESSED_ROW_HEIGHT);\n          });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalsColumn): ISummaryRenderer {\n    let labels = col.labels.slice();\n    while (labels.length > 0 && !wideEnough(col, labels.length)) {\n      labels = labels.filter((_, i) => i % 2 === 0); // even\n    }\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\n    for (const label of labels) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\"  title=\"${label}\" data-title=\"${label}\"></div>`;\n    }\n    templateRows += '</div>';\n    return {\n      template: templateRows,\n      update: noop,\n    };\n  }\n}\n","import { ICategoricalStatistics, round } from '../internal';\nimport {\n  CategoricalColumn,\n  Column,\n  OrdinalColumn,\n  ICategoricalColumn,\n  isCategoricalColumn,\n  IOrderedGroup,\n  ISetColumn,\n  DEFAULT_COLOR,\n} from '../model';\nimport { filterMissingNumberMarkup } from '../ui/missing';\nimport { interactiveHist, HasCategoricalFilter } from './CategoricalCellRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { noRenderer, adaptTextColorToBgColor } from './utils';\nimport { cssClass, FILTERED_OPACITY } from '../styles';\nimport { color } from 'd3-color';\n\nexport default class CategoricalStackedDistributionlCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Distribution Bar';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isCategoricalColumn(col) && mode !== ERenderMode.CELL;\n  }\n\n  create(): ICellRenderer {\n    return noRenderer;\n  }\n\n  createGroup(col: ICategoricalColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, update } = stackedBar(col);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          update(n, r.group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    return col instanceof CategoricalColumn || col instanceof OrdinalColumn\n      ? interactiveSummary(col, context, interactive)\n      : staticSummary(col, context);\n  }\n}\n\nfunction staticSummary(col: ICategoricalColumn, context: IRenderContext) {\n  const { template, update } = stackedBar(col);\n  return {\n    template: `${template}</div>`,\n    update: (n: HTMLElement) => {\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, r.summary, r.data);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(col: HasCategoricalFilter, context: IRenderContext, interactive: boolean) {\n  const { template, update } = stackedBar(col);\n  let filterUpdate: (missing: number, col: HasCategoricalFilter) => void;\n  return {\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0) : ''}</div>`,\n    update: (n: HTMLElement) => {\n      if (!filterUpdate) {\n        filterUpdate = interactiveHist(col, n);\n      }\n      return context.tasks.summaryCategoricalStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n\n        const missing = interactive && data ? data.missing : summary ? summary.missing : 0;\n        filterUpdate(missing, col);\n\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        n.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        update(n, summary, data);\n      });\n    },\n  };\n}\n\nfunction selectedCol(value: string) {\n  const c = color(value)!;\n  c.opacity = FILTERED_OPACITY;\n  return c.toString();\n}\n\nfunction stackedBar(col: ISetColumn) {\n  const mapping = col.getColorMapping();\n  const cats = col.categories.map((c) => ({\n    label: c.label,\n    name: c.name,\n    color: mapping.apply(c),\n    selected: selectedCol(mapping.apply(c)),\n  }));\n  cats.push({ label: 'Missing Values', name: 'missing', color: DEFAULT_COLOR, selected: 'transparent' });\n\n  const bins = cats\n    .map(\n      (c) =>\n        `<div class=\"${cssClass('distribution-bar')}\" style=\"background-color: ${\n          c.color\n        }; color: ${adaptTextColorToBgColor(c.color)}\" title=\"${c.label}: 0\" data-cat=\"${c.name}\"><span>${\n          c.label\n        }</span></div>`\n    )\n    .join('');\n\n  return {\n    template: `<div>${bins}`, // no closing div to be able to append things\n    update: (n: HTMLElement, hist: ICategoricalStatistics, gHist?: ICategoricalStatistics) => {\n      const bins: { count: number }[] = hist.hist.slice();\n      bins.push({ count: hist.missing });\n      const children = Array.from(n.children) as HTMLElement[];\n\n      if (!gHist) {\n        const total = bins.reduce((acc, { count }) => acc + count, 0);\n\n        for (let i = 0; i < cats.length; ++i) {\n          const d = children[i];\n          const count = bins[i].count;\n          const label = cats[i].label;\n          d.style.flexGrow = `${round(total === 0 ? 0 : count, 2)}`;\n          d.title = `${label}: ${count}`;\n        }\n        return;\n      }\n\n      const gBins: { count: number }[] = gHist.hist.slice();\n      gBins.push({ count: gHist.missing });\n      const total = gBins.reduce((acc, { count }) => acc + count, 9);\n\n      for (let i = 0; i < cats.length; ++i) {\n        const d = children[i];\n        const count = bins[i].count;\n        const label = cats[i].label;\n        const gCount = gBins[i].count;\n\n        d.style.flexGrow = `${round(total === 0 ? 0 : gCount, 2)}`;\n        d.title = `${label}: ${count} of ${gCount}`;\n        const relY = 100 - round((count * 100) / gCount, 2);\n        d.style.background =\n          relY === 0\n            ? cats[i].color\n            : relY === 100\n            ? cats[i].selected\n            : `linear-gradient(${cats[i].selected} ${relY}%, ${cats[i].color} ${relY}%, ${cats[i].color} 100%)`;\n      }\n    },\n  };\n}\n","import { Column, isNumbersColumn, IDataRow, INumberColumn, isNumberColumn } from '../model';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class CircleCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Proportional Symbol';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\n  }\n\n  create(col: INumberColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    return {\n      template: `<div style=\"background: radial-gradient(circle closest-side, red 100%, transparent 100%)\" title=\"\">\n              <div class=\"${cssClass('hover-only')} ${cssClass('bar-label')}\"></div>\n          </div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const v = col.getNumber(d);\n        const p = Math.round(v * 100);\n        const missing = renderMissingDOM(n, col, d);\n        n.style.background = missing\n          ? null\n          : `radial-gradient(circle closest-side, ${colorOf(col, d, imposer)} ${p}%, transparent ${p}%)`;\n        setText(n.firstElementChild!, col.getLabel(d));\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { GUESSES_GROUP_HEIGHT } from '../constants';\nimport { concatSeq, ISequence, round } from '../internal';\nimport {\n  Column,\n  DEFAULT_COLOR,\n  IDataRow,\n  INumberColumn,\n  IOrderedGroup,\n  isNumberColumn,\n  isNumbersColumn,\n} from '../model';\nimport { CANVAS_HEIGHT, DOT, cssClass } from '../styles';\nimport { colorOf } from './impose';\nimport {\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { noRenderer } from './utils';\n\nexport default class DotCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Dot';\n  readonly groupTitle: string = 'Dots';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumberColumn(col) && mode !== ERenderMode.SUMMARY;\n  }\n\n  private static getCanvasRenderer(col: INumberColumn, context: IRenderContext) {\n    const width = context.colWidth(col);\n    const pi2 = Math.PI * 2;\n    const radius = DOT.size / 2;\n    const render = (ctx: CanvasRenderingContext2D, vs: { value: number; color: string | null }[], width: number) => {\n      ctx.save();\n      ctx.globalAlpha = DOT.opacity;\n      for (const v of vs) {\n        ctx.fillStyle = v.color || DOT.color;\n        const x = Math.min(width - radius, Math.max(radius, v.value * width));\n        const y = round(Math.random() * (GUESSES_GROUP_HEIGHT - DOT.size) + radius, 2);\n        ctx.beginPath();\n        ctx.moveTo(x + radius, y);\n        ctx.arc(x, y, radius, 0, pi2, true);\n        ctx.fill();\n      }\n      ctx.restore();\n    };\n    return {\n      template: `<canvas height=\"${GUESSES_GROUP_HEIGHT}\"></canvas>`,\n      render,\n      width,\n    };\n  }\n\n  private static getDOMRenderer(col: INumberColumn) {\n    const dots = isNumbersColumn(col) ? col.dataLength! : 1;\n    let tmp = '';\n    for (let i = 0; i < dots; ++i) {\n      tmp += `<div style='background-color: ${DEFAULT_COLOR}' title=''></div>`;\n    }\n\n    const update = (n: HTMLElement, data: ISequence<{ value: number; label: string; color: string | null }>) => {\n      //adapt the number of children\n      const l = data.length;\n      if (n.children.length !== l) {\n        n.innerHTML = data.reduce((tmp, r) => {\n          return `${tmp}<div style='background-color: ${r.color}' title='${r.label}'></div>`;\n        }, '');\n      }\n      const children = n.children;\n      data.forEach((v, i) => {\n        const d = children[i] as HTMLElement;\n        d.title = v.label;\n        d.style.display = Number.isNaN(v.value) ? 'none' : null;\n        d.style.left = `${round(v.value * 100, 2)}%`;\n        // jitter\n        d.style.top = l > 1 ? `${round(Math.random() * 80 + 10, 2)}%` : null;\n        d.style.backgroundColor = v.color;\n      });\n    };\n\n    const render = (ctx: CanvasRenderingContext2D, vs: number[], colors: (string | null)[], width: number) => {\n      ctx.save();\n      ctx.globalAlpha = DOT.opacity;\n      vs.forEach((v, i) => {\n        ctx.fillStyle = colors[i] || DOT.color;\n        ctx.fillRect(Math.max(0, v * width - DOT.size / 2), 0, DOT.size, CANVAS_HEIGHT);\n      });\n      ctx.restore();\n    };\n\n    return { template: `<div>${tmp}</div>`, update, render };\n  }\n\n  create(col: INumberColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const { template, render, update } = DotCellRenderer.getDOMRenderer(col);\n    const width = context.colWidth(col);\n    const formatter = col.getNumberFormat();\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        const color = colorOf(col, d, imposer);\n        if (!isNumbersColumn(col)) {\n          const v = col.getNumber(d);\n          return update(n, [{ value: v, label: col.getLabel(d), color }]);\n        }\n        const data = col\n          .getNumbers(d)\n          .filter((vi: number) => !Number.isNaN(vi))\n          .map((value) => ({ value, label: formatter(value), color }));\n        return update(n, data);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        const color = colorOf(col, d, imposer);\n        if (!isNumbersColumn(col)) {\n          const v = col.getNumber(d);\n          return render(ctx, [v], [color], width);\n        }\n        const vs: number[] = col.getNumbers(d).filter((vi: number) => !Number.isNaN(vi));\n        return render(\n          ctx,\n          vs,\n          vs.map((_: any) => color),\n          width\n        );\n      },\n    };\n  }\n\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { template, render, width } = DotCellRenderer.getCanvasRenderer(col, context);\n\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'dot', (rows) => {\n            //value, color, label,\n\n            if (!isNumbersColumn(col)) {\n              return Array.from(rows.map((r) => ({ value: col.getNumber(r), color: colorOf(col, r, imposer) })));\n            }\n            // concatenate all columns\n            const vs = rows.map((r) => {\n              const color = colorOf(col, r, imposer);\n              return col\n                .getNumbers(r)\n                .filter((vi: number) => !Number.isNaN(vi))\n                .map((value) => ({ value, color }));\n            });\n            return Array.from(concatSeq(vs));\n          })\n          .then((data) => {\n            if (typeof data === 'symbol') {\n              return;\n            }\n            const isMissing = !data || data.length === 0 || data.every((v) => Number.isNaN(v.value));\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n            const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n            ctx.canvas.width = width;\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n            render(ctx, data, width);\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, GroupColumn, IOrderedGroup, IGroup, defaultGroup, IDataRow } from '../model';\nimport type { ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer } from './interfaces';\nimport { noRenderer } from './utils';\n\nfunction isDummyGroup(group: IGroup) {\n  return group.parent == null && group.name === defaultGroup.name;\n}\n\nexport default class GroupCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column): boolean {\n    return col instanceof GroupColumn;\n  }\n\n  create(): ICellRenderer {\n    return {\n      template: `<div><div></div></div>`,\n      update(node: HTMLElement, _row: IDataRow, i: number, group: IOrderedGroup) {\n        const text = isDummyGroup(group) || i > 0 ? '' : `${group.name} (${group.order.length})`;\n        (node.firstElementChild! as HTMLElement).textContent = text;\n        node.title = text;\n      },\n      render(_ctx: CanvasRenderingContext2D, _row: IDataRow, i: number) {\n        return i === 0;\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return {\n      template: `<div><div></div></div>`,\n      update(node: HTMLElement, group: IOrderedGroup) {\n        const text = isDummyGroup(group) ? '' : `${group.name} (${group.order.length})`;\n        (node.firstElementChild! as HTMLElement).textContent = text;\n        node.title = text;\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { IDataRow, INumbersColumn, EAdvancedSortMethod, IOrderedGroup } from '../model';\nimport type { IRenderContext, IImposer, ICellRenderer, IGroupCellRenderer } from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { ISequence, boxplotBuilder, getSortLabel } from '../internal';\n\nexport abstract class ANumbersCellRenderer {\n  abstract readonly title: string;\n\n  protected abstract createContext(\n    col: INumbersColumn,\n    context: IRenderContext,\n    imposer?: IImposer\n  ): {\n    clazz: string;\n    templateRow: string;\n    update: (row: HTMLElement, data: number[], raw: number[], d: IDataRow, tooltipPrefix?: string) => void;\n    render: (ctx: CanvasRenderingContext2D, data: number[], d: IDataRow) => void;\n  };\n\n  static choose(col: INumbersColumn, rows: ISequence<IDataRow>) {\n    let row: IDataRow | null = null;\n    const data = rows.map((r, i) => {\n      if (i === 0) {\n        row = r;\n      }\n      return { n: col.getNumbers(r), raw: col.getRawNumbers(r) };\n    });\n    const cols = col.dataLength!;\n    const normalized: number[] = [];\n    const raw: number[] = [];\n    // mean column)\n    for (let i = 0; i < cols; ++i) {\n      const vs = data.map((d) => ({ n: d.n[i], raw: d.raw[i] })).filter((d) => !Number.isNaN(d.n));\n      if (vs.length === 0) {\n        normalized.push(NaN);\n        raw.push(NaN);\n      } else {\n        const bbn = boxplotBuilder();\n        const bbr = boxplotBuilder();\n        const s: EAdvancedSortMethod = (col as any).getSortMethod();\n        vs.forEach((d) => {\n          bbn.push(d.n);\n          bbr.push(d.raw);\n        });\n        normalized.push(bbn.build()[s]!);\n        raw.push(bbr.build()[s]!);\n      }\n    }\n    return { normalized, raw, row };\n  }\n\n  create(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const width = context.colWidth(col);\n    const { templateRow, render, update, clazz } = this.createContext(col, context, imposer);\n    return {\n      template: `<div class=\"${clazz}\">${templateRow}</div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        update(n, col.getNumbers(d), col.getRawNumbers(d), d);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        render(ctx, col.getNumbers(d), d);\n      },\n    };\n  }\n\n  createGroup(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { templateRow, update, clazz } = this.createContext(col, context, imposer);\n    return {\n      template: `<div class=\"${clazz}\">${templateRow}</div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        // render a heatmap\n        return context.tasks\n          .groupRows(col, group, this.title, (rows) => ANumbersCellRenderer.choose(col, rows))\n          .then((data) => {\n            if (typeof data !== 'symbol') {\n              update(n, data.normalized, data.raw, data.row!, `${getSortLabel(col.getSortMethod())} `);\n            }\n          });\n      },\n    };\n  }\n}\n\n/** @internal */\nexport function matchRows(n: HTMLElement | SVGElement, length: number, template: string) {\n  // first match the number of rows\n  const children = Array.from(n.children) as (HTMLElement | SVGElement)[];\n  if (children.length > length) {\n    children.slice(length).forEach((c) => c.remove());\n  } else if (length > children.length) {\n    n.insertAdjacentHTML('beforeend', template.repeat(length - children.length));\n  }\n}\n","import { Column, INumbersColumn, isNumbersColumn, IDataRow, IOrderedGroup } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { ANumbersCellRenderer } from './ANumbersCellRenderer';\nimport { toHeatMapColor } from './BrightnessCellRenderer';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  IImposer,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingValue, renderMissingDOM } from './missing';\nimport { noop, wideEnough } from './utils';\nimport { GUESSED_ROW_HEIGHT } from '../constants';\nimport { getSortLabel } from '../internal';\n\nexport default class HeatmapCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Heatmap';\n\n  canRender(col: Column): boolean {\n    return isNumbersColumn(col) && Boolean(col.dataLength);\n  }\n\n  private createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer) {\n    const width = context.colWidth(col);\n    const cellDimension = width / col.dataLength!;\n    const labels = col.labels;\n    const render = (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow, height: number) => {\n      data.forEach((d: number, j: number) => {\n        const x = j * cellDimension;\n        if (Number.isNaN(d)) {\n          renderMissingValue(ctx, cellDimension, height, x, 0);\n          return;\n        }\n        ctx.fillStyle = toHeatMapColor(d, item, col, imposer);\n        ctx.fillRect(x, 0, cellDimension, height);\n      });\n    };\n    return {\n      template: `<canvas height=\"${GUESSED_ROW_HEIGHT}\" title=\"\"></canvas>`,\n      render,\n      width,\n      mover: (n: HTMLElement, values: string[], prefix?: string) => (evt: MouseEvent) => {\n        const percent = evt.offsetX / width;\n        const index = Math.max(0, Math.min(col.dataLength! - 1, Math.floor(percent * (col.dataLength! - 1) + 0.5)));\n        n.title = `${prefix || ''}${labels[index]}: ${values[index]}`;\n      },\n    };\n  }\n\n  create(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer): ICellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context, imposer);\n\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n        ctx.canvas.width = width;\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        n.onmousemove = mover(n, col.getLabels(d));\n        n.onmouseleave = () => (n.title = '');\n        render(ctx, col.getNumbers(d), d, GUESSED_ROW_HEIGHT);\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        render(ctx, col.getNumbers(d), d, CANVAS_HEIGHT);\n      },\n    };\n  }\n\n  createGroup(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { template, render, mover, width } = this.createContext(col, context, imposer);\n    const formatter = col.getNumberFormat();\n\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, this.title, (rows) => ANumbersCellRenderer.choose(col, rows))\n          .then((data) => {\n            if (typeof data === 'symbol') {\n              return;\n            }\n            const ctx = (n as HTMLCanvasElement).getContext('2d')!;\n            ctx.canvas.width = width;\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n            const isMissing = !data || data.normalized.length === 0 || data.normalized.every((v) => Number.isNaN(v));\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n\n            n.onmousemove = mover(n, data.raw.map(formatter), `${getSortLabel(col.getSortMethod())} `);\n            n.onmouseleave = () => (n.title = '');\n            render(ctx, data.normalized, data.row!, GUESSED_ROW_HEIGHT);\n          });\n      },\n    };\n  }\n\n  createSummary(col: INumbersColumn): ISummaryRenderer {\n    let labels = col.labels.slice();\n    while (labels.length > 0 && !wideEnough(col, labels.length)) {\n      labels = labels.filter((_, i) => i % 2 === 0); // even\n    }\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\n    for (const label of labels) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\"  title=\"${label}\" data-title=\"${label}\"></div>`;\n    }\n    templateRows += '</div>';\n    return {\n      template: templateRows,\n      update: noop,\n    };\n  }\n}\n","/**!\n * @fileOverview Kickass library to create and place poppers near their reference elements.\n * @version 1.16.1\n * @license\n * Copyright (c) 2016 Federico Zivolo and contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined' && typeof navigator !== 'undefined';\n\nvar timeoutDuration = function () {\n  var longerTimeoutBrowsers = ['Edge', 'Trident', 'Firefox'];\n  for (var i = 0; i < longerTimeoutBrowsers.length; i += 1) {\n    if (isBrowser && navigator.userAgent.indexOf(longerTimeoutBrowsers[i]) >= 0) {\n      return 1;\n    }\n  }\n  return 0;\n}();\n\nfunction microtaskDebounce(fn) {\n  var called = false;\n  return function () {\n    if (called) {\n      return;\n    }\n    called = true;\n    window.Promise.resolve().then(function () {\n      called = false;\n      fn();\n    });\n  };\n}\n\nfunction taskDebounce(fn) {\n  var scheduled = false;\n  return function () {\n    if (!scheduled) {\n      scheduled = true;\n      setTimeout(function () {\n        scheduled = false;\n        fn();\n      }, timeoutDuration);\n    }\n  };\n}\n\nvar supportsMicroTasks = isBrowser && window.Promise;\n\n/**\n* Create a debounced version of a method, that's asynchronously deferred\n* but called in the minimum time possible.\n*\n* @method\n* @memberof Popper.Utils\n* @argument {Function} fn\n* @returns {Function}\n*/\nvar debounce = supportsMicroTasks ? microtaskDebounce : taskDebounce;\n\n/**\n * Check if the given variable is a function\n * @method\n * @memberof Popper.Utils\n * @argument {Any} functionToCheck - variable to check\n * @returns {Boolean} answer to: is a function?\n */\nfunction isFunction(functionToCheck) {\n  var getType = {};\n  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n}\n\n/**\n * Get CSS computed property of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Eement} element\n * @argument {String} property\n */\nfunction getStyleComputedProperty(element, property) {\n  if (element.nodeType !== 1) {\n    return [];\n  }\n  // NOTE: 1 DOM access here\n  var window = element.ownerDocument.defaultView;\n  var css = window.getComputedStyle(element, null);\n  return property ? css[property] : css;\n}\n\n/**\n * Returns the parentNode or the host of the element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} parent\n */\nfunction getParentNode(element) {\n  if (element.nodeName === 'HTML') {\n    return element;\n  }\n  return element.parentNode || element.host;\n}\n\n/**\n * Returns the scrolling parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} scroll parent\n */\nfunction getScrollParent(element) {\n  // Return body, `getScroll` will take care to get the correct `scrollTop` from it\n  if (!element) {\n    return document.body;\n  }\n\n  switch (element.nodeName) {\n    case 'HTML':\n    case 'BODY':\n      return element.ownerDocument.body;\n    case '#document':\n      return element.body;\n  }\n\n  // Firefox want us to check `-x` and `-y` variations as well\n\n  var _getStyleComputedProp = getStyleComputedProperty(element),\n      overflow = _getStyleComputedProp.overflow,\n      overflowX = _getStyleComputedProp.overflowX,\n      overflowY = _getStyleComputedProp.overflowY;\n\n  if (/(auto|scroll|overlay)/.test(overflow + overflowY + overflowX)) {\n    return element;\n  }\n\n  return getScrollParent(getParentNode(element));\n}\n\n/**\n * Returns the reference node of the reference object, or the reference object itself.\n * @method\n * @memberof Popper.Utils\n * @param {Element|Object} reference - the reference element (the popper will be relative to this)\n * @returns {Element} parent\n */\nfunction getReferenceNode(reference) {\n  return reference && reference.referenceNode ? reference.referenceNode : reference;\n}\n\nvar isIE11 = isBrowser && !!(window.MSInputMethodContext && document.documentMode);\nvar isIE10 = isBrowser && /MSIE 10/.test(navigator.userAgent);\n\n/**\n * Determines if the browser is Internet Explorer\n * @method\n * @memberof Popper.Utils\n * @param {Number} version to check\n * @returns {Boolean} isIE\n */\nfunction isIE(version) {\n  if (version === 11) {\n    return isIE11;\n  }\n  if (version === 10) {\n    return isIE10;\n  }\n  return isIE11 || isIE10;\n}\n\n/**\n * Returns the offset parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} offset parent\n */\nfunction getOffsetParent(element) {\n  if (!element) {\n    return document.documentElement;\n  }\n\n  var noOffsetParent = isIE(10) ? document.body : null;\n\n  // NOTE: 1 DOM access here\n  var offsetParent = element.offsetParent || null;\n  // Skip hidden elements which don't have an offsetParent\n  while (offsetParent === noOffsetParent && element.nextElementSibling) {\n    offsetParent = (element = element.nextElementSibling).offsetParent;\n  }\n\n  var nodeName = offsetParent && offsetParent.nodeName;\n\n  if (!nodeName || nodeName === 'BODY' || nodeName === 'HTML') {\n    return element ? element.ownerDocument.documentElement : document.documentElement;\n  }\n\n  // .offsetParent will return the closest TH, TD or TABLE in case\n  // no offsetParent is present, I hate this job...\n  if (['TH', 'TD', 'TABLE'].indexOf(offsetParent.nodeName) !== -1 && getStyleComputedProperty(offsetParent, 'position') === 'static') {\n    return getOffsetParent(offsetParent);\n  }\n\n  return offsetParent;\n}\n\nfunction isOffsetContainer(element) {\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY') {\n    return false;\n  }\n  return nodeName === 'HTML' || getOffsetParent(element.firstElementChild) === element;\n}\n\n/**\n * Finds the root node (document, shadowDOM root) of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} node\n * @returns {Element} root node\n */\nfunction getRoot(node) {\n  if (node.parentNode !== null) {\n    return getRoot(node.parentNode);\n  }\n\n  return node;\n}\n\n/**\n * Finds the offset parent common to the two provided nodes\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element1\n * @argument {Element} element2\n * @returns {Element} common offset parent\n */\nfunction findCommonOffsetParent(element1, element2) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element1 || !element1.nodeType || !element2 || !element2.nodeType) {\n    return document.documentElement;\n  }\n\n  // Here we make sure to give as \"start\" the element that comes first in the DOM\n  var order = element1.compareDocumentPosition(element2) & Node.DOCUMENT_POSITION_FOLLOWING;\n  var start = order ? element1 : element2;\n  var end = order ? element2 : element1;\n\n  // Get common ancestor container\n  var range = document.createRange();\n  range.setStart(start, 0);\n  range.setEnd(end, 0);\n  var commonAncestorContainer = range.commonAncestorContainer;\n\n  // Both nodes are inside #document\n\n  if (element1 !== commonAncestorContainer && element2 !== commonAncestorContainer || start.contains(end)) {\n    if (isOffsetContainer(commonAncestorContainer)) {\n      return commonAncestorContainer;\n    }\n\n    return getOffsetParent(commonAncestorContainer);\n  }\n\n  // one of the nodes is inside shadowDOM, find which one\n  var element1root = getRoot(element1);\n  if (element1root.host) {\n    return findCommonOffsetParent(element1root.host, element2);\n  } else {\n    return findCommonOffsetParent(element1, getRoot(element2).host);\n  }\n}\n\n/**\n * Gets the scroll value of the given element in the given side (top and left)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {String} side `top` or `left`\n * @returns {number} amount of scrolled pixels\n */\nfunction getScroll(element) {\n  var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n  var upperSide = side === 'top' ? 'scrollTop' : 'scrollLeft';\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    var html = element.ownerDocument.documentElement;\n    var scrollingElement = element.ownerDocument.scrollingElement || html;\n    return scrollingElement[upperSide];\n  }\n\n  return element[upperSide];\n}\n\n/*\n * Sum or subtract the element scroll values (left and top) from a given rect object\n * @method\n * @memberof Popper.Utils\n * @param {Object} rect - Rect object you want to change\n * @param {HTMLElement} element - The element from the function reads the scroll values\n * @param {Boolean} subtract - set to true if you want to subtract the scroll values\n * @return {Object} rect - The modifier rect object\n */\nfunction includeScroll(rect, element) {\n  var subtract = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var scrollTop = getScroll(element, 'top');\n  var scrollLeft = getScroll(element, 'left');\n  var modifier = subtract ? -1 : 1;\n  rect.top += scrollTop * modifier;\n  rect.bottom += scrollTop * modifier;\n  rect.left += scrollLeft * modifier;\n  rect.right += scrollLeft * modifier;\n  return rect;\n}\n\n/*\n * Helper to detect borders of a given element\n * @method\n * @memberof Popper.Utils\n * @param {CSSStyleDeclaration} styles\n * Result of `getStyleComputedProperty` on the given element\n * @param {String} axis - `x` or `y`\n * @return {number} borders - The borders size of the given axis\n */\n\nfunction getBordersSize(styles, axis) {\n  var sideA = axis === 'x' ? 'Left' : 'Top';\n  var sideB = sideA === 'Left' ? 'Right' : 'Bottom';\n\n  return parseFloat(styles['border' + sideA + 'Width']) + parseFloat(styles['border' + sideB + 'Width']);\n}\n\nfunction getSize(axis, body, html, computedStyle) {\n  return Math.max(body['offset' + axis], body['scroll' + axis], html['client' + axis], html['offset' + axis], html['scroll' + axis], isIE(10) ? parseInt(html['offset' + axis]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Top' : 'Left')]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Bottom' : 'Right')]) : 0);\n}\n\nfunction getWindowSizes(document) {\n  var body = document.body;\n  var html = document.documentElement;\n  var computedStyle = isIE(10) && getComputedStyle(html);\n\n  return {\n    height: getSize('Height', body, html, computedStyle),\n    width: getSize('Width', body, html, computedStyle)\n  };\n}\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\nvar defineProperty = function (obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n/**\n * Given element offsets, generate an output similar to getBoundingClientRect\n * @method\n * @memberof Popper.Utils\n * @argument {Object} offsets\n * @returns {Object} ClientRect like output\n */\nfunction getClientRect(offsets) {\n  return _extends({}, offsets, {\n    right: offsets.left + offsets.width,\n    bottom: offsets.top + offsets.height\n  });\n}\n\n/**\n * Get bounding client rect of given element\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} element\n * @return {Object} client rect\n */\nfunction getBoundingClientRect(element) {\n  var rect = {};\n\n  // IE10 10 FIX: Please, don't ask, the element isn't\n  // considered in DOM in some circumstances...\n  // This isn't reproducible in IE10 compatibility mode of IE11\n  try {\n    if (isIE(10)) {\n      rect = element.getBoundingClientRect();\n      var scrollTop = getScroll(element, 'top');\n      var scrollLeft = getScroll(element, 'left');\n      rect.top += scrollTop;\n      rect.left += scrollLeft;\n      rect.bottom += scrollTop;\n      rect.right += scrollLeft;\n    } else {\n      rect = element.getBoundingClientRect();\n    }\n  } catch (e) {}\n\n  var result = {\n    left: rect.left,\n    top: rect.top,\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top\n  };\n\n  // subtract scrollbar size from sizes\n  var sizes = element.nodeName === 'HTML' ? getWindowSizes(element.ownerDocument) : {};\n  var width = sizes.width || element.clientWidth || result.width;\n  var height = sizes.height || element.clientHeight || result.height;\n\n  var horizScrollbar = element.offsetWidth - width;\n  var vertScrollbar = element.offsetHeight - height;\n\n  // if an hypothetical scrollbar is detected, we must be sure it's not a `border`\n  // we make this check conditional for performance reasons\n  if (horizScrollbar || vertScrollbar) {\n    var styles = getStyleComputedProperty(element);\n    horizScrollbar -= getBordersSize(styles, 'x');\n    vertScrollbar -= getBordersSize(styles, 'y');\n\n    result.width -= horizScrollbar;\n    result.height -= vertScrollbar;\n  }\n\n  return getClientRect(result);\n}\n\nfunction getOffsetRectRelativeToArbitraryNode(children, parent) {\n  var fixedPosition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var isIE10 = isIE(10);\n  var isHTML = parent.nodeName === 'HTML';\n  var childrenRect = getBoundingClientRect(children);\n  var parentRect = getBoundingClientRect(parent);\n  var scrollParent = getScrollParent(children);\n\n  var styles = getStyleComputedProperty(parent);\n  var borderTopWidth = parseFloat(styles.borderTopWidth);\n  var borderLeftWidth = parseFloat(styles.borderLeftWidth);\n\n  // In cases where the parent is fixed, we must ignore negative scroll in offset calc\n  if (fixedPosition && isHTML) {\n    parentRect.top = Math.max(parentRect.top, 0);\n    parentRect.left = Math.max(parentRect.left, 0);\n  }\n  var offsets = getClientRect({\n    top: childrenRect.top - parentRect.top - borderTopWidth,\n    left: childrenRect.left - parentRect.left - borderLeftWidth,\n    width: childrenRect.width,\n    height: childrenRect.height\n  });\n  offsets.marginTop = 0;\n  offsets.marginLeft = 0;\n\n  // Subtract margins of documentElement in case it's being used as parent\n  // we do this only on HTML because it's the only element that behaves\n  // differently when margins are applied to it. The margins are included in\n  // the box of the documentElement, in the other cases not.\n  if (!isIE10 && isHTML) {\n    var marginTop = parseFloat(styles.marginTop);\n    var marginLeft = parseFloat(styles.marginLeft);\n\n    offsets.top -= borderTopWidth - marginTop;\n    offsets.bottom -= borderTopWidth - marginTop;\n    offsets.left -= borderLeftWidth - marginLeft;\n    offsets.right -= borderLeftWidth - marginLeft;\n\n    // Attach marginTop and marginLeft because in some circumstances we may need them\n    offsets.marginTop = marginTop;\n    offsets.marginLeft = marginLeft;\n  }\n\n  if (isIE10 && !fixedPosition ? parent.contains(scrollParent) : parent === scrollParent && scrollParent.nodeName !== 'BODY') {\n    offsets = includeScroll(offsets, parent);\n  }\n\n  return offsets;\n}\n\nfunction getViewportOffsetRectRelativeToArtbitraryNode(element) {\n  var excludeScroll = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var html = element.ownerDocument.documentElement;\n  var relativeOffset = getOffsetRectRelativeToArbitraryNode(element, html);\n  var width = Math.max(html.clientWidth, window.innerWidth || 0);\n  var height = Math.max(html.clientHeight, window.innerHeight || 0);\n\n  var scrollTop = !excludeScroll ? getScroll(html) : 0;\n  var scrollLeft = !excludeScroll ? getScroll(html, 'left') : 0;\n\n  var offset = {\n    top: scrollTop - relativeOffset.top + relativeOffset.marginTop,\n    left: scrollLeft - relativeOffset.left + relativeOffset.marginLeft,\n    width: width,\n    height: height\n  };\n\n  return getClientRect(offset);\n}\n\n/**\n * Check if the given element is fixed or is inside a fixed parent\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {Element} customContainer\n * @returns {Boolean} answer to \"isFixed?\"\n */\nfunction isFixed(element) {\n  var nodeName = element.nodeName;\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    return false;\n  }\n  if (getStyleComputedProperty(element, 'position') === 'fixed') {\n    return true;\n  }\n  var parentNode = getParentNode(element);\n  if (!parentNode) {\n    return false;\n  }\n  return isFixed(parentNode);\n}\n\n/**\n * Finds the first parent of an element that has a transformed property defined\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} first transformed parent or documentElement\n */\n\nfunction getFixedPositionOffsetParent(element) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element || !element.parentElement || isIE()) {\n    return document.documentElement;\n  }\n  var el = element.parentElement;\n  while (el && getStyleComputedProperty(el, 'transform') === 'none') {\n    el = el.parentElement;\n  }\n  return el || document.documentElement;\n}\n\n/**\n * Computed the boundaries limits and return them\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} popper\n * @param {HTMLElement} reference\n * @param {number} padding\n * @param {HTMLElement} boundariesElement - Element used to define the boundaries\n * @param {Boolean} fixedPosition - Is in fixed position mode\n * @returns {Object} Coordinates of the boundaries\n */\nfunction getBoundaries(popper, reference, padding, boundariesElement) {\n  var fixedPosition = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n  // NOTE: 1 DOM access here\n\n  var boundaries = { top: 0, left: 0 };\n  var offsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, getReferenceNode(reference));\n\n  // Handle viewport case\n  if (boundariesElement === 'viewport') {\n    boundaries = getViewportOffsetRectRelativeToArtbitraryNode(offsetParent, fixedPosition);\n  } else {\n    // Handle other cases based on DOM element used as boundaries\n    var boundariesNode = void 0;\n    if (boundariesElement === 'scrollParent') {\n      boundariesNode = getScrollParent(getParentNode(reference));\n      if (boundariesNode.nodeName === 'BODY') {\n        boundariesNode = popper.ownerDocument.documentElement;\n      }\n    } else if (boundariesElement === 'window') {\n      boundariesNode = popper.ownerDocument.documentElement;\n    } else {\n      boundariesNode = boundariesElement;\n    }\n\n    var offsets = getOffsetRectRelativeToArbitraryNode(boundariesNode, offsetParent, fixedPosition);\n\n    // In case of HTML, we need a different computation\n    if (boundariesNode.nodeName === 'HTML' && !isFixed(offsetParent)) {\n      var _getWindowSizes = getWindowSizes(popper.ownerDocument),\n          height = _getWindowSizes.height,\n          width = _getWindowSizes.width;\n\n      boundaries.top += offsets.top - offsets.marginTop;\n      boundaries.bottom = height + offsets.top;\n      boundaries.left += offsets.left - offsets.marginLeft;\n      boundaries.right = width + offsets.left;\n    } else {\n      // for all the other DOM elements, this one is good\n      boundaries = offsets;\n    }\n  }\n\n  // Add paddings\n  padding = padding || 0;\n  var isPaddingNumber = typeof padding === 'number';\n  boundaries.left += isPaddingNumber ? padding : padding.left || 0;\n  boundaries.top += isPaddingNumber ? padding : padding.top || 0;\n  boundaries.right -= isPaddingNumber ? padding : padding.right || 0;\n  boundaries.bottom -= isPaddingNumber ? padding : padding.bottom || 0;\n\n  return boundaries;\n}\n\nfunction getArea(_ref) {\n  var width = _ref.width,\n      height = _ref.height;\n\n  return width * height;\n}\n\n/**\n * Utility used to transform the `auto` placement to the placement with more\n * available space.\n * @method\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeAutoPlacement(placement, refRect, popper, reference, boundariesElement) {\n  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n  if (placement.indexOf('auto') === -1) {\n    return placement;\n  }\n\n  var boundaries = getBoundaries(popper, reference, padding, boundariesElement);\n\n  var rects = {\n    top: {\n      width: boundaries.width,\n      height: refRect.top - boundaries.top\n    },\n    right: {\n      width: boundaries.right - refRect.right,\n      height: boundaries.height\n    },\n    bottom: {\n      width: boundaries.width,\n      height: boundaries.bottom - refRect.bottom\n    },\n    left: {\n      width: refRect.left - boundaries.left,\n      height: boundaries.height\n    }\n  };\n\n  var sortedAreas = Object.keys(rects).map(function (key) {\n    return _extends({\n      key: key\n    }, rects[key], {\n      area: getArea(rects[key])\n    });\n  }).sort(function (a, b) {\n    return b.area - a.area;\n  });\n\n  var filteredAreas = sortedAreas.filter(function (_ref2) {\n    var width = _ref2.width,\n        height = _ref2.height;\n    return width >= popper.clientWidth && height >= popper.clientHeight;\n  });\n\n  var computedPlacement = filteredAreas.length > 0 ? filteredAreas[0].key : sortedAreas[0].key;\n\n  var variation = placement.split('-')[1];\n\n  return computedPlacement + (variation ? '-' + variation : '');\n}\n\n/**\n * Get offsets to the reference element\n * @method\n * @memberof Popper.Utils\n * @param {Object} state\n * @param {Element} popper - the popper element\n * @param {Element} reference - the reference element (the popper will be relative to this)\n * @param {Element} fixedPosition - is in fixed position mode\n * @returns {Object} An object containing the offsets which will be applied to the popper\n */\nfunction getReferenceOffsets(state, popper, reference) {\n  var fixedPosition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var commonOffsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, getReferenceNode(reference));\n  return getOffsetRectRelativeToArbitraryNode(reference, commonOffsetParent, fixedPosition);\n}\n\n/**\n * Get the outer sizes of the given element (offset size + margins)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Object} object containing width and height properties\n */\nfunction getOuterSizes(element) {\n  var window = element.ownerDocument.defaultView;\n  var styles = window.getComputedStyle(element);\n  var x = parseFloat(styles.marginTop || 0) + parseFloat(styles.marginBottom || 0);\n  var y = parseFloat(styles.marginLeft || 0) + parseFloat(styles.marginRight || 0);\n  var result = {\n    width: element.offsetWidth + y,\n    height: element.offsetHeight + x\n  };\n  return result;\n}\n\n/**\n * Get the opposite placement of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement\n * @returns {String} flipped placement\n */\nfunction getOppositePlacement(placement) {\n  var hash = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' };\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}\n\n/**\n * Get offsets to the popper\n * @method\n * @memberof Popper.Utils\n * @param {Object} position - CSS position the Popper will get applied\n * @param {HTMLElement} popper - the popper element\n * @param {Object} referenceOffsets - the reference offsets (the popper will be relative to this)\n * @param {String} placement - one of the valid placement options\n * @returns {Object} popperOffsets - An object containing the offsets which will be applied to the popper\n */\nfunction getPopperOffsets(popper, referenceOffsets, placement) {\n  placement = placement.split('-')[0];\n\n  // Get popper node sizes\n  var popperRect = getOuterSizes(popper);\n\n  // Add position, width and height to our offsets object\n  var popperOffsets = {\n    width: popperRect.width,\n    height: popperRect.height\n  };\n\n  // depending by the popper placement we have to compute its offsets slightly differently\n  var isHoriz = ['right', 'left'].indexOf(placement) !== -1;\n  var mainSide = isHoriz ? 'top' : 'left';\n  var secondarySide = isHoriz ? 'left' : 'top';\n  var measurement = isHoriz ? 'height' : 'width';\n  var secondaryMeasurement = !isHoriz ? 'height' : 'width';\n\n  popperOffsets[mainSide] = referenceOffsets[mainSide] + referenceOffsets[measurement] / 2 - popperRect[measurement] / 2;\n  if (placement === secondarySide) {\n    popperOffsets[secondarySide] = referenceOffsets[secondarySide] - popperRect[secondaryMeasurement];\n  } else {\n    popperOffsets[secondarySide] = referenceOffsets[getOppositePlacement(secondarySide)];\n  }\n\n  return popperOffsets;\n}\n\n/**\n * Mimics the `find` method of Array\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction find(arr, check) {\n  // use native find if supported\n  if (Array.prototype.find) {\n    return arr.find(check);\n  }\n\n  // use `filter` to obtain the same behavior of `find`\n  return arr.filter(check)[0];\n}\n\n/**\n * Return the index of the matching object\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction findIndex(arr, prop, value) {\n  // use native findIndex if supported\n  if (Array.prototype.findIndex) {\n    return arr.findIndex(function (cur) {\n      return cur[prop] === value;\n    });\n  }\n\n  // use `find` + `indexOf` if `findIndex` isn't supported\n  var match = find(arr, function (obj) {\n    return obj[prop] === value;\n  });\n  return arr.indexOf(match);\n}\n\n/**\n * Loop trough the list of modifiers and run them in order,\n * each of them will then edit the data object.\n * @method\n * @memberof Popper.Utils\n * @param {dataObject} data\n * @param {Array} modifiers\n * @param {String} ends - Optional modifier name used as stopper\n * @returns {dataObject}\n */\nfunction runModifiers(modifiers, data, ends) {\n  var modifiersToRun = ends === undefined ? modifiers : modifiers.slice(0, findIndex(modifiers, 'name', ends));\n\n  modifiersToRun.forEach(function (modifier) {\n    if (modifier['function']) {\n      // eslint-disable-line dot-notation\n      console.warn('`modifier.function` is deprecated, use `modifier.fn`!');\n    }\n    var fn = modifier['function'] || modifier.fn; // eslint-disable-line dot-notation\n    if (modifier.enabled && isFunction(fn)) {\n      // Add properties to offsets to make them a complete clientRect object\n      // we do this before each modifier to make sure the previous one doesn't\n      // mess with these values\n      data.offsets.popper = getClientRect(data.offsets.popper);\n      data.offsets.reference = getClientRect(data.offsets.reference);\n\n      data = fn(data, modifier);\n    }\n  });\n\n  return data;\n}\n\n/**\n * Updates the position of the popper, computing the new offsets and applying\n * the new style.<br />\n * Prefer `scheduleUpdate` over `update` because of performance reasons.\n * @method\n * @memberof Popper\n */\nfunction update() {\n  // if popper is destroyed, don't perform any further update\n  if (this.state.isDestroyed) {\n    return;\n  }\n\n  var data = {\n    instance: this,\n    styles: {},\n    arrowStyles: {},\n    attributes: {},\n    flipped: false,\n    offsets: {}\n  };\n\n  // compute reference element offsets\n  data.offsets.reference = getReferenceOffsets(this.state, this.popper, this.reference, this.options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  data.placement = computeAutoPlacement(this.options.placement, data.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding);\n\n  // store the computed placement inside `originalPlacement`\n  data.originalPlacement = data.placement;\n\n  data.positionFixed = this.options.positionFixed;\n\n  // compute the popper offsets\n  data.offsets.popper = getPopperOffsets(this.popper, data.offsets.reference, data.placement);\n\n  data.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute';\n\n  // run the modifiers\n  data = runModifiers(this.modifiers, data);\n\n  // the first `update` will call `onCreate` callback\n  // the other ones will call `onUpdate` callback\n  if (!this.state.isCreated) {\n    this.state.isCreated = true;\n    this.options.onCreate(data);\n  } else {\n    this.options.onUpdate(data);\n  }\n}\n\n/**\n * Helper used to know if the given modifier is enabled.\n * @method\n * @memberof Popper.Utils\n * @returns {Boolean}\n */\nfunction isModifierEnabled(modifiers, modifierName) {\n  return modifiers.some(function (_ref) {\n    var name = _ref.name,\n        enabled = _ref.enabled;\n    return enabled && name === modifierName;\n  });\n}\n\n/**\n * Get the prefixed supported property name\n * @method\n * @memberof Popper.Utils\n * @argument {String} property (camelCase)\n * @returns {String} prefixed property (camelCase or PascalCase, depending on the vendor prefix)\n */\nfunction getSupportedPropertyName(property) {\n  var prefixes = [false, 'ms', 'Webkit', 'Moz', 'O'];\n  var upperProp = property.charAt(0).toUpperCase() + property.slice(1);\n\n  for (var i = 0; i < prefixes.length; i++) {\n    var prefix = prefixes[i];\n    var toCheck = prefix ? '' + prefix + upperProp : property;\n    if (typeof document.body.style[toCheck] !== 'undefined') {\n      return toCheck;\n    }\n  }\n  return null;\n}\n\n/**\n * Destroys the popper.\n * @method\n * @memberof Popper\n */\nfunction destroy() {\n  this.state.isDestroyed = true;\n\n  // touch DOM only if `applyStyle` modifier is enabled\n  if (isModifierEnabled(this.modifiers, 'applyStyle')) {\n    this.popper.removeAttribute('x-placement');\n    this.popper.style.position = '';\n    this.popper.style.top = '';\n    this.popper.style.left = '';\n    this.popper.style.right = '';\n    this.popper.style.bottom = '';\n    this.popper.style.willChange = '';\n    this.popper.style[getSupportedPropertyName('transform')] = '';\n  }\n\n  this.disableEventListeners();\n\n  // remove the popper if user explicitly asked for the deletion on destroy\n  // do not use `remove` because IE11 doesn't support it\n  if (this.options.removeOnDestroy) {\n    this.popper.parentNode.removeChild(this.popper);\n  }\n  return this;\n}\n\n/**\n * Get the window associated with the element\n * @argument {Element} element\n * @returns {Window}\n */\nfunction getWindow(element) {\n  var ownerDocument = element.ownerDocument;\n  return ownerDocument ? ownerDocument.defaultView : window;\n}\n\nfunction attachToScrollParents(scrollParent, event, callback, scrollParents) {\n  var isBody = scrollParent.nodeName === 'BODY';\n  var target = isBody ? scrollParent.ownerDocument.defaultView : scrollParent;\n  target.addEventListener(event, callback, { passive: true });\n\n  if (!isBody) {\n    attachToScrollParents(getScrollParent(target.parentNode), event, callback, scrollParents);\n  }\n  scrollParents.push(target);\n}\n\n/**\n * Setup needed event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction setupEventListeners(reference, options, state, updateBound) {\n  // Resize event listener on window\n  state.updateBound = updateBound;\n  getWindow(reference).addEventListener('resize', state.updateBound, { passive: true });\n\n  // Scroll event listener on scroll parents\n  var scrollElement = getScrollParent(reference);\n  attachToScrollParents(scrollElement, 'scroll', state.updateBound, state.scrollParents);\n  state.scrollElement = scrollElement;\n  state.eventsEnabled = true;\n\n  return state;\n}\n\n/**\n * It will add resize/scroll events and start recalculating\n * position of the popper element when they are triggered.\n * @method\n * @memberof Popper\n */\nfunction enableEventListeners() {\n  if (!this.state.eventsEnabled) {\n    this.state = setupEventListeners(this.reference, this.options, this.state, this.scheduleUpdate);\n  }\n}\n\n/**\n * Remove event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction removeEventListeners(reference, state) {\n  // Remove resize event listener on window\n  getWindow(reference).removeEventListener('resize', state.updateBound);\n\n  // Remove scroll event listener on scroll parents\n  state.scrollParents.forEach(function (target) {\n    target.removeEventListener('scroll', state.updateBound);\n  });\n\n  // Reset state\n  state.updateBound = null;\n  state.scrollParents = [];\n  state.scrollElement = null;\n  state.eventsEnabled = false;\n  return state;\n}\n\n/**\n * It will remove resize/scroll events and won't recalculate popper position\n * when they are triggered. It also won't trigger `onUpdate` callback anymore,\n * unless you call `update` method manually.\n * @method\n * @memberof Popper\n */\nfunction disableEventListeners() {\n  if (this.state.eventsEnabled) {\n    cancelAnimationFrame(this.scheduleUpdate);\n    this.state = removeEventListeners(this.reference, this.state);\n  }\n}\n\n/**\n * Tells if a given input is a number\n * @method\n * @memberof Popper.Utils\n * @param {*} input to check\n * @return {Boolean}\n */\nfunction isNumeric(n) {\n  return n !== '' && !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * Set the style to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the style to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setStyles(element, styles) {\n  Object.keys(styles).forEach(function (prop) {\n    var unit = '';\n    // add unit if the value is numeric and is one of the following\n    if (['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(prop) !== -1 && isNumeric(styles[prop])) {\n      unit = 'px';\n    }\n    element.style[prop] = styles[prop] + unit;\n  });\n}\n\n/**\n * Set the attributes to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the attributes to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setAttributes(element, attributes) {\n  Object.keys(attributes).forEach(function (prop) {\n    var value = attributes[prop];\n    if (value !== false) {\n      element.setAttribute(prop, attributes[prop]);\n    } else {\n      element.removeAttribute(prop);\n    }\n  });\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} data.styles - List of style properties - values to apply to popper element\n * @argument {Object} data.attributes - List of attribute properties - values to apply to popper element\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The same data object\n */\nfunction applyStyle(data) {\n  // any property present in `data.styles` will be applied to the popper,\n  // in this way we can make the 3rd party modifiers add custom styles to it\n  // Be aware, modifiers could override the properties defined in the previous\n  // lines of this modifier!\n  setStyles(data.instance.popper, data.styles);\n\n  // any property present in `data.attributes` will be applied to the popper,\n  // they will be set as HTML attributes of the element\n  setAttributes(data.instance.popper, data.attributes);\n\n  // if arrowElement is defined and arrowStyles has some properties\n  if (data.arrowElement && Object.keys(data.arrowStyles).length) {\n    setStyles(data.arrowElement, data.arrowStyles);\n  }\n\n  return data;\n}\n\n/**\n * Set the x-placement attribute before everything else because it could be used\n * to add margins to the popper margins needs to be calculated to get the\n * correct popper offsets.\n * @method\n * @memberof Popper.modifiers\n * @param {HTMLElement} reference - The reference element used to position the popper\n * @param {HTMLElement} popper - The HTML element used as popper\n * @param {Object} options - Popper.js options\n */\nfunction applyStyleOnLoad(reference, popper, options, modifierOptions, state) {\n  // compute reference element offsets\n  var referenceOffsets = getReferenceOffsets(state, popper, reference, options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  var placement = computeAutoPlacement(options.placement, referenceOffsets, popper, reference, options.modifiers.flip.boundariesElement, options.modifiers.flip.padding);\n\n  popper.setAttribute('x-placement', placement);\n\n  // Apply `position` to popper before anything else because\n  // without the position applied we can't guarantee correct computations\n  setStyles(popper, { position: options.positionFixed ? 'fixed' : 'absolute' });\n\n  return options;\n}\n\n/**\n * @function\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Boolean} shouldRound - If the offsets should be rounded at all\n * @returns {Object} The popper's position offsets rounded\n *\n * The tale of pixel-perfect positioning. It's still not 100% perfect, but as\n * good as it can be within reason.\n * Discussion here: https://github.com/FezVrasta/popper.js/pull/715\n *\n * Low DPI screens cause a popper to be blurry if not using full pixels (Safari\n * as well on High DPI screens).\n *\n * Firefox prefers no rounding for positioning and does not have blurriness on\n * high DPI screens.\n *\n * Only horizontal placement and left/right values need to be considered.\n */\nfunction getRoundedOffsets(data, shouldRound) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n  var round = Math.round,\n      floor = Math.floor;\n\n  var noRound = function noRound(v) {\n    return v;\n  };\n\n  var referenceWidth = round(reference.width);\n  var popperWidth = round(popper.width);\n\n  var isVertical = ['left', 'right'].indexOf(data.placement) !== -1;\n  var isVariation = data.placement.indexOf('-') !== -1;\n  var sameWidthParity = referenceWidth % 2 === popperWidth % 2;\n  var bothOddWidth = referenceWidth % 2 === 1 && popperWidth % 2 === 1;\n\n  var horizontalToInteger = !shouldRound ? noRound : isVertical || isVariation || sameWidthParity ? round : floor;\n  var verticalToInteger = !shouldRound ? noRound : round;\n\n  return {\n    left: horizontalToInteger(bothOddWidth && !isVariation && shouldRound ? popper.left - 1 : popper.left),\n    top: verticalToInteger(popper.top),\n    bottom: verticalToInteger(popper.bottom),\n    right: horizontalToInteger(popper.right)\n  };\n}\n\nvar isFirefox = isBrowser && /Firefox/i.test(navigator.userAgent);\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeStyle(data, options) {\n  var x = options.x,\n      y = options.y;\n  var popper = data.offsets.popper;\n\n  // Remove this legacy support in Popper.js v2\n\n  var legacyGpuAccelerationOption = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'applyStyle';\n  }).gpuAcceleration;\n  if (legacyGpuAccelerationOption !== undefined) {\n    console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');\n  }\n  var gpuAcceleration = legacyGpuAccelerationOption !== undefined ? legacyGpuAccelerationOption : options.gpuAcceleration;\n\n  var offsetParent = getOffsetParent(data.instance.popper);\n  var offsetParentRect = getBoundingClientRect(offsetParent);\n\n  // Styles\n  var styles = {\n    position: popper.position\n  };\n\n  var offsets = getRoundedOffsets(data, window.devicePixelRatio < 2 || !isFirefox);\n\n  var sideA = x === 'bottom' ? 'top' : 'bottom';\n  var sideB = y === 'right' ? 'left' : 'right';\n\n  // if gpuAcceleration is set to `true` and transform is supported,\n  //  we use `translate3d` to apply the position to the popper we\n  // automatically use the supported prefixed version if needed\n  var prefixedProperty = getSupportedPropertyName('transform');\n\n  // now, let's make a step back and look at this code closely (wtf?)\n  // If the content of the popper grows once it's been positioned, it\n  // may happen that the popper gets misplaced because of the new content\n  // overflowing its reference element\n  // To avoid this problem, we provide two options (x and y), which allow\n  // the consumer to define the offset origin.\n  // If we position a popper on top of a reference element, we can set\n  // `x` to `top` to make the popper grow towards its top instead of\n  // its bottom.\n  var left = void 0,\n      top = void 0;\n  if (sideA === 'bottom') {\n    // when offsetParent is <html> the positioning is relative to the bottom of the screen (excluding the scrollbar)\n    // and not the bottom of the html element\n    if (offsetParent.nodeName === 'HTML') {\n      top = -offsetParent.clientHeight + offsets.bottom;\n    } else {\n      top = -offsetParentRect.height + offsets.bottom;\n    }\n  } else {\n    top = offsets.top;\n  }\n  if (sideB === 'right') {\n    if (offsetParent.nodeName === 'HTML') {\n      left = -offsetParent.clientWidth + offsets.right;\n    } else {\n      left = -offsetParentRect.width + offsets.right;\n    }\n  } else {\n    left = offsets.left;\n  }\n  if (gpuAcceleration && prefixedProperty) {\n    styles[prefixedProperty] = 'translate3d(' + left + 'px, ' + top + 'px, 0)';\n    styles[sideA] = 0;\n    styles[sideB] = 0;\n    styles.willChange = 'transform';\n  } else {\n    // othwerise, we use the standard `top`, `left`, `bottom` and `right` properties\n    var invertTop = sideA === 'bottom' ? -1 : 1;\n    var invertLeft = sideB === 'right' ? -1 : 1;\n    styles[sideA] = top * invertTop;\n    styles[sideB] = left * invertLeft;\n    styles.willChange = sideA + ', ' + sideB;\n  }\n\n  // Attributes\n  var attributes = {\n    'x-placement': data.placement\n  };\n\n  // Update `data` attributes, styles and arrowStyles\n  data.attributes = _extends({}, attributes, data.attributes);\n  data.styles = _extends({}, styles, data.styles);\n  data.arrowStyles = _extends({}, data.offsets.arrow, data.arrowStyles);\n\n  return data;\n}\n\n/**\n * Helper used to know if the given modifier depends from another one.<br />\n * It checks if the needed modifier is listed and enabled.\n * @method\n * @memberof Popper.Utils\n * @param {Array} modifiers - list of modifiers\n * @param {String} requestingName - name of requesting modifier\n * @param {String} requestedName - name of requested modifier\n * @returns {Boolean}\n */\nfunction isModifierRequired(modifiers, requestingName, requestedName) {\n  var requesting = find(modifiers, function (_ref) {\n    var name = _ref.name;\n    return name === requestingName;\n  });\n\n  var isRequired = !!requesting && modifiers.some(function (modifier) {\n    return modifier.name === requestedName && modifier.enabled && modifier.order < requesting.order;\n  });\n\n  if (!isRequired) {\n    var _requesting = '`' + requestingName + '`';\n    var requested = '`' + requestedName + '`';\n    console.warn(requested + ' modifier is required by ' + _requesting + ' modifier in order to work, be sure to include it before ' + _requesting + '!');\n  }\n  return isRequired;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction arrow(data, options) {\n  var _data$offsets$arrow;\n\n  // arrow depends on keepTogether in order to work\n  if (!isModifierRequired(data.instance.modifiers, 'arrow', 'keepTogether')) {\n    return data;\n  }\n\n  var arrowElement = options.element;\n\n  // if arrowElement is a string, suppose it's a CSS selector\n  if (typeof arrowElement === 'string') {\n    arrowElement = data.instance.popper.querySelector(arrowElement);\n\n    // if arrowElement is not found, don't run the modifier\n    if (!arrowElement) {\n      return data;\n    }\n  } else {\n    // if the arrowElement isn't a query selector we must check that the\n    // provided DOM node is child of its popper node\n    if (!data.instance.popper.contains(arrowElement)) {\n      console.warn('WARNING: `arrow.element` must be child of its popper element!');\n      return data;\n    }\n  }\n\n  var placement = data.placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isVertical = ['left', 'right'].indexOf(placement) !== -1;\n\n  var len = isVertical ? 'height' : 'width';\n  var sideCapitalized = isVertical ? 'Top' : 'Left';\n  var side = sideCapitalized.toLowerCase();\n  var altSide = isVertical ? 'left' : 'top';\n  var opSide = isVertical ? 'bottom' : 'right';\n  var arrowElementSize = getOuterSizes(arrowElement)[len];\n\n  //\n  // extends keepTogether behavior making sure the popper and its\n  // reference have enough pixels in conjunction\n  //\n\n  // top/left side\n  if (reference[opSide] - arrowElementSize < popper[side]) {\n    data.offsets.popper[side] -= popper[side] - (reference[opSide] - arrowElementSize);\n  }\n  // bottom/right side\n  if (reference[side] + arrowElementSize > popper[opSide]) {\n    data.offsets.popper[side] += reference[side] + arrowElementSize - popper[opSide];\n  }\n  data.offsets.popper = getClientRect(data.offsets.popper);\n\n  // compute center of the popper\n  var center = reference[side] + reference[len] / 2 - arrowElementSize / 2;\n\n  // Compute the sideValue using the updated popper offsets\n  // take popper margin in account because we don't have this info available\n  var css = getStyleComputedProperty(data.instance.popper);\n  var popperMarginSide = parseFloat(css['margin' + sideCapitalized]);\n  var popperBorderSide = parseFloat(css['border' + sideCapitalized + 'Width']);\n  var sideValue = center - data.offsets.popper[side] - popperMarginSide - popperBorderSide;\n\n  // prevent arrowElement from being placed not contiguously to its popper\n  sideValue = Math.max(Math.min(popper[len] - arrowElementSize, sideValue), 0);\n\n  data.arrowElement = arrowElement;\n  data.offsets.arrow = (_data$offsets$arrow = {}, defineProperty(_data$offsets$arrow, side, Math.round(sideValue)), defineProperty(_data$offsets$arrow, altSide, ''), _data$offsets$arrow);\n\n  return data;\n}\n\n/**\n * Get the opposite placement variation of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement variation\n * @returns {String} flipped placement variation\n */\nfunction getOppositeVariation(variation) {\n  if (variation === 'end') {\n    return 'start';\n  } else if (variation === 'start') {\n    return 'end';\n  }\n  return variation;\n}\n\n/**\n * List of accepted placements to use as values of the `placement` option.<br />\n * Valid placements are:\n * - `auto`\n * - `top`\n * - `right`\n * - `bottom`\n * - `left`\n *\n * Each placement can have a variation from this list:\n * - `-start`\n * - `-end`\n *\n * Variations are interpreted easily if you think of them as the left to right\n * written languages. Horizontally (`top` and `bottom`), `start` is left and `end`\n * is right.<br />\n * Vertically (`left` and `right`), `start` is top and `end` is bottom.\n *\n * Some valid examples are:\n * - `top-end` (on top of reference, right aligned)\n * - `right-start` (on right of reference, top aligned)\n * - `bottom` (on bottom, centered)\n * - `auto-end` (on the side with more space available, alignment depends by placement)\n *\n * @static\n * @type {Array}\n * @enum {String}\n * @readonly\n * @method placements\n * @memberof Popper\n */\nvar placements = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'];\n\n// Get rid of `auto` `auto-start` and `auto-end`\nvar validPlacements = placements.slice(3);\n\n/**\n * Given an initial placement, returns all the subsequent placements\n * clockwise (or counter-clockwise).\n *\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement - A valid placement (it accepts variations)\n * @argument {Boolean} counter - Set to true to walk the placements counterclockwise\n * @returns {Array} placements including their variations\n */\nfunction clockwise(placement) {\n  var counter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var index = validPlacements.indexOf(placement);\n  var arr = validPlacements.slice(index + 1).concat(validPlacements.slice(0, index));\n  return counter ? arr.reverse() : arr;\n}\n\nvar BEHAVIORS = {\n  FLIP: 'flip',\n  CLOCKWISE: 'clockwise',\n  COUNTERCLOCKWISE: 'counterclockwise'\n};\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction flip(data, options) {\n  // if `inner` modifier is enabled, we can't use the `flip` modifier\n  if (isModifierEnabled(data.instance.modifiers, 'inner')) {\n    return data;\n  }\n\n  if (data.flipped && data.placement === data.originalPlacement) {\n    // seems like flip is trying to loop, probably there's not enough space on any of the flippable sides\n    return data;\n  }\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, options.boundariesElement, data.positionFixed);\n\n  var placement = data.placement.split('-')[0];\n  var placementOpposite = getOppositePlacement(placement);\n  var variation = data.placement.split('-')[1] || '';\n\n  var flipOrder = [];\n\n  switch (options.behavior) {\n    case BEHAVIORS.FLIP:\n      flipOrder = [placement, placementOpposite];\n      break;\n    case BEHAVIORS.CLOCKWISE:\n      flipOrder = clockwise(placement);\n      break;\n    case BEHAVIORS.COUNTERCLOCKWISE:\n      flipOrder = clockwise(placement, true);\n      break;\n    default:\n      flipOrder = options.behavior;\n  }\n\n  flipOrder.forEach(function (step, index) {\n    if (placement !== step || flipOrder.length === index + 1) {\n      return data;\n    }\n\n    placement = data.placement.split('-')[0];\n    placementOpposite = getOppositePlacement(placement);\n\n    var popperOffsets = data.offsets.popper;\n    var refOffsets = data.offsets.reference;\n\n    // using floor because the reference offsets may contain decimals we are not going to consider here\n    var floor = Math.floor;\n    var overlapsRef = placement === 'left' && floor(popperOffsets.right) > floor(refOffsets.left) || placement === 'right' && floor(popperOffsets.left) < floor(refOffsets.right) || placement === 'top' && floor(popperOffsets.bottom) > floor(refOffsets.top) || placement === 'bottom' && floor(popperOffsets.top) < floor(refOffsets.bottom);\n\n    var overflowsLeft = floor(popperOffsets.left) < floor(boundaries.left);\n    var overflowsRight = floor(popperOffsets.right) > floor(boundaries.right);\n    var overflowsTop = floor(popperOffsets.top) < floor(boundaries.top);\n    var overflowsBottom = floor(popperOffsets.bottom) > floor(boundaries.bottom);\n\n    var overflowsBoundaries = placement === 'left' && overflowsLeft || placement === 'right' && overflowsRight || placement === 'top' && overflowsTop || placement === 'bottom' && overflowsBottom;\n\n    // flip the variation if required\n    var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n\n    // flips variation if reference element overflows boundaries\n    var flippedVariationByRef = !!options.flipVariations && (isVertical && variation === 'start' && overflowsLeft || isVertical && variation === 'end' && overflowsRight || !isVertical && variation === 'start' && overflowsTop || !isVertical && variation === 'end' && overflowsBottom);\n\n    // flips variation if popper content overflows boundaries\n    var flippedVariationByContent = !!options.flipVariationsByContent && (isVertical && variation === 'start' && overflowsRight || isVertical && variation === 'end' && overflowsLeft || !isVertical && variation === 'start' && overflowsBottom || !isVertical && variation === 'end' && overflowsTop);\n\n    var flippedVariation = flippedVariationByRef || flippedVariationByContent;\n\n    if (overlapsRef || overflowsBoundaries || flippedVariation) {\n      // this boolean to detect any flip loop\n      data.flipped = true;\n\n      if (overlapsRef || overflowsBoundaries) {\n        placement = flipOrder[index + 1];\n      }\n\n      if (flippedVariation) {\n        variation = getOppositeVariation(variation);\n      }\n\n      data.placement = placement + (variation ? '-' + variation : '');\n\n      // this object contains `position`, we want to preserve it along with\n      // any additional property we may add in the future\n      data.offsets.popper = _extends({}, data.offsets.popper, getPopperOffsets(data.instance.popper, data.offsets.reference, data.placement));\n\n      data = runModifiers(data.instance.modifiers, data, 'flip');\n    }\n  });\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction keepTogether(data) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var placement = data.placement.split('-')[0];\n  var floor = Math.floor;\n  var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n  var side = isVertical ? 'right' : 'bottom';\n  var opSide = isVertical ? 'left' : 'top';\n  var measurement = isVertical ? 'width' : 'height';\n\n  if (popper[side] < floor(reference[opSide])) {\n    data.offsets.popper[opSide] = floor(reference[opSide]) - popper[measurement];\n  }\n  if (popper[opSide] > floor(reference[side])) {\n    data.offsets.popper[opSide] = floor(reference[side]);\n  }\n\n  return data;\n}\n\n/**\n * Converts a string containing value + unit into a px value number\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} str - Value + unit string\n * @argument {String} measurement - `height` or `width`\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @returns {Number|String}\n * Value in pixels, or original string if no values were extracted\n */\nfunction toValue(str, measurement, popperOffsets, referenceOffsets) {\n  // separate value from unit\n  var split = str.match(/((?:\\-|\\+)?\\d*\\.?\\d*)(.*)/);\n  var value = +split[1];\n  var unit = split[2];\n\n  // If it's not a number it's an operator, I guess\n  if (!value) {\n    return str;\n  }\n\n  if (unit.indexOf('%') === 0) {\n    var element = void 0;\n    switch (unit) {\n      case '%p':\n        element = popperOffsets;\n        break;\n      case '%':\n      case '%r':\n      default:\n        element = referenceOffsets;\n    }\n\n    var rect = getClientRect(element);\n    return rect[measurement] / 100 * value;\n  } else if (unit === 'vh' || unit === 'vw') {\n    // if is a vh or vw, we calculate the size based on the viewport\n    var size = void 0;\n    if (unit === 'vh') {\n      size = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    } else {\n      size = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n    }\n    return size / 100 * value;\n  } else {\n    // if is an explicit pixel unit, we get rid of the unit and keep the value\n    // if is an implicit unit, it's px, and we return just the value\n    return value;\n  }\n}\n\n/**\n * Parse an `offset` string to extrapolate `x` and `y` numeric offsets.\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} offset\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @argument {String} basePlacement\n * @returns {Array} a two cells array with x and y offsets in numbers\n */\nfunction parseOffset(offset, popperOffsets, referenceOffsets, basePlacement) {\n  var offsets = [0, 0];\n\n  // Use height if placement is left or right and index is 0 otherwise use width\n  // in this way the first offset will use an axis and the second one\n  // will use the other one\n  var useHeight = ['right', 'left'].indexOf(basePlacement) !== -1;\n\n  // Split the offset string to obtain a list of values and operands\n  // The regex addresses values with the plus or minus sign in front (+10, -20, etc)\n  var fragments = offset.split(/(\\+|\\-)/).map(function (frag) {\n    return frag.trim();\n  });\n\n  // Detect if the offset string contains a pair of values or a single one\n  // they could be separated by comma or space\n  var divider = fragments.indexOf(find(fragments, function (frag) {\n    return frag.search(/,|\\s/) !== -1;\n  }));\n\n  if (fragments[divider] && fragments[divider].indexOf(',') === -1) {\n    console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');\n  }\n\n  // If divider is found, we divide the list of values and operands to divide\n  // them by ofset X and Y.\n  var splitRegex = /\\s*,\\s*|\\s+/;\n  var ops = divider !== -1 ? [fragments.slice(0, divider).concat([fragments[divider].split(splitRegex)[0]]), [fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider + 1))] : [fragments];\n\n  // Convert the values with units to absolute pixels to allow our computations\n  ops = ops.map(function (op, index) {\n    // Most of the units rely on the orientation of the popper\n    var measurement = (index === 1 ? !useHeight : useHeight) ? 'height' : 'width';\n    var mergeWithPrevious = false;\n    return op\n    // This aggregates any `+` or `-` sign that aren't considered operators\n    // e.g.: 10 + +5 => [10, +, +5]\n    .reduce(function (a, b) {\n      if (a[a.length - 1] === '' && ['+', '-'].indexOf(b) !== -1) {\n        a[a.length - 1] = b;\n        mergeWithPrevious = true;\n        return a;\n      } else if (mergeWithPrevious) {\n        a[a.length - 1] += b;\n        mergeWithPrevious = false;\n        return a;\n      } else {\n        return a.concat(b);\n      }\n    }, [])\n    // Here we convert the string values into number values (in px)\n    .map(function (str) {\n      return toValue(str, measurement, popperOffsets, referenceOffsets);\n    });\n  });\n\n  // Loop trough the offsets arrays and execute the operations\n  ops.forEach(function (op, index) {\n    op.forEach(function (frag, index2) {\n      if (isNumeric(frag)) {\n        offsets[index] += frag * (op[index2 - 1] === '-' ? -1 : 1);\n      }\n    });\n  });\n  return offsets;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @argument {Number|String} options.offset=0\n * The offset value as described in the modifier description\n * @returns {Object} The data object, properly modified\n */\nfunction offset(data, _ref) {\n  var offset = _ref.offset;\n  var placement = data.placement,\n      _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var basePlacement = placement.split('-')[0];\n\n  var offsets = void 0;\n  if (isNumeric(+offset)) {\n    offsets = [+offset, 0];\n  } else {\n    offsets = parseOffset(offset, popper, reference, basePlacement);\n  }\n\n  if (basePlacement === 'left') {\n    popper.top += offsets[0];\n    popper.left -= offsets[1];\n  } else if (basePlacement === 'right') {\n    popper.top += offsets[0];\n    popper.left += offsets[1];\n  } else if (basePlacement === 'top') {\n    popper.left += offsets[0];\n    popper.top -= offsets[1];\n  } else if (basePlacement === 'bottom') {\n    popper.left += offsets[0];\n    popper.top += offsets[1];\n  }\n\n  data.popper = popper;\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction preventOverflow(data, options) {\n  var boundariesElement = options.boundariesElement || getOffsetParent(data.instance.popper);\n\n  // If offsetParent is the reference element, we really want to\n  // go one step up and use the next offsetParent as reference to\n  // avoid to make this modifier completely useless and look like broken\n  if (data.instance.reference === boundariesElement) {\n    boundariesElement = getOffsetParent(boundariesElement);\n  }\n\n  // NOTE: DOM access here\n  // resets the popper's position so that the document size can be calculated excluding\n  // the size of the popper element itself\n  var transformProp = getSupportedPropertyName('transform');\n  var popperStyles = data.instance.popper.style; // assignment to help minification\n  var top = popperStyles.top,\n      left = popperStyles.left,\n      transform = popperStyles[transformProp];\n\n  popperStyles.top = '';\n  popperStyles.left = '';\n  popperStyles[transformProp] = '';\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, boundariesElement, data.positionFixed);\n\n  // NOTE: DOM access here\n  // restores the original style properties after the offsets have been computed\n  popperStyles.top = top;\n  popperStyles.left = left;\n  popperStyles[transformProp] = transform;\n\n  options.boundaries = boundaries;\n\n  var order = options.priority;\n  var popper = data.offsets.popper;\n\n  var check = {\n    primary: function primary(placement) {\n      var value = popper[placement];\n      if (popper[placement] < boundaries[placement] && !options.escapeWithReference) {\n        value = Math.max(popper[placement], boundaries[placement]);\n      }\n      return defineProperty({}, placement, value);\n    },\n    secondary: function secondary(placement) {\n      var mainSide = placement === 'right' ? 'left' : 'top';\n      var value = popper[mainSide];\n      if (popper[placement] > boundaries[placement] && !options.escapeWithReference) {\n        value = Math.min(popper[mainSide], boundaries[placement] - (placement === 'right' ? popper.width : popper.height));\n      }\n      return defineProperty({}, mainSide, value);\n    }\n  };\n\n  order.forEach(function (placement) {\n    var side = ['left', 'top'].indexOf(placement) !== -1 ? 'primary' : 'secondary';\n    popper = _extends({}, popper, check[side](placement));\n  });\n\n  data.offsets.popper = popper;\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction shift(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var shiftvariation = placement.split('-')[1];\n\n  // if shift shiftvariation is specified, run the modifier\n  if (shiftvariation) {\n    var _data$offsets = data.offsets,\n        reference = _data$offsets.reference,\n        popper = _data$offsets.popper;\n\n    var isVertical = ['bottom', 'top'].indexOf(basePlacement) !== -1;\n    var side = isVertical ? 'left' : 'top';\n    var measurement = isVertical ? 'width' : 'height';\n\n    var shiftOffsets = {\n      start: defineProperty({}, side, reference[side]),\n      end: defineProperty({}, side, reference[side] + reference[measurement] - popper[measurement])\n    };\n\n    data.offsets.popper = _extends({}, popper, shiftOffsets[shiftvariation]);\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction hide(data) {\n  if (!isModifierRequired(data.instance.modifiers, 'hide', 'preventOverflow')) {\n    return data;\n  }\n\n  var refRect = data.offsets.reference;\n  var bound = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'preventOverflow';\n  }).boundaries;\n\n  if (refRect.bottom < bound.top || refRect.left > bound.right || refRect.top > bound.bottom || refRect.right < bound.left) {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === true) {\n      return data;\n    }\n\n    data.hide = true;\n    data.attributes['x-out-of-boundaries'] = '';\n  } else {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === false) {\n      return data;\n    }\n\n    data.hide = false;\n    data.attributes['x-out-of-boundaries'] = false;\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction inner(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isHoriz = ['left', 'right'].indexOf(basePlacement) !== -1;\n\n  var subtractLength = ['top', 'left'].indexOf(basePlacement) === -1;\n\n  popper[isHoriz ? 'left' : 'top'] = reference[basePlacement] - (subtractLength ? popper[isHoriz ? 'width' : 'height'] : 0);\n\n  data.placement = getOppositePlacement(placement);\n  data.offsets.popper = getClientRect(popper);\n\n  return data;\n}\n\n/**\n * Modifier function, each modifier can have a function of this type assigned\n * to its `fn` property.<br />\n * These functions will be called on each update, this means that you must\n * make sure they are performant enough to avoid performance bottlenecks.\n *\n * @function ModifierFn\n * @argument {dataObject} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {dataObject} The data object, properly modified\n */\n\n/**\n * Modifiers are plugins used to alter the behavior of your poppers.<br />\n * Popper.js uses a set of 9 modifiers to provide all the basic functionalities\n * needed by the library.\n *\n * Usually you don't want to override the `order`, `fn` and `onLoad` props.\n * All the other properties are configurations that could be tweaked.\n * @namespace modifiers\n */\nvar modifiers = {\n  /**\n   * Modifier used to shift the popper on the start or end of its reference\n   * element.<br />\n   * It will read the variation of the `placement` property.<br />\n   * It can be one either `-end` or `-start`.\n   * @memberof modifiers\n   * @inner\n   */\n  shift: {\n    /** @prop {number} order=100 - Index used to define the order of execution */\n    order: 100,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: shift\n  },\n\n  /**\n   * The `offset` modifier can shift your popper on both its axis.\n   *\n   * It accepts the following units:\n   * - `px` or unit-less, interpreted as pixels\n   * - `%` or `%r`, percentage relative to the length of the reference element\n   * - `%p`, percentage relative to the length of the popper element\n   * - `vw`, CSS viewport width unit\n   * - `vh`, CSS viewport height unit\n   *\n   * For length is intended the main axis relative to the placement of the popper.<br />\n   * This means that if the placement is `top` or `bottom`, the length will be the\n   * `width`. In case of `left` or `right`, it will be the `height`.\n   *\n   * You can provide a single value (as `Number` or `String`), or a pair of values\n   * as `String` divided by a comma or one (or more) white spaces.<br />\n   * The latter is a deprecated method because it leads to confusion and will be\n   * removed in v2.<br />\n   * Additionally, it accepts additions and subtractions between different units.\n   * Note that multiplications and divisions aren't supported.\n   *\n   * Valid examples are:\n   * ```\n   * 10\n   * '10%'\n   * '10, 10'\n   * '10%, 10'\n   * '10 + 10%'\n   * '10 - 5vh + 3%'\n   * '-10px + 5vh, 5px - 6%'\n   * ```\n   * > **NB**: If you desire to apply offsets to your poppers in a way that may make them overlap\n   * > with their reference element, unfortunately, you will have to disable the `flip` modifier.\n   * > You can read more on this at this [issue](https://github.com/FezVrasta/popper.js/issues/373).\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  offset: {\n    /** @prop {number} order=200 - Index used to define the order of execution */\n    order: 200,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: offset,\n    /** @prop {Number|String} offset=0\n     * The offset value as described in the modifier description\n     */\n    offset: 0\n  },\n\n  /**\n   * Modifier used to prevent the popper from being positioned outside the boundary.\n   *\n   * A scenario exists where the reference itself is not within the boundaries.<br />\n   * We can say it has \"escaped the boundaries\" — or just \"escaped\".<br />\n   * In this case we need to decide whether the popper should either:\n   *\n   * - detach from the reference and remain \"trapped\" in the boundaries, or\n   * - if it should ignore the boundary and \"escape with its reference\"\n   *\n   * When `escapeWithReference` is set to`true` and reference is completely\n   * outside its boundaries, the popper will overflow (or completely leave)\n   * the boundaries in order to remain attached to the edge of the reference.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  preventOverflow: {\n    /** @prop {number} order=300 - Index used to define the order of execution */\n    order: 300,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: preventOverflow,\n    /**\n     * @prop {Array} [priority=['left','right','top','bottom']]\n     * Popper will try to prevent overflow following these priorities by default,\n     * then, it could overflow on the left and on top of the `boundariesElement`\n     */\n    priority: ['left', 'right', 'top', 'bottom'],\n    /**\n     * @prop {number} padding=5\n     * Amount of pixel used to define a minimum distance between the boundaries\n     * and the popper. This makes sure the popper always has a little padding\n     * between the edges of its container\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='scrollParent'\n     * Boundaries used by the modifier. Can be `scrollParent`, `window`,\n     * `viewport` or any DOM element.\n     */\n    boundariesElement: 'scrollParent'\n  },\n\n  /**\n   * Modifier used to make sure the reference and its popper stay near each other\n   * without leaving any gap between the two. Especially useful when the arrow is\n   * enabled and you want to ensure that it points to its reference element.\n   * It cares only about the first axis. You can still have poppers with margin\n   * between the popper and its reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  keepTogether: {\n    /** @prop {number} order=400 - Index used to define the order of execution */\n    order: 400,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: keepTogether\n  },\n\n  /**\n   * This modifier is used to move the `arrowElement` of the popper to make\n   * sure it is positioned between the reference element and its popper element.\n   * It will read the outer size of the `arrowElement` node to detect how many\n   * pixels of conjunction are needed.\n   *\n   * It has no effect if no `arrowElement` is provided.\n   * @memberof modifiers\n   * @inner\n   */\n  arrow: {\n    /** @prop {number} order=500 - Index used to define the order of execution */\n    order: 500,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: arrow,\n    /** @prop {String|HTMLElement} element='[x-arrow]' - Selector or node used as arrow */\n    element: '[x-arrow]'\n  },\n\n  /**\n   * Modifier used to flip the popper's placement when it starts to overlap its\n   * reference element.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   *\n   * **NOTE:** this modifier will interrupt the current update cycle and will\n   * restart it if it detects the need to flip the placement.\n   * @memberof modifiers\n   * @inner\n   */\n  flip: {\n    /** @prop {number} order=600 - Index used to define the order of execution */\n    order: 600,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: flip,\n    /**\n     * @prop {String|Array} behavior='flip'\n     * The behavior used to change the popper's placement. It can be one of\n     * `flip`, `clockwise`, `counterclockwise` or an array with a list of valid\n     * placements (with optional variations)\n     */\n    behavior: 'flip',\n    /**\n     * @prop {number} padding=5\n     * The popper will flip if it hits the edges of the `boundariesElement`\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='viewport'\n     * The element which will define the boundaries of the popper position.\n     * The popper will never be placed outside of the defined boundaries\n     * (except if `keepTogether` is enabled)\n     */\n    boundariesElement: 'viewport',\n    /**\n     * @prop {Boolean} flipVariations=false\n     * The popper will switch placement variation between `-start` and `-end` when\n     * the reference element overlaps its boundaries.\n     *\n     * The original placement should have a set variation.\n     */\n    flipVariations: false,\n    /**\n     * @prop {Boolean} flipVariationsByContent=false\n     * The popper will switch placement variation between `-start` and `-end` when\n     * the popper element overlaps its reference boundaries.\n     *\n     * The original placement should have a set variation.\n     */\n    flipVariationsByContent: false\n  },\n\n  /**\n   * Modifier used to make the popper flow toward the inner of the reference element.\n   * By default, when this modifier is disabled, the popper will be placed outside\n   * the reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  inner: {\n    /** @prop {number} order=700 - Index used to define the order of execution */\n    order: 700,\n    /** @prop {Boolean} enabled=false - Whether the modifier is enabled or not */\n    enabled: false,\n    /** @prop {ModifierFn} */\n    fn: inner\n  },\n\n  /**\n   * Modifier used to hide the popper when its reference element is outside of the\n   * popper boundaries. It will set a `x-out-of-boundaries` attribute which can\n   * be used to hide with a CSS selector the popper when its reference is\n   * out of boundaries.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   * @memberof modifiers\n   * @inner\n   */\n  hide: {\n    /** @prop {number} order=800 - Index used to define the order of execution */\n    order: 800,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: hide\n  },\n\n  /**\n   * Computes the style that will be applied to the popper element to gets\n   * properly positioned.\n   *\n   * Note that this modifier will not touch the DOM, it just prepares the styles\n   * so that `applyStyle` modifier can apply it. This separation is useful\n   * in case you need to replace `applyStyle` with a custom implementation.\n   *\n   * This modifier has `850` as `order` value to maintain backward compatibility\n   * with previous versions of Popper.js. Expect the modifiers ordering method\n   * to change in future major versions of the library.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  computeStyle: {\n    /** @prop {number} order=850 - Index used to define the order of execution */\n    order: 850,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: computeStyle,\n    /**\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: true,\n    /**\n     * @prop {string} [x='bottom']\n     * Where to anchor the X axis (`bottom` or `top`). AKA X offset origin.\n     * Change this if your popper should grow in a direction different from `bottom`\n     */\n    x: 'bottom',\n    /**\n     * @prop {string} [x='left']\n     * Where to anchor the Y axis (`left` or `right`). AKA Y offset origin.\n     * Change this if your popper should grow in a direction different from `right`\n     */\n    y: 'right'\n  },\n\n  /**\n   * Applies the computed styles to the popper element.\n   *\n   * All the DOM manipulations are limited to this modifier. This is useful in case\n   * you want to integrate Popper.js inside a framework or view library and you\n   * want to delegate all the DOM manipulations to it.\n   *\n   * Note that if you disable this modifier, you must make sure the popper element\n   * has its position set to `absolute` before Popper.js can do its work!\n   *\n   * Just disable this modifier and define your own to achieve the desired effect.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  applyStyle: {\n    /** @prop {number} order=900 - Index used to define the order of execution */\n    order: 900,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: applyStyle,\n    /** @prop {Function} */\n    onLoad: applyStyleOnLoad,\n    /**\n     * @deprecated since version 1.10.0, the property moved to `computeStyle` modifier\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: undefined\n  }\n};\n\n/**\n * The `dataObject` is an object containing all the information used by Popper.js.\n * This object is passed to modifiers and to the `onCreate` and `onUpdate` callbacks.\n * @name dataObject\n * @property {Object} data.instance The Popper.js instance\n * @property {String} data.placement Placement applied to popper\n * @property {String} data.originalPlacement Placement originally defined on init\n * @property {Boolean} data.flipped True if popper has been flipped by flip modifier\n * @property {Boolean} data.hide True if the reference element is out of boundaries, useful to know when to hide the popper\n * @property {HTMLElement} data.arrowElement Node used as arrow by arrow modifier\n * @property {Object} data.styles Any CSS property defined here will be applied to the popper. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.arrowStyles Any CSS property defined here will be applied to the popper arrow. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.boundaries Offsets of the popper boundaries\n * @property {Object} data.offsets The measurements of popper, reference and arrow elements\n * @property {Object} data.offsets.popper `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.reference `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.arrow] `top` and `left` offsets, only one of them will be different from 0\n */\n\n/**\n * Default options provided to Popper.js constructor.<br />\n * These can be overridden using the `options` argument of Popper.js.<br />\n * To override an option, simply pass an object with the same\n * structure of the `options` object, as the 3rd argument. For example:\n * ```\n * new Popper(ref, pop, {\n *   modifiers: {\n *     preventOverflow: { enabled: false }\n *   }\n * })\n * ```\n * @type {Object}\n * @static\n * @memberof Popper\n */\nvar Defaults = {\n  /**\n   * Popper's placement.\n   * @prop {Popper.placements} placement='bottom'\n   */\n  placement: 'bottom',\n\n  /**\n   * Set this to true if you want popper to position it self in 'fixed' mode\n   * @prop {Boolean} positionFixed=false\n   */\n  positionFixed: false,\n\n  /**\n   * Whether events (resize, scroll) are initially enabled.\n   * @prop {Boolean} eventsEnabled=true\n   */\n  eventsEnabled: true,\n\n  /**\n   * Set to true if you want to automatically remove the popper when\n   * you call the `destroy` method.\n   * @prop {Boolean} removeOnDestroy=false\n   */\n  removeOnDestroy: false,\n\n  /**\n   * Callback called when the popper is created.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onCreate}\n   */\n  onCreate: function onCreate() {},\n\n  /**\n   * Callback called when the popper is updated. This callback is not called\n   * on the initialization/creation of the popper, but only on subsequent\n   * updates.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onUpdate}\n   */\n  onUpdate: function onUpdate() {},\n\n  /**\n   * List of modifiers used to modify the offsets before they are applied to the popper.\n   * They provide most of the functionalities of Popper.js.\n   * @prop {modifiers}\n   */\n  modifiers: modifiers\n};\n\n/**\n * @callback onCreate\n * @param {dataObject} data\n */\n\n/**\n * @callback onUpdate\n * @param {dataObject} data\n */\n\n// Utils\n// Methods\nvar Popper = function () {\n  /**\n   * Creates a new Popper.js instance.\n   * @class Popper\n   * @param {Element|referenceObject} reference - The reference element used to position the popper\n   * @param {Element} popper - The HTML / XML element used as the popper\n   * @param {Object} options - Your custom options to override the ones defined in [Defaults](#defaults)\n   * @return {Object} instance - The generated Popper.js instance\n   */\n  function Popper(reference, popper) {\n    var _this = this;\n\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    classCallCheck(this, Popper);\n\n    this.scheduleUpdate = function () {\n      return requestAnimationFrame(_this.update);\n    };\n\n    // make update() debounced, so that it only runs at most once-per-tick\n    this.update = debounce(this.update.bind(this));\n\n    // with {} we create a new object with the options inside it\n    this.options = _extends({}, Popper.Defaults, options);\n\n    // init state\n    this.state = {\n      isDestroyed: false,\n      isCreated: false,\n      scrollParents: []\n    };\n\n    // get reference and popper elements (allow jQuery wrappers)\n    this.reference = reference && reference.jquery ? reference[0] : reference;\n    this.popper = popper && popper.jquery ? popper[0] : popper;\n\n    // Deep merge modifiers options\n    this.options.modifiers = {};\n    Object.keys(_extends({}, Popper.Defaults.modifiers, options.modifiers)).forEach(function (name) {\n      _this.options.modifiers[name] = _extends({}, Popper.Defaults.modifiers[name] || {}, options.modifiers ? options.modifiers[name] : {});\n    });\n\n    // Refactoring modifiers' list (Object => Array)\n    this.modifiers = Object.keys(this.options.modifiers).map(function (name) {\n      return _extends({\n        name: name\n      }, _this.options.modifiers[name]);\n    })\n    // sort the modifiers by order\n    .sort(function (a, b) {\n      return a.order - b.order;\n    });\n\n    // modifiers have the ability to execute arbitrary code when Popper.js get inited\n    // such code is executed in the same order of its modifier\n    // they could add new properties to their options configuration\n    // BE AWARE: don't add options to `options.modifiers.name` but to `modifierOptions`!\n    this.modifiers.forEach(function (modifierOptions) {\n      if (modifierOptions.enabled && isFunction(modifierOptions.onLoad)) {\n        modifierOptions.onLoad(_this.reference, _this.popper, _this.options, modifierOptions, _this.state);\n      }\n    });\n\n    // fire the first update to position the popper in the right place\n    this.update();\n\n    var eventsEnabled = this.options.eventsEnabled;\n    if (eventsEnabled) {\n      // setup event listeners, they will take care of update the position in specific situations\n      this.enableEventListeners();\n    }\n\n    this.state.eventsEnabled = eventsEnabled;\n  }\n\n  // We can't use class properties because they don't get listed in the\n  // class prototype and break stuff like Sinon stubs\n\n\n  createClass(Popper, [{\n    key: 'update',\n    value: function update$$1() {\n      return update.call(this);\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy$$1() {\n      return destroy.call(this);\n    }\n  }, {\n    key: 'enableEventListeners',\n    value: function enableEventListeners$$1() {\n      return enableEventListeners.call(this);\n    }\n  }, {\n    key: 'disableEventListeners',\n    value: function disableEventListeners$$1() {\n      return disableEventListeners.call(this);\n    }\n\n    /**\n     * Schedules an update. It will run on the next UI update available.\n     * @method scheduleUpdate\n     * @memberof Popper\n     */\n\n\n    /**\n     * Collection of utilities useful when writing custom modifiers.\n     * Starting from version 1.7, this method is available only if you\n     * include `popper-utils.js` before `popper.js`.\n     *\n     * **DEPRECATION**: This way to access PopperUtils is deprecated\n     * and will be removed in v2! Use the PopperUtils module directly instead.\n     * Due to the high instability of the methods contained in Utils, we can't\n     * guarantee them to follow semver. Use them at your own risk!\n     * @static\n     * @private\n     * @type {Object}\n     * @deprecated since version 1.8\n     * @member Utils\n     * @memberof Popper\n     */\n\n  }]);\n  return Popper;\n}();\n\n/**\n * The `referenceObject` is an object that provides an interface compatible with Popper.js\n * and lets you use it as replacement of a real DOM node.<br />\n * You can use this method to position a popper relatively to a set of coordinates\n * in case you don't have a DOM node to use as reference.\n *\n * ```\n * new Popper(referenceObject, popperNode);\n * ```\n *\n * NB: This feature isn't supported in Internet Explorer 10.\n * @name referenceObject\n * @property {Function} data.getBoundingClientRect\n * A function that returns a set of coordinates compatible with the native `getBoundingClientRect` method.\n * @property {number} data.clientWidth\n * An ES6 getter that will return the width of the virtual reference element.\n * @property {number} data.clientHeight\n * An ES6 getter that will return the height of the virtual reference element.\n */\n\n\nPopper.Utils = (typeof window !== 'undefined' ? window : global).PopperUtils;\nPopper.placements = placements;\nPopper.Defaults = Defaults;\n\nexport default Popper;\n//# sourceMappingURL=popper.js.map\n","const TYPE_OBJECT = '[object Object]';\n\n/**\n * deep merge the source object into the target object and return the target object.\n * will concatenate arrays instead of replacing them.\n * @internal\n */\nexport default function merge<T1, T2>(target: T1, source: T2): T1 | T2 {\n  const result: any = target;\n\n  if (!source) {\n    return result;\n  }\n\n  const bKeys = Object.keys(source) as (keyof T2)[];\n  if (bKeys.length === 0) {\n    return result;\n  }\n\n  for (const key of bKeys) {\n    const value = source[key];\n\n    //merge just POJOs\n    if (Object.prototype.toString.call(value) === TYPE_OBJECT && Object.getPrototypeOf(value) === Object.prototype) {\n      //pojo\n      if (result[key] == null) {\n        result[key] = {};\n      }\n      result[key] = merge(result[key], value);\n    } else if (Array.isArray(value)) {\n      if (result[key] == null) {\n        result[key] = [];\n      }\n      result[key] = result[key].concat(value);\n    } else {\n      result[key] = value;\n    }\n  }\n  return result;\n}\n","import Popper from 'popper.js';\nimport type DialogManager from './DialogManager';\nimport { merge } from '../../internal';\nimport { cssClass } from '../../styles';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport type { ILivePreviewOptions } from '../../config';\n\nexport interface IDialogOptions {\n  title: string;\n  livePreview: boolean | keyof ILivePreviewOptions;\n  popup: boolean;\n  // popper options\n  placement?: Popper.Placement;\n  eventsEnabled?: boolean;\n  modifiers?: Popper.Modifiers;\n  toggleDialog: boolean;\n  cancelSubDialogs?: boolean;\n  autoClose?: boolean;\n}\n\nexport interface IDialogContext {\n  attachment: HTMLElement;\n  level: number;\n  manager: DialogManager;\n  idPrefix: string;\n}\n\nexport function dialogContext(\n  ctx: IRankingHeaderContext,\n  level: number,\n  attachment: HTMLElement | MouseEvent\n): IDialogContext {\n  return {\n    attachment:\n      (attachment as MouseEvent).currentTarget != null\n        ? ((attachment as MouseEvent).currentTarget as HTMLElement)\n        : (attachment as HTMLElement),\n    level,\n    manager: ctx.dialogManager,\n    idPrefix: ctx.idPrefix,\n  };\n}\n\nabstract class ADialog {\n  private readonly options: Readonly<IDialogOptions> = {\n    title: '',\n    livePreview: false,\n    popup: false,\n    placement: 'bottom-start',\n    toggleDialog: true,\n    cancelSubDialogs: false,\n    autoClose: false,\n    modifiers: {},\n  };\n\n  readonly node: HTMLFormElement;\n  private popper: Popper | null = null;\n\n  constructor(protected readonly dialog: Readonly<IDialogContext>, options: Partial<IDialogOptions> = {}) {\n    Object.assign(this.options, options);\n    this.node = dialog.attachment.ownerDocument!.createElement('form');\n    this.node.classList.add(cssClass('dialog'));\n  }\n\n  get autoClose() {\n    return this.options.autoClose;\n  }\n\n  get attachment() {\n    return this.dialog.attachment;\n  }\n\n  get level() {\n    return this.dialog.level;\n  }\n\n  protected abstract build(node: HTMLElement): boolean | void;\n\n  protected showLivePreviews() {\n    return (\n      this.options.livePreview === true ||\n      (typeof this.options.livePreview === 'string' &&\n        this.dialog.manager.livePreviews[this.options.livePreview] === true)\n    );\n  }\n\n  protected enableLivePreviews(selector: string | (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[]) {\n    if (!this.showLivePreviews()) {\n      return;\n    }\n    const submitter = () => {\n      this.submit();\n    };\n    if (typeof selector === 'string') {\n      this.forEach(selector, (n: HTMLInputElement | HTMLSelectElement) => {\n        n.addEventListener('change', submitter, { passive: true });\n      });\n    } else {\n      selector.forEach((n) => {\n        n.addEventListener('change', submitter, { passive: true });\n      });\n    }\n  }\n\n  equals(that: ADialog) {\n    return this.dialog.level === that.dialog.level && this.dialog.attachment === that.dialog.attachment;\n  }\n\n  protected appendDialogButtons() {\n    this.node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-buttons')}\">\n      <button class=\"${cssClass('dialog-button')}\" type=\"submit\" title=\"Apply\"></button>\n      <button class=\"${cssClass('dialog-button')}\" type=\"button\" title=\"Cancel\"></button>\n      <button class=\"${cssClass('dialog-button')}\" type=\"reset\" title=\"Reset to default values\"></button>\n    </div>`\n    );\n  }\n\n  open() {\n    if (this.options.toggleDialog && this.dialog.manager.removeLike(this)) {\n      return;\n    }\n    if (this.build(this.node) === false) {\n      return;\n    }\n    const parent = this.attachment.closest<HTMLElement>(`.${cssClass()}`)!;\n\n    if (this.options.title) {\n      this.node.insertAdjacentHTML('afterbegin', `<strong>${this.options.title}</strong>`);\n    }\n    if (!this.options.popup) {\n      this.appendDialogButtons();\n    }\n\n    parent.appendChild(this.node);\n    this.popper = new Popper(\n      this.attachment,\n      this.node,\n      merge(\n        {\n          modifiers: {\n            preventOverflow: {\n              boundariesElement: parent,\n            },\n          },\n        },\n        this.options\n      )\n    );\n\n    const auto = this.find<HTMLInputElement>('input[autofocus]');\n    if (auto) {\n      // delay such that it works\n      setTimeout(() => auto.focus());\n    }\n\n    const reset = this.find<HTMLButtonElement>('button[type=reset]');\n    if (reset) {\n      reset.onclick = (evt) => {\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.reset();\n        if (this.showLivePreviews()) {\n          this.submit();\n        }\n      };\n    }\n    this.node.onsubmit = (evt) => {\n      evt.stopPropagation();\n      evt.preventDefault();\n      return this.triggerSubmit();\n    };\n    const cancel = this.find<HTMLButtonElement>('button[title=Cancel]');\n    if (cancel) {\n      cancel.onclick = (evt) => {\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.cancel();\n        this.destroy('cancel');\n      };\n    }\n\n    if (this.options.cancelSubDialogs) {\n      this.node.addEventListener('click', () => {\n        this.dialog.manager.removeAboveLevel(this.dialog.level + 1);\n      });\n    }\n\n    this.dialog.manager.push(this);\n  }\n\n  protected triggerSubmit() {\n    if (!this.node.checkValidity()) {\n      return false;\n    }\n    if (this.submit() !== false) {\n      this.destroy('confirm');\n    }\n    return false;\n  }\n\n  protected find<T extends HTMLElement>(selector: string): T {\n    return this.node.querySelector<T>(selector);\n  }\n\n  protected findInput(selector: string) {\n    return this.find<HTMLInputElement>(selector);\n  }\n\n  protected forEach<M extends Element, T>(selector: string, callback: (d: M, i: number) => T): T[] {\n    return Array.from(this.node.querySelectorAll<M>(selector)).map(callback);\n  }\n\n  protected abstract reset(): void;\n\n  protected abstract submit(): boolean | undefined;\n\n  protected abstract cancel(): void;\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    if (action === 'confirm') {\n      this.submit(); // TODO what if submit wasn't successful?\n    } else if (action === 'cancel') {\n      this.cancel();\n    }\n\n    if (action !== 'handled') {\n      this.dialog.manager.triggerDialogClosed(this, action);\n    }\n\n    if (this.popper) {\n      this.popper.destroy();\n    }\n    this.node.remove();\n  }\n\n  protected destroy(action: 'cancel' | 'confirm' = 'cancel') {\n    this.dialog.manager.triggerDialogClosed(this, action);\n    this.dialog.manager.remove(this, true);\n  }\n}\n\nexport default ADialog;\n","import ADialog, { IDialogContext, IDialogOptions } from './ADialog';\n\nabstract class APopup extends ADialog {\n  constructor(dialog: Readonly<IDialogContext>, options: Partial<IDialogOptions> = {}) {\n    super(\n      dialog,\n      Object.assign(\n        {\n          popup: true,\n        },\n        options\n      )\n    );\n  }\n\n  protected submit() {\n    return true;\n  }\n\n  protected reset() {\n    // dummy\n  }\n\n  protected cancel() {\n    // dummy\n  }\n}\n\nexport default APopup;\n","import type { IDialogContext } from './ADialog';\nimport APopup from './APopup';\n\n/** @internal */\nexport interface IInputNumberOptions {\n  min: number;\n  max: number;\n  step: number | 'any';\n  value: number;\n  label: string | null;\n}\n\n/** @internal */\nexport default class InputNumberDialog extends APopup {\n  private readonly ioptions: Readonly<IInputNumberOptions> = {\n    min: NaN,\n    max: NaN,\n    step: 'any',\n    value: NaN,\n    label: null,\n  };\n\n  constructor(\n    dialog: IDialogContext,\n    private readonly callback: (value: number) => void,\n    options: Partial<IInputNumberOptions> = {}\n  ) {\n    super(dialog);\n    Object.assign(this.ioptions, options);\n  }\n\n  protected build(node: HTMLElement) {\n    const o = this.ioptions;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n     <input type=\"number\" value=\"${Number.isNaN(o.value) ? '' : String(o.value)}\" required autofocus placeholder=\"${\n        o.label ? o.label : 'enter number'\n      }\" ${Number.isNaN(o.min) ? '' : ` min=\"${o.min}\"`} ${Number.isNaN(o.max) ? '' : ` max=\"${o.max}\"`} step=\"${\n        o.step\n      }\">\n    `\n    );\n    this.enableLivePreviews('input');\n  }\n\n  submit() {\n    this.callback(this.findInput('input[type=number]').valueAsNumber);\n    return true;\n  }\n}\n","import { cssClass } from '../styles';\n\n/** @internal */\nexport interface IDragHandleOptions {\n  /**\n   * drag base container\n   * @default handle parentElement\n   */\n  container: HTMLElement | SVGElement;\n  /**\n   * filter to certain mouse events, e.g. shift only\n   */\n  filter(evt: MouseEvent): boolean;\n\n  onStart(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\n\n  onDrag(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\n\n  onEnd(handle: HTMLElement | SVGElement, x: number, delta: number, evt: MouseEvent): void;\n\n  /**\n   * minimal pixel delta\n   * @default 2\n   */\n  minDelta: number;\n}\n\n/**\n * allow to change the width of a column using dragging the handle\n * @internal\n */\nexport function dragHandle(handle: HTMLElement | SVGElement, options: Partial<IDragHandleOptions> = {}) {\n  const o: Readonly<IDragHandleOptions> = Object.assign(\n    {\n      container: handle.parentElement!,\n      filter: () => true,\n      onStart: () => undefined,\n      onDrag: () => undefined,\n      onEnd: () => undefined,\n      minDelta: 2,\n    },\n    options\n  );\n\n  let ueberElement: HTMLElement | null = null;\n\n  // converts the given x coordinate to be relative to the given element\n  const toContainerRelative = (x: number, elem: HTMLElement | SVGElement) => {\n    const rect = elem.getBoundingClientRect();\n    return x - rect.left - elem.clientLeft;\n  };\n\n  let start = 0;\n  let last = 0;\n  let handleShift = 0;\n\n  const mouseMove = (evt: MouseEvent) => {\n    if (!o.filter(evt)) {\n      return;\n    }\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\n    if (Math.abs(last - end) < o.minDelta) {\n      //ignore\n      return;\n    }\n\n    last = end;\n    o.onDrag(handle, end, last - end, evt);\n  };\n\n  const mouseUp = (evt: MouseEvent) => {\n    if (!o.filter(evt)) {\n      return;\n    }\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\n    ueberElement!.removeEventListener('mousemove', mouseMove);\n    ueberElement!.removeEventListener('mouseup', mouseUp);\n    ueberElement!.removeEventListener('mouseleave', mouseUp);\n    ueberElement!.classList.remove(cssClass('dragging'));\n\n    if (Math.abs(start - end) < 2) {\n      //ignore\n      return;\n    }\n\n    o.onEnd(handle, end, start - end, evt);\n  };\n\n  handle.onmousedown = (evt) => {\n    if (!o.filter(evt)) {\n      return;\n    }\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    handleShift = toContainerRelative(evt.clientX, handle);\n    start = last = toContainerRelative(evt.clientX, o.container) - handleShift;\n\n    // register other event listeners\n    ueberElement = handle.closest('body') || handle.closest<HTMLElement>(`.${cssClass()}`)!; // take the whole body or root lineup\n    ueberElement.addEventListener('mousemove', mouseMove);\n    ueberElement.addEventListener('mouseup', mouseUp);\n    ueberElement.addEventListener('mouseleave', mouseUp);\n    ueberElement.classList.add(cssClass('dragging'));\n\n    o.onStart(handle, start, 0, evt);\n  };\n}\n","import { DENSE_HISTOGRAM } from '../constants';\nimport { IBin, round, IDragHandleOptions, dragHandle } from '../internal';\nimport { cssClass, FILTERED_OPACITY } from '../styles';\nimport { color } from 'd3-color';\nimport { filterMissingNumberMarkup, updateFilterMissingNumberMarkup } from '../ui/missing';\n\nfunction filteredColor(input: string) {\n  const c = color(input)!;\n  c.opacity = FILTERED_OPACITY;\n  return c.toString();\n}\n\nexport function histogramTemplate(guessedBins: number) {\n  let bins = '';\n  for (let i = 0; i < guessedBins; ++i) {\n    bins += `<div class=\"${cssClass(\n      'histogram-bin'\n    )}\" title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`;\n  }\n  // no closing div to be able to append things\n  return `<div class=\"${cssClass('histogram')} ${guessedBins > DENSE_HISTOGRAM ? cssClass('dense') : ''}\">${bins}`;\n}\n\nfunction matchBins(n: HTMLElement, bins: number) {\n  //adapt the number of children\n  let nodes = Array.from(n.querySelectorAll<HTMLElement>('[data-x]'));\n  if (nodes.length > bins) {\n    nodes.splice(bins, nodes.length - bins).forEach((d) => d.remove());\n  } else if (nodes.length < bins) {\n    for (let i = nodes.length; i < bins; ++i) {\n      n.insertAdjacentHTML(\n        'afterbegin',\n        `<div class=\"${cssClass('histogram-bin')}\" title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`\n      );\n    }\n    nodes = Array.from(n.querySelectorAll('[data-x]'));\n  }\n  n.classList.toggle(cssClass('dense'), bins > DENSE_HISTOGRAM);\n  return nodes;\n}\n\nexport interface IHistogramLike<T> {\n  readonly maxBin: number;\n  readonly hist: ReadonlyArray<IBin<T>>;\n}\n\n/** @internal */\nexport function histogramUpdate<T>(\n  n: HTMLElement,\n  stats: IHistogramLike<T>,\n  unfiltered: IHistogramLike<T> | null,\n  formatter: (v: T) => string,\n  colorOf: (bin: IBin<T>) => string\n) {\n  const hist = stats.hist;\n  const nodes = matchBins(n, hist.length);\n\n  nodes.forEach((d: HTMLElement, i) => {\n    const bin = hist[i];\n    const inner = d.firstElementChild! as HTMLElement;\n    if (!bin) {\n      inner.style.height = '0%';\n      return;\n    }\n\n    const { x0, x1, count } = bin;\n    const color = colorOf(bin);\n    d.dataset.x = formatter(x0);\n\n    if (unfiltered) {\n      const gCount = (unfiltered.hist[i] || { count }).count;\n      d.title = `${formatter(x0)} - ${formatter(x1)} (${count} of ${gCount})`;\n      inner.style.height = `${round((gCount * 100) / unfiltered.maxBin, 2)}%`;\n      const relY = 100 - round((count * 100) / gCount, 2);\n      inner.style.background =\n        relY === 0\n          ? color\n          : relY === 100\n          ? filteredColor(color)\n          : `linear-gradient(${filteredColor(color)} ${relY}%, ${color} ${relY}%, ${color} 100%)`;\n    } else {\n      d.title = `${formatter(x0)} - ${formatter(x1)} (${count})`;\n      inner.style.height = `${round((count * 100) / stats.maxBin, 2)}%`;\n      inner.style.backgroundColor = color;\n    }\n  });\n}\n\n/**\n * @internal\n */\nexport function mappingHintTemplate(range: [string, string]) {\n  return `<span class=\"${cssClass('mapping-hint')}\" title=\"${range[0]}\">${range[0]}</span><span class=\"${cssClass(\n    'mapping-hint'\n  )}\" title=\"${range[1]}\">${range[1]}</span>`;\n}\n\n/**\n * @internal\n */\nexport function mappingHintUpdate(n: HTMLElement, range: [string, string]) {\n  Array.from(n.getElementsByTagName('span')).forEach((d: HTMLElement, i) => (d.textContent = range[i]));\n}\n\nexport interface IFilterContext<T> {\n  percent(v: T): number;\n  unpercent(p: number): T;\n  format(v: T): string;\n  formatRaw(v: T): string;\n  parseRaw(v: string): T;\n  setFilter(filterMissing: boolean, min: T, max: T): void;\n  edit(value: T, attachment: HTMLElement, type: 'min' | 'max'): Promise<T>;\n  domain: [T, T];\n}\n\n/** @internal */\nexport interface IFilterInfo<T> {\n  filterMissing: boolean;\n  filterMin: T;\n  filterMax: T;\n}\n\nexport function filteredHistTemplate<T>(c: IFilterContext<T>, f: IFilterInfo<T>) {\n  return `\n    <div class=\"${cssClass('histogram-min-hint')}\" style=\"width: ${c.percent(f.filterMin)}%\"></div>\n    <div class=\"${cssClass('histogram-max-hint')}\" style=\"width: ${100 - c.percent(f.filterMax)}%\"></div>\n    <div class=\"${cssClass('histogram-min')}\" data-value=\"${c.format(f.filterMin)}\" data-raw=\"${c.formatRaw(\n    f.filterMin\n  )}\" style=\"left: ${c.percent(f.filterMin)}%\" title=\"min filter, drag or double click to change\"></div>\n    <div class=\"${cssClass('histogram-max')}\" data-value=\"${c.format(f.filterMax)}\" data-raw=\"${c.formatRaw(\n    f.filterMax\n  )}\" style=\"right: ${100 - c.percent(f.filterMax)}%\" title=\"max filter, drag or double click to change\"></div>\n    ${filterMissingNumberMarkup(f.filterMissing, 0)}\n  `;\n}\n\nexport function initFilter<T>(node: HTMLElement, context: IFilterContext<T>) {\n  const min = node.getElementsByClassName(cssClass('histogram-min'))[0] as HTMLElement;\n  const max = node.getElementsByClassName(cssClass('histogram-max'))[0] as HTMLElement;\n  const minHint = node.getElementsByClassName(cssClass('histogram-min-hint'))[0] as HTMLElement;\n  const maxHint = node.getElementsByClassName(cssClass('histogram-max-hint'))[0] as HTMLElement;\n  const filterMissing = node.getElementsByTagName('input')[0] as HTMLInputElement;\n\n  const setFilter = () => {\n    const minValue = context.parseRaw(min.dataset.raw!);\n    const maxValue = context.parseRaw(max.dataset.raw!);\n    context.setFilter(filterMissing.checked, minValue, maxValue);\n  };\n\n  const minImpl = (evt: MouseEvent) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const value = context.parseRaw(min.dataset.raw!);\n\n    context.edit(value, min, 'min').then((newValue) => {\n      minHint.style.width = `${context.percent(newValue)}%`;\n      min.dataset.value = context.format(newValue);\n      min.dataset.raw = context.formatRaw(newValue);\n      min.style.left = `${context.percent(newValue)}%`;\n      min.classList.toggle(cssClass('swap-hint'), context.percent(newValue) > 15);\n      setFilter();\n    });\n  };\n\n  min.onclick = (evt) => {\n    if (!evt.shiftKey && !evt.ctrlKey) {\n      return;\n    }\n    minImpl(evt);\n  };\n  min.ondblclick = minImpl;\n\n  const maxImpl = (evt: MouseEvent) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const value = context.parseRaw(max.dataset.raw!);\n\n    context.edit(value, max, 'max').then((newValue) => {\n      maxHint.style.width = `${100 - context.percent(newValue)}%`;\n      max.dataset.value = context.format(newValue);\n      max.dataset.raw = context.formatRaw(newValue);\n      max.style.right = `${100 - context.percent(newValue)}%`;\n      max.classList.toggle(cssClass('swap-hint'), context.percent(newValue) < 85);\n      setFilter();\n    });\n  };\n\n  max.onclick = (evt) => {\n    if (!evt.shiftKey && !evt.ctrlKey) {\n      return;\n    }\n    maxImpl(evt);\n  };\n  max.ondblclick = maxImpl;\n\n  filterMissing.onchange = () => setFilter();\n\n  const options: Partial<IDragHandleOptions> = {\n    minDelta: 0,\n    filter: (evt) => evt.button === 0 && !evt.shiftKey && !evt.ctrlKey,\n    onStart: (handle) => handle.classList.add(cssClass('hist-dragging')),\n    onDrag: (handle, x) => {\n      const total = node.clientWidth;\n      const px = Math.max(0, Math.min(x, total));\n      const percent = Math.round((100 * px) / total);\n      (handle as HTMLElement).dataset.value = context.format(context.unpercent(percent));\n      (handle as HTMLElement).dataset.raw = context.formatRaw(context.unpercent(percent));\n\n      if ((handle as HTMLElement).classList.contains(cssClass('histogram-min'))) {\n        handle.style.left = `${percent}%`;\n        handle.classList.toggle(cssClass('swap-hint'), percent > 15);\n        minHint.style.width = `${percent}%`;\n        return;\n      }\n      handle.style.right = `${100 - percent}%`;\n      handle.classList.toggle(cssClass('swap-hint'), percent < 85);\n      maxHint.style.width = `${100 - percent}%`;\n    },\n    onEnd: (handle) => {\n      handle.classList.remove(cssClass('hist-dragging'));\n      setFilter();\n    },\n  };\n  dragHandle(min, options);\n  dragHandle(max, options);\n\n  return (missing: number, f: IFilterInfo<T>) => {\n    minHint.style.width = `${context.percent(f.filterMin)}%`;\n    maxHint.style.width = `${100 - context.percent(f.filterMax)}%`;\n    min.dataset.value = context.format(f.filterMin);\n    max.dataset.value = context.format(f.filterMax);\n    min.dataset.raw = context.formatRaw(f.filterMin);\n    max.dataset.raw = context.formatRaw(f.filterMax);\n    min.style.left = `${context.percent(f.filterMin)}%`;\n    max.style.right = `${100 - context.percent(f.filterMax)}%`;\n    min.classList.toggle(cssClass('swap-hint'), context.percent(f.filterMin) > 15);\n    max.classList.toggle(cssClass('swap-hint'), context.percent(f.filterMax) < 85);\n    filterMissing.checked = f.filterMissing;\n    updateFilterMissingNumberMarkup(filterMissing.parentElement as HTMLElement, missing);\n  };\n}\n","import { numberStatsBuilder, IStatistics, getNumberOfBins } from '../internal';\nimport {\n  Column,\n  IDataRow,\n  IOrderedGroup,\n  INumberColumn,\n  INumbersColumn,\n  isNumberColumn,\n  isNumbersColumn,\n  IMapAbleColumn,\n  isMapAbleColumn,\n  Ranking,\n} from '../model';\nimport InputNumberDialog from '../ui/dialogs/InputNumberDialog';\nimport { colorOf } from './impose';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IRenderTasks,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { cssClass, engineCssClass } from '../styles';\nimport {\n  histogramUpdate,\n  histogramTemplate,\n  IHistogramLike,\n  mappingHintTemplate,\n  mappingHintUpdate,\n  IFilterInfo,\n  filteredHistTemplate,\n  IFilterContext,\n  initFilter,\n} from './histogram';\nimport { noNumberFilter } from '../model/internalNumber';\nimport type DialogManager from '../ui/dialogs/DialogManager';\n\nexport default class HistogramCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Histogram';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (isNumberColumn(col) && mode !== ERenderMode.CELL) || (isNumbersColumn(col) && mode === ERenderMode.CELL);\n  }\n\n  create(col: INumbersColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const { template, render, guessedBins } = getHistDOMRenderer(col, imposer);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, row: IDataRow) => {\n        if (renderMissingDOM(n, col, row)) {\n          return;\n        }\n        const b = numberStatsBuilder([0, 1], guessedBins);\n        for (const n of col.getNumbers(row)) {\n          b.push(n);\n        }\n        const hist = b.build();\n        render(n, hist);\n      },\n    };\n  }\n\n  createGroup(col: INumberColumn, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const { template, render } = getHistDOMRenderer(col, imposer);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupNumberStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n\n          const { summary, group } = r;\n          render(n, group, summary);\n        });\n      },\n    };\n  }\n\n  createSummary(\n    col: INumberColumn,\n    context: IRenderContext,\n    interactive: boolean,\n    imposer?: IImposer\n  ): ISummaryRenderer {\n    const r = getHistDOMRenderer(col, imposer);\n\n    const staticHist = !interactive || !isMapAbleColumn(col);\n    return staticHist\n      ? staticSummary(col, context, r.template, r.render)\n      : interactiveSummary(col as IMapAbleColumn, context, r.template, r.render);\n  }\n}\n\nfunction staticSummary(\n  col: INumberColumn,\n  context: IRenderContext,\n  template: string,\n  render: (n: HTMLElement, stats: IStatistics, unfiltered?: IStatistics) => void\n) {\n  if (isMapAbleColumn(col)) {\n    template += mappingHintTemplate(col.getRange());\n  }\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      if (isMapAbleColumn(col)) {\n        mappingHintUpdate(node, col.getRange());\n      }\n\n      return context.tasks.summaryNumberStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const isMissing = !r || r.summary == null || r.summary.count === 0 || r.summary.count === r.summary.missing;\n        node.classList.toggle(cssClass('missing'), isMissing);\n        if (isMissing) {\n          return;\n        }\n        render(node, r.summary);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(\n  col: IMapAbleColumn,\n  context: IRenderContext,\n  template: string,\n  render: (n: HTMLElement, stats: IStatistics, unfiltered?: IStatistics) => void\n) {\n  const fContext = createFilterContext(col, context);\n  template += filteredHistTemplate(fContext, createFilterInfo(col));\n\n  let updateFilter: (missing: number, f: IFilterInfo<number>) => void;\n\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      if (!updateFilter) {\n        updateFilter = initFilter(node, fContext);\n      }\n      return context.tasks.summaryNumberStats(col, true /* raw */).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n\n        updateFilter(data ? data.missing : summary ? summary.missing : 0, createFilterInfo(col));\n\n        node.classList.add(cssClass('histogram-i'));\n        node.classList.toggle(cssClass('missing'), !summary);\n        if (!summary) {\n          return;\n        }\n        render(node, summary, data);\n      });\n    },\n  };\n}\n\n/** @internal */\nexport function createNumberFilter(\n  col: INumberColumn & IMapAbleColumn,\n  parent: HTMLElement,\n  context: { idPrefix: string; dialogManager: DialogManager; tasks: IRenderTasks },\n  livePreviews: boolean\n) {\n  const renderer = getHistDOMRenderer(col);\n  const fContext = createFilterContext(col, context);\n\n  parent.innerHTML = `${renderer.template}${filteredHistTemplate(fContext, createFilterInfo(col))}</div>`;\n  const summaryNode = parent.firstElementChild! as HTMLElement;\n  summaryNode.classList.add(cssClass('summary'), cssClass('renderer'));\n  summaryNode.dataset.renderer = 'histogram';\n  summaryNode.dataset.interactive = '';\n  summaryNode.classList.add(cssClass('histogram-i'));\n\n  const applyFilter = fContext.setFilter;\n  let currentFilter = createFilterInfo(col);\n  fContext.setFilter = (filterMissing, min, max) => {\n    currentFilter = { filterMissing, filterMin: min, filterMax: max };\n    if (livePreviews) {\n      applyFilter(filterMissing, min, max);\n    }\n  };\n\n  const updateFilter = initFilter(summaryNode, fContext);\n\n  const rerender = () => {\n    const ready = context.tasks.summaryNumberStats(col, true /* raw */).then((r) => {\n      if (typeof r === 'symbol') {\n        return;\n      }\n      const { summary, data } = r;\n      updateFilter(data ? data.missing : summary ? summary.missing : 0, currentFilter);\n      summaryNode.classList.toggle(cssClass('missing'), !summary);\n      if (!summary) {\n        return;\n      }\n      renderer.render(summaryNode, summary, data);\n    });\n    if (!ready) {\n      return;\n    }\n    summaryNode.classList.add(engineCssClass('loading'));\n    ready.then(() => {\n      summaryNode.classList.remove(engineCssClass('loading'));\n    });\n  };\n\n  const ranking = col.findMyRanker()!;\n\n  if (ranking) {\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, () => rerender());\n  }\n  rerender();\n\n  return {\n    cleanUp() {\n      if (ranking) {\n        ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, null);\n      }\n    },\n    reset() {\n      currentFilter = createFilterInfo(col, noNumberFilter());\n      rerender();\n    },\n    submit() {\n      applyFilter(currentFilter.filterMissing, currentFilter.filterMin, currentFilter.filterMax);\n    },\n  };\n}\n\n/** @internal */\nexport function getHistDOMRenderer(col: INumberColumn, imposer?: IImposer) {\n  const ranking = col.findMyRanker();\n  const guessedBins = ranking ? getNumberOfBins(ranking.getOrderLength()) : 10;\n  const formatter = col.getNumberFormat();\n\n  const render = (n: HTMLElement, stats: IHistogramLike<number>, unfiltered?: IHistogramLike<number>) => {\n    return histogramUpdate(\n      n,\n      stats,\n      unfiltered || null,\n      formatter,\n      (bin) => colorOf(col, null, imposer, (bin.x1 + bin.x0) / 2)!\n    );\n  };\n  return {\n    template: histogramTemplate(guessedBins),\n    render,\n    guessedBins,\n  };\n}\n\nfunction createFilterInfo(col: IMapAbleColumn, filter = col.getFilter()): IFilterInfo<number> {\n  const domain = col.getMapping().domain;\n  const filterMin = isFinite(filter.min) ? filter.min : domain[0];\n  const filterMax = isFinite(filter.max) ? filter.max : domain[1];\n  return {\n    filterMissing: filter.filterMissing,\n    filterMin,\n    filterMax,\n  };\n}\n\nfunction createFilterContext(\n  col: IMapAbleColumn,\n  context: { idPrefix: string; dialogManager: DialogManager }\n): IFilterContext<number> {\n  const domain = col.getMapping().domain;\n  const format = col.getNumberFormat();\n  const clamp = (v: number) => Math.max(0, Math.min(100, v));\n  const percent = (v: number) => clamp(Math.round((100 * (v - domain[0])) / (domain[1] - domain[0])));\n  const unpercent = (v: number) => (v / 100) * (domain[1] - domain[0]) + domain[0];\n  return {\n    percent,\n    unpercent,\n    domain: domain as [number, number],\n    format,\n    formatRaw: String,\n    parseRaw: Number.parseFloat,\n    setFilter: (filterMissing, minValue, maxValue) =>\n      col.setFilter({\n        filterMissing,\n        min: minValue === domain[0] ? Number.NEGATIVE_INFINITY : minValue,\n        max: maxValue === domain[1] ? Number.POSITIVE_INFINITY : maxValue,\n      }),\n    edit: (value, attachment) => {\n      return new Promise((resolve) => {\n        const dialogCtx = {\n          attachment,\n          manager: context.dialogManager,\n          level: context.dialogManager.maxLevel + 1,\n          idPrefix: context.idPrefix,\n        };\n        const dialog = new InputNumberDialog(dialogCtx, resolve, {\n          value,\n          min: domain[0],\n          max: domain[1],\n        });\n        dialog.open();\n      });\n    },\n  };\n}\n","import { Column, IDataRow, LinkColumn } from '../model';\nimport { ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer } from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer } from './utils';\nimport { abortAble } from 'lineupengine';\n\nfunction loadImage(src: string) {\n  return new Promise<HTMLImageElement>((resolve) => {\n    const image = new Image();\n    image.onload = () => resolve(image);\n    image.src = src;\n  });\n}\n\nexport default class ImageCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Image';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof LinkColumn && mode === ERenderMode.CELL;\n  }\n\n  create(col: LinkColumn): ICellRenderer {\n    return {\n      template: `<div></div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        const missing = renderMissingDOM(n, col, d);\n        n.style.backgroundImage = null;\n        if (missing) {\n          n.title = '';\n          return undefined;\n        }\n        const v = col.getLink(d);\n        n.title = v ? v.alt : '';\n        if (!v) {\n          return undefined;\n        }\n        return abortAble(loadImage(v.href)).then((image) => {\n          if (typeof image === 'symbol') {\n            return;\n          }\n          n.style.backgroundImage = missing || !v ? null : `url('${image.src}')`;\n        });\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { ISequence } from '../internal';\nimport type { Column, IDataRow, IOrderedGroup } from '../model';\nimport type {\n  ERenderMode,\n  ICellRenderer,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  IImposer,\n  IRenderContext,\n  ISummaryRenderer,\n} from './interfaces';\nimport { noRenderer } from './utils';\n\n/**\n * helper class that renders a group renderer as a selected (e.g. median) single item\n */\nexport abstract class AAggregatedGroupRenderer<T extends Column> implements ICellRendererFactory {\n  abstract readonly title: string;\n\n  abstract canRender(col: Column, mode: ERenderMode): boolean;\n\n  abstract create(col: T, context: IRenderContext, imposer?: IImposer): ICellRenderer;\n\n  protected abstract aggregatedIndex(rows: ISequence<IDataRow>, col: T): { row: IDataRow; index: number };\n\n  createGroup(col: T, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    const single = this.create(col, context, imposer);\n    return {\n      template: single.template,\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'aggregated', (rows) => this.aggregatedIndex(rows, col))\n          .then((data) => {\n            if (typeof data !== 'symbol') {\n              single.update(node, data.row, data.index, group);\n            }\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n\nexport default AAggregatedGroupRenderer;\n","import { ISequence, round } from '../internal';\nimport {\n  Column,\n  IDataRow,\n  INumberColumn,\n  isNumberColumn,\n  IMultiLevelColumn,\n  isMultiLevelColumn,\n  IOrderedGroup,\n} from '../model';\nimport { medianIndex } from '../model/internalNumber';\nimport { COLUMN_PADDING } from '../styles';\nimport { AAggregatedGroupRenderer } from './AAggregatedGroupRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  IImposer,\n  IRenderCallback,\n  IGroupCellRenderer,\n  ICellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { matchColumns, multiLevelGridCSSClass } from './utils';\nimport { cssClass } from '../styles';\nimport { IAbortAblePromise, abortAbleAll } from 'lineupengine';\n\n/** @internal */\nexport interface ICols {\n  column: Column;\n  shift: number;\n  width: number;\n  template: string;\n  rendererId: string;\n  renderer: ICellRenderer | null;\n  groupRenderer: IGroupCellRenderer | null;\n  summaryRenderer: ISummaryRenderer | null;\n}\n\n/**\n * @internal\n * @param parent Parent column\n * @param context Render context\n * @param stacked Are the columns stacked?\n * @param mode Render mode\n * @param imposer Imposer object\n */\nexport function createData(\n  parent: { children: Column[] } & Column,\n  context: IRenderContext,\n  stacked: boolean,\n  mode: ERenderMode,\n  imposer?: IImposer\n): { cols: ICols[]; stacked: boolean; padding: number } {\n  const padding = COLUMN_PADDING;\n  let offset = 0;\n  const cols = parent.children.map((column) => {\n    const shift = offset;\n    const width = column.getWidth();\n    offset += width;\n    offset += !stacked ? padding : 0;\n\n    const renderer = mode === ERenderMode.CELL ? context.renderer(column, imposer) : null;\n    const groupRenderer = mode === ERenderMode.GROUP ? context.groupRenderer(column, imposer) : null;\n    const summaryRenderer = mode === ERenderMode.GROUP ? context.summaryRenderer(column, false, imposer) : null;\n    let template = '';\n    let rendererId = '';\n    switch (mode) {\n      case ERenderMode.CELL:\n        template = renderer!.template;\n        rendererId = column.getRenderer();\n        break;\n      case ERenderMode.GROUP:\n        template = groupRenderer!.template;\n        rendererId = column.getGroupRenderer();\n        break;\n      case ERenderMode.SUMMARY:\n        template = summaryRenderer!.template;\n        rendererId = column.getSummaryRenderer();\n        break;\n    }\n    // inject data attributes\n    template = template.replace(\n      /^<([^ >]+)([ >])/,\n      `<$1 data-column-id=\"${column.id}\" data-renderer=\"${rendererId}\"$2`\n    );\n    // inject classes\n    if (/^<([^>]+) class=\"([ >]*)/.test(template)) {\n      // has class attribute\n      template = template.replace(/^<([^>]+) class=\"([ >]*)/, `<$1 class=\"${cssClass(`renderer-${rendererId}`)} $2`);\n    } else {\n      // inject as the others\n      template = template.replace(/^<([^ >]+)([ >])/, `<$1 class=\"${cssClass(`renderer-${rendererId}`)}\"$2`);\n    }\n    return {\n      column,\n      shift,\n      width,\n      template,\n      rendererId,\n      renderer,\n      groupRenderer,\n      summaryRenderer,\n    };\n  });\n  return { cols, stacked, padding };\n}\n\nexport default class MultiLevelCellRenderer\n  extends AAggregatedGroupRenderer<IMultiLevelColumn & Column>\n  implements ICellRendererFactory\n{\n  readonly title: string;\n\n  constructor(private readonly stacked: boolean = true) {\n    super();\n    this.title = this.stacked ? 'Stacked Bar' : 'Nested';\n  }\n\n  canRender(col: Column): boolean {\n    return isMultiLevelColumn(col);\n  }\n\n  create(col: IMultiLevelColumn & Column, context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const { cols, stacked } = createData(col, context, this.stacked, ERenderMode.CELL, imposer);\n    const width = context.colWidth(col);\n    return {\n      template: `<div class='${multiLevelGridCSSClass(context.idPrefix, col)} ${\n        !stacked ? cssClass('grid-space') : ''\n      }'>${cols.map((d) => d.template).join('')}</div>`,\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IOrderedGroup) => {\n        if (renderMissingDOM(n, col, d)) {\n          return null;\n        }\n        matchColumns(n, cols, context);\n\n        const toWait: IAbortAblePromise<void>[] = [];\n        const children = Array.from(n.children) as HTMLElement[];\n        const total = col.getWidth();\n        let missingWeight = 0;\n        cols.forEach((col, ci) => {\n          const weight = col.column.getWidth() / total;\n          const cNode = children[ci];\n          cNode.classList.add(cssClass(this.stacked ? 'stack-sub' : 'nested-sub'), cssClass('detail'));\n          cNode.dataset.group = 'd';\n          cNode.style.transform = stacked ? `translate(-${round((missingWeight / weight) * 100, 4)}%,0)` : null;\n          cNode.style.gridColumnStart = (ci + 1).toString();\n          const r = col.renderer!.update(cNode, d, i, group);\n          if (stacked) {\n            missingWeight += (1 - (col.column as INumberColumn).getNumber(d)) * weight;\n            if (ci < cols.length - 1) {\n              const span = cNode.querySelector('span');\n              if (span) {\n                span.style.overflow = 'hidden';\n              }\n            }\n          }\n          if (r) {\n            toWait.push(r);\n          }\n        });\n\n        if (toWait.length > 0) {\n          return abortAbleAll(toWait) as IAbortAblePromise<void>;\n        }\n        return null;\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, i: number, group: IOrderedGroup) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return null;\n        }\n        const toWait: { shift: number; r: IAbortAblePromise<IRenderCallback> }[] = [];\n        let stackShift = 0;\n        for (const col of cols) {\n          const cr = col.renderer!;\n          if (cr.render) {\n            const shift = col.shift - stackShift;\n            ctx.translate(shift, 0);\n            const r = cr.render(ctx, d, i, group);\n            if (typeof r !== 'boolean' && r) {\n              toWait.push({ shift, r });\n            }\n            ctx.translate(-shift, 0);\n          }\n          if (stacked) {\n            stackShift += col.width * (1 - (col.column as INumberColumn).getNumber(d));\n          }\n        }\n\n        if (toWait.length === 0) {\n          return null;\n        }\n\n        return abortAbleAll(toWait.map((d) => d.r)).then((callbacks) => {\n          return (ctx: CanvasRenderingContext2D) => {\n            if (typeof callbacks === 'symbol') {\n              return;\n            }\n            for (let i = 0; i < callbacks.length; ++i) {\n              const callback = callbacks[i];\n              if (typeof callback !== 'function') {\n                continue;\n              }\n              const shift = toWait[i].shift;\n              ctx.translate(shift, 0);\n              callback(ctx);\n              ctx.translate(-shift, 0);\n            }\n          };\n        });\n      },\n    };\n  }\n\n  createGroup(col: IMultiLevelColumn & Column, context: IRenderContext, imposer?: IImposer): IGroupCellRenderer {\n    if (this.stacked && isNumberColumn(col)) {\n      return super.createGroup(col, context, imposer);\n    }\n\n    const { cols } = createData(col, context, false, ERenderMode.GROUP, imposer);\n    return {\n      template: `<div class='${multiLevelGridCSSClass(context.idPrefix, col)} ${cssClass('grid-space')}'>${cols\n        .map((d) => d.template)\n        .join('')}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        matchColumns(n, cols, context);\n\n        const toWait: IAbortAblePromise<void>[] = [];\n        const children = Array.from(n.children) as HTMLElement[];\n        cols.forEach((col, ci) => {\n          const cnode = children[ci];\n          cnode.classList.add(cssClass(this.stacked ? 'stack-sub' : 'nested-sub'), cssClass('group'));\n          cnode.dataset.group = 'g';\n          cnode.style.gridColumnStart = (ci + 1).toString();\n          const r = col.groupRenderer!.update(cnode, group);\n          if (r) {\n            toWait.push(r);\n          }\n        });\n\n        if (toWait.length > 0) {\n          return abortAbleAll(toWait) as IAbortAblePromise<void>;\n        }\n        return null;\n      },\n    };\n  }\n\n  protected aggregatedIndex(rows: ISequence<IDataRow>, col: IMultiLevelColumn & Column) {\n    console.assert(isNumberColumn(col));\n    return medianIndex(rows, col as any as INumberColumn);\n  }\n}\n","import type { INumberBin, IStatistics } from '../internal';\nimport { Column, CompositeNumberColumn, IDataRow, IOrderedGroup, INumberColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { getHistDOMRenderer } from './HistogramCellRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { createData } from './MultiLevelCellRenderer';\nimport { colorOf, matchColumns, forEachChild } from './utils';\nimport { tasksAll } from '../provider';\nimport type { IHistogramLike } from './histogram';\n\nexport default class InterleavingCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Interleaved';\n\n  canRender(col: Column) {\n    return col instanceof CompositeNumberColumn;\n  }\n\n  create(col: CompositeNumberColumn, context: IRenderContext): ICellRenderer {\n    const { cols } = createData(col, context, false, ERenderMode.CELL);\n    const width = context.colWidth(col);\n    return {\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IOrderedGroup) => {\n        const missing = renderMissingDOM(n, col, d);\n        if (missing) {\n          return;\n        }\n        matchColumns(n, cols, context);\n        forEachChild(n, (ni: HTMLElement, j) => {\n          cols[j].renderer!.update(ni, d, i, group);\n        });\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, _i: number, group: IOrderedGroup) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n\n        ctx.save();\n        ctx.scale(1, 1 / cols.length); // scale since internal use the height, too\n        cols.forEach((r, i) => {\n          const rr = r.renderer!;\n          if (rr.render) {\n            rr.render(ctx, d, i, group);\n          }\n          ctx.translate(0, CANVAS_HEIGHT);\n        });\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(col: CompositeNumberColumn, context: IRenderContext): IGroupCellRenderer {\n    const { cols } = createData(col, context, false, ERenderMode.GROUP);\n    return {\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        matchColumns(n, cols, context);\n        forEachChild(n, (ni: HTMLElement, j) => {\n          cols[j].groupRenderer!.update(ni, group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: CompositeNumberColumn, context: IRenderContext, _interactive: boolean): ISummaryRenderer {\n    const cols = col.children;\n    let acc = 0;\n    const { template, render } = getHistDOMRenderer(col, {\n      color: () => colorOf(cols[acc++ % cols.length]),\n    });\n    return {\n      template,\n      update: (n: HTMLElement) => {\n        const tasks = cols.map((col) => context.tasks.summaryNumberStats(col as INumberColumn));\n\n        return tasksAll(tasks).then((vs) => {\n          if (typeof vs === 'symbol') {\n            return;\n          }\n          const summaries = vs.map((d) => d.summary);\n          if (!summaries.some(Boolean)) {\n            n.classList.add(cssClass('missing'));\n            return;\n          }\n          n.classList.remove(cssClass('missing'));\n          const grouped = groupedHist(summaries)!;\n          render(n, grouped);\n        });\n      },\n    };\n  }\n}\n\nconst dummyBin: INumberBin = {\n  count: 0,\n  x0: 0,\n  x1: 0,\n};\n\nfunction groupedHist(stats: (IStatistics | null)[]): IHistogramLike<number> | null {\n  const sample = stats.find(Boolean)!;\n  if (!sample) {\n    return null;\n  }\n\n  const bins = sample.hist.length;\n  // assert all have the same bin size\n  const hist: INumberBin[] = [];\n  let maxBin = 0;\n  for (let i = 0; i < bins; ++i) {\n    for (const s of stats) {\n      const bin = s ? s.hist[i] : null;\n      if (!bin) {\n        hist.push(dummyBin);\n        continue;\n      }\n      if (bin.count > maxBin) {\n        maxBin = bin.count;\n      }\n      hist.push(bin);\n    }\n  }\n  return {\n    maxBin,\n    hist,\n  };\n}\n","import { LinkColumn, Column, IDataRow, IOrderedGroup } from '../model';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\nimport { cssClass } from '../styles';\nimport type { ISequence } from '../internal';\n\nexport default class LinkCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Link';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof LinkColumn && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: LinkColumn): ICellRenderer {\n    const align = col.alignment || 'left';\n    return {\n      template: `<a${\n        align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''\n      } target=\"_blank\" rel=\"noopener\" href=\"\"></a>`,\n      update: (n: HTMLAnchorElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        const v = col.getLink(d);\n        n.href = v ? v.href : '';\n        if (col.escape) {\n          setText(n, v ? v.alt : '');\n        } else {\n          n.innerHTML = v ? v.alt : '';\n        }\n      },\n    };\n  }\n\n  private static exampleText(col: LinkColumn, rows: ISequence<IDataRow>) {\n    const numExampleRows = 5;\n    const examples: string[] = [];\n    rows.every((row) => {\n      const v = col.getLink(row);\n      if (!v) {\n        return true;\n      }\n      examples.push(`<a target=\"_blank\" rel=\"noopener\"  href=\"${v.href}\">${v.alt}</a>`);\n      return examples.length < numExampleRows;\n    });\n    if (examples.length === 0) {\n      return '';\n    }\n    return `${examples.join(', ')}${examples.length < rows.length ? ', &hellip;' : ''}`;\n  }\n\n  createGroup(col: LinkColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupExampleRows(col, group, 'link', (rows) => LinkCellRenderer.exampleText(col, rows))\n          .then((text) => {\n            if (typeof text === 'symbol') {\n              return;\n            }\n            n.classList.toggle(cssClass('missing'), !text);\n            n.innerHTML = text;\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import {\n  IArrayColumn,\n  IKeyValue,\n  IMapColumn,\n  isArrayColumn,\n  isMapColumn,\n  Column,\n  IDataRow,\n  isMissingValue,\n  IOrderedGroup,\n} from '../model';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { forEach, noop } from './utils';\nimport { cssClass } from '../styles';\nimport type { ISequence } from '../internal';\n\nexport default class TableCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Table';\n\n  canRender(col: Column) {\n    return isMapColumn(col);\n  }\n\n  create(col: IMapColumn<any>): ICellRenderer {\n    if (isArrayColumn(col) && col.dataLength) {\n      // fixed length optimized rendering\n      return this.createFixed(col);\n    }\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        node.innerHTML = col\n          .getMapLabel(d)\n          .map(\n            ({ key, value }) =>\n              `<div class=\"${cssClass('table-cell')}\">${key}</div><div class=\"${cssClass('table-cell')}\">${value}</div>`\n          )\n          .join('');\n      },\n    };\n  }\n\n  private static template(col: IArrayColumn<any>) {\n    const labels = col.labels;\n    return `<div>${labels\n      .map(\n        (l) => `<div class=\"${cssClass('table-cell')}\">${l}</div><div  class=\"${cssClass('table-cell')}\" data-v></div>`\n      )\n      .join('\\n')}</div>`;\n  }\n\n  private createFixed(col: IArrayColumn<any>) {\n    return {\n      template: TableCellRenderer.template(col),\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        const value = col.getLabels(d);\n        forEach(node, '[data-v]', (n: HTMLElement, i) => {\n          n.innerHTML = value[i];\n        });\n      },\n    };\n  }\n\n  private static example(arr: IKeyValue<string>[]) {\n    const numExampleRows = 5;\n    return `${arr\n      .slice(0, numExampleRows)\n      .map((d) => d.value)\n      .join(', ')}${numExampleRows < arr.length ? ', &hellip;' : ''}`;\n  }\n\n  createGroup(col: IMapColumn<any>, context: IRenderContext): IGroupCellRenderer {\n    if (isArrayColumn(col) && col.dataLength) {\n      // fixed length optimized rendering\n      return this.createFixedGroup(col, context);\n    }\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'table', (rows) => groupByKey(rows.map((d) => col.getMapLabel(d))))\n          .then((entries) => {\n            if (typeof entries === 'symbol') {\n              return;\n            }\n            node.innerHTML = entries\n              .map(\n                ({ key, values }) =>\n                  `<div class=\"${cssClass('table-cell')}\">${key}</div><div class=\"${cssClass(\n                    'table-cell'\n                  )}\">${TableCellRenderer.example(values)}</div>`\n              )\n              .join('');\n          });\n      },\n    };\n  }\n\n  private createFixedGroup(col: IArrayColumn<any>, context: IRenderContext) {\n    return {\n      template: TableCellRenderer.template(col),\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupExampleRows(col, group, 'table', (rows) => {\n            const values: string[][] = col.labels.map(() => []);\n            rows.forEach((row) => {\n              const labels = col.getLabels(row);\n              for (let i = 0; i < Math.min(values.length, labels.length); ++i) {\n                if (!isMissingValue(labels[i])) {\n                  values[i].push(labels[i]);\n                }\n              }\n            });\n            return values;\n          })\n          .then((values) => {\n            if (typeof values === 'symbol') {\n              return;\n            }\n            forEach(node, '[data-v]', (n: HTMLElement, i) => {\n              n.innerHTML = `${values[i].join(', ')}&hellip;`;\n            });\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"><div>Key</div><div>Value</div></div>`,\n      update: noop,\n    };\n  }\n}\n\n/** @internal */\nexport function groupByKey<T extends { key: string }>(arr: ISequence<ISequence<T>>) {\n  const m = new Map<string, T[]>();\n  arr.forEach((a) =>\n    a.forEach((d) => {\n      if (!m.has(d.key)) {\n        m.set(d.key, [d]);\n      } else {\n        m.get(d.key)!.push(d);\n      }\n    })\n  );\n  return Array.from(m)\n    .sort((a, b) => a[0].localeCompare(b[0]))\n    .map(([key, values]) => ({ key, values }));\n}\n","import { IDataRow, LinkMapColumn, Column, ILink, IKeyValue, IOrderedGroup } from '../model';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { groupByKey } from './TableCellRenderer';\nimport { noRenderer, noop } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class LinkMapCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Table with Links';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return col instanceof LinkMapColumn && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: LinkMapColumn): ICellRenderer {\n    const align = col.alignment || 'left';\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        node.innerHTML = col\n          .getLinkMap(d)\n          .map(\n            ({ key, value }) => `\n          <div class=\"${cssClass('table-cell')}\">${key}</div>\n          <div class=\"${cssClass('table-cell')} ${align !== 'left' ? cssClass(align) : ''}\">\n            <a href=\"${value.href}\" target=\"_blank\" rel=\"noopener\">${value.alt}</a>\n          </div>`\n          )\n          .join('');\n      },\n      render: noop,\n    };\n  }\n\n  private static example(arr: IKeyValue<ILink>[]) {\n    const numExampleRows = 5;\n    const examples: string[] = [];\n    for (const row of arr) {\n      if (!row || !row.value.href) {\n        continue;\n      }\n      examples.push(`<a target=\"_blank\" rel=\"noopener\" href=\"${row.value.href}\">${row.value.alt}</a>`);\n      if (examples.length >= numExampleRows) {\n        break;\n      }\n    }\n    if (examples.length === 0) {\n      return '';\n    }\n    return `${examples.join(', ')}${examples.length < arr.length} ? ', &hellip;': ''}`;\n  }\n\n  createGroup(col: LinkMapColumn, context: IRenderContext): IGroupCellRenderer {\n    const align = col.alignment || 'left';\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks\n          .groupRows(col, group, 'linkmap', (rows) => groupByKey(rows.map((d) => col.getLinkMap(d))))\n          .then((entries) => {\n            if (typeof entries === 'symbol') {\n              return;\n            }\n            node.innerHTML = entries\n              .map(({ key, values }) => {\n                const data = LinkMapCellRenderer.example(values);\n                if (!data) {\n                  return `<div>${key}</div><div class=\"${cssClass('missing')}\"></div>`;\n                }\n                return `<div>${key}</div><div${align !== 'left' ? ` class=\"${cssClass(align)}\"` : ''}>${data}</div>`;\n              })\n              .join('');\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer } from './interfaces';\nimport { noop } from './utils';\n\nexport default class LoadingCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Loading';\n\n  canRender(): boolean {\n    return false; // just direct selection\n  }\n\n  create() {\n    // no typing because ICellRenderer would not be assignable to IGroupCellRenderer and ISummaryRenderer\n    return {\n      template: `<div>Loading &hellip;</div>`,\n      update: noop as () => void,\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return this.create();\n  }\n\n  createSummary(): ISummaryRenderer {\n    return this.create();\n  }\n}\n","import { round } from '../internal';\nimport {\n  Column,\n  IMapColumn,\n  IMapAbleColumn,\n  isMapAbleColumn,\n  isMapColumn,\n  IDataRow,\n  isNumberColumn,\n  INumberColumn,\n} from '../model';\nimport { colorOf } from './impose';\nimport {\n  ICellRendererFactory,\n  IImposer,\n  IRenderContext,\n  ERenderMode,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class MapBarCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Bar Table';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (\n      isMapColumn(col) &&\n      isNumberColumn(col) &&\n      (mode === ERenderMode.CELL || (mode === ERenderMode.SUMMARY && isMapAbleColumn(col)))\n    );\n  }\n\n  create(col: IMapColumn<number> & INumberColumn, _context: IRenderContext, imposer?: IImposer): ICellRenderer {\n    const formatter = col.getNumberFormat();\n\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"></div>`,\n      update: (node: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(node, col, d)) {\n          return;\n        }\n        node.innerHTML = col\n          .getMap(d)\n          .map(({ key, value }) => {\n            if (Number.isNaN(value)) {\n              return `<div class=\"${cssClass('table-cell')}\">${key}</div><div class=\"${cssClass(\n                'table-cell'\n              )} ${cssClass('missing')}\"></div>`;\n            }\n            const w = round(value * 100, 2);\n            return `<div class=\"${cssClass('table-cell')}\">${key}</div>\n            <div class=\"${cssClass('table-cell')}\" title=\"${formatter(value)}\">\n              <div style=\"width: ${w}%; background-color: ${colorOf(col, d, imposer)}\">\n                <span class=\"${cssClass('hover-only')}\">${value}</span>\n              </div>\n            </div>`;\n          })\n          .join('');\n      },\n    };\n  }\n\n  createGroup(): IGroupCellRenderer {\n    return noRenderer;\n  }\n\n  createSummary(col: IMapColumn<number> & IMapAbleColumn): ISummaryRenderer {\n    return {\n      template: `<div class=\"${cssClass('rtable')}\"><div>Key</div><div><span></span><span></span>Value</div></div>`,\n      update: (node: HTMLElement) => {\n        const range = col.getRange();\n        const value = node.lastElementChild! as HTMLElement;\n        value.firstElementChild!.textContent = range[0];\n        value.children[1]!.textContent = range[1];\n      },\n    };\n  }\n}\n","import { Column, RankColumn, IDataRow, IOrderedGroup } from '../model';\nimport type { ICellRendererFactory, ISummaryRenderer, IGroupCellRenderer, ICellRenderer } from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noRenderer, setText } from './utils';\nimport { cssClass } from '../styles';\n\nexport default class RankCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column) {\n    return col instanceof RankColumn;\n  }\n\n  create(col: Column): ICellRenderer {\n    return {\n      template: `<div class=\"${cssClass('right')}\"> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        setText(n, col.getLabel(d));\n      },\n    };\n  }\n\n  createGroup(col: Column): IGroupCellRenderer {\n    const ranking = col.findMyRanker()!;\n    return {\n      template: `<div><div></div><div></div></div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        const fromTSpan = n.firstElementChild! as HTMLElement;\n        const toTSpan = n.lastElementChild! as HTMLElement;\n        if (group.order.length === 0) {\n          fromTSpan.textContent = '';\n          toTSpan.textContent = '';\n          return;\n        }\n        fromTSpan.textContent = ranking.getRank(group.order[0]).toString();\n        toTSpan.textContent = ranking.getRank(group.order[group.order.length - 1]).toString();\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, SelectionColumn, IDataRow, IOrderedGroup } from '../model';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { cssClass } from '../styles';\nimport { everyIndices } from '../model/internal';\nimport { rangeSelection } from '../provider/utils';\n\nexport default class SelectionRenderer implements ICellRendererFactory {\n  readonly title: string = 'Default';\n\n  canRender(col: Column) {\n    return col instanceof SelectionColumn;\n  }\n\n  create(col: SelectionColumn, ctx: IRenderContext): ICellRenderer {\n    return {\n      template: `<div></div>`,\n      update: (n: HTMLElement, d: IDataRow, i: number) => {\n        n.onclick = function (event) {\n          event.preventDefault();\n          event.stopPropagation();\n          if (event.shiftKey) {\n            const ranking = col.findMyRanker()!.id;\n            if (rangeSelection(ctx.provider, ranking, d.i, i, event.ctrlKey)) {\n              return;\n            }\n          }\n\n          col.toggleValue(d);\n        };\n      },\n    };\n  }\n\n  createGroup(col: SelectionColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div></div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        let selected = 0;\n        let unselected = 0;\n        const total = group.order.length;\n        everyIndices(group.order, (i) => {\n          const s = context.provider.isSelected(i);\n          if (s) {\n            selected++;\n          } else {\n            unselected++;\n          }\n          if (selected * 2 > total || unselected * 2 > total) {\n            // more than half already, can abort already decided\n            return false;\n          }\n          return true;\n        });\n\n        n.classList.toggle(cssClass('group-selected'), selected * 2 > total);\n        n.onclick = function (event) {\n          event.preventDefault();\n          event.stopPropagation();\n          const value = n.classList.toggle(cssClass('group-selected'));\n          col.setValues(group.order, value);\n        };\n      },\n    };\n  }\n\n  createSummary(col: SelectionColumn, context: IRenderContext): ISummaryRenderer {\n    const unchecked = cssClass('icon-unchecked');\n    const checked = cssClass('icon-checked');\n    return {\n      template: `<div title=\"(Un)Select All\" class=\"${unchecked}\"></div>`,\n      update: (node: HTMLElement) => {\n        node.onclick = (evt) => {\n          evt.stopPropagation();\n          const isUnchecked = node.classList.contains(unchecked);\n          if (isUnchecked) {\n            context.provider.selectAllOf(col.findMyRanker()!);\n            node.classList.remove(unchecked);\n            node.classList.add(checked);\n          } else {\n            context.provider.setSelection([]);\n            node.classList.remove(checked);\n            node.classList.add(unchecked);\n          }\n        };\n      },\n    };\n  }\n}\n","import { Column, ICategoricalLikeColumn, IDataRow, IOrderedGroup, ISetColumn, isSetColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport type {\n  ICellRendererFactory,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\nimport { forEachChild, noop, wideEnoughCat } from './utils';\nimport { round } from '../internal';\n\nexport default class SetCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Matrix';\n\n  canRender(col: Column): boolean {\n    return isSetColumn(col);\n  }\n\n  private static createDOMContext(col: ICategoricalLikeColumn) {\n    const categories = col.categories;\n    const mapping = col.getColorMapping();\n    let templateRows = '';\n    for (const cat of categories) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" title=\"${\n        cat.label\n      }\" style=\"background-color: ${mapping.apply(cat)}\"></div>`;\n    }\n    return {\n      templateRow: templateRows,\n      render: (n: HTMLElement, value: (number | boolean)[]) => {\n        forEachChild(n, (d: HTMLElement, i) => {\n          const v = value[i];\n          d.style.opacity = typeof v === 'boolean' ? (v ? '1' : '0') : round(v, 2).toString();\n        });\n      },\n    };\n  }\n\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\n    const { templateRow, render } = SetCellRenderer.createDOMContext(col);\n    const width = context.colWidth(col);\n    const cellDimension = width / col.dataLength!;\n    const cats = col.categories;\n    const mapping = col.getColorMapping();\n\n    return {\n      template: `<div class=\"${cssClass('heatmap')}\">${templateRow}</div>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        render(n, col.getValues(d));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        // Circle\n        const data = col.getValues(d);\n\n        ctx.save();\n        cats.forEach((d, j) => {\n          if (!data[j]) {\n            return;\n          }\n          const posX = j * cellDimension;\n          ctx.fillStyle = mapping.apply(d);\n          ctx.fillRect(posX, 0, cellDimension, CANVAS_HEIGHT);\n        });\n\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(col: ISetColumn, context: IRenderContext): IGroupCellRenderer {\n    const { templateRow, render } = SetCellRenderer.createDOMContext(col);\n    return {\n      template: `<div class=\"${cssClass('heatmap')}\">${templateRow}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || !r.group || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          render(\n            n,\n            r.group.hist.map((d) => d.count / r.group.maxBin)\n          );\n        });\n      },\n    };\n  }\n\n  createSummary(col: ICategoricalLikeColumn): ISummaryRenderer {\n    const categories = col.categories;\n    const mapping = col.getColorMapping();\n    let templateRows = `<div class=\"${cssClass('heatmap')}\">`;\n    const labels = wideEnoughCat(col);\n    for (const cat of categories) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" title=\"${cat.label}\"${\n        labels ? ` data-title=\"${cat.label}\"` : ''\n      } style=\"background-color: ${mapping.apply(cat)}\"></div>`;\n    }\n    templateRows += '</div>';\n    return {\n      template: templateRows,\n      update: noop,\n    };\n  }\n}\n","import {\n  Column,\n  INumbersColumn,\n  NumbersColumn,\n  isNumbersColumn,\n  IDataRow,\n  IOrderedGroup,\n  isMissingValue,\n} from '../model';\nimport { matchRows } from './ANumbersCellRenderer';\nimport {\n  IRenderContext,\n  ERenderMode,\n  ICellRendererFactory,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { forEachChild, noRenderer } from './utils';\nimport type { ISequence } from '../internal';\nimport { cssClass } from '../styles';\n\n/** @internal */\nexport function line(data: ISequence<number>) {\n  if (data.length === 0) {\n    return '';\n  }\n  let p = '';\n  let moveNext = true;\n\n  data.forEach((d, i) => {\n    if (Number.isNaN(d)) {\n      moveNext = true;\n    } else if (moveNext) {\n      p += `M${i},${1 - d} `;\n      moveNext = false;\n    } else {\n      p += `L${i},${1 - d} `;\n    }\n  });\n  return p;\n}\n\nexport default class SparklineCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Sparkline';\n\n  canRender(col: Column, mode: ERenderMode) {\n    return isNumbersColumn(col) && mode !== ERenderMode.SUMMARY;\n  }\n\n  create(col: INumbersColumn): ICellRenderer {\n    const dataLength = col.dataLength!;\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\n    return {\n      template: `<svg viewBox=\"0 0 ${dataLength - 1} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${\n        dataLength - 1\n      }\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        const data = col.getNumbers(d);\n        n.lastElementChild!.setAttribute('d', line(data));\n      },\n    };\n  }\n\n  createGroup(col: INumbersColumn, context: IRenderContext): IGroupCellRenderer {\n    const dataLength = col.dataLength!;\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\n    return {\n      template: `<svg viewBox=\"0 0 ${dataLength} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${\n        dataLength - 1\n      }\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        //overlapping ones\n        matchRows(n, group.order.length, `<path></path>`);\n        return context.tasks\n          .groupRows(col, group, 'numbers', (r) => Array.from(r.map((d) => col.getNumbers(d))))\n          .then((vs) => {\n            if (typeof vs === 'symbol') {\n              return;\n            }\n            const isMissing = vs.length === 0 || vs.every((v) => v.every(isMissingValue));\n            n.classList.toggle(cssClass('missing'), isMissing);\n            if (isMissing) {\n              return;\n            }\n            forEachChild(n, (row, i) => {\n              row.setAttribute('d', line(vs[i]));\n            });\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, IDataRow, IOrderedGroup, ISetColumn, isSetColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass, UPSET } from '../styles';\nimport type {\n  ICellRendererFactory,\n  IRenderContext,\n  ISummaryRenderer,\n  IGroupCellRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingCanvas, renderMissingDOM } from './missing';\n\nexport default class UpSetCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'UpSet';\n\n  canRender(col: Column) {\n    return isSetColumn(col);\n  }\n\n  private static calculateSetPath(setData: boolean[], cellDimension: number) {\n    const catindexes: number[] = [];\n    setData.forEach((d: boolean, i: number) => (d ? catindexes.push(i) : -1));\n\n    const left = catindexes[0] * cellDimension + cellDimension / 2;\n    const right = catindexes[catindexes.length - 1] * cellDimension + cellDimension / 2;\n\n    return { left, right };\n  }\n\n  private static createDOMContext(col: ISetColumn) {\n    const categories = col.categories;\n    let templateRows = '';\n    for (const cat of categories) {\n      templateRows += `<div class=\"${cssClass('upset-dot')}\" title=\"${cat.label}\"></div>`;\n    }\n    return {\n      template: `<div><div class=\"${cssClass('upset-line')}\"></div>${templateRows}</div>`,\n      render: (n: HTMLElement, value: boolean[]) => {\n        Array.from(n.children)\n          .slice(1)\n          .forEach((d, i) => {\n            const v = value[i];\n            d.classList.toggle(cssClass('enabled'), v);\n          });\n\n        const line = n.firstElementChild as HTMLElement;\n        const left = value.findIndex((d) => d);\n        const right = value.length - 1 - value.reverse().findIndex((d) => d);\n\n        if (left < 0 || left === right) {\n          line.style.display = 'none';\n          return;\n        }\n        line.style.display = null;\n        line.style.left = `${Math.round((100 * (left + 0.5)) / value.length)}%`;\n        line.style.width = `${Math.round((100 * (right - left)) / value.length)}%`;\n      },\n    };\n  }\n\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\n    const { template, render } = UpSetCellRenderer.createDOMContext(col);\n    const width = context.colWidth(col);\n    const cellDimension = width / col.categories.length;\n\n    return {\n      template,\n      update: (n: HTMLElement, d: IDataRow) => {\n        if (renderMissingDOM(n, col, d)) {\n          return;\n        }\n        render(n, col.getValues(d));\n      },\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\n        if (renderMissingCanvas(ctx, col, d, width)) {\n          return;\n        }\n        // Circle\n        const data = col.getValues(d);\n\n        const hasTrueValues = data.some((d) => d); //some values are true?\n\n        ctx.save();\n        ctx.fillStyle = UPSET.color;\n        ctx.strokeStyle = UPSET.color;\n        if (hasTrueValues) {\n          const { left, right } = UpSetCellRenderer.calculateSetPath(data, cellDimension);\n          ctx.beginPath();\n          ctx.moveTo(left, CANVAS_HEIGHT / 2);\n          ctx.lineTo(right, CANVAS_HEIGHT / 2);\n          ctx.stroke();\n        }\n\n        data.forEach((d, j) => {\n          const posX = j * cellDimension;\n          ctx.beginPath();\n          ctx.globalAlpha = d ? 1 : UPSET.inactive;\n          ctx.fillRect(posX, 0, cellDimension, CANVAS_HEIGHT);\n          ctx.fill();\n        });\n\n        ctx.restore();\n      },\n    };\n  }\n\n  createGroup(col: ISetColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, render } = UpSetCellRenderer.createDOMContext(col);\n    return {\n      template,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupCategoricalStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          render(\n            n,\n            r.group.hist.map((d) => d.count > 0)\n          );\n        });\n      },\n    };\n  }\n\n  createSummary(col: ISetColumn, context: IRenderContext): ISummaryRenderer {\n    const { template, render } = UpSetCellRenderer.createDOMContext(col);\n    return {\n      template,\n      update: (n: HTMLElement) => {\n        return context.tasks.summaryCategoricalStats(col).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          render(\n            n,\n            r.summary.hist.map((d) => d.count > 0)\n          );\n        });\n      },\n    };\n  }\n}\n","import { Column, NumbersColumn, IDataRow, INumbersColumn, isNumbersColumn } from '../model';\nimport { CANVAS_HEIGHT, cssClass } from '../styles';\nimport { ANumbersCellRenderer } from './ANumbersCellRenderer';\nimport { toHeatMapColor } from './BrightnessCellRenderer';\nimport { IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ISummaryRenderer } from './interfaces';\nimport { forEachChild, noRenderer } from './utils';\n\nexport default class VerticalBarCellRenderer extends ANumbersCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Bar Chart';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return isNumbersColumn(col) && Boolean(col.dataLength) && mode === ERenderMode.CELL;\n  }\n\n  private static compute(v: number, threshold: number, domain: number[]) {\n    if (v < threshold) {\n      //threshold to down\n      return { height: threshold - v, bottom: v - domain[0] };\n    }\n    //from top to down\n    return { height: v - threshold, bottom: threshold - domain[0] };\n  }\n\n  protected createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer) {\n    const cellDimension = context.colWidth(col) / col.dataLength!;\n    const threshold = col.getMapping().apply(NumbersColumn.CENTER);\n    const range = 1;\n    let templateRows = '';\n    for (let i = 0; i < col.dataLength!; ++i) {\n      templateRows += `<div class=\"${cssClass('heatmap-cell')}\" style=\"background-color: white\" title=\"\"></div>`;\n    }\n    const formatter = col.getNumberFormat();\n\n    return {\n      clazz: cssClass('heatmap'),\n      templateRow: templateRows,\n      update: (row: HTMLElement, data: number[], raw: number[], item: IDataRow, tooltipPrefix?: string) => {\n        const zero = toHeatMapColor(0, item, col, imposer);\n        const one = toHeatMapColor(1, item, col, imposer);\n\n        forEachChild(row, (d: HTMLElement, i) => {\n          const v = data[i];\n          const { bottom, height } = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\n          d.title = `${tooltipPrefix || ''}${formatter(raw[i])}`;\n          d.style.backgroundColor = v < threshold ? zero : one;\n          d.style.bottom = `${Math.round((100 * bottom) / range)}%`;\n          d.style.height = `${Math.round((100 * height) / range)}%`;\n        });\n      },\n      render: (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow) => {\n        const zero = toHeatMapColor(0, item, col, imposer);\n        const one = toHeatMapColor(1, item, col, imposer);\n        const scale = CANVAS_HEIGHT / range;\n        data.forEach((v, j) => {\n          ctx.fillStyle = v < threshold ? zero : one;\n          const xpos = j * cellDimension;\n          const { bottom, height } = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\n          ctx.fillRect(xpos, (range - height - bottom) * scale, cellDimension, height * scale);\n        });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import { Column, IDataRow, DateColumn, IOrderedGroup } from '../model';\nimport type {\n  IRenderContext,\n  ICellRendererFactory,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  ICellRenderer,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { noop, noRenderer, setText, exampleText } from './utils';\nimport { chooseAggregatedDate } from '../model/internalDate';\nimport { cssClass } from '../styles';\n\nexport default class DateCellRenderer implements ICellRendererFactory {\n  title = 'Date';\n  groupTitle = 'Date';\n  summaryTitle = 'Date';\n\n  canRender(col: Column): boolean {\n    return col instanceof DateColumn;\n  }\n\n  create(col: DateColumn): ICellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, d: IDataRow) => {\n        renderMissingDOM(n, col, d);\n        setText(n, col.getLabel(d));\n      },\n      render: noop,\n    };\n  }\n\n  createGroup(col: DateColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template: `<div> </div>`,\n      update: (n: HTMLDivElement, group: IOrderedGroup) => {\n        const isGrouped = col.isGroupedBy() >= 0;\n        if (isGrouped) {\n          return context.tasks\n            .groupRows(col, group, 'date', (rows) => chooseAggregatedDate(rows, col.getDateGrouper(), col))\n            .then((chosen) => {\n              if (typeof chosen === 'symbol') {\n                return;\n              }\n              n.classList.toggle(cssClass('missing'), !chosen);\n              setText(n, chosen ? chosen.name : '');\n            });\n        }\n        return context.tasks\n          .groupExampleRows(col, group, 'date', (sample) => exampleText(col, sample))\n          .then((text) => {\n            if (typeof text === 'symbol') {\n              return;\n            }\n            n.classList.toggle(cssClass('missing'), !text);\n            setText(n, text);\n          });\n      },\n    };\n  }\n\n  createSummary(): ISummaryRenderer {\n    return noRenderer;\n  }\n}\n","import type { IDialogContext } from './ADialog';\nimport { timeFormat } from 'd3-time-format';\nimport APopup from './APopup';\n\n/** @internal */\nexport interface IInputDateOptions {\n  value: Date | null;\n  label: string | null;\n}\n\n/** @internal */\nexport default class InputDateDialog extends APopup {\n  private readonly ioptions: Readonly<IInputDateOptions> = {\n    value: null,\n    label: null,\n  };\n\n  constructor(\n    dialog: IDialogContext,\n    private readonly callback: (value: Date | null) => void,\n    options: Partial<IInputDateOptions> = {}\n  ) {\n    super(dialog);\n    Object.assign(this.ioptions, options);\n  }\n\n  protected build(node: HTMLElement) {\n    const o = this.ioptions;\n\n    const f = timeFormat('%Y-%m-%d');\n\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n     <input type=\"date\" value=\"${o.value ? f(o.value) : ''}\" required autofocus placeholder=\"${\n        o.label ? o.label : 'enter date'\n      }\">\n    `\n    );\n    this.findInput('input[type=date]').addEventListener('keypress', (evt) => {\n      if (evt.key === 'Enter') {\n        this.triggerSubmit();\n      }\n    });\n    this.enableLivePreviews('input');\n  }\n\n  submit() {\n    this.callback(this.findInput('input[type=date]').valueAsDate);\n    return true;\n  }\n}\n","import { dateStatsBuilder, IDateStatistics } from '../internal';\nimport {\n  Column,\n  IDataRow,\n  IDateColumn,\n  IDatesColumn,\n  IOrderedGroup,\n  isDateColumn,\n  isDatesColumn,\n  Ranking,\n} from '../model';\nimport { cssClass, engineCssClass } from '../styles';\nimport {\n  ERenderMode,\n  ICellRendererFactory,\n  IRenderContext,\n  ICellRenderer,\n  IGroupCellRenderer,\n  ISummaryRenderer,\n  IRenderTasks,\n} from './interfaces';\nimport { renderMissingDOM } from './missing';\nimport { colorOf } from './utils';\nimport {\n  histogramUpdate,\n  histogramTemplate,\n  mappingHintTemplate,\n  mappingHintUpdate,\n  IFilterInfo,\n  IFilterContext,\n  filteredHistTemplate,\n  initFilter,\n} from './histogram';\nimport InputDateDialog from '../ui/dialogs/InputDateDialog';\nimport { shiftFilterDateDay, noDateFilter } from '../model/internalDate';\nimport type DialogManager from '../ui/dialogs/DialogManager';\n\nexport default class DateHistogramCellRenderer implements ICellRendererFactory {\n  readonly title: string = 'Histogram';\n\n  canRender(col: Column, mode: ERenderMode): boolean {\n    return (isDateColumn(col) && mode !== ERenderMode.CELL) || (isDatesColumn(col) && mode === ERenderMode.CELL);\n  }\n\n  create(col: IDatesColumn, _context: IRenderContext): ICellRenderer {\n    const { template, render } = getHistDOMRenderer(col);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, row: IDataRow) => {\n        if (renderMissingDOM(n, col, row)) {\n          return;\n        }\n        const b = dateStatsBuilder();\n        for (const n of col.getDates(row)) {\n          b.push(n);\n        }\n        const hist = b.build();\n        render(n, hist);\n      },\n    };\n  }\n\n  createGroup(col: IDateColumn, context: IRenderContext): IGroupCellRenderer {\n    const { template, render } = getHistDOMRenderer(col);\n    return {\n      template: `${template}</div>`,\n      update: (n: HTMLElement, group: IOrderedGroup) => {\n        return context.tasks.groupDateStats(col, group).then((r) => {\n          if (typeof r === 'symbol') {\n            return;\n          }\n          const isMissing = !r || r.group == null || r.group.count === 0 || r.group.count === r.group.missing;\n          n.classList.toggle(cssClass('missing'), isMissing);\n          if (isMissing) {\n            return;\n          }\n          render(n, r.group);\n        });\n      },\n    };\n  }\n\n  createSummary(col: IDateColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\n    const r = getHistDOMRenderer(col);\n    return interactive\n      ? interactiveSummary(col, context, r.template, r.render)\n      : staticSummary(col, context, false, r.template, r.render);\n  }\n}\n\nfunction staticSummary(\n  col: IDateColumn,\n  context: IRenderContext,\n  interactive: boolean,\n  template: string,\n  render: (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => void\n) {\n  template += mappingHintTemplate(['', '']);\n\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      return context.tasks.summaryDateStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n\n        node.classList.toggle(cssClass('missing'), !summary);\n        if (!summary) {\n          return;\n        }\n        const formatter = col.getFormatter();\n        mappingHintUpdate(node, [formatter(summary.min), formatter(summary.max)]);\n\n        render(node, summary, interactive ? data : undefined);\n      });\n    },\n  };\n}\n\nfunction interactiveSummary(\n  col: IDateColumn,\n  context: IRenderContext,\n  template: string,\n  render: (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => void\n) {\n  const filter = col.getFilter();\n  const dummyDomain: [number, number] = [\n    isFinite(filter.min) ? filter.min : 0,\n    isFinite(filter.max) ? filter.max : 100,\n  ];\n\n  template += filteredHistTemplate(createFilterContext(col, context, dummyDomain), createFilterInfo(col, dummyDomain));\n\n  let fContext: IFilterContext<number>;\n  let updateFilter: (missing: number, f: IFilterInfo<number>) => void;\n\n  return {\n    template: `${template}</div>`,\n    update: (node: HTMLElement) => {\n      return context.tasks.summaryDateStats(col).then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n        if (!updateFilter) {\n          const domain: [number, number] = [\n            data.min ? data.min.getTime() : Date.now(),\n            data.max ? data.max.getTime() : Date.now(),\n          ];\n          fContext = createFilterContext(col, context, domain);\n          updateFilter = initFilter(node, fContext);\n        }\n\n        updateFilter(data ? data.missing : summary ? summary.missing : 0, createFilterInfo(col, fContext.domain));\n\n        node.classList.add(cssClass('histogram-i'));\n        node.classList.toggle(cssClass('missing'), !summary);\n        if (!summary) {\n          return;\n        }\n        render(node, summary, data);\n      });\n    },\n  };\n}\n\n/** @internal */\nexport function createDateFilter(\n  col: IDateColumn,\n  parent: HTMLElement,\n  context: { idPrefix: string; dialogManager: DialogManager; tasks: IRenderTasks },\n  livePreviews: boolean\n) {\n  const renderer = getHistDOMRenderer(col);\n  const filter = col.getFilter();\n\n  let domain: [number, number] = [isFinite(filter.min) ? filter.min : 0, isFinite(filter.max) ? filter.max : 100];\n\n  let fContext = createFilterContext(col, context, domain);\n  let applyFilter = fContext.setFilter;\n  let currentFilter = createFilterInfo(col, domain);\n  fContext.setFilter = (filterMissing, min, max) => {\n    currentFilter = { filterMissing, filterMin: min, filterMax: max };\n    if (livePreviews) {\n      applyFilter(filterMissing, min, max);\n    }\n  };\n  parent.innerHTML = `${renderer.template}${filteredHistTemplate(fContext, createFilterInfo(col, domain))}</div>`;\n  const summaryNode = parent.firstElementChild! as HTMLElement;\n  summaryNode.classList.add(cssClass('summary'), cssClass('renderer'));\n  summaryNode.dataset.renderer = 'histogram';\n  summaryNode.dataset.interactive = '';\n  summaryNode.classList.add(cssClass('histogram-i'));\n\n  let updateFilter: null | ((missing: number, filter: IFilterInfo<number>) => void) = null;\n  const prepareRender = (min: Date | null, max: Date | null) => {\n    // reinit with proper domain\n    domain = [min ? min.getTime() : Date.now(), max ? max.getTime() : Date.now()];\n    fContext = createFilterContext(col, context, domain);\n    applyFilter = fContext.setFilter;\n    currentFilter = createFilterInfo(col, domain);\n    fContext.setFilter = (filterMissing, min, max) => {\n      currentFilter = { filterMissing, filterMin: min, filterMax: max };\n      if (livePreviews) {\n        applyFilter(filterMissing, min, max);\n      }\n    };\n    return initFilter(summaryNode, fContext);\n  };\n\n  const rerender = () => {\n    const ready = context.tasks.summaryDateStats(col).then((r) => {\n      if (typeof r === 'symbol') {\n        return;\n      }\n      const { summary, data } = r;\n      if (!updateFilter) {\n        updateFilter = prepareRender(data.min, data.max);\n      }\n      updateFilter(data ? data.missing : summary ? summary.missing : 0, currentFilter);\n      summaryNode.classList.toggle(cssClass('missing'), !summary);\n      if (!summary) {\n        return;\n      }\n      renderer.render(summaryNode, summary, data);\n    });\n    if (!ready) {\n      return;\n    }\n    summaryNode.classList.add(engineCssClass('loading'));\n    ready.then(() => {\n      summaryNode.classList.remove(engineCssClass('loading'));\n    });\n  };\n\n  const ranking = col.findMyRanker()!;\n\n  if (ranking) {\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, () => rerender());\n  }\n  rerender();\n\n  return {\n    cleanUp() {\n      if (ranking) {\n        ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.numberFilter`, null);\n      }\n    },\n    reset() {\n      currentFilter = createFilterInfo(col, domain, noDateFilter());\n      rerender();\n    },\n    submit() {\n      applyFilter(currentFilter.filterMissing, currentFilter.filterMin, currentFilter.filterMax);\n    },\n  };\n}\n\nfunction getHistDOMRenderer(col: IDateColumn) {\n  const guessedBins = 10;\n\n  const formatter = col.getFormatter();\n  const color = colorOf(col)!;\n\n  const render = (n: HTMLElement, stats: IDateStatistics, unfiltered?: IDateStatistics) => {\n    return histogramUpdate(n, stats, unfiltered || null, formatter, () => color);\n  };\n  return {\n    template: histogramTemplate(guessedBins),\n    render,\n    guessedBins,\n  };\n}\n\nfunction createFilterInfo(col: IDateColumn, domain: [number, number], filter = col.getFilter()): IFilterInfo<number> {\n  const filterMin = isFinite(filter.min) ? filter.min : domain[0];\n  const filterMax = isFinite(filter.max) ? filter.max : domain[1];\n  return {\n    filterMissing: filter.filterMissing,\n    filterMin,\n    filterMax,\n  };\n}\n\nfunction createFilterContext(\n  col: IDateColumn,\n  context: { idPrefix: string; dialogManager: DialogManager },\n  domain: [number, number]\n): IFilterContext<number> {\n  const clamp = (v: number) => Math.max(0, Math.min(100, v));\n  const percent = (v: number) => clamp(Math.round((100 * (v - domain[0])) / (domain[1] - domain[0])));\n  const unpercent = (v: number) => (v / 100) * (domain[1] - domain[0]) + domain[0];\n  return {\n    percent,\n    unpercent,\n    domain,\n    format: (v) => (Number.isNaN(v) ? '' : col.getFormatter()(new Date(v))),\n    formatRaw: String,\n    parseRaw: (v) => Number.parseInt(v, 10),\n    setFilter: (filterMissing, minValue, maxValue) =>\n      col.setFilter({\n        filterMissing,\n        min: Math.abs(minValue - domain[0]) < 0.001 ? Number.NEGATIVE_INFINITY : shiftFilterDateDay(minValue, 'min'),\n        max: Math.abs(maxValue - domain[1]) < 0.001 ? Number.POSITIVE_INFINITY : shiftFilterDateDay(maxValue, 'max'),\n      }),\n    edit: (value, attachment, type) => {\n      return new Promise((resolve) => {\n        const dialogCtx = {\n          attachment,\n          manager: context.dialogManager,\n          level: context.dialogManager.maxLevel + 1,\n          idPrefix: context.idPrefix,\n        };\n        const dialog = new InputDateDialog(\n          dialogCtx,\n          (d) => resolve(d == null ? NaN : shiftFilterDateDay(d.getTime(), type)),\n          { value: Number.isNaN(value) ? null : new Date(value) }\n        );\n        dialog.open();\n      });\n    },\n  };\n}\n","import type { Column } from '../model';\nimport ActionRenderer from './ActionRenderer';\nimport AggregateGroupRenderer from './AggregateGroupRenderer';\nimport AnnotationRenderer from './AnnotationRenderer';\nimport BarCellRenderer from './BarCellRenderer';\nimport BooleanCellRenderer from './BooleanCellRenderer';\nimport BoxplotCellRenderer from './BoxplotCellRenderer';\nimport BrightnessCellRenderer from './BrightnessCellRenderer';\nimport CategoricalCellRenderer from './CategoricalCellRenderer';\nimport CategoricalHeatmapCellRenderer from './CategoricalHeatmapCellRenderer';\nimport CategoricalStackedDistributionlCellRenderer from './CategoricalStackedDistributionlCellRenderer';\nimport CircleCellRenderer from './CircleCellRenderer';\nimport { DefaultCellRenderer } from './DefaultCellRenderer';\nimport DotCellRenderer from './DotCellRenderer';\nimport GroupCellRenderer from './GroupCellRenderer';\nimport HeatmapCellRenderer from './HeatmapCellRenderer';\nimport HistogramCellRenderer from './HistogramCellRenderer';\nimport ImageCellRenderer from './ImageCellRenderer';\nimport { ERenderMode, ICellRendererFactory } from './interfaces';\nimport InterleavingCellRenderer from './InterleavingCellRenderer';\nimport LinkCellRenderer from './LinkCellRenderer';\nimport LinkMapCellRenderer from './LinkMapCellRenderer';\nimport LoadingCellRenderer from './LoadingCellRenderer';\nimport MapBarCellRenderer from './MapBarCellRenderer';\nimport MultiLevelCellRenderer from './MultiLevelCellRenderer';\nimport RankCellRenderer from './RankCellRenderer';\nimport SelectionRenderer from './SelectionRenderer';\nimport SetCellRenderer from './SetCellRenderer';\nimport SparklineCellRenderer from './SparklineCellRenderer';\nimport StringCellRenderer from './StringCellRenderer';\nimport TableCellRenderer from './TableCellRenderer';\nimport UpSetCellRenderer from './UpSetCellRenderer';\nimport VerticalBarCellRenderer from './VerticalBarCellRenderer';\nimport DateCellRenderer from './DateCellRenderer';\nimport DateHistogramCellRenderer from './DateHistogramCellRenderer';\n\nconst defaultCellRenderer = new DefaultCellRenderer();\n/**\n * default render factories\n */\nexport const renderers: { [key: string]: ICellRendererFactory } = {\n  actions: new ActionRenderer(),\n  aggregate: new AggregateGroupRenderer(),\n  annotate: new AnnotationRenderer(),\n  boolean: new BooleanCellRenderer(),\n  boxplot: new BoxplotCellRenderer(),\n  brightness: new BrightnessCellRenderer(),\n  catdistributionbar: new CategoricalStackedDistributionlCellRenderer(),\n  categorical: new CategoricalCellRenderer(),\n  circle: new CircleCellRenderer(),\n  date: new DateCellRenderer(),\n  default: defaultCellRenderer,\n  dot: new DotCellRenderer(),\n  group: new GroupCellRenderer(),\n  heatmap: new HeatmapCellRenderer(),\n  catheatmap: new CategoricalHeatmapCellRenderer(),\n  histogram: new HistogramCellRenderer(),\n  datehistogram: new DateHistogramCellRenderer(),\n  image: new ImageCellRenderer(),\n  interleaving: new InterleavingCellRenderer(),\n  link: new LinkCellRenderer(),\n  linkMap: new LinkMapCellRenderer(),\n  loading: new LoadingCellRenderer(),\n  nested: new MultiLevelCellRenderer(false),\n  number: new BarCellRenderer(),\n  mapbars: new MapBarCellRenderer(),\n  rank: new RankCellRenderer(),\n  selection: new SelectionRenderer(),\n  set: new SetCellRenderer(),\n  sparkline: new SparklineCellRenderer(),\n  stack: new MultiLevelCellRenderer(),\n  string: new StringCellRenderer(),\n  table: new TableCellRenderer(),\n  upset: new UpSetCellRenderer(),\n  verticalbar: new VerticalBarCellRenderer(),\n};\n\nexport function chooseRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\n  const r = renderers[col.getRenderer()];\n  return r && typeof r.create === 'function' ? r : defaultCellRenderer;\n}\n\nexport function chooseGroupRenderer(\n  col: Column,\n  renderers: { [key: string]: ICellRendererFactory }\n): ICellRendererFactory {\n  const r = renderers[col.getGroupRenderer()];\n  return r && typeof r.createGroup === 'function' ? r : defaultCellRenderer;\n}\n\nexport function chooseSummaryRenderer(\n  col: Column,\n  renderers: { [key: string]: ICellRendererFactory }\n): ICellRendererFactory {\n  const r = renderers[col.getSummaryRenderer()];\n  return r && typeof r.createSummary === 'function' ? r : defaultCellRenderer;\n}\n\n/**\n * determined the list of possible renderers for a given colum\n * @param col the column to resolve the renderers\n * @param renderers map of possible renderers\n * @param canRender optional custom canRender function\n */\nexport function getPossibleRenderer(\n  col: Column,\n  renderers: { [key: string]: ICellRendererFactory },\n  canRender?: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean\n) {\n  const all = Object.keys(renderers)\n    .filter(Boolean)\n    .map((type) => ({ type, factory: renderers[type] }));\n\n  const item = all.filter(\n    ({ type, factory }) =>\n      typeof factory.create === 'function' &&\n      factory.canRender(col, ERenderMode.CELL) &&\n      (!canRender || canRender(type, factory, col, ERenderMode.CELL))\n  );\n  const group = all.filter(\n    ({ type, factory }) =>\n      typeof factory.createGroup === 'function' &&\n      factory.canRender(col, ERenderMode.GROUP) &&\n      (!canRender || canRender(type, factory, col, ERenderMode.GROUP))\n  );\n  const summary = all.filter(\n    ({ type, factory }) =>\n      typeof factory.createSummary === 'function' &&\n      factory.canRender(col, ERenderMode.SUMMARY) &&\n      (!canRender || canRender(type, factory, col, ERenderMode.SUMMARY))\n  );\n\n  return {\n    item: item.map(({ type, factory }) => ({ type, label: factory.title })),\n    group: group.map(({ type, factory }) => ({ type, label: factory.groupTitle || factory.title })),\n    summary: summary.map(({ type, factory }) => ({\n      type,\n      label: factory.summaryTitle || factory.groupTitle || factory.title,\n    })),\n  };\n}\n","import colors from \"../colors.js\";\n\nexport default colors(\"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3\");\n","import type {\n  ICategoricalColumn,\n  CategoricalsColumn,\n  CategoricalMapColumn,\n  ICategory,\n  ICategoricalColorMappingFunction,\n} from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { uniqueId } from './utils';\nimport { cssClass } from '../../styles';\nimport { color } from 'd3-color';\nimport {\n  schemeCategory10,\n  schemeAccent,\n  schemeDark2,\n  schemePastel1,\n  schemePastel2,\n  schemeSet1,\n  schemeSet2,\n  schemeSet3,\n} from 'd3-scale-chromatic';\nimport {\n  DEFAULT_CATEGORICAL_COLOR_FUNCTION,\n  ReplacementColorMappingFunction,\n} from '../../model/CategoricalColorMappingFunction';\n\nconst sets: { [key: string]: ReadonlyArray<string> } = {\n  schemeCategory10,\n  schemeAccent,\n  schemeDark2,\n  schemePastel1,\n  schemePastel2,\n  schemeSet1,\n  schemeSet2,\n  schemeSet3,\n};\n\n/** @internal */\nexport default class CategoricalColorMappingDialog extends ADialog {\n  private readonly before: ICategoricalColorMappingFunction;\n\n  constructor(\n    private readonly column: ICategoricalColumn | CategoricalsColumn | CategoricalMapColumn,\n    dialog: IDialogContext\n  ) {\n    super(dialog, {\n      livePreview: 'colorMapping',\n    });\n\n    this.before = column.getColorMapping().clone();\n  }\n\n  protected build(node: HTMLElement) {\n    const id = uniqueId(this.dialog.idPrefix);\n    const mapping = this.column.getColorMapping();\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n      <div class=\"${cssClass('dialog-color-table-entry')}\">\n        <select id=\"${id}Chooser\">\n          <option value=\"\">Apply Color Scheme...</option>\n          <option value=\"schemeCategory10\">D3 Category 10 (${schemeCategory10.length})</option>\n          <option value=\"schemeSet1\">Set 1 (${schemeSet1.length})</option>\n          <option value=\"schemeSet2\">Set 2 (${schemeSet2.length})</option>\n          <option value=\"schemeSet3\">Set 3 (${schemeSet3.length})</option>\n          <option value=\"schemeAccent\">Accent (${schemeAccent.length})</option>\n          <option value=\"schemeDark2\">Dark2 (${schemeDark2.length})</option>\n          <option value=\"schemePastel1\">Pastel 1 (${schemePastel1.length})</option>\n          <option value=\"schemePastel2\">Pastel 2 (${schemePastel2.length})</option>\n        </select>\n      </div>\n      ${this.column.categories\n        .map(\n          (d) => `\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-color-table-entry')}\">\n          <input data-cat=\"${d.name}\" type=\"color\" value=\"${color(mapping.apply(d))!.hex()}\">\n          <span>${d.label}</span>\n        </label>`\n        )\n        .join('')}\n    </div>`\n    );\n\n    this.findInput('select').onchange = (evt) => {\n      const scheme = sets[(evt.currentTarget as HTMLInputElement).value];\n      if (!scheme) {\n        return;\n      }\n      this.forEach('[data-cat]', (n: HTMLInputElement, i) => {\n        n.value = scheme[i % scheme.length];\n      });\n      if (this.showLivePreviews()) {\n        this.submit();\n      }\n    };\n\n    this.enableLivePreviews('input[type=color]');\n  }\n\n  reset() {\n    const cats = this.column.categories;\n    this.forEach('[data-cat]', (n: HTMLInputElement, i) => {\n      n.value = color(cats[i]!.color)!.hex();\n    });\n  }\n\n  submit() {\n    const cats = this.column.categories;\n    const map = new Map<ICategory, string>();\n    this.forEach('input[data-cat]', (n: HTMLInputElement, i) => {\n      const cat = cats[i];\n      if (color(cat.color)!.hex() !== n.value) {\n        map.set(cat, n.value);\n      }\n    });\n    if (map.size === 0) {\n      this.column.setColorMapping(DEFAULT_CATEGORICAL_COLOR_FUNCTION);\n    } else {\n      this.column.setColorMapping(new ReplacementColorMappingFunction(map));\n    }\n    return true;\n  }\n\n  cancel() {\n    this.column.setColorMapping(this.before);\n  }\n}\n","import {\n  SetColumn,\n  CategoricalColumn,\n  ICategoricalFilter,\n  ISetCategoricalFilter,\n  Ranking,\n  BooleanColumn,\n} from '../../model';\nimport { findFilterMissing, updateFilterMissingNumberMarkup, filterMissingNumberMarkup } from '../missing';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { forEach } from './utils';\nimport { cssClass, engineCssClass } from '../../styles';\nimport { isCategoryIncluded } from '../../model/internalCategorical';\nimport type { IRankingHeaderContext } from '../interfaces';\n\n/** @internal */\nexport default class CategoricalFilterDialog extends ADialog {\n  private readonly before: ICategoricalFilter;\n\n  constructor(\n    private readonly column: CategoricalColumn | SetColumn | BooleanColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n    });\n    this.before = this.column.getFilter() || { filter: '', filterMissing: false };\n  }\n\n  protected build(node: HTMLElement) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\n          <input type=\"checkbox\" checked>\n          <span>\n            <span class=\"${cssClass('dialog-filter-table-color')}\"></span>\n            <div>Un/Select All</div>\n          </span>\n        </label>\n        ${this.column.categories\n          .map(\n            (c) => `<label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\n          <input data-cat=\"${c.name}\" type=\"checkbox\"${isCategoryIncluded(this.before, c) ? 'checked' : ''}>\n          <span>\n            <span class=\"${cssClass('dialog-filter-table-color')}\" style=\"background-color: ${c.color}\"></span>\n            <div class=\"${cssClass('dialog-filter-table-entry-label')}\">${c.label}</div>\n            <div class=\"${cssClass('dialog-filter-table-entry-stats')}\"></div>\n          </span>\n        </label>`\n          )\n          .join('')}\n    </div>`\n    );\n    // selectAll\n    const selectAll = this.findInput('input:not([data-cat])');\n    selectAll.onchange = () => {\n      forEach(node, 'input[data-cat]', (n: HTMLInputElement) => (n.checked = selectAll.checked));\n    };\n    if (this.column instanceof SetColumn) {\n      const some = (this.before as ISetCategoricalFilter).mode !== 'every';\n      node.insertAdjacentHTML('beforeend', `<strong>Show rows where</strong>`);\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<label class=\"${cssClass('checkbox')}\">\n        <input type=\"radio\" ${!some ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"every\">\n        <span>all are selected</span>\n      </label>`\n      );\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<label class=\"${cssClass('checkbox')}\" style=\"padding-bottom: 0.6em\">\n        <input type=\"radio\" ${some ? 'checked=\"checked\"' : ''} name=\"mode\" value=\"some\">\n        <span>some are selected</span>\n      </label>`\n      );\n    }\n    node.insertAdjacentHTML('beforeend', filterMissingNumberMarkup(this.before.filterMissing, 0));\n\n    this.enableLivePreviews('input[type=checkbox],input[type=radio]');\n\n    const ranking = this.column.findMyRanker()!;\n    if (ranking) {\n      ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.catFilter`, () => this.updateStats());\n    }\n    this.updateStats();\n  }\n\n  private updateStats() {\n    const ready = this.ctx.provider\n      .getTaskExecutor()\n      .summaryCategoricalStats(this.column)\n      .then((r) => {\n        if (typeof r === 'symbol') {\n          return;\n        }\n        const { summary, data } = r;\n        const missing = data ? data.missing : summary ? summary.missing : 0;\n        updateFilterMissingNumberMarkup(findFilterMissing(this.node).parentElement, missing);\n        if (!summary || !data) {\n          return;\n        }\n        this.forEach(`.${cssClass('dialog-filter-table-entry-stats')}`, (n: HTMLElement, i) => {\n          const bin = summary.hist[i];\n          const raw = data.hist[i];\n          n.textContent = `${bin.count}/${raw.count}`;\n        });\n      });\n    if (!ready) {\n      return;\n    }\n    this.node.classList.add(engineCssClass('loading'));\n    ready.then(() => {\n      this.node.classList.remove(engineCssClass('loading'));\n    });\n  }\n\n  private updateFilter(filter: string[] | null | RegExp | string, filterMissing: boolean, someMode = false) {\n    const noFilter = filter == null && filterMissing === false;\n    const f: ISetCategoricalFilter = { filter: filter!, filterMissing };\n    if (this.column instanceof SetColumn) {\n      f.mode = someMode ? 'some' : 'every';\n    }\n    this.column.setFilter(noFilter ? null : f);\n  }\n\n  protected reset() {\n    this.forEach('input[data-cat]', (n: HTMLInputElement) => (n.checked = true));\n    findFilterMissing(this.node).checked = false;\n    const mode = this.findInput('input[value=every]');\n    if (mode) {\n      mode.checked = true;\n    }\n  }\n\n  protected cancel() {\n    this.updateFilter(\n      this.before.filter === '' ? null : this.before.filter,\n      this.before.filterMissing,\n      (this.before as ISetCategoricalFilter).mode === 'some'\n    );\n  }\n\n  protected submit() {\n    let f: string[] | null = this.forEach('input[data-cat]:checked', (n: HTMLInputElement) => n.dataset.cat!);\n    if (f.length === this.column.categories.length) {\n      // all checked = no filter\n      f = null;\n    }\n    const filterMissing = findFilterMissing(this.node).checked;\n    const mode = this.findInput('input[value=some]');\n    this.updateFilter(f, filterMissing, mode != null && mode.checked);\n    return true;\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    const ranking = this.column.findMyRanker()!;\n    if (ranking) {\n      ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.catFilter`, null);\n    }\n  }\n}\n","import { round } from '../../internal';\nimport type { OrdinalColumn, ICategoricalFilter } from '../../model';\nimport { isCategoryIncluded } from '../../model/internalCategorical';\nimport { filterMissingMarkup, findFilterMissing } from '../missing';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { forEach } from './utils';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class CategoricalMappingFilterDialog extends ADialog {\n  private readonly before: ICategoricalFilter;\n\n  constructor(private readonly column: OrdinalColumn, dialog: IDialogContext) {\n    super(dialog, {\n      livePreview: 'filter',\n    });\n    this.before = this.column.getFilter() || {\n      filter: this.column.categories.map((d) => d.name),\n      filterMissing: false,\n    };\n  }\n\n  protected build(node: HTMLElement) {\n    const joint = this.column.categories.map((d) =>\n      Object.assign(\n        {\n          range: round(d.value * 100, 2),\n        },\n        d\n      )\n    );\n    joint.sort((a, b) => a.label.localeCompare(b.label));\n\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n        <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\n          <input type=\"checkbox\" checked>\n          <span>\n            <div>Un/Select All</div>\n          </span>\n        </label>\n        ${joint\n          .map(\n            (cat) => `\n          <label class=\"${cssClass('checkbox')} ${cssClass('dialog-filter-table-entry')}\">\n            <input data-cat=\"${cat.name}\" type=\"checkbox\"${isCategoryIncluded(this.before, cat) ? 'checked' : ''}>\n            <span>\n              <input type=\"number\" value=\"${cat.range}\" min=\"0\" max=\"100\" size=\"5\">\n              <div class=\"${cssClass('dialog-filter-color-bar')}\">\n                <span style=\"background-color: ${cat.color}; width: ${cat.range}%\"></span>\n              </div>\n              <div>${cat.label}</div>\n            </span>\n          </label>`\n          )\n          .join('')}\n    </div>`\n    );\n    // selectAll\n    const selectAll = this.findInput('input[type=checkbox]:not([data-cat])');\n    selectAll.onchange = () => {\n      forEach(node, '[data-cat]', (n: HTMLInputElement) => (n.checked = selectAll.checked));\n    };\n    this.forEach('input[type=number]', (d: HTMLInputElement) => {\n      d.oninput = () => {\n        (d.nextElementSibling!.firstElementChild as HTMLElement).style.width = `${d.value}%`;\n      };\n    });\n    node.insertAdjacentHTML('beforeend', filterMissingMarkup(this.before.filterMissing));\n\n    this.enableLivePreviews('input[type=checkbox], input[type=number]');\n  }\n\n  private updateFilter(filter: string[] | null | string | RegExp, filterMissing: boolean) {\n    const noFilter = filter == null && filterMissing === false;\n    this.column.setFilter(noFilter ? null : { filter: filter!, filterMissing });\n  }\n\n  protected cancel() {\n    this.updateFilter(this.before.filter, this.before.filterMissing);\n  }\n\n  protected reset() {\n    this.forEach('[data-cat]', (n: HTMLInputElement) => {\n      n.checked = false;\n      (n.nextElementSibling! as HTMLInputElement).value = '50';\n    });\n  }\n\n  protected submit() {\n    const items = this.forEach('input[data-cat]', (n: HTMLInputElement) => ({\n      checked: n.checked,\n      cat: n.dataset.cat!,\n      range: (n.nextElementSibling as HTMLInputElement)!.valueAsNumber,\n    }));\n    let f: string[] | null = items.filter((d) => d.checked).map((d) => d.cat);\n    if (f.length === this.column.categories.length) {\n      // all checked = no filter\n      f = null;\n    }\n    const filterMissing = findFilterMissing(this.node).checked;\n    this.updateFilter(f, filterMissing);\n    this.column.setMapping(items.map((d) => d.range / 100));\n    return true;\n  }\n}\n","import type { Column } from '../../model';\nimport type { IRankingHeaderContext, IRenderInfo } from '../interfaces';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class ChangeRendererDialog extends ADialog {\n  private readonly before: { renderer: string; group: string; summary: string };\n\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\n    super(dialog, {\n      livePreview: 'vis',\n    });\n\n    this.before = {\n      renderer: column.getRenderer(),\n      group: column.getGroupRenderer(),\n      summary: column.getSummaryRenderer(),\n    };\n  }\n\n  protected build(node: HTMLElement) {\n    const current = this.column.getRenderer();\n    const currentGroup = this.column.getGroupRenderer();\n    const currentSummary = this.column.getSummaryRenderer();\n    const { item, group, summary } = this.ctx.getPossibleRenderer(this.column);\n\n    console.assert(item.length > 1 || group.length > 1 || summary.length > 1); // otherwise no need to show this\n\n    const byName = (a: IRenderInfo, b: IRenderInfo) => a.label.localeCompare(b.label);\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <strong>Item Visualization</strong>\n      ${item\n        .sort(byName)\n        .map(\n          (d) =>\n            ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"renderer\" value=\"${d.type}\" ${\n              current === d.type ? 'checked' : ''\n            }><span>${d.label}</span></label>`\n        )\n        .join('')}\n      <strong>Group Visualization</strong>\n      ${group\n        .sort(byName)\n        .map(\n          (d) =>\n            ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"group\" value=\"${d.type}\" ${\n              currentGroup === d.type ? 'checked' : ''\n            }><span>${d.label}</span></label>`\n        )\n        .join('')}\n      <strong>Summary Visualization</strong>\n      ${summary\n        .sort(byName)\n        .map(\n          (d) =>\n            ` <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"summary\" value=\"${d.type}\" ${\n              currentSummary === d.type ? 'checked' : ''\n            }><span>${d.label}</span></label>`\n        )\n        .join('')}\n    `\n    );\n\n    this.enableLivePreviews('input[type=radio]');\n  }\n\n  protected cancel() {\n    this.column.setRenderer(this.before.renderer);\n    this.column.setGroupRenderer(this.before.group);\n    this.column.setSummaryRenderer(this.before.summary);\n  }\n\n  protected reset() {\n    const desc = this.column.desc;\n    const r = this.findInput(`input[name=renderer][value=\"${desc.renderer || desc.type}\"]`);\n    if (r) {\n      r.checked = true;\n    }\n    const g = this.findInput(`input[name=group][value=\"${desc.groupRenderer || desc.type}\"]`);\n    if (g) {\n      g.checked = true;\n    }\n    const s = this.findInput(`input[name=summary][value=\"${desc.summaryRenderer || desc.type}\"]`);\n    if (s) {\n      s.checked = true;\n    }\n  }\n\n  protected submit() {\n    const renderer = this.findInput('input[name=renderer]:checked').value;\n    const group = this.findInput('input[name=group]:checked').value;\n    const summary = this.findInput('input[name=summary]:checked').value;\n\n    this.column.setRenderer(renderer);\n    this.column.setGroupRenderer(group);\n    this.column.setSummaryRenderer(summary);\n\n    return true;\n  }\n}\n","import ADialog, { IDialogContext } from './ADialog';\nimport {\n  schemeCategory10,\n  schemeSet1,\n  schemeSet2,\n  schemeSet3,\n  schemeAccent,\n  schemeDark2,\n  schemePastel2,\n  schemePastel1,\n} from 'd3-scale-chromatic';\nimport { round } from '../../internal';\nimport { uniqueId } from '../../renderer/utils';\nimport {\n  QuantizedColorFunction,\n  CustomColorMappingFunction,\n  SolidColorFunction,\n  SequentialColorFunction,\n  DivergentColorFunction,\n} from '../../model/ColorMappingFunction';\nimport { IMapAbleColumn, DEFAULT_COLOR, IColorMappingFunction, IMapAbleDesc } from '../../model';\nimport { cssClass } from '../../styles';\nimport type { IRankingHeaderContext } from '../interfaces';\n\nexport default class ColorMappingDialog extends ADialog {\n  private readonly before: IColorMappingFunction;\n  private readonly id = uniqueId('col');\n\n  constructor(\n    private readonly column: IMapAbleColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'colorMapping',\n    });\n\n    this.before = this.column.getColorMapping();\n  }\n\n  private createTemplate(id: string, wrapped: IColorMappingFunction) {\n    const current = wrapped instanceof QuantizedColorFunction ? wrapped.base : wrapped;\n    const entries = current instanceof CustomColorMappingFunction ? current.entries : [];\n\n    let h = '';\n    h += `<datalist id=\"${id}L\">${schemeCategory10.map((d) => `<option>${d}\"</option>`).join('')}</datalist>`;\n    h += `<datalist id=\"${id}LW\"><option>#FFFFFF\"</option>${schemeCategory10\n      .slice(0, -1)\n      .map((d) => `<option>${d}</option>`)\n      .join('')}</datalist>`;\n\n    h += `<strong data-toggle=\"${current instanceof SolidColorFunction ? 'open' : ''}\">Solid Color</strong>`;\n    h += `<div>`;\n    {\n      const refColor = current instanceof SolidColorFunction ? current.color : '';\n      let has = refColor === DEFAULT_COLOR;\n      const colorSets = [\n        schemeCategory10,\n        schemeAccent,\n        schemeDark2,\n        schemePastel1,\n        schemePastel2,\n        schemeSet1,\n        schemeSet2,\n        schemeSet3,\n      ];\n      const renderColor = (d: string) => `<label class=\"${cssClass('checkbox-color')}\">\n        <input name=\"color\" type=\"radio\" value=\"${d}\" ${d === refColor ? 'checked=\"checked\"' : ''}>\n        <span style=\"background: ${d}\"></span>\n      </label>`;\n      colorSets.forEach((colors, i) => {\n        has = has || colors.includes(refColor);\n        h += `<div class=\"${cssClass('color-line')}\">\n          ${colors.map(renderColor).join('')}\n          ${i === 0 ? renderColor(DEFAULT_COLOR) : ''}\n        </div>`;\n      });\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass(\n        'color-gradient'\n      )}\"><input name=\"color\" type=\"radio\" value=\"custom:solid\" ${refColor && !has ? 'checked=\"checked\"' : ''}>\n        <span class=\"${cssClass('color-custom')}\"><input type=\"color\" name=\"solid\" list=\"${id}L\" value=\"${\n        current instanceof SolidColorFunction ? current.color : DEFAULT_COLOR\n      }\" ${refColor && !has ? '' : 'disabled'}></span>\n      </label>`;\n    }\n    h += '</div>';\n\n    h += `<strong data-toggle=\"${\n      current instanceof SequentialColorFunction ||\n      (current instanceof CustomColorMappingFunction && entries.length === 2)\n        ? 'open'\n        : ''\n    }\">Sequential Color</strong>`;\n    h += '<div>';\n    h += `<div><label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindS\" type=\"radio\" id=\"${id}KC_S\" value=\"continuous\" ${\n      !(wrapped instanceof QuantizedColorFunction) ? 'checked' : ''\n    }>\n      <span>Continuous</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindS\" type=\"radio\" id=\"${id}KQ_S\" value=\"quantized\" ${\n      wrapped instanceof QuantizedColorFunction ? 'checked' : ''\n    }>\n      <span>Discrete&nbsp;<input type=\"number\" id=\"${id}KQS_S\" min=\"2\" step=\"1\" style=\"width: 3em\" value=\"${\n      wrapped instanceof QuantizedColorFunction ? `${wrapped.steps}\"` : '5\" disabled'\n    }>&nbsp; steps</span>\n    </label></div>`;\n    {\n      const name = current instanceof SequentialColorFunction ? current.name : '';\n      for (const colors of Object.keys(SequentialColorFunction.FUNCTIONS)) {\n        h += `<label class=\"${cssClass('checkbox')} ${cssClass(\n          'color-gradient'\n        )}\"><input name=\"color\" type=\"radio\" value=\"${colors}\" ${colors === name ? 'checked=\"checked\"' : ''}>\n        <span data-c=\"${colors}\" style=\"background: ${gradient(SequentialColorFunction.FUNCTIONS[colors], 9)}\"></span>\n      </label>`;\n      }\n      const isCustom = entries.length === 2;\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\">\n        <input name=\"color\" type=\"radio\" value=\"custom:sequential\" ${isCustom ? 'checked' : ''}>\n        <span class=\"${cssClass('color-custom')}\">\n          <input type=\"color\" name=\"interpolate0\" list=\"${id}LW\" ${\n        !isCustom ? 'disabled' : `value=\"${entries[0].color}\"`\n      }>\n          <input type=\"color\" name=\"interpolate1\" list=\"${id}LW\" ${\n        !isCustom ? 'disabled' : `value=\"${entries[entries.length - 1].color}\"`\n      }>\n        </span>\n      </label>`;\n    }\n    h += '</div>';\n    h += `<strong data-toggle=\"${\n      current instanceof DivergentColorFunction ||\n      (current instanceof CustomColorMappingFunction && entries.length === 3)\n        ? 'open'\n        : ''\n    }\">Diverging Color</strong>`;\n    h += '<div>';\n    h += `<div><label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindD\" type=\"radio\" id=\"${id}KC_D\" value=\"continuous\" ${\n      !(wrapped instanceof QuantizedColorFunction) ? 'checked' : ''\n    }>\n      <span>Continuous</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input name=\"kindD\" type=\"radio\" id=\"${id}KQ_D\" value=\"quantized\" ${\n      wrapped instanceof QuantizedColorFunction ? 'checked' : ''\n    }>\n      <span>Discrete&nbsp;<input type=\"number\" id=\"${id}KQS_D\" min=\"2\" step=\"1\" style=\"width: 3em\" value=\"${\n      wrapped instanceof QuantizedColorFunction ? `${wrapped.steps}\"` : '5\" disabled'\n    }>&nbsp; steps</span>\n    </label></div>`;\n\n    {\n      const name = current instanceof DivergentColorFunction ? current.name : '';\n      for (const colors of Object.keys(DivergentColorFunction.FUNCTIONS)) {\n        h += `<label class=\"${cssClass('checkbox')} ${cssClass(\n          'color-gradient'\n        )}\"><input name=\"color\" type=\"radio\" value=\"${colors}\" ${colors === name ? 'checked=\"checked\"' : ''}>\n        <span data-c=\"${colors}\" style=\"background: ${gradient(DivergentColorFunction.FUNCTIONS[colors], 11)}\"></span>\n      </label>`;\n      }\n      const isCustom = entries.length === 3;\n      h += `<label class=\"${cssClass('checkbox')} ${cssClass('color-gradient')}\">\n        <input name=\"color\" type=\"radio\" value=\"custom:divergent\" ${isCustom ? 'checked' : ''}>\n        <span class=\"${cssClass('color-custom')}\">\n          <input type=\"color\" name=\"divergingm1\" list=\"${id}L\" ${\n        !isCustom ? 'disabled' : `value=\"${entries[0].color}\"`\n      }>\n          <input type=\"color\" name=\"diverging0\" list=\"${id}LW\" ${\n        !isCustom ? 'disabled' : `value=\"${entries[1].color}\"`\n      }>\n          <input type=\"color\" name=\"diverging1\" list=\"${id}L\" ${!isCustom ? 'disabled' : `value=\"${entries[2].color}\"`}>\n        </span>\n      </label>`;\n    }\n    h += '</div>';\n\n    return h;\n  }\n\n  private applyColor() {\n    const selected = this.findInput(`input[name=color]:checked`);\n    if (!selected) {\n      return;\n    }\n    const quantized = this.findInput(`#${this.id}KQ_S`);\n    const steps = this.findInput(`#${this.id}KQS_S`);\n\n    const base = toColor(selected, this.node);\n    if (quantized.checked && !(base instanceof SolidColorFunction)) {\n      this.column.setColorMapping(new QuantizedColorFunction(base, Number.parseInt(steps.value, 10)));\n    } else {\n      this.column.setColorMapping(base);\n    }\n  }\n\n  protected build(node: HTMLElement) {\n    const content = node.ownerDocument!.createElement('div');\n    content.classList.add(cssClass('dialog-color'));\n    node.appendChild(content);\n    this.render(content, this.column.getColorMapping());\n  }\n\n  private render(node: HTMLElement, value: IColorMappingFunction) {\n    const id = this.id;\n    node.innerHTML = this.createTemplate(id, value);\n\n    const toggles = Array.from(node.querySelectorAll<HTMLElement>('strong[data-toggle]'));\n\n    for (const toggle of toggles) {\n      toggle.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        for (const t2 of toggles) {\n          t2.dataset.toggle = t2.dataset.toggle === 'open' || toggle !== t2 ? '' : 'open';\n        }\n      };\n    }\n\n    const customs: HTMLElement[] = [];\n    const updateColor = (d: HTMLInputElement) => {\n      if (!d.checked) {\n        return;\n      }\n      // disable customs\n      for (const custom of customs) {\n        Array.from(custom.nextElementSibling!.getElementsByTagName('input')).forEach(\n          (s) => (s.disabled = custom !== d)\n        );\n      }\n      if (this.showLivePreviews()) {\n        this.applyColor();\n      }\n    };\n\n    const updateSelectedColor = () => {\n      const selected = this.findInput(`input[name=color]:checked`);\n      if (selected) {\n        updateColor(selected);\n      }\n    };\n\n    this.forEach('input[name=color]', (d: HTMLInputElement) => {\n      if (d.value.startsWith('custom:')) {\n        customs.push(d);\n      }\n      d.onchange = () => updateColor(d);\n    });\n\n    // upon changing custom parameter trigger an update\n    this.forEach(`.${cssClass('color-custom')} input[type=color]`, (d: HTMLInputElement) => {\n      d.onchange = () => {\n        const item = d.parentElement!.previousElementSibling! as HTMLInputElement;\n        updateColor(item);\n      };\n    });\n\n    // sync and apply\n    const continuouos = this.findInput(`#${id}KC_S`);\n    const quantized = this.findInput(`#${id}KQ_S`);\n    const steps = this.findInput(`#${id}KQS_S`);\n    const continuouos2 = this.findInput(`#${id}KC_D`);\n    const quantized2 = this.findInput(`#${id}KQ_D`);\n    const steps2 = this.findInput(`#${id}KQS_D`);\n\n    continuouos.onchange = continuouos2.onchange = (evt) => {\n      continuouos.checked = continuouos2.checked = (evt.currentTarget as HTMLInputElement).checked;\n      steps.disabled = steps2.disabled = !quantized.checked;\n      if (continuouos.checked) {\n        this.updateGradients(-1);\n        updateSelectedColor();\n      }\n    };\n    steps.onchange = steps2.onchange = (evt) => {\n      steps.value = steps2.value = (evt.currentTarget as HTMLInputElement).value;\n      this.updateGradients(Number.parseInt(steps.value, 10));\n      updateSelectedColor();\n    };\n    quantized.onchange = quantized2.onchange = (evt) => {\n      quantized.checked = quantized2.checked = (evt.currentTarget as HTMLInputElement).checked;\n      steps.disabled = steps2.disabled = !quantized.checked;\n      if (quantized.checked) {\n        this.updateGradients(Number.parseInt(steps.value, 10));\n        updateSelectedColor();\n      }\n    };\n  }\n\n  protected reset() {\n    const desc = this.column.desc as IMapAbleDesc;\n    const colorMapping = this.ctx.provider.getTypeFactory().colorMappingFunction(desc.colorMapping || desc.color);\n    this.render(this.node.querySelector<HTMLElement>(`.${cssClass('dialog-color')}`)!, colorMapping);\n  }\n\n  protected submit() {\n    this.applyColor();\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setColorMapping(this.before);\n  }\n\n  private updateGradients(steps: number) {\n    this.forEach(`span[data-c]`, (d: HTMLElement) => {\n      const key = d.dataset.c!;\n      const s = SequentialColorFunction.FUNCTIONS[key];\n      if (s) {\n        d.style.background = steps < 0 ? gradient(s, 9) : steppedGradient(s, steps);\n        return;\n      }\n      const di = DivergentColorFunction.FUNCTIONS[key];\n      if (di) {\n        d.style.background = steps < 0 ? gradient(di, 11) : steppedGradient(di, steps);\n        return;\n      }\n    });\n  }\n}\n\nfunction toColor(input: HTMLInputElement, node: HTMLElement) {\n  switch (input.value) {\n    case 'custom:solid':\n      return new SolidColorFunction(node.querySelector<HTMLInputElement>('input[name=solid]')!.value);\n    case 'custom:sequential':\n      const s0 = node.querySelector<HTMLInputElement>('input[name=interpolate0]')!.value;\n      const s1 = node.querySelector<HTMLInputElement>('input[name=interpolate1]')!.value;\n      return new CustomColorMappingFunction([\n        { color: s0, value: 0 },\n        { color: s1, value: 1 },\n      ]);\n    case 'custom:diverging':\n      const dm1 = node.querySelector<HTMLInputElement>('input[name=divergentm1]')!.value;\n      const d0 = node.querySelector<HTMLInputElement>('input[name=divergent0]')!.value;\n      const d1 = node.querySelector<HTMLInputElement>('input[name=divergent1]')!.value;\n      return new CustomColorMappingFunction([\n        { color: dm1, value: 0 },\n        { color: d0, value: 0.5 },\n        { color: d1, value: 1 },\n      ]);\n  }\n  if (input.value in SequentialColorFunction.FUNCTIONS) {\n    return new SequentialColorFunction(input.value);\n  }\n  if (input.value in DivergentColorFunction.FUNCTIONS) {\n    return new DivergentColorFunction(input.value);\n  }\n  return new SolidColorFunction(input.value);\n}\n\nfunction gradient(interpolate: (v: number) => string, steps = 2) {\n  if (steps <= 1) {\n    return `${interpolate(0)}`;\n  }\n  const stepSize = 1 / (steps - 1);\n  let r = `linear-gradient(to right`;\n  for (let i = 0; i < steps; ++i) {\n    r += `, ${interpolate(i * stepSize)} ${round(i * stepSize * 100, 2)}%`;\n  }\n  r += ')';\n  return r;\n}\n\nfunction steppedGradient(color: (v: number) => string, count = 2) {\n  if (count === 1) {\n    return `${color(0)}`;\n  }\n  let r = `linear-gradient(to right`;\n  const stepSize = 1 / count;\n  const half = stepSize / 2;\n  for (let i = 0; i < count; ++i) {\n    // stepped\n    // first and last at border else center\n    const shift = i === 0 ? 0 : i === count - 1 ? stepSize : half;\n    const c = color(i * stepSize + shift);\n    r += `, ${c} ${round(i * stepSize * 100, 2)}%, ${c} ${round((i + 1) * stepSize * 100, 2)}%`;\n  }\n  r += ')';\n  return r;\n}\n","import { cssClass } from '../styles';\n\n/** @internal */\nexport function hasDnDType(e: DragEvent, ...typesToCheck: string[]) {\n  const available: any = e.dataTransfer!.types;\n\n  /*\n   * In Chrome data transfer.types is an Array,\n   * while in Firefox it is a DOMStringList\n   * that only implements a contains-method!\n   */\n  if (typeof available.indexOf === 'function') {\n    return typesToCheck.some((type) => available.indexOf(type) >= 0);\n  }\n  if (typeof available.includes === 'function') {\n    return typesToCheck.some((type) => available.includes(type));\n  }\n  if (typeof available.contains === 'function') {\n    return typesToCheck.some((type) => available.contains(type));\n  }\n  return false;\n}\n\n/**\n * helper storage for dnd in edge since edge doesn't support custom mime-types\n * @type {Map<number, {[p: string]: string}>}\n */\nconst dndTransferStorage = new Map<number, { [key: string]: string }>();\n\nfunction isEdgeDnD(e: DragEvent) {\n  return dndTransferStorage.size > 0 && hasDnDType(e, 'text/plain');\n}\n\n/**\n * checks whether it is a copy operation\n * @param e\n * @returns {boolean|RegExpMatchArray}\n * @internal\n */\nexport function copyDnD(e: DragEvent) {\n  const dT = e.dataTransfer!;\n  return Boolean((e.ctrlKey && dT.effectAllowed.match(/copy/gi)) || !dT.effectAllowed.match(/move/gi));\n}\n\n/**\n * updates the drop effect according to the current copyDnD state\n * @param e\n * @internal\n */\nexport function updateDropEffect(e: DragEvent) {\n  const dT = e.dataTransfer!;\n  if (copyDnD(e)) {\n    dT.dropEffect = 'copy';\n  } else {\n    dT.dropEffect = 'move';\n  }\n}\n\n/** @internal */\nexport type IDragEffect = 'none' | 'copy' | 'copyLink' | 'copyMove' | 'link' | 'linkMove' | 'move' | 'all';\n\n/** @internal */\nexport interface IDragStartResult {\n  effectAllowed: IDragEffect;\n  data: { [mimeType: string]: string };\n}\n\n/** @internal */\nexport interface IDropResult {\n  effect: IDragEffect;\n  data: { [mimeType: string]: string };\n}\n\nlet idCounter = 0;\n\n/**\n * add drag support for the given element\n * @param {HTMLElement} node\n * @param {() => IDragStartResult} onDragStart callback to compute the payload an object of mime types\n * @param {boolean} stopPropagation whether to stop propagation in case of success\n * @internal\n */\nexport function dragAble(node: HTMLElement, onDragStart: () => IDragStartResult, stopPropagation = false) {\n  const id = ++idCounter;\n\n  node.classList.add(cssClass('dragable'));\n  node.draggable = true;\n\n  node.addEventListener('dragstart', (e) => {\n    node.classList.add(cssClass('dragging'));\n    const payload = onDragStart();\n    e.dataTransfer!.effectAllowed = payload.effectAllowed;\n\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n\n    // copy all data transfer objects\n    const keys = Object.keys(payload.data);\n    const allSucceeded = keys.every((k) => {\n      try {\n        e.dataTransfer!.setData(k, payload.data[k]);\n        return true;\n      } catch (e) {\n        return false;\n      }\n    });\n    if (allSucceeded) {\n      return;\n    }\n    //compatibility mode for edge\n    const text = payload.data['text/plain'] || '';\n    e.dataTransfer!.setData('text/plain', `${id}${text ? `: ${text}` : ''}`);\n    dndTransferStorage.set(id, payload.data);\n  });\n\n  node.addEventListener('dragend', (e) => {\n    node.classList.remove(cssClass('dragging'));\n\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n\n    if (dndTransferStorage.size > 0) {\n      //clear the id\n      dndTransferStorage.delete(id);\n    }\n\n    // remove all\n    const over = node.ownerDocument!.getElementsByClassName(cssClass('dragover'))[0] as HTMLElement;\n    if (over) {\n      over.classList.remove(cssClass('dragover'));\n    }\n  });\n}\n\n/**\n * add dropable support for the given node\n * @param {HTMLElement} node\n * @param {string[]} mimeTypes mimeTypes to look for\n * @param {(result: IDropResult, e: DragEvent) => boolean} onDrop callback when dropped, returns true if the drop was successful\n * @param {(e: DragEvent) => void} onDragOver optional drag over handler, e.g. for special effects\n * @param {boolean} stopPropagation flag if the event propagation should be stopped in case of success\n * @param {() => boolean} optional whether to enable dropping at all\n * @internal\n */\nexport function dropAble(\n  node: HTMLElement,\n  mimeTypes: string[],\n  onDrop: (result: IDropResult, e: DragEvent) => boolean,\n  onDragOver: null | ((e: DragEvent) => void) = null,\n  stopPropagation = false,\n  canDrop: () => boolean = () => true\n) {\n  node.addEventListener('dragenter', (e) => {\n    //var xy = mouse($node.node());\n    if (node.classList.contains(cssClass('dragging')) || !(hasDnDType(e, ...mimeTypes) || isEdgeDnD(e)) || !canDrop()) {\n      // not a valid mime type\n      node.classList.remove(cssClass('dragover'));\n      return undefined;\n    }\n    node.classList.add(cssClass('dragover'));\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n    //sounds good\n    return false;\n  });\n\n  node.addEventListener('dragover', (e) => {\n    if (node.classList.contains(cssClass('dragging')) || !(hasDnDType(e, ...mimeTypes) || isEdgeDnD(e)) || !canDrop()) {\n      // not a valid mime type\n      return undefined;\n    }\n\n    e.preventDefault();\n    updateDropEffect(e);\n    node.classList.add(cssClass('dragover'));\n\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n    if (onDragOver) {\n      onDragOver(e);\n    }\n    //sound good\n    return false;\n  });\n\n  node.addEventListener('dragleave', (evt) => {\n    // same fix as in phovea\n    (evt.target as HTMLElement).classList.remove(cssClass('dragover'));\n  });\n\n  node.addEventListener('drop', (e) => {\n    e.preventDefault();\n    if (stopPropagation) {\n      e.stopPropagation();\n    }\n    updateDropEffect(e);\n\n    const effect = e.dataTransfer!.dropEffect as IDragEffect;\n\n    node.classList.remove(cssClass('dragover'));\n\n    if (isEdgeDnD(e)) {\n      // retrieve from helper\n      const base = e.dataTransfer!.getData('text/plain');\n      const id = Number.parseInt(base.indexOf(':') >= 0 ? base.substring(0, base.indexOf(':')) : base, 10);\n      if (dndTransferStorage.has(id)) {\n        const data = dndTransferStorage.get(id)!;\n        dndTransferStorage.delete(id);\n        return !onDrop({ effect, data }, e);\n      }\n      return undefined;\n    }\n\n    if (!hasDnDType(e, ...mimeTypes)) {\n      return undefined;\n    }\n\n    // copy sub mime types\n    const data: any = {};\n    //selects the data contained in the data transfer\n    mimeTypes.forEach((mime) => {\n      const value = e.dataTransfer!.getData(mime);\n      if (value !== '') {\n        data[mime] = value;\n      }\n    });\n    return !onDrop({ effect, data }, e);\n  });\n}\n","import type { Column } from '../model';\nimport { getAllToolbarActions, getAllToolbarDialogAddons } from '../model/internal';\nimport type { IRankingHeaderContext, IToolbarAction } from './interfaces';\n\nfunction sortActions(a: IToolbarAction, b: IToolbarAction) {\n  if (a.options.order === b.options.order) {\n    return a.title.toString().localeCompare(b.title.toString());\n  }\n  return (a.options.order || 50) - (b.options.order || 50);\n}\n\nfunction getFullToolbar(col: Column, ctx: IRankingHeaderContext) {\n  const cache = ctx.caches.toolbar;\n  if (cache.has(col.desc.type)) {\n    return cache.get(col.desc.type)!;\n  }\n\n  const keys = getAllToolbarActions(col);\n\n  if (!col.fixed) {\n    keys.push('remove');\n  }\n  {\n    const possible = ctx.getPossibleRenderer(col);\n    if (possible.item.length > 2 || possible.group.length > 2 || possible.summary.length > 2) {\n      // default always possible\n      keys.push('vis');\n    }\n  }\n\n  const actions = ctx.resolveToolbarActions(col, keys);\n\n  const r = Array.from(new Set(actions)).sort(sortActions);\n  cache.set(col.desc.type, r);\n  return r;\n}\n\n/** @internal */\nexport function getToolbar(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  const flags = ctx.flags;\n\n  return toolbar.filter((a) => {\n    if (a.enabled && !a.enabled(col)) {\n      return false;\n    }\n    // level is basic or not one of disabled features\n    return (\n      a.options.featureLevel === 'basic' ||\n      !(\n        (flags.advancedModelFeatures === false && a.options.featureCategory === 'model') ||\n        (flags.advancedRankingFeatures === false && a.options.featureCategory === 'ranking') ||\n        (flags.advancedUIFeatures === false && a.options.featureCategory === 'ui')\n      )\n    );\n  });\n}\n\n/** @internal */\nexport function isSortAble(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  return toolbar.find((d) => d.title === 'Sort' || d.title.startsWith('Sort By')) != null;\n}\n\n/** @internal */\nexport function isGroupAble(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  return toolbar.find((d) => d.title === 'Group' || d.title.startsWith('Group By')) != null;\n}\n\n/** @internal */\nexport function isGroupSortAble(col: Column, ctx: IRankingHeaderContext) {\n  const toolbar = getFullToolbar(col, ctx);\n  return toolbar.find((d) => d.title.startsWith('Sort Groups By')) != null;\n}\n\n/** @internal */\nexport function getToolbarDialogAddons(col: Column, key: string, ctx: IRankingHeaderContext) {\n  const cacheKey = `${col.desc.type}@${key}`;\n  const cacheAddon = ctx.caches.toolbarAddons;\n  if (cacheAddon.has(cacheKey)) {\n    return cacheAddon.get(cacheKey)!;\n  }\n\n  const keys = getAllToolbarDialogAddons(col, key);\n  const actions = ctx.resolveToolbarDialogAddons(col, keys);\n\n  const r = Array.from(new Set(actions)).sort((a, b) => {\n    if (a.order === b.order) {\n      return a.title.localeCompare(b.title);\n    }\n    return (a.order || 50) - (b.order || 50);\n  });\n  cacheAddon.set(cacheKey, r);\n  return r;\n}\n","import Column, { getSortType } from '../model';\nimport { cssClass } from '../styles';\nimport type { IRankingHeaderContext, IToolbarAction } from './interfaces';\nimport { getToolbar } from './toolbarResolvers';\n\n/** @internal */\nexport function actionCSSClass(title: string) {\n  if (title.endsWith('&hellip;')) {\n    title = title.slice(0, -'&hellip;'.length - 1);\n  }\n  if (title.endsWith('By')) {\n    title = title.slice(0, -3);\n  }\n  const clean = title.toLowerCase().replace(/[ +-]/gm, '-');\n  return `${cssClass('action')} ${cssClass(`action-${clean}`)}`;\n}\n\nexport function addIconDOM(\n  node: HTMLElement,\n  col: Column,\n  ctx: IRankingHeaderContext,\n  level: number,\n  showLabel: boolean,\n  mode: 'header' | 'sidePanel'\n) {\n  return (action: IToolbarAction) => {\n    const m = isActionMode(col, action, mode, 'shortcut')\n      ? 'o'\n      : isActionMode(col, action, mode, 'menu+shortcut')\n      ? 's'\n      : 'r';\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<i data-a=\"${m}\" title=\"${action.title}\" class=\"${actionCSSClass(action.title.toString())} ${cssClass(\n        `feature-${action.options.featureLevel || 'basic'}`\n      )} ${cssClass(`feature-${action.options.featureCategory || 'others'}`)}\"><span${\n        !showLabel ? ` class=\"${cssClass('aria')}\" aria-hidden=\"true\"` : ''\n      }>${action.title}</span> </i>`\n    );\n    const i = node.lastElementChild as HTMLElement;\n    i.onclick = (evt) => {\n      evt.stopPropagation();\n      ctx.dialogManager.setHighlightColumn(col);\n      action.onClick(col, evt as any, ctx, level, !showLabel);\n    };\n    return i;\n  };\n}\n\nexport function isActionMode(\n  col: Column,\n  d: IToolbarAction,\n  mode: 'header' | 'sidePanel',\n  value: 'menu' | 'menu+shortcut' | 'shortcut'\n) {\n  const s = d.options.mode === undefined ? 'menu' : d.options.mode;\n  if (s === value) {\n    return true;\n  }\n  if (typeof s === 'function') {\n    return s(col, mode) === value;\n  }\n  return false;\n}\n\n/** @internal */\nexport function createToolbarMenuItems(\n  node: HTMLElement,\n  level: number,\n  col: Column,\n  ctx: IRankingHeaderContext,\n  mode: 'header' | 'sidePanel'\n) {\n  const addIcon = addIconDOM(node, col, ctx, level, true, mode);\n  getToolbar(col, ctx)\n    .filter((d) => !isActionMode(col, d, mode, 'shortcut'))\n    .forEach(addIcon);\n}\n\n/** @internal */\nexport function updateIconState(node: HTMLElement, col: Column) {\n  const sort = node.getElementsByClassName(cssClass('action-sort'))[0]! as HTMLElement;\n  if (sort) {\n    const { asc, priority } = col.isSortedByMe();\n    sort.dataset.sort = asc !== undefined ? asc : '';\n    sort.dataset.type = getSortType(col);\n    if (priority !== undefined) {\n      sort.dataset.priority = (priority + 1).toString();\n    } else {\n      delete sort.dataset.priority;\n    }\n  }\n\n  const sortGroups = node.getElementsByClassName(cssClass('action-sort-groups'))[0]! as HTMLElement;\n  if (sortGroups) {\n    const { asc, priority } = col.isGroupSortedByMe();\n    sortGroups.dataset.sort = asc !== undefined ? asc : '';\n    sortGroups.dataset.type = getSortType(col);\n    if (priority !== undefined) {\n      sortGroups.dataset.priority = (priority + 1).toString();\n    } else {\n      delete sortGroups.dataset.priority;\n    }\n  }\n\n  const group = node.getElementsByClassName(cssClass('action-group'))[0]! as HTMLElement;\n  if (group) {\n    const groupedBy = col.isGroupedBy();\n    group.dataset.group = groupedBy >= 0 ? 'true' : 'false';\n    if (groupedBy >= 0) {\n      group.dataset.priority = (groupedBy + 1).toString();\n    } else {\n      delete group.dataset.priority;\n    }\n  }\n\n  const filter = node.getElementsByClassName(cssClass('action-filter'))[0]! as HTMLElement;\n  if (!filter) {\n    return;\n  }\n  if (col.isFiltered()) {\n    filter.dataset.active = '';\n  } else {\n    delete filter.dataset.active;\n  }\n}\n","import type { Column } from '../../model';\nimport { createToolbarMenuItems, updateIconState } from '../headerTooltip';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport type { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class MoreColumnOptionsDialog extends APopup {\n  constructor(\n    private readonly column: Column,\n    dialog: IDialogContext,\n    private readonly mode: 'header' | 'sidePanel',\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      autoClose: true,\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('more-options'));\n    node.dataset.colId = this.column.id;\n    createToolbarMenuItems(node, this.dialog.level + 1, this.column, this.ctx, this.mode);\n\n    updateIconState(node, this.column);\n  }\n}\n","import { MIN_LABEL_WIDTH } from '../constants';\nimport { equalArrays, dragAble, dropAble, hasDnDType, IDropResult } from '../internal';\nimport { categoryOf } from '../model';\nimport {\n  createNestedDesc,\n  createReduceDesc,\n  createStackDesc,\n  IColumnDesc,\n  isArrayColumn,\n  isBoxPlotColumn,\n  isCategoricalColumn,\n  isMapColumn,\n  isNumberColumn,\n  isNumbersColumn,\n  Column,\n  ImpositionCompositeColumn,\n  ImpositionCompositesColumn,\n  createImpositionDesc,\n  createImpositionsDesc,\n  ImpositionBoxPlotColumn,\n  createImpositionBoxPlotDesc,\n  CompositeColumn,\n  IMultiLevelColumn,\n  isMultiLevelColumn,\n} from '../model';\nimport { aria, cssClass, engineCssClass, RESIZE_ANIMATION_DURATION, RESIZE_SPACE } from '../styles';\nimport MoreColumnOptionsDialog from './dialogs/MoreColumnOptionsDialog';\nimport type { IRankingHeaderContext, IOnClickHandler } from './interfaces';\nimport { getToolbar } from './toolbarResolvers';\nimport { dialogContext } from './dialogs';\nimport { addIconDOM, actionCSSClass, isActionMode, updateIconState } from './headerTooltip';\n\nexport { createToolbarMenuItems, actionCSSClass } from './headerTooltip';\n\n/** @internal */\nexport interface IHeaderOptions {\n  dragAble: boolean;\n  mergeDropAble: boolean;\n  rearrangeAble: boolean;\n  resizeable: boolean;\n  level: number;\n  extraPrefix: string;\n}\n\n/** @internal */\nexport function createHeader(col: Column, ctx: IRankingHeaderContext, options: Partial<IHeaderOptions> = {}) {\n  options = Object.assign(\n    {\n      dragAble: true,\n      mergeDropAble: true,\n      rearrangeAble: true,\n      resizeable: true,\n      level: 0,\n      extraPrefix: '',\n    },\n    options\n  );\n  const node = ctx.document.createElement('section');\n\n  const extra = options.extraPrefix\n    ? (name: string) => `${cssClass(name)} ${cssClass(`${options.extraPrefix}-${name}`)}`\n    : cssClass;\n  const summary = col.getMetaData().summary;\n  node.innerHTML = `\n    <div class=\"${extra('label')} ${cssClass('typed-icon')}\">${\n    col.getWidth() < MIN_LABEL_WIDTH ? '&nbsp;' : col.label\n  }</div>\n    <div class=\"${extra('sublabel')}\">${col.getWidth() < MIN_LABEL_WIDTH || !summary ? '&nbsp;' : summary}</div>\n    <div class=\"${extra('toolbar')}\"></div>\n    <div class=\"${extra('spacing')}\"></div>\n    <div class=\"${extra('handle')} ${cssClass('feature-advanced')} ${cssClass('feature-ui')}\"></div>\n  `;\n\n  // addTooltip(node, col);\n\n  createShortcutMenuItems(\n    node.getElementsByClassName(cssClass('toolbar'))[0]! as HTMLElement,\n    options.level!,\n    col,\n    ctx,\n    'header'\n  );\n\n  toggleToolbarIcons(node, col);\n\n  if (options.dragAble) {\n    dragAbleColumn(node, col, ctx);\n  }\n  if (options.mergeDropAble) {\n    mergeDropAble(node, col, ctx);\n  }\n  if (options.rearrangeAble) {\n    rearrangeDropAble(node.getElementsByClassName(cssClass('handle'))[0]! as HTMLElement, col, ctx);\n  }\n  if (options.resizeable) {\n    dragWidth(col, node);\n  }\n  return node;\n}\n\n/** @internal */\nexport function updateHeader(node: HTMLElement, col: Column, minWidth = MIN_LABEL_WIDTH) {\n  const label = node.getElementsByClassName(cssClass('label'))[0]! as HTMLElement;\n  label.innerHTML = col.getWidth() < minWidth ? '&nbsp;' : col.label;\n  const summary = col.getMetaData().summary;\n  const subLabel = node.getElementsByClassName(cssClass('sublabel'))[0] as HTMLElement;\n  if (subLabel) {\n    subLabel.innerHTML = col.getWidth() < minWidth || !summary ? '&nbsp;' : summary;\n  }\n\n  let title = col.label;\n  if (summary) {\n    title = `${title}\\n${summary}`;\n  }\n  if (col.description) {\n    title = `${title}\\n${col.description}`;\n  }\n  node.title = title;\n  node.dataset.colId = col.id;\n  node.dataset.type = col.desc.type;\n  label.dataset.typeCat = categoryOf(col).name;\n\n  updateIconState(node, col);\n\n  updateMoreDialogIcons(node, col);\n}\n\nfunction updateMoreDialogIcons(node: HTMLElement, col: Column) {\n  const root = node.closest(`.${cssClass()}`);\n  if (!root) {\n    return;\n  }\n  const dialog = root.querySelector<HTMLElement>(`.${cssClass('more-options')}[data-col-id=\"${col.id}\"]`);\n  if (!dialog) {\n    return;\n  }\n  updateIconState(dialog, col);\n}\n\n/** @internal */\nexport interface IAddIcon {\n  (title: string, onClick: IOnClickHandler): void;\n}\n\n/** @internal */\nexport function createShortcutMenuItems(\n  node: HTMLElement,\n  level: number,\n  col: Column,\n  ctx: IRankingHeaderContext,\n  mode: 'header' | 'sidePanel',\n  willAutoHide = true\n) {\n  const addIcon = addIconDOM(node, col, ctx, level, false, mode);\n  const toolbar = getToolbar(col, ctx);\n  const shortcuts = toolbar.filter((d) => !isActionMode(col, d, mode, 'menu'));\n  const hybrids = shortcuts.reduce((a, b) => a + (isActionMode(col, b, mode, 'menu+shortcut') ? 1 : 0), 0);\n\n  shortcuts.forEach(addIcon);\n  const moreEntries = toolbar.length - shortcuts.length + hybrids;\n\n  if (shortcuts.length === toolbar.length || (moreEntries === hybrids && !willAutoHide)) {\n    // all visible or just hybrids that will always be visible\n    return;\n  }\n\n  // need a more entry\n  node.insertAdjacentHTML(\n    'beforeend',\n    `<i data-a=\"m\" data-m=\"${moreEntries}\" title=\"More &hellip;\" class=\"${actionCSSClass('More')}\">${aria(\n      'More &hellip;'\n    )}</i>`\n  );\n  const i = node.lastElementChild as HTMLElement;\n  i.onclick = (evt) => {\n    evt.stopPropagation();\n    ctx.dialogManager.setHighlightColumn(col);\n    const dialog = new MoreColumnOptionsDialog(col, dialogContext(ctx, level, evt), mode, ctx);\n    dialog.open();\n  };\n}\n\n/** @internal */\nfunction toggleRotatedHeader(node: HTMLElement, col: Column, defaultVisibleClientWidth: number) {\n  // rotate header flag if needed\n  const label = node.getElementsByClassName(cssClass('label'))[0] as HTMLElement;\n  if (col.getWidth() < MIN_LABEL_WIDTH) {\n    label.classList.remove(`.${cssClass('rotated')}`);\n    return;\n  }\n  const width = label.clientWidth;\n  const rotated =\n    width <= 0\n      ? ((col.label.length * defaultVisibleClientWidth) / 3) * 0.6 > col.getWidth()\n      : label.scrollWidth * 0.6 > label.clientWidth;\n  label.classList.toggle(`.${cssClass('rotated')}`, rotated);\n}\n\n/** @internal */\nfunction toggleToolbarIcons(node: HTMLElement, col: Column, defaultVisibleClientWidth = 22.5) {\n  toggleRotatedHeader(node, col, defaultVisibleClientWidth);\n\n  const toolbar = node.getElementsByClassName(cssClass('toolbar'))[0] as HTMLElement;\n  if (toolbar.childElementCount === 0) {\n    return;\n  }\n  const availableWidth = col.getWidth();\n  const actions = Array.from(toolbar.children).map((d) => ({\n    node: d as HTMLElement,\n    width: d.clientWidth > 0 ? d.clientWidth : defaultVisibleClientWidth,\n  }));\n\n  const shortCuts = actions.filter((d) => d.node.dataset.a === 'o');\n  const hybrids = actions.filter((d) => d.node.dataset.a === 's');\n  const moreIcon = actions.find((d) => d.node.dataset.a === 'm');\n  const moreEntries = moreIcon ? Number.parseInt(moreIcon.node.dataset.m!, 10) : 0;\n  const needMore = moreEntries > hybrids.length;\n\n  let total = actions.reduce((a, b) => a + b.width, 0);\n\n  for (const action of actions) {\n    // maybe hide not needed \"more\"\n    action.node.classList.remove(cssClass('hidden'));\n  }\n\n  // all visible\n  if (total < availableWidth) {\n    return;\n  }\n  if (moreIcon && !needMore && total - moreIcon.width < availableWidth) {\n    // available space is enough we can skip the \"more\" and then it fits\n    moreIcon.node.classList.add(cssClass('hidden'));\n    return;\n  }\n\n  for (const action of hybrids.reverse().concat(shortCuts.reverse())) {\n    // back to forth and hybrids earlier than pure shortcuts\n    // hide and check if enough\n    action.node.classList.add(cssClass('hidden'));\n    total -= action.width;\n    if (total < availableWidth) {\n      return;\n    }\n  }\n}\n\n/**\n * allow to change the width of a column using dragging the handle\n * @internal\n */\nexport function dragWidth(col: Column, node: HTMLElement) {\n  let ueberElement: HTMLElement;\n  let sizeHelper: HTMLElement;\n  let currentFooterTransformation = '';\n  const handle = node.getElementsByClassName(cssClass('handle'))[0] as HTMLElement;\n\n  let start = 0;\n  let originalWidth = 0;\n  const mouseMove = (evt: MouseEvent) => {\n    evt.stopPropagation();\n    evt.preventDefault();\n    const end = evt.clientX;\n    const delta = end - start;\n\n    if (Math.abs(start - end) < 2) {\n      //ignore\n      return;\n    }\n    start = end;\n    const width = Math.max(0, col.getWidth() + delta);\n\n    sizeHelper.classList.toggle(cssClass('resize-animated'), width < originalWidth);\n    // no idea why shifted by the size compared to the other footer element\n    sizeHelper.style.transform = `${currentFooterTransformation} translate(${\n      width - originalWidth - RESIZE_SPACE\n    }px, 0px)`;\n\n    node.style.width = `${width}px`;\n    col.setWidth(width);\n    toggleToolbarIcons(node, col);\n  };\n\n  const mouseUp = (evt: MouseEvent) => {\n    evt.stopPropagation();\n    evt.preventDefault();\n    const end = evt.clientX;\n    node.classList.remove(cssClass('change-width'));\n\n    ueberElement.removeEventListener('mousemove', mouseMove);\n    ueberElement.removeEventListener('mouseup', mouseUp);\n    ueberElement.removeEventListener('mouseleave', mouseUp);\n    ueberElement.classList.remove(cssClass('resizing'));\n    node.style.width = null;\n    setTimeout(() => {\n      sizeHelper.classList.remove(cssClass('resizing'), cssClass('resize-animated'));\n    }, RESIZE_ANIMATION_DURATION * 1.2); // after animation ended\n\n    if (Math.abs(start - end) < 2) {\n      //ignore\n      return;\n    }\n    const delta = end - start;\n    const width = Math.max(0, col.getWidth() + delta);\n    col.setWidth(width);\n    toggleToolbarIcons(node, col);\n  };\n  handle.onmousedown = (evt) => {\n    evt.stopPropagation();\n    evt.preventDefault();\n    node.classList.add(cssClass('change-width'));\n\n    originalWidth = col.getWidth();\n    start = evt.clientX;\n    ueberElement = node.closest<HTMLElement>('body') || node.closest<HTMLElement>(`.${cssClass()}`)!; // take the whole body or root lineup\n    ueberElement.addEventListener('mousemove', mouseMove);\n    ueberElement.addEventListener('mouseup', mouseUp);\n    ueberElement.addEventListener('mouseleave', mouseUp);\n    ueberElement.classList.add(cssClass('resizing'));\n\n    sizeHelper = node\n      .closest<HTMLElement>(`.${engineCssClass()}`)!\n      .querySelector<HTMLElement>(`.${cssClass('resize-helper')}`);\n    currentFooterTransformation = (sizeHelper.previousElementSibling! as HTMLElement).style.transform!;\n    sizeHelper.style.transform = `${currentFooterTransformation} translate(${-RESIZE_SPACE}px, 0px)`;\n    sizeHelper.classList.add(cssClass('resizing'));\n  };\n  handle.onclick = (evt) => {\n    // avoid resorting\n    evt.stopPropagation();\n    evt.preventDefault();\n  };\n}\n\n/** @internal */\nexport const MIMETYPE_PREFIX = 'text/x-caleydo-lineup-column';\n\n/**\n * allow to drag the column away\n * @internal\n */\nexport function dragAbleColumn(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\n  dragAble(\n    node,\n    () => {\n      const ref = JSON.stringify(ctx.provider.toDescRef(column.desc));\n      const data: any = {\n        'text/plain': column.label,\n        [`${MIMETYPE_PREFIX}-ref`]: column.id,\n        [MIMETYPE_PREFIX]: ref,\n      };\n      if (isNumberColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-number`] = ref;\n        data[`${MIMETYPE_PREFIX}-number-ref`] = column.id;\n      }\n      if (isCategoricalColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-categorical`] = ref;\n        data[`${MIMETYPE_PREFIX}-categorical-ref`] = column.id;\n      }\n      if (isBoxPlotColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-boxplot`] = ref;\n        data[`${MIMETYPE_PREFIX}-boxplot-ref`] = column.id;\n      }\n      if (isMapColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-map`] = ref;\n        data[`${MIMETYPE_PREFIX}-map-ref`] = column.id;\n      }\n      if (isArrayColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-array`] = ref;\n        data[`${MIMETYPE_PREFIX}-array-ref`] = column.id;\n      }\n      if (isNumbersColumn(column)) {\n        data[`${MIMETYPE_PREFIX}-numbers`] = ref;\n        data[`${MIMETYPE_PREFIX}-numbers-ref`] = column.id;\n      }\n      return {\n        effectAllowed: 'copyMove',\n        data,\n      };\n    },\n    true\n  );\n}\n\n/**\n * dropper for allowing to rearrange (move, copy) columns\n * @internal\n */\nexport function rearrangeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\n  dropAble(\n    node,\n    [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX],\n    (result) => {\n      let col: Column | null = null;\n      const data = result.data;\n      if (!(`${MIMETYPE_PREFIX}-ref` in data)) {\n        const desc = JSON.parse(data[MIMETYPE_PREFIX]);\n        col = ctx.provider.create(ctx.provider.fromDescRef(desc));\n        return col != null && column.insertAfterMe(col) != null;\n      }\n\n      // find by reference\n      const id = data[`${MIMETYPE_PREFIX}-ref`];\n      col = ctx.provider.find(id);\n      if (!col || (col === column && !result.effect.startsWith('copy'))) {\n        return false;\n      }\n      if (result.effect.startsWith('copy')) {\n        col = ctx.provider.clone(col!);\n        return col != null && column.insertAfterMe(col) != null;\n      }\n      // detect whether it is an internal move operation or an real remove/insert operation\n      const toInsertParent = col.parent;\n      if (!toInsertParent) {\n        // no parent will always be a move\n        return column.insertAfterMe(col) != null;\n      }\n      if (toInsertParent === column.parent) {\n        // move operation\n        return toInsertParent.moveAfter(col, column) != null;\n      }\n      col.removeMe();\n      return column.insertAfterMe(col) != null;\n    },\n    null,\n    true\n  );\n}\n\n/**\n * dropper for allowing to change the order by dropping it at a certain position\n * @internal\n */\nexport function resortDropAble(\n  node: HTMLElement,\n  column: Column,\n  ctx: IRankingHeaderContext,\n  where: 'before' | 'after',\n  autoGroup: boolean\n) {\n  dropAble(\n    node,\n    [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX],\n    (result) => {\n      let col: Column | null = null;\n      const data = result.data;\n      if (`${MIMETYPE_PREFIX}-ref` in data) {\n        const id = data[`${MIMETYPE_PREFIX}-ref`];\n        col = ctx.provider.find(id);\n        if (!col || col === column) {\n          return false;\n        }\n      } else {\n        const desc = JSON.parse(data[MIMETYPE_PREFIX]);\n        col = ctx.provider.create(ctx.provider.fromDescRef(desc));\n        if (col) {\n          column.findMyRanker()!.push(col);\n        }\n      }\n      const ranking = column.findMyRanker()!;\n      if (!col || col === column || !ranking) {\n        return false;\n      }\n\n      const criteria = ranking.getSortCriteria();\n      const groups = ranking.getGroupCriteria();\n\n      const removeFromSort = (col: Column) => {\n        const existing = criteria.findIndex((d) => d.col === col);\n        if (existing >= 0) {\n          // remove existing column but keep asc state\n          return criteria.splice(existing, 1)[0].asc;\n        }\n        return false;\n      };\n\n      // remove the one to add\n      const asc = removeFromSort(col);\n\n      const groupIndex = groups.indexOf(column);\n      const index = criteria.findIndex((d) => d.col === column);\n\n      if (autoGroup && groupIndex >= 0) {\n        // before the grouping, so either un group or regroup\n        removeFromSort(column);\n        if (isCategoricalColumn(col)) {\n          // we can group by it\n          groups.splice(groupIndex + (where === 'after' ? 1 : 0), 0, col);\n        } else {\n          // remove all before and shift to sorting + sorting\n          const removed = groups.splice(0, groups.length - groupIndex);\n          criteria.unshift(...removed.reverse().map((d) => ({ asc: false, col: d }))); // now a first sorting criteria\n          criteria.unshift({ asc, col });\n        }\n      } else if (index < 0) {\n        criteria.push({ asc, col });\n      } else if (index === 0 && autoGroup && isCategoricalColumn(col)) {\n        // make group criteria\n        groups.push(col);\n      } else {\n        criteria.splice(index + (where === 'after' ? 1 : 0), 0, { asc, col });\n      }\n\n      if (!equalArrays(groups, ranking.getGroupCriteria())) {\n        ranking.setGroupCriteria(groups);\n      }\n      ranking.setSortCriteria(criteria);\n      return true;\n    },\n    null,\n    true\n  );\n}\n\n/**\n * dropper for merging columns\n * @internal\n */\nexport function mergeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\n  const resolveDrop = (result: IDropResult) => {\n    const data = result.data;\n    const copy = result.effect === 'copy';\n    const prefix = MIMETYPE_PREFIX;\n    const key = Object.keys(data).find((d) => d.startsWith(prefix) && d.endsWith('-ref'));\n    if (key) {\n      const id = data[key];\n      let col: Column = ctx.provider.find(id)!;\n      if (copy) {\n        col = ctx.provider.clone(col);\n      } else if (col === column) {\n        return null;\n      } else {\n        col.removeMe();\n      }\n      return col;\n    }\n    const alternative = Object.keys(data).find((d) => d.startsWith(prefix));\n    if (!alternative) {\n      return null;\n    }\n    const desc = JSON.parse(alternative);\n    return ctx.provider.create(ctx.provider.fromDescRef(desc))!;\n  };\n\n  const pushChild = (result: IDropResult) => {\n    const col: Column | null = resolveDrop(result);\n    return col != null && (column as CompositeColumn).push(col) != null;\n  };\n\n  const mergeImpl = (col: Column | null, desc: IColumnDesc) => {\n    if (col == null) {\n      return false;\n    }\n    const ranking = column.findMyRanker()!;\n    const index = ranking.indexOf(column);\n    const parent = ctx.provider.create(desc) as CompositeColumn;\n    column.removeMe();\n    parent.push(column);\n    parent.push(col);\n    return ranking.insert(parent, index) != null;\n  };\n\n  const mergeWith = (desc: IColumnDesc) => (result: IDropResult) => {\n    const col: Column | null = resolveDrop(result);\n    return mergeImpl(col, desc);\n  };\n\n  const all = [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX];\n  const numberish = [`${MIMETYPE_PREFIX}-number-ref`, `${MIMETYPE_PREFIX}-number`];\n  const categorical = [`${MIMETYPE_PREFIX}-categorical-ref`, `${MIMETYPE_PREFIX}-categorical`];\n  const boxplot = [`${MIMETYPE_PREFIX}-boxplot-ref`, `${MIMETYPE_PREFIX}-boxplot`];\n  const numbers = [`${MIMETYPE_PREFIX}-numbers-ref`, `${MIMETYPE_PREFIX}-numbers`];\n\n  node.dataset.draginfo = '+';\n  if (column instanceof ImpositionCompositeColumn) {\n    return dropAble(\n      node,\n      categorical.concat(numberish),\n      pushChild,\n      (e) => {\n        if (hasDnDType(e, ...categorical)) {\n          node.dataset.draginfo = 'Color by';\n          return;\n        }\n        if (hasDnDType(e, ...numberish)) {\n          node.dataset.draginfo = 'Wrap';\n        }\n      },\n      false,\n      () => column.children.length < 2\n    );\n  }\n  if (column instanceof ImpositionBoxPlotColumn) {\n    return dropAble(\n      node,\n      categorical.concat(boxplot),\n      pushChild,\n      (e) => {\n        if (hasDnDType(e, ...categorical)) {\n          node.dataset.draginfo = 'Color by';\n          return;\n        }\n        if (hasDnDType(e, ...boxplot)) {\n          node.dataset.draginfo = 'Wrap';\n        }\n      },\n      false,\n      () => column.children.length < 2\n    );\n  }\n  if (column instanceof ImpositionCompositesColumn) {\n    return dropAble(\n      node,\n      categorical.concat(numbers),\n      pushChild,\n      (e) => {\n        if (hasDnDType(e, ...categorical)) {\n          node.dataset.draginfo = 'Color by';\n          return;\n        }\n        if (hasDnDType(e, ...numbers)) {\n          node.dataset.draginfo = 'Wrap';\n        }\n      },\n      false,\n      () => column.children.length < 2\n    );\n  }\n  if (isMultiLevelColumn(column)) {\n    // stack column or nested\n    return dropAble(node, (column as IMultiLevelColumn).canJustAddNumbers ? numberish : all, pushChild);\n  }\n  if (column instanceof CompositeColumn) {\n    return dropAble(node, (column as CompositeColumn).canJustAddNumbers ? numberish : all, pushChild);\n  }\n  if (isNumbersColumn(column)) {\n    node.dataset.draginfo = 'Color by';\n    return dropAble(node, categorical, mergeWith(createImpositionsDesc()));\n  }\n  if (isBoxPlotColumn(column)) {\n    node.dataset.draginfo = 'Color by';\n    return dropAble(node, categorical, mergeWith(createImpositionBoxPlotDesc()));\n  }\n  if (isNumberColumn(column)) {\n    node.dataset.draginfo = 'Merge';\n    return dropAble(\n      node,\n      categorical.concat(numberish),\n      (result: IDropResult, evt: DragEvent) => {\n        const col: Column | null = resolveDrop(result);\n        if (col == null) {\n          return false;\n        }\n        if (isCategoricalColumn(col)) {\n          return mergeImpl(col, createImpositionDesc());\n        }\n        if (isNumberColumn(col)) {\n          return mergeImpl(col, evt.shiftKey ? createReduceDesc() : createStackDesc());\n        }\n        return false;\n      },\n      (e) => {\n        if (hasDnDType(e, ...categorical)) {\n          node.dataset.draginfo = 'Color by';\n          return;\n        }\n        if (hasDnDType(e, ...numberish)) {\n          node.dataset.draginfo = e.shiftKey ? 'Min/Max' : 'Sum';\n        }\n      }\n    );\n  }\n  node.dataset.draginfo = 'Group';\n  return dropAble(node, all, mergeWith(createNestedDesc()));\n}\n","import { debounce, clear, suffix } from '../../internal';\nimport { CompositeColumn } from '../../model';\nimport { createHeader, updateHeader } from '../header';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport type { IDialogContext } from './ADialog';\nimport { cssClass, engineCssClass } from '../../styles';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class CompositeChildrenDialog extends APopup {\n  private readonly id: string;\n\n  constructor(private readonly column: CompositeColumn, dialog: IDialogContext, private ctx: IRankingHeaderContext) {\n    super(dialog);\n    this.id = `.dialog${Math.random().toString(36).slice(-8).substr(0, 3)}`;\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    this.column.on(suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN), null);\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-sub-nested'));\n    const createChildren = () => {\n      this.column.children.forEach((c) => {\n        const n = createHeader(c, this.ctx, {\n          mergeDropAble: false,\n          resizeable: false,\n          level: this.dialog.level + 1,\n          extraPrefix: 'sub',\n        });\n        n.className = cssClass('header');\n        updateHeader(n, c);\n        const summary = this.ctx.summaryRenderer(c, false);\n        const summaryNode = this.ctx.asElement(summary.template);\n        summaryNode.dataset.renderer = c.getSummaryRenderer();\n        summaryNode.classList.add(cssClass('summary'), cssClass('renderer'), cssClass('th-summary'));\n\n        const r = summary.update(summaryNode);\n        if (r) {\n          summaryNode.classList.add(engineCssClass('loading'));\n          r.then(() => {\n            summaryNode.classList.remove(engineCssClass('loading'));\n          });\n        }\n        n.appendChild(summaryNode);\n        node.appendChild(n);\n      });\n    };\n    createChildren();\n\n    this.column.on(\n      suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN),\n      debounce(() => {\n        if (!node.parentElement) {\n          // already closed\n          this.destroy();\n          return;\n        }\n        clear(node);\n        createChildren();\n      })\n    );\n  }\n}\n","import { HierarchyColumn, ICategoryInternalNode, ICutOffNode, resolveInnerNodes } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\n\n/** @internal */\nexport default class CutOffHierarchyDialog extends ADialog {\n  private readonly innerNodes: ICategoryInternalNode[];\n  private readonly innerNodePaths: string[];\n\n  private readonly before: ICutOffNode;\n\n  constructor(private readonly column: HierarchyColumn, dialog: IDialogContext, private readonly idPrefix: string) {\n    super(dialog, {\n      livePreview: 'cutOff',\n    });\n\n    this.innerNodes = resolveInnerNodes(this.column.hierarchy);\n    this.innerNodePaths = this.innerNodes.map((n) => n.path);\n    this.before = column.getCutOff();\n  }\n\n  protected build(node: HTMLElement) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n        <input type=\"text\" value=\"${this.before.node.label}\" required=\"required\" autofocus=\"autofocus\" list=\"ui${\n        this.idPrefix\n      }lineupHierarchyList\" placeholder=\"cut off node\">\n        <input type=\"number\" value=\"${\n          isFinite(this.before.maxDepth) ? this.before.maxDepth : ''\n        }\" placeholder=\"max depth (&infin;)\">\n        <datalist id=\"ui${this.idPrefix}lineupHierarchyList\">${this.innerNodes.map(\n        (node) => `<option value=\"${node.path}\">${node.label}</option>`\n      )}</datalist>`\n    );\n\n    //custom validation\n    const innerNodePaths = this.innerNodePaths;\n    this.findInput('input[type=\"text\"]').addEventListener(\n      'change',\n      function (this: HTMLInputElement) {\n        const value = this.value;\n        if (innerNodePaths.indexOf(value) < 0) {\n          this.setCustomValidity('invalid node');\n        } else {\n          this.setCustomValidity('');\n        }\n      },\n      {\n        passive: true,\n      }\n    );\n\n    this.enableLivePreviews('input[type=text],input[type=number]');\n  }\n\n  protected reset() {\n    this.findInput('input[type=\"text\"]').value = this.column.hierarchy.path;\n    this.findInput('input[type=\"number\"]').value = '';\n  }\n\n  protected cancel() {\n    this.column.setCutOff(this.before);\n  }\n\n  protected submit() {\n    const newNode = this.findInput('input[type=\"text\"]').value;\n    const newNodeIndex = this.innerNodePaths.indexOf(newNode);\n    const node = this.innerNodes[newNodeIndex];\n    const maxDepthText = this.findInput('input[type=\"number\"]').value;\n    const maxDepth = maxDepthText === '' ? Number.POSITIVE_INFINITY : Number.parseInt(maxDepthText, 10);\n    this.column.setCutOff({ node, maxDepth });\n    return true;\n  }\n}\n","import type { DateColumn, IDateFilter } from '../../model';\nimport { noDateFilter } from '../../model/internalDate';\nimport { createDateFilter } from '../../renderer/DateHistogramCellRenderer';\nimport { cssClass } from '../../styles';\nimport ADialog, { IDialogContext } from './ADialog';\nimport type { IRankingHeaderContext } from '../interfaces';\n\n/** @internal */\nexport default class DateFilterDialog extends ADialog {\n  private readonly before: IDateFilter;\n  private handler: { reset: () => void; submit: () => void; cleanUp: () => void } | null = null;\n\n  constructor(\n    private readonly column: DateColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n      cancelSubDialogs: true,\n    });\n    this.before = this.column.getFilter() ?? noDateFilter();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-mapper'));\n\n    this.handler = createDateFilter(\n      this.column,\n      node,\n      {\n        dialogManager: this.ctx.dialogManager,\n        idPrefix: this.ctx.idPrefix,\n        tasks: this.ctx.provider.getTaskExecutor(),\n      },\n      this.showLivePreviews()\n    );\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    this.handler!.cleanUp();\n  }\n\n  protected reset() {\n    this.handler!.reset();\n  }\n\n  protected submit() {\n    this.handler!.submit();\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setFilter(this.before);\n  }\n}\n","import type { LinkColumn, LinkMapColumn, LinksColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\n\n/** @internal */\nexport default class EditPatternDialog extends ADialog {\n  private readonly before: string;\n\n  constructor(\n    private readonly column: LinkColumn | LinksColumn | LinkMapColumn,\n    dialog: IDialogContext,\n    private readonly idPrefix: string\n  ) {\n    super(dialog);\n\n    this.before = this.column.getPattern();\n  }\n\n  protected build(node: HTMLElement) {\n    const templates = this.column.patternTemplates;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<strong>Edit Pattern (access via $\\{value}, $\\{item})</strong><input\n        type=\"text\"\n        size=\"30\"\n        value=\"${this.before}\"\n        required\n        autofocus\n        placeholder=\"pattern (access via $\\{value}, $\\{item})\"\n        ${templates.length > 0 ? `list=\"ui${this.idPrefix}lineupPatternList\"` : ''}\n      >`\n    );\n    if (templates.length > 0) {\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<datalist id=\"ui${this.idPrefix}lineupPatternList\">${templates.map((t) => `<option value=\"${t}\">`)}</datalist>`\n      );\n    }\n\n    this.enableLivePreviews('input');\n  }\n\n  protected cancel() {\n    this.column.setPattern(this.before);\n  }\n\n  protected reset() {\n    this.node.querySelector('input')!.value = '';\n  }\n\n  protected submit() {\n    const newValue = this.node.querySelector('input')!.value;\n    this.column.setPattern(newValue);\n    return true;\n  }\n}\n","import type { Column } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { uniqueId, forEach } from './utils';\nimport { getToolbarDialogAddons } from '../toolbarResolvers';\nimport type { IRankingHeaderContext, IToolbarDialogAddonHandler } from '../interfaces';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class GroupDialog extends ADialog {\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\n\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\n    super(dialog, {\n      livePreview: 'group',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const addons = getToolbarDialogAddons(this.column, 'group', this.ctx);\n    for (const addon of addons) {\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\n      this.handlers.push(addon.append(this.column, this.node, this.dialog, this.ctx));\n    }\n\n    this.handlers.push(sortOrder(node, this.column, this.dialog.idPrefix));\n\n    for (const handler of this.handlers) {\n      this.enableLivePreviews(handler.elems);\n    }\n  }\n\n  protected submit() {\n    for (const handler of this.handlers) {\n      if (handler.submit() === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  protected cancel() {\n    for (const handler of this.handlers) {\n      handler.cancel();\n    }\n  }\n\n  protected reset() {\n    for (const handler of this.handlers) {\n      handler.reset();\n    }\n  }\n}\n\nfunction sortOrder(node: HTMLElement, column: Column, idPrefix: string): IToolbarDialogAddonHandler {\n  const ranking = column.findMyRanker()!;\n  const current = ranking.getGroupCriteria();\n  let order = current.indexOf(column);\n  const enabled = order >= 0;\n\n  if (order < 0) {\n    order = current.length;\n  }\n\n  const id = uniqueId(idPrefix);\n  node.insertAdjacentHTML(\n    'afterbegin',\n    `\n        <strong>Group By</strong>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"grouped\" value=\"true\" ${\n      enabled ? 'checked' : ''\n    } ><span>Enabled</span></label>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"grouped\" value=\"false\" ${\n      !enabled ? 'checked' : ''\n    } ><span>Disabled</span></label>\n        <strong>Group Priority</strong>\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${order + 1}\">\n    `\n  );\n\n  const updateDisabled = (disable: boolean) => {\n    forEach(\n      node,\n      'input:not([name=grouped]), select, textarea',\n      (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\n        d.disabled = disable;\n      }\n    );\n  };\n  updateDisabled(!enabled);\n\n  forEach(node, 'input[name=grouped]', (n: HTMLInputElement) => {\n    n.addEventListener(\n      'change',\n      () => {\n        const enabled = n.value === 'true';\n        updateDisabled(!enabled);\n      },\n      {\n        passive: true,\n      }\n    );\n  });\n\n  return {\n    elems: `input[name=grouped], #${id}P`,\n    submit() {\n      const enabled = node.querySelector<HTMLInputElement>('input[name=grouped]:checked')!.value === 'true';\n      const order = Number.parseInt(node.querySelector<HTMLInputElement>(`#${id}P`)!.value, 10) - 1;\n      ranking.groupBy(column, !enabled ? -1 : order);\n      return true;\n    },\n    reset() {\n      node.querySelector<HTMLInputElement>('input[name=grouped][value=false]')!.checked = true;\n      node.querySelector<HTMLInputElement>(`#${id}P`)!.value = (current.length + (!enabled ? 1 : 0)).toString();\n      updateDisabled(true);\n    },\n    cancel() {\n      ranking.groupBy(column, current.indexOf(column));\n    },\n  };\n}\n","import { round, similar, dragHandle, IDragHandleOptions } from '../../internal';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\nfunction clamp(v: number) {\n  return Math.max(Math.min(v, 100), 0);\n}\n\n/** @internal */\nexport interface IMappingAdapter {\n  destroyed(self: MappingLine): void;\n\n  updated(self: MappingLine): void;\n\n  domain(): number[];\n\n  normalizeRaw(v: number): number;\n\n  unnormalizeRaw(v: number): number;\n\n  dialog: IDialogContext;\n\n  formatter(v: number): string;\n}\n\n/** @internal */\nexport default class MappingLineDialog extends ADialog {\n  private readonly before: { domain: number; range: number };\n\n  constructor(\n    private readonly line: {\n      destroy(): void;\n      domain: number;\n      range: number;\n      frozen: boolean;\n      update(domain: number, range: number, trigger: boolean): void;\n    },\n    dialog: IDialogContext,\n    private readonly adapter: IMappingAdapter\n  ) {\n    super(dialog, {\n      livePreview: 'dataMapping',\n    });\n    this.dialog.attachment.classList.add(cssClass('mapping-line-selected'));\n    this.before = {\n      domain: this.line.domain,\n      range: this.line.range,\n    };\n  }\n\n  build(node: HTMLElement) {\n    const domain = this.adapter.domain();\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n        <button class=\"${cssClass('dialog-button')} lu-action-remove\" title=\"Remove\" type=\"button\" ${\n        this.line.frozen ? 'style=\"display: none\"' : ''\n      } ><span style=\"margin-left: 3px\">Remove Mapping Line</span></button>\n        <strong>Input Domain Value (min ... max)</strong>\n        <input type=\"number\" value=\"${this.adapter.formatter(this.adapter.unnormalizeRaw(this.line.domain))}\" ${\n        this.line.frozen ? 'readonly disabled' : ''\n      } autofocus required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\">\n        <strong>Output Normalized Value (0 ... 1)</strong>\n        <input type=\"number\" value=\"${round(this.line.range / 100, 3)}\" required min=\"0\" max=\"1\" step=\"any\">\n      `\n    );\n    this.find('button').addEventListener(\n      'click',\n      () => {\n        this.destroy('confirm');\n        this.line.destroy();\n      },\n      {\n        passive: true,\n      }\n    );\n    this.enableLivePreviews('input');\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n\n    this.dialog.attachment.classList.remove(cssClass('mapping-line-selected'));\n  }\n\n  protected cancel() {\n    this.line.update(this.before.domain, this.before.range, true);\n  }\n\n  protected reset() {\n    this.findInput('input[type=number]').value = round(this.adapter.unnormalizeRaw(this.before.domain), 3).toString();\n    this.findInput('input[type=number]:last-of-type').value = round(this.before.range / 100, 3).toString();\n  }\n\n  protected submit() {\n    if (!this.node.checkValidity()) {\n      return false;\n    }\n    const domain = this.adapter.normalizeRaw(this.findInput('input[type=number]').valueAsNumber);\n    const range = this.findInput('input[type=number]:last-of-type').valueAsNumber * 100;\n    this.line.update(domain, range, true);\n    return true;\n  }\n}\n\n/** @internal */\nexport class MappingLine {\n  readonly node: SVGGElement;\n\n  constructor(g: SVGGElement, public domain: number, public range: number, private readonly adapter: IMappingAdapter) {\n    const h = 52;\n    g.insertAdjacentHTML(\n      'beforeend',\n      `<g class=\"${cssClass('dialog-mapper-mapping')}\" transform=\"translate(${domain},0)\">\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"${h}\"></line>\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"${h}\"></line>\n      <circle r=\"2\"></circle>\n      <circle cx=\"${range - domain}\" cy=\"${h}\" r=\"2\"></circle>\n      <text class=\"${cssClass('dialog-mapper-mapping-domain')} ${\n        domain > 25 && domain < 75 ? cssClass('dialog-mapper-mapping-middle') : ''\n      }${domain > 75 ? cssClass('dialog-mapper-mapping-right') : ''}\" dy=\"-3\">\n        ${this.adapter.formatter(this.adapter.unnormalizeRaw(domain))}\n      </text>\n      <text class=\"${cssClass('dialog-mapper-mapping-range')} ${\n        range > 25 && range < 75 ? cssClass('dialog-mapper-mapping-middle') : ''\n      }${range > 50 ? cssClass('dialog-mapper-mapping-right') : ''}\" dy=\"3\" x=\"${range - domain}\" y=\"${h}\">\n        ${round(range / 100, 3)}\n      </text>\n      <title>Drag the anchor circle to change the mapping, double click to edit</title>\n    </g>`\n    );\n    this.node = g.lastElementChild! as SVGGElement;\n\n    // freeze 0 and 100 domain = raw domain ones\n    this.node.classList.toggle(cssClass('frozen'), similar(0, domain) || similar(domain, 100));\n    {\n      let beforeDomain: number;\n      let beforeRange: number;\n      let shiftDomain: number;\n      let shiftRange: number;\n\n      const normalize = (x: number) => (x * 100) / g.getBoundingClientRect().width;\n\n      const common: Partial<IDragHandleOptions> = {\n        container: g.parentElement!,\n        filter: (evt) => evt.button === 0 && !evt.shiftKey,\n        onStart: (_, x) => {\n          beforeDomain = this.domain;\n          beforeRange = this.range;\n          const normalized = normalize(x);\n          shiftDomain = this.domain - normalized;\n          shiftRange = this.range - normalized;\n        },\n        onEnd: () => {\n          if (!similar(beforeDomain, this.domain) || !similar(beforeRange, this.range)) {\n            this.adapter.updated(this);\n          }\n        },\n      };\n\n      const line = this.node.querySelector<SVGLineElement>('line:first-of-type')!;\n      dragHandle(line, {\n        // line\n        ...common,\n        onDrag: (_, x) => {\n          const normalized = normalize(x);\n          this.update(clamp(normalized + shiftDomain), clamp(normalized + shiftRange));\n        },\n      });\n\n      const domainCircle = this.node.querySelector<SVGLineElement>('circle:first-of-type')!;\n      dragHandle(domainCircle, {\n        ...common,\n        onDrag: (_, x) => {\n          const normalized = normalize(x);\n          this.update(clamp(normalized), this.range);\n        },\n      });\n      const rangeCircle = this.node.querySelector<SVGLineElement>('circle:last-of-type')!;\n      dragHandle(rangeCircle, {\n        ...common,\n        onDrag: (_, x) => {\n          const normalized = normalize(x);\n          this.update(this.domain, clamp(normalized));\n        },\n      });\n    }\n\n    this.node.onclick = (evt) => {\n      if (!evt.shiftKey) {\n        return;\n      }\n      this.openDialog();\n    };\n\n    this.node.ondblclick = () => {\n      this.openDialog();\n    };\n  }\n\n  private openDialog() {\n    const ctx = {\n      manager: this.adapter.dialog.manager,\n      level: this.adapter.dialog.level + 1,\n      attachment: this.node as any,\n      idPrefix: this.adapter.dialog.idPrefix,\n    };\n    const dialog = new MappingLineDialog(this, ctx, this.adapter);\n    dialog.open();\n  }\n\n  get frozen() {\n    return this.node.classList.contains(cssClass('frozen'));\n  }\n\n  destroy(handled = false) {\n    this.node.remove();\n    if (!handled) {\n      this.adapter.destroyed(this);\n    }\n  }\n\n  update(domain: number, range: number, trigger = false) {\n    if (similar(domain, 100)) {\n      domain = 100;\n    }\n    if (similar(domain, 0)) {\n      domain = 0;\n    }\n    if (similar(range, 100)) {\n      range = 100;\n    }\n    if (similar(range, 0)) {\n      range = 0;\n    }\n\n    if (similar(domain, this.domain) && similar(range, this.range)) {\n      return;\n    }\n    if (this.frozen) {\n      domain = this.domain;\n    }\n    this.domain = domain;\n    this.range = range;\n    this.node.setAttribute('transform', `translate(${domain},0)`);\n    const shift = range - domain;\n    Array.from(this.node.querySelectorAll<SVGLineElement>('line')).forEach((d) => d.setAttribute('x2', String(shift)));\n    this.node.querySelector<SVGCircleElement>('circle[cx]')!.setAttribute('cx', String(shift));\n\n    const t1 = this.node.querySelector<SVGTextElement>('text')!;\n    t1.textContent = this.adapter.formatter(this.adapter.unnormalizeRaw(domain));\n    t1.classList.toggle(cssClass('dialog-mapper-mapping-right'), domain > 75);\n    t1.classList.toggle(cssClass('dialog-mapper-mapping-middle'), domain >= 25 && domain <= 75);\n\n    const t2 = this.node.querySelector<SVGTextElement>('text[x]')!;\n    t2.textContent = round(range / 100, 3).toString();\n    t2.classList.toggle(cssClass('dialog-mapper-mapping-right'), range > 75);\n    t2.classList.toggle(cssClass('dialog-mapper-mapping-middle'), range >= 25 && range <= 75);\n    t2.setAttribute('x', String(shift));\n\n    if (trigger) {\n      this.adapter.updated(this);\n    }\n  }\n}\n","import { ISequence, round } from '../../internal';\nimport { IMapAbleColumn, IMappingFunction, isMissingValue, isMapAbleColumn } from '../../model';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { IMappingAdapter, MappingLine } from './MappingLineDialog';\nimport { cssClass } from '../../styles';\nimport { ScaleMappingFunction, ScriptMappingFunction } from '../../model/MappingFunction';\n\n/** @internal */\nexport default class MappingDialog extends ADialog {\n  private scale: IMappingFunction;\n\n  private readonly mappingLines: MappingLine[] = [];\n  private rawDomain: [number, number];\n\n  private readonly data: Promise<ISequence<number>>;\n  private readonly idPrefix: string;\n\n  private readonly before: IMappingFunction;\n\n  private readonly mappingAdapter: IMappingAdapter = {\n    destroyed: (self: MappingLine) => {\n      this.mappingLines.splice(this.mappingLines.indexOf(self), 1);\n      this.updateLines(this.computeScale());\n    },\n    updated: () => this.updateLines(this.computeScale()),\n    domain: () => this.rawDomain,\n    normalizeRaw: this.normalizeRaw.bind(this),\n    unnormalizeRaw: this.unnormalizeRaw.bind(this),\n    dialog: this.dialog,\n    formatter: this.column.getNumberFormat(),\n  };\n\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext, ctx: IRankingHeaderContext) {\n    super(dialog, {\n      livePreview: 'dataMapping',\n      cancelSubDialogs: true,\n    });\n\n    this.idPrefix = `me${ctx.idPrefix}`;\n    this.before = this.column.getMapping().clone();\n    this.scale = this.column.getMapping().clone();\n    const domain = this.scale.domain;\n    this.rawDomain = [domain[0], domain[domain.length - 1]];\n\n    this.data = Promise.resolve(ctx.provider.mappingSample(column));\n  }\n\n  private get scaleType() {\n    if (this.scale instanceof ScriptMappingFunction) {\n      return 'script';\n    }\n    if (this.scale instanceof ScaleMappingFunction) {\n      const base = this.scale.scaleType;\n      if (base !== 'linear') {\n        return base;\n      }\n      // check if invert or absolute\n      const r = this.scale.range;\n      if (r.length === 2 && r[0] === 1 && r[1] === 0) {\n        return 'linear_invert';\n      }\n      if (r.length === 3 && r[0] === 1 && r[1] === 0 && r[2] === 1) {\n        return 'linear_abs';\n      }\n      return 'linear';\n    }\n    return 'unknown';\n  }\n\n  build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-mapper'));\n\n    const r = this.column.findMyRanker();\n    const others = !r ? [] : r.flatColumns.filter((d) => isMapAbleColumn(d) && d !== this.column);\n\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n        <div><label for=\"${this.idPrefix}mapping_type\"><strong>Normalization Scaling:</strong></label><select id=\"${\n        this.idPrefix\n      }mapping_type\" class=\"browser-default\">\n        <option value=\"linear\">Linear</option>\n        <option value=\"linear_invert\">Invert</option>\n        <option value=\"linear_abs\">Absolute</option>\n        <option value=\"log\">Log</option>\n        <option value=\"pow1.1\">Pow 1.1</option>\n        <option value=\"pow2\">Pow 2</option>\n        <option value=\"pow3\">Pow 3</option>\n        <option value=\"sqrt\">Sqrt</option>\n        <option value=\"script\">Custom Script</option>\n        <option value=\"unknown\">Unknown</option>\n        ${\n          others.length > 0\n            ? `<optgroup label=\"Copy From\">${others\n                .map((d) => `<option value=\"copy_${d.id}\">${d.label}</option>`)\n                .join('')}</optgroup>`\n            : ''\n        }\n      </select>\n      </div>\n        <div class=${cssClass('dialog-mapper-domain')}>\n          <input id=\"${this.idPrefix}min\" required type=\"number\" value=\"${round(this.rawDomain[0], 3)}\" step=\"any\">\n          <span>Input Domain (min - max)</span>\n          <input id=\"${this.idPrefix}max\" required type=\"number\" value=\"${round(this.rawDomain[1], 3)}\" step=\"any\">\n        </div>\n        <svg class=\"${cssClass('dialog-mapper-details')}\" viewBox=\"0 0 106 66\">\n           <g transform=\"translate(3,7)\">\n              <rect y=\"-3\" width=\"100\" height=\"10\">\n                <title>Click to create a new mapping line</title>\n              </rect>\n              <rect y=\"49\" width=\"100\" height=\"10\">\n                <title>Click to create a new mapping line</title>\n              </rect>\n           </g>\n        </svg>\n        <div class=${cssClass('dialog-mapper-range')}>\n          <span>Output Normalized Domain (0 - 1)</span>\n        </div>\n        <div class=\"${cssClass('dialog-mapper-script')}\">\n          <strong>Custom Normalization Script</strong>\n          <textarea class=\"${cssClass('textarea')}\"></textarea>\n        </div>`\n    );\n\n    const g = node.querySelector<SVGGElement>(`.${cssClass('dialog-mapper-details')} > g`);\n\n    this.forEach(\n      `.${cssClass('dialog-mapper-details')} rect`,\n      (d: SVGRectElement) =>\n        (d.onclick = (evt) => {\n          evt.preventDefault();\n          evt.stopPropagation();\n          const bb = d.getBoundingClientRect();\n          const x = round(((evt.x - bb.left) * 100) / bb.width, 2);\n          const m = new MappingLine(g, x, x, this.mappingAdapter);\n          this.mappingLines.push(m);\n        })\n    );\n\n    {\n      const select = this.find<HTMLSelectElement>('select');\n      const textarea = this.find<HTMLSelectElement>('textarea');\n      select.onchange = (evt) => {\n        const select = evt.currentTarget as HTMLSelectElement;\n        switch (select.value) {\n          case 'linear_invert':\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), 'linear', [1, 0]);\n            break;\n          case 'linear_abs':\n            this.scale = new ScaleMappingFunction(\n              [this.rawDomain[0], (this.rawDomain[1] - this.rawDomain[0]) / 2, this.rawDomain[1]],\n              'linear',\n              [1, 0, 1]\n            );\n            break;\n          case 'script':\n            const s = new ScriptMappingFunction(this.rawDomain.slice());\n            this.scale = s;\n            textarea.value = s.code;\n            break;\n          case 'unknown':\n            // clone original again\n            this.scale = this.column.getOriginalMapping().clone();\n            break;\n          default:\n            if (select.value.startsWith('copy_')) {\n              this.copyMapping(select.value.slice('copy_'.length));\n              return;\n            }\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), select.value, [0, 1]);\n            break;\n        }\n        this.createMappings();\n        node.dataset.scale = select.value;\n        this.updateLines();\n      };\n      const scaleType = (node.dataset.scale = this.scaleType);\n      select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\n\n      if (scaleType === 'script') {\n        textarea.value = (this.scale as ScriptMappingFunction).code;\n      }\n      this.createMappings();\n    }\n\n    this.forEach(`#${this.idPrefix}min, #${this.idPrefix}max`, (d: HTMLInputElement, i) => {\n      d.onchange = () => {\n        const v = d.valueAsNumber;\n        if (v === this.rawDomain[i]) {\n          d.setCustomValidity('');\n          return;\n        }\n        const other = this.rawDomain[1 - i];\n        if (Number.isNaN(v) || (i === 0 && v >= other) || (i === 1 && v <= other)) {\n          d.setCustomValidity(`value has to be ${i === 0 ? '<= max' : '>= min'}`);\n          return;\n        }\n        d.setCustomValidity('');\n        this.rawDomain[i] = v;\n        this.scale = this.computeScale();\n        const patchedDomain = this.scale.domain.slice();\n        patchedDomain[0] = this.rawDomain[0];\n        patchedDomain[patchedDomain.length - 1] = this.rawDomain[1];\n        this.scale.domain = patchedDomain;\n        this.createMappings();\n        this.updateLines();\n        if (this.showLivePreviews()) {\n          this.column.setMapping(this.scale);\n        }\n      };\n    });\n\n    this.data.then((values) => {\n      values.forEach((v) => {\n        if (!isMissingValue(v)) {\n          g.insertAdjacentHTML(\n            'afterbegin',\n            `<line data-v=\"${v}\" x1=\"${round(this.normalizeRaw(v), 2)}\" x2=\"${round(\n              this.scale.apply(v) * 100,\n              2\n            )}\" y2=\"52\"></line>`\n          );\n        }\n      });\n    });\n  }\n\n  private createMappings() {\n    this.mappingLines.splice(0, this.mappingLines.length).forEach((d) => d.destroy(true));\n    if (!(this.scale instanceof ScaleMappingFunction)) {\n      return;\n    }\n    const g = this.node.querySelector<SVGGElement>(`.${cssClass('dialog-mapper-details')} > g`);\n    const domain = this.scale.domain;\n    const range = this.scale.range;\n    for (let i = 0; i < domain.length; ++i) {\n      this.mappingLines.push(new MappingLine(g, this.normalizeRaw(domain[i]), range[i] * 100, this.mappingAdapter));\n    }\n  }\n\n  private update() {\n    const scaleType = (this.node.dataset.scale = this.scaleType);\n    const select = this.find<HTMLSelectElement>('select');\n    select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\n    if (scaleType === 'script') {\n      this.find<HTMLTextAreaElement>('textarea').value = (this.scale as ScriptMappingFunction).code;\n    }\n    this.forEach(`input[type=number]`, (d: HTMLInputElement, i) => {\n      d.value = round(this.rawDomain[i], 3).toString();\n    });\n  }\n\n  private updateLines(scale = this.scale) {\n    this.forEach(`.${cssClass('dialog-mapper-details')}  > g > line[x1]`, (d: SVGLineElement) => {\n      const v = Number.parseFloat(d.getAttribute('data-v')!);\n      d.setAttribute('x1', round(this.normalizeRaw(v), 2).toString());\n      d.setAttribute('x2', round(scale.apply(v) * 100, 2).toString());\n    });\n  }\n\n  protected reset() {\n    this.scale = this.column.getOriginalMapping().clone();\n    const domain = this.scale.domain;\n    this.rawDomain = [domain[0], domain[domain.length - 1]];\n    this.update();\n    this.createMappings();\n    this.updateLines();\n  }\n\n  private copyMapping(columnId: string) {\n    const r = this.column.findMyRanker();\n    if (!r) {\n      return;\n    }\n    const ref = r.find(columnId)! as IMapAbleColumn;\n    this.scale = ref.getMapping().clone();\n    this.rawDomain = this.scale.domain.slice() as [number, number];\n    this.update();\n    this.createMappings();\n    this.updateLines();\n  }\n\n  private normalizeRaw(d: number) {\n    const v = ((d - this.rawDomain[0]) * 100) / (this.rawDomain[1] - this.rawDomain[0]);\n    return Math.max(Math.min(v, 100), 0); // clamp\n  }\n\n  private unnormalizeRaw(d: number) {\n    return (d * (this.rawDomain[1] - this.rawDomain[0])) / 100 + this.rawDomain[0];\n  }\n\n  private computeScale() {\n    const type = this.scaleType;\n    if (type === 'script') {\n      return new ScriptMappingFunction(this.rawDomain.slice(), this.node.querySelector('textarea')!.value);\n    }\n    this.mappingLines.sort((a, b) => a.domain - b.domain);\n    const domain = this.mappingLines.map((d) => this.unnormalizeRaw(d.domain));\n    const range = this.mappingLines.map((d) => d.range / 100);\n    return new ScaleMappingFunction(domain, type, range);\n  }\n\n  protected submit() {\n    if (!this.node.checkValidity()) {\n      return false;\n    }\n    const scale = this.computeScale();\n    this.column.setMapping(scale);\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setMapping(this.before);\n  }\n}\n","import type { IMapAbleColumn, INumberFilter } from '../../model';\nimport { createNumberFilter } from '../../renderer/HistogramCellRenderer';\nimport { cssClass } from '../../styles';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport ADialog, { IDialogContext } from './ADialog';\n\n/** @internal */\nexport default class NumberFilterDialog extends ADialog {\n  private readonly before: INumberFilter;\n  private handler: { reset: () => void; submit: () => void; cleanUp: () => void } | null = null;\n\n  constructor(\n    private readonly column: IMapAbleColumn,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: 'filter',\n      cancelSubDialogs: true,\n    });\n\n    this.before = column.getFilter();\n  }\n\n  build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-mapper'));\n\n    this.handler = createNumberFilter(\n      this.column,\n      node,\n      {\n        dialogManager: this.ctx.dialogManager,\n        idPrefix: this.ctx.idPrefix,\n        tasks: this.ctx.provider.getTaskExecutor(),\n      },\n      this.showLivePreviews()\n    );\n  }\n\n  cleanUp(action: 'cancel' | 'confirm' | 'handled') {\n    super.cleanUp(action);\n    this.handler!.cleanUp();\n  }\n\n  protected reset() {\n    this.handler!.reset();\n  }\n\n  protected submit() {\n    this.handler!.submit();\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setFilter(this.before);\n  }\n}\n","import { forEach } from '../../renderer/utils';\nimport { cssClass } from '../../styles';\nimport { getSortLabel } from '../../internal';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport function sortMethods(\n  node: HTMLElement,\n  column: { setSortMethod(v: string): void; getSortMethod(): string },\n  methods: string[]\n): IToolbarDialogAddonHandler {\n  const bak = column.getSortMethod();\n  methods.forEach((d) =>\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"multivaluesort\" value=\"${d}\"  ${\n        bak === d ? 'checked' : ''\n      } ><span>${getSortLabel(d)}</span></label>`\n    )\n  );\n\n  forEach(node, 'input[name=multivaluesort]', (n: HTMLInputElement) => {\n    n.addEventListener('change', () => column.setSortMethod(n.value), {\n      passive: true,\n    });\n  });\n\n  return {\n    elems: 'input[name=multivaluesort]',\n    submit() {\n      const selected = node.querySelector<HTMLInputElement>('input[name=multivaluesort]:checked')!.value;\n      column.setSortMethod(selected);\n      return true;\n    },\n    cancel() {\n      column.setSortMethod(bak);\n    },\n    reset() {\n      node.querySelector<HTMLInputElement>(`input[name=multivaluesort][value=\"${bak}\"]`)!.checked = true;\n    },\n  };\n}\n\n/** @internal */\nexport { uniqueId, forEach, forEachChild, colorOf } from '../../renderer/utils';\n","import { EAdvancedSortMethod, ReduceColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { sortMethods } from './utils';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default class ReduceDialog extends ADialog {\n  private handler: IToolbarDialogAddonHandler | null = null;\n\n  constructor(private readonly column: ReduceColumn, dialog: IDialogContext) {\n    super(dialog, {\n      livePreview: 'reduce',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const wrapper = {\n      getSortMethod: () => this.column.getReduce(),\n      setSortMethod: (s: EAdvancedSortMethod) => this.column.setReduce(s),\n    };\n    this.handler = sortMethods(node, wrapper, Object.keys(EAdvancedSortMethod));\n\n    this.enableLivePreviews(this.handler.elems);\n  }\n\n  protected submit() {\n    return this.handler!.submit();\n  }\n\n  protected reset() {\n    this.handler!.reset();\n  }\n\n  protected cancel() {\n    this.handler!.cancel();\n  }\n}\n","import type { Column, IColumnMetaData } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class RenameDialog extends ADialog {\n  private readonly before: IColumnMetaData;\n\n  constructor(private readonly column: Column, dialog: IDialogContext) {\n    super(dialog);\n    this.before = column.getMetaData();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-rename'));\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <input type=\"text\" value=\"${this.column.label}\" required autofocus placeholder=\"name\">\n      <input type=\"text\" value=\"${this.column.getMetaData().summary}\" placeholder=\"summary\" name=\"summary\">\n      <textarea class=\"${cssClass('textarea')}\" rows=\"5\" placeholder=\"description\">${\n        this.column.description\n      }</textarea>`\n    );\n  }\n\n  protected reset() {\n    const desc = this.column.desc;\n    const meta = {\n      label: desc.label || this.column.id,\n      summary: desc.summary || '',\n      description: desc.description || '',\n    };\n    this.findInput('input[type=\"text\"]').value = meta.label;\n    this.findInput('input[name=\"summary\"]').value = meta.summary;\n    this.node.querySelector('textarea')!.value = meta.description;\n  }\n\n  protected submit() {\n    const label = this.findInput('input[type=\"text\"]').value;\n    const summary = this.findInput('input[name=\"summary\"]').value.trim();\n    const description = this.node.querySelector('textarea')!.value;\n    this.column.setMetaData({ label, description, summary });\n    return true;\n  }\n\n  protected cancel() {\n    this.column.setMetaData(this.before);\n  }\n}\n","import { ScriptColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class ScriptEditDialog extends ADialog {\n  private readonly before: string;\n\n  constructor(private readonly column: ScriptColumn, dialog: IDialogContext) {\n    super(dialog);\n    this.before = column.getScript();\n  }\n\n  protected build(node: HTMLElement) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<textarea class=\"${cssClass(\n        'textarea'\n      )}\" autofocus=\"true\" rows=\"5\" autofocus=\"autofocus\" style=\"width: 95%;\">${this.column.getScript()}</textarea>`\n    );\n  }\n\n  protected cancel() {\n    this.column.setScript(this.before);\n  }\n\n  protected reset() {\n    this.node.querySelector('textarea')!.value = (this.column.desc as any).script || ScriptColumn.DEFAULT_SCRIPT;\n  }\n\n  protected submit() {\n    this.column.setScript(this.node.querySelector('textarea')!.value);\n    return true;\n  }\n}\n","import type { Column } from '../../model';\nimport type { IDataProvider } from '../../provider';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport { debounce } from '../../internal';\n\n/** @internal */\nexport default class SearchDialog extends ADialog {\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly provider: IDataProvider) {\n    super(dialog, {\n      livePreview: 'search',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<input type=\"text\" size=\"20\" value=\"\" required autofocus placeholder=\"search... (>= 3 chars)\">\n      <label class=\"${cssClass('checkbox')}\">\n        <input type=\"checkbox\">\n        <span>Use regular expressions</span>\n      </label>\n    `\n    );\n\n    const input = node.querySelector<HTMLInputElement>('input[type=\"text\"]')!;\n    const checkbox = node.querySelector<HTMLInputElement>('input[type=\"checkbox\"]')!;\n    const update = () => {\n      const search: any = input.value;\n      if (search.length < 3) {\n        input.setCustomValidity('at least 3 characters');\n        return;\n      }\n      input.setCustomValidity('');\n    };\n    input.addEventListener('input', update, {\n      passive: true,\n    });\n    checkbox.addEventListener('change', update, {\n      passive: true,\n    });\n    this.enableLivePreviews([input, checkbox]);\n\n    if (!this.showLivePreviews()) {\n      return;\n    }\n    input.addEventListener(\n      'input',\n      debounce(() => this.submit(), 100),\n      {\n        passive: true,\n      }\n    );\n  }\n\n  protected submit() {\n    const input = this.findInput('input[type=\"text\"]')!;\n    const checkbox = this.findInput('input[type=\"checkbox\"]')!;\n\n    let search: any = input.value;\n    const isRegex = checkbox.checked;\n    if (isRegex) {\n      search = new RegExp(search);\n    }\n    this.provider.searchAndJump(search, this.column);\n    return true;\n  }\n\n  protected reset() {\n    const input = this.findInput('input[type=\"text\"]')!;\n    const checkbox = this.findInput('input[type=\"checkbox\"]')!;\n    input.value = '';\n    checkbox.checked = false;\n  }\n\n  protected cancel() {\n    // nothing to do\n  }\n}\n","import ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport type { IDataProvider } from '../../provider';\n\n/** @internal */\nexport default class ShowTopNDialog extends ADialog {\n  private readonly before: number;\n\n  constructor(private readonly provider: IDataProvider, dialog: IDialogContext) {\n    super(dialog);\n\n    this.before = this.provider.getShowTopN();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-rename'));\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <input type=\"number\" min=\"0\" step=\"1\" value=\"${this.before}\">`\n    );\n\n    this.enableLivePreviews('input');\n  }\n\n  protected cancel() {\n    this.provider.setShowTopN(this.before);\n  }\n\n  protected submit() {\n    const value = this.findInput('input').valueAsNumber;\n    this.provider.setShowTopN(value);\n    return true;\n  }\n\n  protected reset() {\n    const defaultValue = 10;\n    this.findInput('input').value = defaultValue.toString();\n  }\n}\n","import type { Column } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { uniqueId, forEach } from './utils';\nimport { getToolbarDialogAddons } from '../toolbarResolvers';\nimport type { IRankingHeaderContext, IToolbarDialogAddonHandler } from '../interfaces';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class SortDialog extends ADialog {\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\n\n  constructor(\n    private readonly column: Column,\n    private readonly groupSortBy: boolean,\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext\n  ) {\n    super(dialog, {\n      livePreview: groupSortBy ? 'groupSort' : 'sort',\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const addons = getToolbarDialogAddons(this.column, this.groupSortBy ? 'sortGroup' : 'sort', this.ctx);\n    for (const addon of addons) {\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\n      this.handlers.push(addon.append(this.column, this.node, this.dialog, this.ctx));\n    }\n\n    this.handlers.push(sortOrder(node, this.column, this.dialog.idPrefix, this.groupSortBy));\n\n    for (const handler of this.handlers) {\n      this.enableLivePreviews(handler.elems);\n    }\n  }\n\n  protected submit() {\n    for (const handler of this.handlers) {\n      if (handler.submit() === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  protected cancel() {\n    for (const handler of this.handlers) {\n      handler.cancel();\n    }\n  }\n\n  protected reset() {\n    for (const handler of this.handlers) {\n      handler.reset();\n    }\n  }\n}\n\nfunction sortOrder(\n  node: HTMLElement,\n  column: Column,\n  idPrefix: string,\n  groupSortBy = false\n): IToolbarDialogAddonHandler {\n  const ranking = column.findMyRanker()!;\n  const current = groupSortBy ? ranking.getGroupSortCriteria() : ranking.getSortCriteria();\n  const order = Object.assign({}, groupSortBy ? column.isGroupSortedByMe() : column.isSortedByMe());\n\n  const priority = order.priority === undefined ? current.length : order.priority;\n\n  const id = uniqueId(idPrefix);\n  node.insertAdjacentHTML(\n    'afterbegin',\n    `\n        <strong>Sort Order</strong>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"asc\"  ${\n      order.asc === 'asc' ? 'checked' : ''\n    } ><span>Ascending</span></label>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"desc\"  ${\n      order.asc === 'desc' ? 'checked' : ''\n    } ><span>Descending</span></label>\n        <label class=\"${cssClass('checkbox')}\"><input type=\"radio\" name=\"sortorder\" value=\"none\"  ${\n      order.asc === undefined ? 'checked' : ''\n    } ><span>Unsorted</span></label>\n        <strong>Sort Priority</strong>\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${priority + 1}\">\n    `\n  );\n\n  const updateDisabled = (disable: boolean) => {\n    forEach(\n      node,\n      'input:not([name=sortorder]), select, textarea',\n      (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\n        d.disabled = disable;\n      }\n    );\n  };\n  updateDisabled(order.asc === undefined);\n\n  forEach(node, 'input[name=sortorder]', (n: HTMLInputElement) => {\n    n.addEventListener(\n      'change',\n      () => {\n        updateDisabled(n.value === 'none');\n      },\n      {\n        passive: true,\n      }\n    );\n  });\n\n  return {\n    elems: `input[name=sortorder], #${id}P`,\n    submit() {\n      const asc = node.querySelector<HTMLInputElement>('input[name=sortorder]:checked')!.value;\n      const priority = Number.parseInt(node.querySelector<HTMLInputElement>(`#${id}P`)!.value, 10) - 1;\n\n      if (groupSortBy) {\n        ranking.groupSortBy(column, asc === 'asc', asc === 'none' ? -1 : priority);\n      } else {\n        ranking.sortBy(column, asc === 'asc', asc === 'none' ? -1 : priority);\n      }\n      return true;\n    },\n    reset() {\n      node.querySelector<HTMLInputElement>('input[name=sortorder][value=none]')!.checked = true;\n      node.querySelector<HTMLInputElement>(`#${id}P`)!.value = (\n        current.length + (order.priority === undefined ? 1 : 0)\n      ).toString();\n      updateDisabled(true);\n    },\n    cancel() {\n      if (groupSortBy) {\n        ranking.groupSortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\n      } else {\n        ranking.sortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\n      }\n    },\n  };\n}\n","import type { StringColumn, IStringFilter } from '../../model';\nimport { filterMissingMarkup, findFilterMissing } from '../missing';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport { debounce } from '../../internal';\n\nfunction toInput(text: string, isRegex: boolean) {\n  const v = text.trim();\n  if (v === '') {\n    return null;\n  }\n  return isRegex ? new RegExp(v, 'm') : v;\n}\n\n/** @internal */\nexport default class StringFilterDialog extends ADialog {\n  private readonly before: IStringFilter | null;\n\n  constructor(private readonly column: StringColumn, dialog: IDialogContext) {\n    super(dialog, {\n      livePreview: 'filter',\n    });\n\n    this.before = this.column.getFilter();\n  }\n\n  private updateFilter(filter: string | RegExp | null, filterMissing: boolean) {\n    if (filter == null && !filterMissing) {\n      this.column.setFilter(null);\n    } else {\n      this.column.setFilter({ filter, filterMissing });\n    }\n  }\n\n  protected reset() {\n    this.findInput('input[type=\"text\"]').value = '';\n    this.forEach('input[type=checkbox]', (n: HTMLInputElement) => (n.checked = false));\n  }\n\n  protected cancel() {\n    if (this.before) {\n      this.updateFilter(this.before.filter === '' ? null : this.before.filter, this.before.filterMissing);\n    } else {\n      this.updateFilter(null, false);\n    }\n  }\n\n  protected submit() {\n    const filterMissing = findFilterMissing(this.node).checked;\n    const input = this.findInput('input[type=\"text\"]').value;\n    const isRegex = this.findInput('input[type=\"checkbox\"]').checked;\n    this.updateFilter(toInput(input, isRegex), filterMissing);\n    return true;\n  }\n\n  protected build(node: HTMLElement) {\n    const bak = this.column.getFilter() || { filter: '', filterMissing: false };\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<input type=\"text\" placeholder=\"Filter ${this.column.desc.label}...\" autofocus value=\"${\n        bak.filter instanceof RegExp ? bak.filter.source : bak.filter || ''\n      }\" style=\"width: 100%\">\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"checkbox\" ${bak.filter instanceof RegExp ? 'checked=\"checked\"' : ''}>\n      <span>Use regular expressions</span>\n    </label>\n    ${filterMissingMarkup(bak.filterMissing)}`\n    );\n\n    const filterMissing = findFilterMissing(node);\n    const input = node.querySelector<HTMLInputElement>('input[type=\"text\"]');\n    const isRegex = node.querySelector<HTMLInputElement>('input[type=\"checkbox\"]');\n\n    this.enableLivePreviews([filterMissing, input, isRegex]);\n\n    if (!this.showLivePreviews()) {\n      return;\n    }\n    input.addEventListener(\n      'input',\n      debounce(() => this.submit(), 100),\n      {\n        passive: true,\n      }\n    );\n  }\n}\n","import { round } from '../../internal';\nimport type { StackColumn } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { forEach, colorOf } from './utils';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class WeightsEditDialog extends ADialog {\n  private readonly weights: number[];\n\n  constructor(private readonly column: StackColumn, dialog: IDialogContext) {\n    super(dialog);\n\n    this.weights = this.column.getWeights();\n  }\n\n  protected cancel() {\n    this.column.setWeights(this.weights.slice());\n  }\n\n  protected reset() {\n    const weight = 100 / this.weights.length;\n    forEach(this.node, 'input[type=number]', (n: HTMLInputElement) => {\n      const v = round(weight, 2);\n      n.value = String(v);\n      (n.nextElementSibling!.firstElementChild! as HTMLElement).style.width = `${v}%`;\n    });\n  }\n\n  protected build(node: HTMLElement) {\n    const children = this.column.children;\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"${cssClass('dialog-table')}\">\n        ${this.weights\n          .map(\n            (weight, i) => `<div class=\"${cssClass('dialog-weights-table-entry')}\">\n          <input type=\"number\" value=\"${round(weight * 100, 2)}\" min=\"0\" max=\"100\" step=\"any\" required>\n          <span class=\"${cssClass('dialog-filter-color-bar')}\">\n            <span style=\"background-color: ${colorOf(children[i])}; width: ${round(weight * 100, 2)}%\"></span>\n          </span>\n          ${children[i].label}\n        </div>`\n          )\n          .join('')}\n    </div>`\n    );\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]'));\n    inputs.forEach((d, i) => {\n      d.oninput = () => {\n        const weight = d.valueAsNumber;\n        if (weight <= 0) {\n          d.setCustomValidity('weight cannot be zero');\n        } else {\n          d.setCustomValidity('');\n        }\n        this.updateBar(d);\n\n        if (inputs.length !== 2) {\n          return;\n        }\n\n        // corner case auto decrease the other\n        const rest = 100 - weight;\n\n        if (rest <= 0) {\n          d.setCustomValidity('weight cannot be 100 in case of two elements');\n        } else {\n          d.setCustomValidity('');\n        }\n\n        const other = inputs[1 - i]!;\n        other.value = round(rest, 2).toString();\n        this.updateBar(other);\n      };\n    });\n  }\n\n  private updateBar(input: HTMLInputElement) {\n    (input.nextElementSibling!.firstElementChild! as HTMLElement).style.width = `${input.value}%`;\n  }\n\n  private distributeWeights() {\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]')).map((d) => ({\n      input: d,\n      weight: d.value ? d.valueAsNumber : NaN,\n    }));\n    const hasMissing = inputs.some((d) => Number.isNaN(d.weight));\n    if (hasMissing) {\n      // compute missing ones\n      const missingIndices = inputs.filter((d) => Number.isNaN(d.weight));\n      const correct = inputs.filter((d) => !Number.isNaN(d.weight));\n      const sum = correct.reduce((a, b) => a + b.weight, 0);\n\n      if (sum < 100) {\n        // compute rest\n        const rest = (100 - sum) / missingIndices.length;\n        for (const input of missingIndices) {\n          input.input.value = round(rest, 2).toString();\n          this.updateBar(input.input);\n        }\n        return;\n      }\n      // already above 100, set missing to 0 and do a regular normalization (user has to deal with it)\n      for (const input of missingIndices) {\n        input.input.value = '0';\n        this.updateBar(input.input);\n      }\n    }\n\n    const weights = inputs.map((d) => d.weight);\n    if (validWeights(weights)) {\n      return; // nothing to do\n    }\n\n    // pure distribute the sum\n    const sum = weights.reduce((a, b) => a + b, 0);\n    for (const input of inputs) {\n      input.input.value = round((input.weight * 100) / sum, 2).toString();\n      this.updateBar(input.input);\n    }\n  }\n\n  protected appendDialogButtons() {\n    super.appendDialogButtons();\n    const buttons = this.node.querySelector<HTMLElement>(`.${cssClass('dialog-buttons')}`)!;\n    buttons.insertAdjacentHTML(\n      'beforeend',\n      `<button class=\"${cssClass('dialog-button')} ${cssClass(\n        'dialog-weights-distribute-button'\n      )}\" type=\"button\" title=\"distribute weights\"></button>`\n    );\n\n    const last = buttons.lastElementChild! as HTMLElement;\n    last.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.distributeWeights();\n    };\n  }\n\n  submit() {\n    const inputs = Array.from(this.node.querySelectorAll<HTMLInputElement>('input[type=number]')).map((d) => ({\n      input: d,\n      weight: d.valueAsNumber,\n    }));\n    let invalid = false;\n    for (const input of inputs) {\n      if (input.weight <= 0) {\n        input.input.setCustomValidity('weight cannot be zero');\n        invalid = true;\n      } else {\n        input.input.setCustomValidity('');\n      }\n    }\n    const weights = inputs.map((d) => d.weight);\n    if (!invalid && !validWeights(weights)) {\n      inputs[inputs.length - 1].input.setCustomValidity(\n        'sum of weights has to be 100, change weights or use the redistribute button to fix'\n      );\n      invalid = true;\n    }\n    if (invalid) {\n      if (typeof this.node.reportValidity === 'function') {\n        this.node.reportValidity();\n      }\n      return false;\n    }\n\n    this.column.setWeights(weights.map((d) => d / 100));\n    return true;\n  }\n}\n\nfunction validWeights(weights: number[]) {\n  return Math.abs(weights.reduce((a, b) => a + b, 0) - 100) < 3;\n}\n","import {\n  Column,\n  CompositeColumn,\n  EAdvancedSortMethod,\n  EDateSort,\n  ESortMethod,\n  IMultiLevelColumn,\n  isSortingAscByDefault,\n  isSupportType,\n} from '../model';\nimport { cssClass } from '../styles';\nimport ADialog, { dialogContext, IDialogContext } from './dialogs/ADialog';\nimport CategoricalColorMappingDialog from './dialogs/CategoricalColorMappingDialog';\nimport CategoricalFilterDialog from './dialogs/CategoricalFilterDialog';\nimport CategoricalMappingFilterDialog from './dialogs/CategoricalMappingFilterDialog';\nimport ChangeRendererDialog from './dialogs/ChangeRendererDialog';\nimport ColorMappingDialog from './dialogs/ColorMappingDialog';\nimport CompositeChildrenDialog from './dialogs/CompositeChildrenDialog';\nimport CutOffHierarchyDialog from './dialogs/CutOffHierarchyDialog';\nimport DateFilterDialog from './dialogs/DateFilterDialog';\nimport EditPatternDialog from './dialogs/EditPatternDialog';\nimport GroupDialog from './dialogs/GroupDialog';\nimport MappingDialog from './dialogs/MappingDialog';\nimport NumberFilterDialog from './dialogs/NumberFilterDialog';\nimport ReduceDialog from './dialogs/ReduceDialog';\nimport RenameDialog from './dialogs/RenameDialog';\nimport ScriptEditDialog from './dialogs/ScriptEditDialog';\nimport SearchDialog from './dialogs/SearchDialog';\nimport ShowTopNDialog from './dialogs/ShowTopNDialog';\nimport SortDialog from './dialogs/SortDialog';\nimport StringFilterDialog from './dialogs/StringFilterDialog';\nimport WeightsEditDialog from './dialogs/WeightsEditDialog';\nimport type {\n  IOnClickHandler,\n  IRankingHeaderContext,\n  IToolbarAction,\n  IToolbarDialogAddon,\n  IUIOptions,\n} from './interfaces';\nimport appendDate from './dialogs/groupDate';\nimport appendNumber from './dialogs/groupNumber';\nimport appendString from './dialogs/groupString';\nimport { sortMethods } from './dialogs/utils';\n\ninterface IDialogClass {\n  new (col: any, dialog: IDialogContext, ...args: any[]): ADialog;\n}\n\nfunction ui(title: string, onClick: IOnClickHandler, options: Partial<IUIOptions> = {}): IToolbarAction {\n  return { title, onClick, options };\n}\n\nfunction uiDialog(\n  title: string,\n  dialogClass: IDialogClass,\n  extraArgs: (ctx: IRankingHeaderContext) => any[] = () => [],\n  options: Partial<IUIOptions> = {}\n): IToolbarAction {\n  return {\n    title,\n    onClick: (col, evt, ctx, level) => {\n      const dialog = new dialogClass(col, dialogContext(ctx, level, evt), ...extraArgs(ctx));\n      dialog.open();\n    },\n    options,\n  };\n}\n\nconst sort: IToolbarAction = {\n  title: 'Sort', // basic ranking\n  onClick: (col, evt, ctx, level) => {\n    ctx.dialogManager.removeAboveLevel(level);\n    if (!evt.ctrlKey) {\n      col.toggleMySorting();\n      return;\n    }\n    const ranking = col.findMyRanker()!;\n    const current = ranking.getSortCriteria();\n    const order = col.isSortedByMe();\n\n    const isAscByDefault = isSortingAscByDefault(col);\n\n    if (order.priority === undefined) {\n      ranking.sortBy(col, isAscByDefault, current.length);\n      return;\n    }\n    let next: string | undefined = undefined;\n    if (isAscByDefault) {\n      next = order.asc ? 'desc' : undefined;\n    } else {\n      next = !order.asc ? 'asc' : undefined;\n    }\n    ranking.sortBy(col, next === 'asc', next ? order.priority : -1);\n  },\n  options: {\n    mode: 'shortcut',\n    order: 1,\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  },\n};\n\nconst sortBy: IToolbarAction = {\n  title: 'Sort By &hellip;', // advanced ranking\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new SortDialog(col, false, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  options: {\n    mode: 'menu',\n    order: 1,\n    featureCategory: 'ranking',\n    featureLevel: 'advanced',\n  },\n};\n\nconst sortGroupBy: IToolbarAction = {\n  title: 'Sort Groups By &hellip;', // advanced ranking\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new SortDialog(col, true, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  options: {\n    mode: 'menu',\n    order: 3,\n    featureCategory: 'ranking',\n    featureLevel: 'advanced',\n  },\n};\n\nconst rename: IToolbarAction = {\n  title: 'Rename &hellip;', // advanced\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new RenameDialog(col, dialogContext(ctx, level, evt));\n    dialog.open();\n  },\n  options: {\n    order: 5,\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  },\n};\n\nconst vis: IToolbarAction = {\n  title: 'Visualization &hellip;', // advanced view\n  onClick: (col, evt, ctx, level) => {\n    const dialog = new ChangeRendererDialog(col, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  options: {\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  },\n};\n\nconst clone: IToolbarAction = {\n  title: 'Clone', // advanced model\n  onClick: (col, _evt, ctx) => {\n    ctx.dialogManager.removeAll(); // since the column will be removed\n    ctx.provider.takeSnapshot(col);\n  },\n  options: {\n    order: 80,\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  },\n};\n\nconst remove: IToolbarAction = {\n  title: 'Remove', // advanced model\n  onClick: (col, _evt, ctx) => {\n    ctx.dialogManager.removeAll(); // since the column will be removed\n    const ranking = col.findMyRanker()!;\n    const last = ranking.children.every((d) => isSupportType(d) || d.fixed || d === col);\n    if (!last) {\n      col.removeMe();\n      return;\n    }\n    ctx.provider.removeRanking(ranking);\n    ctx.provider.ensureOneRanking();\n  },\n  options: {\n    order: 90,\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  },\n};\n\n// basic ranking\nconst group = ui(\n  'Group',\n  (col, evt, ctx, level) => {\n    ctx.dialogManager.removeAboveLevel(level);\n\n    if (!evt.ctrlKey) {\n      col.groupByMe();\n      return;\n    }\n    const ranking = col.findMyRanker()!;\n    const current = ranking.getGroupCriteria();\n    const order = current.indexOf(col);\n\n    ranking.groupBy(col, order >= 0 ? -1 : current.length);\n  },\n  { mode: 'shortcut', order: 2, featureCategory: 'ranking', featureLevel: 'basic' }\n);\n\n// advanced ranking\nconst groupBy = ui(\n  'Group By &hellip;',\n  (col, evt, ctx, level) => {\n    const dialog = new GroupDialog(col, dialogContext(ctx, level, evt), ctx);\n    dialog.open();\n  },\n  { mode: 'menu', order: 2, featureCategory: 'ranking', featureLevel: 'advanced' }\n);\n\nfunction toggleCompressExpand(col: Column, evt: MouseEvent, ctx: IRankingHeaderContext, level: number) {\n  ctx.dialogManager.removeAboveLevel(level);\n  const mcol = col as IMultiLevelColumn;\n  mcol.setCollapsed(!mcol.getCollapsed());\n\n  const collapsed = mcol.getCollapsed();\n  const i = evt.currentTarget as HTMLElement;\n  i.title = collapsed ? 'Expand' : 'Compress';\n  i.classList.toggle(cssClass('action-compress'), !collapsed);\n  i.classList.toggle(cssClass('action-expand'), collapsed);\n  const inner = i.getElementsByTagName('span')[0]!;\n  if (inner) {\n    inner.textContent = i.title;\n  }\n}\n\nconst compress: IToolbarAction = {\n  title: 'Compress',\n  enabled: (col: IMultiLevelColumn) => !col.getCollapsed(),\n  onClick: toggleCompressExpand,\n  options: { featureCategory: 'model', featureLevel: 'advanced' },\n};\n\nconst expand: IToolbarAction = {\n  title: 'Expand',\n  enabled: (col: IMultiLevelColumn) => col.getCollapsed(),\n  onClick: toggleCompressExpand,\n  options: { featureCategory: 'model', featureLevel: 'advanced' },\n};\n\nconst setShowTopN: IToolbarAction = {\n  title: 'Change Show Top N',\n  onClick: (_col, evt, ctx, level) => {\n    const dialog = new ShowTopNDialog(ctx.provider, dialogContext(ctx, level, evt));\n    dialog.open();\n  },\n  options: {\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  },\n};\n\nexport const toolbarActions: { [key: string]: IToolbarAction } = {\n  vis,\n  group,\n  groupBy,\n  compress,\n  expand,\n  sort,\n  sortBy,\n  sortGroupBy,\n  clone,\n  remove,\n  rename,\n  setShowTopN,\n  search: uiDialog('Search &hellip;', SearchDialog, (ctx) => [ctx.provider], {\n    mode: 'menu+shortcut',\n    order: 4,\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterNumber: uiDialog('Filter &hellip;', NumberFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterDate: uiDialog('Filter &hellip;', DateFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterString: uiDialog('Filter &hellip;', StringFilterDialog, () => [], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterCategorical: uiDialog('Filter &hellip;', CategoricalFilterDialog, (ctx) => [ctx], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  filterOrdinal: uiDialog('Filter &hellip;', CategoricalMappingFilterDialog, () => [], {\n    mode: 'menu+shortcut',\n    featureCategory: 'ranking',\n    featureLevel: 'basic',\n  }),\n  colorMapped: uiDialog('Color Mapping &hellip;', ColorMappingDialog, (ctx) => [ctx], {\n    mode: 'menu',\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  }),\n  colorMappedCategorical: uiDialog('Color Mapping &hellip;', CategoricalColorMappingDialog, () => [], {\n    mode: 'menu',\n    featureCategory: 'ui',\n    featureLevel: 'advanced',\n  }),\n  script: uiDialog('Edit Combine Script &hellip;', ScriptEditDialog, () => [], {\n    mode: 'menu+shortcut',\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  reduce: uiDialog('Reduce by &hellip;', ReduceDialog, () => [], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  cutoff: uiDialog('Set Cut Off &hellip;', CutOffHierarchyDialog, (ctx) => [ctx.idPrefix], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  editMapping: uiDialog('Data Mapping &hellip;', MappingDialog, (ctx) => [ctx], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  editPattern: uiDialog('Edit Pattern &hellip;', EditPatternDialog, (ctx) => [ctx.idPrefix], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  editWeights: uiDialog('Edit Weights &hellip;', WeightsEditDialog, () => [], {\n    mode: 'menu+shortcut',\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  compositeContained: uiDialog('Contained Columns &hellip;', CompositeChildrenDialog, (ctx) => [ctx], {\n    featureCategory: 'model',\n    featureLevel: 'advanced',\n  }),\n  splitCombined: ui(\n    'Split Combined Column',\n    (col, _evt, ctx, level) => {\n      ctx.dialogManager.removeAboveLevel(level - 1); // close itself\n      // split the combined column into its children\n      (col as CompositeColumn).children.reverse().forEach((c) => col.insertAfterMe(c));\n      col.removeMe();\n    },\n    { featureCategory: 'model', featureLevel: 'advanced' }\n  ),\n  invertSelection: ui(\n    'Invert Selection',\n    (col, _evt, ctx, level) => {\n      ctx.dialogManager.removeAboveLevel(level - 1); // close itself\n      const s = ctx.provider.getSelection();\n      const order = Array.from(col.findMyRanker()!.getOrder());\n      if (s.length === 0) {\n        ctx.provider.setSelection(order);\n        return;\n      }\n      const ss = new Set(s);\n      const others = order.filter((d) => !ss.has(d));\n      ctx.provider.setSelection(others);\n    },\n    { featureCategory: 'model', featureLevel: 'advanced' }\n  ),\n};\n\nfunction uiSortMethod(methods: string[]): IToolbarDialogAddon {\n  methods = methods.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));\n  return {\n    title: 'Sort By',\n    order: 2,\n    append(col, node) {\n      return sortMethods(node, col as any, methods);\n    },\n  };\n}\n\nexport const toolbarDialogAddons: { [key: string]: IToolbarDialogAddon } = {\n  sortNumber: uiSortMethod(Object.keys(EAdvancedSortMethod)),\n  sortNumbers: uiSortMethod(Object.keys(EAdvancedSortMethod)),\n  sortBoxPlot: uiSortMethod(Object.keys(ESortMethod)),\n  sortDates: uiSortMethod(Object.keys(EDateSort)),\n  sortGroups: uiSortMethod(['count', 'name']),\n  groupNumber: {\n    title: 'Split',\n    order: 2,\n    append: appendNumber,\n  } as IToolbarDialogAddon,\n  groupString: {\n    title: 'Groups',\n    order: 2,\n    append: appendString,\n  } as IToolbarDialogAddon,\n  groupDate: {\n    title: 'Granularity',\n    order: 2,\n    append: appendDate,\n  } as IToolbarDialogAddon,\n};\n","import type { NumberColumn } from '../../model';\nimport type { IDialogContext } from './ADialog';\nimport { round, getNumberOfBins } from '../../internal';\nimport { forEach } from '../../renderer/utils';\nimport { cssClass } from '../../styles';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default function groupNumber(\n  col: NumberColumn,\n  node: HTMLElement,\n  dialog: IDialogContext\n): IToolbarDialogAddonHandler {\n  const domain = col.getMapping().domain;\n  const before = col.getGroupThresholds();\n  const isThreshold = before.length <= 1;\n  const ranking = col.findMyRanker()!;\n  node.insertAdjacentHTML(\n    'beforeend',\n    `\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"threshold\" value=\"threshold\" ${isThreshold ? 'checked' : ''}>\n      <span>at&nbsp;<input type=\"number\" size=\"10\" id=\"${dialog.idPrefix}N1\" value=\"${\n      before.length > 0 ? before[0] : round((domain[1] - domain[0]) / 2, 2)\n    }\"\n          required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\" ${!isThreshold ? 'disabled' : ''}>\n      </span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"threshold\" value=\"bins\" ${!isThreshold ? 'checked' : ''}>\n      <span> in&nbsp;<input type=\"number\" size=\"5\" id=\"${dialog.idPrefix}N2\" value=\"${\n      before.length > 1 ? before.length : getNumberOfBins(ranking.getOrderLength())\n    }\"\n          required min=\"2\" step=\"1\" ${isThreshold ? 'disabled' : ''}>&nbsp;bins\n      </span>\n    </label>\n  `\n  );\n\n  const threshold = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}N1`);\n  const bins = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}N2`);\n\n  forEach(node, 'input[name=threshold]', (d: HTMLInputElement) => {\n    d.addEventListener(\n      'change',\n      () => {\n        const isThreshold = d.value === 'threshold';\n        threshold.disabled = !isThreshold;\n        bins.disabled = isThreshold;\n      },\n      { passive: true }\n    );\n  });\n\n  return {\n    elems: `input[name=threshold], #${dialog.idPrefix}N1, #${dialog.idPrefix}N2`,\n    submit() {\n      const isThreshold = node.querySelector<HTMLInputElement>('input[name=threshold]:checked')!.value === 'threshold';\n      if (isThreshold) {\n        col.setGroupThresholds([threshold.valueAsNumber]);\n        return true;\n      }\n      const count = Number.parseInt(bins.value, 10);\n      const delta = (domain[1] - domain[0]) / count;\n      let act = domain[0] + delta;\n      const thresholds = [act];\n      for (let i = 1; i < count - 1; ++i) {\n        act += delta;\n        thresholds.push(act);\n      }\n      col.setGroupThresholds(thresholds);\n      return true;\n    },\n    cancel() {\n      col.setGroupThresholds(before);\n    },\n    reset() {\n      const value = round((domain[1] - domain[0]) / 2, 2);\n      threshold.value = value.toString();\n      threshold.disabled = false;\n      bins.value = getNumberOfBins(ranking.getOrderLength()).toString();\n      bins.disabled = true;\n      node.querySelector<HTMLInputElement>('input[name=threshold][value=threshold]')!.checked = true;\n    },\n  };\n}\n","import type { IDialogContext } from './ADialog';\nimport { StringColumn, EStringGroupCriteriaType } from '../../model';\nimport { cssClass } from '../../styles';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default function groupString(\n  col: StringColumn,\n  node: HTMLElement,\n  dialog: IDialogContext\n): IToolbarDialogAddonHandler {\n  const current = col.getGroupCriteria();\n  const { type, values } = current;\n\n  node.insertAdjacentHTML(\n    'beforeend',\n    `\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.value}\" id=\"${\n      dialog.idPrefix\n    }VAL\" ${type === EStringGroupCriteriaType.value ? 'checked' : ''}>\n      <span>Use text value</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.startsWith}\" id=\"${\n      dialog.idPrefix\n    }RW\" ${type === EStringGroupCriteriaType.startsWith ? 'checked' : ''}>\n      <span>Text starts with &hellip;</span>\n    </label>\n    <label class=\"${cssClass('checkbox')}\">\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.regex}\" id=\"${\n      dialog.idPrefix\n    }RE\" ${type === EStringGroupCriteriaType.regex ? 'checked' : ''}>\n      <span>Use regular expressions</span>\n    </label>\n    <textarea rows=\"5\" placeholder=\"one value per row, e.g., \\nA\\nB\" id=\"${dialog.idPrefix}T\">${values\n      .map((value) => (value instanceof RegExp ? value.source : value))\n      .join('\\n')}</textarea>\n  `\n  );\n\n  const valueRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}VAL`)!;\n  const startsWithRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RW`)!;\n  const regexRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RE`)!;\n  const text = node.querySelector<HTMLTextAreaElement>(`#${dialog.idPrefix}T`)!;\n\n  const showOrHideTextarea = (show: boolean) => {\n    text.style.display = show ? null : 'none';\n  };\n\n  showOrHideTextarea(type !== EStringGroupCriteriaType.value);\n  valueRadioButton.onchange = () => showOrHideTextarea(!valueRadioButton.checked);\n  startsWithRadioButton.onchange = () => showOrHideTextarea(startsWithRadioButton.checked);\n  regexRadioButton.onchange = () => showOrHideTextarea(regexRadioButton.checked);\n\n  return {\n    elems: [text, valueRadioButton, startsWithRadioButton, regexRadioButton],\n    submit() {\n      const checkedNode = node.querySelector<HTMLInputElement>(`input[name=\"${dialog.idPrefix}groupString\"]:checked`)!;\n      const newType = checkedNode.value as EStringGroupCriteriaType;\n      let items: (string | RegExp)[] = text.value\n        .trim()\n        .split('\\n')\n        .map((d) => d.trim())\n        .filter((d) => d.length > 0);\n\n      if (newType === EStringGroupCriteriaType.regex) {\n        items = items.map((d) => new RegExp(d.toString(), 'm'));\n      }\n      col.setGroupCriteria({\n        type: newType,\n        values: items,\n      });\n      return true;\n    },\n    cancel() {\n      col.setGroupCriteria(current);\n    },\n    reset() {\n      text.value = '';\n      startsWithRadioButton.checked = true;\n    },\n  };\n}\n","import type { DateColumn, IDateGranularity } from '../../model';\nimport { cssClass } from '../../styles';\nimport type { IToolbarDialogAddonHandler } from '../interfaces';\nimport { defaultDateGrouper } from '../../model/internalDate';\n\n/** @internal */\nexport default function appendDate(col: DateColumn, node: HTMLElement): IToolbarDialogAddonHandler {\n  const before = col.getDateGrouper();\n\n  let html = '';\n  for (const g of [\n    'century',\n    'decade',\n    'year',\n    'month',\n    'week',\n    'day_of_week',\n    'day_of_month',\n    'day_of_year',\n    'hour',\n    'minute',\n    'second',\n  ]) {\n    html += `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"radio\" name=\"granularity\" value=\"${g}\" ${before.granularity === g ? 'checked' : ''}>\n    <span> by ${g} </span>\n  </label>`;\n  }\n  html += `<label class=\"${cssClass('checkbox')}\">\n    <input type=\"checkbox\" name=\"circular\" ${before.circular ? 'checked' : ''}>\n    <span> Circular </span>\n  </label>`;\n\n  node.insertAdjacentHTML('beforeend', html);\n  const circular = node.querySelector<HTMLInputElement>('input[name=circular]')!;\n\n  return {\n    elems: 'input[name=granularity],input[name=circular]',\n    submit() {\n      const granularity = node.querySelector<HTMLInputElement>('input[name=granularity]:checked')!\n        .value as IDateGranularity;\n      col.setDateGrouper({\n        granularity,\n        circular: circular.checked,\n      });\n      return true;\n    },\n    cancel() {\n      col.setDateGrouper(before);\n    },\n    reset() {\n      const r = defaultDateGrouper();\n      circular.checked = r.circular;\n      const g = node.querySelector<HTMLInputElement>(`input[name=granularity][value=\"${r.granularity}\"]`)!;\n      g.checked = true;\n    },\n  };\n}\n","import { renderers } from './renderer/renderers';\nimport { toolbarDialogAddons, toolbarActions } from './ui/toolbar';\nimport type { Column, Ranking, IGroupData, IGroupItem } from './model';\nimport type { IDataProvider } from './provider';\nimport type { ICellRendererFactory, ERenderMode } from './renderer';\nimport type { IToolbarAction, IToolbarDialogAddon } from './ui';\n\n/**\n * custom height implementation logic\n */\nexport interface IDynamicHeight {\n  /**\n   * default height for a row for optimized styling\n   */\n  defaultHeight: number;\n\n  /**\n   * returns the height in pixel for the given row\n   * @param {IGroupItem | IGroupData} item the item to show\n   * @returns {number} its height in pixel\n   */\n  height(item: IGroupItem | IGroupData): number;\n\n  /**\n   * returns the padding in pixel after the given row\n   * @param {IGroupItem | IGroupData | null} item item to show\n   * @returns {number} its padding in pixel\n   */\n  padding(item: IGroupItem | IGroupData | null): number;\n}\n\nexport interface ILineUpFlags {\n  /**\n   * optimization flag to disable frozen columns for optimizing rendering performance\n   * @default true\n   */\n  disableFrozenColumns: boolean;\n  /**\n   * flag whether advanced ranking features are enabled\n   * @default true\n   */\n  advancedRankingFeatures: boolean;\n  /**\n   * flag whether advanced model features are enabled\n   * @default true\n   */\n  advancedModelFeatures: boolean;\n  /**\n   * flag whether advanced UI features are enabled\n   * @default true\n   */\n  advancedUIFeatures: boolean;\n}\n\nexport interface IToolbarLookup<T> {\n  [key: string]: T;\n}\n\nexport interface ILivePreviewOptions {\n  search: boolean;\n  filter: boolean;\n  vis: boolean;\n  sort: boolean;\n  group: boolean;\n  groupSort: boolean;\n  colorMapping: boolean;\n  dataMapping: boolean;\n  reduce: boolean;\n  rename: boolean;\n  cutOff: boolean;\n}\n\nexport interface ILineUpOptions {\n  /**\n   * option to enable/disable showing a summary (histogram, ...) in the header\n   * @default true\n   */\n  summaryHeader: boolean;\n  /**\n   * option to enable/disable animated transitions\n   * @default true\n   */\n  animated: boolean;\n  /**\n   * option to enforce that the whole row is shown upon hover without overflow hidden\n   * @default false\n   */\n  expandLineOnHover: boolean;\n  /**\n   * option to enable/disable the panel\n   * @default true\n   */\n  sidePanel: boolean;\n  /**\n   * option to specify whether the panel should be collapsed by default\n   * @default false\n   */\n  sidePanelCollapsed: boolean;\n  /**\n   * show the sorting and grouping hierarchy indicators in the side panel\n   * @default true\n   */\n  hierarchyIndicator: boolean;\n\n  /**\n   * flag whether dialogs should confirm or cancel on clicking the background\n   * @default cancel\n   */\n  onDialogBackgroundClick: 'cancel' | 'confirm';\n\n  /**\n   * flag whether to shows filter previews as soon as the user changes the filter in the dialog\n   * @default {search: true,filter: true, vis: true,sort: true, group: true, groupSort: true, colorMapping: true}\n   */\n  livePreviews: Partial<ILivePreviewOptions>;\n\n  /**\n   * option to specify the default slope graph mode\n   * @default 'item'\n   */\n  defaultSlopeGraphMode: 'item' | 'band';\n\n  /**\n   * how many degrees should a label be rotated in case of narrow columns\n   * @default 0 no rotation\n   */\n  labelRotation: number;\n\n  /**\n   * height of a row\n   * @default 18\n   */\n  rowHeight: number;\n  /**\n   * padding between two rows\n   * @default 2\n   */\n  rowPadding: number;\n  /**\n   * height of an aggregated group in pixel\n   * @default 40\n   */\n  groupHeight: number;\n  /**\n   * padding between two groups in pixel\n   * @default 5\n   */\n  groupPadding: number;\n\n  /**\n   * custom function to compute the level of detail for a row\n   * @param {number} rowIndex the current row index to be rendered\n   * @returns {\"high\" | \"low\"}\n   */\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\n  /**\n   * custom function to compute the height of a row (group or item)\n   * @param {(IGroupItem | IGroupData)[]} data the data to render\n   * @param {Ranking} ranking the ranking of the data\n   * @returns {IDynamicHeight | null} the height compute function or null to use the default\n   */\n  dynamicHeight: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => IDynamicHeight | null;\n  /**\n   * custom function to be called when updating a HTML row\n   * @param {HTMLElement} row node element to be updated\n   * @param {number} rowIndex row index to be rendered in the row\n   */\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\n\n  /**\n   * register custom toolbar actions and dialog addons\n   */\n  toolbarActions: IToolbarLookup<IToolbarAction>;\n  toolbarDialogAddons: IToolbarLookup<IToolbarDialogAddon>;\n\n  /**\n   * hook for postprocess the toolbar actions for a column\n   */\n  resolveToolbarActions: (col: Column, keys: string[], lookup: IToolbarLookup<IToolbarAction>) => IToolbarAction[];\n  /**\n   * hook for postprocess the toolbar dialog addons for a column\n   */\n  resolveToolbarDialogAddons: (\n    col: Column,\n    keys: string[],\n    lookup: IToolbarLookup<IToolbarDialogAddon>\n  ) => IToolbarDialogAddon[];\n\n  /**\n   * register custom renderer factories\n   */\n  renderers: { [type: string]: ICellRendererFactory };\n\n  /**\n   * custom check whether a given renderer can render the given column in the given mode\n   */\n  canRender: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean;\n\n  /**\n   * custom flags for optimization\n   */\n  flags: Partial<ILineUpFlags>;\n\n  /**\n   * ignore incompatible browser and always show (on own risk)\n   * @default false\n   */\n  ignoreUnsupportedBrowser: boolean;\n}\n\nexport interface ITaggleOptions extends ILineUpOptions {\n  /**\n   * whether the overview mode is enabled by default\n   * @default false\n   */\n  overviewMode: boolean;\n}\n\nexport interface ILineUpLike {\n  readonly node: HTMLElement;\n  readonly data: IDataProvider;\n\n  dump(): any;\n\n  destroy(): void;\n}\n\nfunction resolveToolbarActions(col: Column, keys: string[], lookup: IToolbarLookup<IToolbarAction>) {\n  const actions: IToolbarAction[] = [];\n\n  keys.forEach((key) => {\n    if (lookup.hasOwnProperty(key)) {\n      actions.push(lookup[key]);\n    } else {\n      console.warn(`cannot find toolbar action of type: \"${col.desc.type}\" with key \"${key}\"`);\n    }\n  });\n  return actions;\n}\n\nfunction resolveToolbarDialogAddons(col: Column, keys: string[], lookup: IToolbarLookup<IToolbarDialogAddon>) {\n  const actions: IToolbarDialogAddon[] = [];\n\n  keys.forEach((key) => {\n    if (lookup.hasOwnProperty(key)) {\n      actions.push(lookup[key]);\n    } else {\n      console.warn(`cannot find toolbar dialog addon of type: \"${col.desc.type}\" with key \"${key}\"`);\n    }\n  });\n  return actions;\n}\n\nexport function defaultOptions(): ITaggleOptions {\n  return {\n    toolbarActions,\n    toolbarDialogAddons,\n    resolveToolbarActions,\n    resolveToolbarDialogAddons,\n    renderers: Object.assign({}, renderers),\n    canRender: () => true,\n\n    labelRotation: 0,\n    summaryHeader: true,\n    animated: true,\n    expandLineOnHover: false,\n    sidePanel: true,\n    sidePanelCollapsed: false,\n    hierarchyIndicator: true,\n    defaultSlopeGraphMode: 'item',\n    overviewMode: false,\n\n    livePreviews: {\n      search: true,\n      filter: true,\n      vis: true,\n      sort: true,\n      group: true,\n      groupSort: true,\n      colorMapping: true,\n    },\n    onDialogBackgroundClick: 'cancel',\n\n    rowHeight: 18,\n    groupHeight: 40,\n    groupPadding: 5,\n    rowPadding: 2,\n\n    levelOfDetail: () => 'high',\n    customRowUpdate: () => undefined,\n    dynamicHeight: () => null,\n\n    flags: {\n      disableFrozenColumns: true, //disable by default for speed navigator.userAgent.includes('Firefox/52') // disable by default in Firefox ESR 52\n      advancedRankingFeatures: true,\n      advancedModelFeatures: true,\n      advancedUIFeatures: true,\n    },\n\n    ignoreUnsupportedBrowser: false,\n  };\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.type = 'browser';\n    }\n    return BrowserInfo;\n}());\nexport { BrowserInfo };\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.type = 'node';\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nexport { NodeInfo };\nvar SearchBotDeviceInfo = /** @class */ (function () {\n    function SearchBotDeviceInfo(name, version, os, bot) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.bot = bot;\n        this.type = 'bot-device';\n    }\n    return SearchBotDeviceInfo;\n}());\nexport { SearchBotDeviceInfo };\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.type = 'bot';\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nexport { BotInfo };\nvar ReactNativeInfo = /** @class */ (function () {\n    function ReactNativeInfo() {\n        this.type = 'react-native';\n        this.name = 'react-native';\n        this.version = null;\n        this.os = null;\n    }\n    return ReactNativeInfo;\n}());\nexport { ReactNativeInfo };\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['edge-ios', /EdgiOS\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /EdgA?\\/([0-9\\.]+)/],\n    [\n        'chromium-webview',\n        /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    ],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FBAV\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n];\nexport function detect(userAgent) {\n    if (!!userAgent) {\n        return parseUserAgent(userAgent);\n    }\n    if (typeof document === 'undefined' &&\n        typeof navigator !== 'undefined' &&\n        navigator.product === 'ReactNative') {\n        return new ReactNativeInfo();\n    }\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    return (ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false));\n}\nexport function browserName(ua) {\n    var data = matchUserAgent(ua);\n    return data ? data[0] : null;\n}\nexport function parseUserAgent(ua) {\n    var matchedRule = matchUserAgent(ua);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    var versionParts = match[1] && match[1].split(/[._]/).slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = __spreadArrays(versionParts, createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length));\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    var version = versionParts.join('.');\n    var os = detectOS(ua);\n    var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n    if (searchBotMatch && searchBotMatch[1]) {\n        return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n    }\n    return new BrowserInfo(name, version, os);\n}\nexport function detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.exec(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nexport function getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n","import { detect } from 'detect-browser';\n\nexport const SUPPORTED_FIREFOX_VERSION = 57;\nexport const SUPPORTED_CHROME_VERSION = 64;\nexport const SUPPORTED_EDGE_VERSION = 16;\n\n/**\n * @internal\n */\nexport function getUnsupportedBrowserError() {\n  const info = detect();\n  if (!info || !info.version) {\n    return 'browser cannot be detected';\n  }\n  const prefix = `unsupported browser detected:`;\n  switch (info.name) {\n    case 'firefox':\n      const fVersion = Number.parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\n      if (fVersion <= SUPPORTED_FIREFOX_VERSION && fVersion !== 52) {\n        // ESR\n        return `${prefix} Firefox ${info.version} (&lt; ${SUPPORTED_FIREFOX_VERSION})`;\n      }\n      return null;\n    case 'edge':\n      const eVersion = Number.parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\n      if (eVersion <= SUPPORTED_EDGE_VERSION) {\n        return `${prefix} Edge ${info.version} (&lt; ${SUPPORTED_EDGE_VERSION})`;\n      }\n      return null;\n    case 'chrome':\n      const cVersion = Number.parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\n      if (cVersion <= SUPPORTED_CHROME_VERSION) {\n        return `${prefix} Chrome ${info.version} (&lt; ${SUPPORTED_CHROME_VERSION})`;\n      }\n      return null;\n    case 'ie':\n      return `${prefix} Internet Explorer`;\n  }\n  console.warn('unknown browser detected', info, 'assuming fine...');\n  return null;\n}\n/**\n * checks whether the current browser is compatible with lineupjs\n * @return boolean\n */\nexport function isBrowserSupported() {\n  return getUnsupportedBrowserError() == null;\n}\n","import type ADialog from './ADialog';\nimport type Column from '../../model';\nimport { cssClass } from '../../styles';\nimport type { ILivePreviewOptions } from '../../config';\nimport { AEventDispatcher, IEventListener } from '../../internal';\n\n/**\n * emitted a dialog is opened\n * @asMemberOf DialogManager\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpened(dialog: ADialog): void;\n\n/**\n * emitted a dialog is closed\n * @asMemberOf DialogManager\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport default class DialogManager extends AEventDispatcher {\n  static readonly EVENT_DIALOG_OPENED = 'dialogOpened';\n  static readonly EVENT_DIALOG_CLOSED = 'dialogClosed';\n\n  private readonly escKeyListener = (evt: KeyboardEvent) => {\n    if (evt.which === 27) {\n      this.removeLast();\n    }\n  };\n\n  private readonly openDialogs: ADialog[] = [];\n  readonly node: HTMLElement;\n  readonly livePreviews: Partial<ILivePreviewOptions>;\n  readonly onDialogBackgroundClick: 'cancel' | 'confirm';\n\n  constructor(options: {\n    doc: Document;\n    livePreviews: Partial<ILivePreviewOptions>;\n    onDialogBackgroundClick: 'cancel' | 'confirm';\n  }) {\n    super();\n    const doc = options.doc;\n    this.livePreviews = options.livePreviews;\n    this.onDialogBackgroundClick = options.onDialogBackgroundClick;\n    this.node = doc.createElement('div');\n    this.node.classList.add(cssClass('backdrop'));\n    this.node.innerHTML = `<div class=\"${cssClass('backdrop-bg')}\"></div>`;\n    this.node.onclick = () => {\n      this.removeAll();\n    };\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([DialogManager.EVENT_DIALOG_CLOSED, DialogManager.EVENT_DIALOG_OPENED]);\n  }\n\n  on(type: typeof DialogManager.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\n  on(type: typeof DialogManager.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  get maxLevel() {\n    return this.openDialogs.reduce((acc, a) => Math.max(acc, a.level), 0);\n  }\n\n  setHighlight(mask: { left: number; top: number; width: number; height: number }) {\n    const area = this.node.firstElementChild as HTMLElement;\n    // @see http://bennettfeely.com/clippy/ -> select `Frame` example\n    // use webkit prefix for safari\n    area.style.clipPath = (area.style as any).webkitClipPath = `polygon(\n      0% 0%,\n      0% 100%,\n      ${mask.left}px 100%,\n      ${mask.left}px ${mask.top}px,\n      ${mask.left + mask.width}px ${mask.top}px,\n      ${mask.left + mask.width}px ${mask.top + mask.height}px,\n      ${mask.left}px ${mask.top + mask.height}px,\n      ${mask.left}px 100%,\n      100% 100%,\n      100% 0%\n    )`;\n  }\n\n  setHighlightColumn(column: Column) {\n    const root = this.node.parentElement!;\n    if (!root) {\n      this.clearHighlight();\n      return;\n    }\n    const header = root.querySelector<HTMLElement>(`.${cssClass('header')}[data-col-id=\"${column.id}\"]`);\n    if (!header) {\n      this.clearHighlight();\n      return;\n    }\n    const base = header.getBoundingClientRect();\n    const offset = root.getBoundingClientRect();\n    this.setHighlight({\n      left: base.left - offset.left,\n      top: base.top - offset.top,\n      width: base.width,\n      height: offset.height,\n    });\n  }\n\n  clearHighlight() {\n    const area = this.node.firstElementChild as HTMLElement;\n    area.style.clipPath = null;\n  }\n\n  private removeLast() {\n    if (this.openDialogs.length === 0) {\n      return;\n    }\n    this.remove(this.openDialogs[this.openDialogs.length - 1]);\n  }\n\n  removeAll() {\n    if (this.openDialogs.length === 0) {\n      return;\n    }\n    const all = this.openDialogs.splice(0, this.openDialogs.length);\n    all.reverse().forEach((d) => d.cleanUp(this.onDialogBackgroundClick));\n    this.takeDown();\n  }\n\n  triggerDialogClosed(dialog: ADialog, action: 'cancel' | 'confirm') {\n    this.fire(DialogManager.EVENT_DIALOG_CLOSED, dialog, action);\n  }\n\n  remove(dialog: ADialog, handled = false) {\n    const index = this.openDialogs.indexOf(dialog);\n    if (index < 0) {\n      return false;\n    }\n    // destroy self and all levels below that = after that\n    const destroyed = this.openDialogs.splice(index, this.openDialogs.length - index);\n    destroyed.reverse().forEach((d) => d.cleanUp(handled ? 'handled' : this.onDialogBackgroundClick));\n    while (handled && this.openDialogs.length > 0 && this.openDialogs[this.openDialogs.length - 1].autoClose) {\n      const dialog = this.openDialogs.pop()!;\n      dialog.cleanUp(this.onDialogBackgroundClick);\n    }\n\n    if (this.openDialogs.length === 0) {\n      this.takeDown();\n    }\n    return true;\n  }\n\n  removeAboveLevel(level: number) {\n    // hide all dialogs which have a higher or equal level to the newly opened one\n    this.openDialogs\n      .filter((d) => d.level >= level)\n      .reverse()\n      .forEach((d) => this.remove(d));\n  }\n\n  removeLike(dialog: ADialog) {\n    const similar = this.openDialogs.find((d) => dialog.equals(d));\n    if (!similar) {\n      return false;\n    }\n    this.remove(similar);\n    return true;\n  }\n\n  private setUp() {\n    this.node.ownerDocument!.addEventListener('keyup', this.escKeyListener, {\n      passive: true,\n    });\n    this.node.style.display = 'block';\n  }\n\n  private takeDown() {\n    this.clearHighlight();\n    this.node.ownerDocument!.removeEventListener('keyup', this.escKeyListener);\n    this.node.style.display = null;\n  }\n\n  push(dialog: ADialog) {\n    this.removeAboveLevel(dialog.level);\n\n    if (this.openDialogs.length === 0) {\n      this.setUp();\n    }\n\n    this.openDialogs.push(dialog);\n    this.fire(DialogManager.EVENT_DIALOG_OPENED, dialog);\n  }\n}\n","export { default as KeyFinder } from './KeyFinder';\r\n/**\r\n * different row animation modes\r\n */\r\nexport var EAnimationMode;\r\n(function (EAnimationMode) {\r\n    /**\r\n     * plain update existed both before and after\r\n     */\r\n    EAnimationMode[EAnimationMode[\"UPDATE\"] = 0] = \"UPDATE\";\r\n    /**\r\n     * exists both before and after but wasn't visible yet thus was created\r\n     */\r\n    EAnimationMode[EAnimationMode[\"UPDATE_CREATE\"] = 1] = \"UPDATE_CREATE\";\r\n    /**\r\n     * exists both before and after is visible but not needed anymore and thus removed\r\n     */\r\n    EAnimationMode[EAnimationMode[\"UPDATE_REMOVE\"] = 2] = \"UPDATE_REMOVE\";\r\n    /**\r\n     * row appears\r\n     */\r\n    EAnimationMode[EAnimationMode[\"SHOW\"] = 3] = \"SHOW\";\r\n    /**\r\n     * row disappears\r\n     */\r\n    EAnimationMode[EAnimationMode[\"HIDE\"] = 4] = \"HIDE\";\r\n})(EAnimationMode || (EAnimationMode = {}));\r\nvar NO_CHANGE_DELTA = 1;\r\nexport function noAnimationChange(_a, previousHeight, currentHeight) {\r\n    var previous = _a.previous, mode = _a.mode, nodeY = _a.nodeY, current = _a.current;\r\n    // sounds like the same\r\n    var prev = previous.height == null ? previousHeight : previous.height;\r\n    var curr = current.height == null ? currentHeight : current.height;\r\n    return (mode === EAnimationMode.UPDATE &&\r\n        Math.abs(previous.y - nodeY) <= NO_CHANGE_DELTA &&\r\n        Math.abs(prev - curr) <= NO_CHANGE_DELTA);\r\n}\r\n/**\r\n * maximal duration of all animations + extra waiting before e.g. rows are really removed\r\n * @type {number}\r\n */\r\nvar MAX_ANIMATION_TIME = 1100;\r\nexport var defaultPhases = [\r\n    {\r\n        delay: 0,\r\n        apply: function (_a) {\r\n            var mode = _a.mode, previous = _a.previous, nodeY = _a.nodeY, current = _a.current, node = _a.node;\r\n            var actNode = node;\r\n            actNode.dataset.animation = EAnimationMode[mode].toLowerCase();\r\n            actNode.style.transform = \"translate(0, \" + (previous.y - nodeY) + \"px)\";\r\n            if (mode === EAnimationMode.SHOW) {\r\n                // already target height\r\n                actNode.style.height = current.height !== null ? current.height + \"px\" : null;\r\n            }\r\n            else {\r\n                // always set previous height for default height changes\r\n                actNode.style.height = previous.height + \"px\";\r\n            }\r\n            if (mode === EAnimationMode.SHOW) {\r\n                actNode.style.opacity = '0';\r\n            }\r\n            else if (mode === EAnimationMode.HIDE) {\r\n                actNode.style.opacity = '1';\r\n            }\r\n            else {\r\n                actNode.style.opacity = null;\r\n            }\r\n        },\r\n    },\r\n    {\r\n        delay: 10,\r\n        apply: function (_a) {\r\n            var mode = _a.mode, current = _a.current, nodeY = _a.nodeY, node = _a.node;\r\n            var actNode = node;\r\n            // null for added/update since already at the right position\r\n            actNode.style.transform =\r\n                mode === EAnimationMode.HIDE || mode === EAnimationMode.UPDATE_REMOVE\r\n                    ? \"translate(0, \" + (current.y - nodeY) + \"px)\"\r\n                    : '';\r\n            if (mode !== EAnimationMode.HIDE) {\r\n                // keep height for removal\r\n                actNode.style.height = current.height !== null ? current.height + \"px\" : null;\r\n            }\r\n            if (mode === EAnimationMode.SHOW) {\r\n                actNode.style.opacity = '1';\r\n            }\r\n            else if (mode === EAnimationMode.HIDE) {\r\n                actNode.style.opacity = '0';\r\n            }\r\n            else {\r\n                actNode.style.opacity = null;\r\n            }\r\n        },\r\n    },\r\n    {\r\n        delay: MAX_ANIMATION_TIME,\r\n        apply: function (_a) {\r\n            var node = _a.node;\r\n            var actNode = node;\r\n            delete actNode.dataset.animation;\r\n            actNode.style.opacity = null;\r\n            actNode.style.transform = '';\r\n        },\r\n    },\r\n];\r\n//# sourceMappingURL=index.js.map","import {\n  getUnsupportedBrowserError,\n  SUPPORTED_CHROME_VERSION,\n  SUPPORTED_EDGE_VERSION,\n  SUPPORTED_FIREFOX_VERSION,\n} from '../browser';\nimport type { ILineUpLike } from '../config';\nimport { AEventDispatcher, IEventListener, clear } from '../internal';\nimport type { Column } from '../model';\nimport { DataProvider, IDataProviderDump } from '../provider';\nimport { cssClass } from '../styles';\nimport DialogManager from './dialogs/DialogManager';\nimport type { ADialog } from './dialogs';\n\n/**\n * emitted when the highlight changes\n * @asMemberOf ALineUp\n * @param dataIndex the highlighted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n\n/**\n * emitted when the selection changes\n * @asMemberOf ALineUp\n * @param dataIndices the selected data indices\n * @event\n */\nexport declare function selectionChanged(dataIndices: number[]): void;\n/**\n * emitted a dialog is opened\n * @asMemberOf ALineUp\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpened(dialog: ADialog): void;\n/**\n * emitted a dialog is closed\n * @asMemberOf ALineUp\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport abstract class ALineUp extends AEventDispatcher implements ILineUpLike {\n  static readonly EVENT_SELECTION_CHANGED = DataProvider.EVENT_SELECTION_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = DialogManager.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = DialogManager.EVENT_DIALOG_CLOSED;\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\n\n  private highlightListeners = 0;\n\n  readonly isBrowserSupported: boolean;\n\n  constructor(public readonly node: HTMLElement, private _data: DataProvider, ignoreIncompatibleBrowser: boolean) {\n    super();\n\n    const error = getUnsupportedBrowserError();\n    this.isBrowserSupported = ignoreIncompatibleBrowser || !error;\n\n    if (!this.isBrowserSupported) {\n      this.node.classList.add(cssClass('unsupported-browser'));\n      this.node.innerHTML = `<span>${error}</span>\n      <div class=\"${cssClass('unsupported-browser')}\">\n        <a href=\"https://www.mozilla.org/en-US/firefox/\" rel=\"noopener\" target=\"_blank\" data-browser=\"firefox\" data-version=\"${SUPPORTED_FIREFOX_VERSION}\"></a>\n        <a href=\"https://www.google.com/chrome/index.html\" rel=\"noopener\" target=\"_blank\" data-browser=\"chrome\" data-version=\"${SUPPORTED_CHROME_VERSION}\" title=\"best support\"></a>\n        <a href=\"https://www.microsoft.com/en-us/windows/microsoft-edge\" rel=\"noopener\" target=\"_blank\" data-browser=\"edge\" data-version=\"${SUPPORTED_EDGE_VERSION}\"></a>\n      </div><span>use the <code>ignoreUnsupportedBrowser=true</code> option to ignore this error at your own risk</span>`;\n    }\n\n    this.forward(_data, `${DataProvider.EVENT_SELECTION_CHANGED}.main`);\n    _data.on(`${DataProvider.EVENT_BUSY}.busy`, (busy) => this.node.classList.toggle(cssClass('busy'), busy));\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        ALineUp.EVENT_HIGHLIGHT_CHANGED,\n        ALineUp.EVENT_SELECTION_CHANGED,\n        ALineUp.EVENT_DIALOG_OPENED,\n        ALineUp.EVENT_DIALOG_CLOSED,\n      ]);\n  }\n\n  on(type: typeof ALineUp.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: typeof ALineUp.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\n  on(type: typeof ALineUp.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\n  on(type: typeof ALineUp.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  get data() {\n    return this._data;\n  }\n\n  destroy() {\n    // just clear since we hand in the node itself\n    clear(this.node);\n    this._data.destroy();\n  }\n\n  dump() {\n    return this.data.dump();\n  }\n\n  restore(dump: IDataProviderDump) {\n    this._data.restore(dump);\n  }\n\n  abstract update(): void;\n\n  setDataProvider(data: DataProvider, dump?: IDataProviderDump) {\n    if (this._data) {\n      this.unforward(this._data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\n      this._data.on(`${DataProvider.EVENT_BUSY}.busy`, null);\n    }\n    this._data = data;\n    if (dump) {\n      data.restore(dump);\n    }\n    this.forward(data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\n\n    data.on(`${DataProvider.EVENT_BUSY}.busy`, (busy) => this.node.classList.toggle(cssClass('busy'), busy));\n  }\n\n  getSelection() {\n    return this._data.getSelection();\n  }\n\n  setSelection(dataIndices: number[]) {\n    this._data.setSelection(dataIndices);\n  }\n\n  /**\n   * sorts LineUp by he given column\n   * @param column callback function finding the column to sort\n   * @param ascending\n   * @returns {boolean}\n   */\n  sortBy(column: string | ((col: Column) => boolean), ascending = false) {\n    const col = this.data.find(column);\n    if (col) {\n      col.sortByMe(ascending);\n    }\n    return col != null;\n  }\n\n  abstract setHighlight(dataIndex: number, scrollIntoView: boolean): boolean;\n\n  abstract getHighlight(): number;\n\n  protected listenersChanged(type: string, enabled: boolean) {\n    super.listenersChanged(type, enabled);\n    if (!type.startsWith(ALineUp.EVENT_HIGHLIGHT_CHANGED)) {\n      return;\n    }\n    if (enabled) {\n      this.highlightListeners++;\n      if (this.highlightListeners === 1) {\n        // first\n        this.enableHighlightListening(true);\n      }\n    } else {\n      this.highlightListeners -= 1;\n      if (this.highlightListeners === 0) {\n        // last\n        this.enableHighlightListening(false);\n      }\n    }\n  }\n\n  protected enableHighlightListening(_enable: boolean) {\n    // hook\n  }\n}\n\nexport default ALineUp;\n","/**\r\n * utility class for optimized row context access\r\n */\r\nvar KeyFinder = /** @class */ (function () {\r\n    /**\r\n     * constructor for fast key based row access\r\n     * @param {IExceptionContext} context context to use\r\n     * @param {(rowIndex: number) => string} key key function\r\n     */\r\n    function KeyFinder(context, key) {\r\n        var _this = this;\r\n        this.context = context;\r\n        this.key = key;\r\n        this.cache = [];\r\n        this.lastFilled = 0;\r\n        this.key2index = new Map();\r\n        this.context.exceptions.forEach(function (e) {\r\n            _this.cache[e.index] = e.y;\r\n            _this.key2index.set(key(e.index), e.index);\r\n        });\r\n    }\r\n    KeyFinder.prototype.findValidStart = function (before) {\r\n        for (var i = before - 1; i >= 0; i -= 1) {\r\n            if (this.cache[i] !== undefined) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n    /**\r\n     * returns the position of the given given or -1 if not found\r\n     * @param {string} key\r\n     */\r\n    KeyFinder.prototype.posByKey = function (key) {\r\n        var index = this.key2index.get(key);\r\n        if (index != null) {\r\n            return { index: index, pos: this.pos(index) };\r\n        }\r\n        return this.fillCacheTillKey(key);\r\n    };\r\n    /**\r\n     * returns the position of the given index\r\n     * @param {number} index index to look for\r\n     */\r\n    KeyFinder.prototype.pos = function (index) {\r\n        if (this.context.exceptions.length === 0) {\r\n            // fast pass\r\n            return index * this.context.defaultRowHeight;\r\n        }\r\n        var cached = this.cache[index];\r\n        if (cached !== undefined) {\r\n            return cached;\r\n        }\r\n        // need to compute it\r\n        // find the starting point where to start counting\r\n        var start = this.findValidStart(index);\r\n        if (start < 0) {\r\n            this.fillCache(0, index, 0);\r\n        }\r\n        else {\r\n            this.fillCache(start + 1, index, this.cache[start] + this.heightOf(start));\r\n        }\r\n        return this.cache[index];\r\n    };\r\n    KeyFinder.prototype.fillCache = function (first, last, offset, callback) {\r\n        if (last <= this.lastFilled) {\r\n            // everything already there\r\n            if (!callback) {\r\n                return;\r\n            }\r\n            for (var i = first; i <= last; i += 1) {\r\n                callback(i, this.key(i), this.cache[i]);\r\n            }\r\n            return;\r\n        }\r\n        var pos = offset;\r\n        for (var i = first; i <= last; i += 1) {\r\n            this.cache[i] = pos;\r\n            var key = this.key(i);\r\n            this.key2index.set(key, i);\r\n            if (callback) {\r\n                callback(i, key, pos);\r\n            }\r\n            pos += this.heightOf(i);\r\n        }\r\n    };\r\n    /**\r\n     * returns the height of the row identified by index\r\n     * @param {number} index\r\n     */\r\n    KeyFinder.prototype.heightOf = function (index) {\r\n        var _a;\r\n        var lookup = this.context.exceptionsLookup;\r\n        return (_a = lookup.get(index)) !== null && _a !== void 0 ? _a : this.context.defaultRowHeight;\r\n    };\r\n    /**\r\n     * see heightOf but ignores padding and optional null in case of default height\r\n     * @param {number} index row index\r\n     * @param {boolean} returnDefault return null if default height\r\n     * @returns {number}\r\n     */\r\n    KeyFinder.prototype.exceptionHeightOf = function (index, returnDefault) {\r\n        if (returnDefault === void 0) { returnDefault = false; }\r\n        var padding = this.context.padding(index);\r\n        var lookup = this.context.exceptionsLookup;\r\n        var entry = lookup.get(index);\r\n        if (entry != null) {\r\n            return entry - padding;\r\n        }\r\n        return returnDefault ? this.context.defaultRowHeight - padding : null;\r\n    };\r\n    /**\r\n     * padding of the given index\r\n     * @param {number} index\r\n     * @returns {number}\r\n     */\r\n    KeyFinder.prototype.padding = function (index) {\r\n        return this.context.padding(index);\r\n    };\r\n    KeyFinder.prototype.fillCacheTillKey = function (target) {\r\n        var pos = 0;\r\n        for (var i = this.lastFilled; i < this.context.numberOfRows; i += 1, this.lastFilled += 1) {\r\n            var c = this.cache[i];\r\n            if (c !== undefined) {\r\n                pos = c + this.heightOf(i);\r\n                continue;\r\n            }\r\n            // new one fill up\r\n            var key = this.key(i);\r\n            this.cache[i] = pos;\r\n            this.key2index.set(key, i);\r\n            if (key === target) {\r\n                return { index: i, pos: pos };\r\n            }\r\n            pos += this.heightOf(i);\r\n        }\r\n        return { index: -1, pos: -1 };\r\n    };\r\n    /**\r\n     * computes the positions and keys for a range of given indices\r\n     * @param {number} first first row index\r\n     * @param {number} last last row index\r\n     * @param {number} offset pos offset for the first row index\r\n     * @param {(index: number, key: string, pos: number) => void} callback callback for each identified index\r\n     */\r\n    KeyFinder.prototype.positions = function (first, last, offset, callback) {\r\n        this.fillCache(first, last, offset, callback);\r\n    };\r\n    return KeyFinder;\r\n}());\r\nexport default KeyFinder;\r\n//# sourceMappingURL=KeyFinder.js.map","export * from './scroll';\r\n/**\r\n * clear node clearing\r\n * @param node\r\n * @internal\r\n */\r\nexport function clear(node) {\r\n    while (node.lastChild) {\r\n        node.removeChild(node.lastChild);\r\n    }\r\n    return node;\r\n}\r\n//# sourceMappingURL=index.js.map","export var defaultMode = 'animation'; // Boolean((<any>window).chrome) ? 'animation' : 0, // animation frame on chrome;\r\nfunction dummy() {\r\n    return {\r\n        handler: [],\r\n        prev: null,\r\n        timer: -1,\r\n    };\r\n}\r\nvar ScrollHandler = /** @class */ (function () {\r\n    function ScrollHandler(node) {\r\n        // this.current = this.asInfo();\r\n        var _this = this;\r\n        this.node = node;\r\n        this.sync = dummy();\r\n        this.animation = dummy();\r\n        this.numbers = new Map();\r\n        this.handleAnimationImpl = function () {\r\n            if (_this.animation.timer !== 1) {\r\n                return;\r\n            }\r\n            _this.handle(_this.animation);\r\n            _this.animation.timer = -1;\r\n        };\r\n        node.addEventListener('scroll', function () {\r\n            // this.current = this.asInfo();\r\n            // if (this.prev && (Math.abs(this.current.left - this.prev.left) + Math.abs(this.current.top - this.prev.top)) < 4) {\r\n            //   return;\r\n            // }\r\n            // this.prev = this.current;\r\n            if (_this.sync.handler.length > 0) {\r\n                _this.handle(_this.sync);\r\n            }\r\n            _this.handleAnimation();\r\n            _this.handleTimeouts();\r\n        }, {\r\n            passive: true,\r\n        });\r\n    }\r\n    Object.defineProperty(ScrollHandler.prototype, \"current\", {\r\n        // current: IScrollInfo;\r\n        // private prev: IScrollInfo | null = null;\r\n        get: function () {\r\n            return this.asInfo();\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ScrollHandler.prototype.handle = function (handler) {\r\n        var info = this.current;\r\n        if (handler.prev && Math.abs(info.left - handler.prev.left) + Math.abs(info.top - handler.prev.top) < 4) {\r\n            return;\r\n        }\r\n        // eslint-disable-next-line no-param-reassign\r\n        handler.prev = info;\r\n        for (var _i = 0, _a = handler.handler; _i < _a.length; _i++) {\r\n            var s = _a[_i];\r\n            s(info);\r\n        }\r\n    };\r\n    ScrollHandler.prototype.handleAnimation = function () {\r\n        if (this.animation.timer !== -1 || this.animation.handler.length === 0) {\r\n            return;\r\n        }\r\n        this.animation.timer = 1;\r\n        requestAnimationFrame(this.handleAnimationImpl);\r\n    };\r\n    ScrollHandler.prototype.handleTimeouts = function () {\r\n        var _this = this;\r\n        if (this.numbers.size === 0) {\r\n            return;\r\n        }\r\n        this.numbers.forEach(function (handler, n) {\r\n            if (handler.handler.length === 0) {\r\n                return;\r\n            }\r\n            // eslint-disable-next-line no-param-reassign, no-restricted-globals\r\n            handler.timer = self.setTimeout(function () {\r\n                _this.handle(handler);\r\n                // eslint-disable-next-line no-param-reassign\r\n                handler.timer = -1;\r\n            }, n);\r\n        });\r\n    };\r\n    ScrollHandler.prototype.asInfo = function () {\r\n        return {\r\n            left: this.node.scrollLeft,\r\n            top: this.node.scrollTop,\r\n            width: this.node.clientWidth,\r\n            height: this.node.clientHeight,\r\n        };\r\n    };\r\n    ScrollHandler.prototype.push = function (mode, handler) {\r\n        var _a;\r\n        if (typeof mode === 'number') {\r\n            var entry = (_a = this.numbers.get(mode)) !== null && _a !== void 0 ? _a : dummy();\r\n            entry.handler.push(handler);\r\n            this.numbers.set(mode, entry);\r\n        }\r\n        switch (mode) {\r\n            case 'sync':\r\n                this.sync.handler.push(handler);\r\n                break;\r\n            case 'animation':\r\n                this.animation.handler.push(handler);\r\n                break;\r\n        }\r\n    };\r\n    ScrollHandler.prototype.remove = function (handler) {\r\n        var test = [this.sync, this.animation].concat(Array.from(this.numbers.values()));\r\n        return test.some(function (d) {\r\n            var index = d.handler.indexOf(handler);\r\n            if (index >= 0) {\r\n                d.handler.splice(index, 1);\r\n            }\r\n            return index >= 0;\r\n        });\r\n    };\r\n    ScrollHandler.prototype.isWaiting = function (mode) {\r\n        var _a, _b;\r\n        switch (mode) {\r\n            case 'animation':\r\n                return this.animation.timer >= 0;\r\n            case 'sync':\r\n                return false;\r\n            default:\r\n                return (_b = ((_a = this.numbers.get(mode)) === null || _a === void 0 ? void 0 : _a.timer) >= 0) !== null && _b !== void 0 ? _b : false;\r\n        }\r\n    };\r\n    return ScrollHandler;\r\n}());\r\n/**\r\n * @internal\r\n */\r\nexport function addScroll(scrollElement, mode, handler) {\r\n    // hide in element to have just one real listener\r\n    var c = scrollElement;\r\n    if (!c.__le_scroller__) {\r\n        c.__le_scroller__ = new ScrollHandler(scrollElement);\r\n    }\r\n    var s = c.__le_scroller__;\r\n    s.push(mode, handler);\r\n    return s.asInfo();\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport function isScrollEventWaiting(scroller, mode) {\r\n    var c = scroller;\r\n    if (!c.__le_scroller__) {\r\n        return false;\r\n    }\r\n    var s = c.__le_scroller__;\r\n    return s.isWaiting(mode);\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport function removeScroll(scroller, handler) {\r\n    var c = scroller;\r\n    if (c.__le_scroller__) {\r\n        c.__le_scroller__.remove(handler);\r\n    }\r\n}\r\n//# sourceMappingURL=scroll.js.map","var RowHeightException = /** @class */ (function () {\r\n    function RowHeightException(index, y, height) {\r\n        this.index = index;\r\n        this.y = y;\r\n        this.height = height;\r\n    }\r\n    Object.defineProperty(RowHeightException.prototype, \"y2\", {\r\n        get: function () {\r\n            return this.y + this.height;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return RowHeightException;\r\n}());\r\n/**\r\n * creates a uniform exception context, i.e no exceptions all rows are of the same height\r\n * @param {number} numberOfRows\r\n * @param {number} currentRowHeight\r\n * @param {number} rowPadding padding between rows\r\n * @return {IExceptionContext}\r\n */\r\nexport function uniformContext(numberOfRows, rowHeight, rowPadding) {\r\n    if (rowPadding === void 0) { rowPadding = 0; }\r\n    var currentRowHeight = rowHeight + rowPadding;\r\n    var exceptionsLookup = {\r\n        keys: function () { return [].values(); },\r\n        get: function () { return currentRowHeight; },\r\n        has: function () { return false; },\r\n        size: 0,\r\n    };\r\n    return {\r\n        exceptions: [],\r\n        exceptionsLookup: exceptionsLookup,\r\n        totalHeight: numberOfRows * currentRowHeight,\r\n        numberOfRows: numberOfRows,\r\n        defaultRowHeight: currentRowHeight,\r\n        padding: function () { return rowPadding; },\r\n    };\r\n}\r\n/**\r\n * computes the most frequent value in a given array like\r\n * @param {} values\r\n * @return {number}\r\n */\r\nfunction mostFrequentValue(values) {\r\n    var lookup = new Map();\r\n    values.forEach(function (value) {\r\n        lookup.set(value, (lookup.get(value) || 0) + 1);\r\n    });\r\n    if (lookup.size === 0) {\r\n        return 20; // default value since it doesn't matter\r\n    }\r\n    // sort desc take first key and asc by the second in case of tie, it is optimized to have exceptions for higher rows less for big rows\r\n    var sorted = Array.from(lookup).sort(function (a, b) {\r\n        if (a[1] !== b[1]) {\r\n            return b[1] - a[1];\r\n        }\r\n        return a[0] - b[0];\r\n    });\r\n    var mostFrequent = sorted[0][0];\r\n    if (mostFrequent === 0) {\r\n        // corner case\r\n        return sorted.length > 1 ? sorted[1][0] : 20; // all empty\r\n    }\r\n    return mostFrequent;\r\n}\r\n/**\r\n * creates a non uniform context based on the given array like heights\r\n * @param rowHeights array like to get the heights\r\n * @param {number} defaultRowHeight if not given the most frequent value will be used\r\n * @param {number} rowPadding padding between rows\r\n * @return {IExceptionContext}\r\n */\r\nexport function nonUniformContext(rowHeights, defaultRowHeight, rowPadding) {\r\n    if (defaultRowHeight === void 0) { defaultRowHeight = Number.NaN; }\r\n    if (rowPadding === void 0) { rowPadding = 0; }\r\n    var exceptionsLookup = new Map();\r\n    var exceptions = [];\r\n    var padding = typeof rowPadding === 'function' ? rowPadding : function () { return rowPadding; };\r\n    var actualDefaultRowHeight = defaultRowHeight;\r\n    if (Number.isNaN(actualDefaultRowHeight)) {\r\n        actualDefaultRowHeight = mostFrequentValue(rowHeights);\r\n    }\r\n    actualDefaultRowHeight += padding(-1);\r\n    var prev = -1;\r\n    var acc = 0;\r\n    var totalHeight = 0;\r\n    var numberOfRows = 0;\r\n    rowHeights.forEach(function (height, index) {\r\n        var paddedHeight = height + padding(index);\r\n        totalHeight += paddedHeight;\r\n        numberOfRows += 1;\r\n        if (paddedHeight === actualDefaultRowHeight) {\r\n            // regular\r\n            return;\r\n        }\r\n        exceptionsLookup.set(index, paddedHeight);\r\n        var between = (index - prev - 1) * actualDefaultRowHeight;\r\n        prev = index;\r\n        var y = acc + between;\r\n        acc = y + paddedHeight;\r\n        exceptions.push(new RowHeightException(index, y, paddedHeight));\r\n    });\r\n    return {\r\n        exceptionsLookup: exceptionsLookup,\r\n        exceptions: exceptions,\r\n        totalHeight: totalHeight,\r\n        defaultRowHeight: actualDefaultRowHeight,\r\n        numberOfRows: numberOfRows,\r\n        padding: padding,\r\n    };\r\n}\r\n/**\r\n * creates a random context with the given constraints\r\n * @param {number} numberOfRows\r\n * @param {number} defaultRowHeight\r\n * @param {number} minRowHeight\r\n * @param {number} maxRowHeight\r\n * @param {number} ratio around ratio percent will get a non uniform height\r\n * @param {number} seed random seed\r\n * @return {IExceptionContext}\r\n */\r\nexport function randomContext(numberOfRows, defaultRowHeight, minRowHeight, maxRowHeight, ratio, seed) {\r\n    if (minRowHeight === void 0) { minRowHeight = 2; }\r\n    if (maxRowHeight === void 0) { maxRowHeight = defaultRowHeight * 10; }\r\n    if (ratio === void 0) { ratio = 0.2; }\r\n    if (seed === void 0) { seed = Date.now(); }\r\n    var actSeed = seed;\r\n    var random = function () {\r\n        var x = Math.sin(actSeed) * 10000;\r\n        actSeed += 1;\r\n        return x - Math.floor(x);\r\n    };\r\n    var getter = function () {\r\n        var coin = random();\r\n        if (coin < ratio) {\r\n            // non uniform\r\n            return minRowHeight + Math.round(random() * (maxRowHeight - minRowHeight));\r\n        }\r\n        return defaultRowHeight;\r\n    };\r\n    var forEach = function (callback) {\r\n        for (var index = 0; index < numberOfRows; index += 1) {\r\n            callback(getter(), index);\r\n        }\r\n    };\r\n    return nonUniformContext({ forEach: forEach }, defaultRowHeight);\r\n}\r\n/**\r\n * computes the visible range\r\n * @param {number} scrollTop top scrolling\r\n * @param {number} clientHeight visible height\r\n * @param {number} rowHeight height of a row by default\r\n * @param {IRowHeightException[]} heightExceptions exceptions of this default height\r\n * @param {number} numberOfRows the number of rows\r\n * @return {IVisibleRange} the computed visible range\r\n */\r\nexport function range(scrollTop, clientHeight, rowHeight, heightExceptions, numberOfRows) {\r\n    if (numberOfRows === 0) {\r\n        return { first: 0, last: -1, firstRowPos: 0, endPos: 0 };\r\n    }\r\n    if (numberOfRows === 1) {\r\n        return {\r\n            first: 0,\r\n            last: 0,\r\n            firstRowPos: 0,\r\n            endPos: heightExceptions.length === 0 ? rowHeight : heightExceptions[0].y2,\r\n        };\r\n    }\r\n    var offset = scrollTop;\r\n    var offset2 = offset + clientHeight;\r\n    function indexOf(pos, indexShift) {\r\n        return Math.min(numberOfRows - 1, indexShift + Math.max(0, Math.floor(pos / rowHeight)));\r\n    }\r\n    function calc(offsetShift, indexShift) {\r\n        var shifted = offset - offsetShift;\r\n        var shifted2 = offset2 - offsetShift;\r\n        var first = indexOf(shifted, indexShift);\r\n        var last = indexOf(shifted2, indexShift);\r\n        var firstRowPos = offsetShift + (first - indexShift) * rowHeight;\r\n        var endPos = offsetShift + (last + 1 - indexShift) * rowHeight;\r\n        // if (!isGuess) {\r\n        //  console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\r\n        // }\r\n        // console.assert(\r\n        //   !isGuess || !(firstRowPos > offset || (endPos < offset2 && last < numberOfRows - 1)),\r\n        //   'error',\r\n        //   isGuess,\r\n        //   firstRowPos,\r\n        //   endPos,\r\n        //   offset,\r\n        //   offset2,\r\n        //   indexShift,\r\n        //   offsetShift\r\n        // );\r\n        return { first: first, last: last, firstRowPos: firstRowPos, endPos: endPos };\r\n    }\r\n    var r = calc(0, 0);\r\n    if (heightExceptions.length === 0) {\r\n        // uniform\r\n        return r;\r\n    }\r\n    if (r.last < heightExceptions[0].index) {\r\n        // console.log('before the first exception = uniform with no shift');\r\n        // console.log(r.first, '@', r.firstRowPos, r.last, '#', r.end, offset, offset2, r.firstRowPos <= offset, offset2 <= r.end);\r\n        return r;\r\n    }\r\n    if (r.last === heightExceptions[0].index && heightExceptions[0].height > rowHeight) {\r\n        return Object.assign(r, { endPos: heightExceptions[0].y2 });\r\n    }\r\n    // the position where the exceptions ends\r\n    var lastPos = heightExceptions[heightExceptions.length - 1];\r\n    if (offset >= lastPos.y) {\r\n        var rest = calc(lastPos.y2, lastPos.index + 1);\r\n        if (offset < lastPos.y2) {\r\n            // include me\r\n            return Object.assign(rest, {\r\n                first: lastPos.index,\r\n                firstRowPos: lastPos.y,\r\n            });\r\n        }\r\n        return rest;\r\n    }\r\n    // we have some exceptions\r\n    var visible = [];\r\n    var closest = heightExceptions[0]; // closest before not in range\r\n    for (var _i = 0, heightExceptions_1 = heightExceptions; _i < heightExceptions_1.length; _i++) {\r\n        var item = heightExceptions_1[_i];\r\n        var y = item.y, y2 = item.y2;\r\n        if (y >= offset2) {\r\n            break;\r\n        }\r\n        if (y2 <= offset) {\r\n            closest = item;\r\n            continue;\r\n        }\r\n        visible.push(item);\r\n    }\r\n    if (visible.length === 0) {\r\n        // console.log('we are in the between some exceptions and none are visible');\r\n        return calc(closest.y2, closest.index + 1); // skip myself\r\n    }\r\n    {\r\n        // console.log('we show at least one exception');\r\n        var firstException = visible[0];\r\n        var lastException = visible[visible.length - 1];\r\n        var first = Math.max(0, firstException.index - Math.max(0, Math.ceil((firstException.y - offset) / rowHeight)));\r\n        var last = lastException.index;\r\n        if (offset2 >= lastException.y2) {\r\n            last = indexOf(offset2 - lastException.y2, lastException.index + 1);\r\n        }\r\n        var firstRowPos = firstException.y - (firstException.index - first) * rowHeight;\r\n        var endPos = lastException.y2 + (last - lastException.index) * rowHeight;\r\n        // console.log(first, '@', firstRowPos, last, '#', end, offset, offset2, firstRowPos <= offset, offset2 <= end);\r\n        // console.assert(\r\n        //   firstRowPos <= offset && (endPos >= offset2 || last === numberOfRows - 1),\r\n        //   'error',\r\n        //   firstRowPos,\r\n        //   endPos,\r\n        //   offset,\r\n        //   offset2,\r\n        //   firstException,\r\n        //   lastException\r\n        // );\r\n        return { first: first, last: last, firstRowPos: firstRowPos, endPos: endPos };\r\n    }\r\n}\r\nexport function frozenDelta(current, target) {\r\n    var currentLength = current.length;\r\n    var targetLength = target.length;\r\n    if (currentLength === 0) {\r\n        return { added: target, removed: [], common: 0 };\r\n    }\r\n    if (targetLength === 0) {\r\n        return { added: [], removed: current, common: 0 };\r\n    }\r\n    if (currentLength === targetLength) {\r\n        // since sorted and left increasing true\r\n        return { added: [], removed: [], common: currentLength };\r\n    }\r\n    var removed = current.slice(Math.min(targetLength, currentLength));\r\n    var added = target.slice(Math.min(targetLength, currentLength));\r\n    return { added: added, removed: removed, common: currentLength - removed.length };\r\n}\r\nexport function updateFrozen(old, columns, first) {\r\n    var oldLast = old.length === 0 ? 0 : old[old.length - 1] + 1;\r\n    var added = [];\r\n    var removed = [];\r\n    for (var i = old.length - 1; i >= 0; i -= 1) {\r\n        var index = old[i];\r\n        if (index >= first) {\r\n            removed.push(old.pop());\r\n        }\r\n        else {\r\n            // can stop since sorted and it will never happen again\r\n            break;\r\n        }\r\n    }\r\n    // added\r\n    for (var i = oldLast; i < first; i += 1) {\r\n        if (columns[i].frozen) {\r\n            added.push(i);\r\n            old.push(i);\r\n        }\r\n    }\r\n    return { target: old, added: added, removed: removed };\r\n}\r\n//# sourceMappingURL=logic.js.map","/**\r\n * scrolling result\r\n */\r\nexport var EScrollResult;\r\n(function (EScrollResult) {\r\n    /**\r\n     * nothing has changed\r\n     */\r\n    EScrollResult[EScrollResult[\"NONE\"] = 0] = \"NONE\";\r\n    /**\r\n     * all rows needed to be recreated\r\n     */\r\n    EScrollResult[EScrollResult[\"ALL\"] = 1] = \"ALL\";\r\n    /**\r\n     * unknown\r\n     */\r\n    EScrollResult[EScrollResult[\"SOME\"] = 2] = \"SOME\";\r\n    /**\r\n     * some rows are added at the bottom\r\n     */\r\n    EScrollResult[EScrollResult[\"SOME_BOTTOM\"] = 3] = \"SOME_BOTTOM\";\r\n    /**\r\n     * some rows are added at the top\r\n     */\r\n    EScrollResult[EScrollResult[\"SOME_TOP\"] = 4] = \"SOME_TOP\";\r\n})(EScrollResult || (EScrollResult = {}));\r\n//# sourceMappingURL=IMixin.js.map","var PREFIX = 'le';\r\n/**\r\n * @internal\r\n * @param suffix suffix to suffix\r\n */\r\nexport function cssClass(suffix) {\r\n    if (!suffix) {\r\n        return PREFIX;\r\n    }\r\n    return PREFIX + \"-\" + suffix;\r\n}\r\nexport var CSS_CLASS_LOADING = cssClass('loading');\r\nexport var CSS_CLASS_FROZEN = cssClass('frozen');\r\nexport var CSS_CLASS_HIDDEN = cssClass('hidden');\r\nexport var CSS_CLASS_MULTI = cssClass('multi');\r\nexport var CSS_CLASS_EVEN = cssClass('even');\r\nexport var CSS_CLASS_SHIFTED = cssClass('shifted');\r\nexport var CSS_CLASS_SCROLLBAR_TESTER = cssClass('scrollbar-tester');\r\nexport var CSS_CLASS_HEADER = cssClass('header');\r\nexport var CSS_CLASS_BODY = cssClass('body');\r\nexport var CSS_CLASS_FOOTER = cssClass('footer');\r\nexport var CSS_CLASS_THEAD = cssClass('thead');\r\nexport var CSS_CLASS_TBODY = cssClass('tbody');\r\nexport var CSS_CLASS_TR = cssClass('tr');\r\nexport var CSS_CLASS_TH = cssClass('th');\r\nexport var CSS_CLASS_TD = cssClass('td');\r\nexport var CSS_CLASS_SCROLLING = cssClass('scrolling');\r\nexport var CSS_CLASS_ROW_ANIMATION = cssClass('row-animation');\r\n//# sourceMappingURL=index.js.map","var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nimport { ABORTED, isAbortAble } from './abortAble';\r\nimport { defaultPhases, EAnimationMode, noAnimationChange, } from './animation';\r\nimport KeyFinder from './animation/KeyFinder';\r\nimport { addScroll, clear, defaultMode, removeScroll } from './internal';\r\nimport { isScrollEventWaiting } from './internal/scroll';\r\nimport { range } from './logic';\r\nimport { EScrollResult } from './mixin';\r\nimport { cssClass, CSS_CLASS_EVEN, CSS_CLASS_FOOTER, CSS_CLASS_LOADING, CSS_CLASS_ROW_ANIMATION, CSS_CLASS_SCROLLING, CSS_CLASS_TR, } from './styles';\r\nexport function isLoadingCell(node) {\r\n    return node.classList.contains(CSS_CLASS_LOADING);\r\n}\r\n/**\r\n * base class for creating a scalable table renderer based on rows\r\n */\r\nvar ARowRenderer = /** @class */ (function () {\r\n    function ARowRenderer(body, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        this.body = body;\r\n        this.pool = [];\r\n        this.loadingPool = [];\r\n        this.loading = new WeakMap();\r\n        /**\r\n         * currently visible slice\r\n         */\r\n        this.visible = {\r\n            first: 0,\r\n            forcedFirst: 0,\r\n            last: -1,\r\n            forcedLast: -1,\r\n        };\r\n        /**\r\n         * position of the first visible row in pixel\r\n         * @type {number}\r\n         */\r\n        this.visibleFirstRowPos = 0;\r\n        this.scrollListener = null;\r\n        this.lastScrollInfo = null;\r\n        this.abortAnimation = function () { return undefined; };\r\n        this.options = {\r\n            async: defaultMode,\r\n            minScrollDelta: 10,\r\n            mixins: [],\r\n            scrollingHint: false,\r\n            batchSize: 10,\r\n            striped: false,\r\n            viewportOversize: 200,\r\n        };\r\n        this.adapter = this.createAdapter();\r\n        Object.assign(this.options, options);\r\n        this.mixins = this.options.mixins.map(function (MixinClass) { return new MixinClass(_this.adapter); });\r\n        this.fragment = body.ownerDocument.createDocumentFragment();\r\n    }\r\n    /**\r\n     * register another mixin to this renderer\r\n     * @param {IMixinClass} MixinClass the mixin class to instantiate\r\n     * @param options optional constructor options\r\n     */\r\n    ARowRenderer.prototype.addMixin = function (MixinClass, options) {\r\n        this.mixins.push(new MixinClass(this.adapter, options));\r\n    };\r\n    ARowRenderer.prototype.createAdapter = function () {\r\n        var _this = this;\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var that = this;\r\n        return {\r\n            visible: this.visible,\r\n            addAtBeginning: function (from, to) { return _this.addAtBeginning(from, to); },\r\n            addAtBottom: this.addAtBottom.bind(this),\r\n            removeFromBeginning: function (from, to) { return _this.removeFromBeginning(from, to); },\r\n            removeFromBottom: this.removeFromBottom.bind(this),\r\n            updateOffset: this.updateOffset.bind(this),\r\n            isScrollEventWaiting: function () { return isScrollEventWaiting(_this.bodyScroller, _this.options.async); },\r\n            get visibleFirstRowPos() {\r\n                return that.visibleFirstRowPos;\r\n            },\r\n            get context() {\r\n                return that.context;\r\n            },\r\n            get scrollOffset() {\r\n                return that.lastScrollInfo ? that.lastScrollInfo.top : 0;\r\n            },\r\n            get scrollTotal() {\r\n                return this.lastScrollInfo ? this.lastScrollInfo.height : this.bodyScroller.clientHeight;\r\n            },\r\n        };\r\n    };\r\n    Object.defineProperty(ARowRenderer.prototype, \"bodyScroller\", {\r\n        /**\r\n         * get the scrolling container i.e. parent of the body element\r\n         * @returns {HTMLElement}\r\n         */\r\n        get: function () {\r\n            return this.body.parentElement;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ARowRenderer.prototype, \"bodySizer\", {\r\n        get: function () {\r\n            var parent = this.bodyScroller;\r\n            var sizer = Array.from(parent.children).find(function (d) { return d.tagName.toLowerCase() === 'footer'; });\r\n            if (sizer) {\r\n                return sizer;\r\n            }\r\n            var s = parent.ownerDocument.createElement('footer');\r\n            s.classList.add(CSS_CLASS_FOOTER, cssClass(\"footer-\" + this.idPrefix));\r\n            parent.insertBefore(s, parent.firstChild);\r\n            return s;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * initializes the table and register the onscroll listener\r\n     * @returns {void} nothing\r\n     */\r\n    ARowRenderer.prototype.init = function () {\r\n        var _this = this;\r\n        var scroller = this.bodyScroller;\r\n        var old = addScroll(scroller, this.options.async, (this.scrollListener = function (act) {\r\n            _this.lastScrollInfo = act;\r\n            if (Math.abs(old.top - act.top) < _this.options.minScrollDelta &&\r\n                Math.abs(old.height - act.height) < _this.options.minScrollDelta) {\r\n                return;\r\n            }\r\n            var isGoingDown = act.top > old.top;\r\n            old = act;\r\n            _this.onScrolledVertically(act.top, act.height, isGoingDown);\r\n            if (_this.options.scrollingHint) {\r\n                _this.body.classList.remove(CSS_CLASS_SCROLLING);\r\n            }\r\n        }));\r\n        if (this.options.scrollingHint) {\r\n            addScroll(scroller, 'animation', function () { return _this.body.classList.add(CSS_CLASS_SCROLLING); });\r\n        }\r\n        this.recreate();\r\n    };\r\n    /**\r\n     * destroys this renderer and unregisters all event listeners\r\n     */\r\n    ARowRenderer.prototype.destroy = function () {\r\n        removeScroll(this.bodyScroller, this.scrollListener);\r\n        this.body.remove();\r\n    };\r\n    ARowRenderer.cleanUp = function (item) {\r\n        // eslint-disable-next-line no-param-reassign\r\n        item.style.height = null;\r\n    };\r\n    ARowRenderer.prototype.select = function (index) {\r\n        var item = this.pool.pop();\r\n        var result;\r\n        if (item != null) {\r\n            result = this.updateRow(item, index);\r\n        }\r\n        else {\r\n            item = this.loadingPool.pop();\r\n            if (item != null) {\r\n                item.classList.remove(CSS_CLASS_LOADING);\r\n                result = this.createRow(item, index);\r\n            }\r\n            else {\r\n                item = this.body.ownerDocument.createElement('div');\r\n                item.classList.add(CSS_CLASS_TR, cssClass(\"tr-\" + this.idPrefix));\r\n                result = this.createRow(item, index);\r\n            }\r\n        }\r\n        item.dataset.index = String(index);\r\n        if (this.options.striped) {\r\n            item.classList.toggle(CSS_CLASS_EVEN, index % 2 === 0);\r\n        }\r\n        return { item: item, result: result };\r\n    };\r\n    ARowRenderer.prototype.selectProxy = function () {\r\n        var proxy = this.loadingPool.pop();\r\n        if (proxy == null) {\r\n            proxy = this.body.ownerDocument.createElement('div');\r\n            proxy.classList.add(CSS_CLASS_LOADING, CSS_CLASS_TR, cssClass(\"tr-\" + this.idPrefix));\r\n        }\r\n        return proxy;\r\n    };\r\n    ARowRenderer.prototype.recycle = function (item) {\r\n        ARowRenderer.cleanUp(item);\r\n        // check if the original dom element is still being manipulated\r\n        var abort = this.loading.get(item);\r\n        if (abort != null) {\r\n            abort.abort();\r\n        }\r\n        else {\r\n            this.pool.push(item);\r\n        }\r\n    };\r\n    ARowRenderer.prototype.proxy = function (item, result) {\r\n        var _this = this;\r\n        if (!isAbortAble(result)) {\r\n            return item;\r\n        }\r\n        var abort = result;\r\n        // lazy loading\r\n        var real = item;\r\n        var proxy = this.selectProxy();\r\n        // copy attributes\r\n        proxy.dataset.index = real.dataset.index;\r\n        proxy.style.height = real.style.height;\r\n        this.loading.set(proxy, abort);\r\n        abort.then(function (abortResult) {\r\n            if (abortResult === ABORTED) {\r\n                // aborted can recycle the real one\r\n                ARowRenderer.cleanUp(real);\r\n                _this.pool.push(real);\r\n            }\r\n            else {\r\n                // fully loaded\r\n                _this.body.replaceChild(real, proxy);\r\n            }\r\n            _this.loading.delete(proxy);\r\n            ARowRenderer.cleanUp(proxy);\r\n            _this.loadingPool.push(proxy);\r\n        }, function () {\r\n            // handle as aborted\r\n            // aborted can recycle the real one\r\n            ARowRenderer.cleanUp(real);\r\n            _this.pool.push(real);\r\n            _this.loading.delete(proxy);\r\n            ARowRenderer.cleanUp(proxy);\r\n            _this.loadingPool.push(proxy);\r\n        });\r\n        return proxy;\r\n    };\r\n    ARowRenderer.prototype.create = function (index) {\r\n        var _a = this.select(index), item = _a.item, result = _a.result;\r\n        var _b = this.context, ex = _b.exceptionsLookup, padding = _b.padding;\r\n        var exceptionHeight = ex.get(index);\r\n        if (exceptionHeight != null) {\r\n            item.style.height = exceptionHeight - padding(index) + \"px\";\r\n        }\r\n        return this.proxy(item, result);\r\n    };\r\n    ARowRenderer.prototype.removeAll = function (perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        var b = this.body;\r\n        if (!perform) {\r\n            return Array.from(b.children);\r\n        }\r\n        var toRecycle = [];\r\n        while (b.lastElementChild) {\r\n            var i = b.lastElementChild;\r\n            b.removeChild(i);\r\n            this.recycle(i);\r\n            toRecycle.push(i);\r\n        }\r\n        return toRecycle;\r\n    };\r\n    /**\r\n     * triggers and visual update of all visible rows\r\n     */\r\n    ARowRenderer.prototype.update = function () {\r\n        var _this = this;\r\n        var first = this.visible.first;\r\n        var fragment = this.fragment;\r\n        var items = Array.from(this.body.children);\r\n        clear(this.body);\r\n        items.forEach(function (item, i) {\r\n            if (_this.loading.has(item)) {\r\n                // still loading\r\n                fragment.appendChild(item);\r\n                return;\r\n            }\r\n            var abort = _this.updateRow(item, i + first);\r\n            fragment.appendChild(_this.proxy(item, abort));\r\n        });\r\n        this.body.appendChild(fragment);\r\n    };\r\n    /**\r\n     * utility to execute a function for each visible row\r\n     * @param {(row: HTMLElement, rowIndex: number) => void} callback callback to execute\r\n     * @param {boolean} inPlace whether the DOM changes should be performed in place instead of in a fragment\r\n     */\r\n    ARowRenderer.prototype.forEachRow = function (callback, inPlace) {\r\n        var _this = this;\r\n        if (inPlace === void 0) { inPlace = false; }\r\n        var rows = Array.from(this.body.children);\r\n        var fragment = this.fragment;\r\n        if (!inPlace) {\r\n            clear(this.body);\r\n        }\r\n        rows.forEach(function (row, index) {\r\n            if (!isLoadingCell(row) && row.dataset.animation !== 'update_remove' && row.dataset.animation !== 'hide') {\r\n                // skip loading ones and temporary ones\r\n                callback(row, index + _this.visible.first);\r\n            }\r\n            if (!inPlace) {\r\n                fragment.appendChild(row);\r\n            }\r\n        });\r\n        if (!inPlace) {\r\n            this.body.appendChild(fragment);\r\n        }\r\n    };\r\n    ARowRenderer.prototype.removeFromBeginning = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        return this.remove(from, to, true, perform);\r\n    };\r\n    ARowRenderer.prototype.removeFromBottom = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        return this.remove(from, to, false, perform);\r\n    };\r\n    ARowRenderer.prototype.remove = function (from, to, fromBeginning, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        if (to < from) {\r\n            return [];\r\n        }\r\n        var b = this.body;\r\n        var toRecycle = [];\r\n        // console.log('remove', fromBeginning, (to - from) + 1, this.body.childElementCount - ((to - from) + 1));\r\n        var act = (fromBeginning ? b.firstChild : b.lastChild);\r\n        for (var i = from; i <= to; i += 1) {\r\n            var item = act;\r\n            act = (fromBeginning ? act.nextSibling : act.previousSibling);\r\n            if (perform) {\r\n                b.removeChild(item);\r\n                this.recycle(item);\r\n            }\r\n            toRecycle.push(item);\r\n        }\r\n        return toRecycle;\r\n    };\r\n    ARowRenderer.prototype.addAtBeginning = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        if (to < from) {\r\n            return null;\r\n        }\r\n        // console.log('add', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\r\n        var fragment = this.fragment;\r\n        if (from === to && perform) {\r\n            this.body.insertBefore(this.create(from), this.body.firstChild);\r\n            return null;\r\n        }\r\n        for (var i = from; i <= to; i += 1) {\r\n            fragment.appendChild(this.create(i));\r\n        }\r\n        if (perform) {\r\n            this.body.insertBefore(fragment, this.body.firstChild);\r\n        }\r\n        return fragment;\r\n    };\r\n    ARowRenderer.prototype.addAtBottom = function (from, to, perform) {\r\n        if (perform === void 0) { perform = true; }\r\n        if (to < from) {\r\n            return null;\r\n        }\r\n        // console.log('add_b', (to - from) + 1, this.body.childElementCount + ((to - from) + 1));\r\n        if (from === to && perform) {\r\n            this.body.appendChild(this.create(from));\r\n            return null;\r\n        }\r\n        var fragment = this.fragment;\r\n        for (var i = from; i <= to; i += 1) {\r\n            fragment.appendChild(this.create(i));\r\n        }\r\n        if (perform) {\r\n            this.body.appendChild(fragment);\r\n        }\r\n        return fragment;\r\n    };\r\n    ARowRenderer.prototype.updateOffset = function (firstRowPos) {\r\n        this.visibleFirstRowPos = firstRowPos;\r\n        this.updateSizer(firstRowPos);\r\n    };\r\n    ARowRenderer.prototype.updateSizer = function (firstRowPos) {\r\n        var totalHeight = this.context.totalHeight;\r\n        setTransform(this.body, 0, firstRowPos.toFixed(0));\r\n        setTransform(this.bodySizer, 0, Math.max(0, totalHeight - 1).toFixed(0));\r\n    };\r\n    /**\r\n     * removes all rows and recreates the table\r\n     * @param {IAnimationContext} ctx optional animation context to create a transition between the previous and the current tables\r\n     * @returns {void} nothing\r\n     */\r\n    ARowRenderer.prototype.recreate = function (ctx) {\r\n        this.abortAnimation();\r\n        if (ctx) {\r\n            return this.recreateAnimated(ctx);\r\n        }\r\n        return this.recreatePure();\r\n    };\r\n    ARowRenderer.prototype.recreatePure = function () {\r\n        var context = this.context;\r\n        var scroller = this.bodyScroller;\r\n        // update first to avoid resetting scrollTop\r\n        this.updateOffset(0);\r\n        this.removeAll();\r\n        this.clearPool();\r\n        var _a = range(scroller.scrollTop, scroller.clientHeight, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\r\n        this.visible.first = first;\r\n        this.visible.forcedFirst = first;\r\n        this.visible.last = last;\r\n        this.visible.forcedLast = last;\r\n        if (first < 0) {\r\n            // empty\r\n            this.updateOffset(0);\r\n            return;\r\n        }\r\n        this.addAtBottom(first, last);\r\n        this.updateOffset(firstRowPos);\r\n    };\r\n    ARowRenderer.prototype.recreateAnimated = function (ctx) {\r\n        var _this = this;\r\n        var lookup = new Map();\r\n        var prev = new KeyFinder(ctx.previous, ctx.previousKey);\r\n        var cur = new KeyFinder(this.context, ctx.currentKey);\r\n        var next = range(this.bodyScroller.scrollTop, this.bodyScroller.clientHeight, cur.context.defaultRowHeight, cur.context.exceptions, cur.context.numberOfRows);\r\n        {\r\n            var rows_1 = Array.from(this.body.children);\r\n            var old = __assign({}, this.visible);\r\n            // store the current rows in a lookup and clear\r\n            clear(this.body);\r\n            prev.positions(old.first, Math.min(old.last, old.first + rows_1.length), this.visibleFirstRowPos, function (i, key, pos) {\r\n                var n = rows_1[i];\r\n                if (n) {\r\n                    // shouldn't happen that it is not there\r\n                    lookup.set(key, { n: n, pos: pos, i: i });\r\n                }\r\n                // else {\r\n                //  console.error(i, key, pos, rows);\r\n                // }\r\n            });\r\n        }\r\n        this.visible.first = next.first;\r\n        this.visible.forcedFirst = next.first;\r\n        this.visible.last = next.last;\r\n        this.visible.forcedLast = next.last;\r\n        var fragment = this.fragment;\r\n        var animation = [];\r\n        var nodeY = next.firstRowPos;\r\n        cur.positions(next.first, next.last, next.firstRowPos, function (i, key, pos) {\r\n            var node;\r\n            var mode = EAnimationMode.UPDATE;\r\n            var previous;\r\n            var item = lookup.get(key);\r\n            if (item != null) {\r\n                // still visible\r\n                lookup.delete(key);\r\n                // update height\r\n                item.n.dataset.index = String(i);\r\n                node = _this.proxy(item.n, _this.updateRow(item.n, i));\r\n                previous = {\r\n                    index: item.i,\r\n                    y: item.pos,\r\n                    height: prev.exceptionHeightOf(item.i, true),\r\n                };\r\n            }\r\n            else {\r\n                // need a new row\r\n                var old = prev.posByKey(key);\r\n                // maybe not visible  before so keep in place\r\n                node = _this.create(i);\r\n                mode = old.index < 0 ? EAnimationMode.SHOW : EAnimationMode.UPDATE_CREATE;\r\n                previous = {\r\n                    index: old.index,\r\n                    y: old.pos >= 0 ? old.pos : pos,\r\n                    height: old.index < 0 ? cur.exceptionHeightOf(i, true) : prev.exceptionHeightOf(old.index, true),\r\n                };\r\n            }\r\n            animation.push({\r\n                node: node,\r\n                key: key,\r\n                mode: mode,\r\n                previous: previous,\r\n                nodeY: nodeY,\r\n                nodeYCurrentHeight: pos,\r\n                current: {\r\n                    index: i,\r\n                    y: pos,\r\n                    height: cur.exceptionHeightOf(i),\r\n                },\r\n            });\r\n            node.style.transform = \"translate(0, \" + (nodeY - pos) + \"px)\";\r\n            nodeY += previous.height + (previous.index < 0 ? cur.padding(i) : prev.padding(previous.index));\r\n            fragment.appendChild(node);\r\n        });\r\n        var nodeYCurrentHeight = next.endPos;\r\n        // items that are going to be removed\r\n        lookup.forEach(function (item, key) {\r\n            // calculate their next position\r\n            var r = cur.posByKey(key);\r\n            // maybe not visible anymore, keep in place\r\n            var nextPos = r.pos >= 0 ? r.pos : item.pos;\r\n            var node = item.n;\r\n            // located at addedPos\r\n            // should end up at nextPos\r\n            // was previously at item.pos\r\n            node.style.transform = \"translate(0, \" + (item.pos - nodeY) + \"px)\";\r\n            fragment.appendChild(node);\r\n            var prevHeight = prev.exceptionHeightOf(item.i, true);\r\n            animation.push({\r\n                node: item.n,\r\n                key: key,\r\n                mode: r.index < 0 ? EAnimationMode.HIDE : EAnimationMode.UPDATE_REMOVE,\r\n                previous: {\r\n                    index: item.i,\r\n                    y: item.pos,\r\n                    height: prevHeight,\r\n                },\r\n                nodeY: nodeY,\r\n                nodeYCurrentHeight: nodeYCurrentHeight,\r\n                current: {\r\n                    index: r.index,\r\n                    y: nextPos,\r\n                    height: r.index < 0 ? null : cur.exceptionHeightOf(r.index),\r\n                },\r\n            });\r\n            nodeYCurrentHeight +=\r\n                r.index < 0 ? cur.context.defaultRowHeight : cur.exceptionHeightOf(r.index, true) + cur.padding(r.index);\r\n            nodeY += prevHeight + prev.padding(item.i);\r\n        });\r\n        this.updateOffset(next.firstRowPos);\r\n        this.animate(animation, ctx.phases || defaultPhases, prev, cur, fragment);\r\n    };\r\n    ARowRenderer.prototype.animate = function (animation, phases, previousFinder, currentFinder, fragment) {\r\n        var _this = this;\r\n        var activeAnimation = animation;\r\n        if (activeAnimation.length <= 0) {\r\n            this.body.appendChild(fragment);\r\n            return;\r\n        }\r\n        var currentTimer = -1;\r\n        var actPhase = 0;\r\n        var executePhase = function (phase, items) {\r\n            if (items === void 0) { items = activeAnimation; }\r\n            items.forEach(function (anim) { return phase.apply(anim, previousFinder, currentFinder); });\r\n        };\r\n        var run = function () {\r\n            // dummy log for forcing dom update\r\n            // eslint-disable-next-line no-console\r\n            console.assert(activeAnimation[0].node.offsetTop >= 0, 'dummy log for forcing dom update');\r\n            executePhase(phases[actPhase]);\r\n            actPhase += 1;\r\n            // shifted by one since already added through ++\r\n            if (actPhase < phases.length) {\r\n                // schedule the next one\r\n                var next = phases[actPhase];\r\n                // eslint-disable-next-line no-restricted-globals\r\n                currentTimer = self.setTimeout(run, next.delay);\r\n                return;\r\n            }\r\n            // last one\r\n            var body = _this.body.classList;\r\n            Array.from(body).forEach(function (v) {\r\n                if (v.startsWith(cssClass()) && v.endsWith('-animation')) {\r\n                    body.remove(v);\r\n                }\r\n            });\r\n            // clean up\r\n            activeAnimation.forEach(function (_a) {\r\n                var node = _a.node, mode = _a.mode;\r\n                if (mode !== EAnimationMode.UPDATE_REMOVE && mode !== EAnimationMode.HIDE) {\r\n                    return;\r\n                }\r\n                node.remove();\r\n                // eslint-disable-next-line no-param-reassign\r\n                node.style.transform = '';\r\n                _this.recycle(node);\r\n            });\r\n            _this.abortAnimation = function () { return undefined; };\r\n            currentTimer = -1;\r\n        };\r\n        // execute all phases having a delay of zero\r\n        while (phases[actPhase].delay === 0) {\r\n            executePhase(phases[actPhase]);\r\n            actPhase += 1;\r\n        }\r\n        // after the initial one\r\n        var body = this.body;\r\n        this.body.appendChild(fragment);\r\n        var dummyAnimation = [];\r\n        activeAnimation = activeAnimation.filter(function (d) {\r\n            if (noAnimationChange(d, previousFinder.context.defaultRowHeight, currentFinder.context.defaultRowHeight)) {\r\n                dummyAnimation.push(d);\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n        if (dummyAnimation.length > 0) {\r\n            // execute all phases for them\r\n            phases.slice(actPhase).forEach(function (phase) { return executePhase(phase, dummyAnimation); });\r\n        }\r\n        if (activeAnimation.length === 0) {\r\n            return;\r\n        }\r\n        body.classList.add(CSS_CLASS_ROW_ANIMATION);\r\n        new Set(activeAnimation.map(function (d) { return d.mode; })).forEach(function (mode) {\r\n            // add class but map to UPDATE only\r\n            body.classList.add(cssClass(EAnimationMode[mode].toLowerCase().split('_')[0] + \"-animation\"));\r\n        });\r\n        this.abortAnimation = function () {\r\n            if (currentTimer <= 0) {\r\n                return;\r\n            }\r\n            // abort by removing\r\n            clearTimeout(currentTimer);\r\n            currentTimer = -1;\r\n            // run the last phase\r\n            actPhase = phases.length - 1;\r\n            run();\r\n        };\r\n        // next tick such that DOM will be updated\r\n        // eslint-disable-next-line no-restricted-globals\r\n        currentTimer = self.setTimeout(run, phases[actPhase].delay);\r\n    };\r\n    /**\r\n     * clears the row pool used for faster creation\r\n     */\r\n    ARowRenderer.prototype.clearPool = function () {\r\n        // clear pool\r\n        this.pool.splice(0, this.pool.length);\r\n    };\r\n    /**\r\n     * triggers a revalidation of the current scrolling offset\r\n     */\r\n    ARowRenderer.prototype.revalidate = function () {\r\n        var scroller = this.bodyScroller;\r\n        this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, true);\r\n        this.updateOffset(this.visibleFirstRowPos);\r\n    };\r\n    /**\r\n     * scrolling vertically\r\n     * @param {number} scrollTop top scrolling\r\n     * @param {number} clientHeight visible height\r\n     * @param {boolean} isGoingDown hint whether the scrollTop increases\r\n     * @return {EScrollResult} full in case of a full rebuild or partial update\r\n     */\r\n    ARowRenderer.prototype.onScrolledVertically = function (scrollTop, clientHeight, isGoingDown) {\r\n        var shift = this.options.viewportOversize;\r\n        var shiftTop = Math.max(0, scrollTop - shift);\r\n        var scrollResult = this.onScrolledImpl(shiftTop, clientHeight + shift + (scrollTop - shiftTop));\r\n        for (var _i = 0, _a = this.mixins; _i < _a.length; _i++) {\r\n            var mixin = _a[_i];\r\n            mixin.onScrolled(isGoingDown, scrollResult);\r\n        }\r\n        return scrollResult;\r\n    };\r\n    ARowRenderer.prototype.shiftLast = function (current, currentDelta) {\r\n        var b = this.options.batchSize;\r\n        if (currentDelta >= b) {\r\n            return current;\r\n        }\r\n        var total = this.context.numberOfRows;\r\n        return Math.min(total - 1, current + (this.options.batchSize - currentDelta));\r\n    };\r\n    ARowRenderer.prototype.shiftFirst = function (current, currentFirstRow, currentDelta) {\r\n        var _a;\r\n        var b = this.options.batchSize;\r\n        if (currentDelta >= b || current <= 0) {\r\n            return { first: current, firstRowPos: currentFirstRow };\r\n        }\r\n        var first = Math.max(0, current - (this.options.batchSize - currentDelta));\r\n        var _b = this.context, exceptionsLookup = _b.exceptionsLookup, defaultRowHeight = _b.defaultRowHeight;\r\n        var firstRowPos = currentFirstRow;\r\n        for (var i = first; i < current; i += 1) {\r\n            firstRowPos -= (_a = exceptionsLookup.get(i)) !== null && _a !== void 0 ? _a : defaultRowHeight;\r\n        }\r\n        return { first: first, firstRowPos: firstRowPos };\r\n    };\r\n    ARowRenderer.prototype.onScrolledImpl = function (scrollTop, clientHeight) {\r\n        var context = this.context;\r\n        var _a = range(scrollTop, clientHeight, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\r\n        var visible = this.visible;\r\n        visible.forcedFirst = first;\r\n        visible.forcedLast = last;\r\n        if (first - visible.first >= 0 && last - visible.last <= 0) {\r\n            // nothing to do\r\n            return EScrollResult.NONE;\r\n        }\r\n        var r = EScrollResult.SOME;\r\n        var toRecycle;\r\n        var toAdd;\r\n        var toAddBottom = false;\r\n        if (first > visible.last || last < visible.first) {\r\n            // no overlap, clean and draw everything\r\n            // console.log(`ff added: ${last - first + 1} removed: ${visibleLast - visibleFirst + 1} ${first}:${last} ${offset}`);\r\n            // removeRows(visibleFirst, visibleLast);\r\n            toRecycle = this.removeAll(false);\r\n            toAdd = this.addAtBottom(first, last, false);\r\n            toAddBottom = true;\r\n            r = EScrollResult.ALL;\r\n        }\r\n        else if (first < visible.first) {\r\n            // some first rows missing and some last rows to much\r\n            // console.log(`up added: ${visibleFirst - first + 1} removed: ${visibleLast - last + 1} ${first}:${last} ${offset}`);\r\n            var toRemove = visible.last - (last + 1);\r\n            if (toRemove >= this.options.batchSize) {\r\n                toRecycle = this.removeFromBottom(last + 1, visible.last, false);\r\n            }\r\n            else {\r\n                last = visible.last;\r\n            }\r\n            var shift = this.shiftFirst(first, firstRowPos, visible.first - 1 - first);\r\n            first = shift.first;\r\n            firstRowPos = shift.firstRowPos;\r\n            toAdd = this.addAtBeginning(first, visible.first - 1, false);\r\n            toAddBottom = false;\r\n            r = EScrollResult.SOME_TOP;\r\n        }\r\n        else {\r\n            // console.log(`do added: ${last - visibleLast + 1} removed: ${first - visibleFirst + 1} ${first}:${last} ${offset}`);\r\n            // some last rows missing and some first rows to much\r\n            var toRemove = first - 1 - visible.first;\r\n            if (toRemove >= this.options.batchSize) {\r\n                toRecycle = this.removeFromBeginning(visible.first, first - 1, false);\r\n            }\r\n            else {\r\n                first = visible.first;\r\n                firstRowPos = this.visibleFirstRowPos;\r\n            }\r\n            last = this.shiftLast(last, last - visible.last + 1);\r\n            toAdd = this.addAtBottom(visible.last + 1, last, false);\r\n            toAddBottom = true;\r\n            r = EScrollResult.SOME_BOTTOM;\r\n        }\r\n        visible.first = first;\r\n        visible.last = last;\r\n        this.updateOffset(firstRowPos);\r\n        this.manipulate(toRecycle, toAdd, toAddBottom);\r\n        return r;\r\n    };\r\n    ARowRenderer.prototype.manipulate = function (toRecycle, toAdd, bottom) {\r\n        if (toRecycle) {\r\n            for (var _i = 0, toRecycle_1 = toRecycle; _i < toRecycle_1.length; _i++) {\r\n                var item = toRecycle_1[_i];\r\n                item.remove();\r\n                this.recycle(item);\r\n            }\r\n        }\r\n        if (!toAdd) {\r\n            return;\r\n        }\r\n        if (bottom) {\r\n            this.body.appendChild(toAdd);\r\n        }\r\n        else {\r\n            this.body.insertBefore(toAdd, this.body.firstChild);\r\n        }\r\n    };\r\n    return ARowRenderer;\r\n}());\r\nexport { ARowRenderer };\r\nexport default ARowRenderer;\r\nexport function setTransform(elem, x, y) {\r\n    var text = \"translate(\" + x + \"px, \" + y + \"px)\";\r\n    var anyElem = elem;\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    if (anyElem.__transform__ === text) {\r\n        return;\r\n    }\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    anyElem.__transform__ = text;\r\n    // eslint-disable-next-line no-param-reassign\r\n    elem.style.transform = text;\r\n}\r\n//# sourceMappingURL=ARowRenderer.js.map","// import manually import './style.scss';\r\nfunction assignStyles(target, source) {\r\n    for (var _i = 0, _a = Object.keys(source); _i < _a.length; _i++) {\r\n        var key = _a[_i];\r\n        var v = source[key];\r\n        if (!v.endsWith(' !important')) {\r\n            if (target[key] !== v) {\r\n                // eslint-disable-next-line no-param-reassign\r\n                target[key] = v;\r\n            }\r\n            continue;\r\n        }\r\n        // handle special important case\r\n        var plain = v.slice(0, -' !important'.length);\r\n        if (target[key] === plain) {\r\n            continue;\r\n        }\r\n        // eslint-disable-next-line no-param-reassign\r\n        target[key] = plain;\r\n        // see https://gist.github.com/youssman/745578062609e8acac9f\r\n        var hyphen = key.replace(/([a-zA-Z])(?=[A-Z])/g, '$1-').toLowerCase();\r\n        target.setProperty(hyphen, plain, 'important');\r\n    }\r\n}\r\nvar StyleManager = /** @class */ (function () {\r\n    /**\r\n     * the parent element to append this managed style\r\n     * @param {HTMLElement} root\r\n     */\r\n    function StyleManager(root) {\r\n        this.rules = [];\r\n        this.testVerifyTimeout = -1;\r\n        this.node = root.ownerDocument.createElement('style');\r\n        this.node.appendChild(root.ownerDocument.createTextNode('')); // for webkit?\r\n        root.appendChild(this.node);\r\n    }\r\n    StyleManager.prototype.destroy = function () {\r\n        this.node.remove();\r\n    };\r\n    StyleManager.prototype.verifySheet = function () {\r\n        var _this = this;\r\n        var sheet = this.sheet;\r\n        if (!sheet) {\r\n            if (this.testVerifyTimeout >= 0) {\r\n                return;\r\n            }\r\n            // test till attached\r\n            // eslint-disable-next-line no-restricted-globals\r\n            this.testVerifyTimeout = self.setTimeout(function () {\r\n                _this.testVerifyTimeout = -1;\r\n                _this.verifySheet();\r\n            }, 20);\r\n            return;\r\n        }\r\n        var rules = sheet.cssRules;\r\n        if (rules.length === this.rules.length &&\r\n            this.rules.every(function (d, i) { return rules[i].selectorText === d.selector; })) {\r\n            // same\r\n            return;\r\n        }\r\n        // console.warn('invalid sheet rules detected');\r\n        var l = rules.length;\r\n        for (var i = 0; i < l; i += 1) {\r\n            sheet.deleteRule(i);\r\n        }\r\n        // create all\r\n        for (var _i = 0, _a = this.rules; _i < _a.length; _i++) {\r\n            var rule = _a[_i];\r\n            var index = sheet.insertRule(rule.selector + \" {}\", sheet.cssRules.length);\r\n            var cssRule = sheet.cssRules[index];\r\n            rule.selector = cssRule.selectorText;\r\n            assignStyles(cssRule.style, rule.style);\r\n        }\r\n    };\r\n    Object.defineProperty(StyleManager.prototype, \"sheet\", {\r\n        get: function () {\r\n            return this.node.sheet;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StyleManager.prototype.getSheetRule = function (index) {\r\n        var sheet = this.sheet;\r\n        return sheet ? sheet.cssRules[index] : null;\r\n    };\r\n    /**\r\n     * add a custom css rule\r\n     * @param {string} id unique id of the rule for later identification\r\n     * @param {string} selector the css selector\r\n     * @param {Partial<CSSStyleDeclaration>} style the style attributes\r\n     * @returns {string} the id again\r\n     */\r\n    StyleManager.prototype.addRule = function (id, selector, style) {\r\n        this.verifySheet();\r\n        var sheet = this.sheet;\r\n        if (!sheet) {\r\n            // upon next update\r\n            this.rules.push({ id: id, selector: selector, style: style });\r\n            return null;\r\n        }\r\n        var index = sheet.insertRule(selector + \" {}\", sheet.cssRules.length);\r\n        var rule = sheet.cssRules[index];\r\n        this.rules.push({ id: id, selector: rule.selectorText, style: style });\r\n        assignStyles(rule.style, style);\r\n        return id;\r\n    };\r\n    /**\r\n     * updates or add a rule, see @addRule\r\n     * @param {string} id unique id of the rule for later identification\r\n     * @param {string} selector the css selector\r\n     * @param {Partial<CSSStyleDeclaration>} style the style attributes\r\n     * @returns {string} the id again\r\n     */\r\n    StyleManager.prototype.updateRule = function (id, selector, style) {\r\n        this.verifySheet();\r\n        var index = this.rules.findIndex(function (d) { return d.id === id; });\r\n        if (index < 0) {\r\n            return this.addRule(id, selector, style);\r\n        }\r\n        var stored = this.rules[index];\r\n        stored.selector = selector;\r\n        stored.style = style;\r\n        var rule = this.getSheetRule(index);\r\n        if (rule) {\r\n            if (rule.selectorText.replace(/\\s/gm, '') !== selector.replace(/\\s/gm, '')) {\r\n                // ignoring white space\r\n                rule.selectorText = selector;\r\n                stored.selector = rule.selectorText;\r\n            }\r\n            assignStyles(rule.style, style);\r\n        }\r\n        return id;\r\n    };\r\n    /**\r\n     * deletes the given rule by id\r\n     * @param {string} id the rule to delete\r\n     */\r\n    StyleManager.prototype.deleteRule = function (id) {\r\n        this.verifySheet();\r\n        var index = this.rules.findIndex(function (d) { return d.id === id; });\r\n        if (index < 0) {\r\n            return;\r\n        }\r\n        this.rules.splice(index, 1);\r\n        var sheet = this.sheet;\r\n        if (sheet) {\r\n            sheet.deleteRule(index);\r\n        }\r\n    };\r\n    Object.defineProperty(StyleManager.prototype, \"ruleNames\", {\r\n        /**\r\n         * get a list of all registered rule ids\r\n         */\r\n        get: function () {\r\n            return this.rules.map(function (d) { return d.id; });\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return StyleManager;\r\n}());\r\nexport default StyleManager;\r\n//# sourceMappingURL=StyleManager.js.map","var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { addScroll } from '../internal';\r\nimport { cssClass, CSS_CLASS_BODY, CSS_CLASS_FOOTER, CSS_CLASS_HEADER, CSS_CLASS_SCROLLBAR_TESTER, CSS_CLASS_SHIFTED, CSS_CLASS_TBODY, CSS_CLASS_THEAD, } from '../styles';\r\nimport StyleManager from './StyleManager';\r\nexport function setTemplate(root, id) {\r\n    var cleanId = id.startsWith('#') ? id.slice(1) : id;\r\n    // eslint-disable-next-line no-param-reassign\r\n    root.innerHTML = \"\\n  <header id=\\\"header-\" + cleanId + \"\\\" class=\\\"\" + CSS_CLASS_HEADER + \" \" + cssClass(\"header-\" + cleanId) + \"\\\">\\n    <article class=\\\"\" + CSS_CLASS_THEAD + \" \" + cssClass(\"thead-\" + cleanId) + \"\\\"></article>\\n  </header>\\n  <main id=\\\"body-\" + cleanId + \"\\\" class=\\\"\" + CSS_CLASS_BODY + \" \" + cssClass(\"body-\" + cleanId) + \"\\\">\\n    <footer class=\\\"\" + CSS_CLASS_FOOTER + \"\\\">&nbsp;</footer>\\n    <article class=\\\"\" + CSS_CLASS_TBODY + \" \" + cssClass(\"tbody-\" + cleanId) + \"\\\"></article>\\n  </main>\";\r\n    return root;\r\n}\r\n/**\r\n * generates the HTML Ids used for the header and body article of a table\r\n * @param {string} tableId base table id\r\n * @param {boolean} asSelector flag whether to prepend with # for CSS selector\r\n * @return {ISelectors} the table ids used for header and body\r\n */\r\nexport function tableIds(tableId) {\r\n    return {\r\n        thead: \"thead-\" + tableId,\r\n        tbody: \"tbody-\" + tableId,\r\n        tr: \"tr-\" + tableId,\r\n        th: \"th-\" + tableId,\r\n        td: \"td-\" + tableId,\r\n    };\r\n}\r\nexport function tableCSSClasses(tableId) {\r\n    var ids = tableIds(tableId);\r\n    return {\r\n        thead: cssClass(ids.thead),\r\n        tbody: cssClass(ids.tbody),\r\n        tr: cssClass(ids.tr),\r\n        th: cssClass(ids.th),\r\n        td: cssClass(ids.td),\r\n    };\r\n}\r\n/**\r\n * utility for custom generated CSS rules with a focus on dynamically generated grid layouts\r\n */\r\nvar GridStyleManager = /** @class */ (function (_super) {\r\n    __extends(GridStyleManager, _super);\r\n    function GridStyleManager(root, id) {\r\n        var _this = _super.call(this, root) || this;\r\n        _this.id = id.startsWith('#') ? id.slice(1) : id;\r\n        _this.ids = tableIds(_this.id);\r\n        _this.cssClasses = tableCSSClasses(_this.id);\r\n        var headerScroller = root.getElementsByTagName('header')[0];\r\n        var bodyScroller = root.getElementsByTagName('main')[0];\r\n        // async since style needs to be added to dom first\r\n        // eslint-disable-next-line no-restricted-globals\r\n        self.setTimeout(function () {\r\n            var width = measureScrollbar(root).width;\r\n            _this.updateRule('__scrollBarFix2', \"#header-\" + _this.id + \" > article:last-of-type\", {\r\n                borderRight: width + \"px solid transparent\",\r\n            });\r\n        }, 20);\r\n        var old = headerScroller.scrollLeft;\r\n        // update frozen and sync header with body\r\n        addScroll(bodyScroller, 'animation', function (act) {\r\n            var newValue = act.left;\r\n            if (old !== newValue) {\r\n                headerScroller.scrollLeft = newValue;\r\n                old = newValue;\r\n            }\r\n            root.classList.toggle(CSS_CLASS_SHIFTED, act.left > 0);\r\n        });\r\n        return _this;\r\n    }\r\n    /**\r\n     * updates the column widths and default row height for a table\r\n     * @param {number} defaultRowHeight\r\n     * @param {IColumn[]} columns\r\n     * @param {number} frozenShift shift frozen columns\r\n     * @param {string} tableId optional tableId in case of multiple tables within the same engine\r\n     * @param {string} unit\r\n     */\r\n    GridStyleManager.prototype.update = function (defaultRowHeight, columns, padding, frozenShift, tableId, unit) {\r\n        if (unit === void 0) { unit = 'px'; }\r\n        var ids = tableIds(tableId);\r\n        var selectors = tableCSSClasses(tableId);\r\n        var total = \"\" + columns.reduce(function (a, b, i) { return a + b.width + padding(i); }, 0) + unit;\r\n        this.updateRule(\"__heightsRule\" + selectors.tr, \".\" + selectors.tr, {\r\n            height: defaultRowHeight + \"px\",\r\n            width: total,\r\n        });\r\n        this.updateRule(\"__heightsRule\" + selectors.tbody, \"#\" + ids.tbody, {\r\n            width: total,\r\n        });\r\n        this.updateColumns(columns, padding, selectors, frozenShift, unit);\r\n    };\r\n    /**\r\n     * removes a given tableId if not needed anymore\r\n     * @param {string} tableId tableId to remove\r\n     */\r\n    GridStyleManager.prototype.remove = function (tableId) {\r\n        var selectors = tableCSSClasses(tableId);\r\n        this.deleteRule(\"__heightsRule\" + selectors.tr);\r\n        this.deleteRule(\"__heightsRule\" + selectors.tbody);\r\n        var prefix = \"__col\" + selectors.td + \"_\";\r\n        var rules = this.ruleNames.reduce(function (a, b) { return a + (b.startsWith(prefix) ? 1 : 0); }, 0);\r\n        // reset\r\n        for (var i = 0; i < rules; i += 1) {\r\n            this.deleteRule(\"\" + prefix + i);\r\n        }\r\n    };\r\n    GridStyleManager.prototype.updateColumns = function (columns, padding, cssSelectors, frozenShift, unit) {\r\n        var _this = this;\r\n        if (unit === void 0) { unit = 'px'; }\r\n        var prefix = \"__col\" + cssSelectors.td + \"_\";\r\n        var rules = new Set(this.ruleNames.filter(function (d) { return d.startsWith(prefix); }));\r\n        var acc = 0;\r\n        columns.forEach(function (c, i) {\r\n            var th = \".\" + cssSelectors.th + \"[data-id=\\\"\" + c.id + \"\\\"]\";\r\n            var thStyles = {\r\n                width: \"\" + c.width + unit,\r\n            };\r\n            var td = \".\" + cssSelectors.td + \"[data-id=\\\"\" + c.id + \"\\\"]\";\r\n            var tdStyles = {\r\n                transform: \"translateX(\" + acc + unit + \")\",\r\n                width: \"\" + c.width + unit,\r\n            };\r\n            if (c.frozen) {\r\n                thStyles.left = acc + \"px\";\r\n                _this.updateRule(\"\" + prefix + td + \"F\", \".\" + cssSelectors.td + \".\" + CSS_CLASS_SHIFTED + \"[data-id=\\\"\" + c.id + \"\\\"]\", {\r\n                    transform: \"translateX(0)\",\r\n                    left: \"\" + (acc + frozenShift) + unit,\r\n                });\r\n                rules.delete(\"\" + prefix + td + \"F\");\r\n            }\r\n            _this.updateRule(\"\" + prefix + th, th, thStyles);\r\n            rules.delete(\"\" + prefix + th);\r\n            _this.updateRule(\"\" + prefix + td, td, tdStyles);\r\n            rules.delete(\"\" + prefix + td);\r\n            acc += c.width + padding(i);\r\n        });\r\n        rules.forEach(function (d) { return _this.deleteRule(d); });\r\n    };\r\n    return GridStyleManager;\r\n}(StyleManager));\r\nexport default GridStyleManager;\r\n/**\r\n * measure the width and height of the scrollbars\r\n * based on Slick grid implementation\r\n * @param root\r\n */\r\nfunction measureScrollbar(root) {\r\n    var _a;\r\n    var body = (_a = root.ownerDocument) === null || _a === void 0 ? void 0 : _a.body;\r\n    if (!body) {\r\n        return { width: 10, height: 10 };\r\n    }\r\n    body.insertAdjacentHTML('beforeend', \"<div class=\\\"\" + CSS_CLASS_SCROLLBAR_TESTER + \"\\\"><div></div></div>\");\r\n    var elem = body.lastElementChild;\r\n    var width = elem.offsetWidth - elem.clientWidth;\r\n    var height = elem.offsetHeight - elem.clientHeight;\r\n    elem.remove();\r\n    return { width: width, height: height };\r\n}\r\n//# sourceMappingURL=GridStyleManager.js.map","var __spreadArray = (this && this.__spreadArray) || function (to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n};\r\nimport { setTransform } from '../ARowRenderer';\r\nimport { addScroll, defaultMode } from '../internal';\r\nimport { GridStyleManager, tableCSSClasses, tableIds } from '../style';\r\nimport { cssClass, CSS_CLASS_BODY, CSS_CLASS_FOOTER, CSS_CLASS_HEADER, CSS_CLASS_MULTI, CSS_CLASS_TBODY, CSS_CLASS_THEAD, } from '../styles';\r\n/**\r\n * manager of multiple columns separated by separators each an own row renderer\r\n */\r\nvar MultiTableRowRenderer = /** @class */ (function () {\r\n    function MultiTableRowRenderer(node, htmlId, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        this.node = node;\r\n        this.tableId = 0;\r\n        this.sections = [];\r\n        this.options = {\r\n            columnPadding: 0,\r\n            async: defaultMode,\r\n            minScrollDelta: 30,\r\n        };\r\n        Object.assign(this.options, options);\r\n        var cleanHTMLId = htmlId.startsWith('#') ? htmlId.slice(1) : htmlId;\r\n        // eslint-disable-next-line no-param-reassign\r\n        node.id = cleanHTMLId;\r\n        // eslint-disable-next-line no-param-reassign\r\n        node.innerHTML = \"<header id=\\\"header-\" + cleanHTMLId + \"\\\" class=\\\"\" + CSS_CLASS_HEADER + \" \" + cssClass(\"header-\" + cleanHTMLId) + \"\\\">\\n      <footer class=\\\"\" + CSS_CLASS_FOOTER + \" \" + cssClass(\"footer-\" + cleanHTMLId) + \"\\\">&nbsp;</footer>\\n    </header>\\n    <main id=\\\"body-\" + cleanHTMLId + \"\\\" class=\\\"\" + CSS_CLASS_BODY + \" \" + cssClass(\"body-\" + cleanHTMLId) + \"\\\">\\n      <footer class=\\\"\" + CSS_CLASS_FOOTER + \"\\\">&nbsp;</footer>\\n    </main>\";\r\n        node.classList.add(cssClass(), CSS_CLASS_MULTI, 'lineup-engine');\r\n        this.style = new GridStyleManager(this.node, cleanHTMLId);\r\n        var old = addScroll(this.main, this.options.async, function (act) {\r\n            if (Math.abs(old.left - act.left) < _this.options.minScrollDelta &&\r\n                Math.abs(old.width - act.width) < _this.options.minScrollDelta) {\r\n                return;\r\n            }\r\n            var isGoingRight = act.left > old.left;\r\n            old = act;\r\n            _this.onScrolledHorizontally(act.left, act.width, isGoingRight);\r\n        });\r\n    }\r\n    MultiTableRowRenderer.prototype.update = function () {\r\n        var _this = this;\r\n        this.onScrolledHorizontally(this.main.scrollLeft, this.main.clientWidth, false);\r\n        var offset = 0;\r\n        this.sections.forEach(function (s) {\r\n            // eslint-disable-next-line no-param-reassign\r\n            s.body.style.left = offset + \"px\";\r\n            // eslint-disable-next-line no-param-reassign\r\n            s.header.style.left = offset + \"px\";\r\n            offset += s.width + _this.options.columnPadding;\r\n        });\r\n    };\r\n    MultiTableRowRenderer.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var _this = this;\r\n        var offset = 0;\r\n        var scrollEnd = scrollLeft + clientWidth;\r\n        this.sections.forEach(function (s) {\r\n            var end = offset + s.width;\r\n            if (end < scrollLeft || offset > scrollEnd) {\r\n                s.hide();\r\n            }\r\n            else {\r\n                s.show(Math.max(0, scrollLeft - offset), Math.min(scrollEnd - offset, s.width), isGoingRight);\r\n            }\r\n            offset = end + _this.options.columnPadding;\r\n        });\r\n        this.updateOffset();\r\n    };\r\n    MultiTableRowRenderer.prototype.updateOffset = function () {\r\n        var _this = this;\r\n        var headerFooter = this.header.getElementsByTagName('footer')[0];\r\n        var bodyFooter = this.main.getElementsByTagName('footer')[0];\r\n        var maxHeight = this.sections.reduce(function (acc, d) { return Math.max(acc, d.height); }, 0);\r\n        var total = this.sections.reduce(function (a, c) { return a + c.width + _this.options.columnPadding; }, 0);\r\n        setTransform(headerFooter, total, 0);\r\n        setTransform(bodyFooter, total, maxHeight);\r\n    };\r\n    MultiTableRowRenderer.prototype.destroy = function () {\r\n        this.sections.forEach(function (d) { return d.destroy(); });\r\n        this.node.remove();\r\n    };\r\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"doc\", {\r\n        get: function () {\r\n            return this.node.ownerDocument;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"header\", {\r\n        get: function () {\r\n            return this.node.getElementsByTagName('header')[0];\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MultiTableRowRenderer.prototype, \"main\", {\r\n        get: function () {\r\n            return this.node.getElementsByTagName('main')[0];\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * push another table to this instance\r\n     * @param {ITableFactory<T extends ITableSection>} factory factory for the table\r\n     * @param extras additional arguments to provide for the factory\r\n     * @returns {T} the table instance\r\n     */\r\n    MultiTableRowRenderer.prototype.pushTable = function (factory) {\r\n        var extras = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            extras[_i - 1] = arguments[_i];\r\n        }\r\n        var header = this.doc.createElement('article');\r\n        var body = this.doc.createElement('article');\r\n        var tableId = this.node.id + \"T\" + this.tableId;\r\n        this.tableId += 1;\r\n        var ids = tableIds(tableId);\r\n        var cssClasses = tableCSSClasses(tableId);\r\n        header.id = ids.thead;\r\n        header.classList.add(CSS_CLASS_THEAD, cssClasses.thead);\r\n        body.id = ids.tbody;\r\n        body.classList.add(CSS_CLASS_TBODY, cssClasses.tbody);\r\n        this.header.insertBefore(header, this.header.lastElementChild); // before the footer\r\n        this.main.appendChild(body);\r\n        var table = factory.call.apply(factory, __spreadArray([this, header, body, tableId, this.style], extras));\r\n        table.init();\r\n        this.sections.push(table);\r\n        this.update();\r\n        return table;\r\n    };\r\n    /**\r\n     * push another separator to the manager\r\n     * @param {ISeparatorFactory<T extends ITableSection>} factory the factory to create the separator\r\n     * @param extras optional additional arguments\r\n     * @returns {T} the new created separator\r\n     */\r\n    MultiTableRowRenderer.prototype.pushSeparator = function (factory) {\r\n        var extras = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            extras[_i - 1] = arguments[_i];\r\n        }\r\n        var header = this.doc.createElement('section');\r\n        var body = this.doc.createElement('section');\r\n        header.classList.add(cssClass('header-separator'));\r\n        body.classList.add(cssClass('separator'));\r\n        this.header.insertBefore(header, this.header.lastElementChild); // before the footer\r\n        this.main.appendChild(body);\r\n        var separator = factory.call.apply(factory, __spreadArray([this, header, body, this.style], extras));\r\n        separator.init();\r\n        this.sections.push(separator);\r\n        this.update();\r\n        return separator;\r\n    };\r\n    /**\r\n     * removes a given table section\r\n     * @param {ITableSection} section section to remove\r\n     * @returns {boolean} successful flag\r\n     */\r\n    MultiTableRowRenderer.prototype.remove = function (section) {\r\n        var index = this.sections.indexOf(section);\r\n        if (index < 0) {\r\n            return false;\r\n        }\r\n        this.sections.splice(index, 1);\r\n        section.destroy();\r\n        this.update();\r\n        return true;\r\n    };\r\n    MultiTableRowRenderer.prototype.clear = function () {\r\n        this.sections.splice(0, this.sections.length).forEach(function (s) { return s.destroy(); });\r\n        this.update();\r\n    };\r\n    /**\r\n     * triggers and update because of a change in width of one or more table sections\r\n     */\r\n    MultiTableRowRenderer.prototype.widthChanged = function () {\r\n        this.update();\r\n    };\r\n    return MultiTableRowRenderer;\r\n}());\r\nexport default MultiTableRowRenderer;\r\n//# sourceMappingURL=MultiTableRowRenderer.js.map","import { range } from '../logic';\r\nimport { EScrollResult } from './IMixin';\r\n/**\r\n * mixin that prefetches rows depending on the scrolling direction for faster rendering\r\n */\r\nvar PrefetchMixin = /** @class */ (function () {\r\n    function PrefetchMixin(adapter, options) {\r\n        this.adapter = adapter;\r\n        this.prefetchTimeout = -1;\r\n        this.cleanupTimeout = -1;\r\n        this.options = {\r\n            prefetchRows: 20,\r\n            cleanUpRows: 10,\r\n            delay: 200,\r\n        };\r\n        Object.assign(this.options, options);\r\n        return this;\r\n    }\r\n    PrefetchMixin.prototype.prefetchDown = function () {\r\n        this.prefetchTimeout = -1;\r\n        if (this.adapter.isScrollEventWaiting()) {\r\n            return;\r\n        }\r\n        var context = this.adapter.context;\r\n        var nextLast = Math.min(this.adapter.visible.forcedLast + this.options.prefetchRows, context.numberOfRows - 1);\r\n        // add some rows in advance\r\n        if (this.adapter.visible.last === nextLast &&\r\n            this.adapter.visible.last >= this.adapter.visible.forcedLast + this.options.prefetchRows) {\r\n            return;\r\n        }\r\n        this.adapter.addAtBottom(this.adapter.visible.last + 1, nextLast);\r\n        // console.log('prefetch', visibleFirst, visibleLast + 1, '=>', nextLast, ranking.children.length);\r\n        this.adapter.visible.last = nextLast;\r\n    };\r\n    PrefetchMixin.prototype.prefetchUp = function () {\r\n        this.prefetchTimeout = -1;\r\n        if (this.adapter.isScrollEventWaiting() ||\r\n            this.adapter.visible.first <= this.adapter.visible.forcedFirst - this.options.prefetchRows) {\r\n            return;\r\n        }\r\n        var context = this.adapter.context;\r\n        var fakeOffset = Math.max(this.adapter.scrollOffset - this.options.prefetchRows * context.defaultRowHeight, 0);\r\n        var height = this.adapter.scrollTotal;\r\n        var _a = range(fakeOffset, height, context.defaultRowHeight, context.exceptions, context.numberOfRows), first = _a.first, firstRowPos = _a.firstRowPos;\r\n        if (first === this.adapter.visible.first) {\r\n            return;\r\n        }\r\n        var frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(first) : 0;\r\n        this.adapter.addAtBeginning(first, this.adapter.visible.first - 1, frozenShift);\r\n        // console.log('prefetch up ', visibleFirst, '=>', first, visibleLast, ranking.children.length);\r\n        this.adapter.visible.first = first;\r\n        this.adapter.updateOffset(firstRowPos);\r\n    };\r\n    PrefetchMixin.prototype.triggerPrefetch = function (isGoingDown) {\r\n        if (this.prefetchTimeout >= 0) {\r\n            clearTimeout(this.prefetchTimeout);\r\n        }\r\n        var prefetchDownPossible = this.adapter.visible.last < this.adapter.visible.forcedLast + this.options.prefetchRows;\r\n        var prefetchUpPossible = this.adapter.visible.first > this.adapter.visible.forcedFirst - this.options.prefetchRows;\r\n        var isLast = this.adapter.visible.last === this.adapter.context.numberOfRows;\r\n        var isFirst = this.adapter.visible.first === 0;\r\n        if ((isGoingDown && !prefetchDownPossible && !isLast) || (!isGoingDown && !prefetchUpPossible && !isFirst)) {\r\n            return;\r\n        }\r\n        // go down if we are already at the top, too\r\n        var op = isGoingDown || isFirst ? this.prefetchDown.bind(this) : this.prefetchUp.bind(this);\r\n        // eslint-disable-next-line no-restricted-globals\r\n        this.prefetchTimeout = self.setTimeout(op, this.options.delay);\r\n    };\r\n    PrefetchMixin.prototype.cleanUpTop = function (first) {\r\n        this.cleanupTimeout = -1;\r\n        if (this.adapter.isScrollEventWaiting()) {\r\n            return;\r\n        }\r\n        var newFirst = Math.max(0, first - this.options.cleanUpRows);\r\n        if (newFirst <= this.adapter.visible.first) {\r\n            return;\r\n        }\r\n        // console.log('cleanup top');\r\n        var frozenShift = this.adapter.syncFrozen ? this.adapter.syncFrozen(newFirst) : 0;\r\n        this.adapter.removeFromBeginning(this.adapter.visible.first, newFirst - 1, frozenShift);\r\n        var context = this.adapter.context;\r\n        // console.log('cleanup up ', visibleFirst, '=>', newFirst, visibleLast, ranking.children.length);\r\n        var shift = (newFirst - this.adapter.visible.first) * context.defaultRowHeight;\r\n        if (context.exceptions.length > 0) {\r\n            for (var i = this.adapter.visible.first; i < newFirst; i += 1) {\r\n                var ex = context.exceptionsLookup.get(i);\r\n                if (ex != null) {\r\n                    shift += ex - context.defaultRowHeight;\r\n                }\r\n            }\r\n        }\r\n        this.adapter.visible.first = newFirst;\r\n        this.adapter.updateOffset(this.adapter.visibleFirstRowPos + shift);\r\n        this.prefetchDown();\r\n    };\r\n    PrefetchMixin.prototype.cleanUpBottom = function (last) {\r\n        this.cleanupTimeout = -1;\r\n        var newLast = last + this.options.cleanUpRows;\r\n        if (this.adapter.visible.last <= newLast) {\r\n            return;\r\n        }\r\n        // console.log('cleanup bottom');\r\n        this.adapter.removeFromBottom(newLast + 1, this.adapter.visible.last);\r\n        this.adapter.visible.last = newLast;\r\n        this.prefetchUp();\r\n    };\r\n    PrefetchMixin.prototype.triggerCleanUp = function (first, last, isGoingDown) {\r\n        if (this.cleanupTimeout >= 0) {\r\n            clearTimeout(this.cleanupTimeout);\r\n        }\r\n        if ((isGoingDown && first - this.options.cleanUpRows <= this.adapter.visible.first) ||\r\n            (!isGoingDown && this.adapter.visible.last <= last + this.options.cleanUpRows)) {\r\n            return;\r\n        }\r\n        // eslint-disable-next-line no-restricted-globals\r\n        this.cleanupTimeout = self.setTimeout(isGoingDown ? this.cleanUpTop.bind(this) : this.cleanUpBottom.bind(this), this.options.delay, isGoingDown ? first : last);\r\n    };\r\n    PrefetchMixin.prototype.onScrolled = function (isGoingDown, scrollResult) {\r\n        if (this.adapter.isScrollEventWaiting()) {\r\n            return;\r\n        }\r\n        if (scrollResult !== EScrollResult.ALL && this.options.cleanUpRows > 0) {\r\n            this.triggerCleanUp(this.adapter.visible.forcedFirst, this.adapter.visible.forcedLast, isGoingDown);\r\n        }\r\n        if (scrollResult !== EScrollResult.NONE && this.options.prefetchRows > 0) {\r\n            this.triggerPrefetch(isGoingDown);\r\n        }\r\n    };\r\n    return PrefetchMixin;\r\n}());\r\nexport default PrefetchMixin;\r\n//# sourceMappingURL=PrefetchMixin.js.map","import { ABORTED, isAbortAble, isAsyncUpdate } from '../../abortAble';\r\nimport { isLoadingCell } from '../../ARowRenderer';\r\nimport { clear } from '../../internal';\r\nimport { isScrollEventWaiting } from '../../internal/scroll';\r\nimport { range, updateFrozen } from '../../logic';\r\nimport { EScrollResult } from '../../mixin';\r\nimport { cssClass, CSS_CLASS_FROZEN, CSS_CLASS_LOADING, CSS_CLASS_SHIFTED, CSS_CLASS_TD, CSS_CLASS_TH, } from '../../styles';\r\n/**\r\n * @internal\r\n */\r\nvar ACellAdapter = /** @class */ (function () {\r\n    function ACellAdapter(header, style, tableId, mixinClasses) {\r\n        var _this = this;\r\n        if (mixinClasses === void 0) { mixinClasses = []; }\r\n        this.header = header;\r\n        this.style = style;\r\n        this.tableId = tableId;\r\n        /**\r\n         * pool of cells per column\r\n         * @type {Array}\r\n         */\r\n        this.cellPool = [];\r\n        this.loading = new WeakMap();\r\n        this.visibleColumns = {\r\n            frozen: [],\r\n            first: 0,\r\n            forcedFirst: 0,\r\n            last: -1,\r\n            forcedLast: -1,\r\n        };\r\n        this.visibleFirstColumnPos = 0;\r\n        this.horizontallyShifted = false;\r\n        this.columnAdapter = this.createColumnAdapter();\r\n        this.columnMixins = mixinClasses.map(function (MixinClass) { return new MixinClass(_this.columnAdapter); });\r\n        this.columnFragment = header.ownerDocument.createDocumentFragment();\r\n    }\r\n    ACellAdapter.prototype.leftShift = function () {\r\n        var ctx = this.context;\r\n        var frozen = this.visibleColumns.frozen.reduce(function (a, d) { return a + ctx.columns[d].width + ctx.column.padding(d); }, 0);\r\n        return this.visibleFirstColumnPos - frozen;\r\n    };\r\n    Object.defineProperty(ACellAdapter.prototype, \"headerScroller\", {\r\n        get: function () {\r\n            return this.header.parentElement;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ACellAdapter.prototype.addColumnMixin = function (MixinClass, options) {\r\n        this.columnMixins.push(new MixinClass(this.columnAdapter, options));\r\n    };\r\n    ACellAdapter.prototype.createColumnAdapter = function () {\r\n        var _this = this;\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var that = this;\r\n        var r = {\r\n            visible: this.visibleColumns,\r\n            addAtBeginning: this.addColumnAtStart.bind(this),\r\n            addAtBottom: this.addColumnAtEnd.bind(this),\r\n            removeFromBeginning: this.removeColumnFromStart.bind(this),\r\n            removeFromBottom: this.removeColumnFromEnd.bind(this),\r\n            updateOffset: this.updateColumnOffset.bind(this),\r\n            scroller: this.headerScroller,\r\n            syncFrozen: this.syncFrozen.bind(this),\r\n            isScrollEventWaiting: function () { return isScrollEventWaiting(_this.headerScroller, 'animation'); },\r\n            get visibleFirstRowPos() {\r\n                return that.visibleFirstColumnPos;\r\n            },\r\n            get context() {\r\n                return that.context.column;\r\n            },\r\n            get scrollOffset() {\r\n                return that.lastScrollInfo ? that.lastScrollInfo.left : 0;\r\n            },\r\n            get scrollTotal() {\r\n                return that.lastScrollInfo ? that.lastScrollInfo.width : that.headerScroller.clientWidth;\r\n            },\r\n        };\r\n        return r;\r\n    };\r\n    ACellAdapter.prototype.init = function () {\r\n        var _this = this;\r\n        var context = this.context;\r\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\r\n        context.columns.forEach(function () {\r\n            // init pool\r\n            _this.cellPool.push([]);\r\n        });\r\n    };\r\n    ACellAdapter.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var scrollResult = this.onScrolledHorizontallyImpl(scrollLeft, clientWidth);\r\n        for (var _i = 0, _a = this.columnMixins; _i < _a.length; _i++) {\r\n            var mixin = _a[_i];\r\n            mixin.onScrolled(isGoingRight, scrollResult);\r\n        }\r\n        return scrollResult;\r\n    };\r\n    ACellAdapter.prototype.removeColumnFromStart = function (from, to, frozenShift) {\r\n        var _this = this;\r\n        if (frozenShift === void 0) { frozenShift = this.visibleColumns.frozen.length; }\r\n        this.forEachRow(function (row) {\r\n            _this.removeCellFromStart(row, from, to, frozenShift);\r\n        });\r\n        // if (debug) {\r\n        //   this.verifyRows();\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.removeCellFromStart = function (row, from, to, frozenShift) {\r\n        for (var i = from; i <= to; i += 1) {\r\n            var node = (frozenShift === 0 ? row.firstElementChild : row.children[frozenShift]);\r\n            node.remove();\r\n            this.recycleCell(node, i);\r\n        }\r\n        // if (debug) {\r\n        //   verifyRow(row, -1, this.context.columns);\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.removeColumnFromEnd = function (from, to) {\r\n        var _this = this;\r\n        this.forEachRow(function (row) {\r\n            _this.removeCellFromEnd(row, from, to);\r\n        });\r\n        // if (debug) {\r\n        //   this.verifyRows();\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.removeCellFromEnd = function (row, from, to) {\r\n        for (var i = to; i >= from; i -= 1) {\r\n            var node = row.lastElementChild;\r\n            node.remove();\r\n            this.recycleCell(node, i);\r\n        }\r\n        // if (debug) {\r\n        //   verifyRow(row, -1, this.context.columns);\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.removeFrozenCells = function (row, columnIndices, shift) {\r\n        for (var _i = 0, columnIndices_1 = columnIndices; _i < columnIndices_1.length; _i++) {\r\n            var columnIndex = columnIndices_1[_i];\r\n            var node = row.children[shift];\r\n            node.remove();\r\n            this.recycleCell(node, columnIndex);\r\n        }\r\n        // if (debug) {\r\n        //   verifyRow(row, -1, this.context.columns);\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.removeFrozenColumns = function (columnIndices, shift) {\r\n        var _this = this;\r\n        this.forEachRow(function (row) {\r\n            _this.removeFrozenCells(row, columnIndices, shift);\r\n        });\r\n        // if (debug) {\r\n        //   this.verifyRows();\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.removeAllColumns = function (includingFrozen) {\r\n        var _this = this;\r\n        this.forEachRow(function (row) {\r\n            _this.removeAllCells(row, includingFrozen);\r\n        });\r\n        // if (debug) {\r\n        //   this.verifyRows();\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.removeAllCells = function (row, includingFrozen, shift) {\r\n        var _this = this;\r\n        if (shift === void 0) { shift = this.visibleColumns.first; }\r\n        var arr = Array.from(row.children);\r\n        var frozen = this.visibleColumns.frozen;\r\n        clear(row);\r\n        if (includingFrozen || frozen.length === 0) {\r\n            for (var _i = 0, frozen_1 = frozen; _i < frozen_1.length; _i++) {\r\n                var i = frozen_1[_i];\r\n                this.recycleCell(arr.shift(), i);\r\n            }\r\n        }\r\n        else {\r\n            // have frozen and keep them, so readd them\r\n            for (var i = 0; i < frozen.length; i += 1) {\r\n                row.appendChild(arr.shift());\r\n            }\r\n        }\r\n        arr.forEach(function (item, i) {\r\n            _this.recycleCell(item, i + shift);\r\n        });\r\n        // if (debug) {\r\n        //   verifyRow(row, -1, this.context.columns);\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.selectProxyCell = function (row, column, columns) {\r\n        var pool = this.cellPool[column];\r\n        var columnObj = columns[column];\r\n        var item;\r\n        var ready;\r\n        var pooled = pool.pop();\r\n        var r = pooled\r\n            ? this.updateCell(pooled, row, columnObj) || pooled\r\n            : this.createCell(this.header.ownerDocument, row, columnObj);\r\n        if (isAsyncUpdate(r)) {\r\n            item = r.item;\r\n            ready = r.ready;\r\n        }\r\n        else {\r\n            item = r;\r\n        }\r\n        if (item !== pooled) {\r\n            item.dataset.id = columnObj.id;\r\n            item.classList.add(CSS_CLASS_TD, this.style.cssClasses.td, cssClass(\"td-\" + this.tableId));\r\n        }\r\n        this.updateShiftedState(item, columnObj);\r\n        return { item: item, ready: ready };\r\n    };\r\n    ACellAdapter.prototype.handleCellReady = function (item, ready, column) {\r\n        var _this = this;\r\n        if (column === void 0) { column = -1; }\r\n        item.classList.add(CSS_CLASS_LOADING);\r\n        var abort = ready;\r\n        // lazy loading\r\n        this.loading.set(item, abort);\r\n        abort.then(function (result) {\r\n            _this.loading.delete(item);\r\n            item.classList.remove(CSS_CLASS_LOADING);\r\n            if (result === ABORTED && column >= 0) {\r\n                // aborted can recycle the real one\r\n                _this.cellPool[column].push(item);\r\n            }\r\n        });\r\n        return item;\r\n    };\r\n    ACellAdapter.prototype.selectCell = function (row, column, columns) {\r\n        var _a = this.selectProxyCell(row, column, columns), item = _a.item, ready = _a.ready;\r\n        if (!isAbortAble(ready)) {\r\n            return item;\r\n        }\r\n        return this.handleCellReady(item, ready, column);\r\n    };\r\n    ACellAdapter.prototype.updateShiftedState = function (node, col) {\r\n        node.classList.toggle(CSS_CLASS_SHIFTED, col.frozen && this.horizontallyShifted);\r\n    };\r\n    ACellAdapter.prototype.recycleCell = function (item, column) {\r\n        if (column === void 0) { column = -1; }\r\n        // check if the dom element is still being manipulated\r\n        var abort = this.loading.get(item);\r\n        if (abort != null) {\r\n            abort.abort();\r\n        }\r\n        else if (!isLoadingCell(item) && column >= 0) {\r\n            this.cellPool[column].push(item);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.addColumnAtStart = function (from, to, frozenShift) {\r\n        var _this = this;\r\n        if (frozenShift === void 0) { frozenShift = this.visibleColumns.frozen.length; }\r\n        var columns = this.context.columns;\r\n        this.forEachRow(function (row, rowIndex) {\r\n            _this.addCellAtStart(row, rowIndex, from, to, frozenShift, columns);\r\n        });\r\n        // if (debug) {\r\n        //   this.verifyRows();\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.addCellAtStart = function (row, rowIndex, from, to, frozenShift, columns) {\r\n        // if (debug) {\r\n        //   verifyRow(row, rowIndex, this.context.columns);\r\n        // }\r\n        for (var i = to; i >= from; i -= 1) {\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            row.insertBefore(cell, frozenShift > 0 ? row.children[frozenShift] : row.firstChild);\r\n        }\r\n        // if (debug) {\r\n        //   verifyRow(row, rowIndex, this.context.columns);\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.insertFrozenCells = function (row, rowIndex, columnIndices, shift, columns) {\r\n        var before = row.children[shift];\r\n        for (var _i = 0, columnIndices_2 = columnIndices; _i < columnIndices_2.length; _i++) {\r\n            var i = columnIndices_2[_i];\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            if (before) {\r\n                row.insertBefore(cell, before);\r\n            }\r\n            else {\r\n                row.appendChild(cell);\r\n            }\r\n        }\r\n    };\r\n    ACellAdapter.prototype.insertFrozenColumns = function (columnIndices, shift) {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        this.forEachRow(function (row, rowIndex) {\r\n            _this.insertFrozenCells(row, rowIndex, columnIndices, shift, columns);\r\n        });\r\n    };\r\n    ACellAdapter.prototype.addColumnAtEnd = function (from, to) {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        this.forEachRow(function (row, rowIndex) {\r\n            _this.addCellAtEnd(row, rowIndex, from, to, columns);\r\n        });\r\n        // if (debug) {\r\n        //   this.verifyRows();\r\n        // }\r\n    };\r\n    // private verifyRows() {\r\n    //   const { columns } = this.context;\r\n    //   this.forEachRow((row, rowIndex) => verifyRow(row, rowIndex, columns));\r\n    // }\r\n    ACellAdapter.prototype.addCellAtEnd = function (row, rowIndex, from, to, columns) {\r\n        for (var i = from; i <= to; i += 1) {\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            row.appendChild(cell);\r\n        }\r\n        // if (debug) {\r\n        //   verifyRow(row, rowIndex, this.context.columns);\r\n        // }\r\n    };\r\n    ACellAdapter.prototype.updateHeaders = function () {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        Array.from(this.header.children).forEach(function (node, i) {\r\n            var base = node;\r\n            var col = columns[i];\r\n            var r = _this.updateHeader(base, col);\r\n            var n;\r\n            if (isAsyncUpdate(r)) {\r\n                n = _this.handleCellReady(r.item, r.ready, -1);\r\n            }\r\n            else {\r\n                n = r || base;\r\n            }\r\n            if (n === base) {\r\n                return;\r\n            }\r\n            n.dataset.id = col.id;\r\n            n.classList.add(CSS_CLASS_TH, _this.style.cssClasses.th, cssClass(\"th-\" + _this.tableId));\r\n            _this.header.replaceChild(base, n);\r\n        });\r\n    };\r\n    ACellAdapter.prototype.recreate = function (left, width) {\r\n        var _this = this;\r\n        var _a;\r\n        var context = this.context;\r\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\r\n        this.clearPool();\r\n        // init pool\r\n        for (var i = this.cellPool.length; i < context.columns.length; i += 1) {\r\n            this.cellPool.push([]);\r\n        }\r\n        // create all header columns\r\n        {\r\n            var fragment_1 = this.columnFragment;\r\n            var document_1 = fragment_1.ownerDocument;\r\n            // create lookup cache to reuse headers\r\n            var ids_1 = new Map();\r\n            while (this.header.lastChild) {\r\n                var c = this.header.lastChild;\r\n                this.header.removeChild(c);\r\n                ids_1.set((_a = c.dataset.id) !== null && _a !== void 0 ? _a : '', c);\r\n            }\r\n            context.columns.forEach(function (col) {\r\n                var existing = ids_1.get(col.id);\r\n                var r = existing ? _this.updateHeader(existing, col) || existing : _this.createHeader(document_1, col);\r\n                var n;\r\n                if (isAsyncUpdate(r)) {\r\n                    n = _this.handleCellReady(r.item, r.ready, -1);\r\n                }\r\n                else {\r\n                    n = r;\r\n                }\r\n                if (n !== existing) {\r\n                    n.dataset.id = col.id;\r\n                    n.classList.add(CSS_CLASS_TH, _this.style.cssClasses.th, cssClass(\"th-\" + _this.tableId));\r\n                }\r\n                fragment_1.appendChild(n);\r\n            });\r\n            this.header.appendChild(fragment_1);\r\n        }\r\n        var _b = range(left, width, context.column.defaultRowHeight, context.column.exceptions, context.column.numberOfRows), first = _b.first, last = _b.last, firstRowPos = _b.firstRowPos;\r\n        this.visibleColumns.first = first;\r\n        this.visibleColumns.forcedFirst = first;\r\n        this.visibleColumns.last = last;\r\n        this.visibleColumns.forcedLast = last;\r\n        if (context.columns.some(function (c) { return c.frozen; })) {\r\n            var target = updateFrozen([], context.columns, first).target;\r\n            this.visibleColumns.frozen = target;\r\n        }\r\n        else {\r\n            this.visibleColumns.frozen = [];\r\n        }\r\n        this.updateColumnOffset(firstRowPos);\r\n    };\r\n    ACellAdapter.prototype.clearPool = function () {\r\n        this.cellPool.forEach(function (p) { return p.splice(0, p.length); });\r\n    };\r\n    ACellAdapter.prototype.updateColumnOffset = function (firstColumnPos) {\r\n        var changed = firstColumnPos !== this.visibleFirstColumnPos;\r\n        this.visibleFirstColumnPos = firstColumnPos;\r\n        if (changed) {\r\n            var context = this.context;\r\n            this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.createRow = function (node, rowIndex) {\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        if (visible.frozen.length > 0) {\r\n            for (var _i = 0, _a = visible.frozen; _i < _a.length; _i++) {\r\n                var i = _a[_i];\r\n                var cell = this.selectCell(rowIndex, i, columns);\r\n                node.appendChild(cell);\r\n            }\r\n        }\r\n        for (var i = visible.first; i <= visible.last; i += 1) {\r\n            var cell = this.selectCell(rowIndex, i, columns);\r\n            node.appendChild(cell);\r\n        }\r\n    };\r\n    ACellAdapter.prototype.updateRow = function (node, rowIndex) {\r\n        var _a;\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        // columns may not match anymore if it is a pooled item a long time ago\r\n        switch (node.childElementCount) {\r\n            case 0:\r\n                if (visible.frozen.length > 0) {\r\n                    this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\r\n                }\r\n                this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\r\n                break;\r\n            case 1: {\r\n                var old = node.firstElementChild;\r\n                var id_1 = (_a = old.dataset.id) !== null && _a !== void 0 ? _a : '';\r\n                var columnIndex = columns.findIndex(function (c) { return c.id === id_1; });\r\n                node.removeChild(old);\r\n                if (columnIndex >= 0) {\r\n                    this.recycleCell(old, columnIndex);\r\n                }\r\n                if (visible.frozen.length > 0) {\r\n                    this.insertFrozenCells(node, rowIndex, visible.frozen, 0, columns);\r\n                }\r\n                this.addCellAtEnd(node, rowIndex, visible.first, visible.last, columns);\r\n                break;\r\n            }\r\n            default:\r\n                this.mergeColumns(node, rowIndex);\r\n                break;\r\n        }\r\n    };\r\n    ACellAdapter.prototype.mergeColumns = function (node, rowIndex) {\r\n        var _this = this;\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        var ids = new Map();\r\n        while (node.lastChild) {\r\n            var c = node.lastChild;\r\n            node.removeChild(c);\r\n            ids.set(c.dataset.id, c);\r\n        }\r\n        var updateImpl = function (i) {\r\n            var col = columns[i];\r\n            var existing = ids.get(col.id);\r\n            if (!existing) {\r\n                var cell_1 = _this.selectCell(rowIndex, i, columns);\r\n                node.appendChild(cell_1);\r\n                return;\r\n            }\r\n            ids.delete(col.id);\r\n            var r = _this.updateCell(existing, rowIndex, col) || existing;\r\n            var cell;\r\n            if (isAsyncUpdate(r)) {\r\n                cell = _this.handleCellReady(r.item, r.ready, i);\r\n            }\r\n            else {\r\n                cell = r;\r\n            }\r\n            if (cell && cell !== existing) {\r\n                cell.dataset.id = col.id;\r\n                cell.classList.add(CSS_CLASS_TD, _this.style.cssClasses.td, cssClass(\"td-\" + _this.tableId));\r\n            }\r\n            _this.updateShiftedState(cell, col);\r\n            node.appendChild(cell);\r\n        };\r\n        for (var _i = 0, _a = visible.frozen; _i < _a.length; _i++) {\r\n            var frozen = _a[_i];\r\n            updateImpl(frozen);\r\n        }\r\n        for (var i = visible.first; i <= visible.last; i += 1) {\r\n            updateImpl(i);\r\n        }\r\n        if (ids.size === 0) {\r\n            return;\r\n        }\r\n        // recycle\r\n        var byId = new Map(columns.map(function (d, i) { return [d.id, i]; }));\r\n        ids.forEach(function (idNode, key) {\r\n            var index = byId.get(key);\r\n            if (index != null && index >= 0) {\r\n                _this.recycleCell(idNode, index);\r\n            }\r\n        });\r\n    };\r\n    ACellAdapter.prototype.updateShiftedStates = function () {\r\n        if (!this.context.columns.some(function (d) { return d.frozen; })) {\r\n            return;\r\n        }\r\n        var shifted = this.horizontallyShifted;\r\n        var clazz = CSS_CLASS_SHIFTED;\r\n        if (shifted) {\r\n            var headers = Array.from(this.header.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \":not(.\" + clazz + \")\"));\r\n            var bodies = Array.from(this.body.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \":not(.\" + clazz + \")\"));\r\n            for (var _i = 0, headers_1 = headers; _i < headers_1.length; _i++) {\r\n                var item = headers_1[_i];\r\n                item.classList.add(clazz);\r\n            }\r\n            for (var _a = 0, bodies_1 = bodies; _a < bodies_1.length; _a++) {\r\n                var item = bodies_1[_a];\r\n                item.classList.add(clazz);\r\n            }\r\n        }\r\n        else {\r\n            var headers = Array.from(this.header.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \".\" + clazz));\r\n            var bodies = Array.from(this.body.querySelectorAll(\".\" + CSS_CLASS_FROZEN + \".\" + clazz));\r\n            for (var _b = 0, headers_2 = headers; _b < headers_2.length; _b++) {\r\n                var item = headers_2[_b];\r\n                item.classList.remove(clazz);\r\n            }\r\n            for (var _c = 0, bodies_2 = bodies; _c < bodies_2.length; _c++) {\r\n                var item = bodies_2[_c];\r\n                item.classList.remove(clazz);\r\n            }\r\n        }\r\n    };\r\n    ACellAdapter.prototype.syncFrozen = function (first) {\r\n        var columns = this.context.columns;\r\n        var visible = this.visibleColumns;\r\n        if (!columns.some(function (d) { return d.frozen; })) {\r\n            return 0;\r\n        }\r\n        if (first === 0) {\r\n            if (visible.frozen.length > 0) {\r\n                this.removeFrozenColumns(visible.frozen, 0);\r\n                visible.frozen = [];\r\n            }\r\n            return 0;\r\n        }\r\n        var old = visible.frozen.length;\r\n        var _a = updateFrozen(visible.frozen, columns, first), target = _a.target, added = _a.added, removed = _a.removed;\r\n        if (removed.length > 0) {\r\n            this.removeFrozenColumns(removed, old - removed.length);\r\n        }\r\n        if (added.length > 0) {\r\n            this.insertFrozenColumns(added, old - removed.length);\r\n        }\r\n        visible.frozen = target;\r\n        return target.length;\r\n    };\r\n    ACellAdapter.prototype.onScrolledHorizontallyImpl = function (scrollLeft, clientWidth) {\r\n        var shiftingChanged = this.horizontallyShifted !== scrollLeft > 0;\r\n        this.horizontallyShifted = scrollLeft > 0;\r\n        var column = this.context.column;\r\n        var _a = range(scrollLeft, clientWidth, column.defaultRowHeight, column.exceptions, column.numberOfRows), first = _a.first, last = _a.last, firstRowPos = _a.firstRowPos;\r\n        var visible = this.visibleColumns;\r\n        visible.forcedFirst = first;\r\n        visible.forcedLast = last;\r\n        if (first - visible.first >= 0 && last - visible.last <= 0) {\r\n            // nothing to do\r\n            if (shiftingChanged) {\r\n                this.updateShiftedStates();\r\n            }\r\n            return EScrollResult.NONE;\r\n        }\r\n        var r = EScrollResult.SOME;\r\n        var frozenShift = this.syncFrozen(first);\r\n        if (first > visible.last || last < visible.first) {\r\n            // no overlap, clean and draw everything\r\n            // console.log(\r\n            //   `ff added: ${last - first + 1} removed: ${visible.last - visible.first + 1} ${first}:${last} ${frozenShift}`\r\n            // );\r\n            // removeRows(visibleFirst, visibleLast);\r\n            this.removeAllColumns(false);\r\n            // this.updateShiftedStates();\r\n            this.addColumnAtEnd(first, last);\r\n            r = EScrollResult.ALL;\r\n        }\r\n        else if (first < visible.first) {\r\n            // some first rows missing and some last rows to much\r\n            // console.log(\r\n            //   `up added: ${visible.first - first + 1} removed: ${visible.last - last + 1} ${first}:${last} ${frozenShift}`\r\n            // );\r\n            this.removeColumnFromEnd(last + 1, visible.last);\r\n            this.updateShiftedStates();\r\n            this.addColumnAtStart(first, visible.first - 1, frozenShift);\r\n            r = EScrollResult.SOME_TOP;\r\n        }\r\n        else {\r\n            // console.log(\r\n            //   `do added: ${last - visible.last + 1} removed: ${first - visible.first + 1} ${first}:${last} ${frozenShift}`\r\n            // );\r\n            // some last rows missing and some first rows to much\r\n            this.removeColumnFromStart(visible.first, first - 1, frozenShift);\r\n            this.updateShiftedStates();\r\n            this.addColumnAtEnd(visible.last + 1, last);\r\n            r = EScrollResult.SOME_BOTTOM;\r\n        }\r\n        visible.first = first;\r\n        visible.last = last;\r\n        this.updateColumnOffset(firstRowPos);\r\n        return r;\r\n    };\r\n    return ACellAdapter;\r\n}());\r\nexport { ACellAdapter };\r\n/**\r\n * @internal\r\n */\r\nexport default ACellAdapter;\r\n// function verifyRow(row: HTMLElement, index: number, columns: IColumn[]) {\r\n//   const cols = Array.from(row.children) as HTMLElement[];\r\n//   // sort incrementally\r\n//   if (cols.length <= 1) {\r\n//     return;\r\n//   }\r\n//   const colObjs = cols.map((c) => columns.find((d) => d.id === c.dataset.id));\r\n//   console.assert(\r\n//     colObjs.every((d) => Boolean(d)),\r\n//     'all columns must exist',\r\n//     index\r\n//   );\r\n//   console.assert(\r\n//     colObjs.every((d, i) => i === 0 || d.index >= colObjs[i - 1]!.index),\r\n//     'all columns in ascending order',\r\n//     index\r\n//   );\r\n//   console.assert(new Set(colObjs).size === colObjs.length, 'unique columns', colObjs);\r\n// }\r\n//# sourceMappingURL=ACellAdapter.js.map","var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { ARowRenderer, setTransform } from '../ARowRenderer';\r\nimport { EScrollResult } from '../mixin';\r\nimport { CSS_CLASS_HIDDEN, CSS_CLASS_LOADING } from '../styles';\r\nimport { ACellAdapter } from './internal/ACellAdapter';\r\n/**\r\n * base class for a cell renderer as table section\r\n */\r\nvar ACellTableSection = /** @class */ (function (_super) {\r\n    __extends(ACellTableSection, _super);\r\n    function ACellTableSection(header, body, tableId, style, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = _super.call(this, body, options) || this;\r\n        _this.header = header;\r\n        _this.body = body;\r\n        _this.tableId = tableId;\r\n        _this.style = style;\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var that = _this;\r\n        var LocalCell = /** @class */ (function (_super) {\r\n            __extends(LocalCell, _super);\r\n            function LocalCell() {\r\n                return _super !== null && _super.apply(this, arguments) || this;\r\n            }\r\n            Object.defineProperty(LocalCell.prototype, \"context\", {\r\n                get: function () {\r\n                    return that.context;\r\n                },\r\n                enumerable: false,\r\n                configurable: true\r\n            });\r\n            Object.defineProperty(LocalCell.prototype, \"body\", {\r\n                get: function () {\r\n                    return that.body;\r\n                },\r\n                enumerable: false,\r\n                configurable: true\r\n            });\r\n            Object.defineProperty(LocalCell.prototype, \"lastScrollInfo\", {\r\n                get: function () {\r\n                    return that.lastScrollInfo;\r\n                },\r\n                enumerable: false,\r\n                configurable: true\r\n            });\r\n            LocalCell.prototype.createHeader = function (document, column) {\r\n                return that.createHeader(document, column);\r\n            };\r\n            LocalCell.prototype.updateHeader = function (node, column) {\r\n                return that.updateHeader(node, column);\r\n            };\r\n            LocalCell.prototype.createCell = function (document, index, column) {\r\n                return that.createCell(document, index, column);\r\n            };\r\n            LocalCell.prototype.updateColumnOffset = function (firstColumnPos) {\r\n                _super.prototype.updateColumnOffset.call(this, firstColumnPos);\r\n                that.updateOffset(that.visibleFirstRowPos);\r\n            };\r\n            LocalCell.prototype.updateCell = function (node, index, column) {\r\n                return that.updateCell(node, index, column);\r\n            };\r\n            LocalCell.prototype.forEachRow = function (callback) {\r\n                return that.forEachRow(callback);\r\n            };\r\n            return LocalCell;\r\n        }(ACellAdapter));\r\n        _this.cell = new LocalCell(_this.header, _this.style, tableId, options.mixins || []);\r\n        return _this;\r\n    }\r\n    ACellTableSection.prototype.addColumnMixin = function (mixinClass, options) {\r\n        this.cell.addColumnMixin(mixinClass, options);\r\n    };\r\n    Object.defineProperty(ACellTableSection.prototype, \"idPrefix\", {\r\n        get: function () {\r\n            return this.tableId;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"width\", {\r\n        get: function () {\r\n            return this.context.column.totalHeight;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"visibleColumns\", {\r\n        get: function () {\r\n            return this.cell.visibleColumns;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"visibleFirstColumnPos\", {\r\n        get: function () {\r\n            return this.cell.visibleFirstColumnPos;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"height\", {\r\n        get: function () {\r\n            return this.context.totalHeight;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ACellTableSection.prototype, \"hidden\", {\r\n        get: function () {\r\n            return this.header.classList.contains(CSS_CLASS_LOADING);\r\n        },\r\n        set: function (value) {\r\n            var old = this.hidden;\r\n            if (old === value) {\r\n                return;\r\n            }\r\n            this.header.classList.toggle(CSS_CLASS_LOADING, value);\r\n            this.body.classList.toggle(CSS_CLASS_LOADING, value);\r\n            this.header.classList.toggle(CSS_CLASS_HIDDEN, value);\r\n            this.body.classList.toggle(CSS_CLASS_HIDDEN, value);\r\n            this.onVisibilityChanged(!value);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ACellTableSection.prototype.updateSizer = function (firstRowPos) {\r\n        this.updateShifts(firstRowPos, this.cell.leftShift());\r\n        // no sizer update since centrally managed\r\n    };\r\n    ACellTableSection.prototype.updateShifts = function (top, _left) {\r\n        setTransform(this.body, 0 /* left.toFixed(0) */, top.toFixed(0));\r\n    };\r\n    /**\r\n     * hook when the visibility changes\r\n     * @param {boolean} _visible current visibility\r\n     */\r\n    ACellTableSection.prototype.onVisibilityChanged = function (_visible) {\r\n        // hook\r\n    };\r\n    ACellTableSection.prototype.hide = function () {\r\n        this.hidden = true;\r\n    };\r\n    ACellTableSection.prototype.show = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var wasHidden = this.hidden;\r\n        this.hidden = false;\r\n        if (wasHidden) {\r\n            // full update\r\n            this.revalidate();\r\n        }\r\n        else {\r\n            this.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\r\n        }\r\n    };\r\n    ACellTableSection.prototype.init = function () {\r\n        this.hide(); // hide by default\r\n        this.cell.init();\r\n        _super.prototype.init.call(this);\r\n    };\r\n    ACellTableSection.prototype.destroy = function () {\r\n        _super.prototype.destroy.call(this);\r\n        this.header.remove();\r\n        this.style.remove(this.tableId);\r\n    };\r\n    ACellTableSection.prototype.onScrolledVertically = function (scrollTop, clientHeight, isGoingDown) {\r\n        if (this.hidden) {\r\n            return EScrollResult.NONE;\r\n        }\r\n        return _super.prototype.onScrolledVertically.call(this, scrollTop, clientHeight, isGoingDown);\r\n    };\r\n    ACellTableSection.prototype.onScrolledHorizontally = function (scrollLeft, clientWidth, isGoingRight) {\r\n        var r = this.cell.onScrolledHorizontally(scrollLeft, clientWidth, isGoingRight);\r\n        this.updateSizer(this.visibleFirstRowPos);\r\n        return r;\r\n    };\r\n    /**\r\n     * triggers updating the header\r\n     */\r\n    ACellTableSection.prototype.updateHeaders = function () {\r\n        this.cell.updateHeaders();\r\n    };\r\n    ACellTableSection.prototype.handleCellReady = function (item, ready, column) {\r\n        if (column === void 0) { column = -1; }\r\n        return this.cell.handleCellReady(item, ready, column);\r\n    };\r\n    ACellTableSection.prototype.recycleCell = function (item, column) {\r\n        if (column === void 0) { column = -1; }\r\n        this.cell.recycleCell(item, column);\r\n    };\r\n    /**\r\n     * trigger an update all all column widths\r\n     */\r\n    ACellTableSection.prototype.updateColumnWidths = function () {\r\n        var context = this.context;\r\n        this.style.update(context.defaultRowHeight - context.padding(-1), context.columns, context.column.padding, 0, this.tableId);\r\n    };\r\n    ACellTableSection.prototype.recreate = function (ctx) {\r\n        var scroller = this.bodyScroller;\r\n        var oldLeft = scroller.scrollLeft;\r\n        this.cell.recreate(oldLeft, scroller.clientWidth);\r\n        _super.prototype.recreate.call(this, ctx);\r\n        // restore left\r\n        scroller.scrollLeft = oldLeft;\r\n    };\r\n    ACellTableSection.prototype.clearPool = function () {\r\n        _super.prototype.clearPool.call(this);\r\n        this.cell.clearPool();\r\n    };\r\n    ACellTableSection.prototype.createRow = function (node, rowIndex) {\r\n        this.cell.createRow(node, rowIndex);\r\n        node.classList.add(this.style.cssClasses.tr);\r\n    };\r\n    ACellTableSection.prototype.updateRow = function (node, rowIndex) {\r\n        this.cell.updateRow(node, rowIndex);\r\n    };\r\n    return ACellTableSection;\r\n}(ARowRenderer));\r\nexport { ACellTableSection };\r\nexport default ACellTableSection;\r\n//# sourceMappingURL=ACellTableSection.js.map","import {\n  defaultPhases,\n  EAnimationMode,\n  IAnimationContext,\n  IAnimationItem,\n  IExceptionContext,\n  IPhase,\n  KeyFinder,\n} from 'lineupengine';\nimport { IGroupData, IGroupItem, isGroup } from '../model';\n\n/** @internal */\nexport interface IGroupLookUp {\n  item2groupIndex: Map<number, number>;\n  group2firstItemIndex: Map<string, number>;\n}\n\nfunction toGroupLookup(items: (IGroupItem | IGroupData)[]): IGroupLookUp {\n  const item2groupIndex = new Map<number, number>();\n  const group2firstItemIndex = new Map<string, number>();\n  items.forEach((item, i) => {\n    if (isGroup(item)) {\n      for (let o = 0; o < item.order.length; ++o) {\n        item2groupIndex.set(o, i);\n      }\n    } else if (item.group && item.relativeIndex === 0) {\n      group2firstItemIndex.set(item.group.name, i);\n    }\n  });\n  return { item2groupIndex, group2firstItemIndex };\n}\n\nfunction toKey(item: IGroupItem | IGroupData) {\n  if (isGroup(item)) {\n    return item.name;\n  }\n  return (item as IGroupItem).dataIndex.toString();\n}\n\n/** @internal */\nexport function lineupAnimation(\n  previous: IExceptionContext,\n  previousData: (IGroupItem | IGroupData)[],\n  currentData: (IGroupItem | IGroupData)[]\n): IAnimationContext {\n  const previousKey = (index: number) => toKey(previousData[index]);\n  const currentKey = (index: number) => toKey(currentData[index]);\n\n  const previousGroupCount = previousData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\n  const currentGroupCount = currentData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\n\n  if (previousGroupCount === currentGroupCount) {\n    // reorder or filter only\n    return { currentKey, previous, previousKey };\n  }\n\n  // try to appear where the group was uncollapsed and vice versa\n  let prevHelper: IGroupLookUp;\n  const appearPosition = (currentRowIndex: number, previousFinder: KeyFinder, defaultValue: number) => {\n    if (!prevHelper) {\n      prevHelper = toGroupLookup(previousData);\n    }\n    const item = currentData[currentRowIndex];\n    const referenceIndex = isGroup(item)\n      ? prevHelper.group2firstItemIndex.get(item.name)\n      : prevHelper.item2groupIndex.get(item.dataIndex);\n    if (referenceIndex === undefined) {\n      return defaultValue;\n    }\n    const pos = previousFinder.posByKey(previousKey(referenceIndex));\n    return pos.pos >= 0 ? pos.pos : defaultValue;\n  };\n\n  let currHelper: IGroupLookUp;\n  const removePosition = (previousRowIndex: number, currentFinder: KeyFinder, defaultValue: number) => {\n    if (!currHelper) {\n      currHelper = toGroupLookup(currentData);\n    }\n    const item = previousData[previousRowIndex];\n    const referenceIndex = isGroup(item)\n      ? currHelper.group2firstItemIndex.get(item.name)\n      : currHelper.item2groupIndex.get(item.dataIndex);\n    if (referenceIndex === undefined) {\n      return defaultValue;\n    }\n    const pos = currentFinder.posByKey(currentKey(referenceIndex));\n    return pos.pos >= 0 ? pos.pos : defaultValue;\n  };\n\n  const phases: IPhase[] = [\n    Object.assign({}, defaultPhases[0], {\n      apply(item: Readonly<IAnimationItem>, previousFinder: KeyFinder) {\n        defaultPhases[0].apply(item);\n        if (item.mode === EAnimationMode.SHOW) {\n          item.node.style.transform = `translate(0, ${\n            appearPosition(item.current.index, previousFinder, item.previous.y) - item.nodeY\n          }px)`;\n        }\n      },\n    }),\n    Object.assign({}, defaultPhases[1], {\n      apply(item: Readonly<IAnimationItem>, _previousFinder: KeyFinder, currentFinder: KeyFinder) {\n        defaultPhases[1].apply(item);\n        if (item.mode === EAnimationMode.HIDE) {\n          item.node.style.transform = `translate(0, ${\n            removePosition(item.previous.index, currentFinder, item.current.y) - item.nodeY\n          }px)`;\n        }\n      },\n    }),\n    defaultPhases[defaultPhases.length - 1],\n  ];\n\n  return { previous, previousKey, currentKey, phases };\n}\n","import { IColumn, IAbortAblePromise, IAsyncUpdate, isAbortAble } from 'lineupengine';\nimport type { Column } from '../model';\nimport type { ICellRenderer, IGroupCellRenderer } from '../renderer';\nimport type { ISummaryRenderer, IRenderCallback } from '../renderer';\nimport { createHeader, updateHeader } from './header';\nimport type { IRankingContext } from './interfaces';\nimport type { ILineUpFlags } from '../config';\nimport { cssClass, engineCssClass } from '../styles';\nimport { isPromiseLike } from '../internal';\n\nexport interface IRenderers {\n  singleId: string;\n  single: ICellRenderer;\n  groupId: string;\n  group: IGroupCellRenderer;\n  summaryId: string;\n  summary: ISummaryRenderer | null;\n  singleTemplate: HTMLElement | null;\n  groupTemplate: HTMLElement | null;\n  summaryTemplate: HTMLElement | null;\n}\n\nexport default class RenderColumn implements IColumn {\n  renderers: IRenderers | null = null;\n\n  constructor(\n    public readonly c: Column,\n    public index: number,\n    protected ctx: IRankingContext,\n    protected readonly flags: ILineUpFlags\n  ) {}\n\n  get width() {\n    return this.c.getWidth();\n  }\n\n  get id() {\n    return this.c.id;\n  }\n\n  get frozen() {\n    return this.flags.disableFrozenColumns ? false : this.c.frozen;\n  }\n\n  private singleRenderer() {\n    if (!this.renderers || !this.renderers.single) {\n      return null;\n    }\n    if (this.renderers.singleTemplate) {\n      return this.renderers.singleTemplate.cloneNode(true) as HTMLElement;\n    }\n    const elem = this.ctx.asElement(this.renderers.single.template);\n    elem.classList.add(cssClass(`renderer-${this.renderers.singleId}`), cssClass('detail'));\n    elem.dataset.renderer = this.renderers.singleId;\n    elem.dataset.group = 'd';\n\n    this.renderers.singleTemplate = elem.cloneNode(true) as HTMLElement;\n    return elem;\n  }\n\n  private groupRenderer() {\n    if (!this.renderers || !this.renderers.group) {\n      return null;\n    }\n    if (this.renderers.groupTemplate) {\n      return this.renderers.groupTemplate.cloneNode(true) as HTMLElement;\n    }\n    const elem = this.ctx.asElement(this.renderers.group.template);\n    elem.classList.add(cssClass(`renderer-${this.renderers.groupId}`), cssClass('group'));\n    elem.dataset.renderer = this.renderers.groupId;\n    elem.dataset.group = 'g';\n\n    this.renderers.groupTemplate = elem.cloneNode(true) as HTMLElement;\n    return elem;\n  }\n\n  private summaryRenderer() {\n    if (!this.renderers || !this.renderers.summary) {\n      return null;\n    }\n    if (this.renderers.summaryTemplate) {\n      return this.renderers.summaryTemplate.cloneNode(true) as HTMLElement;\n    }\n    const elem = this.ctx.asElement(this.renderers.summary.template);\n    elem.classList.add(cssClass('summary'), cssClass('th-summary'), cssClass(`renderer-${this.renderers.summaryId}`));\n    elem.dataset.renderer = this.renderers.summaryId;\n\n    this.renderers.summaryTemplate = elem.cloneNode(true) as HTMLElement;\n    return elem;\n  }\n\n  createHeader(): HTMLElement | IAsyncUpdate<HTMLElement> {\n    const node = createHeader(this.c, this.ctx, {\n      extraPrefix: 'th',\n      dragAble: this.flags.advancedUIFeatures,\n      mergeDropAble: this.flags.advancedModelFeatures,\n      rearrangeAble: this.flags.advancedUIFeatures,\n      resizeable: this.flags.advancedUIFeatures,\n    });\n    node.classList.add(cssClass('header'));\n    if (!this.flags.disableFrozenColumns) {\n      node.classList.toggle(engineCssClass('frozen'), this.frozen);\n    }\n\n    if (this.renderers && this.renderers.summary) {\n      const summary = this.summaryRenderer()!;\n      node.appendChild(summary);\n    }\n    return this.updateHeader(node);\n  }\n\n  hasSummaryLine() {\n    return Boolean(this.c.getMetaData().summary);\n  }\n\n  updateHeader(node: HTMLElement): HTMLElement | IAsyncUpdate<HTMLElement> {\n    updateHeader(node, this.c);\n    if (!this.renderers || !this.renderers.summary) {\n      return node;\n    }\n    let summary = node.getElementsByClassName(cssClass('summary'))[0]! as HTMLElement;\n    const oldRenderer = summary.dataset.renderer;\n    const currentRenderer = this.renderers.summaryId;\n    if (oldRenderer !== currentRenderer) {\n      summary.remove();\n      summary = this.summaryRenderer()!;\n      node.appendChild(summary);\n    }\n    const ready = this.renderers.summary.update(summary);\n    if (ready) {\n      return { item: node, ready };\n    }\n    return node;\n  }\n\n  createCell(index: number): HTMLElement | IAsyncUpdate<HTMLElement> {\n    const isGroup = this.ctx.isGroup(index);\n    const node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\n    return this.updateCell(node, index);\n  }\n\n  updateCell(node: HTMLElement, index: number): HTMLElement | IAsyncUpdate<HTMLElement> {\n    if (!this.flags.disableFrozenColumns) {\n      node.classList.toggle(engineCssClass('frozen'), this.frozen);\n    }\n    const isGroup = this.ctx.isGroup(index);\n    // assert that we have the template of the right mode\n    const oldRenderer = node.dataset.renderer;\n    const currentRenderer = isGroup ? this.renderers!.groupId : this.renderers!.singleId;\n    const oldGroup = node.dataset.group;\n    const currentGroup = isGroup ? 'g' : 'd';\n    if (oldRenderer !== currentRenderer || oldGroup !== currentGroup) {\n      node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\n    }\n    let ready: IAbortAblePromise<void> | void | null;\n    if (isGroup) {\n      const g = this.ctx.getGroup(index);\n      ready = this.renderers!.group.update(node, g);\n    } else {\n      const r = this.ctx.getRow(index);\n      const row = this.ctx.provider.getRow(r.dataIndex);\n      if (!isPromiseLike(row)) {\n        ready = this.renderers!.single.update(node, row, r.relativeIndex, r.group);\n      } else {\n        ready = chainAbortAble(row, (row) => this.renderers!.single.update(node, row, r.relativeIndex, r.group));\n      }\n    }\n    if (ready) {\n      return { item: node, ready };\n    }\n    return node;\n  }\n\n  renderCell(ctx: CanvasRenderingContext2D, index: number): boolean | IAbortAblePromise<IRenderCallback> {\n    const r = this.ctx.getRow(index);\n    const s = this.renderers!.single;\n    if (!s.render) {\n      return false;\n    }\n    const row = this.ctx.provider.getRow(r.dataIndex);\n    if (!isPromiseLike(row)) {\n      return s.render(ctx, row, r.relativeIndex, r.group) || false;\n    }\n    return chainAbortAble(row, (row) => s.render!(ctx, row, r.relativeIndex, r.group) || false);\n  }\n}\n\nfunction chainAbortAble<T, U, V>(\n  toWait: Promise<T>,\n  mapper: (value: T) => IAbortAblePromise<U> | V\n): IAbortAblePromise<U> | V {\n  let aborted = false;\n  const p: any = new Promise<IAbortAblePromise<U> | null | void>((resolve) => {\n    if (aborted) {\n      return;\n    }\n    toWait.then((r) => {\n      if (aborted) {\n        return;\n      }\n      const mapped = mapper(r);\n      if (isAbortAble(mapped as any)) {\n        p.abort = (mapped as IAbortAblePromise<U>).abort.bind(mapped);\n        return p.then(resolve);\n      }\n      return resolve(mapped as any);\n    });\n  });\n\n  p.abort = () => {\n    aborted = true;\n  };\n  return p;\n}\n","import { abortAbleAll, IAbortAblePromise, IAsyncUpdate, isAsyncUpdate, StyleManager } from 'lineupengine';\nimport { round } from '../internal';\nimport type { Column, IMultiLevelColumn } from '../model';\nimport type { ISummaryRenderer } from '../renderer';\nimport { multiLevelGridCSSClass } from '../renderer/utils';\nimport { COLUMN_PADDING, cssClass } from '../styles';\nimport { createHeader, updateHeader } from './header';\nimport RenderColumn from './RenderColumn';\n\n/** @internal */\nexport default class MultiLevelRenderColumn extends RenderColumn {\n  private summaries: ISummaryRenderer[] = [];\n\n  private get mc() {\n    return this.c as IMultiLevelColumn & Column;\n  }\n\n  get width() {\n    return this.c.getWidth() + COLUMN_PADDING * this.mc.length;\n  }\n\n  createHeader() {\n    const r = super.createHeader();\n    const wrapper = this.ctx.document.createElement('div');\n    wrapper.classList.add(cssClass('nested'));\n    wrapper.classList.add(multiLevelGridCSSClass(this.ctx.idPrefix, this.c));\n\n    if (isAsyncUpdate(r)) {\n      r.item.appendChild(wrapper);\n    } else {\n      r.appendChild(wrapper);\n    }\n\n    return this.updateNested(wrapper, r);\n  }\n\n  private matchChildren(wrapper: HTMLElement, children: Column[]) {\n    function matches(col: Column, i: number) {\n      //do both match?\n      const n = wrapper.children[i] as HTMLElement;\n      return n != null && n.dataset.colId === col.id;\n    }\n\n    if (children.every(matches) && children.length === wrapper.childElementCount) {\n      // 1:1 match\n      return;\n    }\n\n    const lookup = new Map(\n      (Array.from(wrapper.children) as HTMLElement[]).map(\n        (n: HTMLElement, i) =>\n          [n.dataset.colId!, { node: n, summary: this.summaries[i] }] as [\n            string,\n            { node: HTMLElement; summary: ISummaryRenderer }\n          ]\n      )\n    );\n\n    // reset summaries array\n    this.summaries = [];\n\n    children.forEach((cc, i) => {\n      const existing = lookup.get(cc.id);\n      if (existing) {\n        // reuse existing\n        lookup.delete(cc.id);\n        const n = existing.node;\n        n.style.gridColumnStart = (i + 1).toString();\n        wrapper.appendChild(n);\n        this.summaries[i] = existing.summary;\n        return;\n      }\n\n      const n = createHeader(cc, this.ctx, {\n        extraPrefix: 'th',\n        mergeDropAble: false,\n        dragAble: this.flags.advancedModelFeatures,\n        rearrangeAble: this.flags.advancedModelFeatures,\n        resizeable: this.flags.advancedModelFeatures,\n      });\n      n.classList.add(cssClass('header'), cssClass('nested-th'));\n      n.style.gridColumnStart = (i + 1).toString();\n      wrapper.appendChild(n);\n\n      if (!this.renderers || !this.renderers.summary) {\n        return;\n      }\n      const summary = this.ctx.summaryRenderer(cc, false);\n      const summaryNode = this.ctx.asElement(summary.template);\n      summaryNode.classList.add(\n        cssClass('summary'),\n        cssClass('th-summary'),\n        cssClass(`renderer-${cc.getSummaryRenderer()}`)\n      );\n      summaryNode.dataset.renderer = cc.getSummaryRenderer();\n      n.appendChild(summaryNode);\n      this.summaries[i] = summary;\n      summary.update(summaryNode);\n    });\n\n    // delete not used ones anymore\n    lookup.forEach((v) => v.node.remove());\n  }\n\n  updateHeader(node: HTMLElement) {\n    const r = super.updateHeader(node);\n    node = isAsyncUpdate(r) ? r.item : r;\n    const wrapper = node.getElementsByClassName(cssClass('nested'))[0] as HTMLElement;\n    if (!wrapper) {\n      return r; // too early\n    }\n    node.appendChild(wrapper); // ensure the last one\n    return this.updateNested(wrapper, r);\n  }\n\n  hasSummaryLine() {\n    return super.hasSummaryLine() || this.mc.children.some((c) => Boolean(c.getMetaData().summary));\n  }\n\n  updateWidthRule(style: StyleManager) {\n    const mc = this.mc;\n    // need this for chrome to work properly\n    const widths = mc.children.map((c) => `minmax(0, ${round(c.getWidth())}fr)`);\n    const clazz = multiLevelGridCSSClass(this.ctx.idPrefix, this.c);\n    style.updateRule(`stacked-${this.c.id}`, `.${clazz}`, {\n      display: 'grid',\n      gridTemplateColumns: widths.join(' '),\n    });\n    return clazz;\n  }\n\n  private updateNested(wrapper: HTMLElement, r: HTMLElement | IAsyncUpdate<HTMLElement>) {\n    const sub = this.mc.isShowNestedSummaries() ? this.mc.children : [];\n\n    this.matchChildren(wrapper, sub);\n\n    const children = Array.from(wrapper.children) as HTMLElement[];\n\n    const toWait: IAbortAblePromise<void>[] = [];\n    let header: HTMLElement;\n    if (isAsyncUpdate(r)) {\n      toWait.push(r.ready);\n      header = r.item;\n    } else {\n      header = r;\n    }\n\n    sub.forEach((c, i) => {\n      const node = children[i];\n      updateHeader(node, c);\n\n      if (!this.renderers || !this.renderers.summary) {\n        return;\n      }\n      let summary = node.getElementsByClassName(cssClass('summary'))[0] as HTMLElement;\n      const oldRenderer = summary.dataset.renderer;\n      const currentRenderer = c.getSummaryRenderer();\n      if (oldRenderer !== currentRenderer) {\n        const renderer = this.ctx.summaryRenderer(c, false);\n        summary.remove();\n        summary = this.ctx.asElement(renderer.template);\n        summary.classList.add(cssClass('summary'), cssClass('th-summary'), cssClass(`renderer-${currentRenderer}`));\n        summary.dataset.renderer = currentRenderer;\n        this.summaries[i] = renderer;\n        node.appendChild(summary);\n      }\n      const ready = this.summaries[i].update(summary);\n      if (ready) {\n        toWait.push(ready);\n      }\n    });\n\n    if (toWait.length === 0) {\n      return header;\n    }\n    return {\n      item: header,\n      ready: abortAbleAll(toWait) as IAbortAblePromise<void>,\n    };\n  }\n}\n","import { OrderedSet, AEventDispatcher, IEventListener } from '../internal';\nimport { IGroupData, IGroupItem, isGroup } from '../model';\nimport type { IDataProvider } from '../provider';\nimport { cssClass, engineCssClass } from '../styles';\nimport { forEachIndices } from '../model/internal';\nimport { rangeSelection } from '../provider/utils';\n\ninterface IPoint {\n  x: number;\n  y: number;\n}\n\ninterface IShift {\n  xShift: number;\n  yShift: number;\n  node: HTMLElement;\n}\n\n/**\n * @asMemberOf SelectionManager\n * @internal\n * @event\n */\nexport declare function selectRange(from: number, to: number, additional: boolean): void;\n\n/** @internal */\nexport default class SelectionManager extends AEventDispatcher {\n  static readonly EVENT_SELECT_RANGE = 'selectRange';\n  private static readonly MIN_DISTANCE = 10;\n\n  private readonly hr: HTMLHRElement;\n\n  private start: (IPoint & IShift) | null = null;\n\n  constructor(private readonly ctx: { provider: IDataProvider }, private readonly body: HTMLElement) {\n    super();\n    const root = body.parentElement!.parentElement!;\n    let hr = root.querySelector('hr');\n    if (!hr) {\n      hr = root.ownerDocument!.createElement('hr');\n      root.appendChild(hr);\n    }\n    this.hr = hr;\n    this.hr.classList.add(cssClass('hr'));\n\n    const mouseMove = (evt: MouseEvent) => {\n      this.showHint(evt);\n    };\n    const mouseUp = (evt: MouseEvent) => {\n      this.body.removeEventListener('mousemove', mouseMove);\n      this.body.removeEventListener('mouseup', mouseUp);\n      this.body.removeEventListener('mouseleave', mouseUp);\n\n      if (!this.start) {\n        return;\n      }\n      const row = engineCssClass('tr');\n      const startNode = this.start.node.classList.contains(row)\n        ? this.start.node\n        : this.start.node.closest<HTMLElement>(`.${row}`);\n      // somehow on firefox the mouseUp will be triggered on the original node\n      // thus search the node explicitly\n      const end = this.body.ownerDocument!.elementFromPoint(evt.clientX, evt.clientY) as HTMLElement;\n      const endNode = end.classList.contains(row) ? end : end.closest<HTMLElement>(`.${row}`);\n      this.start = null;\n\n      this.body.classList.remove(cssClass('selection-active'));\n      this.hr.classList.remove(cssClass('selection-active'));\n\n      this.select(evt.ctrlKey, startNode, endNode);\n    };\n\n    body.addEventListener(\n      'mousedown',\n      (evt) => {\n        const r = root.getBoundingClientRect();\n        this.start = { x: evt.clientX, y: evt.clientY, xShift: r.left, yShift: r.top, node: evt.target as HTMLElement };\n\n        this.body.classList.add(cssClass('selection-active'));\n        body.addEventListener('mousemove', mouseMove, {\n          passive: true,\n        });\n        body.addEventListener('mouseup', mouseUp, {\n          passive: true,\n        });\n        body.addEventListener('mouseleave', mouseUp, {\n          passive: true,\n        });\n      },\n      {\n        passive: true,\n      }\n    );\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SelectionManager.EVENT_SELECT_RANGE]);\n  }\n\n  on(type: typeof SelectionManager.EVENT_SELECT_RANGE, listener: typeof selectRange | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  private select(additional: boolean, startNode?: HTMLElement, endNode?: HTMLElement) {\n    if (!startNode || !endNode || startNode === endNode) {\n      return; // no single\n    }\n\n    const startIndex = Number.parseInt(startNode.dataset.index!, 10);\n    const endIndex = Number.parseInt(endNode.dataset.index!, 10);\n\n    const from = Math.min(startIndex, endIndex);\n    const end = Math.max(startIndex, endIndex);\n    if (from === end) {\n      return; // no single\n    }\n    // bounce event end\n    requestAnimationFrame(() => this.fire(SelectionManager.EVENT_SELECT_RANGE, from, end, additional));\n  }\n\n  private showHint(end: MouseEvent) {\n    const start = this.start!;\n    const sy = start.y;\n    const ey = end.clientY;\n\n    const visible = Math.abs(sy - ey) > SelectionManager.MIN_DISTANCE;\n    this.hr.classList.toggle(cssClass('selection-active'), visible);\n    this.hr.style.transform = `translate(${start.x - start.xShift}px,${sy - start.yShift}px)scale(1,${Math.abs(\n      ey - sy\n    )})rotate(${ey > sy ? 90 : -90}deg)`;\n  }\n\n  remove(node: HTMLElement) {\n    node.onclick = undefined;\n  }\n\n  add(node: HTMLElement) {\n    node.onclick = (evt) => {\n      const dataIndex = Number.parseInt(node.dataset.i!, 10);\n      if (evt.shiftKey) {\n        const relIndex = Number.parseInt(node.dataset.index!, 10);\n        const ranking = node.parentElement!.dataset.ranking!;\n        if (rangeSelection(this.ctx.provider, ranking, dataIndex, relIndex, evt.ctrlKey)) {\n          return;\n        }\n      }\n      this.ctx.provider.toggleSelection(dataIndex, evt.ctrlKey);\n    };\n  }\n\n  selectRange(rows: { forEach: (c: (item: IGroupItem | IGroupData) => void) => void }, additional = false) {\n    const current = new OrderedSet<number>(additional ? this.ctx.provider.getSelection() : []);\n    const toggle = (dataIndex: number) => {\n      if (current.has(dataIndex)) {\n        current.delete(dataIndex);\n      } else {\n        current.add(dataIndex);\n      }\n    };\n    rows.forEach((d) => {\n      if (isGroup(d)) {\n        forEachIndices(d.order, toggle);\n      } else {\n        toggle(d.dataIndex);\n      }\n    });\n    this.ctx.provider.setSelection(Array.from(current));\n  }\n\n  updateState(node: HTMLElement, dataIndex: number) {\n    if (this.ctx.provider.isSelected(dataIndex)) {\n      node.classList.add(cssClass('selected'));\n    } else {\n      node.classList.remove(cssClass('selected'));\n    }\n  }\n\n  update(node: HTMLElement, selectedDataIndices: { has(dataIndex: number): boolean }) {\n    const dataIndex = Number.parseInt(node.dataset.i!, 10);\n    if (selectedDataIndices.has(dataIndex)) {\n      node.classList.add(cssClass('selected'));\n    } else {\n      node.classList.remove(cssClass('selected'));\n    }\n  }\n}\n","import {\n  ACellTableSection,\n  GridStyleManager,\n  IAbortAblePromise,\n  ICellRenderContext,\n  IExceptionContext,\n  isAbortAble,\n  isAsyncUpdate,\n  isLoadingCell,\n  ITableSection,\n  nonUniformContext,\n  PrefetchMixin,\n  tableIds,\n  uniformContext,\n  IAsyncUpdate,\n} from 'lineupengine';\nimport type { ILineUpFlags } from '../config';\nimport { HOVER_DELAY_SHOW_DETAIL } from '../constants';\nimport { AEventDispatcher, clear, debounce, IEventContext, IEventHandler, IEventListener, suffix } from '../internal';\nimport {\n  Column,\n  IGroupData,\n  IGroupItem,\n  IOrderedGroup,\n  isGroup,\n  isMultiLevelColumn,\n  Ranking,\n  StackColumn,\n  IGroupParent,\n  defaultGroup,\n  IGroup,\n} from '../model';\nimport type { IImposer, IRenderCallback, IRenderContext } from '../renderer';\nimport { CANVAS_HEIGHT, COLUMN_PADDING, cssClass, engineCssClass } from '../styles';\nimport { lineupAnimation } from './animation';\nimport type { IRankingBodyContext, IRankingHeaderContextContainer } from './interfaces';\nimport MultiLevelRenderColumn from './MultiLevelRenderColumn';\nimport RenderColumn, { IRenderers } from './RenderColumn';\nimport SelectionManager from './SelectionManager';\nimport { groupRoots } from '../model/internal';\nimport { isAlwaysShowingGroupStrategy, toRowMeta } from '../provider/internal';\n\nexport interface IEngineRankingContext extends IRankingHeaderContextContainer, IRenderContext {\n  createRenderer(c: Column, imposer?: IImposer): IRenderers;\n}\n\nexport interface IEngineRankingOptions {\n  animation: boolean;\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\n  flags: ILineUpFlags;\n}\n\n/**\n * emitted when the width of the ranking changed\n * @asMemberOf EngineRanking\n * @event\n */\nexport declare function widthChanged(): void;\n/**\n * emitted when the data of the ranking needs to be updated\n * @asMemberOf EngineRanking\n * @event\n */\nexport declare function updateData(): void;\n/**\n * emitted when the table has be recreated\n * @asMemberOf EngineRanking\n * @event\n */\nexport declare function recreate(): void;\n/**\n * emitted when the highlight changes\n * @asMemberOf EngineRanking\n * @param dataIndex the highlighted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n\n/** @internal */\nclass RankingEvents extends AEventDispatcher {\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\n  static readonly EVENT_UPDATE_DATA = 'updateData';\n  static readonly EVENT_RECREATE = 'recreate';\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\n\n  fire(type: string | string[], ...args: any[]) {\n    super.fire(type, ...args);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        RankingEvents.EVENT_WIDTH_CHANGED,\n        RankingEvents.EVENT_UPDATE_DATA,\n        RankingEvents.EVENT_RECREATE,\n        RankingEvents.EVENT_HIGHLIGHT_CHANGED,\n      ]);\n  }\n}\n\nconst PASSIVE: AddEventListenerOptions = {\n  passive: false,\n};\n\nexport default class EngineRanking extends ACellTableSection<RenderColumn> implements ITableSection, IEventHandler {\n  static readonly EVENT_WIDTH_CHANGED = RankingEvents.EVENT_WIDTH_CHANGED;\n  static readonly EVENT_UPDATE_DATA = RankingEvents.EVENT_UPDATE_DATA;\n  static readonly EVENT_RECREATE = RankingEvents.EVENT_RECREATE;\n  static readonly EVENT_HIGHLIGHT_CHANGED = RankingEvents.EVENT_HIGHLIGHT_CHANGED;\n\n  private _context: ICellRenderContext<RenderColumn>;\n\n  private readonly loadingCanvas = new WeakMap<\n    HTMLCanvasElement,\n    { col: number; render: IAbortAblePromise<IRenderCallback> }[]\n  >();\n\n  private readonly renderCtx: IRankingBodyContext;\n  private data: (IGroupItem | IGroupData)[] = [];\n  private readonly selection: SelectionManager;\n  private highlight = -1;\n  private readonly canvasPool: HTMLCanvasElement[] = [];\n\n  private currentCanvasShift = 0;\n  private currentCanvasWidth = 0;\n\n  private readonly events = new RankingEvents();\n\n  private roptions: Readonly<IEngineRankingOptions> = {\n    animation: true,\n    levelOfDetail: () => 'high',\n    customRowUpdate: () => undefined,\n    flags: {\n      disableFrozenColumns: false,\n      advancedModelFeatures: true,\n      advancedRankingFeatures: true,\n      advancedUIFeatures: true,\n    },\n  };\n\n  private readonly delayedUpdate: (this: { type: string }) => void;\n  private readonly delayedUpdateAll: () => void;\n  private readonly delayedUpdateColumnWidths: () => void;\n  private readonly columns: RenderColumn[];\n\n  private readonly canvasMouseHandler = {\n    timer: new Set<number>(),\n    hoveredRows: new Set<HTMLElement>(),\n    cleanUp: () => {\n      const c = this.canvasMouseHandler;\n      c.timer.forEach((timer) => {\n        clearTimeout(timer);\n      });\n      c.timer.clear();\n      for (const row of Array.from(c.hoveredRows)) {\n        c.unhover(row);\n      }\n    },\n    enter: (evt: MouseEvent) => {\n      const c = this.canvasMouseHandler;\n      c.cleanUp();\n      const row = evt.currentTarget as HTMLElement;\n      row.addEventListener('mouseleave', c.leave, PASSIVE);\n      c.timer.add(\n        setTimeout(() => {\n          c.hoveredRows.add(row);\n          this.updateHoveredRow(row, true);\n        }, HOVER_DELAY_SHOW_DETAIL) as unknown as number\n      );\n    },\n    leave: (evt: MouseEvent | HTMLElement) => {\n      // on row to survive canvas removal\n      const c = this.canvasMouseHandler;\n      const row = (\n        typeof (evt as MouseEvent).currentTarget !== 'undefined' ? (evt as MouseEvent).currentTarget : evt\n      ) as HTMLElement;\n      c.unhover(row);\n\n      c.cleanUp();\n    },\n    unhover: (row: HTMLElement) => {\n      // remove self\n      const c = this.canvasMouseHandler;\n      c.hoveredRows.delete(row);\n      row.removeEventListener('mouseleave', c.leave);\n      if (!EngineRanking.isCanvasRenderedRow(row) && row.parentElement) {\n        // and part of dom\n        setTimeout(() => this.updateHoveredRow(row, false));\n      }\n    },\n  };\n\n  private readonly highlightHandler = {\n    enabled: false,\n    enter: (evt: MouseEvent) => {\n      if (this.highlight >= 0) {\n        const old = this.body.getElementsByClassName(engineCssClass('highlighted'))[0];\n        if (old) {\n          old.classList.remove(engineCssClass('highlighted'));\n        }\n        this.highlight = -1;\n      }\n      const row = evt.currentTarget as HTMLElement;\n      const dataIndex = Number.parseInt(row.dataset.i || '-1', 10);\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, dataIndex);\n    },\n    leave: () => {\n      if (this.highlight >= 0) {\n        const old = this.body.getElementsByClassName(engineCssClass('highlighted'))[0];\n        if (old) {\n          old.classList.remove(engineCssClass('highlighted'));\n        }\n        this.highlight = -1;\n      }\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, -1);\n    },\n  };\n\n  constructor(\n    public readonly ranking: Ranking,\n    header: HTMLElement,\n    body: HTMLElement,\n    tableId: string,\n    style: GridStyleManager,\n    private readonly ctx: IEngineRankingContext,\n    roptions: Partial<IEngineRankingOptions> = {}\n  ) {\n    super(header, body, tableId, style, { mixins: [PrefetchMixin], batchSize: 20 });\n    Object.assign(this.roptions, roptions);\n    body.dataset.ranking = ranking.id;\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    this.delayedUpdate = debounce(\n      function (this: { type: string; primaryType: string }) {\n        if (this.type !== Ranking.EVENT_DIRTY_VALUES) {\n          that.events.fire(EngineRanking.EVENT_UPDATE_DATA);\n          return;\n        }\n        if (\n          this.primaryType !== Column.EVENT_RENDERER_TYPE_CHANGED &&\n          this.primaryType !== Column.EVENT_GROUP_RENDERER_TYPE_CHANGED &&\n          this.primaryType !== Column.EVENT_LABEL_CHANGED\n        ) {\n          // just the single column will be updated\n          that.updateBody();\n        }\n      },\n      50,\n      (current, next) => {\n        const currentEvent = current.self.type;\n        // order changed is more important\n        return currentEvent === Ranking.EVENT_ORDER_CHANGED ? current : next;\n      }\n    );\n\n    this.delayedUpdateAll = debounce(() => this.updateAll(), 50);\n    this.delayedUpdateColumnWidths = debounce(() => this.updateColumnWidths(), 50);\n    ranking.on(`${Ranking.EVENT_ADD_COLUMN}.hist`, (col: Column, index: number) => {\n      // index doesn't consider the hidden columns\n      const hiddenOffset = this.ranking.children.slice(0, index).reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n      const shiftedIndex = index - hiddenOffset;\n      this.columns.splice(shiftedIndex, 0, this.createCol(col, shiftedIndex));\n      this.reindex();\n      this.delayedUpdateAll();\n    });\n    ranking.on(`${Ranking.EVENT_REMOVE_COLUMN}.body`, (col: Column, index: number) => {\n      EngineRanking.disableListener(col);\n      // index doesn't consider the hidden columns\n      const hiddenOffset = this.ranking.children.slice(0, index).reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n      const shiftedIndex = index - hiddenOffset;\n      this.columns.splice(shiftedIndex, 1);\n      this.reindex();\n      this.delayedUpdateAll();\n    });\n    ranking.on(`${Ranking.EVENT_MOVE_COLUMN}.body`, (col: Column, index: number) => {\n      //delete first\n      const shiftedOld = this.columns.findIndex((d) => d.c === col);\n      const c = this.columns.splice(shiftedOld, 1)[0];\n      // adapt target index based on previous index, i.e shift by one\n      const hiddenOffset = this.ranking.children.slice(0, index).reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n      const shiftedIndex = index - hiddenOffset;\n      this.columns.splice(shiftedOld < shiftedIndex ? shiftedIndex - 1 : shiftedIndex, 0, c);\n      this.reindex();\n      this.delayedUpdateAll();\n    });\n    ranking.on(\n      `${Ranking.EVENT_COLUMN_VISIBILITY_CHANGED}.body`,\n      (col: Column, _oldValue: boolean, newValue: boolean) => {\n        if (newValue) {\n          // become visible\n          const index = ranking.children.indexOf(col);\n          const hiddenOffset = this.ranking.children\n            .slice(0, index)\n            .reduce((acc, c) => acc + (!c.isVisible() ? 1 : 0), 0);\n          const shiftedIndex = index - hiddenOffset;\n          this.columns.splice(shiftedIndex, 0, this.createCol(col, shiftedIndex));\n        } else {\n          // hide\n          const index = this.columns.findIndex((d) => d.c === col);\n          EngineRanking.disableListener(col);\n          this.columns.splice(index, 1);\n        }\n        this.reindex();\n        this.delayedUpdateAll();\n      }\n    );\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.body`, this.delayedUpdate);\n\n    this.selection = new SelectionManager(this.ctx, body);\n    this.selection.on(SelectionManager.EVENT_SELECT_RANGE, (from: number, to: number, additional: boolean) => {\n      this.selection.selectRange(this.data.slice(from, to + 1), additional);\n    });\n\n    this.renderCtx = Object.assign(\n      {\n        isGroup: (index: number) => isGroup(this.data[index]),\n        getRow: (index: number) => this.data[index] as IGroupItem,\n        getGroup: (index: number) => this.data[index] as IGroupData,\n      },\n      ctx\n    );\n\n    // default context\n    this.columns = ranking.children.filter((c) => c.isVisible()).map((c, i) => this.createCol(c, i));\n    this._context = Object.assign(\n      {\n        columns: this.columns,\n        column: nonUniformContext(\n          this.columns.map((w) => w.width),\n          100,\n          COLUMN_PADDING\n        ),\n      },\n      uniformContext(0, 20)\n    );\n\n    this.columns.forEach((column) => {\n      if (column instanceof MultiLevelRenderColumn) {\n        column.updateWidthRule(this.style);\n      }\n      column.renderers = this.ctx.createRenderer(column.c);\n    });\n\n    this.style.updateRule(\n      `hoverOnly${this.tableId}`,\n      `\n      #${tableIds(this.tableId).tbody}:hover > .${engineCssClass('tr')}:hover .${cssClass('hover-only')},\n      #${tableIds(this.tableId).tbody} > .${engineCssClass('tr')}.${cssClass('selected')} .${cssClass('hover-only')},\n      #${tableIds(this.tableId).tbody} > .${engineCssClass('tr')}.${engineCssClass('highlighted')} .${cssClass(\n        'hover-only'\n      )}`,\n      {\n        visibility: 'visible',\n      }\n    );\n\n    this.updateCanvasRule();\n  }\n\n  on(type: typeof EngineRanking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\n  on(type: typeof EngineRanking.EVENT_UPDATE_DATA, listener: typeof updateData | null): this;\n  on(type: typeof EngineRanking.EVENT_RECREATE, listener: typeof recreate | null): this;\n  on(type: typeof EngineRanking.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    this.events.on(type, listener);\n    return this;\n  }\n\n  get id() {\n    return this.ranking.id;\n  }\n\n  protected onVisibilityChanged(visible: boolean) {\n    super.onVisibilityChanged(visible);\n    if (visible) {\n      this.delayedUpdate.call({ type: Ranking.EVENT_ORDER_CHANGED });\n    }\n  }\n\n  updateHeaders() {\n    this.updateColumnSummaryFlag();\n    return super.updateHeaders();\n  }\n\n  get currentData() {\n    return this.data;\n  }\n\n  get context(): ICellRenderContext<RenderColumn> {\n    return this._context;\n  }\n\n  protected createHeader(_document: Document, column: RenderColumn): HTMLElement | IAsyncUpdate<HTMLElement> {\n    return column.createHeader();\n  }\n\n  private updateColumnSummaryFlag() {\n    // updates the header flag depending on whether there are any sublabels\n    this.header.classList.toggle(\n      cssClass('show-sublabel'),\n      this.columns.some((c) => c.hasSummaryLine())\n    );\n  }\n\n  protected updateHeader(node: HTMLElement, column: RenderColumn) {\n    if (column instanceof MultiLevelRenderColumn) {\n      column.updateWidthRule(this.style);\n    }\n    return column.updateHeader(node);\n  }\n\n  protected createCell(_document: Document, index: number, column: RenderColumn) {\n    return column.createCell(index);\n  }\n\n  private createCellHandled(col: RenderColumn, index: number) {\n    const r = col.createCell(index);\n    let item: HTMLElement;\n    if (isAsyncUpdate(r)) {\n      item = this.handleCellReady(r.item, r.ready, col.index);\n    } else {\n      item = r;\n    }\n    this.initCellClasses(item, col.id);\n    return item;\n  }\n\n  protected updateCell(node: HTMLElement, index: number, column: RenderColumn) {\n    return column.updateCell(node, index);\n  }\n\n  private selectCanvas() {\n    if (this.canvasPool.length > 0) {\n      return this.canvasPool.pop()!;\n    }\n    const c = this.body.ownerDocument!.createElement('canvas');\n    c.classList.add(cssClass(`low-c${this.tableId}`));\n    return c;\n  }\n\n  private rowFlags(row: HTMLElement) {\n    const rowany: any = row;\n    const v = rowany.__lu__;\n    if (v == null) {\n      return (rowany.__lu__ = {});\n    }\n    return v;\n  }\n\n  private visibleRenderedWidth() {\n    let width = 0;\n    for (const col of this.visibleColumns.frozen) {\n      width += this.columns[col].width + COLUMN_PADDING;\n    }\n    for (let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\n      width += this.columns[col].width + COLUMN_PADDING;\n    }\n    if (width > 0) {\n      width -= COLUMN_PADDING; // for the last one\n    }\n    return width;\n  }\n\n  private pushLazyRedraw(\n    canvas: HTMLCanvasElement,\n    x: number,\n    column: RenderColumn,\n    render: IAbortAblePromise<IRenderCallback>\n  ) {\n    render.then((r) => {\n      const l = this.loadingCanvas.get(canvas) || [];\n      const pos = l.findIndex((d) => d.render === render && d.col === column.index);\n      if (pos < 0) {\n        // not part anymore ignore\n        return;\n      }\n      l.splice(pos, 1);\n      if (typeof r === 'function') {\n        // i.e not aborted\n        const ctx = canvas.getContext('2d')!;\n        ctx.clearRect(x - 1, 0, column.width + 2, canvas.height);\n        ctx.save();\n        ctx.translate(x, 0);\n        r(ctx);\n        ctx.restore();\n      }\n\n      if (l.length > 0) {\n        return;\n      }\n      this.loadingCanvas.delete(canvas);\n      canvas.classList.remove(cssClass('loading-c'));\n    });\n\n    if (!this.loadingCanvas.has(canvas)) {\n      canvas.classList.add(cssClass('loading-c'));\n      this.loadingCanvas.set(canvas, [{ col: column.index, render }]);\n    } else {\n      this.loadingCanvas.get(canvas)!.push({ col: column.index, render });\n    }\n  }\n\n  private renderRow(canvas: HTMLCanvasElement, node: HTMLElement, index: number) {\n    if (this.loadingCanvas.has(canvas)) {\n      for (const a of this.loadingCanvas.get(canvas)!) {\n        a.render.abort();\n      }\n      this.loadingCanvas.delete(canvas);\n    }\n    canvas.classList.remove(cssClass('loading-c'));\n\n    canvas.width = this.currentCanvasWidth;\n    canvas.height = CANVAS_HEIGHT;\n    const ctx = canvas.getContext('2d')!;\n    ctx.imageSmoothingEnabled = false;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.save();\n    const domColumns: RenderColumn[] = [];\n\n    let x = 0;\n    const renderCellImpl = (col: number) => {\n      const c = this.columns[col];\n      const r = c.renderCell(ctx, index);\n      if (r === true) {\n        domColumns.push(c);\n      } else if (r !== false && isAbortAble(r)) {\n        this.pushLazyRedraw(canvas, x, c, r);\n      }\n      const shift = c.width + COLUMN_PADDING;\n      x += shift;\n      ctx.translate(shift, 0);\n    };\n\n    for (const col of this.visibleColumns.frozen) {\n      renderCellImpl(col);\n    }\n    for (let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\n      renderCellImpl(col);\n    }\n    ctx.restore();\n\n    const visibleElements = node.childElementCount - 1; // for canvas\n\n    if (domColumns.length === 0) {\n      while (node.lastElementChild !== node.firstElementChild) {\n        const n = node.lastElementChild! as HTMLElement;\n        node.removeChild(n);\n        this.recycleCell(n);\n      }\n      return;\n    }\n    if (domColumns.length === 1) {\n      const first = domColumns[0];\n      if (visibleElements === 0) {\n        const item = this.createCellHandled(first, index);\n        item.classList.add(cssClass('low'));\n        node.appendChild(item);\n        return;\n      }\n      const firstDOM = node.lastElementChild! as HTMLElement;\n      if (visibleElements === 1 && firstDOM.dataset.colId === first.id) {\n        const isLoading = isLoadingCell(firstDOM);\n        if (isLoading) {\n          const item = this.createCellHandled(first, index);\n          node.replaceChild(item, firstDOM);\n          this.recycleCell(firstDOM, first.index);\n          return;\n        }\n        this.updateCellImpl(first, node.lastElementChild as HTMLElement, index);\n        return;\n      }\n    }\n\n    const existing = new Map((Array.from(node.children) as HTMLElement[]).slice(1).map((d) => [d.dataset.id, d]));\n    for (const col of domColumns) {\n      const elem = existing.get(col.id);\n      if (elem && !isLoadingCell(elem)) {\n        existing.delete(col.id);\n        this.updateCellImpl(col, elem, index);\n      } else {\n        const c = this.createCellHandled(col, index);\n        c.classList.add(cssClass('low'));\n        node.appendChild(c);\n      }\n    }\n    existing.forEach((v) => {\n      v.remove();\n      this.recycleCell(v);\n    });\n  }\n\n  protected updateCanvasCell(\n    canvas: HTMLCanvasElement,\n    node: HTMLElement,\n    index: number,\n    column: RenderColumn,\n    x: number\n  ) {\n    // delete lazy that would render the same thing\n    if (this.loadingCanvas.has(canvas)) {\n      const l = this.loadingCanvas.get(canvas)!;\n      const me = l.filter((d) => d.col === column.index);\n      if (me.length > 0) {\n        this.loadingCanvas.set(\n          canvas,\n          l.filter((d) => d.col !== column.index)\n        );\n        for (const a of me) {\n          a.render.abort();\n        }\n      }\n    }\n\n    const ctx = canvas.getContext('2d')!;\n    ctx.clearRect(x - 1, 0, column.width + 2, canvas.height);\n    ctx.save();\n    ctx.translate(x, 0);\n    const needDOM = column.renderCell(ctx, index);\n    ctx.restore();\n\n    if (typeof needDOM !== 'boolean' && isAbortAble(needDOM)) {\n      this.pushLazyRedraw(canvas, x, column, needDOM);\n    }\n\n    if (needDOM !== true && node.childElementCount === 1) {\n      // just canvas\n      return;\n    }\n    const elem = node.querySelector<HTMLElement>(`[data-id=\"${column.id}\"]`);\n    if (elem && !needDOM) {\n      elem.remove();\n      this.recycleCell(elem, column.index);\n      return;\n    }\n    if (elem) {\n      return this.updateCellImpl(column, elem, index);\n    }\n\n    const c = this.createCellHandled(column, index);\n    c.classList.add(cssClass('low'));\n    node.appendChild(c);\n  }\n\n  private reindex() {\n    this.columns.forEach((c, i) => {\n      c.index = i;\n    });\n  }\n\n  updateAll() {\n    this.columns.forEach((c, i) => {\n      c.index = i;\n      c.renderers = this.ctx.createRenderer(c.c);\n    });\n\n    this._context = Object.assign({}, this._context, {\n      column: nonUniformContext(\n        this.columns.map((w) => w.width),\n        100,\n        COLUMN_PADDING\n      ),\n    });\n\n    this.updateColumnSummaryFlag();\n\n    this.events.fire(EngineRanking.EVENT_RECREATE);\n    super.recreate();\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\n  }\n\n  updateBody() {\n    if (this.hidden) {\n      return;\n    }\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\n    super.forEachRow((row, rowIndex) => this.updateRow(row, rowIndex));\n  }\n\n  updateHeaderOf(col: Column) {\n    const i = this._context.columns.findIndex((d) => d.c === col);\n    if (i < 0) {\n      return false;\n    }\n    const node = this.header.children[i]! as HTMLElement;\n    const column = this._context.columns[i];\n    if (node && column) {\n      this.updateHeader(node, column);\n    }\n    this.updateColumnSummaryFlag();\n    return node && column;\n  }\n\n  protected createRow(node: HTMLElement, rowIndex: number): void {\n    node.classList.add(this.style.cssClasses.tr);\n    this.roptions.customRowUpdate(node, rowIndex);\n    if (this.highlightHandler.enabled) {\n      node.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\n      this.rowFlags(node).highlight = true;\n    }\n\n    const isGroup = this.renderCtx.isGroup(rowIndex);\n\n    const meta = this.toRowMeta(rowIndex);\n    if (!meta) {\n      delete node.dataset.meta;\n    } else {\n      node.dataset.meta = meta;\n    }\n\n    if (isGroup) {\n      node.dataset.agg = 'group';\n      super.createRow(node, rowIndex);\n      return;\n    }\n\n    const { dataIndex } = this.renderCtx.getRow(rowIndex);\n    node.classList.toggle(engineCssClass('highlighted'), this.highlight === dataIndex);\n    node.dataset.i = dataIndex.toString();\n    node.dataset.agg = 'detail'; //or 'group'\n\n    this.selection.updateState(node, dataIndex);\n    this.selection.add(node);\n\n    const low = this.roptions.levelOfDetail(rowIndex) === 'low';\n    node.classList.toggle(cssClass('low'), low);\n\n    if (!low || this.ctx.provider.isSelected(dataIndex)) {\n      super.createRow(node, rowIndex);\n      return;\n    }\n\n    const canvas = this.selectCanvas();\n    node.appendChild(canvas);\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, PASSIVE);\n    this.renderRow(canvas, node, rowIndex);\n  }\n\n  protected updateRow(node: HTMLElement, rowIndex: number, hoverLod?: 'high' | 'low'): void {\n    this.roptions.customRowUpdate(node, rowIndex);\n\n    const computedLod = this.roptions.levelOfDetail(rowIndex);\n    const low = (hoverLod ? hoverLod : computedLod) === 'low';\n    const wasLow = node.classList.contains(cssClass('low'));\n    const isGroup = this.renderCtx.isGroup(rowIndex);\n    const wasGroup = node.dataset.agg === 'group';\n\n    node.classList.toggle(cssClass('low'), computedLod === 'low');\n\n    if (this.highlightHandler.enabled && !this.rowFlags(node).highlight) {\n      node.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\n      this.rowFlags(node).highlight = true;\n    }\n\n    if (isGroup !== wasGroup) {\n      // change of mode clear the children to reinitialize them\n      clear(node);\n\n      // adapt body\n      node.dataset.agg = isGroup ? 'group' : 'detail';\n      if (isGroup) {\n        node.dataset.i = '';\n        this.selection.remove(node);\n      } else {\n        this.selection.add(node);\n      }\n    }\n\n    if (wasLow && (!computedLod || isGroup)) {\n      node.removeEventListener('mouseenter', this.canvasMouseHandler.enter);\n    }\n\n    const meta = this.toRowMeta(rowIndex);\n    if (!meta) {\n      delete node.dataset.meta;\n    } else {\n      node.dataset.meta = meta;\n    }\n\n    if (isGroup) {\n      node.classList.remove(engineCssClass('highlighted'));\n      super.updateRow(node, rowIndex);\n      return;\n    }\n\n    const { dataIndex } = this.renderCtx.getRow(rowIndex);\n    node.classList.toggle(engineCssClass('highlighted'), this.highlight === dataIndex);\n    node.dataset.i = dataIndex.toString();\n    this.selection.updateState(node, dataIndex);\n\n    const canvas =\n      wasLow && node.firstElementChild!.nodeName.toLowerCase() === 'canvas'\n        ? (node.firstElementChild! as HTMLCanvasElement)\n        : null;\n    if (!low || this.ctx.provider.isSelected(dataIndex)) {\n      if (canvas) {\n        this.recycleCanvas(canvas);\n        clear(node);\n        node.removeEventListener('mouseenter', this.canvasMouseHandler.enter);\n      }\n      super.updateRow(node, rowIndex);\n      return;\n    }\n\n    // use canvas\n    if (wasLow && canvas) {\n      this.renderRow(canvas, node, rowIndex);\n      return;\n    }\n    // clear old\n    clear(node);\n    node.dataset.agg = 'detail';\n    const canvas2 = this.selectCanvas();\n    node.appendChild(canvas2);\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, PASSIVE);\n    this.renderRow(canvas2, node, rowIndex);\n  }\n\n  private updateCanvasBody() {\n    this.updateCanvasRule();\n    super.forEachRow((row, index) => {\n      if (EngineRanking.isCanvasRenderedRow(row)) {\n        this.renderRow(row.firstElementChild! as HTMLCanvasElement, row, index);\n      }\n    });\n  }\n\n  private toRowMeta(rowIndex: number) {\n    const provider = this.renderCtx.provider;\n    const topNGetter = (group: IGroup) => provider.getTopNAggregated(this.ranking, group);\n    return toRowMeta(this.renderCtx.getRow(rowIndex), provider.getAggregationStrategy(), topNGetter);\n  }\n\n  private updateCanvasRule() {\n    this.style.updateRule(`renderCanvas${this.tableId}`, `.${cssClass(`low-c${this.tableId}`)}`, {\n      transform: `translateX(${this.currentCanvasShift}px)`,\n      width: `${this.currentCanvasWidth}px`,\n    });\n  }\n\n  protected updateShifts(top: number, left: number) {\n    super.updateShifts(top, left);\n\n    const width = this.visibleRenderedWidth();\n    if (left === this.currentCanvasShift && width === this.currentCanvasWidth) {\n      return;\n    }\n\n    this.currentCanvasShift = left;\n    this.currentCanvasWidth = width;\n    this.updateCanvasBody();\n  }\n\n  private recycleCanvas(canvas: HTMLCanvasElement) {\n    if (this.loadingCanvas.has(canvas)) {\n      for (const a of this.loadingCanvas.get(canvas)!) {\n        a.render.abort();\n      }\n      this.loadingCanvas.delete(canvas);\n    } else if (!canvas.classList.contains(cssClass('loading-c'))) {\n      this.canvasPool.push(canvas);\n    }\n  }\n\n  enableHighlightListening(enable: boolean) {\n    if (this.highlightHandler.enabled === enable) {\n      return;\n    }\n\n    this.highlightHandler.enabled = enable;\n\n    if (enable) {\n      this.body.addEventListener('mouseleave', this.highlightHandler.leave, PASSIVE);\n      super.forEachRow((row) => {\n        row.addEventListener('mouseenter', this.highlightHandler.enter, PASSIVE);\n        this.rowFlags(row).highlight = true;\n      });\n      return;\n    }\n\n    this.body.removeEventListener('mouseleave', this.highlightHandler.leave);\n\n    super.forEachRow((row) => {\n      row.removeEventListener('mouseenter', this.highlightHandler.enter);\n      this.rowFlags(row).highlight = false;\n    });\n  }\n\n  private updateHoveredRow(row: HTMLElement, hover: boolean) {\n    const isCanvas = EngineRanking.isCanvasRenderedRow(row);\n    if (isCanvas !== hover) {\n      return; // good nothing to do\n    }\n    const index = Number.parseInt(row.dataset.index!, 10);\n    this.updateRow(row, index, hover ? 'high' : 'low');\n  }\n\n  protected forEachRow(callback: (row: HTMLElement, rowIndex: number) => void, inplace = false) {\n    const adapter = (row: HTMLElement, rowIndex: number) => {\n      if (EngineRanking.isCanvasRenderedRow(row)) {\n        // skip canvas\n        return;\n      }\n      callback(row, rowIndex);\n    };\n    return super.forEachRow(adapter, inplace);\n  }\n\n  updateSelection(selectedDataIndices: { has(i: number): boolean }) {\n    super.forEachRow((node: HTMLElement, rowIndex: number) => {\n      if (this.renderCtx.isGroup(rowIndex)) {\n        this.updateRow(node, rowIndex);\n      } else {\n        // fast pass for item\n        this.selection.update(node, selectedDataIndices);\n      }\n    }, true);\n  }\n\n  updateColumnWidths() {\n    // update the column context in place\n    (this._context as any).column = nonUniformContext(\n      this._context.columns.map((w) => w.width),\n      100,\n      COLUMN_PADDING\n    );\n    super.updateColumnWidths();\n    const { columns } = this.context;\n    //no data update needed since just width changed\n    columns.forEach((column) => {\n      if (column instanceof MultiLevelRenderColumn) {\n        column.updateWidthRule(this.style);\n      }\n      column.renderers = this.ctx.createRenderer(column.c);\n    });\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\n  }\n\n  private updateColumn(index: number) {\n    const columns = this.context.columns;\n    const column = columns[index];\n    if (!column) {\n      return false;\n    }\n    let x = 0;\n    for (let i = this.visibleColumns.first; i < index; ++i) {\n      x += columns[i].width + COLUMN_PADDING;\n    }\n    super.forEachRow((row, rowIndex) => {\n      if (EngineRanking.isCanvasRenderedRow(row)) {\n        this.updateCanvasCell(row.firstElementChild! as HTMLCanvasElement, row, rowIndex, column, x);\n        return;\n      }\n      this.updateCellImpl(column, row.children[index] as HTMLElement, rowIndex);\n    });\n    return true;\n  }\n\n  private updateCellImpl(column: RenderColumn, before: HTMLElement, rowIndex: number) {\n    if (!before) {\n      return; // race condition\n    }\n    const r = this.updateCell(before, rowIndex, column);\n    let after: HTMLElement;\n    if (isAsyncUpdate(r)) {\n      after = this.handleCellReady(r.item, r.ready, column.index);\n    } else {\n      after = r;\n    }\n    if (before === after || !after) {\n      return;\n    }\n    this.initCellClasses(after, column.id);\n    before.parentElement!.replaceChild(after, before);\n  }\n\n  private initCellClasses(node: HTMLElement, id: string) {\n    node.dataset.id = id;\n    node.classList.add(engineCssClass('td'), this.style.cssClasses.td, engineCssClass(`td-${this.tableId}`));\n  }\n\n  destroy() {\n    super.destroy();\n    this.style.deleteRule(`hoverOnly${this.tableId}`);\n    this.style.deleteRule(`renderCanvas${this.tableId}`);\n    this.ranking.flatColumns.forEach((c) => EngineRanking.disableListener(c));\n  }\n\n  groupData(): (IGroupItem | IGroupData)[] {\n    const groups = this.ranking.getGroups();\n    const provider = this.ctx.provider;\n    const strategy = provider.getAggregationStrategy();\n    const alwaysShowGroup = isAlwaysShowingGroupStrategy(strategy);\n\n    const r: (IGroupItem | IGroupData)[] = [];\n\n    if (groups.length === 0) {\n      return r;\n    }\n\n    const pushItem = (group: IOrderedGroup, dataIndex: number, i: number) => {\n      r.push({\n        group,\n        dataIndex,\n        relativeIndex: i,\n      });\n    };\n\n    if (groups.length === 1 && groups[0].name === defaultGroup.name) {\n      const group = groups[0];\n      const l = group.order.length;\n      for (let i = 0; i < l; ++i) {\n        pushItem(group, group.order[i], i);\n      }\n      return r;\n    }\n\n    const roots = groupRoots(groups);\n\n    const pushGroup = (group: IOrderedGroup | Readonly<IGroupParent>) => {\n      const n = provider.getTopNAggregated(this.ranking, group);\n\n      // all are IOrderedGroup since propagated\n      const ordered = group as IOrderedGroup;\n      const gparent = group as IGroupParent;\n\n      if (n === 0 || alwaysShowGroup) {\n        r.push(ordered);\n      }\n\n      if (n !== 0 && Array.isArray(gparent.subGroups) && gparent.subGroups.length > 0) {\n        for (const g of gparent.subGroups) {\n          pushGroup(g as IOrderedGroup | Readonly<IGroupParent>);\n        }\n        return;\n      }\n\n      const l = n < 0 ? ordered.order.length : Math.min(n, ordered.order.length);\n      for (let i = 0; i < l; ++i) {\n        pushItem(ordered, ordered.order[i], i);\n      }\n    };\n\n    for (const root of roots) {\n      pushGroup(root);\n    }\n\n    return r;\n  }\n\n  render(data: (IGroupItem | IGroupData)[], rowContext: IExceptionContext) {\n    const previous = this._context;\n    const previousData = this.data;\n    this.data = data;\n\n    this.columns.forEach((c, i) => {\n      c.index = i;\n      c.renderers = this.ctx.createRenderer(c.c);\n    });\n    this._context = Object.assign(\n      {\n        columns: this.columns,\n        column: nonUniformContext(\n          this.columns.map((w) => w.width),\n          100,\n          COLUMN_PADDING\n        ),\n      },\n      rowContext\n    );\n\n    if (!this.bodyScroller) {\n      // somehow not part of dom\n      return;\n    }\n    this.events.fire(EngineRanking.EVENT_RECREATE);\n    return super.recreate(this.roptions.animation ? lineupAnimation(previous, previousData, this.data) : undefined);\n  }\n\n  setHighlight(dataIndex: number) {\n    this.highlight = dataIndex;\n    const old = this.body.querySelector(`[data-i].${engineCssClass('highlighted')}`);\n    if (old) {\n      old.classList.remove(engineCssClass('highlighted'));\n    }\n    if (dataIndex < 0) {\n      return false;\n    }\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (item) {\n      item.classList.add(engineCssClass('highlighted'));\n    }\n    return item != null;\n  }\n\n  findNearest(dataIndices: number[]) {\n    // find the nearest visible data index\n    // first check if already visible\n    const index = dataIndices.find((d) => Boolean(this.body.querySelectorAll(`[data-i=\"${d}\"]`)));\n    if (index != null) {\n      return index; // visible one\n    }\n    const visible = this.visible;\n    const lookFor = new Set(dataIndices);\n    let firstBeforePos = -1;\n    let firstAfterPos = -1;\n    for (let i = visible.first; i >= 0; --i) {\n      const d = this.data[i];\n      if (!isGroup(d) && lookFor.has(d.dataIndex)) {\n        firstBeforePos = i;\n        break;\n      }\n    }\n    for (let i = visible.last; i < this.data.length; ++i) {\n      const d = this.data[i];\n      if (!isGroup(d) && lookFor.has(d.dataIndex)) {\n        firstAfterPos = i;\n        break;\n      }\n    }\n\n    if (firstBeforePos < 0 && firstBeforePos < 0) {\n      return -1; // not found at all\n    }\n    const nearestPos =\n      firstBeforePos >= 0 && visible.first - firstBeforePos < firstAfterPos - visible.last\n        ? firstBeforePos\n        : firstAfterPos;\n    return (this.data[nearestPos] as IGroupItem).dataIndex;\n  }\n\n  scrollIntoView(dataIndex: number) {\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (item) {\n      item.scrollIntoView(true);\n      return true;\n    }\n    const index = this.data.findIndex((d) => !isGroup(d) && d.dataIndex === dataIndex);\n    if (index < 0) {\n      return false; // part of a group?\n    }\n\n    const posOf = () => {\n      const c = this._context;\n      if (c.exceptions.length === 0 || index < c.exceptions[0].index) {\n        // fast pass\n        return index * c.defaultRowHeight;\n      }\n      const before = c.exceptions.reverse().find((d) => d.index <= index);\n      if (!before) {\n        return -1;\n      }\n      if (before.index === index) {\n        return before.y;\n      }\n      const regular = index - before.index - 1;\n      return before.y2 + regular * c.defaultRowHeight;\n    };\n    const pos = posOf();\n    if (pos < 0) {\n      return false;\n    }\n    const scroller = this.bodyScroller;\n    if (!scroller) {\n      return false;\n    }\n    const top = scroller.scrollTop;\n    scroller.scrollTop = Math.min(pos, scroller.scrollHeight - scroller.clientHeight);\n    this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, top < scroller.scrollTop);\n\n    const found = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (found) {\n      found.scrollIntoView(true);\n      return true;\n    }\n    return false;\n  }\n\n  getHighlight() {\n    const item = this.body.querySelector<HTMLElement>(`[data-i]:hover, [data-i].${engineCssClass('highlighted')}`);\n    if (item) {\n      return Number.parseInt(item.dataset.i!, 10);\n    }\n    return this.highlight;\n  }\n\n  private createCol(c: Column, index: number) {\n    const col =\n      isMultiLevelColumn(c) && !c.getCollapsed()\n        ? new MultiLevelRenderColumn(c, index, this.renderCtx, this.roptions.flags)\n        : new RenderColumn(c, index, this.renderCtx, this.roptions.flags);\n\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, () => {\n      // replace myself upon width change since we renderers are allowed to\n      col.renderers = this.ctx.createRenderer(c);\n      this.delayedUpdateColumnWidths();\n    });\n    const debounceUpdate = debounce(() => {\n      const valid = this.updateColumn(col.index);\n      if (!valid) {\n        EngineRanking.disableListener(c); // destroy myself\n      }\n    }, 25);\n    c.on([`${Column.EVENT_RENDERER_TYPE_CHANGED}.body`, `${Column.EVENT_GROUP_RENDERER_TYPE_CHANGED}.body`], () => {\n      // replace myself upon renderer type change\n      col.renderers = this.ctx.createRenderer(c);\n      debounceUpdate();\n    });\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const that = this;\n    c.on(`${Column.EVENT_DIRTY_HEADER}.body`, function (this: IEventContext) {\n      const valid = that.updateHeaderOf(col.c);\n      if (!valid) {\n        EngineRanking.disableListener(c); // destroy myself\n      }\n    });\n    c.on(suffix('.body', Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES), () => {\n      // replace myself upon renderer type change\n      col.renderers = this.ctx.createRenderer(c);\n      const valid = this.updateHeaderOf(col.c);\n      if (!valid) {\n        EngineRanking.disableListener(c); // destroy myself\n      }\n    });\n    c.on(`${Column.EVENT_DIRTY_VALUES}.body`, debounceUpdate);\n\n    if (isMultiLevelColumn(c)) {\n      c.on(`${StackColumn.EVENT_COLLAPSE_CHANGED}.body`, () => {\n        // rebuild myself from scratch\n        EngineRanking.disableListener(c); // destroy myself\n        const index = col.index;\n        const replacement = this.createCol(c, index);\n        replacement.index = index;\n        this.columns.splice(index, 1, replacement);\n        this.delayedUpdateAll();\n      });\n      if (!c.getCollapsed()) {\n        (col as MultiLevelRenderColumn).updateWidthRule(this.style);\n        c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, () => {\n          (col as MultiLevelRenderColumn).updateWidthRule(this.style);\n        });\n        c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, debounceUpdate);\n      }\n    }\n\n    return col;\n  }\n\n  private static isCanvasRenderedRow(row: HTMLElement) {\n    return (\n      row.classList.contains(cssClass('low')) &&\n      row.childElementCount >= 1 &&\n      row.firstElementChild!.nodeName.toLowerCase() === 'canvas'\n    );\n  }\n\n  private static disableListener(c: Column) {\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, null);\n    c.on(\n      suffix(\n        '.body',\n        Column.EVENT_RENDERER_TYPE_CHANGED,\n        Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\n        Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\n        Column.EVENT_DIRTY_CACHES,\n        Column.EVENT_LABEL_CHANGED\n      ),\n      null\n    );\n    c.on(`${Ranking.EVENT_DIRTY_HEADER}.body`, null);\n    c.on(`${Ranking.EVENT_DIRTY_VALUES}.body`, null);\n\n    if (!isMultiLevelColumn(c)) {\n      return;\n    }\n    c.on(`${StackColumn.EVENT_COLLAPSE_CHANGED}.body`, null);\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, null);\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, null);\n  }\n}\n","import type { ILineUpFlags } from '../config';\nimport type { Column, IGroupData, IGroupItem } from '../model';\nimport type { IDataProvider } from '../provider';\nimport type { IImposer, IRenderContext, ISummaryRenderer } from '../renderer';\nimport type DialogManager from './dialogs/DialogManager';\nimport type { IDialogContext } from './dialogs';\n\nexport interface IUIOptions {\n  /**\n   * whether to show this action as a shortcut action\n   * @default 'menu'\n   */\n  mode:\n    | 'menu'\n    | 'menu+shortcut'\n    | 'shortcut'\n    | ((col: Column, mode: 'sidePanel' | 'header') => 'menu' | 'menu+shortcut' | 'shortcut');\n\n  /**\n   * order hint for sorting actions\n   * @default 50\n   */\n  order: number;\n\n  featureLevel: 'basic' | 'advanced';\n  featureCategory: 'ranking' | 'model' | 'ui';\n}\n\nexport interface IOnClickHandler {\n  (col: Column, evt: MouseEvent, ctx: IRankingHeaderContext, level: number, viaShortcut: boolean): any;\n}\n\nexport interface IToolbarAction {\n  title: string;\n\n  enabled?(col: Column): boolean;\n\n  onClick: IOnClickHandler;\n\n  options: Partial<IUIOptions>;\n}\n\nexport interface IToolbarDialogAddonHandler {\n  elems: string | (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[];\n  reset(): void;\n  submit(): boolean | undefined;\n  cancel(): void;\n}\n\nexport interface IToolbarDialogAddon {\n  title: string;\n\n  order: number;\n\n  append(\n    col: Column,\n    node: HTMLElement,\n    dialog: IDialogContext,\n    ctx: IRankingHeaderContext\n  ): IToolbarDialogAddonHandler;\n}\n\nexport interface IRenderInfo {\n  type: string;\n  label: string;\n}\n\nexport interface IRankingHeaderContextContainer {\n  readonly idPrefix: string;\n  readonly document: Document;\n  readonly provider: IDataProvider;\n\n  readonly dialogManager: DialogManager;\n\n  asElement(html: string): HTMLElement;\n\n  resolveToolbarActions(col: Column, keys: string[]): IToolbarAction[];\n  resolveToolbarDialogAddons(col: Column, keys: string[]): IToolbarDialogAddon[];\n\n  readonly flags: ILineUpFlags;\n\n  getPossibleRenderer(col: Column): { item: IRenderInfo[]; group: IRenderInfo[]; summary: IRenderInfo[] };\n\n  summaryRenderer(co: Column, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\n\n  readonly caches: {\n    toolbar: Map<string, IToolbarAction[]>;\n    toolbarAddons: Map<string, IToolbarDialogAddon[]>;\n  };\n}\n\nexport interface IRankingBodyContext extends IRankingHeaderContextContainer, IRenderContext {\n  isGroup(index: number): boolean;\n\n  getGroup(index: number): IGroupData;\n\n  getRow(index: number): IGroupItem;\n}\n\nexport declare type IRankingHeaderContext = Readonly<IRankingHeaderContextContainer>;\n\nexport declare type IRankingContext = Readonly<IRankingBodyContext>;\n\nexport enum EMode {\n  ITEM = 'item',\n  BAND = 'band',\n}\n","import { IExceptionContext, ITableSection, range } from 'lineupengine';\nimport { IGroupData, IGroupItem, IOrderedGroup, isGroup, Ranking } from '../model';\nimport { aria, cssClass, engineCssClass, SLOPEGRAPH_WIDTH } from '../styles';\nimport { IRankingHeaderContextContainer, EMode } from './interfaces';\nimport { forEachIndices, filterIndices } from '../model/internal';\n\ninterface ISlope {\n  isSelected(selection: { has(dataIndex: number): boolean }): boolean;\n\n  update(path: SVGPathElement, width: number): void;\n\n  readonly dataIndices: number[];\n}\n\nclass ItemSlope implements ISlope {\n  constructor(private readonly left: number, private readonly right: number, public readonly dataIndices: number[]) {}\n\n  isSelected(selection: { has(dataIndex: number): boolean }) {\n    return this.dataIndices.length === 1\n      ? selection.has(this.dataIndices[0])\n      : this.dataIndices.some((s) => selection.has(s));\n  }\n\n  update(path: SVGPathElement, width: number) {\n    path.setAttribute('data-i', String(this.dataIndices[0]));\n    path.setAttribute('class', cssClass('slope'));\n    path.setAttribute('d', `M0,${this.left}L${width},${this.right}`);\n  }\n}\n\nclass GroupSlope implements ISlope {\n  constructor(\n    private readonly left: [number, number],\n    private readonly right: [number, number],\n    public readonly dataIndices: number[]\n  ) {}\n\n  isSelected(selection: { has(dataIndex: number): boolean }) {\n    return this.dataIndices.some((s) => selection.has(s));\n  }\n\n  update(path: SVGPathElement, width: number) {\n    path.setAttribute('class', cssClass('group-slope'));\n    path.setAttribute('d', `M0,${this.left[0]}L${width},${this.right[0]}L${width},${this.right[1]}L0,${this.left[1]}Z`);\n  }\n}\n\ninterface IPos {\n  start: number;\n  heightPerRow: number;\n  rows: number[]; // data indices\n  offset: number;\n  ref: number[];\n  group: IOrderedGroup;\n}\n\nexport interface ISlopeGraphOptions {\n  mode: EMode;\n}\n\nexport default class SlopeGraph implements ITableSection {\n  readonly node: SVGSVGElement;\n\n  private leftSlopes: ISlope[][] = [];\n  // rendered row to one ore multiple slopes\n  private rightSlopes: ISlope[][] = [];\n  private readonly pool: SVGPathElement[] = [];\n\n  private scrollListener: ((act: { top: number; height: number }) => void) | null = null;\n\n  readonly width = SLOPEGRAPH_WIDTH;\n  readonly height = 0;\n\n  private current: {\n    leftRanking: Ranking;\n    left: (IGroupItem | IGroupData)[];\n    leftContext: IExceptionContext;\n    rightRanking: Ranking;\n    right: (IGroupItem | IGroupData)[];\n    rightContext: IExceptionContext;\n  } | null = null;\n\n  private chosen = new Set<ISlope>();\n  private chosenSelectionOnly = new Set<ISlope>();\n\n  private _mode: EMode = EMode.ITEM;\n\n  constructor(\n    public readonly header: HTMLElement,\n    public readonly body: HTMLElement,\n    public readonly id: string,\n    private readonly ctx: IRankingHeaderContextContainer,\n    options: Partial<ISlopeGraphOptions> = {}\n  ) {\n    this.node = header.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    this.node.innerHTML = `<g transform=\"translate(0,0)\"></g>`;\n    header.classList.add(cssClass('slopegraph-header'));\n    this._mode = options.mode === EMode.BAND ? EMode.BAND : EMode.ITEM;\n    this.initHeader(header);\n    body.classList.add(cssClass('slopegraph'));\n    this.body.style.height = `1px`;\n    body.appendChild(this.node);\n  }\n\n  init() {\n    this.hide(); // hide by default\n\n    const scroller = this.body.parentElement! as any;\n\n    //sync scrolling of header and body\n    // use internals from lineup engine\n    const scroll = scroller.__le_scroller__;\n    let old: { top: number; height: number } = scroll.asInfo();\n    scroll.push(\n      'animation',\n      (this.scrollListener = (act: { top: number; height: number }) => {\n        if (Math.abs(old.top - act.top) < 5) {\n          return;\n        }\n        old = act;\n        this.onScrolledVertically(act.top, act.height);\n      })\n    );\n  }\n\n  private initHeader(header: HTMLElement) {\n    const active = cssClass('active');\n    header.innerHTML = `<i title=\"Item\" class=\"${this._mode === EMode.ITEM ? active : ''}\">${aria('Item')}</i>\n        <i title=\"Band\" class=\"${this._mode === EMode.BAND ? active : ''}\">${aria('Band')}</i>`;\n\n    const icons = Array.from(header.children) as HTMLElement[];\n    icons.forEach((n: HTMLElement, i) => {\n      n.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        if (n.classList.contains(active)) {\n          return;\n        }\n        this.mode = i === 0 ? EMode.ITEM : EMode.BAND;\n        icons.forEach((d, j) => d.classList.toggle(active, j === i));\n      };\n    });\n  }\n\n  get mode() {\n    return this._mode;\n  }\n\n  set mode(value: EMode) {\n    if (value === this._mode) {\n      return;\n    }\n    this._mode = value;\n    if (this.current) {\n      this.rebuild(\n        this.current.leftRanking,\n        this.current.left,\n        this.current.leftContext,\n        this.current.rightRanking,\n        this.current.right,\n        this.current.rightContext\n      );\n    }\n  }\n\n  get hidden() {\n    return this.header.classList.contains(engineCssClass('loading'));\n  }\n\n  set hidden(value: boolean) {\n    this.header.classList.toggle(engineCssClass('loading'), value);\n    this.body.classList.toggle(engineCssClass('loading'), value);\n  }\n\n  hide() {\n    this.hidden = true;\n  }\n\n  show() {\n    const was = this.hidden;\n    this.hidden = false;\n    if (was) {\n      this.revalidate();\n    }\n  }\n\n  destroy() {\n    this.header.remove();\n    if (this.scrollListener) {\n      //sync scrolling of header and body\n      // use internals from lineup engine\n      const scroll = (this.body.parentElement! as any).__le_scroller__;\n      scroll.remove(this.scrollListener);\n    }\n    this.body.remove();\n  }\n\n  rebuild(\n    leftRanking: Ranking,\n    left: (IGroupItem | IGroupData)[],\n    leftContext: IExceptionContext,\n    rightRanking: Ranking,\n    right: (IGroupItem | IGroupData)[],\n    rightContext: IExceptionContext\n  ) {\n    this.current = { leftRanking, left, leftContext, right, rightRanking, rightContext };\n\n    const lookup: Map<number, IPos> = this.prepareRightSlopes(right, rightContext);\n    this.computeSlopes(left, leftContext, lookup);\n\n    this.revalidate();\n  }\n\n  private computeSlopes(left: (IGroupItem | IGroupData)[], leftContext: IExceptionContext, lookup: Map<number, IPos>) {\n    const mode = this.mode;\n    const fakeGroups = new Map<IOrderedGroup, ISlope[]>();\n\n    const createFakeGroup = (first: number, group: IOrderedGroup) => {\n      let count = 0;\n      let height = 0;\n      // find all items in this group, assuming that they are in order\n      for (let i = first; i < left.length; ++i) {\n        const item = left[i];\n        if (isGroup(item) || (item as IGroupItem).group !== group) {\n          break;\n        }\n        count++;\n        height += leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight;\n      }\n\n      const padded = height - leftContext.padding(first + count - 1);\n\n      const gr = group;\n\n      return { gr, padded, height };\n    };\n\n    let acc = 0;\n    this.leftSlopes = left.map((r, i) => {\n      let height = leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight;\n      let padded = height - 0; //leftContext.padding(i);\n      const slopes: ISlope[] = [];\n      const start = acc;\n\n      // shift by item height\n      acc += height;\n\n      let offset = 0;\n\n      const push = (s: ISlope, right: IPos, common = 1, heightPerRow = 0) => {\n        // store slope in both\n        slopes.push(s);\n        forEachIndices(right.ref, (r) => this.rightSlopes[r].push(s));\n\n        // update the offset of myself and of the right side\n        right.offset += common * right.heightPerRow;\n        offset += common * heightPerRow;\n      };\n\n      let gr: IGroupData;\n\n      if (isGroup(r)) {\n        gr = r;\n      } else {\n        const item = r as IGroupItem;\n        const dataIndex = item.dataIndex;\n        const right = lookup.get(dataIndex);\n\n        if (!right) {\n          // no match\n          return slopes;\n        }\n        if (mode === EMode.ITEM) {\n          const s = new ItemSlope(start + padded / 2, right.start + right.offset + right.heightPerRow / 2, [dataIndex]);\n          push(s, right);\n          return slopes;\n        }\n\n        if (fakeGroups.has(item.group)) {\n          // already handled by the first one, take the fake slopes\n          return fakeGroups.get(item.group)!;\n        }\n\n        const fakeGroup = createFakeGroup(i, item.group);\n        gr = fakeGroup.gr;\n        height = fakeGroup.height;\n        padded = fakeGroup.padded;\n        fakeGroups.set(item.group, slopes);\n      }\n\n      // free group items to share\n      const free = new Set(gr.order);\n\n      const heightPerRow = padded / gr.order.length;\n\n      forEachIndices(gr.order, (d: number) => {\n        if (!free.has(d)) {\n          return; // already handled\n        }\n        free.delete(d);\n        const right = lookup.get(d);\n        if (!right) {\n          return; // no matching\n        }\n        // find all of this group\n        const intersection = filterIndices(right.rows, (r) => free.delete(r));\n        intersection.push(d); //self\n\n        const common = intersection.length;\n        let s: ISlope;\n        if (common === 1) {\n          s = new ItemSlope(start + offset + heightPerRow / 2, right.start + right.offset + right.heightPerRow / 2, [\n            d,\n          ]);\n        } else if (mode === EMode.ITEM) {\n          // fake item\n          s = new ItemSlope(\n            start + offset + (heightPerRow * common) / 2,\n            right.start + right.offset + (right.heightPerRow * common) / 2,\n            intersection\n          );\n        } else {\n          s = new GroupSlope(\n            [start + offset, start + offset + heightPerRow * common],\n            [right.start + right.offset, right.start + right.offset + right.heightPerRow * common],\n            intersection\n          );\n        }\n        push(s, right, common, heightPerRow);\n      });\n      return slopes;\n    });\n  }\n\n  private prepareRightSlopes(right: (IGroupItem | IGroupData)[], rightContext: IExceptionContext) {\n    const lookup = new Map<number, IPos>();\n    const mode = this.mode;\n\n    const fakeGroups = new Map<IOrderedGroup, IPos>();\n    let acc = 0;\n\n    this.rightSlopes = right.map((r, i) => {\n      const height = rightContext.exceptionsLookup.get(i) || rightContext.defaultRowHeight;\n      const padded = height - 0; //rightContext.padding(i);\n      const start = acc;\n      acc += height;\n      const slopes: ISlope[] = [];\n\n      const base = {\n        start,\n        offset: 0,\n        ref: [i],\n      };\n      if (isGroup(r)) {\n        const p = Object.assign(base, {\n          rows: Array.from(r.order),\n          heightPerRow: padded / r.order.length,\n          group: r,\n        });\n\n        forEachIndices(r.order, (ri) => lookup.set(ri, p));\n        return slopes;\n      }\n      // item\n      const item = r as IGroupItem;\n      const dataIndex = r.dataIndex;\n\n      let p = Object.assign(base, {\n        rows: [dataIndex],\n        heightPerRow: padded,\n        group: item.group,\n      });\n\n      if (mode === EMode.ITEM) {\n        lookup.set(dataIndex, p);\n        return slopes;\n      }\n      // forced band mode\n      // merge with the 'ueber' band\n      if (!fakeGroups.has(item.group)) {\n        p.heightPerRow = height; // include padding\n        // TODO just support uniform item height\n        fakeGroups.set(item.group, p);\n      } else {\n        // reuse old\n        p = fakeGroups.get(item.group)!;\n        p.rows.push(dataIndex);\n        p.ref.push(i);\n      }\n      lookup.set(dataIndex, p);\n      return slopes;\n    });\n\n    return lookup;\n  }\n\n  private revalidate() {\n    if (!this.current || this.hidden) {\n      return;\n    }\n    const p = this.body.parentElement!;\n    this.onScrolledVertically(p.scrollTop, p.clientHeight);\n  }\n\n  highlight(dataIndex: number) {\n    const highlight = engineCssClass('highlighted');\n    const old = this.body.querySelector(`[data-i].${highlight}`);\n    if (old) {\n      old.classList.remove(highlight);\n    }\n    if (dataIndex < 0) {\n      return false;\n    }\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\n    if (item) {\n      item.classList.add(highlight);\n    }\n    return item != null;\n  }\n\n  private onScrolledVertically(scrollTop: number, clientHeight: number) {\n    if (!this.current) {\n      return;\n    }\n\n    // which lines are currently shown\n    const { leftContext, rightContext } = this.current;\n    const left = range(\n      scrollTop,\n      clientHeight,\n      leftContext.defaultRowHeight,\n      leftContext.exceptions,\n      leftContext.numberOfRows\n    );\n    const right = range(\n      scrollTop,\n      clientHeight,\n      rightContext.defaultRowHeight,\n      rightContext.exceptions,\n      rightContext.numberOfRows\n    );\n\n    const start = Math.min(left.firstRowPos, right.firstRowPos);\n    const end = Math.max(left.endPos, right.endPos);\n\n    // move to right position\n    this.body.style.transform = `translate(0, ${start.toFixed(0)}px)`;\n    this.body.style.height = `${(end - start).toFixed(0)}px`;\n    this.node.firstElementChild!.setAttribute('transform', `translate(0,-${start.toFixed(0)})`);\n\n    this.chosen = this.choose(left.first, left.last, right.first, right.last);\n    this.render(this.chosen, this.chooseSelection(left.first, left.last, this.chosen));\n  }\n\n  private choose(\n    leftVisibleFirst: number,\n    leftVisibleLast: number,\n    rightVisibleFirst: number,\n    rightVisibleLast: number\n  ) {\n    // assume no separate scrolling\n\n    const slopes = new Set<ISlope>();\n    for (let i = leftVisibleFirst; i <= leftVisibleLast; ++i) {\n      for (const s of this.leftSlopes[i]) {\n        slopes.add(s);\n      }\n    }\n    for (let i = rightVisibleFirst; i <= rightVisibleLast; ++i) {\n      for (const s of this.rightSlopes[i]) {\n        slopes.add(s);\n      }\n    }\n    return slopes;\n  }\n\n  private chooseSelection(leftVisibleFirst: number, leftVisibleLast: number, alreadyVisible: Set<ISlope>) {\n    const slopes = new Set<ISlope>();\n    // ensure selected slopes are always part of\n    const p = this.ctx.provider;\n\n    if (p.getSelection().length === 0) {\n      return slopes;\n    }\n\n    const selectionLookup = { has: (dataIndex: number) => p.isSelected(dataIndex) };\n\n    // try all not visible ones\n    for (let i = 0; i < leftVisibleFirst; ++i) {\n      for (const s of this.leftSlopes[i]) {\n        if (s.isSelected(selectionLookup) && !alreadyVisible.has(s)) {\n          slopes.add(s);\n        }\n      }\n    }\n    for (let i = leftVisibleLast + 1; i < this.leftSlopes.length; ++i) {\n      for (const s of this.leftSlopes[i]) {\n        if (s.isSelected(selectionLookup) && !alreadyVisible.has(s)) {\n          slopes.add(s);\n        }\n      }\n    }\n    return slopes;\n  }\n\n  private updatePath(\n    p: SVGPathElement,\n    g: SVGGElement,\n    s: ISlope,\n    width: number,\n    selection: { has(dataIndex: number): boolean }\n  ) {\n    s.update(p, width);\n    (p as any).__data__ = s; // data binding\n    const selected = s.isSelected(selection);\n    p.classList.toggle(cssClass('selected'), selected);\n    if (selected) {\n      g.appendChild(p); // to put it on top\n    }\n  }\n\n  private render(visible: Set<ISlope>, selectionSlopes: Set<ISlope>) {\n    const g = this.node.firstElementChild! as SVGGElement;\n    const width = g.ownerSVGElement!.getBoundingClientRect()!.width;\n    const paths = this.matchLength(visible.size + selectionSlopes.size, g);\n\n    const p = this.ctx.provider;\n    const selectionLookup = { has: (dataIndex: number) => p.isSelected(dataIndex) };\n\n    // update paths\n    let i = 0;\n    const updatePath = (s: ISlope) => {\n      this.updatePath(paths[i++], g, s, width, selectionLookup);\n    };\n\n    visible.forEach(updatePath);\n    selectionSlopes.forEach(updatePath);\n  }\n\n  private addPath(g: SVGGElement) {\n    const elem = this.pool.pop();\n    if (elem) {\n      g.appendChild(elem);\n      return elem;\n    }\n\n    const path = g.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.onclick = (evt) => {\n      // d3 style\n      const s: ISlope = (path as any).__data__;\n      const p = this.ctx.provider;\n      const ids = s.dataIndices;\n      if (evt.ctrlKey) {\n        ids.forEach((id) => p.toggleSelection(id, true));\n      } else {\n        // either unset or set depending on the first state\n        const isSelected = p.isSelected(ids[0]!);\n        p.setSelection(isSelected ? [] : ids);\n      }\n    };\n    g.appendChild(path);\n    return path;\n  }\n\n  private matchLength(slopes: number, g: SVGGElement) {\n    const paths = Array.from(g.children) as SVGPathElement[];\n    for (let i = slopes; i < paths.length; ++i) {\n      const elem = paths[i];\n      this.pool.push(elem);\n      elem.remove();\n    }\n\n    for (let i = paths.length; i < slopes; ++i) {\n      paths.push(this.addPath(g));\n    }\n    return paths;\n  }\n\n  updateSelection(selectedDataIndices: Set<number>) {\n    const g = this.node.firstElementChild! as SVGGElement;\n    const paths = Array.from(g.children) as SVGPathElement[];\n\n    const openDataIndices = new Set(selectedDataIndices);\n\n    if (selectedDataIndices.size === 0) {\n      // clear\n      for (const p of paths) {\n        const s: ISlope = (p as any).__data__;\n        p.classList.toggle(cssClass('selected'), false);\n        if (this.chosenSelectionOnly.has(s)) {\n          p.remove();\n        }\n      }\n      this.chosenSelectionOnly.clear();\n      return;\n    }\n\n    for (const p of paths) {\n      const s: ISlope = (p as any).__data__;\n      const selected = s.isSelected(selectedDataIndices);\n      p.classList.toggle(cssClass('selected'), selected);\n      if (!selected) {\n        if (this.chosenSelectionOnly.delete(s)) {\n          // was only needed because of the selection\n          p.remove();\n        }\n        continue;\n      }\n\n      g.appendChild(p); // to put it on top\n      // remove already handled\n      s.dataIndices.forEach((d) => openDataIndices.delete(d));\n    }\n\n    if (openDataIndices.size === 0) {\n      return;\n    }\n\n    // find and add missing slopes\n    const width = g.ownerSVGElement!.getBoundingClientRect()!.width;\n    for (const ss of this.leftSlopes) {\n      for (const s of ss) {\n        if (this.chosen.has(s) || this.chosenSelectionOnly.has(s) || !s.isSelected(openDataIndices)) {\n          // not visible or not selected -> skip\n          continue;\n        }\n        // create new path for it\n        this.chosenSelectionOnly.add(s);\n        const p = this.addPath(g);\n        this.updatePath(p, g, s, width, openDataIndices);\n      }\n    }\n  }\n}\n","import { GridStyleManager, MultiTableRowRenderer, nonUniformContext } from 'lineupengine';\nimport type { ILineUpFlags, ILineUpOptions } from '../config';\nimport { AEventDispatcher, IEventListener, round, suffix } from '../internal';\nimport { Column, IGroupData, IGroupItem, isGroup, Ranking, IGroup } from '../model';\nimport { DataProvider } from '../provider';\nimport { isSummaryGroup, groupEndLevel } from '../provider/internal';\nimport type { IImposer, IRenderContext } from '../renderer';\nimport { chooseGroupRenderer, chooseRenderer, chooseSummaryRenderer, getPossibleRenderer } from '../renderer/renderers';\nimport { cssClass, engineCssClass } from '../styles';\nimport DialogManager from './dialogs/DialogManager';\nimport domElementCache from './domElementCache';\nimport EngineRanking, { IEngineRankingContext } from './EngineRanking';\nimport { EMode, IRankingHeaderContext, IRankingHeaderContextContainer } from './interfaces';\nimport SlopeGraph from './SlopeGraph';\nimport type { ADialog } from './dialogs';\n\n/**\n * emitted when the highlight changes\n * @asMemberOf EngineRenderer\n * @param dataIndex the highlghted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n\n/**\n * emitted a dialog is opened\n * @asMemberOf EngineRenderer\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpenedER(dialog: ADialog): void;\n/**\n * emitted a dialog is closed\n * @asMemberOf EngineRenderer\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosedER(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport default class EngineRenderer extends AEventDispatcher {\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRanking.EVENT_HIGHLIGHT_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = DialogManager.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = DialogManager.EVENT_DIALOG_CLOSED;\n\n  protected readonly options: Readonly<ILineUpOptions>;\n\n  readonly node: HTMLElement;\n  private readonly table: MultiTableRowRenderer;\n  private readonly rankings: EngineRanking[] = [];\n  private readonly slopeGraphs: SlopeGraph[] = [];\n\n  readonly ctx: IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext;\n\n  private readonly updateAbles: ((ctx: IRankingHeaderContext) => void)[] = [];\n  private zoomFactor = 1;\n  readonly idPrefix = `lu${Math.random().toString(36).slice(-8).substr(0, 3)}`; //generate a random string with length3;\n\n  private enabledHighlightListening = false;\n\n  constructor(protected data: DataProvider, parent: HTMLElement, options: Readonly<ILineUpOptions>) {\n    super();\n    this.options = options;\n    this.node = parent.ownerDocument!.createElement('main');\n    this.node.id = this.idPrefix;\n    // FIXME inline\n    this.node.classList.toggle(cssClass('whole-hover'), options.expandLineOnHover);\n    parent.appendChild(this.node);\n\n    const dialogManager = new DialogManager({\n      doc: parent.ownerDocument!,\n      livePreviews: options.livePreviews,\n      onDialogBackgroundClick: options.onDialogBackgroundClick,\n    });\n    this.forward(\n      dialogManager,\n      ...suffix('.main', EngineRenderer.EVENT_DIALOG_OPENED, EngineRenderer.EVENT_DIALOG_CLOSED)\n    );\n\n    parent.appendChild(dialogManager.node);\n    this.ctx = {\n      idPrefix: this.idPrefix,\n      document: parent.ownerDocument!,\n      provider: data,\n      tasks: data.getTaskExecutor(),\n      dialogManager,\n      resolveToolbarActions: (col, keys) => this.options.resolveToolbarActions(col, keys, this.options.toolbarActions),\n      resolveToolbarDialogAddons: (col, keys) =>\n        this.options.resolveToolbarDialogAddons(col, keys, this.options.toolbarDialogAddons),\n      flags: this.options.flags as ILineUpFlags,\n      asElement: domElementCache(parent.ownerDocument!),\n      renderer: (col: Column, imposer?: IImposer) => {\n        const r = chooseRenderer(col, this.options.renderers);\n        return r.create!(col, this.ctx, imposer);\n      },\n      groupRenderer: (col: Column, imposer?: IImposer) => {\n        const r = chooseGroupRenderer(col, this.options.renderers);\n        return r.createGroup!(col, this.ctx, imposer);\n      },\n      summaryRenderer: (col: Column, interactive: boolean, imposer?: IImposer) => {\n        const r = chooseSummaryRenderer(col, this.options.renderers);\n        return r.createSummary!(col, this.ctx, interactive, imposer);\n      },\n      createRenderer(col: Column, imposer?: IImposer) {\n        const single = this.renderer(col, imposer);\n        const group = this.groupRenderer(col, imposer);\n        const summary = options.summaryHeader ? this.summaryRenderer(col, false, imposer) : null;\n        return {\n          single,\n          group,\n          summary,\n          singleId: col.getRenderer(),\n          groupId: col.getGroupRenderer(),\n          summaryId: col.getSummaryRenderer(),\n          singleTemplate: null,\n          groupTemplate: null,\n          summaryTemplate: null,\n        };\n      },\n      getPossibleRenderer: (col: Column) => getPossibleRenderer(col, this.options.renderers, this.options.canRender),\n      colWidth: (col: Column) => (!col.isVisible() ? 0 : col.getWidth()),\n      caches: {\n        toolbar: new Map(),\n        toolbarAddons: new Map(),\n      },\n    };\n\n    this.table = new MultiTableRowRenderer(this.node, this.idPrefix);\n\n    {\n      // helper object for better resizing experience\n      const footer = this.table.node.querySelector(`.${engineCssClass('body')} .${engineCssClass('footer')}`)!;\n      const copy = footer.cloneNode(true) as HTMLElement;\n      copy.classList.add(cssClass('resize-helper'));\n      footer!.insertAdjacentElement('afterend', copy);\n    }\n\n    //apply rules\n    {\n      this.style.addRule(\n        'lineup_rowPadding0',\n        `\n        .${this.style.cssClasses.tr}`,\n        {\n          marginTop: `${options.rowPadding}px`,\n        }\n      );\n\n      for (let level = 0; level < 4; ++level) {\n        this.style.addRule(\n          `lineup_groupPadding${level}`,\n          `\n        .${this.style.cssClasses.tr}[data-meta~=last${level === 0 ? '' : level}]`,\n          {\n            marginBottom: `${options.groupPadding * (level + 1)}px`,\n          }\n        );\n      }\n\n      this.style.addRule(\n        'lineup_rowPaddingAgg0',\n        `\n        .${cssClass('agg-level')}::after`,\n        {\n          top: `-${options.rowPadding}px`,\n        }\n      );\n      for (let level = 1; level <= 4; ++level) {\n        this.style.addRule(\n          `lineup_rowPaddingAgg${level}`,\n          `\n        .${cssClass('agg-level')}[data-level='${level}']::after`,\n          {\n            top: `-${options.rowPadding + options.groupPadding}px`,\n          }\n        );\n      }\n\n      // FIXME flat\n      this.style.addRule(\n        'lineup_rotation',\n        `\n       #${this.idPrefix}.${cssClass('rotated-label')} .${cssClass('label')}.${cssClass('rotated')}`,\n        {\n          transform: `rotate(${-this.options.labelRotation}deg)`,\n        }\n      );\n\n      const toDisable: string[] = [];\n      if (!this.options.flags.advancedRankingFeatures) {\n        toDisable.push('ranking');\n      }\n      if (!this.options.flags.advancedModelFeatures) {\n        toDisable.push('model');\n      }\n      if (!this.options.flags.advancedUIFeatures) {\n        toDisable.push('ui');\n      }\n      if (toDisable.length > 0) {\n        this.style.addRule(\n          'lineup_feature_disable',\n          `\n        ${toDisable.map((d) => `.${cssClass('feature')}-${d}.${cssClass('feature-advanced')}`).join(', ')}`,\n          {\n            display: 'none !important',\n          }\n        );\n      }\n    }\n\n    this.initProvider(data);\n  }\n\n  get style(): GridStyleManager {\n    return this.table.style;\n  }\n\n  zoomOut() {\n    this.zoomFactor = Math.max(this.zoomFactor - 0.1, 0.5);\n    this.updateZoomFactor();\n    this.update();\n  }\n\n  zoomIn() {\n    this.zoomFactor = Math.min(this.zoomFactor + 0.1, 2.0);\n    this.updateZoomFactor();\n    this.update();\n  }\n\n  private updateZoomFactor() {\n    const body = this.node.querySelector<HTMLElement>('main')!;\n    body.style.fontSize = `${this.zoomFactor * 100}%`;\n  }\n\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\n    this.updateAbles.push(updateAble);\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        EngineRenderer.EVENT_HIGHLIGHT_CHANGED,\n        EngineRenderer.EVENT_DIALOG_OPENED,\n        EngineRenderer.EVENT_DIALOG_CLOSED,\n      ]);\n  }\n\n  on(type: typeof EngineRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: typeof EngineRenderer.EVENT_DIALOG_OPENED, listener: typeof dialogOpenedER | null): this;\n  on(type: typeof EngineRenderer.EVENT_DIALOG_CLOSED, listener: typeof dialogClosedER | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  setDataProvider(data: DataProvider) {\n    this.takeDownProvider();\n\n    this.data = data;\n    (this.ctx as any).provider = data;\n    (this.ctx as any).tasks = data.getTaskExecutor();\n\n    this.initProvider(data);\n  }\n\n  private takeDownProvider() {\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.body`, null);\n    this.data.on(`${DataProvider.EVENT_ADD_RANKING}.body`, null);\n    this.data.on(`${DataProvider.EVENT_REMOVE_RANKING}.body`, null);\n    this.data.on(`${DataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, null);\n    this.data.on(`${DataProvider.EVENT_SHOWTOPN_CHANGED}.body`, null);\n    this.data.on(`${DataProvider.EVENT_JUMP_TO_NEAREST}.body`, null);\n    this.data.on(`${DataProvider.EVENT_BUSY}.body`, null);\n\n    this.rankings.forEach((r) => this.table.remove(r));\n    this.rankings.splice(0, this.rankings.length);\n    this.slopeGraphs.forEach((s) => this.table.remove(s));\n    this.slopeGraphs.splice(0, this.slopeGraphs.length);\n  }\n\n  private initProvider(data: DataProvider) {\n    data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.body`, () => this.updateSelection(data.getSelection()));\n    data.on(`${DataProvider.EVENT_ADD_RANKING}.body`, (ranking: Ranking) => {\n      this.addRanking(ranking);\n    });\n    data.on(`${DataProvider.EVENT_REMOVE_RANKING}.body`, (ranking: Ranking) => {\n      this.removeRanking(ranking);\n    });\n    data.on(`${DataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, (ranking: Ranking) => {\n      this.update(this.rankings.filter((r) => r.ranking === ranking));\n    });\n    data.on(`${DataProvider.EVENT_SHOWTOPN_CHANGED}.body`, () => {\n      this.update(this.rankings);\n    });\n    data.on(`${DataProvider.EVENT_JUMP_TO_NEAREST}.body`, (indices: number[]) => {\n      this.setHighlightToNearest(indices, true);\n    });\n\n    (this.ctx as any).provider = data;\n\n    this.data.getRankings().forEach((r) => this.addRanking(r));\n  }\n\n  private updateSelection(dataIndices: number[]) {\n    const s = new Set(dataIndices);\n    this.rankings.forEach((r) => r.updateSelection(s));\n\n    this.slopeGraphs.forEach((r) => r.updateSelection(s));\n  }\n\n  private updateHist(ranking?: EngineRanking, col?: Column) {\n    if (!this.options.summaryHeader) {\n      return;\n    }\n    const rankings = ranking ? [ranking] : this.rankings;\n\n    for (const r of rankings) {\n      if (col) {\n        // single update\n        r.updateHeaderOf(col);\n      } else {\n        r.updateHeaders();\n      }\n    }\n    this.updateUpdateAbles();\n  }\n\n  private addRanking(ranking: Ranking) {\n    if (this.rankings.length > 0) {\n      // add slope graph first\n      const s = this.table.pushSeparator(\n        (header, body) =>\n          new SlopeGraph(header, body, `${ranking.id}S`, this.ctx, {\n            mode: this.options.defaultSlopeGraphMode === 'band' ? EMode.BAND : EMode.ITEM,\n          })\n      );\n      this.slopeGraphs.push(s);\n    }\n\n    const r = this.table.pushTable(\n      (header, body, tableId, style) =>\n        new EngineRanking(ranking, header, body, tableId, style, this.ctx, {\n          animation: this.options.animated,\n          customRowUpdate: this.options.customRowUpdate || (() => undefined),\n          levelOfDetail: this.options.levelOfDetail || (() => 'high'),\n          flags: this.options.flags as ILineUpFlags,\n        })\n    );\n    r.on(EngineRanking.EVENT_WIDTH_CHANGED, () => {\n      this.updateRotatedHeaderState();\n      this.table.widthChanged();\n    });\n    r.on(EngineRanking.EVENT_UPDATE_DATA, () => this.update([r]));\n    r.on(EngineRanking.EVENT_RECREATE, () => this.updateUpdateAbles());\n    this.forward(r, EngineRanking.EVENT_HIGHLIGHT_CHANGED);\n    if (this.enabledHighlightListening) {\n      r.enableHighlightListening(true);\n    }\n\n    ranking.on(suffix('.renderer', Ranking.EVENT_ORDER_CHANGED), () => this.updateHist(r));\n\n    this.rankings.push(r);\n    this.update([r]);\n  }\n\n  private updateRotatedHeaderState() {\n    if (this.options.labelRotation === 0) {\n      return;\n    }\n    const l = this.node.querySelector(`.${cssClass('label')}.${cssClass('rotated')}`);\n    this.node.classList.toggle(cssClass('rotated-label'), Boolean(l));\n  }\n\n  private removeRanking(ranking: Ranking | null) {\n    if (!ranking) {\n      // remove all\n      this.rankings.splice(0, this.rankings.length);\n      this.slopeGraphs.splice(0, this.slopeGraphs.length);\n      this.table.clear();\n      return;\n    }\n    const index = this.rankings.findIndex((r) => r.ranking === ranking);\n    if (index < 0) {\n      return; // error\n    }\n    const section = this.rankings.splice(index, 1)[0]!;\n    const slope = this.slopeGraphs.splice(index === 0 ? index : index - 1, 1)[0];\n    this.table.remove(section);\n    if (slope) {\n      this.table.remove(slope);\n    }\n  }\n\n  update(rankings: EngineRanking[] = this.rankings) {\n    // visible and has parent = part of dom\n    rankings = rankings.filter((d) => !d.hidden && d.body.parentElement!);\n    if (rankings.length === 0) {\n      return;\n    }\n\n    const round2 = (v: number) => round(v, 2);\n    const rowPadding = round2(this.zoomFactor * this.options.rowPadding!);\n    const groupPadding = round2(this.zoomFactor * this.options.groupPadding!);\n\n    const heightsFor = (ranking: Ranking, data: (IGroupItem | IGroupData)[]) => {\n      if (this.options.dynamicHeight) {\n        const impl = this.options.dynamicHeight(data, ranking);\n        const f = (v: number | any, d: any) => (typeof v === 'number' ? v : v(d));\n        if (impl) {\n          return {\n            defaultHeight: round2(this.zoomFactor * impl.defaultHeight),\n            height: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.height, d)),\n            padding: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.padding, d)),\n          };\n        }\n      }\n      const item = round2(this.zoomFactor * this.options.rowHeight!);\n      const group = round2(this.zoomFactor * this.options.groupHeight!);\n      return {\n        defaultHeight: item,\n        height: (d: IGroupItem | IGroupData) => (isGroup(d) ? group : item),\n        padding: rowPadding,\n      };\n    };\n\n    for (const r of rankings) {\n      const grouped = r.groupData();\n\n      // inline with creating the groupData\n      const { height, defaultHeight, padding } = heightsFor(r.ranking, grouped);\n\n      const strategy = this.data.getAggregationStrategy();\n      const topNGetter = (group: IGroup) => this.data.getTopNAggregated(r.ranking, group);\n\n      // inline and create manually for better performance\n      const rowContext = nonUniformContext(grouped.map(height), defaultHeight, (index) => {\n        const pad = typeof padding === 'number' ? padding : padding(grouped[index] || null);\n        const v = grouped[index];\n\n        if (index < 0 || !v || (isGroup(v) && isSummaryGroup(v, strategy, topNGetter))) {\n          return pad;\n        }\n        return pad + groupPadding * groupEndLevel(v, topNGetter);\n      });\n      r.render(grouped, rowContext);\n    }\n\n    this.updateSlopeGraphs(rankings);\n\n    this.updateUpdateAbles();\n    this.updateRotatedHeaderState();\n    this.table.widthChanged();\n  }\n\n  private updateUpdateAbles() {\n    for (const u of this.updateAbles) {\n      u(this.ctx);\n    }\n  }\n\n  private updateSlopeGraphs(rankings: EngineRanking[] = this.rankings) {\n    const indices = new Set(rankings.map((d) => this.rankings.indexOf(d)));\n\n    for (let i = 0; i < this.slopeGraphs.length; ++i) {\n      const s = this.slopeGraphs[i];\n      if (s.hidden) {\n        return;\n      }\n      const left = i;\n      const right = i + 1;\n      if (!indices.has(left) && !indices.has(right)) {\n        return;\n      }\n      const leftRanking = this.rankings[left];\n      const rightRanking = this.rankings[right];\n      s.rebuild(\n        leftRanking.ranking,\n        leftRanking.currentData,\n        leftRanking.context,\n        rightRanking.ranking,\n        rightRanking.currentData,\n        rightRanking.context\n      );\n    }\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\n    const found = this.rankings.map((r) => r.setHighlight(dataIndex));\n    this.fire(EngineRenderer.EVENT_HIGHLIGHT_CHANGED, dataIndex);\n    if (this.rankings.length === 0 || dataIndex < 0) {\n      return false;\n    }\n    if (!scrollIntoView) {\n      return found[0]!;\n    }\n    return this.rankings[0].scrollIntoView(dataIndex);\n  }\n\n  setHighlightToNearest(dataIndices: number[], scrollIntoView: boolean) {\n    if (this.rankings.length === 0) {\n      return false;\n    }\n    const nearest = this.rankings[0].findNearest(dataIndices);\n    if (nearest >= 0) {\n      return this.setHighlight(nearest, scrollIntoView);\n    }\n    return false;\n  }\n\n  getHighlight() {\n    for (const ranking of this.rankings) {\n      const h = ranking.getHighlight();\n      if (h >= 0) {\n        return h;\n      }\n    }\n    return -1;\n  }\n\n  enableHighlightListening(enable: boolean) {\n    for (const ranking of this.rankings) {\n      ranking.enableHighlightListening(enable);\n    }\n    this.enabledHighlightListening = enable;\n  }\n\n  destroy() {\n    this.takeDownProvider();\n    this.table.destroy();\n    this.node.remove();\n  }\n}\n","/**\n * caches parsing of html strings in a dom element cache\n * @param doc the doc to create the elements under\n * @internal\n */\nexport default function domElementCache(doc: Document): (html: string) => HTMLElement {\n  const cache = new Map<string, HTMLElement>();\n\n  const helper = doc.createElement('div');\n\n  return (html: string) => {\n    if (cache.has(html)) {\n      return cache.get(html)!.cloneNode(true) as HTMLElement;\n    }\n\n    helper.innerHTML = html;\n    const node = helper.firstElementChild! as HTMLElement;\n    // keep a copy\n    cache.set(html, node.cloneNode(true) as HTMLElement);\n\n    return node;\n  };\n}\n","import type { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class ChooseRankingDialog extends APopup {\n  constructor(private readonly items: HTMLElement[], dialog: IDialogContext) {\n    super(dialog);\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('more-options'), cssClass('choose-options'));\n    for (const item of this.items) {\n      node.appendChild(item);\n    }\n  }\n}\n","import { clear, AEventDispatcher, IEventListener } from '../../internal';\nimport { cssClass } from '../../styles';\n\nexport interface IItem {\n  id: string;\n  text: string;\n}\n\nexport interface IGroupSearchItem<T extends IItem> {\n  text: string;\n  children: (T | IGroupSearchItem<T>)[];\n}\n\nfunction isItem<T extends IItem>(v: T | IGroupSearchItem<T>): v is T {\n  return (v as T).id !== undefined;\n}\n\nexport interface ISearchBoxOptions<T extends IItem> {\n  doc: Document;\n\n  formatItem(item: T | IGroupSearchItem<T>, node: HTMLElement): string | void;\n\n  placeholder: string;\n}\n\n/**\n * @asMemberOf SearchBox\n * @event\n */\nexport declare function select(item: any): void;\n\nexport default class SearchBox<T extends IItem> extends AEventDispatcher {\n  static readonly EVENT_SELECT = 'select';\n  private static readonly SEARCH_ITEM_SELECTOR = `.${cssClass('search-item')}:not(.${cssClass('hidden')})`;\n\n  private readonly options: Readonly<ISearchBoxOptions<T>> = {\n    formatItem: (item) => item.text,\n    doc: document,\n    placeholder: 'Select...',\n  };\n\n  readonly node: HTMLElement;\n  private search: HTMLInputElement;\n  private body: HTMLElement;\n\n  private readonly itemTemplate: HTMLElement;\n  private readonly groupTemplate: HTMLElement;\n\n  private values: (T | IGroupSearchItem<T>)[] = [];\n\n  constructor(options: Partial<ISearchBoxOptions<T>> = {}) {\n    super();\n    Object.assign(this.options, options);\n\n    this.node = this.options.doc.createElement('div');\n    this.node.classList.add(cssClass('search'));\n    this.node.innerHTML = `<input class=\"${cssClass('search-input')}\" type=\"search\" placeholder=\"${\n      this.options.placeholder\n    }\">\n    <ul class=\"${cssClass('search-list')}\"></ul>`;\n\n    this.search = this.node.firstElementChild! as HTMLInputElement;\n    this.body = this.node.lastElementChild! as HTMLElement;\n\n    this.search.onfocus = () => this.focus();\n    this.search.onblur = () => this.blur();\n    this.search.oninput = () => this.filter();\n    this.search.onkeydown = (evt) => this.handleKey(evt);\n\n    this.itemTemplate = this.options.doc.createElement('li');\n    this.itemTemplate.classList.add(cssClass('search-item'));\n    this.itemTemplate.innerHTML = `<span></span>`;\n    this.groupTemplate = this.options.doc.createElement('li');\n    this.groupTemplate.classList.add(cssClass('search-group'));\n    this.groupTemplate.innerHTML = `<span></span><ul></ul>`;\n  }\n\n  get data() {\n    return this.values;\n  }\n\n  set data(data: (T | IGroupSearchItem<T>)[]) {\n    this.values = data;\n    clear(this.body);\n    this.buildDialog(this.body, this.values);\n  }\n\n  private buildDialog(node: HTMLElement, values: (T | IGroupSearchItem<T>)[]) {\n    for (const v of values) {\n      let li: HTMLElement;\n      if (isItem(v)) {\n        li = this.itemTemplate.cloneNode(true) as HTMLElement;\n        li.onmousedown = (evt) => {\n          // see https://stackoverflow.com/questions/10652852/jquery-fire-click-before-blur-event#10653160\n          evt.preventDefault();\n        };\n        li.onclick = () => this.select(v);\n        li.onmouseenter = () => (this.highlighted = li);\n        li.onmouseleave = () => (this.highlighted = null);\n        node.appendChild(li);\n      } else {\n        li = this.groupTemplate.cloneNode(true) as HTMLElement;\n        this.buildDialog(li.lastElementChild! as HTMLElement, v.children);\n        node.appendChild(li);\n      }\n      const item = li.firstElementChild! as HTMLElement;\n      const r = this.options.formatItem(v, item);\n      if (typeof r === 'string') {\n        item.innerHTML = r;\n      }\n    }\n  }\n\n  private handleKey(evt: KeyboardEvent) {\n    switch (evt.key) {\n      case 'Escape':\n        this.search.blur();\n        break;\n      case 'Enter':\n        const h = this.highlighted;\n        if (h) {\n          h.click();\n        } else {\n          evt.preventDefault();\n        }\n        break;\n      case 'ArrowUp':\n        this.highlightPrevious();\n        break;\n      case 'ArrowDown':\n        this.highlightNext();\n        break;\n    }\n  }\n\n  private select(item: T) {\n    this.search.value = ''; // reset\n    this.search.blur();\n    this.fire(SearchBox.EVENT_SELECT, item);\n  }\n\n  focus() {\n    this.body.style.width = `${this.search.offsetWidth}px`;\n    this.highlighted = this.body.querySelector<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR) || null;\n    this.node.classList.add(cssClass('search-open'));\n  }\n\n  private get highlighted() {\n    return (this.body.getElementsByClassName(cssClass('search-highlighted'))[0] as HTMLElement) ?? null;\n  }\n\n  private set highlighted(value: HTMLElement | null) {\n    const old = this.highlighted;\n    if (old === value) {\n      return;\n    }\n    if (old) {\n      old.classList.remove(cssClass('search-highlighted'));\n    }\n    if (value) {\n      value.classList.add(cssClass('search-highlighted'));\n    }\n  }\n\n  private highlightNext() {\n    const h = this.highlighted;\n    if (!h || h.classList.contains(cssClass('hidden'))) {\n      this.highlighted = this.body.querySelector<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR) || null;\n      return;\n    }\n\n    const items = Array.from(this.body.querySelectorAll<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR));\n    const index = items.indexOf(h);\n    this.highlighted = items[index + 1] || null;\n  }\n\n  private highlightPrevious() {\n    const h = this.highlighted;\n    const items = Array.from(this.body.querySelectorAll<HTMLElement>(SearchBox.SEARCH_ITEM_SELECTOR));\n\n    if (!h || h.classList.contains(cssClass('hidden'))) {\n      this.highlighted = items[items.length - 1] || null;\n      return;\n    }\n    const index = items.indexOf(h);\n    this.highlighted = items[index - 1] || null;\n  }\n\n  private blur() {\n    this.search.value = '';\n    // clear filter\n    this.filterResults(this.body, '');\n    this.node.classList.remove(cssClass('search-open'));\n  }\n\n  private filter() {\n    const empty = this.filterResults(this.body, this.search.value.toLowerCase());\n    this.body.classList.toggle(cssClass('search-empty'), empty);\n  }\n\n  private filterResults(node: HTMLElement, text: string) {\n    if (text === '') {\n      // show all\n      (Array.from(node.getElementsByClassName(cssClass('hidden'))) as HTMLElement[]).forEach((d: HTMLElement) =>\n        d.classList.remove(cssClass('hidden'))\n      );\n      return false;\n    }\n    const children = Array.from(node.children);\n    children.forEach((d) => {\n      const content = d.firstElementChild!.innerHTML.toLowerCase();\n      let hidden = !content.includes(text);\n      if (d.classList.contains(cssClass('search-group'))) {\n        const ul = d.lastElementChild! as HTMLElement;\n        const allChildrenHidden = this.filterResults(ul, text);\n        hidden = hidden && allChildrenHidden;\n      }\n      d.classList.toggle(cssClass('hidden'), hidden);\n    });\n\n    return children.every((d) => d.classList.contains(cssClass('hidden')));\n  }\n\n  protected createEventList() {\n    return super.createEventList().concat([SearchBox.EVENT_SELECT]);\n  }\n\n  on(type: typeof SearchBox.EVENT_SELECT, listener: typeof select | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n}\n","import type { Ranking } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport { cssClass } from '../../styles';\n\n/** @internal */\nexport default class RenameRankingDialog extends ADialog {\n  private readonly before: string;\n\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext) {\n    super(dialog, {\n      livePreview: 'rename',\n    });\n    this.before = ranking.getLabel();\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('dialog-rename'));\n    node.insertAdjacentHTML(\n      'beforeend',\n      `\n      <input type=\"text\" value=\"${this.ranking.getLabel()}\" required autofocus placeholder=\"name\">`\n    );\n  }\n\n  protected reset() {\n    this.findInput('input[type=\"text\"]').value = this.before;\n  }\n\n  protected cancel() {\n    this.ranking.setLabel(this.before);\n  }\n\n  protected submit() {\n    const newValue = this.findInput('input[type=\"text\"]').value;\n    this.ranking.setLabel(newValue);\n    return true;\n  }\n}\n","import type { Ranking } from '../../model';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { dialogContext, IDialogContext } from './ADialog';\nimport RenameRankingDialog from './RenameRankingDialog';\nimport { cssClass } from '../../styles';\nimport { actionCSSClass } from '../header';\nimport APopup from './APopup';\n\n/** @internal */\nexport default class MoreRankingOptionsDialog extends APopup {\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\n    super(dialog, {\n      autoClose: true,\n    });\n  }\n\n  private addIcon(node: HTMLElement, title: string, onClick: (evt: MouseEvent) => void) {\n    node.insertAdjacentHTML(\n      'beforeend',\n      `<i title=\"${title}\" class=\"${actionCSSClass(title)}\"><span>${title}</span> </i>`\n    );\n    const i = node.lastElementChild as HTMLElement;\n    i.onclick = (evt) => {\n      evt.stopPropagation();\n      onClick(evt);\n    };\n  }\n\n  protected build(node: HTMLElement) {\n    node.classList.add(cssClass('more-options'));\n    this.addIcon(node, 'Rename', (evt) => {\n      evt.stopPropagation();\n      evt.preventDefault();\n      const dialog = new RenameRankingDialog(this.ranking, dialogContext(this.ctx, this.level + 1, evt as any));\n      dialog.open();\n    });\n    this.addIcon(node, 'Remove', (evt) => {\n      evt.stopPropagation();\n      evt.preventDefault();\n      this.destroy('confirm');\n      this.ctx.provider.removeRanking(this.ranking);\n    });\n  }\n}\n","import type { Column } from '../../model';\nimport ADialog, { IDialogContext } from './ADialog';\nimport type { IToolbarDialogAddon, IRankingHeaderContext, IToolbarDialogAddonHandler } from '../interfaces';\n\n/** @internal */\nexport default class AddonDialog extends ADialog {\n  private readonly handlers: IToolbarDialogAddonHandler[] = [];\n\n  constructor(\n    private readonly column: Column,\n    private readonly addons: IToolbarDialogAddon[],\n    dialog: IDialogContext,\n    private readonly ctx: IRankingHeaderContext,\n    private readonly onClick?: () => void\n  ) {\n    super(dialog);\n  }\n\n  protected build(node: HTMLElement) {\n    for (const addon of this.addons) {\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\n      this.handlers.push(addon.append(this.column, node, this.dialog, this.ctx));\n    }\n  }\n\n  protected submit(): boolean {\n    for (const handler of this.handlers) {\n      if (handler.submit() === false) {\n        return false;\n      }\n    }\n    if (this.onClick) {\n      this.onClick();\n    }\n    return true;\n  }\n\n  protected cancel() {\n    for (const handler of this.handlers) {\n      handler.cancel();\n    }\n  }\n\n  protected reset() {\n    for (const handler of this.handlers) {\n      handler.reset();\n    }\n  }\n}\n","import { clear } from '../../internal';\nimport { Column, Ranking, categoryOf, isSortingAscByDefault, ISortCriteria, isSupportType } from '../../model';\nimport { aria, cssClass } from '../../styles';\nimport AddonDialog from '../dialogs/AddonDialog';\nimport { actionCSSClass, updateHeader } from '../header';\nimport type { IRankingHeaderContext, IToolbarDialogAddon } from '../interfaces';\nimport { getToolbarDialogAddons, isGroupAble, isGroupSortAble, isSortAble } from '../toolbarResolvers';\nimport SearchBox, { ISearchBoxOptions } from './SearchBox';\nimport { dialogContext } from '../dialogs';\n\ninterface IColumnItem {\n  col: Column;\n  id: string;\n  text: string;\n}\n/**\n * @internal\n */\nexport default class Hierarchy {\n  readonly node: HTMLElement;\n  readonly groupAdder: SearchBox<IColumnItem>;\n  readonly sortAdder: SearchBox<IColumnItem>;\n  readonly groupSortAdder: SearchBox<IColumnItem>;\n\n  constructor(private readonly ctx: IRankingHeaderContext, document: Document) {\n    this.node = document.createElement('aside');\n    this.node.classList.add(cssClass('hierarchy'), cssClass('feature-advanced'), cssClass('feature-ranking'));\n    this.node.innerHTML = `\n      <section class=\"${cssClass('group-hierarchy')}\">\n      </section>\n      <section class=\"${cssClass('sort-hierarchy')}\">\n      </section>\n      <section class=\"${cssClass('sort-groups-hierarchy')}\">\n      </section>\n    `;\n    const options: Partial<ISearchBoxOptions<IColumnItem>> = {\n      doc: document,\n      placeholder: 'Add Sort Criteria...',\n      formatItem: (item: IColumnItem, node: HTMLElement) => {\n        node.classList.add(cssClass('typed-icon'));\n        node.dataset.typeCat = categoryOf(item.col).name;\n        node.dataset.type = item.col.desc.type;\n\n        const summary = item.col.getMetaData().summary || item.col.description;\n        node.classList.toggle(cssClass('searchbox-summary-entry'), Boolean(summary));\n        if (summary) {\n          const label = node.ownerDocument.createElement('span');\n          label.textContent = summary;\n          node.appendChild(label);\n          const desc = node.ownerDocument.createElement('span');\n          desc.textContent = summary;\n          node.appendChild(desc);\n          return undefined;\n        }\n        return item.text;\n      },\n    };\n    this.groupAdder = new SearchBox(\n      Object.assign({}, options, {\n        placeholder: 'Add Grouping Criteria...',\n      })\n    );\n    this.groupSortAdder = new SearchBox(\n      Object.assign({}, options, {\n        placeholder: 'Add Grouping Sort Criteria...',\n      })\n    );\n    this.sortAdder = new SearchBox(options);\n  }\n\n  update(ranking: Ranking | null) {\n    if (!ranking) {\n      this.node.style.display = 'none';\n      return;\n    }\n    this.node.style.display = null;\n    this.renderGroups(ranking, this.node.firstElementChild! as HTMLElement);\n    this.renderSorting(ranking, this.node.children[1]! as HTMLElement);\n    this.renderGroupSorting(ranking, this.node.lastElementChild! as HTMLElement);\n  }\n\n  private render<T>(\n    node: HTMLElement,\n    items: T[],\n    toColumn: (item: T) => Column,\n    extras: (item: T, node: HTMLElement) => void,\n    addonKey: string,\n    onChange: (item: T, delta: number) => void\n  ) {\n    const cache = new Map((Array.from(node.children) as HTMLElement[]).map((d) => [d.dataset.id, d]));\n    clear(node);\n\n    items.forEach((d) => {\n      const col = toColumn(d);\n      const item = cache.get(col.id);\n      if (item) {\n        node.appendChild(item);\n        updateHeader(item, col, 0);\n        return;\n      }\n      const addons = getToolbarDialogAddons(col, addonKey, this.ctx);\n\n      node.insertAdjacentHTML(\n        'beforeend',\n        `<div data-id=\"${col.id}\" class=\"${cssClass('toolbar')} ${cssClass('hierarchy-entry')}\">\n      <div class=\"${cssClass('label')} ${cssClass('typed-icon')}\">${col.label}</div>\n      ${addons.length > 0 ? `<i title=\"Customize\" class=\"${actionCSSClass('customize')}\">${aria('Customize')}</i>` : ''}\n      <i title=\"Move Up\" class=\"${actionCSSClass('Move Up')}\">${aria('Move Up')}</i>\n      <i title=\"Move Down\" class=\"${actionCSSClass('Move Down')}\">${aria('Move Down')}</i>\n      <i title=\"Remove from hierarchy\" class=\"${actionCSSClass('Remove')}\">${aria('Remove from hierarchy')}</i>\n      </div>`\n      );\n      const last = node.lastElementChild! as HTMLElement;\n\n      function prevent(evt: Event) {\n        evt.preventDefault();\n        evt.stopPropagation();\n      }\n\n      last.querySelector<HTMLElement>('i[title=\"Move Down\"]')!.onclick = (evt) => {\n        prevent(evt);\n        onChange(d, +1);\n      };\n      last.querySelector<HTMLElement>('i[title=\"Move Up\"]')!.onclick = (evt) => {\n        prevent(evt);\n        onChange(d, -1);\n      };\n      last.querySelector<HTMLElement>('i[title^=Remove]')!.onclick = (evt) => {\n        prevent(evt);\n        onChange(d, 0);\n      };\n\n      if (addons.length > 0) {\n        last.querySelector<HTMLElement>('i[title=Customize]')!.onclick = (evt) => {\n          prevent(evt);\n          this.customize(col, addons, evt as any);\n        };\n      }\n\n      extras(d, last);\n\n      updateHeader(last, col, 0);\n    });\n  }\n\n  private renderGroups(ranking: Ranking, node: HTMLElement) {\n    const groups = ranking.getGroupCriteria();\n\n    if (groups.length === 0) {\n      clear(node);\n      return;\n    }\n\n    const click = (col: Column, delta: number) => {\n      if (delta === 0) {\n        col.groupByMe();\n        return;\n      }\n      const current = col.isGroupedBy();\n      col.findMyRanker()!.groupBy(col, current + delta);\n    };\n\n    const addButton = (_: Column, last: HTMLElement) => {\n      last.insertAdjacentHTML(\n        'afterbegin',\n        `<i title=\"Group\" class=\"${actionCSSClass('group')}\" data-group=\"true\">${aria('Group')}</i>`\n      );\n    };\n\n    this.render(node, groups, (d) => d, addButton, 'group', click);\n    this.addGroupAdder(ranking, groups, node);\n  }\n\n  private renderSorting(ranking: Ranking, node: HTMLElement) {\n    const sortCriterias = ranking.getSortCriteria();\n\n    if (sortCriterias.length === 0) {\n      clear(node);\n      return;\n    }\n\n    const click = ({ col }: ISortCriteria, delta: number) => {\n      const current = col.isSortedByMe();\n      if (!isFinite(delta)) {\n        col.sortByMe(current.asc === 'desc', current.priority);\n        return;\n      }\n      if (delta === 0) {\n        col.sortByMe(current.asc === 'asc', -1);\n        return;\n      }\n      col.sortByMe(current.asc === 'asc', current.priority! + delta);\n    };\n\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\n      last.insertAdjacentHTML(\n        'afterbegin',\n        `\n      <i title=\"Sort\" class=\"${actionCSSClass('sort')}\" data-sort=\"${s.asc ? 'asc' : 'desc'}\">${aria(\n          'Toggle Sorting'\n        )}</i>`\n      );\n      last.querySelector<HTMLElement>('i[title=Sort]')!.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        click(s, Number.POSITIVE_INFINITY);\n      };\n    };\n\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sort', click);\n\n    this.addSortAdder(ranking, sortCriterias, node);\n  }\n\n  private renderGroupSorting(ranking: Ranking, node: HTMLElement) {\n    const sortCriterias = ranking.getGroupSortCriteria();\n\n    if (sortCriterias.length === 0) {\n      clear(node);\n      return;\n    }\n\n    const click = ({ col }: ISortCriteria, delta: number) => {\n      const current = col.isGroupSortedByMe();\n      if (!isFinite(delta)) {\n        col.groupSortByMe(current.asc === 'desc', current.priority);\n        return;\n      }\n      if (delta === 0) {\n        col.groupSortByMe(current.asc === 'asc', -1);\n        return;\n      }\n      col.groupSortByMe(current.asc === 'asc', current.priority! + delta);\n    };\n\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\n      last.insertAdjacentHTML(\n        'afterbegin',\n        `\n      <i title=\"Sort Group\" class=\"${actionCSSClass('sort-groups')}\" data-sort=\"${s.asc ? 'asc' : 'desc'}\">${aria(\n          'Toggle Sorting'\n        )}</i>`\n      );\n      last.querySelector<HTMLElement>('i[title=\"Sort Group\"]')!.onclick = (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        click(s, Number.POSITIVE_INFINITY);\n      };\n    };\n\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sortGroup', click);\n\n    this.addGroupSortAdder(ranking, sortCriterias, node);\n  }\n\n  private addAdder(\n    adder: SearchBox<IColumnItem>,\n    ranking: Ranking,\n    addonKey: string,\n    current: Column[],\n    node: HTMLElement,\n    check: (col: Column) => boolean,\n    onSelect: (col: Column) => void\n  ) {\n    const used = new Set(current);\n\n    adder.data = ranking.children\n      .filter((col) => !isSupportType(col) && !used.has(col) && check(col))\n      .map((col) => ({ col, id: col.id, text: col.label }));\n\n    adder.on(SearchBox.EVENT_SELECT, (item: IColumnItem) => {\n      const addons = getToolbarDialogAddons(item.col, addonKey, this.ctx);\n      if (addons.length > 0) {\n        this.customize(item.col, addons, adder.node, () => onSelect(item.col));\n      } else {\n        onSelect(item.col);\n      }\n    });\n\n    if (adder.data.length <= 0) {\n      return;\n    }\n\n    const wrapper = node.ownerDocument!.createElement('footer');\n    wrapper.appendChild(adder.node);\n    wrapper.classList.add(cssClass('hierarchy-adder'));\n    node.appendChild(wrapper);\n  }\n\n  private addSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\n    this.addAdder(\n      this.sortAdder,\n      ranking,\n      'sort',\n      sortCriterias.map((d) => d.col),\n      node,\n      (d) => isSortAble(d, this.ctx),\n      (col) => {\n        ranking.sortBy(col, isSortingAscByDefault(col), sortCriterias.length);\n      }\n    );\n  }\n\n  private addGroupAdder(ranking: Ranking, groups: Column[], node: HTMLElement) {\n    this.addAdder(\n      this.groupAdder,\n      ranking,\n      'group',\n      groups,\n      node,\n      (d) => isGroupAble(d, this.ctx),\n      (col) => {\n        ranking.groupBy(col, groups.length);\n      }\n    );\n  }\n\n  private addGroupSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\n    this.addAdder(\n      this.groupSortAdder,\n      ranking,\n      'sortGroup',\n      sortCriterias.map((d) => d.col),\n      node,\n      (d) => isGroupSortAble(d, this.ctx),\n      (col) => {\n        ranking.groupSortBy(col, isSortingAscByDefault(col), sortCriterias.length);\n      }\n    );\n  }\n\n  private customize(col: Column, addons: IToolbarDialogAddon[], attachment: HTMLElement, onClick?: () => void) {\n    const dialog = new AddonDialog(col, addons, dialogContext(this.ctx, 0, attachment), this.ctx, onClick);\n    dialog.open();\n  }\n}\n","import { Column, isMapAbleColumn, NumberColumn } from '../../model';\nimport type { IAbortAblePromise } from '../../provider';\nimport type { ISummaryRenderer } from '../../renderer';\nimport { cssClass, engineCssClass } from '../../styles';\nimport { createShortcutMenuItems, dragAbleColumn, updateHeader } from '../header';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { suffix } from '../../internal';\n\n/** @internal */\nexport default class SidePanelEntryVis {\n  readonly node: HTMLElement;\n  private summary: ISummaryRenderer;\n  private summaryUpdater: IAbortAblePromise<void> | null = null;\n\n  constructor(public readonly column: Column, private ctx: IRankingHeaderContext, document: Document) {\n    this.node = document.createElement('article');\n    this.node.classList.add(cssClass('side-panel-entry'));\n    this.node.dataset.colId = column.id;\n    this.node.dataset.type = column.desc.type;\n\n    this.summary = ctx.summaryRenderer(column, true);\n\n    this.column.on(suffix('.panel', NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_HEADER), () => {\n      this.update();\n    });\n    this.column.on(suffix('.panel', Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_CACHES), () => {\n      this.recreateSummary();\n    });\n    this.init();\n    this.update();\n  }\n\n  private init() {\n    this.node.innerHTML = `\n      <header class=\"${cssClass('side-panel-entry-header')}\">\n        <div class=\"${cssClass('side-panel-labels')}\">\n          <span class=\"${cssClass('label')} ${cssClass('typed-icon')} ${cssClass('side-panel-label')}\"></span>\n          <span class=\"${cssClass('sublabel')} ${cssClass('side-panel-sublabel')}\"></span>\n        </div>\n        <div class=\"${cssClass('toolbar')} ${cssClass('side-panel-toolbar')}\"></div>\n      </header>`;\n    createShortcutMenuItems(\n      this.node.querySelector<HTMLElement>(`.${cssClass('toolbar')}`),\n      0,\n      this.column,\n      this.ctx,\n      'sidePanel',\n      false\n    );\n    dragAbleColumn(this.node.querySelector<HTMLElement>('header'), this.column, this.ctx);\n    this.appendSummary();\n  }\n\n  update(ctx: IRankingHeaderContext = this.ctx) {\n    this.ctx = ctx;\n    updateHeader(this.node, this.column);\n    this.updateSummary();\n  }\n\n  private updateSummary() {\n    const summaryNode = this.node.querySelector<HTMLElement>(`.${cssClass('summary')}`)!;\n    if (this.summaryUpdater) {\n      this.summaryUpdater.abort();\n      summaryNode.classList.remove(engineCssClass('loading'));\n      this.summaryUpdater = null;\n    }\n    const r = this.summary.update(summaryNode);\n    if (!r) {\n      return;\n    }\n\n    this.summaryUpdater = r;\n    summaryNode.classList.add(engineCssClass('loading'));\n    r.then((a) => {\n      if (typeof a === 'symbol') {\n        return;\n      }\n      summaryNode.classList.remove(engineCssClass('loading'));\n    });\n  }\n\n  private appendSummary() {\n    const summary = this.ctx.asElement(this.summary.template);\n    summary.classList.add(\n      cssClass('summary'),\n      cssClass('side-panel-summary'),\n      cssClass('renderer'),\n      cssClass(`renderer-${this.column.getSummaryRenderer()}`)\n    );\n    summary.dataset.renderer = this.column.getSummaryRenderer();\n    summary.dataset.interactive = isMapAbleColumn(this.column).toString();\n    this.node.appendChild(summary);\n  }\n\n  private recreateSummary() {\n    // remove old summary\n    this.node.removeChild(this.node.querySelector(`.${cssClass('summary')}`)!);\n\n    this.summary = this.ctx.summaryRenderer(this.column, true);\n    this.appendSummary();\n    this.updateSummary();\n  }\n\n  destroy() {\n    this.column.on(\n      suffix(\n        '.panel',\n        NumberColumn.EVENT_FILTER_CHANGED,\n        Column.EVENT_DIRTY_HEADER,\n        Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\n        Column.EVENT_DIRTY_CACHES\n      ),\n      null\n    );\n    this.node.remove();\n  }\n}\n","import { clear, suffix } from '../../internal';\nimport { Ranking, isSupportType } from '../../model';\nimport { aria, cssClass } from '../../styles';\nimport MoreRankingOptionsDialog from '../dialogs/MoreRankingOptionsDialog';\nimport { actionCSSClass } from '../header';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { dialogContext } from '../dialogs';\nimport Hierarchy from './Hierarchy';\nimport type { ISidePanelOptions } from './SidePanel';\nimport SidePanelEntryVis from './SidePanelEntryVis';\n\n/** @internal */\nexport default class SidePanelRanking {\n  readonly header: HTMLElement;\n  readonly dropdown: HTMLElement;\n  readonly node: HTMLElement;\n\n  private readonly hierarchy: Hierarchy | null;\n  private readonly entries = new Map<string, SidePanelEntryVis>();\n\n  constructor(\n    public readonly ranking: Ranking,\n    private ctx: IRankingHeaderContext,\n    document: Document,\n    private readonly options: Readonly<ISidePanelOptions>\n  ) {\n    this.node = document.createElement('section');\n    this.header = document.createElement('div');\n    this.dropdown = document.createElement('div');\n\n    this.node.classList.add(cssClass('side-panel-ranking'));\n    this.header.classList.add(cssClass('side-panel-ranking-header'), cssClass('side-panel-ranking-label'));\n    this.dropdown.classList.add(cssClass('side-panel-ranking-label'));\n\n    this.dropdown.innerHTML = this.header.innerHTML = `<span>${ranking.getLabel()}</span><i class=\"${actionCSSClass(\n      'more'\n    )}\" title=\"More &hellip;\">${aria('More &hellip;')}</i>`;\n    (this.header.lastElementChild! as HTMLElement).onclick = (this.dropdown.lastElementChild! as HTMLElement).onclick =\n      (evt) => {\n        evt.stopPropagation();\n        evt.preventDefault();\n        const dialog = new MoreRankingOptionsDialog(ranking, dialogContext(ctx, 1, evt), ctx);\n        dialog.open();\n      };\n\n    this.hierarchy = this.options.hierarchy ? new Hierarchy(ctx, document) : null;\n\n    this.init();\n  }\n\n  private init() {\n    this.node.innerHTML = `<main class=\"${cssClass('side-panel-ranking-main')}\"></main>`;\n    if (this.hierarchy) {\n      this.node.insertBefore(this.hierarchy.node, this.node.firstChild);\n    }\n\n    if (this.hierarchy) {\n      this.ranking.on(\n        suffix(\n          '.panel',\n          Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n          Ranking.EVENT_SORT_CRITERIA_CHANGED,\n          Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED\n        ),\n        () => {\n          this.updateHierarchy();\n        }\n      );\n    }\n    this.ranking.on(\n      suffix('.panel', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_MOVE_COLUMN),\n      () => {\n        this.updateList();\n        this.updateHierarchy();\n      }\n    );\n    this.ranking.on(suffix('.panel', Ranking.EVENT_LABEL_CHANGED), () => {\n      this.dropdown.firstElementChild!.textContent = this.header.firstElementChild!.textContent =\n        this.ranking.getLabel();\n    });\n  }\n\n  get active() {\n    return this.node.classList.contains(cssClass('active'));\n  }\n\n  set active(value: boolean) {\n    this.node.classList.toggle(cssClass('active'), value);\n    this.header.classList.toggle(cssClass('active'), value);\n    this.dropdown.classList.toggle(cssClass('active'), value);\n    if (value) {\n      return;\n    }\n    this.updateList();\n    this.updateHierarchy();\n  }\n\n  update(ctx: IRankingHeaderContext) {\n    this.ctx = ctx;\n    this.updateList();\n    this.updateHierarchy();\n  }\n\n  private updateHierarchy() {\n    if (!this.hierarchy || !this.active) {\n      return;\n    }\n    this.hierarchy.update(this.ranking);\n  }\n\n  private updateList() {\n    if (!this.active) {\n      return;\n    }\n    const node = this.node.querySelector('main')!;\n    const columns = this.ranking.flatColumns.filter((d) => !isSupportType(d));\n\n    if (columns.length === 0) {\n      clear(node);\n      this.entries.forEach((d) => d.destroy());\n      this.entries.clear();\n      return;\n    }\n\n    clear(node);\n\n    const copy = new Map(this.entries);\n    this.entries.clear();\n\n    columns.forEach((col) => {\n      const existing = copy.get(col.id);\n      if (existing) {\n        existing.update(this.ctx);\n        node.appendChild(existing.node);\n        this.entries.set(col.id, existing);\n        copy.delete(col.id);\n        return;\n      }\n\n      const entry = new SidePanelEntryVis(col, this.ctx, node.ownerDocument!);\n      node.appendChild(entry.node);\n      this.entries.set(col.id, entry);\n    });\n\n    copy.forEach((d) => d.destroy());\n  }\n\n  destroy() {\n    this.header.remove();\n    this.node.remove();\n    this.ranking.on(\n      suffix(\n        '.panel',\n        Ranking.EVENT_GROUP_CRITERIA_CHANGED,\n        Ranking.EVENT_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED,\n        Ranking.EVENT_ADD_COLUMN,\n        Ranking.EVENT_MOVE_COLUMN,\n        Ranking.EVENT_REMOVE_COLUMN,\n        Ranking.EVENT_LABEL_CHANGED\n      ),\n      null\n    );\n\n    this.entries.forEach((d) => d.destroy());\n    this.entries.clear();\n  }\n}\n","import { suffix } from '../../internal';\nimport {\n  categoryOfDesc,\n  IColumnCategory,\n  createAggregateDesc,\n  createGroupDesc,\n  createImpositionDesc,\n  createNestedDesc,\n  createRankDesc,\n  createReduceDesc,\n  createScriptDesc,\n  createSelectionDesc,\n  createStackDesc,\n  IColumnDesc,\n  Ranking,\n} from '../../model';\nimport { DataProvider, IDataProvider } from '../../provider';\nimport { aria, cssClass } from '../../styles';\nimport ChooseRankingDialog from '../dialogs/ChooseRankingDialog';\nimport type { IRankingHeaderContext } from '../interfaces';\nimport { dialogContext } from '../dialogs';\nimport SearchBox, { IGroupSearchItem, ISearchBoxOptions } from './SearchBox';\nimport SidePanelRanking from './SidePanelRanking';\nimport { format } from 'd3-format';\n\nexport interface IColumnWrapper {\n  desc: IColumnDesc;\n  category: IColumnCategory;\n  id: string;\n  text: string;\n}\n\nfunction isWrapper(item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>): item is IColumnWrapper {\n  return (item as IColumnWrapper).desc != null;\n}\n\nexport interface ISidePanelOptions extends Partial<ISearchBoxOptions<IColumnWrapper>> {\n  additionalDescs: IColumnDesc[];\n  chooser: boolean;\n  hierarchy: boolean;\n  collapseable: boolean | 'collapsed';\n}\n\nexport default class SidePanel {\n  private readonly options: ISidePanelOptions = {\n    additionalDescs: [\n      createStackDesc('Weighted Sum'),\n      createScriptDesc('Scripted Formula'),\n      createNestedDesc('Nested'),\n      createReduceDesc(),\n      createImpositionDesc(),\n      createRankDesc(),\n      createSelectionDesc(),\n      createGroupDesc(),\n      createAggregateDesc(),\n    ],\n    chooser: true,\n    hierarchy: true,\n    placeholder: 'Add Column...',\n    formatItem: (item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>, node: HTMLElement) => {\n      const w: IColumnWrapper = isWrapper(item) ? item : (item.children[0] as IColumnWrapper);\n      node.dataset.typeCat = w.category.name;\n      node.classList.add(cssClass('typed-icon'));\n      if (isWrapper(item)) {\n        node.dataset.type = w.desc.type;\n      }\n      if (node.parentElement) {\n        node.parentElement.classList.add(cssClass('feature-model'));\n        node.parentElement.classList.toggle(cssClass('feature-advanced'), w.category.featureLevel === 'advanced');\n        node.parentElement.classList.toggle(cssClass('feature-basic'), w.category.featureLevel === 'basic');\n\n        if (isWrapper(item)) {\n          const summary = w.desc.summary || w.desc.description;\n          node.classList.toggle(cssClass('searchbox-summary-entry'), Boolean(summary));\n          if (summary) {\n            const label = node.ownerDocument.createElement('span');\n            label.textContent = w.desc.label;\n            node.appendChild(label);\n            const desc = node.ownerDocument.createElement('span');\n            desc.textContent = summary;\n            node.appendChild(desc);\n            return undefined;\n          }\n        }\n      }\n      return item.text;\n    },\n    collapseable: true,\n  };\n\n  readonly node: HTMLElement;\n  private readonly search: SearchBox<IColumnWrapper> | null;\n  private chooser: HTMLElement | null = null;\n  private readonly descs: IColumnWrapper[] = [];\n  private data: IDataProvider;\n  private readonly rankings: SidePanelRanking[] = [];\n\n  constructor(private ctx: IRankingHeaderContext, document: Document, options: Partial<ISidePanelOptions> = {}) {\n    Object.assign(this.options, options);\n\n    this.node = document.createElement('aside');\n    this.node.classList.add(cssClass('side-panel'));\n\n    this.search = this.options.chooser ? new SearchBox<IColumnWrapper>(this.options) : null;\n\n    this.data = ctx.provider;\n    this.init();\n    this.update(ctx);\n  }\n\n  private init() {\n    this.node.innerHTML = `\n      <aside class=\"${cssClass('stats')}\"></aside>\n      <header class=\"${cssClass('side-panel-rankings')}\">\n        <i class=\"${cssClass('action')}\" title=\"Choose &hellip;\">${aria('Choose &hellip;')}</i>\n      </header>\n      <main class=\"${cssClass('side-panel-main')}\"></main>\n    `;\n\n    {\n      const choose = this.node.querySelector<HTMLElement>('header > i');\n      choose.onclick = (evt) => {\n        evt.stopPropagation();\n        const dialog = new ChooseRankingDialog(\n          this.rankings.map((d) => d.dropdown),\n          dialogContext(this.ctx, 1, evt)\n        );\n        dialog.open();\n      };\n    }\n\n    if (this.options.collapseable) {\n      this.node.insertAdjacentHTML(\n        'beforeend',\n        `<div class=\"${cssClass('collapser')}\" title=\"Collapse Panel\">${aria('Collapse Panel')}</div>`\n      );\n      const last = this.node.lastElementChild as HTMLElement;\n      last.onclick = () => (this.collapsed = !this.collapsed);\n      this.collapsed = this.options.collapseable === 'collapsed';\n    }\n    this.initChooser();\n    this.changeDataStorage(null, this.data);\n  }\n\n  private initChooser() {\n    if (!this.search) {\n      return;\n    }\n    this.chooser = this.node.ownerDocument!.createElement('header');\n    this.chooser.appendChild(this.chooser.ownerDocument!.createElement('form'));\n    this.chooser.classList.add(cssClass('side-panel-chooser'));\n    this.chooser.firstElementChild!.appendChild(this.search.node);\n    this.search.on(SearchBox.EVENT_SELECT, (panel: IColumnWrapper) => {\n      const col = this.data.create(panel.desc);\n      if (!col) {\n        return;\n      }\n      const a = this.active;\n      if (a) {\n        a.ranking.push(col);\n      }\n    });\n  }\n\n  private get active() {\n    return this.rankings.find((d) => d.active);\n  }\n\n  private changeDataStorage(old: IDataProvider | null, data: IDataProvider) {\n    if (old) {\n      old.on(\n        suffix(\n          '.panel',\n          DataProvider.EVENT_ADD_RANKING,\n          DataProvider.EVENT_REMOVE_RANKING,\n          DataProvider.EVENT_ADD_DESC,\n          DataProvider.EVENT_REMOVE_DESC,\n          DataProvider.EVENT_CLEAR_DESC,\n          DataProvider.EVENT_ORDER_CHANGED,\n          DataProvider.EVENT_SELECTION_CHANGED\n        ),\n        null\n      );\n    }\n    this.data = data;\n\n    const wrapDesc = (desc: IColumnDesc) => ({\n      desc,\n      category: categoryOfDesc(desc, data.columnTypes),\n      id: `${desc.type}@${desc.label}`,\n      text: desc.label,\n    });\n    this.descs.splice(\n      0,\n      this.descs.length,\n      ...data\n        .getColumns()\n        .filter((d) => d.visible !== false)\n        .concat(this.options.additionalDescs)\n        .map(wrapDesc)\n    );\n\n    data.on(`${DataProvider.EVENT_ADD_DESC}.panel`, (desc: IColumnDesc) => {\n      if (desc.visible !== false) {\n        this.descs.push(wrapDesc(desc));\n        this.updateChooser();\n      }\n    });\n\n    data.on(`${DataProvider.EVENT_CLEAR_DESC}.panel`, () => {\n      this.descs.splice(0, this.descs.length);\n      this.updateChooser();\n    });\n\n    data.on(`${DataProvider.EVENT_REMOVE_DESC}.panel`, (desc: IColumnDesc) => {\n      if (desc.visible !== false) {\n        const index = this.descs.findIndex((d) => d.desc === desc);\n        if (index >= 0) {\n          this.descs.splice(index, 1);\n          this.updateChooser();\n        }\n      }\n    });\n\n    data.on(suffix('.panel', DataProvider.EVENT_SELECTION_CHANGED, DataProvider.EVENT_ORDER_CHANGED), () => {\n      this.updateStats();\n    });\n\n    data.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING), (ranking: Ranking, index: number) => {\n      this.createEntry(ranking, index);\n      this.makeActive(index);\n    });\n\n    data.on(suffix('.panel', DataProvider.EVENT_REMOVE_RANKING), (_: Ranking, index: number) => {\n      if (index < 0) {\n        // remove all\n        this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\n        this.node.querySelector('header')!.dataset.count = '0';\n        this.makeActive(-1);\n        return;\n      }\n      const r = this.rankings.splice(index, 1)[0];\n      this.node.querySelector('header')!.dataset.count = String(this.rankings.length);\n      r.destroy();\n      if (r.active) {\n        this.makeActive(this.rankings.length === 0 ? -1 : Math.max(index - 1, 0));\n      }\n    });\n\n    this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\n    data.getRankings().forEach((d, i) => {\n      this.createEntry(d, i);\n    });\n    if (this.rankings.length > 0) {\n      this.makeActive(0);\n    }\n\n    this.updateStats();\n  }\n\n  private createEntry(ranking: Ranking, index: number) {\n    const entry = new SidePanelRanking(ranking, this.ctx, this.node.ownerDocument!, this.options);\n\n    const header = this.node.querySelector('header')!;\n    const main = this.node.querySelector('main')!;\n\n    header.insertBefore(entry.header, header.children[index + 1]); // for the action\n    header.dataset.count = String(this.rankings.length + 1);\n\n    entry.header.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.makeActive(this.rankings.indexOf(entry));\n    };\n    entry.dropdown.onclick = entry.header.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.ctx.dialogManager.removeAboveLevel(0);\n      this.makeActive(this.rankings.indexOf(entry));\n    };\n\n    main.insertBefore(entry.node, main.children[index]);\n\n    this.rankings.splice(index, 0, entry);\n  }\n\n  get collapsed() {\n    return this.node.classList.contains(cssClass('collapsed'));\n  }\n\n  set collapsed(value: boolean) {\n    this.node.classList.toggle(cssClass('collapsed'), value);\n    if (value) {\n      return;\n    }\n    this.updateChooser();\n    this.updateStats();\n    this.updateRanking();\n  }\n\n  private makeActive(index: number) {\n    this.rankings.forEach((d, i) => (d.active = index === i));\n\n    const active = this.active;\n    if (active && this.chooser) {\n      active.node.insertAdjacentElement('afterbegin', this.chooser);\n      // scroll to body\n      const parent = this.node.closest<HTMLElement>(`.${cssClass()}`)!;\n      const body = parent ? parent.querySelector(`article[data-ranking=\"${active.ranking.id}\"]`) : null;\n      if (body) {\n        body.scrollIntoView();\n      }\n    }\n    this.updateRanking();\n  }\n\n  private updateRanking() {\n    const active = this.active;\n    if (active && !this.collapsed) {\n      active.update(this.ctx);\n    }\n  }\n\n  update(ctx: IRankingHeaderContext) {\n    const bak = this.data;\n    this.ctx = ctx;\n    if (ctx.provider !== bak) {\n      this.changeDataStorage(bak, ctx.provider);\n    }\n    this.updateChooser();\n    this.updateStats();\n\n    const active = this.active;\n    if (active) {\n      active.update(ctx);\n    }\n  }\n\n  private updateStats() {\n    if (this.collapsed) {\n      return;\n    }\n    const stats = this.node.querySelector<HTMLElement>(`.${cssClass('stats')}`);\n    const s = this.data.getSelection();\n    const r = this.data.getFirstRanking();\n    const f = format(',d');\n    const visible = r ? r.getGroups().reduce((a, b) => a + b.order.length, 0) : 0;\n    const total = this.data.getTotalNumberOfRows();\n    stats.innerHTML = `Showing <strong>${f(visible)}</strong> of ${f(total)} items${\n      s.length > 0 ? `; <span>${f(s.length)} selected</span>` : ''\n    }${\n      visible < total\n        ? ` <i class=\"${cssClass('action')} ${cssClass('action-filter')} ${cssClass(\n            'stats-reset'\n          )}\" title=\"Reset filters\"><span>Reset</span></i>`\n        : ''\n    }`;\n\n    const resetButton = stats.querySelector<HTMLElement>(`.${cssClass('stats-reset')}`);\n    if (!resetButton) {\n      return;\n    }\n    resetButton.onclick = (evt) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n      this.data.clearFilters();\n    };\n  }\n\n  destroy() {\n    this.node.remove();\n    if (!this.data) {\n      return;\n    }\n    this.rankings.forEach((d) => d.destroy());\n    this.rankings.length = 0;\n    this.data.on(\n      suffix('.panel', DataProvider.EVENT_ADD_RANKING, DataProvider.EVENT_REMOVE_RANKING, DataProvider.EVENT_ADD_DESC),\n      null\n    );\n  }\n\n  private static groupByType(entries: IColumnWrapper[]): { text: string; children: IColumnWrapper[] }[] {\n    const map = new Map<IColumnCategory, IColumnWrapper[]>();\n    entries.forEach((entry) => {\n      if (!map.has(entry.category)) {\n        map.set(entry.category, [entry]);\n      } else {\n        map.get(entry.category)!.push(entry);\n      }\n    });\n    return Array.from(map)\n      .map(([key, value]) => {\n        return {\n          text: key.label,\n          order: key.order,\n          children: value.sort((a, b) => a.text.localeCompare(b.text)),\n        };\n      })\n      .sort((a, b) => a.order - b.order);\n  }\n\n  private updateChooser() {\n    if (!this.search || this.collapsed) {\n      return;\n    }\n    this.search.data = SidePanel.groupByType(this.descs);\n  }\n}\n","import { ILineUpOptions, defaultOptions } from '../config';\nimport { merge, suffix } from '../internal';\nimport type { DataProvider } from '../provider';\nimport { cssClass } from '../styles';\nimport { ALineUp } from './ALineUp';\nimport EngineRenderer from './EngineRenderer';\nimport SidePanel from './panel/SidePanel';\n\nexport default class LineUp extends ALineUp {\n  static readonly EVENT_SELECTION_CHANGED = ALineUp.EVENT_SELECTION_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = ALineUp.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = ALineUp.EVENT_DIALOG_CLOSED;\n  static readonly EVENT_HIGHLIGHT_CHANGED = ALineUp.EVENT_HIGHLIGHT_CHANGED;\n\n  private readonly renderer: EngineRenderer | null;\n  private readonly panel: SidePanel | null;\n\n  private readonly options = defaultOptions();\n\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ILineUpOptions> = {}) {\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\n\n    merge(this.options, options);\n\n    if (!this.isBrowserSupported) {\n      this.renderer = null;\n      this.panel = null;\n      return;\n    }\n\n    this.node.classList.add(cssClass());\n\n    this.renderer = new EngineRenderer(data, this.node, this.options);\n    if (this.options.sidePanel) {\n      this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\n        collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\n        hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures,\n      });\n      this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\n      this.node.insertBefore(this.panel.node, this.node.firstChild);\n    } else {\n      this.panel = null;\n    }\n    this.forward(\n      this.renderer,\n      ...suffix(\n        '.main',\n        EngineRenderer.EVENT_HIGHLIGHT_CHANGED,\n        EngineRenderer.EVENT_DIALOG_OPENED,\n        EngineRenderer.EVENT_DIALOG_CLOSED\n      )\n    );\n  }\n\n  destroy() {\n    this.node.classList.remove(cssClass());\n    if (this.renderer) {\n      this.renderer.destroy();\n    }\n    if (this.panel) {\n      this.panel.destroy();\n    }\n    super.destroy();\n  }\n\n  update() {\n    if (this.renderer) {\n      this.renderer.update();\n    }\n  }\n\n  setDataProvider(data: DataProvider, dump?: any) {\n    super.setDataProvider(data, dump);\n    if (!this.renderer) {\n      return;\n    }\n    this.renderer.setDataProvider(data);\n    this.update();\n    if (this.panel) {\n      this.panel.update(this.renderer.ctx);\n    }\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView = true) {\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\n  }\n\n  getHighlight() {\n    return this.renderer ? this.renderer.getHighlight() : -1;\n  }\n\n  protected enableHighlightListening(enable: boolean) {\n    if (this.renderer) {\n      this.renderer.enableHighlightListening(enable);\n    }\n  }\n}\n","import { IGroupData, IGroupItem, isGroup } from '../../model';\nimport { groupEndLevel, ITopNGetter } from '../../provider/internal';\n\nexport interface IRule {\n  apply(\n    data: (IGroupData | IGroupItem)[],\n    availableHeight: number,\n    selection: Set<number>,\n    topNGetter: ITopNGetter\n  ): IRuleInstance;\n\n  levelOfDetail(item: IGroupData | IGroupItem, height: number): 'high' | 'low';\n}\n\nexport interface IRuleInstance {\n  item: number | ((item: IGroupItem) => number);\n  group: number | ((group: IGroupData) => number);\n  violation?: string;\n}\n\nexport function spaceFillingRule(config: { groupHeight: number; rowHeight: number; groupPadding: number }) {\n  function levelOfDetail(item: IGroupData | IGroupItem, height: number): 'high' | 'low' {\n    const group = isGroup(item);\n    const maxHeight = group ? config.groupHeight : config.rowHeight;\n    if (height >= maxHeight * 0.9) {\n      return 'high';\n    }\n    return 'low';\n  }\n\n  function itemHeight(\n    data: (IGroupData | IGroupItem)[],\n    availableHeight: number,\n    selection: Set<number>,\n    topNGetter: ITopNGetter\n  ) {\n    const visibleHeight = availableHeight - config.rowHeight - 5; // some padding for hover\n    const items = data.filter((d) => !isGroup(d)) as IGroupItem[];\n    const groups = data.length - items.length;\n    const selected = items.reduce((a, d) => a + (selection.has(d.dataIndex) ? 1 : 0), 0);\n    const unselected = items.length - selected;\n    const groupSeparators = items.reduce((a, d) => a + groupEndLevel(d, topNGetter), 0);\n\n    if (unselected <= 0) {\n      // doesn't matter since all are selected anyhow\n      return { height: config.rowHeight, violation: '' };\n    }\n    const available =\n      visibleHeight - groups * config.groupHeight - groupSeparators * config.groupPadding - selected * config.rowHeight;\n\n    const height = Math.floor(available / unselected); // round to avoid sub pixel issues\n    if (height < 1) {\n      return {\n        height: 1,\n        violation: `Not possible to fit all rows on the screen.`,\n      };\n    }\n    // clamp to max height\n    if (height > config.rowHeight) {\n      return {\n        height: config.rowHeight,\n        violation: '',\n      };\n    }\n    return { height, violation: '' };\n  }\n\n  return {\n    apply: (\n      data: (IGroupData | IGroupItem)[],\n      availableHeight: number,\n      selection: Set<number>,\n      topNGetter: ITopNGetter\n    ) => {\n      const { violation, height } = itemHeight(data, availableHeight, selection, topNGetter);\n\n      const item = (item: IGroupItem) => {\n        if (selection.has(item.dataIndex)) {\n          return config.rowHeight;\n        }\n        return height;\n      };\n      return { item, group: config.groupHeight, violation };\n    },\n    levelOfDetail,\n  } as IRule;\n}\n","import type { GridStyleManager } from 'lineupengine';\nimport type { ILineUpOptions } from '../../config';\nimport { debounce, AEventDispatcher, IEventListener, suffix } from '../../internal';\nimport { IGroupData, IGroupItem, isGroup, Ranking, IGroup } from '../../model';\nimport { DataProvider } from '../../provider';\nimport type { IRenderContext } from '../../renderer';\nimport type { IEngineRankingContext } from '../EngineRanking';\nimport EngineRenderer from '../EngineRenderer';\nimport type { IRankingHeaderContext, IRankingHeaderContextContainer } from '../interfaces';\nimport type { IRule } from './rules';\nimport type { ADialog } from '../dialogs';\n\n/**\n * emitted when the highlight changes\n * @asMemberOf TaggleRenderer\n * @param dataIndex the highlighted data index or -1 for none\n * @event\n */\nexport declare function highlightChanged(dataIndex: number): void;\n/**\n * emitted a dialog is opened\n * @asMemberOf TaggleRenderer\n * @param dialog the opened dialog\n * @event\n */\nexport declare function dialogOpened(dialog: ADialog): void;\n/**\n * emitted a dialog is closed\n * @asMemberOf TaggleRenderer\n * @param dialog the closed dialog\n * @param action the action how the dialog was closed\n * @event\n */\nexport declare function dialogClosed(dialog: ADialog, action: 'cancel' | 'confirm'): void;\n\nexport interface ITaggleOptions {\n  violationChanged(rule: IRule | null, violation: string): void;\n\n  rowPadding: number;\n}\n\nexport default class TaggleRenderer extends AEventDispatcher {\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRenderer.EVENT_HIGHLIGHT_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = EngineRenderer.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = EngineRenderer.EVENT_DIALOG_CLOSED;\n\n  private isDynamicLeafHeight = false;\n\n  private rule: IRule | null = null;\n  private levelOfDetail: ((rowIndex: number) => 'high' | 'low') | null = null;\n  private readonly resizeListener = () => debounce(() => this.update(), 100);\n  private readonly renderer: EngineRenderer;\n\n  private readonly options: Readonly<ITaggleOptions> = {\n    violationChanged: () => undefined,\n    rowPadding: 2,\n  };\n\n  constructor(\n    public data: DataProvider,\n    parent: HTMLElement,\n    options: Partial<ITaggleOptions> & Readonly<ILineUpOptions>\n  ) {\n    super();\n    Object.assign(this.options, options);\n\n    this.renderer = new EngineRenderer(\n      data,\n      parent,\n      Object.assign({}, options, {\n        dynamicHeight: (data: (IGroupData | IGroupItem)[], ranking: Ranking) => {\n          const r = this.dynamicHeight(data, ranking);\n          if (r) {\n            return r;\n          }\n          return options.dynamicHeight ? options.dynamicHeight(data, ranking) : null;\n        },\n        levelOfDetail: (rowIndex: number) => (this.levelOfDetail ? this.levelOfDetail(rowIndex) : 'high'),\n      })\n    );\n\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\n      if (this.isDynamicLeafHeight) {\n        this.update();\n      }\n    });\n    this.forward(\n      this.renderer,\n      ...suffix(\n        '.main',\n        EngineRenderer.EVENT_HIGHLIGHT_CHANGED,\n        EngineRenderer.EVENT_DIALOG_OPENED,\n        EngineRenderer.EVENT_DIALOG_CLOSED\n      )\n    );\n\n    window.addEventListener('resize', this.resizeListener, {\n      passive: true,\n    });\n  }\n\n  get style(): GridStyleManager {\n    return this.renderer.style;\n  }\n\n  get ctx(): IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext {\n    return this.renderer.ctx;\n  }\n\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\n    this.renderer.pushUpdateAble(updateAble);\n  }\n\n  private dynamicHeight(data: (IGroupData | IGroupItem)[], ranking: Ranking) {\n    if (!this.rule) {\n      this.levelOfDetail = null;\n      this.options.violationChanged(null, '');\n      return null;\n    }\n\n    const availableHeight = this.renderer ? this.renderer.node.querySelector('main')!.clientHeight : 100;\n    const topNGetter = (group: IGroup) => this.data.getTopNAggregated(ranking, group);\n    const instance = this.rule.apply(data, availableHeight, new Set(this.data.getSelection()), topNGetter);\n\n    this.isDynamicLeafHeight = typeof instance.item === 'function';\n\n    this.options.violationChanged(this.rule, instance.violation || '');\n\n    const height = (item: IGroupItem | IGroupData) => {\n      if (isGroup(item)) {\n        return typeof instance.group === 'number' ? instance.group : instance.group(item);\n      }\n      return typeof instance.item === 'number' ? instance.item : instance.item(item);\n    };\n\n    this.levelOfDetail = (rowIndex: number) => {\n      const item = data[rowIndex];\n      return this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\n    };\n\n    // padding is always 0 since included in height\n    // const padding = (item: IGroupData | IGroupItem | null) => {\n    //   if (!item) {\n    //     item = data[0];\n    //   }\n    //   const lod = this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\n    //   return lod === 'high' ? 0 : 0; // always 0 since\n    // };\n\n    return {\n      defaultHeight: typeof instance.item === 'number' ? instance.item : NaN,\n      height,\n      padding: 0,\n    };\n  }\n\n  protected createEventList() {\n    return super\n      .createEventList()\n      .concat([\n        TaggleRenderer.EVENT_HIGHLIGHT_CHANGED,\n        TaggleRenderer.EVENT_DIALOG_OPENED,\n        TaggleRenderer.EVENT_DIALOG_CLOSED,\n      ]);\n  }\n\n  on(type: typeof TaggleRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\n  on(type: typeof TaggleRenderer.EVENT_DIALOG_OPENED, listener: typeof dialogOpened | null): this;\n  on(type: typeof TaggleRenderer.EVENT_DIALOG_CLOSED, listener: typeof dialogClosed | null): this;\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\n  on(type: string | string[], listener: IEventListener | null): this {\n    return super.on(type, listener);\n  }\n\n  zoomOut() {\n    this.renderer.zoomOut();\n  }\n\n  zoomIn() {\n    this.renderer.zoomIn();\n  }\n\n  switchRule(rule: IRule | null) {\n    if (this.rule === rule) {\n      return;\n    }\n    this.rule = rule;\n    this.update();\n  }\n\n  destroy() {\n    this.renderer.destroy();\n    window.removeEventListener('resize', this.resizeListener);\n  }\n\n  update() {\n    this.renderer.update();\n  }\n\n  setDataProvider(data: DataProvider) {\n    if (this.data) {\n      this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, null);\n    }\n    this.data = data;\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\n      if (this.isDynamicLeafHeight) {\n        this.update();\n      }\n    });\n    this.renderer.setDataProvider(data);\n    this.update();\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\n    return this.renderer.setHighlight(dataIndex, scrollIntoView);\n  }\n\n  getHighlight() {\n    return this.renderer.getHighlight();\n  }\n\n  enableHighlightListening(enable: boolean) {\n    this.renderer.enableHighlightListening(enable);\n  }\n}\n","import type { GridStyleManager } from 'lineupengine';\nimport { defaultOptions } from '../../config';\nimport type { ITaggleOptions } from '../../config';\nimport { merge, suffix } from '../../internal';\nimport type { DataProvider } from '../../provider';\nimport { cssClass, engineCssClass } from '../../styles';\nimport { ALineUp } from '../ALineUp';\nimport SidePanel from '../panel/SidePanel';\nimport { spaceFillingRule } from './rules';\nimport TaggleRenderer from './TaggleRenderer';\n\nexport default class Taggle extends ALineUp {\n  static readonly EVENT_SELECTION_CHANGED = ALineUp.EVENT_SELECTION_CHANGED;\n  static readonly EVENT_DIALOG_OPENED = ALineUp.EVENT_DIALOG_OPENED;\n  static readonly EVENT_DIALOG_CLOSED = ALineUp.EVENT_DIALOG_CLOSED;\n  static readonly EVENT_HIGHLIGHT_CHANGED = ALineUp.EVENT_HIGHLIGHT_CHANGED;\n\n  private readonly spaceFilling: HTMLElement | null;\n  private readonly renderer: TaggleRenderer | null;\n  private readonly panel: SidePanel | null;\n\n  private readonly options = defaultOptions();\n\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ITaggleOptions> = {}) {\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\n    merge(this.options, options);\n    merge(this.options, {\n      violationChanged: (_rule: any, violation?: string) => this.setViolation(violation),\n    });\n\n    if (!this.isBrowserSupported) {\n      this.spaceFilling = null;\n      this.renderer = null;\n      this.panel = null;\n      return;\n    }\n\n    this.node.classList.add(cssClass(), cssClass('taggle'));\n\n    this.renderer = new TaggleRenderer(data, this.node, this.options);\n    this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\n      collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\n      hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures,\n    });\n    this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\n    this.node.insertBefore(this.panel.node, this.node.firstChild);\n    {\n      this.panel.node.insertAdjacentHTML(\n        'afterbegin',\n        `<div class=\"${cssClass('rule-button-chooser')} ${cssClass('feature-advanced')} ${cssClass(\n          'feature-ui'\n        )}\"><label>\n            <input type=\"checkbox\">\n            <span>Overview</span>\n            <div class=\"${cssClass('rule-violation')}\"></div>\n          </label></div>`\n      );\n      const spaceFilling = spaceFillingRule(this.options);\n      this.spaceFilling = this.panel.node.querySelector<HTMLElement>(`.${cssClass('rule-button-chooser')}`)!;\n      const input = this.spaceFilling.querySelector<HTMLInputElement>('input');\n      input.onchange = () => {\n        const selected = this.spaceFilling!.classList.toggle(cssClass('chosen'));\n        setTimeout(() => {\n          this.updateLodRules(selected);\n          this.renderer!.switchRule(selected ? spaceFilling : null);\n        });\n      };\n      if (this.options.overviewMode) {\n        input.checked = true;\n        this.spaceFilling.classList.toggle(cssClass('chosen'));\n        this.updateLodRules(true);\n        this.renderer.switchRule(spaceFilling);\n      }\n    }\n    this.forward(\n      this.renderer,\n      ...suffix(\n        '.main',\n        TaggleRenderer.EVENT_HIGHLIGHT_CHANGED,\n        TaggleRenderer.EVENT_DIALOG_OPENED,\n        TaggleRenderer.EVENT_DIALOG_CLOSED\n      )\n    );\n  }\n\n  private updateLodRules(overviewMode: boolean) {\n    if (!this.renderer) {\n      return;\n    }\n    updateLodRules(this.renderer.style, overviewMode, this.options);\n  }\n\n  private setViolation(violation?: string) {\n    violation = violation || '';\n    if (!this.spaceFilling) {\n      return;\n    }\n    this.spaceFilling.classList.toggle(cssClass('violated'), Boolean(violation));\n    const elem = this.spaceFilling.querySelector(`.${cssClass('rule-violation')}`)!;\n    if (!violation) {\n      elem.textContent = '';\n    } else {\n      elem.innerHTML = violation.replace(/\\n/g, '<br>');\n    }\n  }\n\n  destroy() {\n    this.node.classList.remove(cssClass(), cssClass('taggle'));\n    if (this.renderer) {\n      this.renderer.destroy();\n    }\n    if (this.panel) {\n      this.panel.destroy();\n    }\n    super.destroy();\n  }\n\n  update() {\n    if (this.renderer) {\n      this.renderer.update();\n    }\n  }\n\n  setHighlight(dataIndex: number, scrollIntoView = true) {\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\n  }\n\n  getHighlight() {\n    return this.renderer ? this.renderer.getHighlight() : -1;\n  }\n\n  protected enableHighlightListening(enable: boolean) {\n    if (this.renderer) {\n      this.renderer.enableHighlightListening(enable);\n    }\n  }\n\n  setDataProvider(data: DataProvider, dump?: any) {\n    super.setDataProvider(data, dump);\n    if (!this.renderer) {\n      return;\n    }\n    this.renderer.setDataProvider(data);\n    this.update();\n    this.panel!.update(this.renderer.ctx);\n  }\n}\n\nexport function updateLodRules(style: GridStyleManager, overviewMode: boolean, options: Readonly<ITaggleOptions>) {\n  if (!overviewMode) {\n    style.deleteRule('taggle_lod_rule');\n    style.deleteRule('lineup_rowPadding1');\n    style.deleteRule('lineup_rowPadding2');\n    return;\n  }\n\n  style.updateRule(\n    'taggle_lod_rule',\n    `\n  .${engineCssClass('tr')}.${cssClass('low')}[data-agg=detail]:hover`,\n    {\n      /* show regular height for hovered rows in low + medium LOD */\n      height: `${options.rowHeight}px !important`,\n    }\n  );\n\n  style.updateRule(\n    'lineup_rowPadding1',\n    `\n  .${engineCssClass('tr')}.${cssClass('low')}`,\n    {\n      marginTop: '0',\n    }\n  );\n\n  // no margin for hovered low level row otherwise everything will be shifted down and the hover is gone again\n  // .${engineCssClass('tr')}.${cssClass('low')}:hover,\n\n  // padding in general and for hovered low detail rows + their afterwards\n  style.updateRule(\n    'lineup_rowPadding2',\n    `\n  .${engineCssClass('tr')}.${cssClass('low')}.${engineCssClass('highlighted')},\n  .${engineCssClass('tr')}.${cssClass('selected')},\n  .${engineCssClass('tr')}.${cssClass('low')}:hover + .${engineCssClass('tr')}.${cssClass('low')},\n  .${engineCssClass('tr')}.${cssClass('low')}.${engineCssClass('highlighted')} + .${engineCssClass('tr')}.${cssClass(\n      'low'\n    )},\n  .${engineCssClass('tr')}.${cssClass('selected')} + .${engineCssClass('tr')}.${cssClass('low')}`,\n    {\n      marginTop: `${options.rowPadding}px !important`,\n    }\n  );\n}\n","import type { IArrayDesc, IColumnDesc } from '../../model';\n\nexport default class ColumnBuilder<T extends IColumnDesc = IColumnDesc> {\n  protected readonly desc: T;\n\n  constructor(type: string, column: string) {\n    this.desc = { column, type, label: column ? column[0].toUpperCase() + column.slice(1) : type } as any;\n  }\n\n  /**\n   * column label\n   */\n  label(label: string) {\n    this.desc.label = label;\n    return this;\n  }\n\n  /**\n   * hide this column by default\n   */\n  hidden() {\n    this.desc.visible = false;\n    return this;\n  }\n\n  /**\n   * column summary text (subtitle)\n   */\n  summary(summary: string) {\n    this.desc.summary = summary;\n    return this;\n  }\n\n  /**\n   * column description\n   */\n  description(description: string) {\n    this.desc.description = description;\n    return this;\n  }\n\n  /**\n   * sets the frozen state of this column, i.e is sticky to the left side when scrolling horizontally\n   */\n  frozen() {\n    this.desc.frozen = true;\n    return this;\n  }\n\n  /**\n   * specify the renderer to used for this column\n   * @param {string} renderer within a cell\n   * @param {string} groupRenderer within an aggregated cell\n   * @param {string} summaryRenderer within the summary in the header and side panel\n   */\n  renderer(renderer?: string, groupRenderer?: string, summaryRenderer?: string) {\n    if (renderer) {\n      this.desc.renderer = renderer;\n    }\n    if (groupRenderer) {\n      this.desc.groupRenderer = groupRenderer;\n    }\n    if (summaryRenderer) {\n      this.desc.summaryRenderer = summaryRenderer;\n    }\n    return this;\n  }\n\n  /**\n   * specify a custom additional attribute for the description\n   * @param {string} key the property key\n   * @param value its value\n   */\n  custom(key: string, value: any) {\n    (this.desc as any)[key] = value;\n    return this;\n  }\n\n  /**\n   * sets the default width of the column\n   */\n  width(width: number) {\n    this.desc.width = width;\n    return this;\n  }\n\n  /**\n   * sets the column color in case of numerical columns\n   * @deprecated use colorMapping in the number case instead\n   */\n  color(_color: string) {\n    return this;\n  }\n\n  /**\n   * converts the column type to be an array type, supports only base types: boolean, categorical, date, number, and string\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\n   */\n  asArray(labels?: string[] | number) {\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\n    this.desc.type += 's';\n    const a = this.desc as IArrayDesc;\n    if (Array.isArray(labels)) {\n      a.labels = labels;\n      a.dataLength = labels.length;\n    } else if (typeof labels === 'number') {\n      a.dataLength = labels;\n    }\n    return this;\n  }\n\n  /**\n   * converts the column type to be a map type, supports only base types: categorical, date, number, and string\n   */\n  asMap() {\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\n    this.desc.type += 'Map';\n    return this;\n  }\n\n  /**\n   * build the column description\n   */\n  build(_data: any[]): T {\n    return this.desc as any;\n  }\n}\n\n/**\n * build a column of a given type\n * @param {string} type column type\n * @param {string} column column which contains the associated data\n * @returns {ColumnBuilder<IColumnDesc>}\n */\nexport function buildColumn(type: string, column: string) {\n  return new ColumnBuilder(type, column);\n}\n","import type { IDynamicHeight, ITaggleOptions, ILivePreviewOptions } from '../config';\nimport type { IGroupData, IGroupItem, Ranking } from '../model';\nimport type Column from '../model';\nimport type { ICellRendererFactory, ERenderMode } from '../renderer';\nimport type { IToolbarAction, IToolbarDialogAddon } from '../ui';\n\n/**\n * builder for LineUp/Taggle instance\n */\nexport default class LineUpBuilder {\n  protected readonly options: Partial<ITaggleOptions> = {\n    renderers: {},\n    toolbarActions: {},\n    toolbarDialogAddons: {},\n    flags: {},\n  };\n\n  /**\n   * option to enable/disable animated transitions\n   * @default true\n   */\n  animated(enable: boolean) {\n    this.options.animated = enable;\n    return this;\n  }\n\n  livePreviews(options: Partial<ILivePreviewOptions>) {\n    this.options.livePreviews = options;\n    return this;\n  }\n\n  /**\n   * option to rotate labels on demand in narrow columns\n   * @param rotation rotation in degrees\n   * @default 0 - disabled\n   */\n  labelRotation(rotation: number) {\n    this.options.labelRotation = rotation;\n    return this;\n  }\n\n  /**\n   * option to enable/disable the side panel\n   * @param {boolean} enable enable flag\n   * @param {boolean} collapsed whether collapsed by default\n   */\n  sidePanel(enable: boolean, collapsed = false) {\n    this.options.sidePanel = enable;\n    this.options.sidePanelCollapsed = collapsed;\n    return this;\n  }\n\n  /**\n   * show the sorting and grouping hierarchy indicator in the side panel\n   * @param {boolean} enable enable flag\n   */\n  hierarchyIndicator(enable: boolean) {\n    this.options.hierarchyIndicator = enable;\n    return this;\n  }\n\n  /**\n   * option to specify the default slope graph mode\n   * @default 'item'\n   */\n  defaultSlopeGraphMode(mode: 'item' | 'band') {\n    this.options.defaultSlopeGraphMode = mode;\n    return this;\n  }\n\n  /**\n   * option to enable/disable showing a summary (histogram, ...) in the header\n   * @default true\n   */\n  summaryHeader(enable: boolean) {\n    this.options.summaryHeader = enable;\n    return this;\n  }\n\n  /**\n   * option to enforce that the whole row is shown upon hover without overflow hidden\n   * @default false\n   */\n  expandLineOnHover(enable: boolean) {\n    this.options.expandLineOnHover = enable;\n    return this;\n  }\n\n  /**\n   * option to enable overview mode by default, just valid when building a Taggle instance\n   * @returns {this}\n   */\n  overviewMode() {\n    this.options.overviewMode = true;\n    return this;\n  }\n\n  /**\n   * option to ignore unsupported browser check - at own risk\n   * @returns {this}\n   */\n  ignoreUnsupportedBrowser() {\n    this.options.ignoreUnsupportedBrowser = true;\n    return this;\n  }\n\n  /**\n   * register a new renderer factory function\n   * @param id the renderer id\n   * @param factory factory class implementing the renderer\n   */\n  registerRenderer(id: string, factory: ICellRendererFactory) {\n    this.options.renderers![id] = factory;\n    return this;\n  }\n\n  /**\n   * custom function whether the given renderer should be allowed to render the give colum in the given mode\n   */\n  canRender(canRender: (type: string, renderer: ICellRendererFactory, col: Column, mode: ERenderMode) => boolean) {\n    this.options.canRender = canRender;\n    return this;\n  }\n\n  /**\n   * register another toolbar action which can be used within a model class\n   * @param id toolbar id\n   * @param action\n   */\n  registerToolbarAction(id: string, action: IToolbarAction) {\n    this.options.toolbarActions![id] = action;\n    return this;\n  }\n\n  /**\n   * register another toolbar action which can be sued within a model class\n   * @param id  dialog id\n   * @param addon addon description\n   */\n  registerToolbarDialogAddon(id: string, addon: IToolbarDialogAddon) {\n    this.options.toolbarDialogAddons![id] = addon;\n    return this;\n  }\n\n  /**\n   * height and padding of a row\n   * @default 18 and 2\n   */\n  rowHeight(rowHeight: number, rowPadding = 2) {\n    this.options.rowHeight = rowHeight;\n    this.options.rowPadding = rowPadding;\n    return this;\n  }\n\n  /**\n   * height and padding of an aggregated group in pixel\n   * @default 40 and 5\n   */\n  groupRowHeight(groupHeight: number, groupPadding = 5) {\n    this.options.groupHeight = groupHeight;\n    this.options.groupPadding = groupPadding;\n    return this;\n  }\n\n  /**\n   * custom function to compute the height of a row (group or item)\n   * @param {(data: (IGroupItem | IGroupData)[], ranking: Ranking) => (IDynamicHeight | null)} callback\n   */\n  dynamicHeight(callback: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => IDynamicHeight | null) {\n    this.options.dynamicHeight = callback;\n    return this;\n  }\n\n  /**\n   * disables advanced ranking features (sort by, group by, sorting hierarchy, ...)\n   */\n  disableAdvancedRankingFeatures() {\n    this.options.flags!.advancedRankingFeatures = false;\n    return this;\n  }\n\n  /**\n   * disables advanced model features (add combine column, data mapping, edit pattern, ...)\n   */\n  disableAdvancedModelFeatures() {\n    this.options.flags!.advancedModelFeatures = false;\n    return this;\n  }\n\n  /**\n   * disables advanced ui features (change visualization, color mapping)\n   */\n  disableAdvancedUIFeatures() {\n    this.options.flags!.advancedUIFeatures = false;\n    return this;\n  }\n}\n","import {\n  Column,\n  CompositeColumn,\n  Ranking,\n  ReduceColumn,\n  StackColumn,\n  createAggregateDesc,\n  createGroupDesc,\n  createImpositionBoxPlotDesc,\n  createImpositionDesc,\n  createImpositionsDesc,\n  createNestedDesc,\n  createRankDesc,\n  createReduceDesc,\n  createScriptDesc,\n  createSelectionDesc,\n  createStackDesc,\n  EAdvancedSortMethod,\n  IColumnDesc,\n  ISortCriteria,\n} from '../model';\nimport type { DataProvider } from '../provider';\n\nexport interface IImposeColumnBuilder {\n  type: 'impose';\n  column: string;\n  label?: string;\n  colorColumn: string;\n}\n\nexport interface INestedBuilder {\n  type: 'nested';\n  label?: string;\n  columns: string[];\n}\n\nexport interface IWeightedSumBuilder {\n  type: 'weightedSum';\n  columns: string[];\n  label?: string;\n  weights: number[];\n}\n\nexport interface IReduceBuilder {\n  type: 'min' | 'max' | 'mean' | 'median';\n  columns: string[];\n  label?: string;\n}\n\nexport interface IScriptedBuilder {\n  type: 'script';\n  code: string;\n  columns: string[];\n  label?: string;\n}\n\n/**\n * builder for a ranking\n */\nexport class RankingBuilder {\n  private static readonly ALL_MAGIC_FLAG = '*';\n\n  private readonly columns: (\n    | string\n    | { desc: IColumnDesc | ((data: DataProvider) => IColumnDesc); columns: string[]; post?: (col: Column) => void }\n  )[] = [];\n  private readonly sort: { column: string; asc: boolean }[] = [];\n  private readonly groupSort: { column: string; asc: boolean }[] = [];\n  private readonly groups: string[] = [];\n\n  /**\n   * specify another sorting criteria\n   * @param {string} column the column name optionally with encoded sorting separated by colon, e.g. a:desc\n   * @param {boolean | \"asc\" | \"desc\"} asc ascending or descending order\n   */\n  sortBy(column: string, asc: boolean | 'asc' | 'desc' = true) {\n    if (column.includes(':')) {\n      // encoded sorting order\n      const index = column.indexOf(':');\n      asc = column.slice(index + 1) as 'asc' | 'desc';\n      column = column.slice(0, index);\n    }\n    this.sort.push({ column, asc: asc === true || String(asc)[0] === 'a' });\n    return this;\n  }\n\n  /**\n   * specify grouping criteria\n   * @returns {this}\n   */\n  groupBy(...columns: (string | string[])[]) {\n    for (const col of columns) {\n      if (Array.isArray(col)) {\n        this.groups.push(...col);\n      } else {\n        this.groups.push(col);\n      }\n    }\n    return this;\n  }\n\n  /**\n   * specify another grouping sorting criteria\n   * @param {string} column the column name optionally with encoded sorting separated by colon, e.g. a:desc\n   * @param {boolean | \"asc\" | \"desc\"} asc ascending or descending order\n   */\n  groupSortBy(column: string, asc: boolean | 'asc' | 'desc' = true) {\n    if (column.includes(':')) {\n      // encoded sorting order\n      const index = column.indexOf(':');\n      asc = column.slice(index + 1) as 'asc' | 'desc';\n      column = column.slice(0, index);\n    }\n    this.groupSort.push({ column, asc: asc === true || String(asc)[0] === 'a' });\n    return this;\n  }\n\n  /**\n   * add another column to this ranking, identified by column name or label. magic names are used for special columns:\n   * <ul>\n   *     <li>'*' = all columns</li>\n   *     <li>'_*' = all support columns</li>\n   *     <li>'_aggregate' = aggregate column</li>\n   *     <li>'_selection' = selection column</li>\n   *     <li>'_group' = group column</li>\n   *     <li>'_rank' = rank column</li>\n   * </ul>\n   * In addition build objects for combined columns are supported.\n   * @param {string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder} column\n   */\n  column(\n    column: string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder\n  ) {\n    if (typeof column === 'string') {\n      switch (column) {\n        case '_aggregate':\n          return this.aggregate();\n        case '_selection':\n          return this.selection();\n        case '_group':\n          return this.group();\n        case '_rank':\n          return this.rank();\n        case '_*':\n          return this.supportTypes();\n        case '*':\n          return this.allColumns();\n      }\n      this.columns.push(column);\n      return this;\n    }\n    const label = column.label || null;\n    // builder ish\n    switch (column.type) {\n      case 'impose':\n        return this.impose(label, column.column, column.colorColumn);\n      case 'min':\n      case 'max':\n      case 'median':\n      case 'mean':\n        console.assert(column.columns.length >= 2);\n        return this.reduce(label, column.type as any, column.columns[0], column.columns[1], ...column.columns.slice(2));\n      case 'nested':\n        console.assert(column.columns.length >= 1);\n        return this.nested(label, column.columns[0], ...column.columns.slice(1));\n      case 'script':\n        return this.scripted(label, column.code, ...column.columns);\n      case 'weightedSum':\n        console.assert(column.columns.length >= 2);\n        console.assert(column.columns.length === column.weights.length);\n        const mixed: (string | number)[] = [];\n        column.columns.slice(2).forEach((c, i) => {\n          mixed.push(c);\n          mixed.push(column.weights[i + 2]);\n        });\n        return this.weightedSum(\n          label,\n          column.columns[0],\n          column.weights[0],\n          column.columns[1],\n          column.weights[1],\n          ...mixed\n        );\n    }\n  }\n\n  /**\n   * add an imposed column (numerical column colored by categorical column) to this ranking\n   * @param {string | null} label optional label\n   * @param {string} numberColumn numerical column reference\n   * @param {string} colorColumn categorical column reference\n   */\n  impose(label: string | null, numberColumn: string, colorColumn: string) {\n    this.columns.push({\n      desc: (data) => {\n        const base = data.getColumns().find((d) => d.label === numberColumn || (d as any).column === numberColumn);\n        switch (base ? base.type : '') {\n          case 'boxplot':\n            return createImpositionBoxPlotDesc(label ? label : undefined);\n          case 'numbers':\n            return createImpositionsDesc(label ? label : undefined);\n          default:\n            return createImpositionDesc(label ? label : undefined);\n        }\n      },\n      columns: [numberColumn, colorColumn],\n    });\n    return this;\n  }\n\n  /**\n   * add a nested / group composite column\n   * @param {string | null} label optional label\n   * @param {string} column first element of the group enforcing not empty ones\n   * @param {string} columns additional columns\n   */\n  nested(label: string | null, column: string, ...columns: string[]) {\n    this.columns.push({\n      desc: createNestedDesc(label ? label : undefined),\n      columns: [column].concat(columns),\n    });\n    return this;\n  }\n\n  /**\n   * @param {IColumnDesc} desc the composite column description\n   * @param {string} columns additional columns to add as children\n   */\n  composite(desc: IColumnDesc, ...columns: string[]) {\n    this.columns.push({\n      desc,\n      columns,\n    });\n    return this;\n  }\n\n  /**\n   * add a weighted sum / stack column\n   * @param {string | null} label optional label\n   * @param {string} numberColumn1 the first numerical column\n   * @param {number} weight1 its weight (0..1)\n   * @param {string} numberColumn2 the second numerical column\n   * @param {number} weight2 its weight (0..1)\n   * @param {string | number} numberColumnAndWeights alternating column weight references\n   */\n  weightedSum(\n    label: string | null,\n    numberColumn1: string,\n    weight1: number,\n    numberColumn2: string,\n    weight2: number,\n    ...numberColumnAndWeights: (string | number)[]\n  ) {\n    const weights = [weight1, weight2].concat(numberColumnAndWeights.filter((_, i) => i % 2 === 1) as number[]);\n    this.columns.push({\n      desc: createStackDesc(label ? label : undefined),\n      columns: [numberColumn1, numberColumn2].concat(numberColumnAndWeights.filter((_, i) => i % 2 === 0) as string[]),\n      post: (col) => {\n        (col as StackColumn).setWeights(weights);\n      },\n    });\n    return this;\n  }\n\n  /**\n   * add reducing column (min, max, median, mean, ...)\n   * @param {string | null} label optional label\n   * @param {EAdvancedSortMethod} operation operation to apply (min, max, median, mean, ...)\n   * @param {string} numberColumn1 first numerical column\n   * @param {string} numberColumn2 second numerical column\n   * @param {string} numberColumns additional numerical columns\n   */\n  reduce(\n    label: string | null,\n    operation: EAdvancedSortMethod,\n    numberColumn1: string,\n    numberColumn2: string,\n    ...numberColumns: string[]\n  ) {\n    this.columns.push({\n      desc: createReduceDesc(label ? label : undefined),\n      columns: [numberColumn1, numberColumn2].concat(numberColumns),\n      post: (col) => {\n        (col as ReduceColumn).setReduce(operation);\n      },\n    });\n    return this;\n  }\n\n  /**\n   * add a scripted / formula column\n   * @param {string | null} label optional label\n   * @param {string} code the JS code see ScriptColumn for details\n   * @param {string} numberColumns additional script columns\n   */\n  scripted(label: string | null, code: string, ...numberColumns: string[]) {\n    this.columns.push({\n      desc: Object.assign(createScriptDesc(label ? label : undefined), { script: code }),\n      columns: numberColumns,\n    });\n    return this;\n  }\n\n  /**\n   * add a selection column for easier multi selections\n   */\n  selection() {\n    this.columns.push({\n      desc: createSelectionDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add a group column to show the current group name\n   */\n  group() {\n    this.columns.push({\n      desc: createGroupDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add an aggregate column to this ranking to collapse/expand groups\n   */\n  aggregate() {\n    this.columns.push({\n      desc: createAggregateDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add a ranking column\n   */\n  rank() {\n    this.columns.push({\n      desc: createRankDesc(),\n      columns: [],\n    });\n    return this;\n  }\n\n  /**\n   * add suporttypes (aggregate, rank, selection) to the ranking\n   */\n  supportTypes() {\n    return this.aggregate().rank().selection();\n  }\n\n  /**\n   * add all columns to this ranking\n   */\n  allColumns() {\n    this.columns.push(RankingBuilder.ALL_MAGIC_FLAG);\n    return this;\n  }\n\n  build(data: DataProvider): Ranking {\n    const r = data.pushRanking();\n    const cols = data.getColumns();\n\n    const findDesc = (c: string) => cols.find((d) => d.label === c || (d as any).column === c);\n\n    const addColumn = (c: string) => {\n      const desc = findDesc(c);\n      if (desc) {\n        return data.push(r, desc) != null;\n      }\n      console.warn('invalid column: ', c);\n      return false;\n    };\n\n    this.columns.forEach((c) => {\n      if (c === RankingBuilder.ALL_MAGIC_FLAG) {\n        cols.forEach((col) => data.push(r, col));\n        return;\n      }\n      if (typeof c === 'string') {\n        addColumn(c);\n        return;\n      }\n      const col = data.create(typeof c.desc === 'function' ? c.desc(data) : c.desc)!;\n      r.push(col);\n      c.columns.forEach((ci) => {\n        const d = findDesc(ci);\n        const child = d ? data.create(d) : null;\n        if (!child) {\n          console.warn('invalid column: ', ci);\n          return;\n        }\n        (col as CompositeColumn).push(child);\n      });\n      if (c.post) {\n        c.post(col);\n      }\n    });\n\n    const children = r.children;\n    {\n      const groups: Column[] = [];\n      this.groups.forEach((column) => {\n        const col = children.find((d) => d.desc.label === column || (d as any).desc.column === column);\n        if (col) {\n          groups.push(col);\n          return;\n        }\n        const desc = findDesc(column);\n        if (!desc) {\n          console.warn('invalid group criteria column: ', column);\n          return;\n        }\n        const col2 = data.push(r, desc);\n        if (col2) {\n          groups.push(col2);\n          return;\n        }\n        console.warn('invalid group criteria column: ', column);\n      });\n      if (groups.length > 0) {\n        r.setGroupCriteria(groups);\n      }\n    }\n    {\n      const sorts: ISortCriteria[] = [];\n      this.sort.forEach(({ column, asc }) => {\n        const col = children.find((d) => d.desc.label === column || (d as any).desc.column === column);\n        if (col) {\n          sorts.push({ col, asc });\n          return;\n        }\n        const desc = findDesc(column);\n        if (!desc) {\n          console.warn('invalid sort criteria column: ', column);\n          return;\n        }\n        const col2 = data.push(r, desc);\n        if (col2) {\n          sorts.push({ col: col2, asc });\n          return;\n        }\n        console.warn('invalid sort criteria column: ', column);\n      });\n      if (sorts.length > 0) {\n        r.setSortCriteria(sorts);\n      }\n    }\n    {\n      const sorts: ISortCriteria[] = [];\n      this.groupSort.forEach(({ column, asc }) => {\n        const col = children.find((d) => d.desc.label === column || (d as any).desc.column === column);\n        if (col) {\n          sorts.push({ col, asc });\n          return;\n        }\n        const desc = findDesc(column);\n        if (!desc) {\n          console.warn('invalid group sort criteria column: ', column);\n          return;\n        }\n        const col2 = data.push(r, desc);\n        if (col2) {\n          sorts.push({ col: col2, asc });\n          return;\n        }\n        console.warn('invalid group sort criteria column: ', column);\n      });\n      if (sorts.length > 0) {\n        r.setGroupSortCriteria(sorts);\n      }\n    }\n    return r;\n  }\n}\n\n/**\n * creates a new instance of a ranking builder\n * @returns {RankingBuilder}\n */\nexport function buildRanking() {\n  return new RankingBuilder();\n}\n","import type { ICategoricalColumnDesc, ICategory } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\nimport { cleanCategories } from '../../provider/utils';\nimport { resolveValue } from '../../internal';\n\nexport default class CategoricalColumnBuilder extends ColumnBuilder<ICategoricalColumnDesc> {\n  constructor(column: string) {\n    super('categorical', column);\n  }\n\n  /**\n   * converts this type to an ordinal column type, such that categories are mapped to numbers\n   */\n  asOrdinal() {\n    this.desc.type = 'ordinal';\n    return this;\n  }\n\n  /**\n   * specify the categories of this categorical column\n   * @param {(string | Partial<ICategory>)[]} categories\n   */\n  categories(categories: (string | Partial<ICategory>)[]) {\n    this.desc.categories = categories;\n    return this;\n  }\n\n  /**\n   * converts this type to a set column, i.e. multiple unique category in a value\n   * @param {string} separator optional separator separating a string value\n   */\n  asSet(separator?: string) {\n    if (separator) {\n      (this.desc as any).separator = separator;\n    }\n    this.desc.type = 'set';\n    return this;\n  }\n\n  private derive(data: any[]) {\n    // derive categories\n    const categories = new Set<string>();\n    const isSet = this.desc.type === 'set';\n    const separator = (this.desc as any).separator || ';';\n    const val = (vi: any) => {\n      if (typeof vi === 'string' && vi !== '') {\n        return vi;\n      }\n      if (vi != null && typeof vi.value === 'string' && vi.value !== '') {\n        return vi.value;\n      }\n      return null;\n    };\n    const col = (this.desc as any).column;\n    data.forEach((d) => {\n      const v = resolveValue(d, col);\n      if (Array.isArray(v)) {\n        v.forEach((vi) => categories.add(val(vi)));\n      } else if (v != null && v !== '') {\n        const vs: string[] = isSet ? [v.toString()] : v.toString().split(separator);\n        vs.forEach((vi) => categories.add(val(vi)));\n      }\n    });\n    this.categories(cleanCategories(categories));\n  }\n\n  build(data: any[]): ICategoricalColumnDesc {\n    if (!this.desc.categories) {\n      this.derive(data);\n    }\n    return super.build(data);\n  }\n}\n\n/**\n * build a categorical column type\n * @param {string} column column which contains the associated data\n * @param {(string | Partial<ICategory>)[]} categories optional category definition\n * @returns {CategoricalColumnBuilder}\n */\nexport function buildCategoricalColumn(column: string, categories?: (string | Partial<ICategory>)[]) {\n  const r = new CategoricalColumnBuilder(column);\n  if (categories) {\n    r.categories(categories);\n  }\n  return r;\n}\n","import { min, max, resolveValue } from '../../internal';\nimport type { EAdvancedSortMethod, ESortMethod, INumberColumnDesc, ITypedDump } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\nimport type { IScriptMappingFunctionType } from '../../model/MappingFunction';\n\nexport default class NumberColumnBuilder extends ColumnBuilder<INumberColumnDesc> {\n  constructor(column: string) {\n    super('number', column);\n  }\n\n  /**\n   * defines the mapping for this number column to normalize the data\n   * @param {\"linear\" | \"sqrt\" | \"pow1.1\" | \"pow2\" | \"pow3\"} type mapping type\n   * @param {[number , number]} domain input data domain [min, max]\n   * @param {[number , number]} range optional output domain [0, 1]\n   */\n  mapping(type: 'linear' | 'sqrt' | 'pow1.1' | 'pow2' | 'pow3', domain: [number, number], range?: [number, number]) {\n    if (type === 'linear') {\n      this.desc.domain = domain;\n      if (range) {\n        this.desc.range = range;\n      }\n      return this;\n    }\n    this.desc.map = {\n      type,\n      domain,\n      range: range ?? [0, 1],\n    };\n    return this;\n  }\n\n  /**\n   * sets the column color in case of numerical columns\n   * @deprecated use colorMapping instead\n   */\n  color(color: string) {\n    return this.colorMapping(color);\n  }\n\n  colorMapping(type: string | ((v: number) => string) | ITypedDump) {\n    this.desc.colorMapping = type;\n    return this;\n  }\n\n  /**\n   * d3-format to use for formatting\n   * @param format d3-format\n   */\n  numberFormat(format: string) {\n    this.desc.numberFormat = format;\n    return this;\n  }\n\n  /**\n   * defines a script to normalize the data, see ScriptedMappingFunction for details\n   * @param {string} code the code to execute\n   * @param {[number , number]} domain the input data domain [min, max]\n   */\n  scripted(code: string | IScriptMappingFunctionType, domain: [number, number]) {\n    this.desc.map = { domain, code, type: 'script' };\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\n   */\n  asArray(labels?: string[] | number, sort?: EAdvancedSortMethod) {\n    if (sort) {\n      (this.desc as any).sort = sort;\n    }\n    return super.asArray(labels);\n  }\n\n  /**\n   * @inheritDoc\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\n   */\n  asMap(sort?: EAdvancedSortMethod) {\n    if (sort) {\n      (this.desc as any).sort = sort;\n    }\n    return super.asMap();\n  }\n\n  /**\n   * converts type to a boxplot column type\n   * @param {ESortMethod} sort sorting criteria when sorting by this column\n   */\n  asBoxPlot(sort?: ESortMethod) {\n    if (sort) {\n      (this.desc as any).sort = sort;\n    }\n    this.desc.type = 'boxplot';\n    return this;\n  }\n\n  private derive(data: any[]): [number, number] {\n    const col = (this.desc as any).column;\n\n    const asArray = (v: any, extra: string) => {\n      const vs: number[] = [];\n      (Array.isArray(v) ? v : [v]).forEach((vi) => {\n        if (typeof vi === 'number' && !Number.isNaN(vi)) {\n          vs.push(vi);\n        }\n        if (vi != null && typeof vi.value === 'number' && !Number.isNaN(vi.value)) {\n          vs.push(vi.value);\n        }\n        if (vi != null && typeof vi[extra] === 'number' && !Number.isNaN(vi[extra])) {\n          vs.push(vi[extra]);\n        }\n      });\n      return vs;\n    };\n\n    const minValue = min(data, (d) => {\n      const v = resolveValue(d, col);\n      const vs: number[] = asArray(v, 'min');\n      return vs.length === 0 ? Number.POSITIVE_INFINITY : min(vs);\n    });\n    const maxValue = max(data, (d) => {\n      const v = resolveValue(d, col);\n      const vs: number[] = asArray(v, 'max');\n      return vs.length === 0 ? Number.NEGATIVE_INFINITY : max(vs);\n    });\n    return [minValue, maxValue];\n  }\n\n  build(data: any[]): INumberColumnDesc {\n    if (!this.desc.map && !this.desc.domain) {\n      // derive domain\n      this.mapping('linear', this.derive(data));\n    } else {\n      const d = this.desc.domain || this.desc.map!.domain;\n      if (Number.isNaN(d[0]) || Number.isNaN(d[1])) {\n        const ext = this.derive(data);\n        if (Number.isNaN(d[0])) {\n          d[0] = ext[0];\n        }\n        if (Number.isNaN(d[1])) {\n          d[1] = ext[1];\n        }\n      }\n    }\n    return super.build(data);\n  }\n}\n\n/**\n * builds numerical column builder\n * @param {string} column column which contains the associated data\n * @param {[number , number]} domain domain (min, max) of this column\n * @returns {NumberColumnBuilder}\n */\nexport function buildNumberColumn(column: string, domain?: [number, number]) {\n  const r = new NumberColumnBuilder(column);\n  if (domain) {\n    r.mapping('linear', domain);\n  }\n  return r;\n}\n","import type { EAlignment, ILinkColumnDesc } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class StringColumnBuilder extends ColumnBuilder<ILinkColumnDesc> {\n  constructor(column: string) {\n    super('string', column);\n  }\n\n  /**\n   * makes the text editable within a cell and switches to the annotate type\n   */\n  editable() {\n    this.desc.type = 'annotate';\n    return this;\n  }\n\n  /**\n   * changes the alignment of the column\n   */\n  alignment(align: EAlignment) {\n    this.desc.alignment = align;\n    return this;\n  }\n\n  /**\n   * allow html text as values\n   */\n  html() {\n    this.desc.escape = false;\n    return this;\n  }\n\n  /**\n   * provide a pattern with which the value will be wrapped, use <code>${value}</code> for the current and and <code>${item}</code> for the whole item\n   * @param {string} pattern pattern to apply\n   * @param {string[]} templates optional templates for patterns to provide in the edit pattern dialog\n   */\n  pattern(pattern: string, templates?: string[]) {\n    this.desc.type = 'link';\n    this.desc.pattern = pattern;\n    if (templates) {\n      this.desc.patternTemplates = templates;\n    }\n    return this;\n  }\n}\n\n/**\n * builds a string column builder\n * @param {string} column column which contains the associated data\n * @returns {StringColumnBuilder}\n */\nexport function buildStringColumn(column: string) {\n  return new StringColumnBuilder(column);\n}\n","import type { IDateColumnDesc } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class DateColumnBuilder extends ColumnBuilder<IDateColumnDesc> {\n  constructor(column: string) {\n    super('date', column);\n  }\n\n  /**\n   * specify the format and parsing d3-time pattern to convert Date to strings and vise versa\n   * @param {string} format d3-time-format pattern\n   * @param {string} parse optional different parsing pattern\n   */\n  format(format: string, parse?: string) {\n    this.desc.dateFormat = format;\n    if (parse) {\n      this.desc.dateParse = parse;\n    }\n    return this;\n  }\n}\n\n/**\n * builds a date column builder\n * @param {string} column column which contains the associated data\n * @returns {DateColumnBuilder}\n */\nexport function buildDateColumn(column: string) {\n  return new DateColumnBuilder(column);\n}\n","import type { IHierarchyColumnDesc, IPartialCategoryNode } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class HierarchyColumnBuilder extends ColumnBuilder<IHierarchyColumnDesc> {\n  constructor(column: string) {\n    super('hierarchy', column);\n  }\n\n  /**\n   * specify the underlying hierarchy of this column\n   * @param {IPartialCategoryNode} hierarchy\n   * @param {string} hierarchySeparator specify the character to separate levels (default dot)\n   */\n  hierarchy(hierarchy: IPartialCategoryNode, hierarchySeparator?: string) {\n    this.desc.hierarchy = hierarchy;\n    if (hierarchySeparator) {\n      this.desc.hierarchySeparator = hierarchySeparator;\n    }\n    return this;\n  }\n\n  build(data: any[]): IHierarchyColumnDesc {\n    console.assert(Boolean(this.desc.hierarchy));\n    return super.build(data);\n  }\n}\n\n/**\n * build a hierarchical column builder\n * @param {string} column column which contains the associated data\n * @param {IPartialCategoryNode} hierarchy\n * @returns {HierarchyColumnBuilder}\n */\nexport function buildHierarchicalColumn(column: string, hierarchy?: IPartialCategoryNode) {\n  const r = new HierarchyColumnBuilder(column);\n  if (hierarchy) {\n    r.hierarchy(hierarchy);\n  }\n  return r;\n}\n","import type { IActionColumnDesc, IAction, IGroupAction } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class ActionsColumnBuilder extends ColumnBuilder<IActionColumnDesc> {\n  constructor() {\n    super('actions', '');\n  }\n\n  /**\n   * adds another action\n   * @param action the action\n   */\n  action(action: IAction) {\n    return this.actions([action]);\n  }\n\n  /**\n   * adds multiple actions\n   * @param actions list of actions\n   */\n  actions(actions: IAction[]) {\n    if (!this.desc.actions) {\n      this.desc.actions = [];\n    }\n    this.desc.actions!.push(...actions);\n    return this;\n  }\n\n  /**\n   * adds another action that is shown in group rows\n   * @param action the action\n   */\n  groupAction(action: IGroupAction) {\n    return this.groupActions([action]);\n  }\n\n  /**\n   * add multiple group actions that are shown in group rows\n   * @param actions list of actions\n   */\n  groupActions(actions: IGroupAction[]) {\n    if (!this.desc.groupActions) {\n      this.desc.groupActions = [];\n    }\n    this.desc.groupActions!.push(...actions);\n    return this;\n  }\n}\n\n/**\n * builds a actions column builder\n * @returns {ActionsColumnBuilder}\n */\nexport function buildActionsColumn() {\n  return new ActionsColumnBuilder();\n}\n","import type { IBooleanColumnDesc } from '../../model';\nimport ColumnBuilder from './ColumnBuilder';\n\nexport default class BooleanColumnBuilder extends ColumnBuilder<IBooleanColumnDesc> {\n  constructor(column: string) {\n    super('boolean', column);\n  }\n\n  trueMarker(marker: string) {\n    this.desc.trueMarker = marker;\n    return this;\n  }\n\n  falseMarker(marker: string) {\n    this.desc.falseMarker = marker;\n    return this;\n  }\n}\n\n/**\n * builds a boolean column builder\n * @param {string} column column which contains the associated data\n * @returns {BooleanColumnBuilder}\n */\nexport function buildBooleanColumn(column: string) {\n  return new BooleanColumnBuilder(column);\n}\n","import type { IColumnDesc, IColumnConstructor } from '../model';\nimport {\n  DataProvider,\n  LocalDataProvider,\n  deriveColors,\n  deriveColumnDescriptions,\n  IDataProviderOptions,\n  ILocalDataProviderOptions,\n  IAggregationStrategy,\n} from '../provider';\nimport { LineUp, Taggle } from '../ui';\nimport ColumnBuilder from './column/ColumnBuilder';\nimport LineUpBuilder from './LineUpBuilder';\nimport { RankingBuilder } from './RankingBuilder';\n\nexport * from './column';\nexport * from './RankingBuilder';\n\n/**\n * builder for a LocalDataProvider along with LineUp configuration options\n */\nexport class DataBuilder extends LineUpBuilder {\n  private readonly columns: (IColumnDesc | ((data: any[]) => IColumnDesc))[] = [];\n  private readonly providerOptions: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {\n    columnTypes: {},\n  };\n\n  private readonly rankBuilders: ((data: DataProvider) => void)[] = [];\n  private _deriveColors = false;\n\n  constructor(private readonly data: Record<string, unknown>[]) {\n    super();\n  }\n\n  /**\n   * use the schedulded task executor to asynchronously compute aggregations\n   */\n  scheduledTaskExecutor() {\n    this.providerOptions.taskExecutor = 'scheduled';\n    return this;\n  }\n\n  /**\n   * when using a top-n strategy how many items should be shown\n   */\n  showTopN(n: number) {\n    this.providerOptions.showTopN = n;\n    return this;\n  }\n\n  /**\n   * change the aggregation strategy that should be used when grouping by a column\n   */\n  aggregationStrategy(strategy: IAggregationStrategy) {\n    this.providerOptions.aggregationStrategy = strategy;\n    return this;\n  }\n\n  /**\n   * whether to propagate a collapse operation to its children\n   * @default true\n   */\n  propagateAggregationState(value: boolean) {\n    this.providerOptions.propagateAggregationState = value;\n    return this;\n  }\n\n  /**\n   * allow just a single selection\n   */\n  singleSelection() {\n    this.providerOptions.singleSelection = true;\n    return this;\n  }\n\n  /**\n   * allow multiple selections\n   */\n  multiSelection() {\n    this.providerOptions.singleSelection = false;\n    return this;\n  }\n\n  /**\n   * filter all rankings by all filters in LineUp\n   */\n  filterGlobally() {\n    this.providerOptions.filterGlobally = true;\n    return this;\n  }\n\n  /**\n   * triggers to derive the column descriptions for the given data\n   * @param {string} columns optional enforced order of columns\n   */\n  deriveColumns(...columns: (string | string[])[]) {\n    const cols = [].concat(...columns);\n    for (const c of deriveColumnDescriptions(this.data, { columns: cols })) {\n      this.columns.push(c);\n    }\n    return this;\n  }\n\n  /**\n   * tirggers to assign colors for the given descriptions\n   */\n  deriveColors() {\n    this._deriveColors = true;\n    return this;\n  }\n\n  /**\n   * register another column type to this data provider\n   * @param {string} type unique type id\n   * @param {IColumnConstructor} clazz column class\n   */\n  registerColumnType(type: string, clazz: IColumnConstructor) {\n    this.providerOptions.columnTypes![type] = clazz;\n    return this;\n  }\n\n  /**\n   * push another column description to this data provider\n   * @param {IColumnDesc | ColumnBuilder} column column description or builder instance\n   */\n  column(column: IColumnDesc | ColumnBuilder | ((data: any[]) => IColumnDesc)) {\n    this.columns.push(column instanceof ColumnBuilder ? column.build.bind(column) : column);\n    return this;\n  }\n\n  /**\n   * restores a given ranking dump\n   * @param dump dump as created using '.dump()'\n   */\n  restore(dump: any) {\n    this.rankBuilders.push((data) => data.restore(dump));\n    return this;\n  }\n\n  /**\n   * add the default ranking (all columns) to this data provider\n   * @param {boolean} addSupportTypes add support types, too, default: true\n   */\n  defaultRanking(addSupportTypes = true) {\n    this.rankBuilders.push((data) => data.deriveDefault(addSupportTypes));\n    return this;\n  }\n\n  /**\n   * add another ranking to this data provider\n   * @param {((data: DataProvider) => void) | RankingBuilder} builder ranking builder\n   */\n  ranking(builder: ((data: DataProvider) => void) | RankingBuilder) {\n    this.rankBuilders.push(builder instanceof RankingBuilder ? builder.build.bind(builder) : builder);\n    return this;\n  }\n\n  /**\n   * builds the data provider itself\n   * @returns {LocalDataProvider}\n   */\n  buildData() {\n    // last come survived separated by label to be able to override columns\n    const columns: IColumnDesc[] = [];\n    const contained = new Set<string>();\n    for (const col of this.columns) {\n      const c = typeof col === 'function' ? col(this.data) : col;\n      const key = `${c.type}@${c.label}`;\n      if (!contained.has(key)) {\n        columns.push(c);\n        contained.add(key);\n        continue;\n      }\n      const oldPos = columns.findIndex((d) => key === `${d.type}@${d.label}`);\n      columns.splice(oldPos, 1, c); // replace with new one\n    }\n    if (this._deriveColors) {\n      deriveColors(columns);\n    }\n    const r = new LocalDataProvider(this.data, columns, this.providerOptions);\n    if (this.rankBuilders.length === 0) {\n      this.defaultRanking();\n    }\n    this.rankBuilders.forEach((builder) => builder(r));\n    return r;\n  }\n\n  /**\n   * builds LineUp at the given parent DOM node\n   * @param {HTMLElement} node parent DOM node to attach\n   * @returns {LineUp}\n   */\n  build(node: HTMLElement) {\n    return new LineUp(node, this.buildData(), this.options);\n  }\n\n  /**\n   * builds Taggle at the given parent DOM node\n   * @param {HTMLElement} node parent DOM node to attach\n   * @returns {Taggle}\n   */\n  buildTaggle(node: HTMLElement) {\n    return new Taggle(node, this.buildData(), this.options);\n  }\n}\n\n/**\n * creates a new builder instance for the given data\n * @param {Record<string, unknown>[]} arr data to visualize\n * @returns {DataBuilder}\n */\nexport function builder(arr: Record<string, unknown>[]) {\n  return new DataBuilder(arr);\n}\n\n/**\n * build a new Taggle instance in the given node for the given data\n * @param {HTMLElement} node DOM node to attach to\n * @param {any[]} data data to visualize\n * @param {string[]} columns optional enforced column order\n * @returns {Taggle}\n */\nexport function asTaggle(node: HTMLElement, data: any[], ...columns: string[]): Taggle {\n  return builder(data).deriveColumns(columns).deriveColors().defaultRanking().buildTaggle(node);\n}\n\n/**\n * build a new LineUp instance in the given node for the given data\n * @param {HTMLElement} node DOM node to attach to\n * @param {any[]} data data to visualize\n * @param {string[]} columns optional enforced column order\n * @returns {LineUp}\n */\nexport function asLineUp(node: HTMLElement, data: any[], ...columns: string[]): LineUp {\n  return builder(data).deriveColumns(columns).deriveColors().defaultRanking().build(node);\n}\n","import { extent, resolveValue } from '../../internal';\nimport type {\n  IActionColumnDesc,\n  IArrayDesc,\n  IBooleanColumnDesc,\n  ICategoricalColumnDesc,\n  IColumnDesc,\n  IDateColumnDesc,\n  IHierarchyColumnDesc,\n  ILinkColumnDesc,\n  INumberColumnDesc,\n} from '../../model';\nimport type {\n  IBuilderAdapterActionsColumnDescProps,\n  IBuilderAdapterBooleanColumnDescProps,\n  IBuilderAdapterCategoricalColumnDescProps,\n  IBuilderAdapterColumnDescProps,\n  IBuilderAdapterDateColumnDescProps,\n  IBuilderAdapterHierarchyColumnDescProps,\n  IBuilderAdapterNumberColumnDescProps,\n  IBuilderAdapterStringColumnDescProps,\n} from './interfaces';\n\nexport function build<T extends IBuilderAdapterColumnDescProps>(props: T, _data?: any[]): IColumnDesc {\n  const { column } = props;\n  const desc = {\n    column,\n    type: props.type,\n    label: column ? column[0].toUpperCase() + column.slice(1) : props.type,\n  } as any;\n\n  (\n    [\n      'label',\n      'description',\n      'frozen',\n      'width',\n      'renderer',\n      'groupRenderer',\n      'summaryRenderer',\n      'visible',\n      'fixed',\n    ] as (keyof IBuilderAdapterColumnDescProps)[]\n  ).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n\n  if (props.custom) {\n    // merge custom attributes\n    Object.assign(desc, props.custom);\n  }\n\n  if (props.asMap) {\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\n    desc.type += 'Map';\n  }\n\n  if (props.asArray != null) {\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\n    desc.type += 's';\n    const a = desc as IArrayDesc;\n    const labels = props.asArray;\n    if (Array.isArray(labels)) {\n      a.labels = labels;\n      a.dataLength = labels.length;\n    } else if (typeof labels === 'number') {\n      a.dataLength = labels;\n    }\n  }\n\n  return desc as any;\n}\n\nexport function buildCategorical(\n  props: IBuilderAdapterCategoricalColumnDescProps,\n  data: any[]\n): ICategoricalColumnDesc {\n  const desc: any = build({ ...props, type: 'categorical' });\n\n  if (props.asOrdinal) {\n    desc.type = 'ordinal';\n  }\n  if (props.missingCategory) {\n    desc.missingCategory = props.missingCategory;\n  }\n  if (props.asSet) {\n    if (typeof props.asSet === 'string') {\n      (desc as any).separator = props.asSet;\n    }\n    desc.type = 'set';\n  }\n\n  if (!props.categories) {\n    // derive categories\n    const categories = new Set(data.map((d) => resolveValue(d, (desc as any).column) as string));\n    desc.categories = Array.from(categories).sort();\n  } else {\n    desc.categories = props.categories;\n  }\n  return desc;\n}\n\nexport function buildDate(props: IBuilderAdapterDateColumnDescProps): IDateColumnDesc {\n  const desc: any = build({ ...props, type: 'date' });\n\n  (['dateFormat', 'dateParse'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n\nexport function buildHierarchy(props: Partial<IBuilderAdapterHierarchyColumnDescProps>): IHierarchyColumnDesc {\n  const desc: any = build({ ...(props as any), type: 'hierarchy' });\n\n  (['hierarchy', 'hierarchySeparator'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n\nexport function buildNumber(props: IBuilderAdapterNumberColumnDescProps, data: any[]): INumberColumnDesc {\n  const desc: any = build({ ...props, type: 'number' });\n\n  const domain = props.domain ? props.domain : extent(data, (d) => resolveValue(d, (desc as any).column) as number);\n\n  if (props.hasOwnProperty('color')) {\n    desc.colorMapping = props.color;\n  }\n  (['sort', 'colorMapping'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  if (props.scripted) {\n    desc.map = { domain, code: props.scripted, type: 'script' };\n  } else if (!props.mapping || props.mapping === 'linear') {\n    desc.domain = domain;\n    if (props.range) {\n      desc.range = props.range;\n    }\n  } else {\n    desc.map = {\n      type: props.mapping,\n      domain,\n      range: props.range || [0, 1],\n    };\n  }\n  return desc;\n}\n\nexport function buildString(props: IBuilderAdapterStringColumnDescProps): ILinkColumnDesc {\n  const desc: any = build({ ...props, type: 'string' });\n\n  (['pattern', 'patternTemplate', 'alignment'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  if (props.editable) {\n    desc.type = 'annotate';\n  }\n  if (props.pattern) {\n    desc.type = 'link';\n  }\n  if (props.html) {\n    desc.escape = false;\n  }\n  return desc;\n}\n\nexport function buildBoolean(props: IBuilderAdapterBooleanColumnDescProps): IBooleanColumnDesc {\n  const desc: any = build({ ...props, type: 'boolean' });\n\n  (['trueMarker', 'falseMarker'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n\nexport function buildActions(props: IBuilderAdapterActionsColumnDescProps): IActionColumnDesc {\n  const desc: any = build({ ...props, type: 'actions' });\n\n  (['actions', 'groupActions'] as const).forEach((key) => {\n    if (props.hasOwnProperty(key)) {\n      desc[key] = props[key];\n    }\n  });\n  return desc;\n}\n","import type { Ranking } from '../../model';\nimport type { LocalDataProvider } from '../../provider';\nimport {\n  INestedBuilder,\n  IReduceBuilder,\n  IScriptedBuilder,\n  IWeightedSumBuilder,\n  buildRanking as buildRankingImpl,\n} from '../RankingBuilder';\nimport type {\n  IBuilderAdapterImposeColumnProps,\n  IBuilderAdapterNestedColumnProps,\n  IBuilderAdapterRankingProps,\n  IBuilderAdapterReduceColumnProps,\n  IBuilderAdapterScriptColumnProps,\n  IBuilderAdapterSupportColumnProps,\n  IBuilderAdapterWeightedSumColumnProps,\n} from './interfaces';\n\n/*\n * build the column description\n */\nexport function buildRanking(props: IBuilderAdapterRankingProps, data: LocalDataProvider): Ranking {\n  const r = buildRankingImpl();\n\n  if (props.sortBy) {\n    const s = Array.isArray(props.sortBy) ? props.sortBy : [props.sortBy];\n    s.forEach((si) => {\n      if (typeof si === 'string') {\n        r.sortBy(si);\n      } else {\n        r.sortBy(si.column, si.asc);\n      }\n    });\n  }\n  if (props.groupBy) {\n    const s = Array.isArray(props.groupBy) ? props.groupBy : [props.groupBy];\n    r.groupBy(...s);\n  }\n  if (props.columns) {\n    props.columns.forEach((c) => r.column(c));\n  }\n  return r.build(data);\n}\n\nexport function buildGeneric(props: { column: '*' | string }) {\n  return props.column;\n}\n\nexport function buildImposeRanking(props: IBuilderAdapterImposeColumnProps) {\n  return Object.assign(\n    {\n      type: 'impose',\n    },\n    props\n  );\n}\n\nexport function buildNestedRanking(props: IBuilderAdapterNestedColumnProps, children: string[]) {\n  const r: INestedBuilder = {\n    type: 'nested',\n    columns: children,\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildWeightedSumRanking(\n  props: IBuilderAdapterWeightedSumColumnProps,\n  children: { column: string; weight: number }[]\n) {\n  const r: IWeightedSumBuilder = {\n    type: 'weightedSum',\n    columns: children.map((d) => d.column),\n    weights: children.map((d) => d.weight),\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildReduceRanking(props: IBuilderAdapterReduceColumnProps, children: string[]) {\n  const r: IReduceBuilder = {\n    type: props.type,\n    columns: children,\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildScriptRanking(props: IBuilderAdapterScriptColumnProps, children: string[]) {\n  const r: IScriptedBuilder = {\n    type: 'script',\n    code: props.code,\n    columns: children,\n  };\n  if (props.label) {\n    r.label = props.label;\n  }\n  return r;\n}\n\nexport function buildSupportRanking(props: IBuilderAdapterSupportColumnProps) {\n  return `_${props.type}`;\n}\n\nexport function buildAllColumnsRanking() {\n  return '*';\n}\n","export { equal } from '../../internal';\n\nexport function isTypeInstance(clazz: any, superClass: any) {\n  let c = clazz;\n  while (c && c !== superClass) {\n    c = c.__proto__;\n  }\n  return c === superClass;\n}\n\nexport function pick<T extends Record<string, unknown>>(obj: T, keys: (keyof T)[]): Pick<T, keyof T> {\n  const r: Pick<T, keyof T> = {} as any;\n  keys.forEach((k) => {\n    if (obj.hasOwnProperty(k)) {\n      r[k] = obj[k];\n    }\n  });\n  return r;\n}\n\nexport function isSame<T extends Record<string, unknown>>(\n  current: T,\n  changed: (prop: keyof T) => boolean,\n  props: (keyof T)[]\n) {\n  if (props.every((p) => !changed(p))) {\n    return null;\n  }\n  return pick(current, props);\n}\n","import type { IBuilderAdapter, IBuilderAdapterProps, IBuilderAdapterRankingProps, IChangeDetecter } from './interfaces';\nimport type { IColumnDesc } from '../../model';\nimport {\n  deriveColors,\n  deriveColumnDescriptions,\n  IDataProviderOptions,\n  ILocalDataProviderOptions,\n  LocalDataProvider,\n} from '../../provider';\nimport { LineUp, Taggle } from '../../ui';\nimport { buildRanking } from './ranking';\nimport { equal, isSame, pick } from './utils';\n\nconst providerOptions: (keyof IDataProviderOptions | keyof ILocalDataProviderOptions)[] = [\n  'singleSelection',\n  'filterGlobally',\n  'columnTypes',\n  'taskExecutor',\n  'jumpToSearchResult',\n];\nconst lineupOptions: (keyof IBuilderAdapterProps)[] = [\n  'animated',\n  'sidePanel',\n  'sidePanelCollapsed',\n  'hierarchyIndicator',\n  'defaultSlopeGraphMode',\n  'summaryHeader',\n  'expandLineOnHover',\n  'overviewMode',\n  'renderers',\n  'canRender',\n  'toolbarActions',\n  'toolbarDialogAddons',\n  'rowHeight',\n  'rowPadding',\n  'groupHeight',\n  'groupPadding',\n  'dynamicHeight',\n  'labelRotation',\n  'ignoreUnsupportedBrowser',\n  'livePreviews',\n];\n\ninterface IRankingContext {\n  builders: IBuilderAdapterRankingProps[];\n  restore: any;\n  derive: boolean;\n  supportTypes: boolean;\n}\n\ninterface IColumnContext {\n  columns: IColumnDesc[];\n  deriveColumns: boolean;\n  deriveColumnNames: string[];\n  deriveColors: boolean;\n}\n\nexport class Adapter {\n  private data: LocalDataProvider | null = null;\n  private instance: LineUp | Taggle | null = null;\n\n  private prevRankings: IRankingContext | null = null;\n  private prevColumns: IColumnContext | null = null;\n  private prevHighlight: number | null = null;\n\n  private readonly onSelectionChanged = (indices: number[]) => {\n    if (this.props.onSelectionChanged && !equal(this.props.selection, indices)) {\n      this.props.onSelectionChanged(indices);\n    }\n  };\n\n  private readonly onHighlightChanged = (highlight: number) => {\n    const prev = this.prevHighlight != null ? this.prevHighlight : -1;\n    if (prev === highlight) {\n      return;\n    }\n    this.prevHighlight = highlight;\n    if (this.props.onHighlightChanged) {\n      this.props.onHighlightChanged(highlight);\n    }\n  };\n\n  constructor(private readonly adapter: IBuilderAdapter) {}\n\n  private get props() {\n    return this.adapter.props();\n  }\n\n  componentDidMount() {\n    this.data = this.buildProvider();\n    this.instance = this.adapter.createInstance(this.data, pick(this.props, lineupOptions));\n    this.instance.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\n  }\n\n  private resolveColumnDescs(data: any[]): IColumnContext {\n    const columns = this.adapter.columnDescs(data);\n    const deriveColumns = columns.length === 0 || Boolean(this.props.deriveColumns);\n    const deriveColumnNames = Array.isArray(this.props.deriveColumns) ? this.props.deriveColumns : [];\n    const deriveColors = Boolean(this.props.deriveColors);\n    return {\n      columns,\n      deriveColors,\n      deriveColumns,\n      deriveColumnNames,\n    };\n  }\n\n  private resolveRankings(): IRankingContext {\n    const builders = this.adapter.rankingBuilders();\n\n    return {\n      builders,\n      restore: this.props.restore,\n      derive: (builders.length === 0 && !this.props.restore) || Boolean(this.props.defaultRanking),\n      supportTypes: this.props.defaultRanking !== 'noSupportTypes',\n    };\n  }\n\n  private buildColumns(data: any[], ctx: IColumnContext) {\n    this.prevColumns = ctx;\n    const columns = ctx.columns.map((d) => Object.assign({}, d)); // work on copy\n    if (ctx.deriveColumns) {\n      const labels = new Set(columns.map((d) => `${d.type}@${d.label}`));\n      const derived = deriveColumnDescriptions(data, { columns: ctx.deriveColumnNames });\n      for (const derive of derived) {\n        if (labels.has(`${derive.type}@${derive.label}`)) {\n          // skip same name\n          continue;\n        }\n        columns.push(derive);\n      }\n    }\n    if (ctx.deriveColors) {\n      deriveColors(columns);\n    }\n    return columns;\n  }\n\n  private buildRankings(data: LocalDataProvider, rankings: IRankingContext) {\n    data.clearRankings();\n    this.prevRankings = rankings;\n    if (rankings.derive) {\n      data.deriveDefault(rankings.supportTypes);\n    }\n    if (rankings.restore) {\n      data.restore(rankings.restore);\n    }\n    rankings.builders.forEach((b) => buildRanking(b, data!));\n  }\n\n  private buildProvider() {\n    const columns = this.buildColumns(this.props.data, this.resolveColumnDescs(this.props.data));\n    const data = new LocalDataProvider(this.props.data, columns, pick(this.props, providerOptions));\n\n    this.buildRankings(data, this.resolveRankings());\n\n    data.setSelection(this.props.selection || []);\n    data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\n\n    return data;\n  }\n\n  private updateLineUp(changeDetector: IChangeDetecter, providerChanged: boolean) {\n    // check lineup instance properties\n    const changedLineUpOptions = isSame(this.props, changeDetector, lineupOptions);\n    if (!changedLineUpOptions) {\n      if (providerChanged) {\n        this.instance!.setDataProvider(this.data!);\n      }\n\n      if (providerChanged || (this.props.highlight != null && this.prevHighlight !== this.props.highlight)) {\n        this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, null);\n        this.instance!.setHighlight(this.prevHighlight);\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\n        return true;\n      }\n      return false;\n    }\n    // recreate lineup\n    if (this.instance) {\n      this.instance.destroy();\n    }\n    this.instance = this.adapter.createInstance(this.data!, changedLineUpOptions);\n\n    this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\n    this.instance!.setHighlight(this.prevHighlight);\n    this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\n    return true;\n  }\n\n  private updateProvider(changeDetector: IChangeDetecter) {\n    const changedProviderOptions = isSame(this.props, changeDetector, providerOptions);\n    if (changedProviderOptions || !this.data || changeDetector('data')) {\n      // big change start from scratch\n      this.data = this.buildProvider();\n      return true;\n    }\n\n    const rankings = this.resolveRankings();\n    const columns = this.resolveColumnDescs(this.props.data);\n    const columnsChanged = !equal(this.prevColumns, columns);\n    if (columnsChanged) {\n      const descs = this.buildColumns(this.props.data, columns);\n      this.data.clearColumns();\n      descs.forEach((d) => this.data!.pushDesc(d));\n    }\n\n    if (columnsChanged || !equal(rankings, this.prevRankings)) {\n      this.buildRankings(this.data, rankings);\n    }\n\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, null);\n    this.data.setSelection(this.props.selection || []);\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\n    return false;\n  }\n\n  componentDidUpdate(changeDetector: IChangeDetecter) {\n    const providerChanged = this.updateProvider(changeDetector);\n    this.updateLineUp(changeDetector, providerChanged);\n    // this.instance!.update();\n  }\n\n  componentWillUnmount() {\n    if (this.instance) {\n      this.instance.destroy();\n      this.instance = null;\n    }\n    this.data = null;\n  }\n}\n","import type Column from './Column';\nimport ValueColumn from './ValueColumn';\nimport type { IValueColumnDesc } from './interfaces';\n\nexport * from './annotations';\nexport { isMissingValue, isUnknown, FIRST_IS_NAN, FIRST_IS_MISSING, missingGroup } from './missing';\nexport * from './interfaces';\nexport * from './ICategoricalColumn';\nexport * from './INumberColumn';\nexport * from './IDateColumn';\nexport * from './IArrayColumn';\n\nexport { toCategories } from './internalCategorical';\n\nexport { ScaleMappingFunction, ScriptMappingFunction, mappingFunctions } from './MappingFunction';\nexport { DEFAULT_CATEGORICAL_COLOR_FUNCTION, ReplacementColorMappingFunction } from './CategoricalColorMappingFunction';\nexport {\n  CustomColorMappingFunction,\n  DEFAULT_COLOR_FUNCTION,\n  SequentialColorFunction,\n  DivergentColorFunction,\n  UnknownColorFunction,\n  QuantizedColorFunction,\n  SolidColorFunction,\n} from './ColorMappingFunction';\n\nexport { default as ActionColumn } from './ActionColumn';\nexport * from './ActionColumn';\nexport { default as AggregateGroupColumn } from './AggregateGroupColumn';\nexport * from './AggregateGroupColumn';\nexport { default as AnnotateColumn } from './AnnotateColumn';\nexport * from './AnnotateColumn';\nexport { default as ArrayColumn } from './ArrayColumn';\nexport * from './ArrayColumn';\nexport { default as BooleanColumn } from './BooleanColumn';\nexport * from './BooleanColumn';\nexport { default as BooleansColumn } from './BooleansColumn';\nexport * from './BooleansColumn';\nexport { default as BoxPlotColumn } from './BoxPlotColumn';\nexport * from './BoxPlotColumn';\nexport { default as CategoricalColumn } from './CategoricalColumn';\nexport * from './CategoricalColumn';\nexport { default as CategoricalMapColumn } from './CategoricalMapColumn';\nexport * from './CategoricalMapColumn';\nexport { default as CategoricalsColumn } from './CategoricalsColumn';\nexport * from './CategoricalsColumn';\nexport { default, default as Column, DEFAULT_COLOR } from './Column';\n// no * export\nexport { default as CompositeColumn } from './CompositeColumn';\n// no * export\nexport { default as CompositeNumberColumn } from './CompositeNumberColumn';\nexport * from './CompositeNumberColumn';\nexport { default as DateColumn } from './DateColumn';\nexport * from './DateColumn';\nexport { default as DatesColumn } from './DatesColumn';\nexport * from './DatesColumn';\nexport { default as DatesMapColumn } from './DatesMapColumn';\nexport * from './DatesMapColumn';\nexport { default as GroupColumn } from './GroupColumn';\nexport * from './GroupColumn';\nexport { default as HierarchyColumn } from './HierarchyColumn';\nexport * from './HierarchyColumn';\nexport { default as ImpositionBoxPlotColumn } from './ImpositionBoxPlotColumn';\nexport * from './ImpositionBoxPlotColumn';\nexport { default as ImpositionCompositeColumn } from './ImpositionCompositeColumn';\nexport * from './ImpositionCompositeColumn';\nexport { default as ImpositionCompositesColumn } from './ImpositionCompositesColumn';\nexport * from './ImpositionCompositesColumn';\nexport { default as LinkColumn } from './LinkColumn';\nexport * from './LinkColumn';\nexport { default as LinkMapColumn } from './LinkMapColumn';\nexport * from './LinkMapColumn';\nexport { default as LinksColumn } from './LinksColumn';\nexport * from './LinksColumn';\nexport { default as MapColumn } from './MapColumn';\nexport * from './MapColumn';\nexport { default as MultiLevelCompositeColumn } from './MultiLevelCompositeColumn';\nexport * from './MultiLevelCompositeColumn';\nexport { default as NestedColumn } from './NestedColumn';\nexport * from './NestedColumn';\nexport { default as NumberColumn } from './NumberColumn';\nexport * from './NumberColumn';\nexport { default as NumberMapColumn } from './NumberMapColumn';\nexport * from './NumberMapColumn';\nexport { default as NumbersColumn } from './NumbersColumn';\nexport * from './NumbersColumn';\nexport { default as OrdinalColumn } from './OrdinalColumn';\nexport * from './OrdinalColumn';\nexport { default as RankColumn } from './RankColumn';\nexport * from './RankColumn';\nexport { default as Ranking, EDirtyReason } from './Ranking';\n// no * export\nexport { default as ReduceColumn } from './ReduceColumn';\nexport * from './ReduceColumn';\nexport { default as ScriptColumn } from './ScriptColumn';\nexport * from './ScriptColumn';\nexport { default as SelectionColumn } from './SelectionColumn';\nexport * from './SelectionColumn';\nexport { default as SetColumn } from './SetColumn';\nexport * from './SetColumn';\nexport { default as StackColumn } from './StackColumn';\nexport * from './StackColumn';\nexport { default as StringColumn } from './StringColumn';\nexport * from './StringColumn';\nexport { default as StringsColumn } from './StringsColumn';\nexport * from './StringsColumn';\nexport { default as StringMapColumn } from './StringMapColumn';\nexport * from './StringMapColumn';\nexport { default as ValueColumn } from './ValueColumn';\n// no * export\n\n/**\n * defines a new column type\n * @param name\n * @param functions\n * @returns {CustomColumn}\n */\nexport function defineColumn<T>(name: string, functions: any = {}): typeof Column {\n  class CustomColumn extends ValueColumn<T> {\n    constructor(id: string, desc: IValueColumnDesc<T>, ...args: any[]) {\n      super(id, desc);\n      if (typeof this.init === 'function') {\n        this.init(id, desc, ...args);\n      }\n    }\n\n    init(..._args: any[]) {\n      // dummy\n    }\n  }\n\n  CustomColumn.prototype.toString = () => name;\n  CustomColumn.prototype = Object.assign(CustomColumn.prototype, functions);\n\n  return CustomColumn;\n}\n","import Column, { IColumnDesc, IDataRow, Ranking, defaultGroup, IndicesArray, IOrderedGroup } from '../model';\nimport ACommonDataProvider from './ACommonDataProvider';\nimport type { IDataProviderOptions } from './interfaces';\nimport { DirectRenderTasks } from './DirectRenderTasks';\nimport type { IRenderTasks } from '../renderer';\n\n/**\n * interface what the server side has to provide\n */\nexport interface IServerData {\n  /**\n   * sort the dataset by the given description\n   * @param ranking\n   */\n  sort(ranking: Ranking): Promise<IndicesArray>;\n\n  /**\n   * returns a slice of the data array identified by a list of indices\n   * @param indices\n   */\n  view(indices: number[]): Promise<any[]>;\n\n  /**\n   * returns a sample of the values for a given column\n   * @param column\n   */\n  mappingSample(column: any): Promise<number[]>;\n\n  /**\n   * return the matching indices matching the given arguments\n   * @param search\n   * @param column\n   */\n  search(search: string | RegExp, column: any): Promise<number[]>;\n}\n\nexport interface IRemoteDataProviderOptions {\n  /**\n   * maximal cache size (unused at the moment)\n   */\n  maxCacheSize: number;\n}\n\nfunction createIndex2Pos(order: IndicesArray) {\n  const index2pos: number[] = [];\n  for (let i = 0; i < order.length; ++i) {\n    index2pos[order[i]] = i + 1;\n  }\n  return index2pos;\n}\n\n/**\n * a remote implementation of the data provider\n */\nexport default class RemoteDataProvider extends ACommonDataProvider {\n  private readonly ooptions: IRemoteDataProviderOptions = {\n    maxCacheSize: 1000,\n  };\n\n  private readonly cache = new Map<number, Promise<IDataRow>>();\n\n  constructor(\n    private server: IServerData,\n    columns: IColumnDesc[] = [],\n    options: Partial<IRemoteDataProviderOptions & IDataProviderOptions> = {}\n  ) {\n    super(columns, options);\n    Object.assign(this.ooptions, options);\n  }\n\n  getTotalNumberOfRows() {\n    // TODO not correct\n    return this.cache.size;\n  }\n\n  getTaskExecutor(): IRenderTasks {\n    // FIXME\n    return new DirectRenderTasks([]);\n  }\n\n  sort(\n    ranking: Ranking\n  ):\n    | Promise<{ groups: IOrderedGroup[]; index2pos: IndicesArray }>\n    | { groups: IOrderedGroup[]; index2pos: IndicesArray } {\n    //use the server side to sort\n    return this.server\n      .sort(ranking)\n      .then((order) => ({ groups: [Object.assign({ order }, defaultGroup)], index2pos: createIndex2Pos(order) }));\n  }\n\n  private loadFromServer(indices: number[]) {\n    return this.server.view(indices).then((view) => {\n      //enhance with the data index\n      return view.map((v, i) => {\n        const dataIndex = indices[i];\n        return { v, dataIndex };\n      });\n    });\n  }\n\n  view(indices: number[]): Promise<any[]> {\n    if (indices.length === 0) {\n      return Promise.resolve([]);\n    }\n    const base = this.fetch([indices])[0];\n    return Promise.all(base).then((rows) => rows.map((d) => d.v));\n  }\n\n  private computeMissing(orders: number[][]): number[] {\n    const union = new Set<number>();\n    const unionAdd = union.add.bind(union);\n    orders.forEach((order) => order.forEach(unionAdd));\n\n    // removed cached\n    this.cache.forEach((_v, k) => union.delete(k));\n\n    if (this.cache.size + union.size > this.ooptions.maxCacheSize) {\n      // clean up cache\n    }\n    // const maxLength = Math.max(...orders.map((o) => o.length));\n    return Array.from(union);\n  }\n\n  private loadInCache(missing: number[]) {\n    if (missing.length === 0) {\n      return;\n    }\n    // load data and map to rows;\n    const v = this.loadFromServer(missing);\n    missing.forEach((_m, i) => {\n      const dataIndex = missing[i];\n      this.cache.set(\n        dataIndex,\n        v.then((loaded) => ({ v: loaded[i], i: dataIndex }))\n      );\n    });\n  }\n\n  fetch(orders: number[][]): Promise<IDataRow>[][] {\n    const toLoad = this.computeMissing(orders);\n    this.loadInCache(toLoad);\n\n    return orders.map((order) => order.map((i) => this.cache.get(i)!));\n  }\n\n  getRow(index: number) {\n    if (this.cache.has(index)) {\n      return this.cache.get(index)!;\n    }\n    this.loadInCache([index]);\n    return this.cache.get(index)!;\n  }\n\n  mappingSample(col: Column): Promise<number[]> {\n    return this.server.mappingSample((col as any).desc.column);\n  }\n\n  searchAndJump(search: string | RegExp, col: Column) {\n    this.server.search(search, (col as any).desc.column).then((indices) => {\n      this.jumpToNearest(indices);\n    });\n  }\n}\n","import { AAggregatedGroupRenderer } from './AAggregatedGroupRenderer';\nimport { ANumbersCellRenderer } from './ANumbersCellRenderer';\nimport ActionRenderer from './ActionRenderer';\nimport AggregateGroupRenderer from './AggregateGroupRenderer';\nimport AnnotationRenderer from './AnnotationRenderer';\nimport BarCellRenderer from './BarCellRenderer';\nimport BooleanCellRenderer from './BooleanCellRenderer';\nimport BoxplotCellRenderer from './BoxplotCellRenderer';\nimport BrightnessCellRenderer, { toHeatMapColor } from './BrightnessCellRenderer';\nimport CategoricalCellRenderer from './CategoricalCellRenderer';\nimport CategoricalHeatmapCellRenderer from './CategoricalHeatmapCellRenderer';\nimport CategoricalStackedDistributionlCellRenderer from './CategoricalStackedDistributionlCellRenderer';\nimport CircleCellRenderer from './CircleCellRenderer';\nimport DateCellRenderer from './DateCellRenderer';\nimport DateHistogramCellRenderer from './DateHistogramCellRenderer';\nimport { DefaultCellRenderer } from './DefaultCellRenderer';\nimport DotCellRenderer from './DotCellRenderer';\nimport GroupCellRenderer from './GroupCellRenderer';\nimport HeatmapCellRenderer from './HeatmapCellRenderer';\nimport HistogramCellRenderer from './HistogramCellRenderer';\nimport ImageCellRenderer from './ImageCellRenderer';\nimport InterleavingCellRenderer from './InterleavingCellRenderer';\nimport LinkCellRenderer from './LinkCellRenderer';\nimport LinkMapCellRenderer from './LinkMapCellRenderer';\nimport LoadingCellRenderer from './LoadingCellRenderer';\nimport MapBarCellRenderer from './MapBarCellRenderer';\nimport MultiLevelCellRenderer from './MultiLevelCellRenderer';\nimport RankCellRenderer from './RankCellRenderer';\nimport SelectionRenderer from './SelectionRenderer';\nimport SetCellRenderer from './SetCellRenderer';\nimport SparklineCellRenderer from './SparklineCellRenderer';\nimport StringCellRenderer from './StringCellRenderer';\nimport TableCellRenderer from './TableCellRenderer';\nimport UpSetCellRenderer from './UpSetCellRenderer';\nimport VerticalBarCellRenderer from './VerticalBarCellRenderer';\nimport { noRenderer, wideEnough, wideEnoughCat, adaptTextColorToBgColor, adaptDynamicColorToBgColor } from './utils';\n\nexport { colorOf } from './impose';\nexport * from './interfaces';\nexport { renderMissingCanvas, renderMissingDOM } from './missing';\n\nexport const rendererClasses = {\n  AAggregatedGroupRenderer,\n  ANumbersCellRenderer,\n  ActionRenderer,\n  AggregateGroupRenderer,\n  AnnotationRenderer,\n  BarCellRenderer,\n  BooleanCellRenderer,\n  BoxplotCellRenderer,\n  BrightnessCellRenderer,\n  CategoricalCellRenderer,\n  CategoricalHeatmapCellRenderer,\n  CategoricalStackedDistributionlCellRenderer,\n  CircleCellRenderer,\n  DateCellRenderer,\n  DateHistogramCellRenderer,\n  DefaultCellRenderer,\n  DotCellRenderer,\n  GroupCellRenderer,\n  HeatmapCellRenderer,\n  HistogramCellRenderer,\n  ImageCellRenderer,\n  InterleavingCellRenderer,\n  LinkCellRenderer,\n  LinkMapCellRenderer,\n  LoadingCellRenderer,\n  MapBarCellRenderer,\n  MultiLevelCellRenderer,\n  RankCellRenderer,\n  SelectionRenderer,\n  SetCellRenderer,\n  SparklineCellRenderer,\n  StringCellRenderer,\n  TableCellRenderer,\n  UpSetCellRenderer,\n  VerticalBarCellRenderer,\n};\n\nexport const rendererUtils = {\n  toHeatMapColor,\n  noRenderer,\n  wideEnough,\n  wideEnoughCat,\n  adaptTextColorToBgColor,\n  adaptDynamicColorToBgColor,\n};\n","/**\n * main module of LineUp.js containing the main class and exposes all other modules\n */\n\nimport type { IColumnDesc } from './model';\nimport { DataProvider, LocalDataProvider, ILocalDataProviderOptions } from './provider';\nimport { LineUp, Taggle } from './ui';\nimport type { ILineUpOptions, ITaggleOptions } from './config';\n\nexport * from './builder';\nexport * from './config';\nexport * from './internal/mathInterfaces';\nexport * from './model';\nexport * from './provider';\nexport * from './renderer';\nexport * from './ui';\nexport { LineUp as default } from './ui';\n\nexport function createLocalDataProvider(\n  data: any[],\n  columns: IColumnDesc[],\n  options: Partial<ILocalDataProviderOptions> = {}\n) {\n  return new LocalDataProvider(data, columns, options);\n}\n\n/**\n *\n * @param container the html element lineup should be built in\n * @param data {DataProvider} the data provider\n * @param config {Partial<ILineUpOptions>} lineup configuration overrides\n * @returns {LineUp} the created lineup instance\n */\nexport function createLineUp(container: HTMLElement, data: DataProvider, config: Partial<ILineUpOptions> = {}) {\n  return new LineUp(container, data, config);\n}\n\nexport function createTaggle(container: HTMLElement, data: DataProvider, config: Partial<ITaggleOptions> = {}) {\n  return new Taggle(container, data, config);\n}\n","// eslint-disable-next-line import/no-webpack-loader-syntax\nimport '!file-loader?name=schema.4.0.0.json!./provider/schema.json';\nimport './style.scss';\nexport * from './';\nexport { default } from './';\n\ndeclare const __VERSION__: string;\ndeclare const __BUILD_ID__: string;\ndeclare const __LICENSE__: string;\n\n/**\n * LineUp version\n * @type {string}\n */\nexport const version = __VERSION__;\n/**\n * LineUp unique build id\n * @type {string}\n */\nexport const buildId = __BUILD_ID__;\n/**\n * LineUp license type\n * @type {string}\n */\nexport const license = __LICENSE__;\n"],"sourceRoot":""}